{"version":3,"sources":["../../../../../../packages/foliate-js/fb2.js"],"sourcesContent":["const normalizeWhitespace = str => str ? str\n    .replace(/[\\t\\n\\f\\r ]+/g, ' ')\n    .replace(/^[\\t\\n\\f\\r ]+/, '')\n    .replace(/[\\t\\n\\f\\r ]+$/, '') : ''\nconst getElementText = el => normalizeWhitespace(el?.textContent)\n\nconst NS = {\n    XLINK: 'http://www.w3.org/1999/xlink',\n    EPUB: 'http://www.idpf.org/2007/ops',\n}\n\nconst MIME = {\n    XML: 'application/xml',\n    XHTML: 'application/xhtml+xml',\n}\n\nconst STYLE = {\n    'strong': ['strong', 'self'],\n    'emphasis': ['em', 'self'],\n    'style': ['span', 'self'],\n    'a': 'anchor',\n    'strikethrough': ['s', 'self'],\n    'sub': ['sub', 'self'],\n    'sup': ['sup', 'self'],\n    'code': ['code', 'self'],\n    'image': 'image',\n}\n\nconst TABLE = {\n    'tr': ['tr', {\n        'th': ['th', STYLE, ['colspan', 'rowspan', 'align', 'valign']],\n        'td': ['td', STYLE, ['colspan', 'rowspan', 'align', 'valign']],\n    }, ['align']],\n}\n\nconst POEM = {\n    'epigraph': ['blockquote'],\n    'subtitle': ['h2', STYLE],\n    'text-author': ['p', STYLE],\n    'date': ['p', STYLE],\n    'stanza': ['div', 'self'],\n    'v': ['div', STYLE],\n}\n\nconst SECTION = {\n    'title': ['header', {\n        'p': ['h1', STYLE],\n        'empty-line': ['br'],\n    }],\n    'epigraph': ['blockquote', 'self'],\n    'image': 'image',\n    'annotation': ['aside'],\n    'section': ['section', 'self'],\n    'p': ['p', STYLE],\n    'poem': ['blockquote', POEM],\n    'subtitle': ['h2', STYLE],\n    'cite': ['blockquote', 'self'],\n    'empty-line': ['br'],\n    'table': ['table', TABLE],\n    'text-author': ['p', STYLE],\n}\nPOEM['epigraph'].push(SECTION)\n\nconst BODY = {\n    'image': 'image',\n    'title': ['section', {\n        'p': ['h1', STYLE],\n        'empty-line': ['br'],\n    }],\n    'epigraph': ['section', SECTION],\n    'section': ['section', SECTION],\n}\n\nclass FB2Converter {\n    constructor(fb2) {\n        this.fb2 = fb2\n        this.doc = document.implementation.createDocument(NS.XHTML, 'html')\n        // use this instead of `getElementById` to allow images like\n        // `<image l:href=\"#img1.jpg\" id=\"img1.jpg\" />`\n        this.bins = new Map(Array.from(this.fb2.getElementsByTagName('binary'),\n            el => [el.id, el]))\n    }\n    getImageSrc(el) {\n        const href = el.getAttributeNS(NS.XLINK, 'href')\n        if (!href) return 'data:,'\n        const [, id] = href.split('#')\n        if (!id) return href\n        const bin = this.bins.get(id)\n        return bin\n            ? `data:${bin.getAttribute('content-type')};base64,${bin.textContent}`\n            : href\n    }\n    image(node) {\n        const el = this.doc.createElement('img')\n        el.alt = node.getAttribute('alt')\n        el.title = node.getAttribute('title')\n        el.setAttribute('src', this.getImageSrc(node))\n        return el\n    }\n    anchor(node) {\n        const el = this.convert(node, { 'a': ['a', STYLE] })\n        el.setAttribute('href', node.getAttributeNS(NS.XLINK, 'href'))\n        if (node.getAttribute('type') === 'note')\n            el.setAttributeNS(NS.EPUB, 'epub:type', 'noteref')\n        return el\n    }\n    convert(node, def) {\n        // not an element; return text content\n        if (node.nodeType === 3) return this.doc.createTextNode(node.textContent)\n        if (node.nodeType === 4) return this.doc.createCDATASection(node.textContent)\n        if (node.nodeType === 8) return this.doc.createComment(node.textContent)\n\n        const d = def?.[node.nodeName]\n        if (!d) return null\n        if (typeof d === 'string') return this[d](node)\n\n        const [name, opts, attrs] = d\n        const el = this.doc.createElement(name)\n\n        // copy the ID, and set class name from original element name\n        if (node.id) el.id = node.id\n        el.classList.add(node.nodeName)\n\n        // copy attributes\n        if (Array.isArray(attrs)) for (const attr of attrs) {\n            const value = node.getAttribute(attr)\n            if (value) el.setAttribute(attr, value)\n        }\n\n        // process child elements recursively\n        const childDef = opts === 'self' ? def : opts\n        let child = node.firstChild\n        while (child) {\n            const childEl = this.convert(child, childDef)\n            if (childEl) el.append(childEl)\n            child = child.nextSibling\n        }\n        return el\n    }\n}\n\nconst parseXML = async blob => {\n    const buffer = await blob.arrayBuffer()\n    const str = new TextDecoder('utf-8').decode(buffer)\n    const parser = new DOMParser()\n    const doc = parser.parseFromString(str, MIME.XML)\n    const encoding = doc.xmlEncoding\n        // `Document.xmlEncoding` is deprecated, and already removed in Firefox\n        // so parse the XML declaration manually\n        || str.match(/^<\\?xml\\s+version\\s*=\\s*[\"']1.\\d+\"\\s+encoding\\s*=\\s*[\"']([A-Za-z0-9._-]*)[\"']/)?.[1]\n    if (encoding && encoding.toLowerCase() !== 'utf-8') {\n        const str = new TextDecoder(encoding).decode(buffer)\n        return parser.parseFromString(str, MIME.XML)\n    }\n    return doc\n}\n\nconst style = URL.createObjectURL(new Blob([`\n@namespace epub \"http://www.idpf.org/2007/ops\";\nbody > img, section > img {\n    display: block;\n    margin: auto;\n}\n.title h1 {\n    text-align: center;\n}\nbody > section > .title, body.notesBodyType > .title {\n    margin: 3em 0;\n}\nbody.notesBodyType > section .title h1 {\n    text-align: start;\n}\nbody.notesBodyType > section .title {\n    margin: 1em 0;\n}\np {\n    text-indent: 1em;\n    margin: 0;\n}\n:not(p) + p, p:first-child {\n    text-indent: 0;\n}\n.stanza {\n    text-indent: 0;\n    margin: 1em 0;\n}\n.text-author, .date {\n    text-align: end;\n}\n.text-author:before {\n    content: \"—\";\n}\ntable {\n    border-collapse: collapse;\n}\ntd, th {\n    padding: .25em;\n}\na[epub|type~=\"noteref\"] {\n    font-size: .75em;\n    vertical-align: super;\n}\nbody:not(.notesBodyType) > .title, body:not(.notesBodyType) > .epigraph {\n    margin: 3em 0;\n}\n`], { type: 'text/css' }))\n\nconst template = html => `<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<html xmlns=\"http://www.w3.org/1999/xhtml\">\n    <head><link href=\"${style}\" rel=\"stylesheet\" type=\"text/css\"/></head>\n    <body>${html}</body>\n</html>`\n\n// name of custom ID attribute for TOC items\nconst dataID = 'data-foliate-id'\n\nexport const makeFB2 = async blob => {\n    const book = {}\n    const doc = await parseXML(blob)\n    const converter = new FB2Converter(doc)\n\n    const $ = x => doc.querySelector(x)\n    const $$ = x => [...doc.querySelectorAll(x)]\n    const getPerson = el => {\n        const nick = getElementText(el.querySelector('nickname'))\n        if (nick) return nick\n        const first = getElementText(el.querySelector('first-name'))\n        const middle = getElementText(el.querySelector('middle-name'))\n        const last = getElementText(el.querySelector('last-name'))\n        const name = [first, middle, last].filter(x => x).join(' ')\n        const sortAs = last\n            ? [last, [first, middle].filter(x => x).join(' ')].join(', ')\n            : null\n        return { name, sortAs }\n    }\n    const getDate = el => el?.getAttribute('value') ?? getElementText(el)\n    const annotation = $('title-info annotation')\n    book.metadata = {\n        title: getElementText($('title-info book-title')),\n        identifier: getElementText($('document-info id')),\n        language: getElementText($('title-info lang')),\n        author: $$('title-info author').map(getPerson),\n        translator: $$('title-info translator').map(getPerson),\n        contributor: $$('document-info author').map(getPerson)\n            // techincially the program probably shouldn't get the `bkp` role\n            // but it has been so used by calibre, so ¯\\_(ツ)_/¯\n            .concat($$('document-info program-used').map(getElementText))\n            .map(x => Object.assign(typeof x === 'string' ? { name: x } : x,\n                { role: 'bkp' })),\n        publisher: getElementText($('publish-info publisher')),\n        published: getDate($('title-info date')),\n        modified: getDate($('document-info date')),\n        description: annotation ? converter.convert(annotation,\n            { annotation: ['div', SECTION] }).innerHTML : null,\n        subject: $$('title-info genre').map(getElementText),\n    }\n    if ($('coverpage image')) {\n        const src = converter.getImageSrc($('coverpage image'))\n        book.getCover = () => fetch(src).then(res => res.blob())\n    } else book.getCover = () => null\n\n    // get convert each body\n    const bodyData = Array.from(doc.querySelectorAll('body'), body => {\n        const converted = converter.convert(body, { body: ['body', BODY] })\n        return [Array.from(converted.children, el => {\n            // get list of IDs in the section\n            const ids = [el, ...el.querySelectorAll('[id]')].map(el => el.id)\n            return { el, ids }\n        }), converted]\n    })\n\n    const urls = []\n    const sectionData = bodyData[0][0]\n        // make a separate section for each section in the first body\n        .map(({ el, ids }) => {\n            // set up titles for TOC\n            const titles = Array.from(\n                el.querySelectorAll(':scope > section > .title'),\n                (el, index) => {\n                    el.setAttribute(dataID, index)\n                    return { title: getElementText(el), index }\n                })\n            return { ids, titles, el }\n        })\n        // for additional bodies, only make one section for each body\n        .concat(bodyData.slice(1).map(([sections, body]) => {\n            const ids = sections.map(s => s.ids).flat()\n            body.classList.add('notesBodyType')\n            return { ids, el: body, linear: 'no' }\n        }))\n        .map(({ ids, titles, el, linear }) => {\n            const str = template(el.outerHTML)\n            const blob = new Blob([str], { type: MIME.XHTML })\n            const url = URL.createObjectURL(blob)\n            urls.push(url)\n            const title = normalizeWhitespace(\n                el.querySelector('.title, .subtitle, p')?.textContent\n                ?? (el.classList.contains('title') ? el.textContent : ''))\n            return {\n                ids, title, titles, load: () => url,\n                createDocument: () => new DOMParser().parseFromString(str, MIME.XHTML),\n                // doo't count image data as it'd skew the size too much\n                size: blob.size - Array.from(el.querySelectorAll('[src]'),\n                    el => el.getAttribute('src')?.length ?? 0)\n                    .reduce((a, b) => a + b, 0),\n                linear,\n            }\n        })\n\n    const idMap = new Map()\n    book.sections = sectionData.map((section, index) => {\n        const { ids, load, createDocument, size, linear } = section\n        for (const id of ids) if (id) idMap.set(id, index)\n        return { id: index, load, createDocument, size, linear }\n    })\n\n    book.toc = sectionData.map(({ title, titles }, index) => {\n        const id = index.toString()\n        return {\n            label: title,\n            href: id,\n            subitems: titles?.length ? titles.map(({ title, index }) => ({\n                label: title,\n                href: `${id}#${index}`,\n            })) : null,\n        }\n    }).filter(item => item)\n\n    book.resolveHref = href => {\n        const [a, b] = href.split('#')\n        return a\n            // the link is from the TOC\n            ? { index: Number(a), anchor: doc => doc.querySelector(`[${dataID}=\"${b}\"]`) }\n            // link from within the page\n            : { index: idMap.get(b), anchor: doc => doc.getElementById(b) }\n    }\n    book.splitTOCHref = href => href?.split('#')?.map(x => Number(x)) ?? []\n    book.getTOCFragment = (doc, id) => doc.querySelector(`[${dataID}=\"${id}\"]`)\n\n    book.destroy = () => {\n        for (const url of urls) URL.revokeObjectURL(url)\n    }\n    return book\n}\n"],"names":[],"mappings":"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"}