module.exports=[316282,a=>{"use strict";let b=new Set(["PDF","CBZ"]);a.s(["FIXED_LAYOUT_FORMATS",0,b])},653221,a=>{"use strict";a.s(["deserializeConfig",0,(a,b,c)=>{let d=JSON.parse(a),{viewSettings:e,searchConfig:f}=d;return d.viewSettings={...b,...e},d.searchConfig={...c,...f},d.updatedAt??=Date.now(),d},"serializeConfig",0,(a,b,c)=>{let d=(a=JSON.parse(JSON.stringify(a))).viewSettings,e=a.searchConfig;return a.viewSettings=Object.entries(d).reduce((a,[c,d])=>(b[c]!==d&&(a[c]=d),a),{}),a.searchConfig=Object.entries(e).reduce((a,[b,d])=>(c[b]!==d&&(a[b]=d),a),{}),JSON.stringify(a)}])},753954,a=>{"use strict";var b=a.i(73552),c=a.i(41162),d=a.i(833047),e=a.i(157849),f=a.i(657123);let g=async()=>"",h={resolvePath:(a,b)=>{let c="undefined"!=typeof process;switch("undefined"!=typeof process&&console.log("[ResolvePath] Env Check - NEXT_PUBLIC_STORAGE_MODE:","local","isLocalMode:",c,"base:",b,"path:",a),b){case"Data":return{baseDir:0,basePrefix:g,fp:`${f.DATA_SUBDIR}/${a}`,base:b};case"Settings":return{baseDir:0,basePrefix:g,fp:`.readest/${a}`,base:b};case"Books":if("library.json"===a||"library.json.bak"===a||"library_backup.json"===a)return console.log("[ResolvePath] Books/Library detected, routing to .readest"),{baseDir:0,basePrefix:g,fp:`.readest/${a}`,base:b};return console.log("[ResolvePath] ✓ Books base, flat path (no prefix):",a),console.log("[ResolvePath] ✓ Returning fp:",a),{baseDir:0,basePrefix:g,fp:a,base:b};case"Fonts":return{baseDir:0,basePrefix:g,fp:`${f.LOCAL_FONTS_SUBDIR}/${a}`,base:b};case"Images":return{baseDir:0,basePrefix:g,fp:`${f.LOCAL_IMAGES_SUBDIR}/${a}`,base:b};case"None":return{baseDir:0,basePrefix:g,fp:a,base:b};default:return{baseDir:0,basePrefix:g,fp:`${b}/${a}`,base:b}}},async getPrefix(a){let{basePrefix:b,fp:c}=this.resolvePath("",a),d=await b();return(c?d?`${d}/${c}`:c:d).replace(/\/+$/,"")},getURL:a=>(0,b.isValidURL)(a)?a:`/api/storage/file?filePath=${encodeURIComponent(a)}`,async getBlobURL(a,b){try{let c=await this.readFile(a,b,"binary");return URL.createObjectURL(new Blob([c]))}catch{return a}},async getImageURL(a){return this.getURL(a)},async openFile(a,d,e){if((0,b.isValidURL)(a))return await new c.RemoteFile(a,e).open();let{fp:f}=this.resolvePath(a,d),g=await fetch(`/api/storage/file?filePath=${encodeURIComponent(f)}`);if(!g.ok)throw Error("File not found");return new File([await g.arrayBuffer()],e||a)},async copyFile(a,b,c){let d=await this.openFile(a,c);await this.writeFile(b,c,d)},async readFile(a,b,c){let{fp:d}=this.resolvePath(a,b),e=await fetch(`/api/storage/file?filePath=${encodeURIComponent(d)}`);if(!e.ok)throw Error(`File not found: ${d}`);return"text"===c?await e.text():await e.arrayBuffer()},async writeFile(a,b,c){let d,{fp:e}=this.resolvePath(a,b);if(console.log("[APIFileSystem.writeFile] 11. Input path:",a),console.log("[APIFileSystem.writeFile] 12. Base:",b),console.log("[APIFileSystem.writeFile] 13. Resolved fp:",e),d=c instanceof File?Buffer.from(await c.arrayBuffer()):Buffer.from(c),console.log("[APIFileSystem.writeFile] 14. Calling PUT /api/storage/file with filePath:",e),!(await fetch(`/api/storage/file?filePath=${encodeURIComponent(e)}`,{method:"PUT",body:d})).ok)throw Error("Failed to write file")},async removeFile(a,b){let{fp:c}=this.resolvePath(a,b);if(!(await fetch(`/api/storage/delete?fileKey=${encodeURIComponent(c)}`,{method:"DELETE"})).ok)throw Error("Failed to delete file")},async createDir(a,b){},async removeDir(a,b){},readDir:async(a,b)=>[],async exists(a,b){let{fp:c}=this.resolvePath(a,b);return(await fetch(`/api/storage/file?filePath=${encodeURIComponent(c)}`)).ok},async stats(a,b){let{fp:c}=this.resolvePath(a,b),d=await fetch(`/api/storage/file?filePath=${encodeURIComponent(c)}`);if(!d.ok)throw Error("File not found");return{isFile:!0,isDirectory:!1,size:(await d.arrayBuffer()).byteLength,mtime:null,atime:null,birthtime:null}}};class i extends e.BaseAppService{get fs(){return h}isMobile=["android","ios"].includes((0,b.getOSPlatform)());appPlatform="web";hasSafeAreaInset=(0,d.isPWA)();async init(){await this.loadSettings(),await this.prepareBooksDir(),await this.runMigrations()}async runMigrations(){try{let a=await this.loadSettings(),b=a.migrationVersion||0;await super.runMigrations(b),b<this.CURRENT_MIGRATION_VERSION&&await this.saveSettings({...a,migrationVersion:this.CURRENT_MIGRATION_VERSION})}catch(a){console.error("Failed to run migrations:",a)}}resolvePath(a,b){return this.fs.resolvePath(a,b)}async setCustomRootDir(){}async selectDirectory(){throw Error("selectDirectory is not supported in browser")}async selectFiles(){throw Error("selectFiles is not supported in browser")}async saveFile(a,b,c){try{let d=new Blob([b],{type:c||"application/octet-stream"}),e=URL.createObjectURL(d),f=document.createElement("a");return f.href=e,f.download=a,document.body.appendChild(f),f.click(),document.body.removeChild(f),URL.revokeObjectURL(e),!0}catch(a){return console.error("Failed to save file:",a),!1}}}a.s(["WebAppService",()=>i],753954)},80252,a=>{a.v(b=>Promise.all(["server/chunks/ssr/f449e_@zip_js_zip_js_index_d4429d10.js"].map(b=>a.l(b))).then(()=>b(990118)))},935402,a=>{a.v(b=>Promise.all(["server/chunks/ssr/packages_foliate-js_mobi_a25e0f9e.js"].map(b=>a.l(b))).then(()=>b(475030)))},120301,a=>{a.v(b=>Promise.all(["server/chunks/ssr/packages_foliate-js_fb2_f522a9e4.js"].map(b=>a.l(b))).then(()=>b(803730)))},38142,a=>{a.v(b=>Promise.all(["server/chunks/ssr/packages_foliate-js_vendor_fflate_01544751.js"].map(b=>a.l(b))).then(()=>b(948184)))},602697,a=>{a.v(b=>Promise.all(["server/chunks/ssr/packages_foliate-js_pdf_b32b9681.js"].map(b=>a.l(b))).then(()=>b(67625)))},306701,a=>{a.v(b=>Promise.all(["server/chunks/ssr/packages_foliate-js_epub_b1bb2d68.js"].map(b=>a.l(b))).then(()=>b(177242)))},857698,a=>{a.v(b=>Promise.all(["server/chunks/ssr/packages_foliate-js_comic-book_e30e163a.js"].map(b=>a.l(b))).then(()=>b(560492)))}];

//# sourceMappingURL=_ae62b9e8._.js.map