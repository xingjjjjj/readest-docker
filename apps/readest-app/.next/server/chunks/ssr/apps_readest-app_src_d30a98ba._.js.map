{"version":3,"sources":["../../../../../../apps/readest-app/src/utils/ua.ts","../../../../../../apps/readest-app/src/hooks/useTranslation.ts","../../../../../../apps/readest-app/src/app/error.tsx","../../../../../../apps/readest-app/src/utils/error.ts"],"sourcesContent":["import { AppService } from '@/types/system';\n\nexport const parseWebViewInfo = (appService: AppService | null): string => {\n  const ua = navigator.userAgent;\n\n  if (appService?.isAndroidApp) {\n    // Android WebView\n    const chromeMatch = ua.match(/Chrome\\/([0-9.]+)/);\n    return chromeMatch ? `WebView ${chromeMatch[1]}` : 'Android WebView';\n  } else if (appService?.isIOSApp) {\n    // iOS WebView\n    const webkitMatch = ua.match(/AppleWebKit\\/([0-9.]+)/);\n    return webkitMatch ? `WebView ${webkitMatch[1]}` : 'iOS WebView';\n  } else if (appService?.isMacOSApp) {\n    // macOS WebView\n    const webkitMatch = ua.match(/AppleWebKit\\/([0-9.]+)/);\n    return webkitMatch ? `WebView ${webkitMatch[1]}` : 'macOS WebView';\n  } else if (appService?.appPlatform === 'tauri' && appService?.osPlatform === 'windows') {\n    // Windows WebView2\n    const match = ua.match(/Edg\\/([0-9.]+)/);\n    return match ? `Edge ${match[1]}` : 'Edge WebView2';\n  } else if (appService?.appPlatform === 'tauri' && appService?.osPlatform === 'linux') {\n    // Linux WebView\n    const match = ua.match(/AppleWebKit\\/([0-9.]+)/);\n    return match ? `WebView ${match[1]}` : 'Linux WebView';\n  } else if (ua.includes('CriOS') && ua.includes('Mobile/') && ua.includes('Safari')) {\n    // iOS Chrome WebView\n    const match = ua.match(/CriOS\\/([0-9.]+)/);\n    return match ? `Chrome ${match[1]}` : 'iOS Chrome';\n  } else if (ua.includes('FxiOS') && ua.includes('Mobile/') && ua.includes('Safari')) {\n    // iOS Firefox WebView\n    const match = ua.match(/FxiOS\\/([0-9.]+)/);\n    return match ? `Firefox ${match[1]}` : 'iOS Firefox';\n  } else if (ua.includes('Chrome') && ua.includes('AppleWebKit') && ua.includes('Macintosh')) {\n    // macOS Chrome\n    const match = ua.match(/Chrome\\/([0-9.]+)/);\n    return match ? `Chrome ${match[1]}` : 'macOS Chrome';\n  } else if (ua.includes('Safari') && ua.includes('AppleWebKit') && ua.includes('Macintosh')) {\n    // macOS Safari\n    const match = ua.match(/Safari\\/([0-9.]+)/);\n    return match ? `Safari ${match[1]}` : 'macOS Safari';\n  } else if (ua.includes('Edg/')) {\n    // Microsoft Edge\n    const match = ua.match(/Edg\\/([0-9.]+)/);\n    return match ? `Edge ${match[1]}` : 'Edge WebView';\n  } else if (ua.includes('Firefox/')) {\n    // Firefox\n    const match = ua.match(/Firefox\\/([0-9.]+)/);\n    return match ? `Firefox ${match[1]}` : 'Firefox Gecko';\n  } else if (ua.includes('Chrome/') && !ua.includes('Chromium')) {\n    // Chrome\n    const match = ua.match(/Chrome\\/([0-9.]+)/);\n    return match ? `Chrome ${match[1]}` : 'Chrome';\n  } else if (ua.includes('Chromium/')) {\n    // Chromium\n    const match = ua.match(/Chromium\\/([0-9.]+)/);\n    return match ? `Chromium ${match[1]}` : 'Chromium';\n  } else if (ua.includes('MSIE ')) {\n    // Internet Explorer\n    const match = ua.match(/MSIE ([0-9.]+)/);\n    return match ? `IE ${match[1]}` : 'Internet Explorer';\n  } else {\n    return 'Unknown';\n  }\n};\n\nexport const parseWebViewVersion = (appService: AppService | null): number => {\n  const webViewInfo = parseWebViewInfo(appService);\n  const versionMatch = webViewInfo.match(/([0-9]+)\\./);\n  return versionMatch ? parseFloat(versionMatch[1]!) : 0;\n};\n","'use client';\n\nimport '@/i18n/i18n';\nimport { useCallback } from 'react';\nimport { useTranslation as _useTranslation } from 'react-i18next';\n\nexport type TranslationFunc = (key: string, options?: Record<string, number | string>) => string;\n\nexport const useTranslation = (namespace: string = 'translation') => {\n  const { t } = _useTranslation(namespace);\n\n  return useCallback((key: string, options = {}) => t(key, { defaultValue: key, ...options }), [t]);\n};\n","'use client';\n\nimport posthog from 'posthog-js';\nimport { useEffect, useState } from 'react';\nimport { useEnv } from '@/context/EnvContext';\nimport { useTranslation } from '@/hooks/useTranslation';\nimport { parseWebViewInfo } from '@/utils/ua';\nimport { handleGlobalError } from '@/utils/error';\n\ninterface ErrorPageProps {\n  error: Error & { digest?: string };\n  reset: () => void;\n}\n\nexport default function Error({ error, reset }: ErrorPageProps) {\n  const _ = useTranslation();\n  const { appService } = useEnv();\n  const [browserInfo, setBrowserInfo] = useState('');\n\n  useEffect(() => {\n    setBrowserInfo(parseWebViewInfo(appService));\n  }, [appService]);\n\n  useEffect(() => {\n    posthog.captureException(error);\n    handleGlobalError(error);\n  }, [appService, error]);\n\n  const handleGoHome = () => {\n    window.location.href = '/library';\n  };\n\n  const handleGoBack = () => {\n    if (window.history.length > 1) {\n      window.history.back();\n    } else {\n      handleGoHome();\n    }\n  };\n\n  return (\n    <div className='hero bg-base-200 min-h-screen'>\n      <div className='hero-content text-center'>\n        <div className='w-full max-w-2xl p-1'>\n          <div className='mb-8 mt-6'>\n            <div className='text-error animate-pulse text-8xl'>⚠️</div>\n          </div>\n\n          <h1 className='text-base-content mb-4 text-5xl font-bold'>Oops!</h1>\n\n          <p className='text-base-content/70 mb-8 text-lg'>\n            {_(\n              \"Something went wrong. Don't worry, our team has been notified and we're working on a fix.\",\n            )}\n          </p>\n\n          <div className='alert alert-error mb-8 overflow-hidden'>\n            <div className='w-full min-w-0 flex-col items-start text-left'>\n              <h3 className='mb-2 font-bold'>{_('Error Details:')}</h3>\n              <p className='overflow-wrap-anywhere w-full break-words font-mono text-sm'>\n                {error.message}\n              </p>\n              {browserInfo && (\n                <p className='overflow-wrap-anywhere mt-2 w-full break-words font-mono text-sm'>\n                  Browser: {browserInfo}\n                </p>\n              )}\n              {error.stack && (\n                <p className='overflow-wrap-anywhere mt-2 w-full whitespace-pre-wrap break-words font-mono text-sm'>\n                  {error.stack.split('\\n').slice(0, 3).join('\\n')}\n                </p>\n              )}\n              {error.digest && (\n                <p className='overflow-wrap-anywhere mt-2 w-full break-words text-xs opacity-70'>\n                  Error ID: {error.digest}\n                </p>\n              )}\n            </div>\n          </div>\n\n          <div className='flex flex-col gap-4'>\n            <button onClick={reset} className='btn btn-primary btn-lg'>\n              <svg className='mr-2 h-5 w-5' fill='none' stroke='currentColor' viewBox='0 0 24 24'>\n                <path\n                  strokeLinecap='round'\n                  strokeLinejoin='round'\n                  strokeWidth={2}\n                  d='M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15'\n                />\n              </svg>\n              {_('Try Again')}\n            </button>\n\n            <div className='flex gap-3'>\n              <button onClick={handleGoBack} className='btn btn-outline flex-1'>\n                <svg className='mr-2 h-4 w-4' fill='none' stroke='currentColor' viewBox='0 0 24 24'>\n                  <path\n                    strokeLinecap='round'\n                    strokeLinejoin='round'\n                    strokeWidth={2}\n                    d='M10 19l-7-7m0 0l7-7m-7 7h18'\n                  />\n                </svg>\n                {_('Go Back')}\n              </button>\n\n              <button onClick={handleGoHome} className='btn btn-outline flex-1'>\n                <svg className='mr-2 h-4 w-4' fill='none' stroke='currentColor' viewBox='0 0 24 24'>\n                  <path\n                    strokeLinecap='round'\n                    strokeLinejoin='round'\n                    strokeWidth={2}\n                    d='M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6'\n                  />\n                </svg>\n                {_('Your Library')}\n              </button>\n            </div>\n          </div>\n\n          <div className='border-base-300 mt-8 border-t pt-6'>\n            <p className='text-base-content/60 text-sm'>\n              {_('Need help?')}{' '}\n              <a href='mailto:support@readest.com' className='link link-primary'>\n                {_('Contact Support')}\n              </a>\n            </p>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n","export const handleGlobalError = (e: Error) => {\n  const isChunkError = e?.message?.includes('Loading chunk');\n\n  if (!isChunkError) {\n    const now = Date.now();\n    const lastReload = Number(sessionStorage.getItem('lastErrorReload') || '0');\n    if (now - lastReload > 60_000) {\n      sessionStorage.setItem('lastErrorReload', String(now));\n      window.location.reload();\n    } else {\n      console.warn('Error detected, but reload suppressed (rate limit)');\n    }\n  }\n};\n"],"names":[],"mappings":"wCAEO,IAAM,EAAoB,AAAD,IAC9B,IAAM,EAAK,UAAU,SAAS,CAE9B,GAAI,GAAY,aAAc,CAE5B,IAAM,EAAc,EAAG,KAAK,CAAC,qBAC7B,OAAO,EAAc,CAAC,QAAQ,EAAE,CAAW,CAAC,EAAE,CAAA,CAAE,CAAG,iBACrD,CAAO,GAAI,GAAY,SAAU,CAE/B,IAAM,EAAc,EAAG,KAAK,CAAC,0BAC7B,OAAO,EAAc,CAAC,QAAQ,EAAE,CAAW,CAAC,EAAE,CAAA,CAAE,CAAG,aACrD,CAAO,GAAI,GAAY,WAAY,CAEjC,IAAM,EAAc,EAAG,KAAK,CAAC,0BAC7B,OAAO,EAAc,CAAC,QAAQ,EAAE,CAAW,CAAC,EAAE,CAAA,CAAE,CAAG,eACrD,CAAO,GAAI,GAAY,cAAgB,SAAW,GAAY,aAAe,UAAW,CAEtF,IAAM,EAAQ,EAAG,KAAK,CAAC,kBACvB,OAAO,EAAQ,CAAC,KAAK,EAAE,CAAK,CAAC,EAAE,CAAA,CAAE,CAAG,eACtC,CAAO,GAAI,GAAY,cAAgB,SAAW,GAAY,aAAe,QAAS,CAEpF,IAAM,EAAQ,EAAG,KAAK,CAAC,0BACvB,OAAO,EAAQ,CAAC,QAAQ,EAAE,CAAK,CAAC,EAAE,CAAA,CAAE,CAAG,eACzC,MAAO,GAAI,EAAG,QAAQ,CAAC,UAAY,EAAG,QAAQ,CAAC,YAAc,EAAG,QAAQ,CAAC,UAAW,CAElF,IAAM,EAAQ,EAAG,KAAK,CAAC,oBACvB,OAAO,EAAQ,CAAC,OAAO,EAAE,CAAK,CAAC,EAAE,CAAA,CAAE,CAAG,YACxC,MAAO,GAAI,EAAG,QAAQ,CAAC,UAAY,EAAG,QAAQ,CAAC,YAAc,EAAG,QAAQ,CAAC,UAAW,CAElF,IAAM,EAAQ,EAAG,KAAK,CAAC,oBACvB,OAAO,EAAQ,CAAC,QAAQ,EAAE,CAAK,CAAC,EAAE,CAAA,CAAE,CAAG,aACzC,MAAO,GAAI,EAAG,QAAQ,CAAC,WAAa,EAAG,QAAQ,CAAC,gBAAkB,EAAG,QAAQ,CAAC,aAAc,CAE1F,IAAM,EAAQ,EAAG,KAAK,CAAC,qBACvB,OAAO,EAAQ,CAAC,OAAO,EAAE,CAAK,CAAC,EAAE,CAAA,CAAE,CAAG,cACxC,MAAO,GAAI,EAAG,QAAQ,CAAC,WAAa,EAAG,QAAQ,CAAC,gBAAkB,EAAG,QAAQ,CAAC,aAAc,CAE1F,IAAM,EAAQ,EAAG,KAAK,CAAC,qBACvB,OAAO,EAAQ,CAAC,OAAO,EAAE,CAAK,CAAC,EAAE,CAAA,CAAE,CAAG,cACxC,MAAO,GAAI,EAAG,QAAQ,CAAC,QAAS,CAE9B,IAAM,EAAQ,EAAG,KAAK,CAAC,kBACvB,OAAO,EAAQ,CAAC,KAAK,EAAE,CAAK,CAAC,EAAE,CAAA,CAAE,CAAG,cACtC,MAAO,GAAI,EAAG,QAAQ,CAAC,YAAa,CAElC,IAAM,EAAQ,EAAG,KAAK,CAAC,sBACvB,OAAO,EAAQ,CAAC,QAAQ,EAAE,CAAK,CAAC,EAAE,CAAA,CAAE,CAAG,eACzC,MAAO,GAAI,EAAG,QAAQ,CAAC,YAAc,CAAC,EAAG,QAAQ,CAAC,YAAa,CAE7D,IAAM,EAAQ,EAAG,KAAK,CAAC,qBACvB,OAAO,EAAQ,CAAC,OAAO,EAAE,CAAK,CAAC,EAAE,CAAA,CAAE,CAAG,QACxC,MAAO,GAAI,EAAG,QAAQ,CAAC,aAAc,CAEnC,IAAM,EAAQ,EAAG,KAAK,CAAC,uBACvB,OAAO,EAAQ,CAAC,SAAS,EAAE,CAAK,CAAC,EAAE,CAAA,CAAE,CAAG,UAC1C,KAAiC,CAA1B,IAAI,EAAG,QAAQ,CAAC,SAKrB,MAAO,UAHP,IAAM,EAAQ,EAAG,KAAK,CAAC,kBACvB,OAAO,EAAQ,CAAC,GAAG,EAAE,CAAK,CAAC,EAAE,CAAA,CAAE,CAAG,mBACpC,CAGF,MAHS,gDAK0B,AAAC,IAElC,IAAM,EADc,AACC,EADgB,GACJ,KAAK,CAAC,cACvC,OAAO,EAAe,WAAW,CAAY,CAAC,EAAE,EAAK,CACvD,6BCpEA,EAAA,CAAA,CAAA,QACA,IAAA,EAAA,EAAA,CAAA,CAAA,QACA,EAAA,CAAA,CAAA,QAAA,IAAA,EAAA,EAAA,CAAA,CAAA,gCAI8B,CAAC,EAAoB,aAAa,IAC9D,GAAM,GAAE,CAAC,CAAE,CAAG,CAAA,EAAA,EAAA,cAAe,AAAf,EAAgB,GAE9B,MAAO,CAAA,EAAA,EAAA,WAAA,AAAW,EAAC,CAAC,EAAa,EAAU,CAAC,CAAC,GAAK,EAAE,EAAK,CAAE,aAAc,EAAK,GAAG,CAAO,AAAC,GAAI,CAAC,EAAE,CAClG,8CCVA,EAAA,EAAA,CAAA,CAAA,QACA,EAAA,EAAA,CAAA,CAAA,QACA,EAAA,EAAA,CAAA,CAAA,QACA,EAAA,EAAA,CAAA,CAAA,QACA,EAAA,EAAA,CAAA,CAAA,QAQe,SAAS,EAAM,OAAE,CAAK,OAAE,CAAK,CAAkB,EAC5D,IAAM,EAAI,CAAA,EAAA,EAAA,cAAA,AAAc,IAClB,YAAE,CAAU,CAAE,CAAG,CAAA,EAAA,EAAA,MAAA,AAAM,IACvB,CAAC,EAAa,EAAe,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAC,IAE/C,CAAA,EAAA,EAAA,SAAA,AAAS,EAAC,KACR,EAAe,CAAA,EAAA,EAAA,gBAAgB,AAAhB,EAAiB,GAClC,EAAG,CAAC,EAAW,EAEf,CAAA,EAAA,EAAA,SAAA,AAAS,EAAC,KACR,EAAA,OAAO,CAAC,gBAAgB,CAAC,GCrB3B,GAAI,CDsBgB,ACtBf,GAFmB,SAAS,SAAS,iBAEvB,CACjB,IAAM,EAAM,KAAK,GAAG,GAEhB,EADe,IACT,GADgB,eAAe,OAAO,CAAC,oBAAsB,KAChD,KACrB,GAD6B,YACd,OAAO,CAAC,kBAAmB,OAAO,IACjD,OAAO,QAAQ,CAAC,MAAM,IAEtB,QAAQ,IAAI,CAAC,qDAEjB,CDcA,EAAG,CAAC,EAAY,EAAM,EAEtB,IAAM,EAAe,KACnB,OAAO,QAAQ,CAAC,IAAI,CAAG,UACzB,EAUA,MACE,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,yCACb,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,oCACb,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,iCACb,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,qBACb,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,6CAAoC,SAGrD,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAU,qDAA4C,UAE1D,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,6CACV,EACC,+FAIJ,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,kDACb,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,0DACb,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAU,0BAAkB,EAAE,oBAClC,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,uEACV,EAAM,OAAO,GAEf,GACC,CAAA,EAAA,EAAA,IAAA,EAAC,IAAA,CAAE,UAAU,6EAAmE,YACpE,KAGb,EAAM,KAAK,EACV,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,gGACV,EAAM,KAAK,CAAC,KAAK,CAAC,MAAM,KAAK,CAAC,EAAG,GAAG,IAAI,CAAC,QAG7C,EAAM,MAAM,EACX,CAAA,EAAA,EAAA,IAAA,EAAC,IAAA,CAAE,UAAU,8EAAoE,aACpE,EAAM,MAAM,SAM/B,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,gCACb,CAAA,EAAA,EAAA,IAAA,EAAC,SAAA,CAAO,QAAS,EAAO,UAAU,mCAChC,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,eAAe,KAAK,OAAO,OAAO,eAAe,QAAQ,qBACtE,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CACC,cAAc,QACd,eAAe,QACf,YAAa,EACb,EAAE,kHAGL,EAAE,gBAGL,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,uBACb,CAAA,EAAA,EAAA,IAAA,EAAC,SAAA,CAAO,QA9DC,CA8DQ,IA7DvB,OAAO,OAAO,CAAC,MAAM,CAAG,EAC1B,CAD6B,MACtB,OAAO,CAAC,IAAI,GAEnB,GAEJ,EAwD2C,UAAU,mCACvC,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,eAAe,KAAK,OAAO,OAAO,eAAe,QAAQ,qBACtE,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CACC,cAAc,QACd,eAAe,QACf,YAAa,EACb,EAAE,kCAGL,EAAE,cAGL,CAAA,EAAA,EAAA,IAAA,EAAC,SAAA,CAAO,QAAS,EAAc,UAAU,mCACvC,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,eAAe,KAAK,OAAO,OAAO,eAAe,QAAQ,qBACtE,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CACC,cAAc,QACd,eAAe,QACf,YAAa,EACb,EAAE,uJAGL,EAAE,yBAKT,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,8CACb,CAAA,EAAA,EAAA,IAAA,EAAC,IAAA,CAAE,UAAU,yCACV,EAAE,cAAe,IAClB,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,KAAK,6BAA6B,UAAU,6BAC5C,EAAE,gCAQnB"}