module.exports=[318946,a=>{"use strict";let b=(a,b,c)=>{let d;return(...e)=>{let f=c&&!d;d&&clearTimeout(d),d=setTimeout(()=>{d=null,c||a(...e)},b),f&&a(...e)}},c=(a,b,c)=>c*(b-a)+a,d=a=>1-(1-a)*(1-a),e=(a,b,c,d=c)=>{let e=a.createRange();return e.setStart(b,c),e.setEnd(b,d),e},f=(a,b,c,d=0,g=b.nodeValue.length)=>{if(g-d==1)return 0>c(e(a,b,d),e(a,b,g))?d:g;let h=Math.floor(d+(g-d)/2),i=c(e(a,b,d,h),e(a,b,h,g));return i<0?f(a,b,c,d,h):i>0?f(a,b,c,h,g):h},{SHOW_ELEMENT:g,SHOW_TEXT:h,SHOW_CDATA_SECTION:i,FILTER_ACCEPT:j,FILTER_REJECT:k,FILTER_SKIP:l}=NodeFilter,m=g|h|i,n=a=>{let b=1/0,c=-1/0,d=1/0,e=-1/0;for(let f of a.getClientRects())d=Math.min(d,f.left),b=Math.min(b,f.top),c=Math.max(c,f.right),e=Math.max(e,f.bottom);return new DOMRect(d,b,c-d,e-b)},o=(a,b,c,d)=>{let e=a.createTreeWalker(a.body,m,{acceptNode:e=>{let f=e.localName?.toLowerCase();if("script"===f||"style"===f)return k;if(1===e.nodeType){let{left:a,right:f}=d(e.getBoundingClientRect());if(f<b||a>c)return k;if(a>=b&&f<=c)return j}else{if(!e.nodeValue?.trim())return l;let f=a.createRange();f.selectNodeContents(e);let{left:g,right:h}=d(f.getBoundingClientRect());if(h>=b&&g<=c)return j}return l}}),g=[];for(let a=e.nextNode();a;a=e.nextNode())g.push(a);let h=g[0]??a.body,i=g[g.length-1]??h,o=1===h.nodeType?0:f(a,h,(a,c)=>{let e=d(n(a)),f=d(n(c));return e.right<b&&f.left>b?0:f.left>b?-1:1}),p=1===i.nodeType?0:f(a,i,(a,b)=>{let e=d(n(a)),f=d(n(b));return e.right<c&&f.left>c?0:f.left>c?-1:1}),q=a.createRange();return q.setStart(h,o),q.setEnd(i,p),q},p=a=>{let b=document.createRange();return b.setStart(a.anchorNode,a.anchorOffset),b.setEnd(a.focusNode,a.focusOffset),b.collapsed},q=(a,b)=>{let c;if(a.startContainer?c=a.cloneRange():a.nodeType&&(c=document.createRange()).selectNode(a),c){let a=c.startContainer.ownerDocument?.defaultView.getSelection();a&&(a.removeAllRanges(),-1===b?c.collapse(!0):1===b&&c.collapse(),a.addRange(c))}},r=(a,b)=>Array.from({length:a},()=>{let a=document.createElement("div"),c=document.createElement("div");return a.append(c),c.setAttribute("part",b),a}),s=(a,b)=>{let{style:c}=a;for(let[a,d]of Object.entries(b))c.setProperty(a,d,"important")};class t{#a=new ResizeObserver(()=>this.expand());#b=document.createElement("div");#c=document.createElement("iframe");#d=document.createRange();#e;#f=!1;#g=!1;#h=!0;#i;#j={};constructor({container:a,onExpand:b}){this.container=a,this.onExpand=b,this.#c.setAttribute("part","filter"),this.#b.append(this.#c),Object.assign(this.#b.style,{boxSizing:"content-box",position:"relative",overflow:"hidden",flex:"0 0 auto",width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center"}),Object.assign(this.#c.style,{overflow:"hidden",border:"0",display:"none",width:"100%",height:"100%"}),this.#c.setAttribute("sandbox","allow-same-origin allow-scripts"),this.#c.setAttribute("scrolling","no")}get element(){return this.#b}get document(){return this.#c.contentDocument}async load(a,b,c,d){if("string"!=typeof a)throw Error(`${a} is not string`);return new Promise(e=>{this.#c.addEventListener("load",()=>{let a,b=this.document;c?.(b),this.#c.setAttribute("aria-label",b.title),this.#c.style.display="block";let{vertical:f,rtl:g}=(a=>{let{defaultView:b}=a,{writingMode:c,direction:d}=b.getComputedStyle(a.body);return{vertical:"vertical-rl"===c||"vertical-lr"===c,rtl:"rtl"===a.body.dir||"rtl"===d||"rtl"===a.documentElement.dir}})(b);this.docBackground="rgba(0, 0, 0, 0)"===(a=b.defaultView.getComputedStyle(b.body)).backgroundColor&&"none"===a.backgroundImage?b.defaultView.getComputedStyle(b.documentElement).background:a.background,b.body.style.background="none";let h=this.docBackground;this.#c.style.display="none",this.#f=f,this.#g=g,this.#d.selectNodeContents(b.body);let i=d?.({vertical:f,rtl:g,background:h});this.#c.style.display="block",this.render(i),this.#a.observe(b.body),b.fonts.ready.then(()=>this.expand()),e()},{once:!0}),b?this.#c.srcdoc=b:this.#c.src=a})}render(a){a&&this.document&&(this.#h="scrolled"!==a.flow,this.#j=a,this.#h?this.columnize(a):this.scrolled(a))}scrolled({marginTop:a,marginRight:b,marginBottom:c,marginLeft:d,gap:e,columnWidth:f}){let g=this.#f,h=this.document;s(h.documentElement,{"box-sizing":"border-box",padding:g?`${1.5*a}px ${b}px ${1.5*c}px ${d}px`:`${a}px ${e/2+b/2}px ${c}px ${e/2+d/2}px`,"column-width":"auto",height:"auto",width:"auto","--page-margin-top":`${g?1.5*a:a}px`,"--page-margin-right":`${g?b:b+e/2}px`,"--page-margin-bottom":`${g?1.5*c:c}px`,"--page-margin-left":`${g?d:d+e/2}px`,"--available-width":`${Math.trunc(Math.min(window.innerWidth,f)-d-b-e-60)}`,"--available-height":`${Math.trunc(window.innerHeight-a-c)}`}),s(h.body,{[g?"max-height":"max-width"]:`${f}px`,margin:"auto"}),this.setImageSize(),this.expand()}columnize({width:a,height:b,marginTop:c,marginRight:d,marginBottom:e,marginLeft:f,gap:g,columnWidth:h}){let i=this.#f;this.#i=i?b:a;let j=this.document;s(j.documentElement,{"box-sizing":"border-box","column-width":`${Math.trunc(h)}px`,"column-gap":i?`${(c+e)*1.5}px`:`${g+d/2+f/2}px`,"column-fill":"auto",...i?{width:`${a}px`}:{height:`${b}px`},padding:i?`${1.5*c}px ${d}px ${1.5*e}px ${f}px`:`${c}px ${g/2+d/2}px ${e}px ${g/2+f/2}px`,overflow:"hidden","overflow-wrap":"break-word",position:"static",border:"0",margin:"0","max-height":"none","max-width":"none","min-height":"none","min-width":"none","-webkit-line-box-contain":"block glyphs replaced","--page-margin-top":`${i?1.5*c:c}px`,"--page-margin-right":`${i?d:d/2+g/2}px`,"--page-margin-bottom":`${i?1.5*e:e}px`,"--page-margin-left":`${i?f:f/2+g/2}px`,"--available-width":`${Math.trunc(h-f-d-g)}`,"--available-height":`${Math.trunc(b-c-e)}`}),s(j.body,{"max-height":"none","max-width":"none",margin:"0"}),this.setImageSize(),this.expand()}setImageSize(){let{width:a,height:b,marginTop:c,marginRight:d,marginBottom:e,marginLeft:f}=this.#j,g=this.#f,h=this.document;for(let i of h.body.querySelectorAll("img, svg, video")){let{maxHeight:j,maxWidth:k}=h.defaultView.getComputedStyle(i);s(i,{"max-height":g?"none"!==j&&"0px"!==j?j:"100%":`${b-c-e}px`,"max-width":g?`${a-f-d}px`:"none"!==k&&"0px"!==k?k:"100%","object-fit":"contain","page-break-inside":"avoid","break-inside":"avoid","box-sizing":"border-box"})}}get #k(){return/^((?!chrome|android).)*AppleWebKit/i.test(navigator.userAgent)&&!window.chrome&&window.getComputedStyle(this.document.body).zoom||1}expand(){if(!this.document)return;let{documentElement:a}=this.document;if(this.#h){let b=this.#f?"height":"width",c=this.#f?"width":"height",d=this.#d.getBoundingClientRect(),e=a.getBoundingClientRect(),f=Math.ceil(((this.#f?0:this.#g?e.right-d.right:d.left-e.left)+d[b])*this.#k/this.#i)*this.#i;this.#b.style.padding="0",this.#c.style[b]=`${f}px`,this.#b.style[b]=`${f+2*this.#i}px`,this.#c.style[c]="100%",this.#b.style[c]="100%",a.style[b]=`${this.#i}px`,this.#e&&(this.#e.element.style.margin="0",this.#e.element.style.left=this.#f?"0":`${this.#i}px`,this.#e.element.style.top=this.#f?`${this.#i}px`:"0",this.#e.element.style[b]=`${f}px`,this.#e.redraw())}else{let b=this.#f?"width":"height",c=this.#f?"height":"width",d=a.getBoundingClientRect()[b];this.#b.style.padding="0",this.#c.style[b]=`${d}px`,this.#b.style[b]=`${d}px`,this.#c.style[c]="100%",this.#b.style[c]="100%",this.#e&&(this.#e.element.style.margin="0",this.#e.element.style.left="0",this.#e.element.style.top="0",this.#e.element.style[b]=`${d}px`,this.#e.redraw())}this.onExpand()}set overlayer(a){this.#e=a,this.#b.append(a.element)}get overlayer(){return this.#e}destroy(){this.document&&this.#a.unobserve(this.document.body)}}class u extends HTMLElement{static observedAttributes=["flow","gap","margin-top","margin-bottom","margin-left","margin-right","max-inline-size","max-block-size","max-column-count"];#l=this.attachShadow({mode:"open"});#a=new ResizeObserver(()=>this.render());#m;#n;#o;#p;#q;#r;#f=!1;#g=!1;#s=0;#t=0;#u=-1;#v=0;#w=!1;#x=!1;#y;#z=new WeakMap;#A=matchMedia("(prefers-color-scheme: dark)");#B;#C;#D;#E;#F;#G=!1;constructor(){super(),this.#l.innerHTML=`<style>
        :host {
            display: block;
            container-type: size;
        }
        :host, #top {
            box-sizing: border-box;
            position: relative;
            overflow: hidden;
            width: 100%;
            height: 100%;
        }
        #top {
            --_gap: 7%;
            --_margin-top: 48px;
            --_margin-right: 48px;
            --_margin-bottom: 48px;
            --_margin-left: 48px;
            --_max-inline-size: 720px;
            --_max-block-size: 1440px;
            --_max-column-count: 2;
            --_max-column-count-portrait: var(--_max-column-count);
            --_max-column-count-spread: var(--_max-column-count);
            --_half-gap: calc(var(--_gap) / 2);
            --_half-margin-left: calc(var(--_margin-left) / 2);
            --_half-margin-right: calc(var(--_margin-right) / 2);
            --_max-width: calc(var(--_max-inline-size) * var(--_max-column-count-spread));
            --_max-height: var(--_max-block-size);
            display: grid;
            grid-template-columns:
                minmax(0, 1fr)
                var(--_margin-left)
                minmax(0, calc(var(--_max-width) - var(--_gap)))
                var(--_margin-right)
                minmax(0, 1fr);
            grid-template-rows:
                minmax(var(--_margin-top), 1fr)
                minmax(0, var(--_max-height))
                minmax(var(--_margin-bottom), 1fr);
            &.vertical {
                --_max-column-count-spread: var(--_max-column-count-portrait);
                --_max-width: var(--_max-block-size);
                --_max-height: calc(var(--_max-inline-size) * var(--_max-column-count-spread));
            }
            @container (orientation: portrait) {
                & {
                    --_max-column-count-spread: var(--_max-column-count-portrait);
                }
                &.vertical {
                    --_max-column-count-spread: var(--_max-column-count);
                }
            }
        }
        #background {
            grid-column: 1 / -1;
            grid-row: 1 / -1;
        }
        #container {
            grid-column: 2 / 5;
            grid-row: 1 / -1;
            overflow: hidden;
        }
        :host([flow="scrolled"]) #container {
            grid-column: 2 / 5;
            grid-row: 1 / -1;
            overflow: auto;
        }
        #header {
            grid-column: 3 / 4;
            grid-row: 1;
        }
        #footer {
            grid-column: 3 / 4;
            grid-row: 3;
            align-self: end;
        }
        #header {
            display: grid;
            height: var(--_margin-top);
        }
        #footer {
            display: grid;
            height: var(--_margin-bottom);
        }
        :is(#header, #footer) > * {
            display: flex;
            align-items: center;
            min-width: 0;
        }
        :is(#header, #footer) > * > * {
            width: 100%;
            overflow: hidden;
            white-space: nowrap;
            text-overflow: ellipsis;
            text-align: center;
            font-size: .75em;
            opacity: .6;
        }
        </style>
        <div id="top">
            <div id="background" part="filter"></div>
            <div id="header"></div>
            <div id="container" part="container"></div>
            <div id="footer"></div>
        </div>
        `,this.#m=this.#l.getElementById("top"),this.#n=this.#l.getElementById("background"),this.#o=this.#l.getElementById("container"),this.#p=this.#l.getElementById("header"),this.#q=this.#l.getElementById("footer"),this.#a.observe(this.#o),this.#o.addEventListener("scroll",()=>this.dispatchEvent(new Event("scroll"))),this.#o.addEventListener("scroll",b(()=>{this.scrolled&&(this.#w?this.#w=!1:this.#H("scroll"))},250));const a={passive:!1};this.addEventListener("touchstart",this.#I.bind(this),a),this.addEventListener("touchmove",this.#J.bind(this),a),this.addEventListener("touchend",this.#K.bind(this)),this.addEventListener("load",({detail:{doc:b}})=>{b.addEventListener("touchstart",this.#I.bind(this),a),b.addEventListener("touchmove",this.#J.bind(this),a),b.addEventListener("touchend",this.#K.bind(this))}),this.addEventListener("relocate",({detail:a})=>{"selection"===a.reason?q(this.#v,0):"navigation"===a.reason&&(1===this.#v?q(a.range,1):"number"==typeof this.#v?q(a.range,-1):q(this.#v,-1))});const c=b((a,b)=>{if(!b.rangeCount)return;let c=b.getRangeAt(0),d=p(b);d&&0>c.compareBoundaryPoints(Range.START_TO_START,a)?this.prev():!d&&c.compareBoundaryPoints(Range.END_TO_END,a)>0&&this.next()},700);this.addEventListener("load",({detail:{doc:a}})=>{let b=!1;a.addEventListener("pointerdown",()=>b=!0),a.addEventListener("pointerup",()=>b=!1);let d=!1;a.addEventListener("keydown",()=>d=!0),a.addEventListener("keyup",()=>d=!1),a.addEventListener("selectionchange",()=>{if(this.scrolled)return;let e=this.#F;if(!e)return;let f=a.getSelection();if(f.rangeCount){if(!b&&b&&"Range"===f.type)c(e,f);else if(d){let a=f.getRangeAt(0).cloneRange();p(f)||a.collapse(),this.#L(a)}}}),a.addEventListener("focusin",a=>{if(this.scrolled)return null;this.#o&&this.#o.contains(a.target)&&requestAnimationFrame(()=>this.#L(a.target))})}),this.#B=()=>{this.#r&&this.#M(this.#r.docBackground,this.columnCount)},this.#A.addEventListener("change",this.#B)}attributeChangedCallback(a,b,c){switch(a){case"flow":this.render();break;case"gap":case"margin-top":case"margin-bottom":case"margin-left":case"margin-right":case"max-block-size":case"max-column-count":case"max-inline-size":this.#m.style.setProperty("--_"+a,c),this.render()}}open(a){this.bookDir=a.dir,this.sections=a.sections,a.transformTarget?.addEventListener("data",({detail:a})=>{"text/css"===a.type&&(a.data=Promise.resolve(a.data).then(a=>a.replace(/([{\s;])-epub-/gi,"$1").replace(/page-break-(after|before|inside)\s*:/gi,(a,b)=>`-webkit-column-break-${b}:`).replace(/break-(after|before|inside)\s*:\s*(avoid-)?page/gi,(a,b,c)=>`break-${b}: ${c??""}column`)))})}#N(){return this.#r&&(this.#r.destroy(),this.#o.removeChild(this.#r.element)),this.#r=new t({container:this,onExpand:()=>this.#L(this.#v)}),this.#o.append(this.#r.element),this.#r}#M(a,b){let c=this.#r?.document;if(!c)return;let d=c.defaultView.getComputedStyle(c.documentElement),e=d.getPropertyValue("--theme-bg-color"),f="true"===d.getPropertyValue("--override-color"),g=d.getPropertyValue("--bg-texture-id"),h="dark"===d.getPropertyValue("color-scheme");if(a&&e){let b=a.split(/\s(?=(?:url|rgb|hsl|#[0-9a-fA-F]{3,6}))/);(h||f)&&("none"===g||!g)&&(b[0]=e),a=b.join(" ")}this.#n.innerHTML="",this.#n.style.display="grid",this.#n.style.gridTemplateColumns=`repeat(${b}, 1fr)`;for(let c=0;c<b;c++){let b=document.createElement("div");b.style.background=a,b.style.width="100%",b.style.height="100%",this.#n.appendChild(b)}}#O({vertical:a,rtl:b,background:c}){this.#f=a,this.#g=b,this.#m.classList.toggle("vertical",a);let{width:d,height:e}=this.#o.getBoundingClientRect(),f=a?e:d,g=getComputedStyle(this.#m),h=parseFloat(g.getPropertyValue("--_max-inline-size")),i=parseInt(g.getPropertyValue("--_max-column-count-spread")),j=parseFloat(g.getPropertyValue("--_margin-top")),k=parseFloat(g.getPropertyValue("--_margin-right")),l=parseFloat(g.getPropertyValue("--_margin-bottom")),m=parseFloat(g.getPropertyValue("--_margin-left"));this.#s=j,this.#t=l;let n=parseFloat(g.getPropertyValue("--_gap"))/100,o=-n/(n-1)*f,p=this.getAttribute("flow");if("scrolled"===p)return this.setAttribute("dir",a?"rtl":"ltr"),this.#m.style.padding="0",this.heads=null,this.feet=null,this.#p.replaceChildren(),this.#q.replaceChildren(),{flow:p,marginTop:j,marginRight:k,marginBottom:l,marginLeft:m,gap:o,columnWidth:h};let q=Math.min(i+ +!!a,Math.ceil(Math.floor(f)/Math.floor(h))),s=a?f/q-1.5*j-1.5*l:f/q-o-k/2-m/2;this.setAttribute("dir",b?"rtl":"ltr"),this.columnCount=q,this.#M(c,this.columnCount);let t=a?Math.min(2,Math.ceil(Math.floor(d)/Math.floor(h))):q,u={gridTemplateColumns:`repeat(${t}, 1fr)`,gap:`${o}px`,direction:"rtl"===this.bookDir?"rtl":"ltr"};Object.assign(this.#p.style,u),Object.assign(this.#q.style,u);let v=r(t,"head"),w=r(t,"foot");return this.heads=v.map(a=>a.children[0]),this.feet=w.map(a=>a.children[0]),this.#p.replaceChildren(...v),this.#q.replaceChildren(...w),{height:e,width:d,marginTop:j,marginRight:k,marginBottom:l,marginLeft:m,gap:o,columnWidth:s}}render(){this.#r&&(this.#r.render(this.#O({vertical:this.#f,rtl:this.#g,background:this.#r.docBackground})),this.#L(this.#v))}get scrolled(){return"scrolled"===this.getAttribute("flow")}get scrollProp(){let{scrolled:a}=this;return this.#f?a?"scrollLeft":"scrollTop":a?"scrollTop":"scrollLeft"}get sideProp(){let{scrolled:a}=this;return this.#f?a?"width":"height":a?"height":"width"}get size(){return this.#o.getBoundingClientRect()[this.sideProp]}get viewSize(){return this.#r&&this.#r.element?this.#r.element.getBoundingClientRect()[this.sideProp]:0}get start(){return Math.abs(this.#o[this.scrollProp])}get end(){return this.start+this.size}get page(){return Math.floor((this.start+this.end)/2/this.size)}get pages(){return Math.round(this.viewSize/this.size)}get containerPosition(){return this.#o[this.scrollProp]}get isOverflowX(){return!1}get isOverflowY(){return!1}set containerPosition(a){this.#o[this.scrollProp]=a}set scrollLocked(a){this.#G=a}scrollBy(a,b){let c=this.#f?b:a,[d,e,f]=this.#C,g=this.#g;this.containerPosition=Math.max(g?d-f:d-e,Math.min(g?d+e:d+f,this.containerPosition+c))}snap(a,b){let c=this.#f?b:a,d=2*Math.abs(a)>Math.abs(b),e=this.#f?!d:d,[f,g,h]=this.#C,{start:i,end:j,pages:k,size:l}=this,m=Math.abs(f)-g,n=Math.abs(f)+h,o=c*(this.#g?-l:l)*!!e,p=Math.floor(Math.max(m,Math.min(n,(i+j)/2+(isNaN(o)?0:2*o)))/l);this.#P(p,"snap").then(()=>{let a=p<=0?-1:p>=k-1?1:null;if(a)return this.#Q({index:this.#R(a),anchor:a<0?()=>1:()=>0})})}#I(a){let b=a.changedTouches[0];this.#D={x:b?.screenX,y:b?.screenY,t:a.timeStamp,vx:0,xy:0,dx:0,dy:0}}#J(a){let b=this.#D;if(b.pinched||(b.pinched=globalThis.visualViewport.scale>1,this.scrolled||b.pinched))return;if(a.touches.length>1){this.#E&&a.preventDefault();return}let c=this.#r?.document,d=c?.getSelection();if(d&&d.rangeCount>0&&!d.isCollapsed)return;let e=a.changedTouches[0],f="stylus"===e.touchType;if(f||a.preventDefault(),this.#G)return;let g=e.screenX,h=e.screenY,i=b.x-g,j=b.y-h,k=a.timeStamp-b.t;b.x=g,b.y=h,b.t=a.timeStamp,b.vx=i/k,b.vy=j/k,b.dx+=i,b.dy+=j,this.#E=!0,!(!this.hasAttribute("animated")||this.hasAttribute("eink"))&&(!this.#f&&Math.abs(b.dx)>=Math.abs(b.dy)&&!this.hasAttribute("eink")&&(!f||Math.abs(i)>1)?this.scrollBy(i,0):this.#f&&Math.abs(b.dx)<Math.abs(b.dy)&&!this.hasAttribute("eink")&&(!f||Math.abs(j)>1)&&this.scrollBy(0,j))}#K(){!this.#E||(this.#E=!1,this.scrolled||requestAnimationFrame(()=>{1===globalThis.visualViewport.scale&&this.snap(this.#D.vx,this.#D.vy)}))}#S(){if(this.scrolled){let a=this.viewSize,b=this.#s,c=this.#t;return this.#f?({left:d,right:e})=>({left:a-e-b,right:a-d-c}):({top:a,bottom:d})=>({left:a-b,right:d-c})}let a=this.pages*this.size;return this.#g?({left:b,right:c})=>({left:a-c,right:a-b}):this.#f?({top:a,bottom:b})=>({left:a,right:b}):a=>a}async #T(a,b){if(this.scrolled){let c=this.#S()(a).left-4;return this.#U(c,b)}let c=this.#S()(a).left;return this.#P(Math.floor(c/this.size)+(this.#g?-1:1),b)}async #U(a,b,e){let{size:f}=this;if(this.containerPosition===a){this.#C=[a,this.atStart?0:f,this.atEnd?0:f],this.#H(b);return}if(this.scrolled&&this.#f&&(a=-a),("snap"===b||e)&&this.hasAttribute("animated")&&!this.hasAttribute("eink")){let e,g,h;return(e=this.containerPosition,g=a,h=a=>this.containerPosition=a,new Promise(a=>{let b,f=i=>{if(document.hidden)return h(c(e,g,1)),a();b??=i;let j=Math.min(1,(i-b)/300);h(c(e,g,d(j))),j<1?requestAnimationFrame(f):a()};if(document.hidden)return h(c(e,g,1)),a();requestAnimationFrame(f)})).then(()=>{this.#C=[a,this.atStart?0:f,this.atEnd?0:f],this.#H(b)})}this.containerPosition=a,this.#C=[a,this.atStart?0:f,this.atEnd?0:f],this.#H(b)}async #P(a,b,c){let d=this.size*(this.#g?-a:a);return this.#U(d,b,c)}async scrollToAnchor(a,b){return this.#L(a,b?"selection":"navigation")}async #L(a,b="anchor"){this.#v=a;let c=(a=>{if(!a?.collapsed)return a;let{endOffset:b,endContainer:c}=a;if(1===c.nodeType){let a=c.childNodes[b];return a?.nodeType===1?a:c}if(b+1<c.length)a.setEnd(c,b+1);else{if(!(b>1))return c.parentNode;a.setStart(c,b-1)}return a})(a)?.getClientRects?.();if(c){let d=Array.from(c).find(a=>a.width>0&&a.height>0&&a.x>=0&&a.y>=0)||c[0];if(!d)return;if(await this.#T(d,b),"navigation"===b){let b=a.focus?a:void 0;!b&&a.startContainer&&(b=a.startContainer).nodeType===Node.TEXT_NODE&&(b=b.parentElement),b&&b.focus&&(b.tabIndex=-1,b.style.outline="none",b.focus({preventScroll:!0}))}return}if(this.scrolled)return void await this.#U(a*this.viewSize,b);let{pages:d}=this;if(!d)return;let e=Math.round(a*(d-2-1));await this.#P(e+1,b)}#V(){if(this.scrolled)return o(this.#r.document,this.start,this.end,this.#S());let a=this.#g?-this.size:this.size;return o(this.#r.document,this.start-a,this.end-a,this.#S())}#H(a){let b=this.#V();this.#F=b,"selection"!==a&&"navigation"!==a&&"anchor"!==a?this.#v=b:this.#w=!0;let c={reason:a,range:b,index:this.#u};if(this.scrolled)c.fraction=this.start/this.viewSize;else if(this.pages>0){let{page:a,pages:b}=this;this.#p.style.visibility=a>1?"visible":"hidden",c.fraction=(a-1)/(b-2),c.size=1/(b-2)}this.dispatchEvent(new CustomEvent("relocate",{detail:c}))}async #W(a){let{index:b,src:c,data:d,anchor:e,onLoad:f,select:g}=await a;this.#u=b;let h=this.#r?.document?.hasFocus();if(c){let a=this.#N(),e=a=>{if(a.head){let b=a.createElement("style");a.head.prepend(b);let c=a.createElement("style");a.head.append(c),this.#z.set(a,[b,c])}f?.({doc:a,index:b})},g=this.#O.bind(this);await a.load(c,d,e,g),this.dispatchEvent(new CustomEvent("create-overlayer",{detail:{doc:a.document,index:b,attach:b=>a.overlayer=b}})),this.#r=a}await this.scrollToAnchor(("function"==typeof e?e(this.#r.document):e)??0,g),h&&this.focusView()}#X(a){return a>=0&&a<=this.sections.length-1}async #Q({index:a,anchor:b,select:c}){if(a===this.#u)await this.#W({index:a,anchor:b,select:c});else{let d=this.#u,e=a=>{this.sections[d]?.unload?.(),this.setStyles(this.#y),this.dispatchEvent(new CustomEvent("load",{detail:a}))};await this.#W(Promise.resolve(this.sections[a].load()).then(async d=>{let f=await this.sections[a].loadContent?.();return{index:a,src:d,data:f,anchor:b,onLoad:e,select:c}}).catch(b=>(console.warn(b),console.warn(Error(`Failed to load section ${a}`)),{})))}}async goTo(a){if(this.#x)return;let b=await a;if(this.#X(b.index))return this.#Q(b)}#Y(a){if(!this.#r)return!0;if(this.scrolled)return this.start>0?this.#U(Math.max(0,this.start-(a??this.size)),null,!0):!this.atStart;if(this.atStart)return;let b=this.page-1;return this.#P(b,"page",!0).then(()=>b<=0)}#Z(a){if(!this.#r)return!0;if(this.scrolled)return this.viewSize-this.end>2?this.#U(Math.min(this.viewSize,a?this.start+a:this.end),null,!0):!this.atEnd;if(this.atEnd)return;let b=this.page+1,c=this.pages;return this.#P(b,"page",!0).then(()=>b>=c-1)}get atStart(){return null==this.#R(-1)&&this.page<=1}get atEnd(){return null==this.#R(1)&&this.page>=this.pages-2}#R(a){for(let b=this.#u+a;this.#X(b);b+=a)if(this.sections[b]?.linear!=="no")return b}async #$(a,b){if(this.#x)return;this.#x=!0;let c=-1===a,d=await (c?this.#Y(b):this.#Z(b));d&&await this.#Q({index:this.#R(a),anchor:c?()=>1:()=>0}),(d||!this.hasAttribute("animated"))&&await new Promise(a=>setTimeout(a,100)),this.#x=!1}async prev(a){return await this.#$(-1,a)}async next(a){return await this.#$(1,a)}async pan(a,b){this.#x||(this.#x=!0,this.scrollBy(a,b),this.#x=!1)}prevSection(){return this.goTo({index:this.#R(-1)})}nextSection(){return this.goTo({index:this.#R(1)})}firstSection(){let a=this.sections.findIndex(a=>"no"!==a.linear);return this.goTo({index:a})}lastSection(){let a=this.sections.findLastIndex(a=>"no"!==a.linear);return this.goTo({index:a})}getContents(){return this.#r?[{index:this.#u,overlayer:this.#r.overlayer,doc:this.#r.document}]:[]}setStyles(a){this.#y=a;let b=this.#z.get(this.#r?.document);if(!b)return;let[c,d]=b;if(Array.isArray(a)){let[b,e]=a;c.textContent=b,d.textContent=e}else d.textContent=a;requestAnimationFrame(()=>{this.#M(this.#r.docBackground,this.columnCount)}),this.#r?.document?.fonts?.ready?.then(()=>this.#r.expand())}focusView(){this.#r.document.defaultView.focus()}destroy(){this.#a.unobserve(this),this.#r.destroy(),this.#r=null,this.sections[this.#u]?.unload?.(),this.#A.removeEventListener("change",this.#B)}}customElements.define("foliate-paginator",u),a.s(["Paginator",()=>u])}];

//# sourceMappingURL=packages_foliate-js_paginator_728db84f.js.map