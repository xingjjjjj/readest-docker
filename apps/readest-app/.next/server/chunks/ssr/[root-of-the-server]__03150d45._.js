module.exports=[887287,a=>{"use strict";let b,c=(a,b)=>[-1,...b,a.length].reduce(({xs:b,a:c},d)=>({xs:b?.concat([a.slice(c+1,d)])??[],a:d}),{}).xs,d=/\d/,e=/^epubcfi\((.*)\)$/,f=a=>a.replace(/[\^[\](),;=]/g,"^$&"),g=a=>e.test(a)?a:`epubcfi(${a})`,h=(b=(...a)=>a.join("!"),(...a)=>`epubcfi(${b(...a.map(a=>a.match(e)?.[1]??a))})`),i=(a,b)=>{let c;return c=([a])=>a===b,a.map((a,b,d)=>c(a,b,d)?b:null).filter(a=>null!=a)},j=a=>{let b,c=[];for(let[d,e]of a){if("/"===d)c.push({index:e});else{let a=c[c.length-1];if(":"===d)a.offset=e;else if("~"===d)a.temporal=e;else if("@"===d)a.spatial=(a.spatial??[]).concat(e);else if(";s"===d)a.side=e;else if("["===d)if("/"===b&&e)a.id=e;else{a.text=(a.text??[]).concat(e);continue}}b=d}return c},k=a=>c(a,i(a,"!")).map(j),l=a=>{let b=(a=>{let b=[],c,e,f="",g=a=>(b.push(a),c=null,f=""),h=a=>(f+=a,e=!1);for(let b of Array.from(a.trim()).concat("")){if("^"===b&&!e){e=!0;continue}if("!"===c)g(["!"]);else if(","===c)g([","]);else if("/"===c||":"===c)if(d.test(b)){h(b);continue}else g([c,parseInt(f)]);else if("~"===c)if(d.test(b)||"."===b){h(b);continue}else g(["~",parseFloat(f)]);else if("@"===c){if(":"===b){g(["@",parseFloat(f)]),c="@";continue}if(d.test(b)||"."===b){h(b);continue}g(["@",parseFloat(f)])}else if("["===c){";"!==b||e?","!==b||e?"]"!==b||e?h(b):g(["[",f]):(g(["[",f]),c="["):(g(["[",f]),c=";");continue}else if(c?.startsWith(";")){"="!==b||e?";"!==b||e?"]"!==b||e?h(b):g([c,f]):(g([c,f]),c=";"):(c=`;${f}`,f="");continue}("/"===b||":"===b||"~"===b||"@"===b||"["===b||"!"===b||","===b)&&(c=b)}return b})(a.match(e)?.[1]??a),f=i(b,",");if(!f.length)return k(b);let[g,h,j]=c(b,f).map(k);return{parent:g,start:h,end:j}},m=({index:a,id:b,offset:c,temporal:d,spatial:e,text:g,side:h})=>{let i=h?`;s=${h}`:"";return`/${a}`+(b?`[${f(b)}${i}]`:"")+(null!=c&&a%2?`:${c}`:"")+(d?`~${d}`:"")+(e?`@${e.join(":")}`:"")+(g||!b&&h?"["+(g?.map(f)?.join(",")??"")+i+"]":"")},n=a=>a.parent?[a.parent,a.start,a.end].map(n).join(","):a.map(a=>a.map(m).join("")).join("!"),o=a=>g(n(a)),p=(a,b)=>{let c,d;return"string"==typeof a?o(p(l(a),b)):a.parent?(c=a.parent,d=a[b?"end":"start"],c.slice(0,-1).concat([c[c.length-1].concat(d[0])]).concat(d.slice(1))):a},q=(a,b)=>{"string"==typeof a&&(a=l(a)),"string"==typeof b&&(b=l(b)),a=p(a),b=p(b,!0);let c=a[a.length-1],d=b[b.length-1],e=[],f=[],g=[],h=!0,i=Math.max(c.length,d.length);for(let a=0;a<i;a++){let b=c[a],i=d[a];(h&&=b?.index===i?.index&&!b?.offset&&!i?.offset)?e.push(b):(b&&f.push(b),i&&g.push(i))}return o({parent:a.slice(0,-1).concat([e]),start:[f],end:[g]})},r=(a,b)=>{if("string"==typeof a&&(a=l(a)),"string"==typeof b&&(b=l(b)),a.start||b.start)return r(p(a),p(b))||r(p(a,!0),p(b,!0));for(let c=0;c<Math.max(a.length,b.length);c++){let d=a[c]??[],e=b[c]??[],f=Math.max(d.length,e.length)-1;for(let a=0;a<=f;a++){let b=d[a],c=e[a];if(!b)return -1;if(!c||b.index>c.index)return 1;if(b.index<c.index)return -1;if(a===f){if(b.offset>c.offset)return 1;if(b.offset<c.offset)return -1}}}return 0},s=({nodeType:a})=>3===a||4===a,t=(a,b)=>{let c=Array.from(a.childNodes).filter(a=>s(a)||(({nodeType:a})=>1===a)(a));return b?c.map(a=>{let c=b(a);return c===NodeFilter.FILTER_REJECT?null:c===NodeFilter.FILTER_SKIP?t(a,b):a}).flat().filter(a=>a):c},u=(a,b)=>{let c=t(a,b).reduce((a,b)=>{let c=a[a.length-1];return c?s(b)?Array.isArray(c)?c.push(b):s(c)?a[a.length-1]=[c,b]:a.push(b):(({nodeType:a})=>1===a)(c)?a.push(null,b):a.push(b):a.push(b),a},[]);return(({nodeType:a})=>1===a)(c[0])&&c.unshift("first"),(({nodeType:a})=>1===a)(c[c.length-1])&&c.push("last"),c.unshift("before"),c.push("after"),c},v=(a,b,c)=>{let{id:d}=b[b.length-1];if(d){let b=a.ownerDocument.getElementById(d);if(b)return{node:b,offset:0}}for(let{index:d}of b){let b=a?u(a,c)[d]:null;if("first"===b)return{node:a.firstChild??a};if("last"===b)return{node:a.lastChild??a};if("before"===b)return{node:a,before:!0};if("after"===b)return{node:a,after:!0};a=b}let{offset:e}=b[b.length-1];if(!Array.isArray(a))return{node:a,offset:e};let f=0;for(let b of a){let{length:a}=b.nodeValue;if(f+a>=e)return{node:b,offset:e-f};f+=a}},w=(a,b,c)=>{let{parentNode:d,id:e}=a,f=u(d,c),g=f.findIndex(b=>Array.isArray(b)?b.some(b=>b===a):b===a),h=f[g];if(Array.isArray(h)){let c=0;for(let d of h)if(d===a){c+=b;break}else c+=d.nodeValue.length;b=c}let i={id:e,index:g,offset:b};return(d!==a.ownerDocument.documentElement?w(d,null,c).concat(i):[i]).filter(a=>-1!==a.index)},x={fromIndex:a=>g(`/6/${(a+1)*2}`),toIndex:a=>a?.at(-1).index/2-1};a.s(["collapse",0,p,"compare",0,r,"fake",0,x,"fromCalibreHighlight",0,({spine_index:a,start_cfi:b,end_cfi:c})=>{let d=x.fromIndex(a)+"!";return q(d+b.slice(2),d+c.slice(2))},"fromCalibrePos",0,a=>{let[b]=l(a),c=b.shift();return b.shift(),o([[{index:6},c],b])},"fromElements",0,a=>{let b=[],{parentNode:c}=a[0],d=w(c);for(let[e,f]of u(c).entries()){let c=a[b.length];f===c&&b.push(o([d.concat({id:c.id,index:e})]))}return b},"fromRange",0,(a,b)=>{let{startContainer:c,startOffset:d,endContainer:e,endOffset:f}=a,g=w(c,d,b);return a.collapsed?o([g]):q([g],[w(e,f,b)])},"isCFI",0,e,"joinIndir",0,h,"parse",0,l,"toElement",0,(a,b)=>v(a.documentElement,p(b)).node,"toRange",0,(a,b,c)=>{let d=p(b),e=p(b,!0),f=a.documentElement,g=v(f,d[0],c),h=v(f,e[0],c),i=a.createRange();return g.before?i.setStartBefore(g.node):g.after?i.setStartAfter(g.node):i.setStart(g.node,g.offset),h.before?i.setEndBefore(h.node):h.after?i.setEndAfter(h.node):i.setEnd(h.node,h.offset),i}])},632084,a=>a.a(async(b,c)=>{try{let b=await a.y("franc-min");a.n(b),c()}catch(a){c(a)}},!0),555195,a=>a.a(async(b,c)=>{try{let b=await a.y("iso-639-2");a.n(b),c()}catch(a){c(a)}},!0),499492,a=>a.a(async(b,c)=>{try{let b=await a.y("iso-639-3");a.n(b),c()}catch(a){c(a)}},!0),696351,a=>a.a(async(b,c)=>{try{let b=await a.y("uuid");a.n(b),c()}catch(a){c(a)}},!0),57823,a=>{"use strict";var b=a.i(465863),c=a.i(750740),d=a.i(654617);let e=async()=>"";a.s(["apiFileSystem",0,{resolvePath:(a,b)=>{let c="undefined"!=typeof process;switch("undefined"!=typeof process&&console.log("[ResolvePath] Env Check - NEXT_PUBLIC_STORAGE_MODE:","local","isLocalMode:",c,"base:",b,"path:",a),b){case"Data":return{baseDir:0,basePrefix:e,fp:`${d.DATA_SUBDIR}/${a}`,base:b};case"Settings":return{baseDir:0,basePrefix:e,fp:`.readest/${a}`,base:b};case"Books":if("library.json"===a||"library.json.bak"===a||"library_backup.json"===a)return console.log("[ResolvePath] Books/Library detected, routing to .readest"),{baseDir:0,basePrefix:e,fp:`.readest/${a}`,base:b};return console.log("[ResolvePath] ✓ Books base, flat path (no prefix):",a),console.log("[ResolvePath] ✓ Returning fp:",a),{baseDir:0,basePrefix:e,fp:a,base:b};case"Fonts":return{baseDir:0,basePrefix:e,fp:`${d.LOCAL_FONTS_SUBDIR}/${a}`,base:b};case"Images":return{baseDir:0,basePrefix:e,fp:`${d.LOCAL_IMAGES_SUBDIR}/${a}`,base:b};case"None":return{baseDir:0,basePrefix:e,fp:a,base:b};default:return{baseDir:0,basePrefix:e,fp:`${b}/${a}`,base:b}}},async getPrefix(a){let{basePrefix:b,fp:c}=this.resolvePath("",a),d=await b();return(c?d?`${d}/${c}`:c:d).replace(/\/+$/,"")},getURL:a=>(0,b.isValidURL)(a)?a:`/api/storage/file?filePath=${encodeURIComponent(a)}`,async getBlobURL(a,b){try{let c=await this.readFile(a,b,"binary");return URL.createObjectURL(new Blob([c]))}catch{return a}},async getImageURL(a){return this.getURL(a)},async openFile(a,d,e){if((0,b.isValidURL)(a))return await new c.RemoteFile(a,e).open();let{fp:f}=this.resolvePath(a,d),g=await fetch(`/api/storage/file?filePath=${encodeURIComponent(f)}`);if(!g.ok)throw Error("File not found");return new File([await g.arrayBuffer()],e||a)},async copyFile(a,b,c){let d=await this.openFile(a,c);await this.writeFile(b,c,d)},async readFile(a,b,c){let{fp:d}=this.resolvePath(a,b),e=await fetch(`/api/storage/file?filePath=${encodeURIComponent(d)}`);if(!e.ok)throw Error(`File not found: ${d}`);return"text"===c?await e.text():await e.arrayBuffer()},async writeFile(a,b,c){let d,{fp:e}=this.resolvePath(a,b);if(console.log("[APIFileSystem.writeFile] 11. Input path:",a),console.log("[APIFileSystem.writeFile] 12. Base:",b),console.log("[APIFileSystem.writeFile] 13. Resolved fp:",e),d=c instanceof File?Buffer.from(await c.arrayBuffer()):Buffer.from(c),console.log("[APIFileSystem.writeFile] 14. Calling PUT /api/storage/file with filePath:",e),!(await fetch(`/api/storage/file?filePath=${encodeURIComponent(e)}`,{method:"PUT",body:d})).ok)throw Error("Failed to write file")},async removeFile(a,b){let{fp:c}=this.resolvePath(a,b);if(!(await fetch(`/api/storage/delete?fileKey=${encodeURIComponent(c)}`,{method:"DELETE"})).ok)throw Error("Failed to delete file")},async createDir(a,b){},async removeDir(a,b){},readDir:async(a,b)=>[],async exists(a,b){let{fp:c}=this.resolvePath(a,b);return(await fetch(`/api/storage/file?filePath=${encodeURIComponent(c)}`)).ok},async stats(a,b){let{fp:c}=this.resolvePath(a,b),d=await fetch(`/api/storage/file?filePath=${encodeURIComponent(c)}`);if(!d.ok)throw Error("File not found");return{isFile:!0,isDirectory:!1,size:(await d.arrayBuffer()).byteLength,mtime:null,atime:null,birthtime:null}}}])},447283,a=>a.a(async(b,c)=>{try{var d=a.i(465863);a.i(750740);var e=a.i(557469),f=a.i(843660),g=(a.i(654617),a.i(57823)),h=b([f]);[f]=h.then?(await h)():h;class i extends f.BaseAppService{get fs(){return g.apiFileSystem}isMobile=["android","ios"].includes((0,d.getOSPlatform)());appPlatform="web";hasSafeAreaInset=(0,e.isPWA)();async init(){await this.loadSettings(),await this.prepareBooksDir(),await this.runMigrations()}async runMigrations(){try{let a=await this.loadSettings(),b=a.migrationVersion||0;await super.runMigrations(b),b<this.CURRENT_MIGRATION_VERSION&&await this.saveSettings({...a,migrationVersion:this.CURRENT_MIGRATION_VERSION})}catch(a){console.error("Failed to run migrations:",a)}}resolvePath(a,b){return this.fs.resolvePath(a,b)}async setCustomRootDir(){}async selectDirectory(){throw Error("selectDirectory is not supported in browser")}async selectFiles(){throw Error("selectFiles is not supported in browser")}async saveFile(a,b,c){try{let d=new Blob([b],{type:c||"application/octet-stream"}),e=URL.createObjectURL(d),f=document.createElement("a");return f.href=e,f.download=a,document.body.appendChild(f),f.click(),document.body.removeChild(f),URL.revokeObjectURL(e),!0}catch(a){return console.error("Failed to save file:",a),!1}}}a.s(["WebAppService",()=>i]),c()}catch(a){c(a)}},!1),831930,a=>{a.v(b=>Promise.all(["server/chunks/ssr/[externals]_@zip_js_zip_4d21a2e3.js"].map(b=>a.l(b))).then(()=>b(436738)))},732123,a=>{a.v(b=>Promise.all(["server/chunks/ssr/packages_foliate-js_mobi_1e5fefea.js"].map(b=>a.l(b))).then(()=>b(334001)))},224845,a=>{a.v(b=>Promise.all(["server/chunks/ssr/packages_foliate-js_fb2_00c60b6c.js"].map(b=>a.l(b))).then(()=>b(95448)))},774348,a=>{a.v(b=>Promise.all(["server/chunks/ssr/packages_foliate-js_vendor_fflate_774ae62e.js"].map(b=>a.l(b))).then(()=>b(64516)))},848765,a=>{a.v(b=>Promise.all(["server/chunks/ssr/packages_foliate-js_pdf_f5beb5e2.js"].map(b=>a.l(b))).then(()=>b(556046)))},6876,a=>{a.v(b=>Promise.all(["server/chunks/ssr/packages_foliate-js_epub_df9dfc33.js"].map(b=>a.l(b))).then(()=>b(723285)))},702827,a=>{a.v(b=>Promise.all(["server/chunks/ssr/packages_foliate-js_comic-book_a852547e.js"].map(b=>a.l(b))).then(()=>b(760326)))}];

//# sourceMappingURL=%5Broot-of-the-server%5D__03150d45._.js.map