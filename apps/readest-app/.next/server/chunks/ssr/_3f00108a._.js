module.exports=[169967,a=>{"use strict";let b="http://www.w3.org/2005/Atom",c="http://opds-spec.org/2010/catalog",d="application/atom+xml",e=["http://opds-spec.org/image","http://opds-spec.org/cover"],f=["http://opds-spec.org/image/thumbnail","http://opds-spec.org/thumbnail"],g={SUMMARY:Symbol("summary"),CONTENT:Symbol("content")},h=Symbol("facetGroup"),i=(a,b)=>{let c=new Map;if(a)for(let d of a)for(let a of[b(d)].flat()){let b=c.get(a);b?b.push(d):c.set(a,[d])}return c},j=a=>{if(!a)return null;let[b,...c]=a.split(/ *; */);return{mediaType:b.toLowerCase(),parameters:Object.fromEntries(c.map(a=>{let[b,c]=a.split("=");return[b.toLowerCase(),c?.replace(/(^"|"$)/g,"")]}))}},k=a=>{let b=j(a);if(!b)return!1;let{mediaType:c,parameters:e}=b;return"application/opds+json"===c||c===d&&e.profile?.toLowerCase()==="opds-catalog"},l=(a,b)=>a.lookupNamespaceURI(null)===b||a.lookupPrefix(b)?b:null,m=a=>a?b=>c=>c.namespaceURI===a&&c.localName===b:a=>b=>b.localName===a,n=a=>{if(!a)return;let b=a.getAttribute("type")??"text";return{value:"xhtml"===b?a.innerHTML:"html"===b?a.textContent.replaceAll("&lt;","<").replaceAll("&gt;",">").replaceAll("&amp;","&"):a.textContent,type:b}},o=a=>{let b=n(a);if(b?.type==="text")return b?.value},p=(a,b)=>o(a)??o(b),q=a=>{let b=a.getElementsByTagNameNS(c,"indirectAcquisition")[0];return b?[{type:b.getAttribute("type")},...q(b)]:[]},r=a=>{let b,d={rel:a.getAttribute("rel")?.split(/ +/),href:a.getAttribute("href"),type:a.getAttribute("type"),title:a.getAttribute("title"),properties:{price:(b=a.getElementsByTagNameNS(c,"price")[0])?{currency:b.getAttribute("currencycode"),value:b.textContent}:null,indirectAcquisition:q(a),numberOfItems:a.getAttributeNS("http://purl.org/syndication/thread/1.0","count")},[h]:a.getAttributeNS(c,"facetGroup")};return"true"===a.getAttributeNS(c,"activeFacet")&&(d.rel=[d.rel??[]].flat().concat("self")),d},s=a=>{let b=a.namespaceURI,c=a.getElementsByTagNameNS(b,"uri")[0]?.textContent;return{name:a.getElementsByTagNameNS(b,"name")[0]?.textContent??"",links:c?[{href:c}]:[]}},t=a=>{let c=m(l(a.ownerDocument,b)),d=Array.from(a.children),h=m("http://purl.org/dc/elements/1.1/"),j=m("http://purl.org/dc/terms/"),k=a=>{let b=h(a),c=j(a);return a=>b(a)||c(a)},o=d.filter(c("link")).map(r),p=i(o,a=>a.rel);return{metadata:{title:d.find(c("title"))?.textContent??"",author:d.filter(c("author")).map(s),contributor:d.filter(c("contributor")).map(s),publisher:d.find(k("publisher"))?.textContent,published:(d.find(j("issued"))??d.find(k("date")))?.textContent,language:d.find(k("language"))?.textContent,identifier:d.find(k("identifier"))?.textContent,subject:d.filter(c("category")).map(a=>({name:a.getAttribute("label"),code:a.getAttribute("term"),scheme:a.getAttribute("scheme")})),rights:d.find(c("rights"))?.textContent??"",[g.CONTENT]:n(d.find(c("content"))??d.find(c("summary")))},links:o,images:e.concat(f).map(a=>p.get(a)?.[0]).filter(a=>a)}};a.s(["getFeed",0,a=>{let c=m(l(a,b)),d=Array.from(a.documentElement.children),e=d.filter(c("entry")),f=d.filter(c("link")).map(r),j=i(f,a=>a.rel),n=new Map([[null,[]]]),o=new Map;for(let a of e){let b=Array.from(a.children),d=b.filter(c("link")).map(r),e=i(d,a=>a.rel),f=[...e.keys()].some(a=>a?.startsWith("http://opds-spec.org/acquisition")||"preview"===a),h=e.get("http://opds-spec.org/group")??e.get("collection"),j=h?.length?h.find(a=>n.has(a.href))??h[0]:null;j&&!o.has(j.href)&&o.set(j.href,j);let l=f?t(a):Object.assign(d.find(a=>k(a.type))??d[0]??{},{title:b.find(c("title"))?.textContent,[g.SUMMARY]:p(b.find(c("summary")),b.find(c("content")))}),m=n.get(j?.href??null);m?m.push(l):n.set(j.href,[l])}let[q,...s]=Array.from(n,([a,b])=>{let c=b[0]?.metadata?"publications":"navigation";if(null==a)return{[c]:b};let d=o.get(a);return{metadata:{title:d.title,numberOfItems:d.properties.numberOfItems},links:[{rel:"self",href:d.href,type:d.type}],[c]:b}});return{metadata:{title:d.find(c("title"))?.textContent,subtitle:d.find(c("subtitle"))?.textContent},links:f,...q,groups:s,facets:Array.from(i(j.get("http://opds-spec.org/facet")??[],a=>a[h]),([a,b])=>({metadata:{title:a},links:b}))}},"getOpenSearch",0,a=>{let b=a.documentElement.namespaceURI,c=m(b),e=Array.from(a.documentElement.children),f=e.filter(c("Url")),g=f.find(a=>k(a.getAttribute("type")))??f.find(a=>(a=>{let b=j(a);if(!b)return!1;let{mediaType:c}=b;return c===d})(a.getAttribute("type")))??f[0];if(!g)throw Error("document must contain at least one Url element");let h=/{(?:([^}]+?):)?(.+?)(\?)?}/g,i=new Map([["count","100"],["startIndex",g.getAttribute("indexOffset")??"0"],["startPage",g.getAttribute("pageOffset")??"0"],["language","*"],["inputEncoding","UTF-8"],["outputEncoding","UTF-8"]]),l=g.getAttribute("template");return{metadata:{title:(e.find(c("LongName"))??e.find(c("ShortName")))?.textContent,description:e.find(c("Description"))?.textContent},search:a=>l.replace(h,(c,d,e)=>{let f=d?g.lookupNamespaceURI(d):null,h=f===b?null:f;return encodeURIComponent(a.get(h)?.get(e)||(h?"":i.get(e)??""))}),params:Array.from(l.matchAll(h),([,a,c,d])=>{let e=a?g.lookupNamespaceURI(a):null,f=e===b?null:e;return{ns:f,name:c,required:!d,value:f&&f!==b?"":i.get(c)??""}})}},"getPublication",0,t,"isOPDSCatalog",0,k])},931230,a=>{"use strict";var b=a.i(833047);a.i(339144),a.i(476719);var c=a.i(504621);let d={upload:(0,b.getAPIBaseUrl)()+"/storage/upload",download:(0,b.getAPIBaseUrl)()+"/storage/download",delete:(0,b.getAPIBaseUrl)()+"/storage/delete",stats:(0,b.getAPIBaseUrl)()+"/storage/stats",list:(0,b.getAPIBaseUrl)()+"/storage/list",purge:(0,b.getAPIBaseUrl)()+"/storage/purge",scan:(0,b.getAPIBaseUrl)()+"/storage/scan",import:(0,b.getAPIBaseUrl)()+"/storage/import"},e=async(a,b)=>{let c=await fetch(a,b);if(!c.ok){let a=c.statusText;try{a=(await c.json()).error||a}catch{}throw Error(a||"Request failed")}return c},f=async a=>a,g=async({appService:a,dst:g,cfp:h,url:i,headers:j,singleThreaded:k,skipSslVerification:l,onProgress:m})=>{try{let n=i;if(!n){let a=await f(h),b=await e(`${d.download}?fileKey=${encodeURIComponent(a)}`,{method:"GET"}),{downloadUrl:c}=await b.json();n=c}if(!n)throw Error("No download URL available");if(!(0,b.isWebAppPlatform)())return await (0,c.tauriDownload)(n,g,m,j,void 0,k,l);{let{headers:b,blob:d}=await (0,c.webDownload)(n,m,j);return await a.writeFile(g,"None",await d.arrayBuffer()),b}}catch(a){throw console.error(`File '${g}' download failed:`,a),a}},h=async()=>{try{let a=await e(d.scan,{method:"POST"});return await a.json()}catch(a){throw console.error("Scan books failed:",a),Error("Scan books failed")}};a.s(["downloadFile",0,g,"scanBooks",0,h])},754585,462760,a=>{"use strict";var b,c=a.i(169967),d=a.i(810076),e=a.i(808091),f=a.i(833047),g=a.i(288638),h=a.i(657123);let i=`${(0,f.getAPIBaseUrl)()}/opds/proxy`,j=`${(0,f.getNodeAPIBaseUrl)()}/opds/proxy`,k=a=>{try{let b=new URL(a),c=decodeURIComponent(b.username)||void 0,d=decodeURIComponent(b.password)||void 0;if(c||d)return b.username="",b.password="",{url:b.toString(),username:c,password:d}}catch(a){console.warn("Failed to parse URL:",a)}return{url:a}},l={standardebooks:j},m=(a,b="",c=!1)=>{if(a.startsWith("http")){let{url:d}=k(a),e=new URLSearchParams;e.append("url",d),e.append("stream",`${c}`),b&&e.append("auth",b);let f=(a=>{for(let[b,c]of Object.entries(l))if(a.includes(b))return c;return i})(a);return`${f}?${e.toString()}`}return a},n=async(a,b,c,d,f)=>{let g,h,i,j,k,l,m=(a=>{let b,c={},d=/(\w+)=["']?([^"',]+)["']?/g;for(;null!==(b=d.exec(a));)c[b[1]]=b[2];return c})(c),n=Math.random().toString(36).slice(2),o="00000001",p=await (g=m.realm,h=m.nonce,i=m.qop,j=m.algorithm,k=(0,e.md5)(`${a}:${g}:${b}`),j&&"md5-sess"===j.toLowerCase()&&(k=(0,e.md5)(`${k}:${h}:${n}`)),l=(0,e.md5)(`${d}:${f}`),i?(0,e.md5)(`${k}:${h}:${o}:${n}:${i}:${l}`):(0,e.md5)(`${k}:${h}:${l}`)),q=[`username="${a}"`,`realm="${m.realm}"`,`nonce="${m.nonce}"`,`uri="${f}"`,`response="${p}"`];return m.algorithm&&q.push(`algorithm="${m.algorithm}"`),m.opaque&&q.push(`opaque="${m.opaque}"`),m.qop&&(q.push('qop="auth"'),q.push(`nc=${o}`),q.push(`cnonce="${n}"`)),`Digest ${q.join(", ")}`},o=(a,b)=>{let c=btoa(`${a}:${b}`);return`Basic ${c}`},p=async(a,b,c,d=!1)=>{let{url:e,username:i,password:j}=k(a),l=b||i,p=c||j;if(!l||!p)return null;let q=d?m(e):e,r={"User-Agent":h.READEST_OPDS_USER_AGENT,Accept:"application/atom+xml, application/xml, text/xml, */*"},s=(0,f.isTauriAppPlatform)()?g.fetch:window.fetch,t=await s(q,{method:"HEAD",headers:r,danger:{acceptInvalidCerts:!0,acceptInvalidHostnames:!0}});if(401===t.status||403===t.status){let a=t.headers.get("WWW-Authenticate");if(a)if(a.toLowerCase().startsWith("digest")){let b=new URL(e);return await n(l,p,a,"GET",b.pathname+b.search)}else a.toLowerCase().startsWith("basic")}return o(l,p)},q=async a=>{let b=a["content-disposition"];if(b){let a=b.match(/filename\*\s*=\s*(?:utf-8|UTF-8)'[^']*'([^;\s]+)/i);if(a?.[1])return decodeURIComponent(a[1]);let c=b.match(/filename\s*=\s*["']?([^"';\s]+)["']?/i);if(c?.[1])return decodeURIComponent(c[1])}return""},r=async(a,b,c,d=!1,e={})=>{let{url:i,username:j,password:l}=k(a),p=b||j,q=c||l,r=d?m(i):i,s={"User-Agent":h.READEST_OPDS_USER_AGENT,Accept:"application/atom+xml, application/xml, text/xml, */*",...e.headers},t=(0,f.isTauriAppPlatform)()?g.fetch:window.fetch,u=await t(r,{...e,method:e.method||"GET",headers:s,danger:{acceptInvalidCerts:!0,acceptInvalidHostnames:!0}});if(!u.ok&&(401===u.status||403===u.status)&&p&&q){let a=u.headers.get("WWW-Authenticate");if(a){let b=null;if(a.toLowerCase().startsWith("digest")){let c=new URL(i);b=await n(p,q,a,e.method||"GET",c.pathname+c.search)}else a.toLowerCase().startsWith("basic")&&(b=o(p,q));if(b){let a=d?`${r}&auth=${encodeURIComponent(b)}`:r;u=await t(a,{...e,method:e.method||"GET",headers:d?s:{...s,Authorization:b},danger:{acceptInvalidCerts:!0,acceptInvalidHostnames:!0}})}}}return u};a.s(["fetchWithAuth",0,r,"getProxiedURL",0,m,"needsProxy",0,a=>(0,f.isWebAppPlatform)()&&a.startsWith("http"),"probeAuth",0,p,"probeFilename",0,q],462760);let s={XML:"application/xml",ATOM:"application/atom+xml",XHTML:"application/xhtml+xml",HTML:"text/html",EPUB:"application/epub+zip",PDF:"application/pdf",OPENSEARCH:"application/opensearchdescription+xml"};(b={}).INVALID_URL="Invalid URL format",b.LOAD_FAILED="Failed to load OPDS feed",b.NOT_OPDS="Invalid OPDS feed URL",b.NO_OPDS_LINK="Document has no link to OPDS feeds",b.NO_HREF="OPDS link has no href attribute",b.INVALID_HTML="Invalid HTML document",b.INVALID_CONTENT="Content is neither valid XML nor JSON";let t=a=>{if(!a)return null;let[b,...c]=a.split(/ *; */);return b?{mediaType:b.toLowerCase(),parameters:Object.fromEntries(c.map(a=>{let[b,c]=a.split("=");return b?[b.toLowerCase(),c?.replace(/(^"|"$)/g,"")]:null}).filter(a=>null!==a))}:null},u=(a,b)=>{if(!a)return"";if(b.includes("/api/opds/proxy?url="))return u(a,new URLSearchParams(b.split("?")[1]).get("url")||"");try{if(b.includes(":"))return new URL(a,b).toString();let c="https://invalid.invalid/",d=new URL(a,c+b);return d.search="",decodeURI(d.href.replace(c,""))}catch(b){return console.warn(b),a}},v=async(a,b,d,e=!1)=>{try{let f=new AbortController,g=setTimeout(()=>f.abort(),1e4),h=await r(a,b,d,e,{signal:f.signal});if(clearTimeout(g),!h.ok){if(401===h.status)return{isValid:!1,error:"Authentication required. Please check your username and password."};return{isValid:!1,error:`Failed to load OPDS feed: ${h.status} ${h.statusText}`}}let i=h.url,j=await h.text();if(j.startsWith("<")){let a=new DOMParser().parseFromString(j,s.XML),{documentElement:{localName:b}}=a;if("feed"===b)return{isValid:!0,data:{type:"feed",doc:a,text:j,responseURL:i}};{if("entry"===b)return{isValid:!0,data:{type:"entry",doc:a,text:j,responseURL:i}};if("OpenSearchDescription"===b)return{isValid:!0,data:{type:"opensearch",doc:a,text:j,responseURL:i}};let d=h.headers.get("Content-Type")??s.HTML,e=t(d)?.mediaType??s.HTML,f=new DOMParser().parseFromString(j,e);if(!f.head)return{isValid:!1,error:"Invalid OPDS feed URL"};let g=Array.from(f.head.querySelectorAll("link")).find(a=>(0,c.isOPDSCatalog)(a.getAttribute("type")??""));if(!g)return{isValid:!1,error:"Invalid OPDS feed URL"};if(!g.getAttribute("href"))return{isValid:!1,error:"OPDS link has no href attribute"};return{isValid:!0,data:{type:"html",doc:f,text:j,responseURL:i}}}}try{let a=JSON.parse(j);if(!a.metadata&&!a.links&&!a.publications&&!a.navigation)return{isValid:!1,error:"Invalid OPDS feed URL"};return{isValid:!0,data:{type:"feed",doc:new Document,text:j,responseURL:i}}}catch{return{isValid:!1,error:"Invalid OPDS feed URL"}}}catch(a){return console.error("OPDS validation error:",a),{isValid:!1,error:a instanceof Error?a.message:"Invalid OPDS feed URL"}}};a.s(["MIME",0,s,"getFileExtFromPath",0,(a,b="/")=>{let c=a.split(b);for(let a of Object.values(d.EXTS))if(c.includes(a))return a;return""},"groupByArray",0,(a,b)=>{let c=new Map;if(a)for(let d of a)for(let a of[b(d)].flat()){let b=c.get(a);b?b.push(d):c.set(a,[d])}return c},"isSearchLink",0,a=>(Array.isArray(a.rel)?a.rel:[a.rel||""]).includes("search")&&(a.type===s.OPENSEARCH||a.type===s.ATOM),"parseMediaType",0,t,"resolveURL",0,u,"validateOPDSURL",0,v],754585)}];

//# sourceMappingURL=_3f00108a._.js.map