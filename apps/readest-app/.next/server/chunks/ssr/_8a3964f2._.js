module.exports=[679496,a=>{"use strict";let b=new Set(["PDF","CBZ"]);a.s(["FIXED_LAYOUT_FORMATS",0,b])},762774,a=>{"use strict";var b=a.i(887287);let c={EPUB:"epub",PDF:"pdf",MOBI:"mobi",AZW:"azw",AZW3:"azw3",CBZ:"cbz",FB2:"fb2",FBZ:"fbz",TXT:"txt",MD:"md"};class d{file;constructor(a){this.file=a}async isZip(){let a=new Uint8Array(await this.file.slice(0,4).arrayBuffer());return 80===a[0]&&75===a[1]&&3===a[2]&&4===a[3]}async isPDF(){let a=new Uint8Array(await this.file.slice(0,5).arrayBuffer());return 37===a[0]&&80===a[1]&&68===a[2]&&70===a[3]&&45===a[4]}async makeZipLoader(){let b=async()=>{let a=Math.min(65536,this.file.size),b=new Uint8Array(await this.file.slice(this.file.size-a,this.file.size).arrayBuffer());for(let a=b.length-22;a>=0;a--)if(80===b[a]&&75===b[a+1]&&5===b[a+2]&&6===b[a+3]){let c=b[a+20]+(b[a+21]<<8),d=a+22,e=b.slice(d,d+c);return new TextDecoder().decode(e)}return null},{configure:c,ZipReader:d,BlobReader:e,TextWriter:f,BlobWriter:g}=await a.A(831930);c({useWebWorkers:!1});let h=new d(new e(this.file)),i=await h.getEntries(),j=new Map(i.map(a=>[a.filename,a])),k=a=>(b,...c)=>j.has(b)?a(j.get(b),...c):null,l=k(a=>a.getData?a.getData(new f):null);return{entries:i,loadText:l,loadBlob:k((a,b)=>a.getData?a.getData(new g(b)):null),getSize:a=>j.get(a)?.uncompressedSize??0,getComment:b,sha1:void 0}}isCBZ(){return"application/vnd.comicbook+zip"===this.file.type||this.file.name.endsWith(`.${c.CBZ}`)}isFB2(){return"application/x-fictionbook+xml"===this.file.type||this.file.name.endsWith(`.${c.FB2}`)}isFBZ(){return"application/x-zip-compressed-fb2"===this.file.type||this.file.name.endsWith(".fb.zip")||this.file.name.endsWith(".fb2.zip")||this.file.name.endsWith(`.${c.FBZ}`)}async open(){let b=null,d="EPUB";if(!this.file.size)throw Error("File is empty");try{if(await this.isZip()){let e=await this.makeZipLoader(),{entries:f}=e;if(this.isCBZ()){let{makeComicBook:c}=await a.A(702827);b=await c(e,this.file),d="CBZ"}else if(this.isFBZ()){let g=f.find(a=>a.filename.endsWith(`.${c.FB2}`)),h=await e.loadBlob((g??f[0]).filename),{makeFB2:i}=await a.A(224845);b=await i(h),d="FBZ"}else{let{EPUB:c}=await a.A(6876);b=await new c(e).init(),d="EPUB"}}else if(await this.isPDF()){let{makePDF:c}=await a.A(848765);b=await c(this.file),d="PDF"}else if(await (await a.A(732123)).isMOBI(this.file)){let c=await a.A(774348),{MOBI:e}=await a.A(732123);switch(b=await new e({unzlib:c.unzlibSync}).open(this.file),this.file.name.split(".").pop()?.toLowerCase()){case"azw":d="AZW";break;case"azw3":d="AZW3";break;default:d="MOBI"}}else if(this.isFB2()){let{makeFB2:c}=await a.A(224845);b=await c(this.file),d="FB2"}}catch(a){if(console.error("Failed to open document:",a),a instanceof Error&&a.message?.includes("not a valid zip"))throw Error("Unsupported or corrupted book file");throw a}return{book:b,format:d}}}a.s(["CFI",0,b,"DocumentLoader",()=>d,"EXTS",0,c,"getDirection",0,a=>{let{defaultView:b}=a,{writingMode:c,direction:d}=b.getComputedStyle(a.body);return{vertical:"vertical-rl"===c||"vertical-lr"===c,rtl:"rtl"===a.body.dir||"rtl"===d||"rtl"===a.documentElement.dir}}])},890392,a=>a.a(async(b,c)=>{try{var d=a.i(632084),e=a.i(555195),f=a.i(499492),g=b([d,e,f]);[d,e,f]=g.then?(await g)():g;let h={zh:"zh-Hans","zh-cn":"zh-Hans","zh-hk":"zh-Hant","zh-tw":"zh-Hant","zh-mo":"zh-Hant","zh-hans":"zh-Hans","zh-hant":"zh-Hant"},i=a=>a?a.split("-")[0].toLowerCase():"",j={cmn:"zho",arb:"ara",arz:"ara",ind:"msa",zsm:"msa",nob:"nor",nno:"nor",pes:"fas",quy:"que"};a.s(["code6392to6391",0,a=>{let b=e.iso6392.find(b=>b.iso6392B===a);return b?.iso6391||""},"detectLanguage",0,a=>{try{var b;let c;return c=j[b=(0,d.franc)(a.substring(0,1e3))]||b,f.iso6393To1[c]||"en"}catch{return console.warn("Language detection failed, defaulting to en."),"en"}},"getLanguageInfo",0,a=>{if(!a)return{};try{let b=Intl.getCanonicalLocales(a)[0],c=new Intl.Locale(b),d=["zh","ja","kr"].includes(c.language),e=(c.getTextInfo?.()??c.textInfo)?.direction;return{canonical:b,locale:c,isCJK:d,direction:e}}catch(a){return console.warn(a),{}}},"getLanguageName",0,a=>{let b=i(a),c=e.iso6392.find(a=>a.iso6391===b||a.iso6392B===b);return c?c.name:b},"inferLangFromScript",0,(a,b)=>{if(!b||"en"===b){if(/[\p{Script=Hangul}]/u.test(a))return"ko";else if(/[\p{Script=Hiragana}\p{Script=Katakana}]/u.test(a))return"ja";else if(/[\p{Script=Han}]/u.test(a))return"zh"}return b},"isCJKLang",0,a=>{if(!a)return!1;let b=i(a);return["zh","ja","ko","zho","jpn","kor"].includes(b)},"isCJKStr",0,a=>/[\p{Script=Han}\p{Script=Hiragana}\p{Script=Katakana}\p{Script=Hangul}]/u.test(a??""),"isSameLang",0,(a,b)=>{if(!a||!b)return!1;let c=i(a),d=i(b);return c===d},"isValidLang",0,a=>{if(!a||"string"!=typeof a||["und","mul","mis","zxx"].includes(a))return!1;let b=i(a);return e.iso6392.some(a=>a.iso6391===b||a.iso6392B===b)},"normalizeToFullLang",0,a=>{try{let b=new Intl.Locale(a.toLowerCase()).maximize();if("zh"===b.language)return"Hant"===b.script?"zh-Hant":"zh-Hans";return b.region?`${b.language}-${b.region}`:a}catch{return h[a.toLowerCase()]||a}},"normalizeToShortLang",0,a=>{let b=a.toLowerCase();return b.startsWith("zh")?h[b]||"zh-Hans":b.split("-")[0]},"normalizedLangCode",0,i]),c()}catch(a){c(a)}},!1),936114,a=>a.a(async(b,c)=>{try{a.i(762774);var d=a.i(654617),e=a.i(465863),f=a.i(773288),g=a.i(890392);a.i(907105);var h=a.i(399577),i=b([g]);[g]=i.then?(await i)():i;let j=(a,b=!1)=>{let c=(0,e.getUserLang)();if(!a)return"";if("string"==typeof a)return a;let d=Object.keys(a);return b?a[d[0]]:a[c]||a[d[0]]},k=a=>{try{let b="string"==typeof a?a:a?.[0];return b?b.split("-")[0]:""}catch{return""}},l=["ar","bo","de","en","es","fr","hi","it","nl","pl","pt","ru","th","tr","uk"],m=(a,b)=>{if(!a)return"";let c=a.split(" ");return b&&c.length>1?`${c[c.length-1]}, ${c.slice(0,-1).join(" ")}`:a},n=a=>d.SUPPORTED_LANGS[a]||a.toUpperCase(),o=a=>{let b=Array.isArray(a)?a[0]:a;if((0,g.isValidLang)(b)){let a=(0,g.normalizedLangCode)(b);return(0,g.code6392to6391)(a)||a}return"en"},p=a=>{try{if(a.includes("urn:"))return a.match(/[^:]+$/)?.[0]||"";if(a.includes(":"))return a.match(/^[^:]+:(.+)$/)?.[1]||""}catch{}return a};a.s(["INIT_BOOK_CONFIG",0,{updatedAt:0},"flattenContributors",0,a=>a?Array.isArray(a)?a.map(a=>"string"==typeof a?a:j(a?.name)).join(", "):"string"==typeof a?a:j(a?.name):"","formatAuthors",0,(a,b,c)=>{let d=k(b)||"en",f=!!c&&l.includes(d);return Array.isArray(a)?((a=!1,b="")=>(b=b||(0,e.getUserLang)(),a)?new Intl.ListFormat("en",{style:"narrow",type:"unit"}):new Intl.ListFormat(b,{style:"long",type:"conjunction"}))("zh"===d,d).format(a.map(a=>"string"==typeof a?m(a,f):m(j(a?.name),f))):"string"==typeof a?m(a,f):m(j(a?.name),f)},"formatBytes",0,(a,b="en-US")=>{if(!a)return"";let c=Math.floor(Math.log(a)/Math.log(1024)),d=a/Math.pow(1024,c);return new Intl.NumberFormat(b,{style:"unit",unit:["byte","kilobyte","megabyte","gigabyte","terabyte"][c],unitDisplay:"short",maximumFractionDigits:2}).format(d)},"formatDate",0,(a,b=!1)=>{if(!a)return;let c=(0,e.getUserLang)();try{return new Date(a).toLocaleDateString(c,{year:"numeric",month:"long",day:"numeric",timeZone:b?"UTC":void 0})}catch{return}},"formatLanguage",0,a=>Array.isArray(a)?a.map(n).join(", "):n(a||""),"formatPublisher",0,a=>"string"==typeof a?a:j(a),"formatTitle",0,a=>"string"==typeof a?a:j(a),"getBookDirFromLanguage",0,a=>{let b=o(a)||"";return(0,f.getDirFromLanguage)(b)},"getBookDirFromWritingMode",0,a=>{switch(a){case"horizontal-tb":return"ltr";case"horizontal-rl":case"vertical-rl":return"rtl";default:return"auto"}},"getBookLangCode",0,k,"getConfigFilename",0,a=>{if(!a.relativePath)throw Error(`Book ${a.title} (${a.hash}) is missing relativePath. Please re-import the book.`);let b=a.relativePath.replace(/\.[^.]+$/,"");return`${b}/config.json`},"getCoverFilename",0,a=>{if(!a.relativePath)throw Error(`Book ${a.title} (${a.hash}) is missing relativePath. Please re-import the book.`);let b=a.relativePath.replace(/\.[^.]+$/,""),c=`${b}/cover.png`;return console.log("[getCoverFilename] ✓ Using relativePath:",a.relativePath),console.log("[getCoverFilename] ✓ Cover path result:",c),c},"getCurrentPage",0,(a,b)=>{let c=a.format,{section:d,pageinfo:e}=b;return"PDF"===c?d?d.current+1:0:e?e.current+1:0},"getDir",0,a=>{if(!a.relativePath)throw Error(`Book ${a.title} (${a.hash}) is missing relativePath. Please re-import the book.`);return a.relativePath.replace(/\.[^.]+$/,"")},"getLibraryBackupFilename",0,()=>"library_backup.json","getLibraryFilename",0,()=>"library.json","getLocalBookFilename",0,a=>{if(!a.relativePath)throw Error(`Book ${a.title} (${a.hash}) is missing relativePath. Please re-import the book.`);return a.relativePath},"getMetadataHash",0,a=>{try{var b;let c,d=(c=a.title,"string"==typeof c?c:j(c,!0)),e=(!(b=a.author)?[]:Array.isArray(b)?b.map(a=>"string"==typeof a?a:j(a?.name,!0)).filter(Boolean):["string"==typeof b?b:j(b?.name,!0)]).join(","),f=(a=>{if(!a)return[];if(Array.isArray(a)){let b=(a=>{for(let b of["uuid","calibre","isbn"]){let c=a.find(a=>"string"==typeof a?a.toLowerCase().includes(b):a.scheme.toLowerCase()===b);if(c)return"string"==typeof c?p(c):c.value}})(a);if(b)return[b]}return Array.isArray(a)?a.map(a=>"string"==typeof a?p(a):a.value).filter(Boolean):"string"==typeof a?[p(a)]:[a.value]})(a.altIdentifier||a.identifier).join(","),g=`${d}|${e}|${f}`;return(0,h.md5)(g.normalize("NFC"))}catch(a){console.error("Error generating metadata hash:",a)}},"getPrimaryLanguage",0,o]),c()}catch(a){c(a)}},!1),579950,a=>{"use strict";var b=a.i(177898);let c="Request cancelled";async function d(a,d){let e=d?.signal;if(e?.aborted)throw Error(c);let f=d?.maxRedirections,g=d?.connectTimeout,h=d?.proxy,i=d?.danger;d&&(delete d.maxRedirections,delete d.connectTimeout,delete d.proxy,delete d.danger);let j=d?.headers?d.headers instanceof Headers?d.headers:new Headers(d.headers):new Headers,k=new Request(a,d),l=await k.arrayBuffer(),m=0!==l.byteLength?Array.from(new Uint8Array(l)):null;for(let[a,b]of k.headers)j.get(a)||j.set(a,b);let n=(j instanceof Headers?Array.from(j.entries()):Array.isArray(j)?j:Object.entries(j)).map(([a,b])=>[a,"string"==typeof b?b:b.toString()]);if(e?.aborted)throw Error(c);let o=await (0,b.invoke)("plugin:http|fetch",{clientConfig:{method:k.method,url:k.url,headers:n,data:m,maxRedirections:f,connectTimeout:g,proxy:h,danger:i}}),p=()=>(0,b.invoke)("plugin:http|fetch_cancel",{rid:o});if(e?.aborted)throw p(),Error(c);e?.addEventListener("abort",()=>void p());let{status:q,statusText:r,url:s,headers:t,rid:u}=await (0,b.invoke)("plugin:http|fetch_send",{rid:o}),v=()=>(0,b.invoke)("plugin:http|fetch_cancel_body",{rid:u}),w=async a=>{let c;try{c=await (0,b.invoke)("plugin:http|fetch_read_body",{rid:u})}catch(b){a.error(b),v();return}let d=new Uint8Array(c),e=d[d.byteLength-1],f=d.slice(0,d.byteLength-1);1===e?a.close():a.enqueue(f)},x=new Response([101,103,204,205,304].includes(q)?null:new ReadableStream({start:a=>{e?.addEventListener("abort",()=>{a.error(c),v()})},pull:a=>w(a)}),{status:q,statusText:r});return Object.defineProperty(x,"url",{value:s}),Object.defineProperty(x,"headers",{value:new Headers(t)}),x}a.s(["fetch",()=>d])},827689,a=>{"use strict";a.s(["deserializeConfig",0,(a,b,c)=>{let d=JSON.parse(a),{viewSettings:e,searchConfig:f}=d;return d.viewSettings={...b,...e},d.searchConfig={...c,...f},d.updatedAt??=Date.now(),d},"serializeConfig",0,(a,b,c)=>{let d=(a=JSON.parse(JSON.stringify(a))).viewSettings,e=a.searchConfig;return a.viewSettings=Object.entries(d).reduce((a,[c,d])=>(b[c]!==d&&(a[c]=d),a),{}),a.searchConfig=Object.entries(e).reduce((a,[b,d])=>(c[b]!==d&&(a[b]=d),a),{}),JSON.stringify(a)}])}];

//# sourceMappingURL=_8a3964f2._.js.map