module.exports=[393121,a=>{"use strict";var b,c,d,e,f=a.i(92585),g=a.i(239337),h=a.i(649970),i=a.i(205558),j=a.i(165696),k=a.i(133242),l=a.i(858589),m=a.i(593604),n=a.i(690557),o=a.i(631833),p=a.i(295195),q=a.i(941287),r=a.i(976072),s=a.i(833047),t=a.i(865950),u=a.i(383729),v=a.i(690692),w=a.i(592385),x=a.i(863052),y=a.i(407027),z=a.i(506017),A=a.i(427617),B=a.i(947218),C=a.i(268120),D=a.i(396560),E=a.i(19229),F=a.i(73552),G=a.i(529742),H=a.i(944996);let I={en:G.default,zh:H.default};var J=a.i(996925),K=a.i(657123),L=a.i(303661),M=a.i(10484),N=a.i(692017),O=a.i(596013),P=a.i(366926),Q=a.i(649661),R=a.i(11491);let S=async()=>{let a=await (0,R.invoke)("plugin:native-bridge|checkPermissions");return"granted"!==a.manageStorage&&(a=await (0,R.invoke)("plugin:native-bridge|request_manage_storage_permission")),"granted"===a.manageStorage};var T=a.i(444789),U=a.i(142773);a.i(965870);var V=a.i(582823),W=a.i(325219),X=a.i(488466),Y=a.i(926955),Z=a.i(674893),$=a.i(754585),_=a.i(791540);let aa=({children:a,showOverlay:b=!0})=>_.default.createPortal((0,f.jsx)("div",{className:(0,g.default)("fixed inset-0 isolate z-[100] flex items-center justify-center",b&&"bg-black bg-opacity-50"),style:{transform:"translateZ(0)"},children:a}),document.body),ab=[{id:"gutenberg",name:"Project Gutenberg",url:"https://m.gutenberg.org/ebooks.opds/",description:"World's largest collection of free ebooks",icon:"ðŸ›ï¸"},{id:"standardebooks",name:"Standard Ebooks",url:"https://standardebooks.org/feeds/opds",description:"Free and liberated ebooks, carefully produced for the true book lover",icon:"ðŸ“š"},{id:"manybooks",name:"ManyBooks",url:"https://manybooks.net/opds/index.php",description:"Over 50,000 free ebooks",icon:"ðŸ“–"},{id:"unglue.it",name:"Unglue.it",url:"https://unglue.it/api/opds/",description:'Free ebooks from authors who have "unglued" their books',icon:"ðŸ”“"}];async function ac(a,b,c){let d=await (0,$.validateOPDSURL)(a,b,c,(0,s.isWebAppPlatform)());return{valid:d.isValid,error:d.error}}function ad(){let a=(0,z.useTranslation)(),b=(0,j.useRouter)(),{envConfig:c}=(0,w.useEnv)(),{settings:d}=(0,B.useSettingsStore)(),[e,g]=(0,h.useState)(()=>d.opdsCatalogs||[]),[i,k]=(0,h.useState)(!1),[l,m]=(0,h.useState)({name:"",url:"",description:"",username:"",password:""}),[n,o]=(0,h.useState)(!1),[p,q]=(0,h.useState)(""),[r,t]=(0,h.useState)(!1),u=a=>{g(a),(0,Y.saveSysSettings)(c,"opdsCatalogs",a)},v=async()=>{if(!l.name||!l.url)return;let b=l.url.trim().toLowerCase();if(!b.startsWith("http://")&&!b.startsWith("https://"))return void q(a("URL must start with http:// or https://"));if((0,s.isWebAppPlatform)()&&(0,Z.isLanAddress)(l.url))return void q(a("Adding LAN addresses is not supported in the web app version."));t(!0),q("");let c=await ac(l.url,l.username||void 0,l.password||void 0);if(!c.valid){q(c.error||a("Invalid OPDS catalog. Please check the URL.")),t(!1);return}u([{id:Date.now().toString(),name:l.name,url:l.url,description:l.description,username:l.username||void 0,password:l.password||void 0},...e]),m({name:"",url:"",description:"",username:"",password:""}),q(""),t(!1),k(!1)},x=a=>{let c=new URLSearchParams({url:a.url});a.username&&c.set("id",a.id),b.push(`/opds?${c.toString()}`)};return(0,f.jsxs)("div",{className:"container max-w-2xl",children:[(0,f.jsxs)("div",{className:"mb-8",children:[(0,f.jsx)("h1",{className:"mb-2 text-base font-bold",children:a("OPDS Catalogs")}),(0,f.jsx)("p",{className:"text-base-content/70 text-xs",children:a("Browse and download books from online catalogs")})]}),(0,f.jsxs)("section",{className:"mb-12 text-base",children:[(0,f.jsxs)("div",{className:"mb-4 flex items-center justify-between",children:[(0,f.jsx)("h2",{className:"font-semibold",children:a("My Catalogs")}),(0,f.jsxs)("button",{onClick:()=>k(!0),className:"btn btn-primary btn-sm",children:[(0,f.jsx)(X.IoAdd,{className:"h-4 w-4"}),a("Add Catalog")]})]}),0===e.length?(0,f.jsxs)("div",{className:"border-base-300 rounded-lg border-2 border-dashed p-12 text-center",children:[(0,f.jsx)(X.IoBook,{className:"text-base-content/30 mx-auto mb-4 h-12 w-12"}),(0,f.jsx)("h3",{className:"mb-2 font-semibold",children:a("No catalogs yet")}),(0,f.jsx)("p",{className:"text-base-content/70 mb-4 text-sm",children:a("Add your first OPDS catalog to start browsing books")}),(0,f.jsx)("button",{onClick:()=>k(!0),className:"btn btn-primary btn-sm",children:a("Add Your First Catalog")})]}):(0,f.jsx)("div",{className:"grid gap-4 sm:grid-cols-2",children:e.map(b=>(0,f.jsx)("div",{className:"card bg-base-100 border-base-300 h-full border shadow-sm transition-shadow hover:shadow-md",children:(0,f.jsxs)("div",{className:"card-body h-full justify-between p-4",children:[(0,f.jsx)("div",{className:"flex items-center justify-between",children:(0,f.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,f.jsxs)("div",{className:"mb-1 flex items-center justify-between",children:[(0,f.jsxs)("h3",{className:"card-title line-clamp-1 text-sm",children:[b.icon&&(0,f.jsx)("span",{className:"",children:b.icon}),b.name]}),(0,f.jsx)("button",{onClick:()=>{var a;return a=b.id,void u(e.filter(b=>b.id!==a))},className:"btn btn-ghost btn-xs btn-square",title:"Remove",children:(0,f.jsx)(X.IoTrash,{className:"h-4 w-4"})})]}),b.description&&(0,f.jsx)("p",{className:"text-base-content/70 mb-2 line-clamp-1 h-6 text-sm sm:line-clamp-2 sm:h-10",children:b.description}),(0,f.jsx)("p",{className:"text-base-content/50 line-clamp-1 text-xs",children:b.url}),b.username&&(0,f.jsxs)("p",{className:"text-base-content/50 mt-1 text-xs",children:[a("Username"),": ",b.username]})]})}),(0,f.jsx)("div",{className:"card-actions mt-4 justify-end",children:(0,f.jsxs)("button",{onClick:()=>x(b),className:"btn btn-sm btn-primary",children:[(0,f.jsx)(X.IoOpenOutline,{className:"h-4 w-4"}),a("Browse")]})})]})},b.id))})]}),(0,f.jsxs)("section",{className:"text-base",children:[(0,f.jsx)("h2",{className:"mb-4 font-semibold",children:a("Popular Catalogs")}),(0,f.jsx)("div",{className:"grid gap-4 sm:grid-cols-2",children:ab.filter(a=>!a.disabled).map(b=>{let c=e.some(a=>a.url===b.url);return(0,f.jsx)("div",{className:"card bg-base-100 border-base-300 border shadow-sm transition-shadow hover:shadow-md",children:(0,f.jsxs)("div",{className:"card-body p-4",children:[(0,f.jsxs)("h3",{className:"card-title mb-1 text-sm",children:[b.icon&&(0,f.jsx)("span",{className:"",children:b.icon}),b.name]}),b.description&&(0,f.jsx)("p",{className:"text-base-content/70 line-clamp-2 text-sm",children:b.description}),(0,f.jsxs)("div",{className:"card-actions mt-4 justify-end gap-2",children:[!c&&(0,f.jsxs)("button",{onClick:()=>{!e.some(a=>a.url===b.url)&&u([...e,{...b}])},className:"btn btn-sm",children:[(0,f.jsx)(X.IoAdd,{className:"h-4 w-4"}),a("Add")]}),(0,f.jsxs)("button",{onClick:()=>x(b),className:"btn btn-sm btn-primary",children:[(0,f.jsx)(X.IoOpenOutline,{className:"h-4 w-4"}),a("Browse")]})]})]})},b.id)})})]}),i&&(0,f.jsx)(aa,{children:(0,f.jsx)("dialog",{className:"modal modal-open",children:(0,f.jsxs)("div",{className:"modal-box",children:[(0,f.jsx)("h3",{className:"mb-4 text-lg font-bold",children:a("Add OPDS Catalog")}),(0,f.jsxs)("form",{onSubmit:a=>{a.preventDefault(),v()},className:"space-y-4",children:[(0,f.jsxs)("div",{className:"form-control",children:[(0,f.jsx)("div",{className:"label",children:(0,f.jsxs)("span",{className:"label-text",children:[a("Catalog Name")," *"]})}),(0,f.jsx)("input",{type:"text",value:l.name,onChange:a=>m({...l,name:a.target.value}),placeholder:a("My Calibre Library"),className:"input input-bordered placeholder:text-sm",disabled:r,required:!0})]}),(0,f.jsxs)("div",{className:"form-control",children:[(0,f.jsx)("div",{className:"label",children:(0,f.jsxs)("span",{className:"label-text",children:[a("OPDS URL")," *"]})}),(0,f.jsx)("input",{type:"url",value:l.url,onChange:a=>m({...l,url:a.target.value}),placeholder:"https://example.com/opds",className:"input input-bordered placeholder:text-sm",disabled:r,required:!0}),p&&(0,f.jsx)("div",{className:"label",children:(0,f.jsx)("span",{className:"label-text-alt text-error",children:p})})]}),(0,f.jsxs)("div",{className:"form-control",children:[(0,f.jsx)("div",{className:"label",children:(0,f.jsx)("span",{className:"label-text",children:a("Username (optional)")})}),(0,f.jsx)("input",{type:"text",value:l.username,onChange:a=>m({...l,username:a.target.value}),placeholder:a("Username"),className:"input input-bordered placeholder:text-sm",disabled:r,autoComplete:"username"})]}),(0,f.jsxs)("div",{className:"form-control",children:[(0,f.jsx)("div",{className:"label",children:(0,f.jsx)("span",{className:"label-text",children:a("Password (optional)")})}),(0,f.jsxs)("div",{className:"relative",children:[(0,f.jsx)("input",{type:n?"text":"password",value:l.password,onChange:a=>m({...l,password:a.target.value}),placeholder:a("Password"),className:"input input-bordered w-full pr-10 placeholder:text-sm",disabled:r,autoComplete:"current-password"}),(0,f.jsx)("button",{type:"button",onClick:()=>o(!n),className:"btn btn-ghost btn-sm btn-square absolute right-1 top-1/2 -translate-y-1/2",tabIndex:-1,children:n?(0,f.jsx)(X.IoEyeOff,{className:"h-4 w-4"}):(0,f.jsx)(X.IoEye,{className:"h-4 w-4"})})]})]}),(0,f.jsxs)("div",{className:"form-control",children:[(0,f.jsx)("div",{className:"label",children:(0,f.jsx)("span",{className:"label-text",children:a("Description (optional)")})}),(0,f.jsx)("textarea",{value:l.description,onChange:a=>m({...l,description:a.target.value}),placeholder:a("A brief description of this catalog"),className:"textarea textarea-bordered text-sm placeholder:text-sm",rows:2,disabled:r})]}),(0,f.jsxs)("div",{className:"modal-action",children:[(0,f.jsx)("button",{type:"button",onClick:()=>{k(!1),m({name:"",url:"",description:"",username:"",password:""}),q(""),o(!1)},className:"btn",disabled:r,children:a("Cancel")}),(0,f.jsx)("button",{type:"submit",className:"btn btn-primary",disabled:r,children:r?(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)("span",{className:"loading loading-spinner loading-sm"}),a("Validating...")]}):a("Add Catalog")})]})]})]})})})]})}var ae=a.i(359978);function af({onClose:a}){let b=(0,z.useTranslation)();return(0,f.jsx)(ae.default,{isOpen:!0,title:b("Online Library"),onClose:a,bgClassName:"sm:!bg-black/75",boxClassName:"sm:min-w-[520px] sm:w-3/4 sm:h-[85%] sm:!max-w-screen-sm",children:(0,f.jsx)("div",{className:(0,g.clsx)("bg-base-100 relative flex flex-col overflow-y-auto pb-4"),children:(0,f.jsx)(ad,{})})})}var ag=a.i(23804),ah=a.i(461937),ai=a.i(858630),aj=a.i(65091);let ak={macos:(0,F.stubTranslation)("Reveal in Finder"),windows:(0,F.stubTranslation)("Reveal in File Explorer"),linux:(0,F.stubTranslation)("Reveal in Folder"),default:(0,F.stubTranslation)("Reveal in Folder")};var al=a.i(966027),am=a.i(627910);let an=()=>{let a=(0,z.useTranslation)(),{appService:b,envConfig:c}=(0,w.useEnv)(),{settings:d,setSettings:e,saveSettings:i}=(0,B.useSettingsStore)(),[j,k]=(0,h.useState)(!1),[l,n]=(0,h.useState)(""),[o,p]=(0,h.useState)(""),[r,s]=(0,h.useState)("idle"),[t,u]=(0,h.useState)({current:0,total:0}),[v,x]=(0,h.useState)(""),[y,A]=(0,h.useState)([]),[C,D]=(0,h.useState)(""),[E,G]=(0,h.useState)(0),[H,I]=(0,h.useState)([]);(0,h.useEffect)(()=>{let a=a=>{k(a.detail.visible),a.detail.visible&&(J(),L())},b=document.getElementById("migrate_data_dir_window");return b&&b.addEventListener("setDialogVisibility",a),()=>{b&&b.removeEventListener("setDialogVisibility",a)}},[]);let J=async()=>{try{if(!b)return;let a=await b.resolveFilePath("","Data");n(a);let c=await b.readDirectory(a,"None");A(c),D(c.length.toLocaleString()),G(c.reduce((a,b)=>a+b.size,0))}catch(a){console.error("Error loading current data directory:",a)}},L=async()=>{try{if(b?.isAndroidApp){let a=await (0,Q.getExternalSDCardPath)(),c=[{path:"/storage/emulated/0",label:"/sdcard/0"},{path:"/storage/emulated/0/Books",label:"/sdcard/0/Books"},{path:"/storage/emulated/0/Documents",label:"/sdcard/0/Documents"},{path:"/storage/emulated/0/Download",label:"/sdcard/0/Download"}];if(a.path){let b=a.path;c=[...c,{path:b,label:"/sdcard/1"},{path:`${b}/Books`,label:"/sdcard/1/Books"},{path:`${b}/Documents`,label:"/sdcard/1/Documents"},{path:`${b}/Download`,label:"/sdcard/1/Download"}]}let d=await (0,ah.documentDir)();I([...b?.distChannel==="playstore"?[]:c,{path:d,label:"/sdcard/APPDATA/Documents"}])}}catch(a){console.error("Error loading app local data directory:",a)}},M=async()=>{s("selecting"),x("");try{let a=await b?.selectDirectory?.("write");if(a){let c=await (0,ah.join)(a,K.DATA_SUBDIR);await b?.createDir(c,"None",!0),p(c),s("idle")}else s("idle")}catch(b){console.error("Error selecting directory:",b),x(a("Failed to select directory")),s("error")}},N=async c=>{if(x(""),c.includes("Android/data")||await S())try{let a=await (0,ah.join)(c,K.DATA_SUBDIR);await b?.createDir(a,"None",!0),p(a),s("idle")}catch(b){console.error("Error selecting directory:",b),x(a("Failed to select directory")),s("error")}},O=async()=>{if(b&&l&&o&&y.length){s("migrating"),x(""),u({current:0,total:0});try{if(o===l)throw Error(a("The new data directory must be different from the current one."));for(let a=0;a<y.length;a++){let c=y[a];u({current:a+1,total:y.length,currentFile:c.path});let d=await (0,ah.join)(l,c.path),e=await (0,ah.join)(o,c.path);await b.copyFile(d,e,"None")}let f=await b.readDirectory(o,"None");for(let a of y)if(!f.find(b=>b.path===a.path&&b.size===a.size))throw Error(`File ${a.path} failed to copy.`);await b.deleteDir(l,"None",!0);let g=(0,q.getDirPath)(o);await b.setCustomRootDir(g),d.customRootDir=g,d.localBooksDir=await b.resolveFilePath("","Books"),e({...d}),await i(c,d),s("completed"),n(o),A([]),D(""),G(0),J()}catch(b){console.error("Error migrating data:",b),x(a("Migration failed: {{error}}",{error:b||"Unknown error"})),s("error")}}},P=()=>{"migrating"!==r&&(k(!1),p(""),s("idle"),x(""),u({current:0,total:0}))},R=a=>{a&&b?.isDesktopApp&&(0,aj.revealItemInDir)(a)},T=t.total>0?Math.round(t.current/t.total*100):0,U=o&&o!==l&&"idle"===r,V=ak[(0,F.getOSPlatform)()]||ak.default;return(0,f.jsx)(ae.default,{id:"migrate_data_dir_window",isOpen:j,title:a("Change Data Location"),onClose:P,boxClassName:"sm:!w-[520px] sm:!max-w-screen-sm sm:h-auto",children:j&&(0,f.jsxs)("div",{className:"migrate-data-dir-content flex flex-col gap-6 px-6 py-4",children:[(0,f.jsxs)("div",{className:"space-y-2",children:[(0,f.jsx)("h3",{className:"text-base-content text-sm font-semibold",children:a("Current Data Location")}),(0,f.jsxs)("button",{title:a(V),className:"bg-base-200 flex w-full items-center gap-2 rounded-lg p-3",onClick:()=>R(l),children:[(0,f.jsx)(ag.RiFolderOpenLine,{className:"text-base-content/70 h-4 w-4 flex-shrink-0"}),(0,f.jsx)("span",{className:"text-base-content/80 break-all text-start font-mono text-sm",children:l||a("Loading...")})]}),C?(0,f.jsxs)("div",{className:"flex space-x-4",children:[(0,f.jsx)("p",{className:"text-base-content/60 text-xs",children:a("File count: {{size}}",{size:C})}),(0,f.jsx)("p",{className:"text-base-content/60 text-xs",children:a("Total size: {{size}}",{size:(0,m.formatBytes)(E)})})]}):(0,f.jsx)("p",{className:"text-base-content/60 text-xs",children:a("Calculating file info...")})]}),(0,f.jsxs)("div",{className:"space-y-3",children:[(0,f.jsx)("h3",{className:"text-base-content text-sm font-semibold",children:a("New Data Location")}),o&&(0,f.jsxs)("button",{title:a(V),className:"bg-primary/10 border-primary/20 flex w-full items-center gap-2 rounded-lg border p-3",onClick:()=>R(o),children:[(0,f.jsx)(ag.RiFolderOpenLine,{className:"text-primary h-4 w-4 flex-shrink-0"}),(0,f.jsx)("span",{className:"text-primary break-all text-start font-mono text-sm",children:o})]}),b?.isAndroidApp?(0,f.jsx)(al.default,{label:a("Choose New Folder"),className:"dropdown-bottom flex w-full justify-center",buttonClassName:"btn btn-ghost btn-outline w-full",toggleButton:(0,f.jsx)("div",{children:o?a("Choose Different Folder"):a("Choose New Folder")}),children:(0,f.jsx)("div",{className:(0,g.default)("folder-menu dropdown-content dropdown-center no-triangle","border-base-300 !bg-base-200 z-20 mt-1 max-w-[90vw] shadow-2xl"),children:H.map(a=>(0,f.jsx)(am.default,{toggled:o.split(`/${K.DATA_SUBDIR}`)[0]===a.path,transient:!0,label:a.label,onClick:()=>N(a.path)},a.path))})}):(0,f.jsxs)("button",{className:"btn btn-outline btn-sm w-full",onClick:M,disabled:"migrating"===r||"selecting"===r,children:["selecting"===r&&(0,f.jsx)(ag.RiLoader2Line,{className:"h-4 w-4 animate-spin"}),o?a("Choose Different Folder"):a("Choose New Folder")]})]}),"migrating"===r&&(0,f.jsxs)("div",{className:"space-y-3",children:[(0,f.jsxs)("div",{className:"flex items-center gap-2",children:[(0,f.jsx)(ag.RiLoader2Line,{className:"text-primary h-4 w-4 animate-spin"}),(0,f.jsx)("span",{className:"text-base-content text-sm font-medium",children:a("Migrating data...")}),(0,f.jsxs)("span",{className:"text-base-content/70 text-sm",children:[T,"%"]})]}),(0,f.jsx)("div",{className:"bg-base-200 h-2 w-full rounded-full",children:(0,f.jsx)("div",{className:"bg-primary h-2 rounded-full transition-all duration-300",style:{width:`${T}%`}})}),t.currentFile&&(0,f.jsx)("p",{className:"text-base-content/60 overflow-hidden font-mono text-xs",style:{direction:"rtl",textAlign:"left",whiteSpace:"nowrap",textOverflow:"ellipsis"},children:a("Copying: {{file}}",{file:t.currentFile})}),(0,f.jsx)("p",{className:"text-base-content/60 text-xs",children:a("{{current}} of {{total}} files",{current:t.current.toLocaleString(),total:t.total.toLocaleString()})})]}),"completed"===r&&(0,f.jsxs)("div",{className:"space-y-3",children:[(0,f.jsxs)("div",{className:"text-success flex items-center gap-2",children:[(0,f.jsx)(ag.RiCheckboxCircleFill,{className:"h-5 w-5"}),(0,f.jsx)("span",{className:"font-medium",children:a("Migration completed successfully!")})]}),(0,f.jsx)("div",{className:"bg-success/10 border-success/20 rounded-lg border p-3",children:(0,f.jsx)("p",{className:"text-success/80 text-sm",children:a("Your data has been moved to the new location. Please restart the application to complete the process.")})})]}),"error"===r&&v&&(0,f.jsxs)("div",{className:"space-y-2",children:[(0,f.jsxs)("div",{className:"text-error flex items-center gap-2",children:[(0,f.jsx)(ag.RiErrorWarningFill,{className:"h-5 w-5"}),(0,f.jsx)("span",{className:"font-medium",children:a("Migration failed")})]}),(0,f.jsx)("div",{className:"bg-error/10 border-error/20 rounded-lg border p-3",children:(0,f.jsx)("p",{className:"text-error/80 break-all text-sm",children:v})})]}),U&&(0,f.jsx)("div",{className:"bg-warning/10 border-warning/20 rounded-lg border p-3",children:(0,f.jsxs)("div",{className:"flex items-start gap-2",children:[(0,f.jsx)(ag.RiErrorWarningFill,{className:"text-warning mt-0.5 h-4 w-4 flex-shrink-0"}),(0,f.jsxs)("div",{className:"space-y-1",children:[(0,f.jsx)("p",{className:"text-base-content text-sm font-medium",children:a("Important Notice")}),(0,f.jsx)("p",{className:"text-base-content/80 text-sm",children:a("This will move all your app data to the new location. Make sure the destination has enough free space.")})]})]})}),(0,f.jsx)("div",{className:"flex gap-3 pt-2",children:"completed"===r?(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)("button",{className:"btn btn-outline flex-1",onClick:P,children:a("Close")}),(0,f.jsx)("button",{className:"btn btn-primary flex-1",onClick:()=>{(0,ai.relaunch)()},children:a("Restart App")})]}):(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)("button",{className:"btn btn-outline flex-1",onClick:P,disabled:"migrating"===r,children:a("Cancel")}),(0,f.jsxs)("button",{className:"btn btn-primary flex-1",onClick:O,disabled:!U||"idle"!==r,children:["migrating"===r&&(0,f.jsx)(ag.RiLoader2Line,{className:"h-4 w-4 animate-spin"}),a("Start Migration")]})]})})]})})};var ao=a.i(557767),ap=a.i(777470);let aq=a=>{if(!a)return[];let b=a.split("/");return b.map((a,c)=>({name:a,path:b.slice(0,c+1).join("/")}))};var ar=a.i(963508),as=a.i(157142),at=a.i(508931),au=a.i(584807),av=a.i(191601),aw=a.i(516320),ax=a.i(192238),ay=a.i(940333),az=a.i(280107),aA=a.i(339144),aB=a.i(328851),aC=a.i(499527);let aD=a=>`avatar_${btoa(a).replace(/[^a-zA-Z0-9]/g,"")}`,aE=({url:a,size:b,className:c,borderClassName:d,DefaultIcon:e})=>{let[i,j]=(0,h.useState)(()=>a?localStorage.getItem(aD(a)):null);return(0,h.useEffect)(()=>{if(!a)return;let b=aD(a),c=localStorage.getItem(b);c&&c===i||(async()=>{try{let c=await fetch(a,{referrerPolicy:"no-referrer"}),d=await c.blob(),e=new FileReader;e.onloadend=()=>{let a=e.result;try{localStorage.setItem(b,a),j(a)}catch(a){console.warn("Failed to cache avatar in localStorage:",a)}},e.readAsDataURL(d)}catch(a){console.error("Failed to cache avatar:",a)}})()},[a,i]),(0,f.jsx)("div",{className:"relative flex h-full w-full items-center justify-center rounded-full",style:{width:b,height:b},children:a?(0,f.jsxs)("div",{children:[(0,f.jsx)(aC.default,{src:i||a,alt:"User Avatar",className:(0,g.default)("rounded-full",c,d),referrerPolicy:"no-referrer",width:b,height:b,onError:a=>{a.target.style.display="none",a.target.nextElementSibling?.classList.remove("invisible")}}),(0,f.jsx)("div",{className:"invisible absolute inset-0 flex items-center justify-center",children:(0,f.jsx)(e,{className:(0,g.default)("text-neutral-content",c)})})]}):(0,f.jsx)(e,{className:"text-neutral-content",size:b})})},aF=({quotas:a,showProgress:b,className:c,labelClassName:d})=>(0,f.jsx)("div",{className:(0,g.default)("text-base-content w-full rounded-md text-base sm:text-sm",c),children:a.map(a=>{let c=a.used/a.total*100,e="bg-green-500";return c>80?e="bg-red-500":c>50&&(e="bg-yellow-500"),(0,f.jsxs)("div",{className:(0,g.default)("relative w-full overflow-hidden rounded-md",b&&"bg-base-300"),children:[b&&(0,f.jsx)("div",{className:`absolute left-0 top-0 h-full ${e}`,style:{width:`${c}%`}}),(0,f.jsxs)("div",{className:(0,g.default)("relative flex items-center justify-between gap-4 p-2",d),children:[(0,f.jsx)("span",{className:"truncate",title:a.tooltip,children:a.name}),(0,f.jsxs)("div",{className:"text-right text-sm",children:[a.used," / ",a.total," ",a.unit]})]})]},a.name)})});var aG=a.i(199099);let aH=({setIsDropdownOpen:a})=>{let b=(0,z.useTranslation)(),c=(0,j.useRouter)(),{envConfig:d,appService:e}=(0,w.useEnv)(),{user:k}=(0,x.useAuth)(),{userProfilePlan:m,quotas:n}=((a=!1)=>{let b=(0,z.useTranslation)(),{token:c,user:d}=(0,x.useAuth)(),[e,f]=(0,h.useState)([]),[g,i]=(0,h.useState)(void 0);return(0,h.useEffect)(()=>{if(!d||!c)return;let e=(0,aA.getStoragePlanData)(c),g=e.quota>1e9,h={name:a?b("Storage"):b("Cloud Sync Storage"),tooltip:b("{{percentage}}% of Cloud Sync Space Used.",{percentage:Math.round(e.usage/e.quota*100)}),used:parseFloat((e.usage/1024/1024/(g?1024:1)).toFixed(2)),total:Math.round(e.quota/1024/1024/(g?1024:1)*10)/10,unit:g?"GB":"MB"},j=(0,aA.getTranslationPlanData)(c),k={name:a?b("Translation"):b("Translation Characters"),tooltip:b("{{percentage}}% of Daily Translation Characters Used.",{percentage:Math.round(j.usage/j.quota*100)}),used:Math.round(j.usage/1024),total:Math.round(j.quota/1024),unit:"K"};i((0,aA.getUserProfilePlan)(c)),f([h,k])},[c]),{quotas:e,userProfilePlan:g}})(!0),{themeMode:o,setThemeMode:p}=(0,y.useThemeStore)(),{settings:q,setSettingsDialogOpen:r}=(0,B.useSettingsStore)(),[t,u]=(0,h.useState)(q.autoUpload),[v,A]=(0,h.useState)(q.autoCheckUpdates),[D,E]=(0,h.useState)(q.alwaysOnTop),[F,G]=(0,h.useState)(q.alwaysShowStatusBar),[H,I]=(0,h.useState)(q.screenWakeLock),[J,L]=(0,h.useState)(q.openLastBooks),[M,N]=(0,h.useState)(q.autoImportBooksOnOpen),[O,P]=(0,h.useState)(q.telemetryEnabled),[V,W]=(0,h.useState)(q.alwaysInForeground),[X,Z]=(0,h.useState)(q.savedBookCoverForLockScreen||""),$=(0,C.useResponsiveSize)(16),{stats:_,hasActiveTransfers:aa,setIsTransferQueueOpen:ab}=(0,ao.useTransferQueue)(),ac=()=>{(0,l.navigateToProfile)(c),a?.(!1)},ad=async()=>{if(!await S()&&e?.distChannel==="readest")return;let a=q.savedBookCoverForLockScreen?"":"default";if(a){let a=await (0,Q.selectDirectory)();a.path&&(0,Y.saveSysSettings)(d,"savedBookCoverForLockScreenPath",a.path)}(0,Y.saveSysSettings)(d,"savedBookCoverForLockScreen",a),Z(a)},ae=async()=>{let a=!q.alwaysInForeground;if(a){let a=await (0,R.invoke)("plugin:native-tts|checkPermissions");if("granted"!==a.postNotification&&(a=await (0,R.invoke)("plugin:native-tts|requestPermissions",{permissions:["postNotification"]})),"granted"!==a.postNotification)return}(0,Y.saveSysSettings)(d,"alwaysInForeground",a),W(a)},af=k?.user_metadata?.picture||k?.user_metadata?.avatar_url,ag=k?.user_metadata?.full_name,ah=ag?ag.split(" ")[0]:null,ai=b("dark"===o?"Dark Mode":"light"===o?"Light Mode":"Auto Mode"),aj=q.savedBookCoverForLockScreenPath,ak=aj?aj.split("/").pop():"Images",al=`ðŸ’¾ ${ak}/last-book-cover.png`;return(0,f.jsxs)(aG.default,{className:(0,g.default)("settings-menu dropdown-content no-triangle","z-20 mt-2 max-w-[90vw] shadow-2xl"),onCancel:()=>a?.(!1),children:[k?(0,f.jsx)(am.default,{label:ah?b("Logged in as {{userDisplayName}}",{userDisplayName:ah}):b("Logged in"),labelClass:"!max-w-40","aria-label":b("View account details and quota"),Icon:af?(0,f.jsx)(aE,{url:af,size:$,DefaultIcon:at.PiUserCircleCheck}):at.PiUserCircleCheck,children:(0,f.jsxs)("ul",{className:"flex flex-col",children:[(0,f.jsx)("button",{onClick:ac,className:"w-full",children:(0,f.jsx)(aF,{quotas:n,labelClassName:"h-10 pl-3 pr-2"})}),(0,f.jsx)(am.default,{label:b("Account"),noIcon:!0,onClick:ac})]})}):(0,f.jsx)(am.default,{label:b("Sign In"),Icon:at.PiUserCircle,onClick:()=>{(0,l.navigateToLogin)(c),a?.(!1)}}),k&&(0,f.jsx)(am.default,{label:b("Cloud File Transfers"),Icon:i.MdCloudSync,description:aa?b("{{activeCount}} active, {{pendingCount}} pending",{activeCount:_.active,pendingCount:_.pending}):_.failed>0?b("{{failedCount}} failed",{failedCount:_.failed}):"",onClick:()=>{ab(!0),a?.(!1)}}),(0,s.isTauriAppPlatform)()&&!e?.isMobile&&(0,f.jsx)(am.default,{label:b("Auto Import on File Open"),toggled:M,onClick:()=>{let a=!q.autoImportBooksOnOpen;(0,Y.saveSysSettings)(d,"autoImportBooksOnOpen",a),N(a)}}),(0,s.isTauriAppPlatform)()&&(0,f.jsx)(am.default,{label:b("Open Last Book on Start"),toggled:J,onClick:()=>{let a=!q.openLastBooks;(0,Y.saveSysSettings)(d,"openLastBooks",a),L(a)}}),e?.hasUpdater&&(0,f.jsx)(am.default,{label:b("Check Updates on Start"),toggled:v,onClick:()=>{let a=!q.autoCheckUpdates;(0,Y.saveSysSettings)(d,"autoCheckUpdates",a),A(a)}}),(0,f.jsx)("hr",{"aria-hidden":"true",className:"border-base-200 my-1"}),e?.hasWindow&&(0,f.jsx)(am.default,{label:b("Open Book in New Window"),toggled:q.openBookInNewWindow,onClick:()=>{(0,Y.saveSysSettings)(d,"openBookInNewWindow",!q.openBookInNewWindow),a?.(!1)}}),e?.hasWindow&&(0,f.jsx)(am.default,{label:b("Fullscreen"),onClick:()=>{(0,T.tauriHandleToggleFullScreen)(),a?.(!1)}}),e?.hasWindow&&(0,f.jsx)(am.default,{label:b("Always on Top"),toggled:D,onClick:()=>{let b=!q.alwaysOnTop;(0,Y.saveSysSettings)(d,"alwaysOnTop",b),E(b),(0,T.tauriHandleSetAlwaysOnTop)(b),a?.(!1)}}),e?.isMobileApp&&(0,f.jsx)(am.default,{label:b("Always Show Status Bar"),toggled:F,onClick:()=>{let a=!q.alwaysShowStatusBar;(0,Y.saveSysSettings)(d,"alwaysShowStatusBar",a),G(a)}}),(0,f.jsx)(am.default,{label:b("Keep Screen Awake"),toggled:H,onClick:()=>{let a=!q.screenWakeLock;(0,Y.saveSysSettings)(d,"screenWakeLock",a),I(a)}}),e?.isAndroidApp&&(0,f.jsx)(am.default,{label:b(b("Background Read Aloud")),toggled:V,onClick:ae}),(0,f.jsx)(am.default,{label:b("Reload Page"),onClick:()=>{window.location.reload(),a?.(!1)}}),(0,f.jsx)(am.default,{label:ai,Icon:"dark"===o?at.PiMoon:"light"===o?at.PiSun:az.TbSunMoon,onClick:()=>{p("auto"===o?"light":"light"===o?"dark":"auto")}}),(0,f.jsx)(am.default,{label:b("Settings"),Icon:at.PiGear,onClick:()=>{a?.(!1),r(!0)}}),e?.canCustomizeRootDir&&(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)("hr",{"aria-hidden":"true",className:"border-base-200 my-1"}),(0,f.jsx)(am.default,{label:b("Advanced Settings"),children:(0,f.jsxs)("ul",{className:"flex flex-col",children:[(0,f.jsx)(am.default,{label:b("Change Data Location"),noIcon:!e?.isAndroidApp,onClick:()=>{let b=document.getElementById("migrate_data_dir_window");if(b){let a=new CustomEvent("setDialogVisibility",{detail:{visible:!0}});b.dispatchEvent(a)}a?.(!1)}}),e?.isAndroidApp&&e?.distChannel!=="playstore"&&(0,f.jsx)(am.default,{label:b("Save Book Cover"),tooltip:b("Auto-save last book cover"),description:X?al:"",toggled:!!X,onClick:ad})]})})]}),(0,f.jsx)("hr",{"aria-hidden":"true",className:"border-base-200 my-1"}),k&&"free"===m&&(0,f.jsx)(am.default,{label:b("Upgrade to Readest Premium"),onClick:()=>{(0,l.navigateToProfile)(c),a?.(!1)}}),(0,s.isWebAppPlatform)()&&(0,f.jsx)(am.default,{label:b("Download Readest"),onClick:()=>{window.open(K.DOWNLOAD_READEST_URL,"_blank"),a?.(!1)}}),(0,f.jsx)(am.default,{label:b("About Readest"),onClick:()=>{(0,U.setAboutDialogVisible)(!0),a?.(!1)}}),(0,f.jsx)(am.default,{label:b("Help improve Readest"),description:O?b("Sharing anonymized statistics"):"",toggled:O,onClick:()=>{let a=!q.telemetryEnabled;(0,Y.saveSysSettings)(d,"telemetryEnabled",a),P(a),a?(0,aB.optInTelemetry)():(0,aB.optOutTelemetry)()}})]})},aI=({setIsDropdownOpen:a,onImportBooksFromFiles:b,onImportBooksFromDirectory:c,onOpenCatalogManager:d})=>{let e=(0,z.useTranslation)();return(0,f.jsxs)(aG.default,{className:(0,g.default)("dropdown-content bg-base-100 rounded-box z-[1] mt-3 p-2 shadow"),onCancel:()=>a?.(!1),children:[(0,f.jsx)(am.default,{label:e("From Local File"),Icon:(0,f.jsx)(X.IoFileTray,{className:"h-5 w-5"}),onClick:()=>{b(),a?.(!1)}}),c&&(0,f.jsx)(am.default,{label:e("From Directory"),Icon:(0,f.jsx)(X.IoFileTray,{className:"h-5 w-5"}),onClick:()=>{c?.(),a?.(!1)}}),(0,f.jsx)(am.default,{label:e("Online Library"),Icon:(0,f.jsx)(i.MdRssFeed,{className:"h-5 w-5"}),onClick:()=>{d(),a?.(!1)}})]})};var aJ=a.i(713184);let aK=({setIsDropdownOpen:a})=>{let b=(0,z.useTranslation)(),c=(0,j.useRouter)(),d=(0,j.useSearchParams)(),{envConfig:e}=(0,w.useEnv)(),{settings:g}=(0,B.useSettingsStore)(),h=g.libraryViewMode,i=g.librarySortBy,k=g.librarySortAscending,m=g.libraryCoverFit,n=g.libraryAutoColumns,o=g.libraryColumns,p=[{label:b("List"),value:"list"},{label:b("Grid"),value:"grid"}],q=[{label:b("Crop"),value:"crop"},{label:b("Fit"),value:"fit"}],r=[{label:b("Title"),value:"title"},{label:b("Author"),value:"author"},{label:b("Format"),value:"format"},{label:b("Date Read"),value:"updated"},{label:b("Date Added"),value:"created"},{label:b("Date Published"),value:"published"}],s=[{label:b("Ascending"),value:!0},{label:b("Descending"),value:!1}],t=async b=>{await (0,Y.saveSysSettings)(e,"libraryViewMode",b),a?.(!1);let f=new URLSearchParams(d?.toString());f.set("view",b),(0,l.navigateToLibrary)(c,`${f.toString()}`)},u=async b=>{await (0,Y.saveSysSettings)(e,"libraryCoverFit",b),a?.(!1);let f=new URLSearchParams(d?.toString());f.set("cover",b),(0,l.navigateToLibrary)(c,`${f.toString()}`)},v=async()=>{let a=!g.libraryAutoColumns;await (0,Y.saveSysSettings)(e,"libraryAutoColumns",a)},x=async a=>{await (0,Y.saveSysSettings)(e,"libraryColumns",a),await (0,Y.saveSysSettings)(e,"libraryAutoColumns",!1)},y=async b=>{await (0,Y.saveSysSettings)(e,"librarySortBy",b),a?.(!1);let f=new URLSearchParams(d?.toString());f.set("sort",b),(0,l.navigateToLibrary)(c,`${f.toString()}`)},A=async b=>{await (0,Y.saveSysSettings)(e,"librarySortAscending",b),a?.(!1);let f=new URLSearchParams(d?.toString());f.set("order",b?"asc":"desc"),(0,l.navigateToLibrary)(c,`${f.toString()}`)};return(0,f.jsxs)(aG.default,{className:"view-menu dropdown-content no-triangle z-20 mt-2 shadow-2xl",onCancel:()=>a?.(!1),children:[p.map(a=>(0,f.jsx)(am.default,{label:a.label,buttonClass:"h-8",toggled:h===a.value,onClick:()=>t(a.value)},a.value)),(0,f.jsx)("hr",{"aria-hidden":"true",className:"border-base-200 my-1"}),(0,f.jsx)(am.default,{label:b("Columns"),buttonClass:"h-8",labelClass:"text-sm sm:text-xs",disabled:!0}),(0,f.jsx)(am.default,{label:b("Auto"),buttonClass:"h-10",toggled:n,disabled:"list"===h,siblings:(0,f.jsx)(aJ.default,{className:"!h-10 !p-0 !pe-1 !ps-0",inputClassName:`!p-0 text-center text-base sm:text-sm !w-10 !h-6 !pe-0 ${n?"opacity-50":""}`,label:"",value:o,disabled:"list"===h,onChange:x,min:window.innerWidth<640?1:window.innerWidth<1024?2:3,max:window.innerWidth<640?4:window.innerWidth<1024?6:12}),onClick:()=>v()}),(0,f.jsx)("hr",{"aria-hidden":"true",className:"border-base-200 my-1"}),(0,f.jsx)(am.default,{label:b("Book Covers"),buttonClass:"h-8",labelClass:"text-sm sm:text-xs",disabled:!0}),q.map(a=>(0,f.jsx)(am.default,{label:a.label,buttonClass:"h-8",toggled:m===a.value,onClick:()=>u(a.value)},a.value)),(0,f.jsx)("hr",{"aria-hidden":"true",className:"border-base-200 my-1"}),(0,f.jsx)(am.default,{label:b("Sort by..."),buttonClass:"h-8",labelClass:"text-sm sm:text-xs",disabled:!0}),r.map(a=>(0,f.jsx)(am.default,{label:a.label,buttonClass:"h-8",toggled:i===a.value,onClick:()=>y(a.value)},a.value)),(0,f.jsx)("hr",{"aria-hidden":"true",className:"border-base-200 my-1"}),s.map(a=>(0,f.jsx)(am.default,{label:a.label,buttonClass:"h-8",toggled:k===a.value,onClick:()=>A(a.value)},a.value.toString()))]})};var aL=a.i(513786),aM=a.i(931230);let aN=()=>{let a=(0,z.useTranslation)(),{envConfig:b}=(0,w.useEnv)(),{library:c,updateBooks:d}=(0,A.useLibraryStore)(),[e,g]=(0,h.useState)(!1),i=async()=>{if(!e){g(!0),await n.eventDispatcher.dispatch("toast",{type:"info",timeout:0,message:a("Scanning books directory...")});try{console.log("[ScanBooks] 1. Starting scan books process");let e=await b.getAppService(),f=await (0,aM.scanBooks)();if(console.log("[ScanBooks] 2. Scan completed, found",f.count,"books:",f.books?.map(a=>a.relativePath)),0===f.count)return void n.eventDispatcher.dispatch("toast",{type:"success",timeout:3e3,message:a("No new books found")});let g=[],h=[],i=new Set(c.map(a=>a.hash));console.log("[ScanBooks] 3. Current library has",c.length,"books"),console.log("[ScanBooks] 4. Found",f.books.length,"books to process");let j=[];for(let b of f.books)try{console.log("[ScanBooks] 5. Processing book:",b.relativePath);let a=b.relativePath.split("/").slice(0,-1).join("/")||"",d=b.filePath;console.log("[ScanBooks] 6. Calling importBook with:",{sourcePath:d,relativePath:b.relativePath,groupName:a});let f=await e.importBook(d,c,!1,!0,!1,!0,{targetRelativePath:b.relativePath,targetGroupName:a});if(f){let a=!i.has(f.hash);if(console.log("[ScanBooks] 7. Book hash:",f.hash,"isNew:",a),a)g.push(f),h.push(f);else{let a=c.find(a=>a.hash===f.hash);if(a&&a.relativePath&&a.relativePath!==b.relativePath){console.log("[ScanBooks] Book moved: from",a.relativePath,"to",b.relativePath);try{let b=(0,m.getCoverFilename)(a),c=(0,m.getCoverFilename)(f);if(b!==c&&await e.exists(b,"Books")){console.log("[ScanBooks] Moving cover from:",b,"to:",c);let a=await e.openFile(b,"Books");await e.writeFile(c,"Books",a),await e.deleteFile(b,"Books"),console.log("[ScanBooks] âœ“ Cover moved successfully")}let d=(0,m.getConfigFilename)(a),g=(0,m.getConfigFilename)(f);if(d!==g&&await e.exists(d,"Books")){console.log("[ScanBooks] Moving config from:",d,"to:",g);let a=await e.readFile(d,"Books","text");await e.writeFile(g,"Books",a),await e.deleteFile(d,"Books"),console.log("[ScanBooks] âœ“ Config moved successfully")}let h=a.relativePath.replace(/\.[^.]+$/,"");try{let a=await e.readDirectory(h,"Books");0===a.length&&(await e.deleteDir(h,"Books",!0),console.log("[ScanBooks] âœ“ Old directory removed"))}catch(a){console.log("[ScanBooks] Old directory still contains files or cannot be deleted")}}catch(a){console.warn("[ScanBooks] Failed to move metadata files:",a)}a.relativePath=b.relativePath}}}}catch(d){let c=d?.message||"Unknown error";console.error("[ScanBooks] Error importing book:",b.relativePath,d),j.push({name:b.fileName,error:c}),n.eventDispatcher.dispatch("toast",{type:"error",timeout:4e3,message:a('Failed to import "{{name}}": {{error}}',{name:b.fileName,error:c})})}if(console.log("[ScanBooks] 8. Imported",g.length,"books,",h.length,"are new,",j.length,"failed"),g.length>0){if(await d(b,g),h.length>0){let b=h.map(a=>a.title).join(", "),c=1===h.length?a("Found 1 new book: {{title}}",{title:b}):a("Found {{count}} new books: {{titles}}",{count:h.length,titles:b});n.eventDispatcher.dispatch("toast",{type:"success",timeout:5e3,message:c})}else n.eventDispatcher.dispatch("toast",{type:"info",timeout:3e3,message:a("No new books found, library has {{count}} book(s)",{count:c.length})});if(j.length>0&&j.length<=3){let b=j.map(a=>a.name).join(", ");n.eventDispatcher.dispatch("toast",{type:"warning",timeout:6e3,message:a("Failed to import {{count}} book(s): {{names}}",{count:j.length,names:b})})}else j.length>3&&n.eventDispatcher.dispatch("toast",{type:"warning",timeout:6e3,message:a("Failed to import {{count}} books. Check console for details.",{count:j.length})})}else j.length>0?n.eventDispatcher.dispatch("toast",{type:"error",timeout:5e3,message:a("All {{count}} book(s) failed to import. Check console for details.",{count:j.length})}):n.eventDispatcher.dispatch("toast",{type:"info",timeout:3e3,message:a("No books found in directory")})}catch(b){console.error("[Scan] Error:",b),n.eventDispatcher.dispatch("toast",{type:"error",timeout:5e3,message:a("Failed to scan books: {{error}}",{error:b?.message||"Unknown error"})})}finally{g(!1)}}};return(0,f.jsxs)("button",{onClick:i,disabled:e,className:"btn btn-ghost btn-sm gap-2","aria-label":a("Scan books directory"),title:a("Scan books directory for new files"),children:[(0,f.jsx)(aL.BiScan,{className:e?"animate-spin":"",size:18}),a("Scan Books")]})},aO=({isSelectMode:a,isSelectAll:b,onImportBooksFromFiles:c,onImportBooksFromDirectory:d,onOpenCatalogManager:e,onToggleSelectMode:k,onSelectAll:l,onDeselectAll:m,onReconcilePaths:n})=>{let o=(0,z.useTranslation)(),p=(0,j.useRouter)(),q=(0,j.useSearchParams)(),{appService:r}=(0,w.useEnv)(),{systemUIVisible:t,statusBarHeight:u}=(0,y.useThemeStore)(),{currentBookshelf:v}=(0,A.useLibraryStore)(),{isTrafficLightVisible:x}=(0,av.useTrafficLight)(),[B,D]=(0,h.useState)(q?.get("q")??""),E=(0,h.useRef)(null),F=(0,C.useResponsiveSize)(18),{safeAreaInsets:G}=(0,y.useThemeStore)();(0,ax.default)({onToggleSelectMode:k});let H=(0,h.useCallback)((0,aw.debounce)(a=>{let b=new URLSearchParams(q?.toString());a?b.set("q",a):b.delete("q"),p.push(`?${b.toString()}`)},500),[q]),I=r?.hasWindowBar&&!x,J=v.reduce((a,b)=>a+("books"in b?b.books.length:1),0);if(!G)return null;let K=r?.isMobile||window.innerWidth<=640;return(0,f.jsx)("div",{ref:E,className:(0,g.default)("titlebar z-10 flex h-[52px] w-full items-center py-2 pr-4 sm:h-[48px]",I?"sm:pr-4":"sm:pr-6",x?"pl-16":"pl-0 sm:pl-2"),style:{marginTop:r?.hasSafeAreaInset?`max(${G.top}px, ${t?u:0}px)`:"0px"},children:(0,f.jsxs)("div",{className:"flex w-full items-center justify-between space-x-6 sm:space-x-12",children:[(0,f.jsxs)("div",{className:"exclude-title-bar-mousedown relative flex w-full items-center pl-4",children:[(0,f.jsxs)("div",{className:"relative flex h-9 w-full items-center sm:h-7",children:[(0,f.jsx)("span",{className:"text-base-content/50 absolute ps-3",children:(0,f.jsx)(as.FaSearch,{className:"h-4 w-4"})}),(0,f.jsx)("input",{type:"text",value:B,placeholder:J>1?o("Search in {{count}} Book(s)...",{count:J}):o("Search Books..."),onChange:a=>{let b=a.target.value;D(b),H(b)},spellCheck:"false",className:(0,g.default)("search-input input h-9 w-full rounded-full pr-[30%] ps-10 sm:h-7","bg-base-300/45 border-0","font-sans text-sm font-light","placeholder:text-base-content/50 truncate","focus:outline-none focus:ring-0")})]}),(0,f.jsxs)("div",{className:"text-base-content/50 absolute right-4 flex items-center space-x-2 sm:space-x-4",children:[B&&(0,f.jsx)("button",{type:"button",onClick:()=>{D(""),H("")},className:"text-base-content/40 hover:text-base-content/60 pe-1","aria-label":o("Clear Search"),children:(0,f.jsx)(au.IoMdCloseCircle,{className:"h-4 w-4"})}),(0,f.jsx)("span",{className:"bg-base-content/50 mx-2 h-4 w-[0.5px]"}),(0,f.jsx)(al.default,{label:o("Import Books"),className:(0,g.default)("exclude-title-bar-mousedown dropdown-bottom dropdown-center flex h-6 cursor-pointer justify-center"),buttonClassName:"p-0 h-6 min-h-6 w-6 flex touch-target items-center justify-center !bg-transparent",toggleButton:(0,f.jsx)(at.PiPlus,{role:"none",className:"m-0.5 h-5 w-5"}),children:(0,f.jsx)(aI,{onImportBooksFromFiles:c,onImportBooksFromDirectory:d,onOpenCatalogManager:e})}),K?null:(0,f.jsx)("button",{onClick:k,"aria-label":o("Select Books"),title:o("Select Books"),className:"h-6",children:a?(0,f.jsx)(at.PiSelectionAllFill,{role:"button",className:"text-base-content/60 h-6 w-6"}):(0,f.jsx)(at.PiSelectionAll,{role:"button",className:"text-base-content/60 h-6 w-6"})})]})]}),a?(0,f.jsx)("div",{className:(0,g.default)("flex h-full items-center","w-max-[72px] w-min-[72px] sm:w-max-[80px] sm:w-min-[80px]"),children:(0,f.jsx)("button",{onClick:b?m:l,className:"btn btn-ghost text-base-content/85 h-8 min-h-8 w-[72px] p-0 sm:w-[80px]","aria-label":o(b?"Deselect":"Select All"),children:(0,f.jsx)("span",{className:"font-sans text-base font-normal sm:text-sm",children:o(b?"Deselect":"Select All")})})}):(0,f.jsxs)("div",{className:"flex h-full items-center gap-x-2 sm:gap-x-4",children:[(0,s.isWebAppPlatform)()&&(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(aN,{}),n&&(0,f.jsx)("button",{onClick:n,className:"btn btn-ghost h-8 min-h-8 px-2",title:"æ ¡å‡†ä¹¦ç±è·¯å¾„",children:(0,f.jsx)("span",{className:"text-xs",children:"æ ¡å‡†"})})]}),(0,f.jsx)(al.default,{label:o("View Menu"),className:"exclude-title-bar-mousedown dropdown-bottom dropdown-end",buttonClassName:"btn btn-ghost h-8 min-h-8 w-8 p-0",toggleButton:(0,f.jsx)(at.PiDotsThreeCircle,{role:"none",size:F}),children:(0,f.jsx)(aK,{})}),(0,f.jsx)(al.default,{label:o("Settings Menu"),className:"exclude-title-bar-mousedown dropdown-bottom dropdown-end",buttonClassName:"btn btn-ghost h-8 min-h-8 w-8 p-0",toggleButton:(0,f.jsx)(i.MdOutlineMenu,{role:"none",size:F}),children:(0,f.jsx)(aH,{})}),r?.hasWindowBar&&(0,f.jsx)(ay.default,{headerRef:E,showMinimize:I,showMaximize:I,showClose:I})]})]})})};var aP=a.i(189416),aQ=a.i(569598),aR=a.i(754454),aS=R,aT=a.i(698783);async function aU(a,b){let c=new aS.Channel;return b&&"object"==typeof b&&("action"in b&&b.action&&(c.onmessage=b.action,delete b.action),"item"in b&&b.item&&"object"==typeof b.item&&"About"in b.item&&b.item.About&&"object"==typeof b.item.About&&"icon"in b.item.About&&b.item.About.icon&&(b.item.About.icon=(0,aT.transformImage)(b.item.About.icon)),"icon"in b&&b.icon&&(b.icon=(0,aT.transformImage)(b.icon)),"items"in b&&b.items&&(b.items=b.items.map(function a(b){var c;return"rid"in b?[b.rid,b.kind]:("item"in b&&"object"==typeof b.item&&(null==(c=b.item.About)?void 0:c.icon)&&(b.item.About.icon=(0,aT.transformImage)(b.item.About.icon)),"icon"in b&&b.icon&&(b.icon=(0,aT.transformImage)(b.icon)),"items"in b&&b.items&&(b.items=b.items.map(a)),function a(b){var c;if("items"in b)b.items=null==(c=b.items)?void 0:c.map(b=>"rid"in b?b:a(b));else if("action"in b&&b.action){let a=new aS.Channel;return a.onmessage=b.action,delete b.action,{...b,handler:a}}return b}(b))}))),(0,aS.invoke)("plugin:menu|new",{kind:a,options:b,handler:c})}class aV extends aS.Resource{get id(){return(0,aR.__classPrivateFieldGet)(this,c,"f")}get kind(){return(0,aR.__classPrivateFieldGet)(this,d,"f")}constructor(a,b,e){super(a),c.set(this,void 0),d.set(this,void 0),(0,aR.__classPrivateFieldSet)(this,c,b,"f"),(0,aR.__classPrivateFieldSet)(this,d,e,"f")}}c=new WeakMap,d=new WeakMap;class aW extends aV{constructor(a,b){super(a,b,"MenuItem")}static async new(a){return aU("MenuItem",a).then(([a,b])=>new aW(a,b))}async text(){return(0,R.invoke)("plugin:menu|text",{rid:this.rid,kind:this.kind})}async setText(a){return(0,R.invoke)("plugin:menu|set_text",{rid:this.rid,kind:this.kind,text:a})}async isEnabled(){return(0,R.invoke)("plugin:menu|is_enabled",{rid:this.rid,kind:this.kind})}async setEnabled(a){return(0,R.invoke)("plugin:menu|set_enabled",{rid:this.rid,kind:this.kind,enabled:a})}async setAccelerator(a){return(0,R.invoke)("plugin:menu|set_accelerator",{rid:this.rid,kind:this.kind,accelerator:a})}}class aX extends aV{constructor(a,b){super(a,b,"Check")}static async new(a){return aU("Check",a).then(([a,b])=>new aX(a,b))}async text(){return(0,R.invoke)("plugin:menu|text",{rid:this.rid,kind:this.kind})}async setText(a){return(0,R.invoke)("plugin:menu|set_text",{rid:this.rid,kind:this.kind,text:a})}async isEnabled(){return(0,R.invoke)("plugin:menu|is_enabled",{rid:this.rid,kind:this.kind})}async setEnabled(a){return(0,R.invoke)("plugin:menu|set_enabled",{rid:this.rid,kind:this.kind,enabled:a})}async setAccelerator(a){return(0,R.invoke)("plugin:menu|set_accelerator",{rid:this.rid,kind:this.kind,accelerator:a})}async isChecked(){return(0,R.invoke)("plugin:menu|is_checked",{rid:this.rid})}async setChecked(a){return(0,R.invoke)("plugin:menu|set_checked",{rid:this.rid,checked:a})}}(b=e||(e={})).Add="Add",b.Advanced="Advanced",b.Bluetooth="Bluetooth",b.Bookmarks="Bookmarks",b.Caution="Caution",b.ColorPanel="ColorPanel",b.ColumnView="ColumnView",b.Computer="Computer",b.EnterFullScreen="EnterFullScreen",b.Everyone="Everyone",b.ExitFullScreen="ExitFullScreen",b.FlowView="FlowView",b.Folder="Folder",b.FolderBurnable="FolderBurnable",b.FolderSmart="FolderSmart",b.FollowLinkFreestanding="FollowLinkFreestanding",b.FontPanel="FontPanel",b.GoLeft="GoLeft",b.GoRight="GoRight",b.Home="Home",b.IChatTheater="IChatTheater",b.IconView="IconView",b.Info="Info",b.InvalidDataFreestanding="InvalidDataFreestanding",b.LeftFacingTriangle="LeftFacingTriangle",b.ListView="ListView",b.LockLocked="LockLocked",b.LockUnlocked="LockUnlocked",b.MenuMixedState="MenuMixedState",b.MenuOnState="MenuOnState",b.MobileMe="MobileMe",b.MultipleDocuments="MultipleDocuments",b.Network="Network",b.Path="Path",b.PreferencesGeneral="PreferencesGeneral",b.QuickLook="QuickLook",b.RefreshFreestanding="RefreshFreestanding",b.Refresh="Refresh",b.Remove="Remove",b.RevealFreestanding="RevealFreestanding",b.RightFacingTriangle="RightFacingTriangle",b.Share="Share",b.Slideshow="Slideshow",b.SmartBadge="SmartBadge",b.StatusAvailable="StatusAvailable",b.StatusNone="StatusNone",b.StatusPartiallyAvailable="StatusPartiallyAvailable",b.StatusUnavailable="StatusUnavailable",b.StopProgressFreestanding="StopProgressFreestanding",b.StopProgress="StopProgress",b.TrashEmpty="TrashEmpty",b.TrashFull="TrashFull",b.User="User",b.UserAccounts="UserAccounts",b.UserGroup="UserGroup",b.UserGuest="UserGuest";class aY extends aV{constructor(a,b){super(a,b,"Icon")}static async new(a){return aU("Icon",a).then(([a,b])=>new aY(a,b))}async text(){return(0,R.invoke)("plugin:menu|text",{rid:this.rid,kind:this.kind})}async setText(a){return(0,R.invoke)("plugin:menu|set_text",{rid:this.rid,kind:this.kind,text:a})}async isEnabled(){return(0,R.invoke)("plugin:menu|is_enabled",{rid:this.rid,kind:this.kind})}async setEnabled(a){return(0,R.invoke)("plugin:menu|set_enabled",{rid:this.rid,kind:this.kind,enabled:a})}async setAccelerator(a){return(0,R.invoke)("plugin:menu|set_accelerator",{rid:this.rid,kind:this.kind,accelerator:a})}async setIcon(a){return(0,R.invoke)("plugin:menu|set_icon",{rid:this.rid,kind:this.kind,icon:(0,aT.transformImage)(a)})}}class aZ extends aV{constructor(a,b){super(a,b,"Predefined")}static async new(a){return aU("Predefined",a).then(([a,b])=>new aZ(a,b))}async text(){return(0,R.invoke)("plugin:menu|text",{rid:this.rid,kind:this.kind})}async setText(a){return(0,R.invoke)("plugin:menu|set_text",{rid:this.rid,kind:this.kind,text:a})}}var a$=a.i(17895);function a_([a,b,c]){switch(c){case"Submenu":return new a0(a,b);case"Predefined":return new aZ(a,b);case"Check":return new aX(a,b);case"Icon":return new aY(a,b);default:return new aW(a,b)}}class a0 extends aV{constructor(a,b){super(a,b,"Submenu")}static async new(a){return aU("Submenu",a).then(([a,b])=>new a0(a,b))}async text(){return(0,R.invoke)("plugin:menu|text",{rid:this.rid,kind:this.kind})}async setText(a){return(0,R.invoke)("plugin:menu|set_text",{rid:this.rid,kind:this.kind,text:a})}async isEnabled(){return(0,R.invoke)("plugin:menu|is_enabled",{rid:this.rid,kind:this.kind})}async setEnabled(a){return(0,R.invoke)("plugin:menu|set_enabled",{rid:this.rid,kind:this.kind,enabled:a})}async append(a){return(0,R.invoke)("plugin:menu|append",{rid:this.rid,kind:this.kind,items:(Array.isArray(a)?a:[a]).map(a=>"rid"in a?[a.rid,a.kind]:a)})}async prepend(a){return(0,R.invoke)("plugin:menu|prepend",{rid:this.rid,kind:this.kind,items:(Array.isArray(a)?a:[a]).map(a=>"rid"in a?[a.rid,a.kind]:a)})}async insert(a,b){return(0,R.invoke)("plugin:menu|insert",{rid:this.rid,kind:this.kind,items:(Array.isArray(a)?a:[a]).map(a=>"rid"in a?[a.rid,a.kind]:a),position:b})}async remove(a){return(0,R.invoke)("plugin:menu|remove",{rid:this.rid,kind:this.kind,item:[a.rid,a.kind]})}async removeAt(a){return(0,R.invoke)("plugin:menu|remove_at",{rid:this.rid,kind:this.kind,position:a}).then(a_)}async items(){return(0,R.invoke)("plugin:menu|items",{rid:this.rid,kind:this.kind}).then(a=>a.map(a_))}async get(a){return(0,R.invoke)("plugin:menu|get",{rid:this.rid,kind:this.kind,id:a}).then(a=>a?a_(a):null)}async popup(a,b){var c;return(0,R.invoke)("plugin:menu|popup",{rid:this.rid,kind:this.kind,window:null!=(c=null==b?void 0:b.label)?c:null,at:a instanceof a$.Position?a:a?new a$.Position(a):null})}async setAsWindowsMenuForNSApp(){return(0,R.invoke)("plugin:menu|set_as_windows_menu_for_nsapp",{rid:this.rid})}async setAsHelpMenuForNSApp(){return(0,R.invoke)("plugin:menu|set_as_help_menu_for_nsapp",{rid:this.rid})}async setIcon(a){return(0,R.invoke)("plugin:menu|set_icon",{rid:this.rid,kind:this.kind,icon:(0,aT.transformImage)(a)})}}class a1 extends aV{constructor(a,b){super(a,b,"Menu")}static async new(a){return aU("Menu",a).then(([a,b])=>new a1(a,b))}static async default(){return(0,R.invoke)("plugin:menu|create_default").then(([a,b])=>new a1(a,b))}async append(a){return(0,R.invoke)("plugin:menu|append",{rid:this.rid,kind:this.kind,items:(Array.isArray(a)?a:[a]).map(a=>"rid"in a?[a.rid,a.kind]:a)})}async prepend(a){return(0,R.invoke)("plugin:menu|prepend",{rid:this.rid,kind:this.kind,items:(Array.isArray(a)?a:[a]).map(a=>"rid"in a?[a.rid,a.kind]:a)})}async insert(a,b){return(0,R.invoke)("plugin:menu|insert",{rid:this.rid,kind:this.kind,items:(Array.isArray(a)?a:[a]).map(a=>"rid"in a?[a.rid,a.kind]:a),position:b})}async remove(a){return(0,R.invoke)("plugin:menu|remove",{rid:this.rid,kind:this.kind,item:[a.rid,a.kind]})}async removeAt(a){return(0,R.invoke)("plugin:menu|remove_at",{rid:this.rid,kind:this.kind,position:a}).then(a_)}async items(){return(0,R.invoke)("plugin:menu|items",{rid:this.rid,kind:this.kind}).then(a=>a.map(a_))}async get(a){return(0,R.invoke)("plugin:menu|get",{rid:this.rid,kind:this.kind,id:a}).then(a=>a?a_(a):null)}async popup(a,b){var c;return(0,R.invoke)("plugin:menu|popup",{rid:this.rid,kind:this.kind,window:null!=(c=null==b?void 0:b.label)?c:null,at:a instanceof a$.Position?a:a?new a$.Position(a):null})}async setAsAppMenu(){return(0,R.invoke)("plugin:menu|set_as_app_menu",{rid:this.rid}).then(a=>a?new a1(a[0],a[1]):null)}async setAsWindowMenu(a){var b;return(0,R.invoke)("plugin:menu|set_as_window_menu",{rid:this.rid,window:null!=(b=null==a?void 0:a.label)?b:null}).then(a=>a?new a1(a[0],a[1]):null)}}var a2=a.i(446338),a3=a.i(502299);let a4=(0,h.memo)(({book:a})=>{let b=(0,h.useMemo)(()=>a.progress&&a.progress[1]?a.progress&&1===a.progress[1]?100:Math.max(0,Math.min(100,Math.round(a.progress[0]/a.progress[1]*100))):null,[a]);return null===b||Number.isNaN(b)?null:(0,f.jsx)("div",{className:"text-neutral-content/70 flex justify-between text-xs",role:"status","aria-label":`${b}%`,children:(0,f.jsxs)("span",{children:[b,"%"]})})},(a,b)=>a.book.hash===b.book.hash&&a.book.updatedAt===b.book.updatedAt);a4.displayName="ReadingProgress";var a5=a.i(948449);let a6=({book:a,mode:b,coverFit:c,isSelectMode:d,bookSelected:e,transferProgress:h,handleBookUpload:k,handleBookDownload:n,showBookDetailsModal:o})=>{let p=(0,z.useTranslation)(),q=(0,j.useRouter)(),{user:r}=(0,x.useAuth)(),{appService:s}=(0,w.useEnv)(),t=(0,C.useResponsiveSize)(15);return(0,f.jsxs)("div",{role:"none",className:(0,g.default)("book-item flex","grid"===b&&"h-full flex-col justify-end","list"===b&&"h-28 flex-row gap-4 overflow-hidden","list"===b?"library-list-item":"library-grid-item",s?.hasContextMenu?"cursor-pointer":""),onClick:a=>a.stopPropagation(),children:[(0,f.jsxs)("div",{className:(0,g.default)("bookitem-main relative flex aspect-[28/41] justify-center rounded","crop"===c&&"overflow-hidden shadow-md","grid"===b&&"items-end","list"===b&&"min-w-20 items-center"),children:[(0,f.jsx)(a5.default,{mode:b,book:a,coverFit:c,showSpine:!1,imageClassName:"rounded shadow-md"}),e&&(0,f.jsx)("div",{className:"absolute inset-0 bg-black opacity-30 transition-opacity duration-300"}),d&&(0,f.jsx)("div",{className:"absolute bottom-1 right-1",children:e?(0,f.jsx)(i.MdCheckCircle,{className:"fill-blue-500"}):(0,f.jsx)(i.MdCheckCircleOutline,{className:"fill-gray-300 drop-shadow-sm"})})]}),(0,f.jsxs)("div",{className:(0,g.default)("flex w-full flex-col p-0","grid"===b&&"pt-2","list"===b&&"gap-2 py-0"),children:[(0,f.jsxs)("div",{className:(0,g.default)("min-w-0 flex-1","list"===b&&"flex flex-col gap-2"),children:[(0,f.jsx)("h4",{className:(0,g.default)("overflow-hidden text-ellipsis font-semibold","grid"===b&&"block whitespace-nowrap text-[0.6em] text-xs","list"===b&&"line-clamp-2 text-base"),children:a.title}),"list"===b&&(0,f.jsx)("p",{className:"text-neutral-content line-clamp-1 text-sm",children:(0,m.formatAuthors)(a.author,a.primaryLanguage)||""})]}),"list"===b&&(0,f.jsx)("h4",{className:"text-neutral-content line-clamp-1 text-sm",children:(0,m.formatDescription)(a.metadata?.description)}),(0,f.jsxs)("div",{className:(0,g.default)("flex items-center",a.progress?"justify-between":"justify-end"),style:{height:`${t}px`,minHeight:`${t}px`},children:[a.progress&&(0,f.jsx)(a4,{book:a}),(0,f.jsxs)("div",{className:"flex items-center justify-center gap-x-2",children:[!s?.isMobile&&(0,f.jsx)("button",{"aria-label":p("Show Book Details"),className:"show-detail-button -m-2 p-2 sm:opacity-0 sm:group-hover:opacity-100",onPointerDown:a=>a.stopPropagation(),onClick:()=>{o(a)},children:(0,f.jsx)("div",{className:"pt-[2px] sm:pt-[1px]",children:(0,f.jsx)(a3.LiaInfoCircleSolid,{size:t})})}),null!==h?100===h?null:(0,f.jsx)("div",{className:"radial-progress",style:{"--value":h,"--size":`${t}px`,"--thickness":"2px"},role:"progressbar"}):(!a.uploadedAt||a.uploadedAt&&!a.downloadedAt)&&(0,f.jsxs)("button",{className:"show-cloud-button -m-2 p-2",onPointerDown:a=>a.stopPropagation(),onClick:()=>{r?a.uploadedAt?a.downloadedAt||n(a,{queued:!0}):k(a):(0,l.navigateToLogin)(q)},children:[!a.uploadedAt&&(0,f.jsx)(a3.LiaCloudUploadAltSolid,{size:t}),a.uploadedAt&&!a.downloadedAt&&(0,f.jsx)(a3.LiaCloudDownloadAltSolid,{size:t})]})]})]})]})]})},a7=({mode:a,group:b,isSelectMode:c,groupSelected:d})=>{let{appService:e}=(0,w.useEnv)(),j=(0,C.useResponsiveSize)(15),k=(0,h.useRef)(null),[l,m]=(0,h.useState)(!1),[n,o]=(0,h.useState)(!1),p=()=>{if("list"===a&&k.current){let a=k.current;if(a.scrollWidth>a.clientWidth){let b=a.scrollLeft<=5,c=a.scrollLeft>=a.scrollWidth-a.clientWidth-5;m(!b),o(!c)}else m(!1),o(!1)}else m(!1),o(!1)};(0,h.useEffect)(()=>{if(p(),"list"===a&&k.current){let a=k.current;setTimeout(()=>{a.style.transform="translateZ(0)",a.scrollLeft=0},0)}},[a,b.books.length,k.current]);let q=a=>{a.preventDefault(),a.stopPropagation()};return(0,f.jsxs)("div",{className:(0,g.default)("group-item",e?.hasContextMenu?"cursor-pointer":""),children:[(0,f.jsxs)("div",{className:(0,g.default)("groupitem-main relative flex overflow-hidden rounded","grid"===a&&"bg-base-100 aspect-[28/41] items-center justify-center shadow-md","list"===a&&"items-center justify-start gap-4 py-2"),children:[(0,f.jsxs)("div",{className:(0,g.default)("grid"===a&&"flex h-full w-full p-2","list"===a&&"relative min-w-0 max-w-[85%]"),children:[(0,f.jsx)("div",{ref:"list"===a?k:void 0,className:(0,g.default)("grid"===a&&"grid w-full grid-cols-2 grid-rows-2 gap-1 overflow-hidden","list"===a&&"flex h-28 gap-2 overflow-x-auto overflow-y-hidden","list"===a?"library-list-item":"library-grid-item"),style:"list"===a?{scrollbarWidth:"none",msOverflowStyle:"none",WebkitOverflowScrolling:"touch",transform:"translateZ(0)",willChange:"scroll-position"}:void 0,onScroll:"list"===a?()=>{p()}:void 0,children:b.books.slice(0,"grid"===a?4:void 0).map(b=>(0,f.jsx)("div",{className:(0,g.default)("relative aspect-[28/41] h-full","grid"===a&&"w-full","list"===a&&"flex-shrink-0"),children:(0,f.jsx)(a5.default,{book:b,isPreview:!0,imageClassName:"rounded-[2px]"})},b.hash))}),"list"===a&&l&&(0,f.jsxs)("div",{className:"absolute left-[-0.5px] top-0 h-full w-12",children:[(0,f.jsx)("div",{className:"from-base-200/85 via-base-200/20 absolute inset-0 bg-gradient-to-r to-transparent"}),(0,f.jsx)("button",{onClick:a=>{if(a.preventDefault(),a.stopPropagation(),k.current){let a=k.current,b=.5*a.clientWidth,c=Math.max(0,a.scrollLeft-b);a.scrollTo({left:c,behavior:"smooth"})}},onPointerDown:a=>q(a),onPointerUp:a=>q(a),onPointerMove:a=>q(a),onPointerCancel:a=>q(a),onPointerLeave:a=>q(a),className:"absolute left-2 top-1/2 -translate-y-1/2 transition-all duration-200 hover:scale-110",children:(0,f.jsx)("div",{className:"bg-base-100 border-base-content/10 hover:border-base-content/30 rounded-full border p-1 shadow-sm transition-colors duration-200",children:(0,f.jsx)(i.MdChevronLeft,{size:16,className:"text-base-content/50 hover:text-base-content/70"})})})]}),"list"===a&&n&&(0,f.jsxs)("div",{className:"absolute right-[-0.5px] top-0 h-full w-12",children:[(0,f.jsx)("div",{className:"from-base-200/85 via-base-200/20 absolute inset-0 bg-gradient-to-l to-transparent"}),(0,f.jsx)("button",{onClick:a=>{if(a.preventDefault(),a.stopPropagation(),k.current){let a=k.current,b=.5*a.clientWidth,c=a.scrollLeft,d=Math.min(a.scrollWidth-a.clientWidth,c+b);a.scrollTo({left:d,behavior:"smooth"})}},onPointerDown:a=>q(a),onPointerUp:a=>q(a),onPointerMove:a=>q(a),onPointerCancel:a=>q(a),onPointerLeave:a=>q(a),className:"absolute right-2 top-1/2 -translate-y-1/2 transition-all duration-200 hover:scale-110",children:(0,f.jsx)("div",{className:"bg-base-100 border-base-content/10 hover:border-base-content/30 rounded-full border p-1 shadow-sm transition-colors duration-200",children:(0,f.jsx)(i.MdChevronRight,{size:16,className:"text-base-content/50 hover:text-base-content/70"})})})]})]}),"list"===a&&(0,f.jsx)("div",{className:"text-base-content/75 w-28 min-w-24 max-w-40 overflow-hidden text-ellipsis text-base font-semibold",children:b.displayName}),d&&(0,f.jsx)("div",{className:"absolute inset-0 bg-black opacity-30 transition-opacity duration-300"}),c&&(0,f.jsx)("div",{className:"absolute bottom-1 right-1",children:d?(0,f.jsx)(i.MdCheckCircle,{className:"fill-blue-500"}):(0,f.jsx)(i.MdCheckCircleOutline,{className:"fill-gray-300 drop-shadow-sm"})})]}),"grid"===a&&(0,f.jsxs)("div",{className:(0,g.default)("flex w-full flex-col pt-2"),children:[(0,f.jsx)("div",{className:"min-w-0 flex-1",children:(0,f.jsx)("h4",{className:"block overflow-hidden text-ellipsis whitespace-nowrap text-xs font-semibold",children:b.displayName})}),(0,f.jsx)("div",{className:"placeholder",style:{height:`${j}px`}})]})]})},a8=({mode:a,item:b,coverFit:c,isSelectMode:d,itemSelected:e,transferProgress:i,setLoading:k,toggleSelection:m,handleGroupBooks:p,handleBookUpload:q,handleBookDownload:r,handleSetSelectMode:s,handleShowDetailsBook:t})=>{let u=(0,z.useTranslation)(),v=(0,j.useRouter)(),x=(0,j.useSearchParams)(),{envConfig:y,appService:C}=(0,w.useEnv)(),{settings:D}=(0,B.useSettingsStore)(),{updateBook:E}=(0,A.useLibraryStore)(),G=(0,h.useCallback)(async a=>{t(a)},[]),H=async a=>{if(a.uploadedAt&&!a.downloadedAt){if(await C?.isBookAvailable(a))return a.downloadedAt&&a.coverDownloadedAt||(a.downloadedAt=Date.now(),a.coverDownloadedAt=Date.now(),await E(y,a)),!0;let b=!1,c=setTimeout(()=>k(!0),200);try{b=await r(a,{queued:!1}),await E(y,a)}finally{return c&&clearTimeout(c),k(!1),b}}return!0},I=(0,h.useCallback)(async a=>{if(d)m(a.hash);else{if(!await H(a))return;C?.hasWindow&&D.openBookInNewWindow?(0,l.showReaderWindow)(C,[a.hash]):setTimeout(()=>{(0,l.navigateToReader)(v,[a.hash])},0)}},[d,D.openBookInNewWindow,C]),J=(0,h.useCallback)(a=>{if(d)m(a.id);else{let b=new URLSearchParams(x?.toString());b.set("group",a.id),setTimeout(()=>{(0,l.navigateToLibrary)(v,`${b.toString()}`)},0)}},[d,x]),K=async a=>{if(!C?.hasContextMenu)return;let b=ak[(0,F.getOSPlatform)()]||ak.default,c=await aW.new({text:e?u("Deselect Book"):u("Select Book"),action:async()=>{d||s(!0),m(a.hash)}}),f=await aW.new({text:u("Group Books"),action:async()=>{d||s(!0),e||m(a.hash),p()}}),g=await aW.new({text:u(b),action:async()=>{let b=a.relativePath?`${D.localBooksDir}/${a.relativePath.replace(/\/[^/]+$/,"")}`:D.localBooksDir;(0,aj.revealItemInDir)(b)}}),h=await aW.new({text:u("Show Book Details"),action:async()=>{G(a)}}),i=await aW.new({text:u("Delete"),action:async()=>{n.eventDispatcher.dispatch("delete-books",{ids:[a.hash]})}}),j=await a1.new();j.append(c),j.append(f),j.append(h),j.append(g),j.append(i),j.popup()},L=async a=>{if(!C?.hasContextMenu)return;let b=await aW.new({text:e?u("Deselect Group"):u("Select Group"),action:async()=>{d||s(!0),m(a.id)}}),c=await aW.new({text:u("Group Books"),action:async()=>{d||s(!0),e||m(a.id),p()}}),f=await aW.new({text:u("Delete"),action:async()=>{n.eventDispatcher.dispatch("delete-books",{ids:[a.id]})}}),g=await a1.new();g.append(b),g.append(c),g.append(f),g.popup()},M=(0,h.useCallback)((0,o.throttle)(()=>{d||s(!0),"format"in b?m(b.hash):m(b.id)},100),[d]),N=(0,h.useCallback)((0,o.throttle)(()=>{d?M():"format"in b?I(b):J(b)},100),[M,I,J]),O=(0,h.useCallback)((0,o.throttle)(()=>{"format"in b?K(b):L(b)},100),[e,D.localBooksDir]),{pressing:P,handlers:Q}=(({onTap:a,onLongPress:b,onContextMenu:c,onCancel:d,threshold:e=500,moveThreshold:f=10},g)=>{let[i,j]=(0,h.useState)(!1),k=(0,h.useRef)(),l=(0,h.useRef)(null),m=(0,h.useRef)(null),n=(0,h.useRef)(!1),o=(0,h.useRef)(),p=(0,h.useRef)(!1),q=(0,h.useCallback)(()=>{j(!1),p.current=!1,l.current=null,m.current=null,clearTimeout(k.current)},[]),r=(0,h.useCallback)(a=>{("mouse"!==a.pointerType||0===a.button)&&(n.current=!0,clearTimeout(o.current),m.current=a.pointerId,l.current={x:a.clientX,y:a.clientY},p.current=!1,j(!0),k.current=setTimeout(()=>{l.current&&(p.current=!0,b?.(),j(!1))},e))},[b,e]),s=(0,h.useCallback)(a=>{if(a.pointerId!==m.current||!l.current)return;let b=Math.abs(a.clientX-l.current.x),c=Math.abs(a.clientY-l.current.y);(b>f||c>f)&&(d?.(),q())},[f,d,q]),t=(0,h.useCallback)(b=>{if(b.pointerId===m.current){if(!p.current&&l.current){let c=Math.abs(b.clientX-l.current.x),d=Math.abs(b.clientY-l.current.y);c<=f&&d<=f&&a?.()}q(),o.current=setTimeout(()=>{n.current=!1},200)}},[a,f,q]),u=(0,h.useCallback)(a=>{a.pointerId===m.current&&(d?.(),q(),o.current=setTimeout(()=>{n.current=!1},200))},[d,q]),v=(0,h.useCallback)(()=>{n.current||a?.()},[a]),w=(0,h.useCallback)(a=>{c&&(a.preventDefault(),a.stopPropagation(),c()),q()},[c,q]);return(0,h.useEffect)(()=>()=>{clearTimeout(k.current)},g),{pressing:i,handlers:{onPointerDown:r,onPointerUp:t,onPointerMove:s,onPointerCancel:u,onPointerLeave:u,onClick:v,onContextMenu:w}}})({onLongPress:()=>{M()},onTap:()=>{N()},onContextMenu:()=>{C?.hasContextMenu?O():C?.isAndroidApp&&M()}},[d,M,N,O]);return(0,f.jsx)("div",{className:(0,g.default)("list"===a&&"sm:hover:bg-base-300/50 px-4 sm:px-6"),children:(0,f.jsx)("div",{className:(0,g.default)("visible-focus-inset-2 group","grid"===a&&"sm:hover:bg-base-300/50 flex h-full flex-col px-0 py-2 sm:px-4 sm:py-4","list"===a&&"border-base-300 flex flex-col border-b py-2",C?.isMobileApp&&"no-context-menu",P&&"grid"===a?"not-eink:scale-95":"scale-100"),role:"button",tabIndex:0,"aria-label":"format"in b?b.title:b.name,style:{transition:"transform 0.2s"},onKeyDown:a=>{("Enter"===a.key||" "===a.key)&&(a.preventDefault(),N()),("ContextMenu"===a.key||a.shiftKey&&"F10"===a.key)&&(a.preventDefault(),O())},...Q,children:(0,f.jsx)("div",{className:"flex h-full flex-col justify-end",children:"format"in b?(0,f.jsx)(a6,{mode:a,book:b,coverFit:c,isSelectMode:d,bookSelected:e,transferProgress:i,handleBookUpload:q,handleBookDownload:r,showBookDetailsModal:G}):(0,f.jsx)(a7,{mode:a,group:b,isSelectMode:d,groupSelected:e})})})})};var a9=a.i(382541),ba=a.i(900616);let bb=({selectedBooks:a,safeAreaBottom:b,onOpen:c,onGroup:d,onDetails:e,onDelete:h,onCancel:j})=>{let k=(0,z.useTranslation)(),l=a.length>0,m=a.every(a=>(0,a2.isMd5)(a)),n=1===a.length,o=(0,ba.useKeyDownActions)({onCancel:j});return(0,f.jsx)("div",{ref:o,className:"fixed bottom-0 left-0 right-0 z-40",style:{paddingBottom:`${b+16}px`},children:(0,f.jsxs)("div",{className:(0,g.default)("text-base-content flex items-center justify-center text-xs shadow-lg","not-eink:bg-base-300 eink:bg-base-100 eink:border eink:border-base-content","mx-auto w-fit space-x-6 rounded-lg p-4"),children:[(0,f.jsxs)("button",{onClick:c,className:(0,g.default)("flex flex-col items-center justify-center gap-1",(!l||!m)&&"btn-disabled opacity-50"),children:[(0,f.jsx)(i.MdOpenInNew,{}),(0,f.jsx)("div",{children:k("Open")})]}),(0,f.jsxs)("button",{onClick:d,className:(0,g.default)("flex flex-col items-center justify-center gap-1",!l&&"btn-disabled opacity-50"),children:[(0,f.jsx)(a9.LuFolderPlus,{}),(0,f.jsx)("div",{children:k("Group")})]}),(0,f.jsxs)("button",{onClick:e,className:(0,g.default)("flex flex-col items-center justify-center gap-1",(!n||!m)&&"btn-disabled opacity-50"),children:[(0,f.jsx)(i.MdInfoOutline,{}),(0,f.jsx)("div",{children:k("Details")})]}),(0,f.jsxs)("button",{onClick:h,className:(0,g.default)("flex flex-col items-center justify-center gap-1",!l&&"btn-disabled opacity-50"),children:[(0,f.jsx)(i.MdDelete,{className:"text-red-500"}),(0,f.jsx)("div",{className:"text-red-500",children:k("Delete")})]}),(0,f.jsxs)("button",{onClick:j,className:"flex flex-col items-center justify-center gap-1",children:[(0,f.jsx)(i.MdOutlineCancel,{}),(0,f.jsx)("div",{children:k("Cancel")})]})]})})};var bc=a.i(995038);function bd(a){return(0,bc.GenIcon)({tag:"svg",attr:{fill:"none",viewBox:"0 0 24 24",strokeWidth:"2",stroke:"currentColor","aria-hidden":"true"},child:[{tag:"path",attr:{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 13h6m-3-3v6m-9 1V7a2 2 0 012-2h6l2 2h6a2 2 0 012 2v8a2 2 0 01-2 2H5a2 2 0 01-2-2z"},child:[]}]})(a)}function be(a){return(0,bc.GenIcon)({tag:"svg",attr:{fill:"none",viewBox:"0 0 24 24",strokeWidth:"2",stroke:"currentColor","aria-hidden":"true"},child:[{tag:"path",attr:{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 13h6M3 17V7a2 2 0 012-2h6l2 2h6a2 2 0 012 2v8a2 2 0 01-2 2H5a2 2 0 01-2-2z"},child:[]}]})(a)}function bf(a){return(0,bc.GenIcon)({tag:"svg",attr:{fill:"none",viewBox:"0 0 24 24",strokeWidth:"2",stroke:"currentColor","aria-hidden":"true"},child:[{tag:"path",attr:{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"},child:[]}]})(a)}let bg=({libraryBooks:a,selectedBooks:b,parentGroupName:c,onCancel:d,onConfirm:e})=>{let j=(0,z.useTranslation)(),{appService:k}=(0,w.useEnv)(),{setLibrary:l,addGroup:m,getGroups:n,getGroupId:o,getGroupsByParent:p,getParentPath:q,refreshGroups:r}=(0,A.useLibraryStore)(),[s,t]=(0,h.useState)(void 0),[u,v]=(0,h.useState)(!1),[x,y]=(0,h.useState)(""),[B,D]=(0,h.useState)(null),[E,F]=(0,h.useState)(null),[G,H]=(0,h.useState)(!1),[I,J]=(0,h.useState)(null),L=(0,ba.useKeyDownActions)({onCancel:d,onConfirm:e}),M=(0,h.useRef)(null),N=(0,C.useResponsiveSize)(16),O=n(),P=p(s),Q=!E||P.some(a=>a.id===E.id)||P.some(a=>E.name.startsWith(a.name))?P:[E,...P],R=b.some(a=>!(0,a2.isMd5)(a))||b.map(b=>a.find(a=>a.hash===b)?.groupId).some(a=>a&&a!==K.BOOK_UNGROUPED_NAME),S=1===b.length&&b.every(a=>!(0,a2.isMd5)(a)),T=S?O.find(a=>a.id===b[0]):null,U=()=>{let b=x.trim();if(b)if(G&&I)a.forEach(a=>{if(a.groupName===I){let c=b;a.relativePath&&k?.reclassifyBook&&k.reclassifyBook(a,c,I).catch(a=>{console.error("Failed to reclassify book files during rename:",a)}),a.groupName=c,a.groupId=o(a.groupName),a.updatedAt=Date.now()}else if(a.groupName?.startsWith(I+"/")){let c=a.groupName.replace(I,b);a.relativePath&&k?.reclassifyBook&&k.reclassifyBook(a,c,a.groupName).catch(a=>{console.error("Failed to reclassify book files during rename:",a)}),a.groupName=c,a.groupId=o(a.groupName),a.updatedAt=Date.now()}}),l([...a]),k?.saveLibraryBooks(a),r(),v(!1),H(!1),J(null);else{s&&!b.startsWith(s+"/")&&(b=`${s}/${b}`);let a=m(b);F(a),D(a),v(!1);let c=q(b);c&&t(c)}},V=a=>{t(a)},W=async()=>{b.forEach(b=>{for(let c of a.filter(a=>a.hash===b||a.groupId===b))if(c&&B){let a=c.groupName;c.groupId=B.id,c.groupName=B.name,c.updatedAt=Date.now(),c.relativePath&&k?.reclassifyBook&&k.reclassifyBook(c,B.name,a).catch(a=>{console.error("Failed to reclassify book files:",a)})}}),l([...a]),k?.saveLibraryBooks(a),e()};return(0,h.useEffect)(()=>{M.current&&M.current.select()},[u]),(0,h.useEffect)(()=>{r()},[r]),(0,h.useEffect)(()=>{let c=b.map(b=>a.find(a=>a.hash===b||a.groupId===b)?.groupId).filter(a=>a);1===Array.from(new Set(c)).length&&setTimeout(()=>{let a=n().find(a=>a.id===c[0]);D(a||null),a&&!s&&t(q(a.name))},0)},[]),(0,f.jsx)("div",{className:"fixed inset-0 flex items-center justify-center",children:(0,f.jsxs)("div",{ref:L,className:(0,g.default)("modal-box bg-base-100 overflow-y-auto rounded-2xl shadow-xl","max-h-[85%] w-[95%] min-w-64 max-w-[440px] p-6 sm:w-[70%]"),children:[(0,f.jsx)("h2",{className:"text-center text-lg font-bold",children:j("Group Books")}),(0,f.jsxs)("div",{className:(0,g.default)("mt-4 grid grid-cols-1 gap-2 text-base md:grid-cols-2"),children:[(0,f.jsxs)("button",{onClick:()=>{b.forEach(b=>{for(let c of a.filter(a=>a.hash===b||a.groupId===b))c&&c.groupId&&c.groupName&&c.groupId!==K.BOOK_UNGROUPED_ID&&c.groupName!==K.BOOK_UNGROUPED_NAME&&(c.groupId=void 0,c.groupName=void 0,c.updatedAt=Date.now())}),l([...a]),k?.saveLibraryBooks(a),e()},className:"flex items-center space-x-2 p-2 text-blue-500 disabled:text-gray-400",disabled:!R,children:[(0,f.jsx)(be,{size:N}),(0,f.jsx)("span",{className:"truncate",children:j("Remove From Group")})]}),(0,f.jsxs)("button",{onClick:()=>{let a,b,d,e,f,g;y((a=j("Untitled Group"),d=(b=c?`${c}/${a}`:s?`${s}/${a}`:a).replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),e=RegExp(`^${d}\\s*(\\d+)?$`),g=(f=O.map(a=>{let b=a.name.match(e);return b?parseInt(b[1]||"1",10):null}).filter(a=>null!==a)).length>0?Math.max(...f)+1:1,`${b} ${g}`)),v(!0),H(!1),J(null),D(null)},className:"flex items-center space-x-2 p-2 text-blue-500 disabled:text-gray-400",children:[(0,f.jsx)(bd,{size:N}),(0,f.jsx)("span",{className:"truncate",children:j("Create New Group")})]}),(0,f.jsxs)("button",{onClick:()=>{T&&(y(T.name),J(T.name),v(!0),H(!0))},className:"flex items-center space-x-2 p-2 text-blue-500 disabled:text-gray-400",disabled:!S,children:[(0,f.jsx)(i.MdEdit,{size:N}),(0,f.jsx)("span",{className:"truncate",children:j("Rename Group")})]})]}),u&&(0,f.jsx)("div",{className:"mt-4 space-y-2",children:(0,f.jsxs)("div",{className:"flex items-center gap-2",children:[(0,f.jsx)("input",{type:"text",ref:M,value:x,onChange:a=>y(a.target.value),onKeyDown:a=>{"Enter"===a.key&&U(),"Escape"===a.key&&(v(!1),H(!1),J(null)),a.stopPropagation()},className:"input input-ghost w-full border-0 px-2 text-base !outline-none sm:text-sm"}),(0,f.jsx)("button",{className:(0,g.default)("btn btn-ghost settings-content hover:bg-transparent","flex h-[1.3em] min-h-[1.3em] items-end p-0",x?"":"btn-disabled !bg-opacity-0"),onClick:()=>U(),children:(0,f.jsx)("div",{className:"pr-1 align-bottom text-base text-blue-500 sm:text-sm",children:j("Save")})})]})}),s&&(0,f.jsxs)("div",{className:"mt-4 flex flex-wrap items-center gap-2 text-base",children:[(0,f.jsx)("button",{onClick:()=>{t(s?q(s):void 0)},className:"hover:bg-base-300 flex items-center gap-1 rounded px-2 py-1",children:(0,f.jsx)(au.IoMdArrowBack,{size:N})}),(0,f.jsx)("button",{onClick:()=>V(void 0),className:"hover:bg-base-300 rounded px-2 py-1",children:j("All")}),aq(s).map((a,b,c)=>{let d=b===c.length-1;return(0,f.jsxs)(h.default.Fragment,{children:[(0,f.jsx)(i.MdChevronRight,{size:N,className:"text-neutral-content"}),d?(0,f.jsx)("span",{className:"truncate rounded px-2 py-1",children:a.name}):(0,f.jsx)("button",{onClick:()=>V(a.path),className:"hover:bg-base-300 truncate rounded px-2 py-1",children:a.name})]},b)})]}),(0,f.jsx)("ul",{className:"groups-list mt-4 grid grid-cols-2 gap-2 overflow-x-hidden",children:Q.map((a,b)=>{let c,d=(c=a.name.split("/"))[c.length-1],e=O.some(b=>b.name.startsWith(a.name+"/"));return(0,f.jsxs)("div",{className:"flex min-w-0 gap-1",children:[(0,f.jsxs)("button",{className:(0,g.default)("hover:bg-base-300 text-base-content flex min-w-0 max-w-[90%] flex-1","items-center justify-between gap-2 rounded-md px-2 py-2"),onClick:()=>{D(b=>b?.id===a.id?null:a)},children:[(0,f.jsxs)("div",{className:"flex min-w-0 flex-1 items-center gap-2",children:[(0,f.jsx)("span",{className:"shrink-0",children:(0,f.jsx)(bf,{size:N})}),(0,f.jsx)("span",{className:"min-w-0 truncate text-base sm:text-sm",children:d})]}),(0,f.jsx)("span",{className:"text-neutral-content flex shrink-0 text-sm",children:B&&B.id===a.id&&(0,f.jsx)(i.MdCheck,{className:"fill-blue-500",size:N})})]}),e&&(0,f.jsx)("button",{onClick:()=>{t(a.name)},className:"hover:bg-base-300 flex shrink-0 items-center rounded-md px-1",children:(0,f.jsx)(i.MdChevronRight,{size:N})})]},b)})}),(0,f.jsxs)("div",{className:"mt-6 flex justify-end gap-x-8 p-2",children:[(0,f.jsx)("button",{onClick:d,className:"flex items-center",children:j("Cancel")}),(0,f.jsx)("button",{onClick:W,className:(0,g.default)("flex items-center text-blue-500",!B&&"btn-disabled opacity-50"),children:j("Confirm")})]})]})})},bh=({libraryBooks:a,isSelectMode:b,isSelectAll:c,isSelectNone:d,handleImportBooks:e,handleBookUpload:i,handleBookDownload:k,handleBookDelete:o,handleSetSelectMode:p,handleShowDetailsBook:q,handlePushLibrary:r,booksTransferProgress:s})=>{let t=(0,z.useTranslation)(),u=(0,j.useRouter)(),v=(0,j.useSearchParams)(),{appService:x}=(0,w.useEnv)(),{settings:D}=(0,B.useSettingsStore)(),{safeAreaInsets:E}=(0,y.useThemeStore)(),F=v?.get("group")||"",G=v?.get("q")||null,H=v?.get("view")||D.libraryViewMode,I=v?.get("sort")||D.librarySortBy,J=v?.get("order")||(D.librarySortAscending?"asc":"desc"),L=v?.get("cover")||D.libraryCoverFit,[M,N]=(0,h.useState)(!1),[O,P]=(0,h.useState)(!1),[Q,R]=(0,h.useState)([]),[S,T]=(0,h.useState)(!1),[U,V]=(0,h.useState)(!1),[W]=(0,h.useState)(v?.get("url")||""),X=(0,h.useRef)(!1),Y=(0,h.useRef)(!1),Z=(0,C.useResponsiveSize)(15),$=(0,aP.useAutoFocus)(),{setCurrentBookshelf:_,setLibrary:ab}=(0,A.useLibraryStore)(),{setSelectedBooks:ac,getSelectedBooks:ad,toggleSelectedBook:ae}=(0,A.useLibraryStore)(),{getGroupName:af}=(0,A.useLibraryStore)(),ag=localStorage?.getItem("i18nextLng")||"",ah=(0,h.useCallback)(a=>{let b=new URLSearchParams(v?.toString());Object.entries(a).forEach(([a,c])=>{null===c||""===c?b.delete(a):b.set(a,c)}),"updated"===b.get("sort")&&b.delete("sort"),"desc"===b.get("order")&&b.delete("order"),"crop"===b.get("cover")&&b.delete("cover"),"grid"===b.get("view")&&b.delete("view");let c=b.toString();c!==(v?.toString()||"")&&(0,l.navigateToLibrary)(u,c)},[u,v]),ai=(0,h.useMemo)(()=>{let b=a=>{let b;if(!G)return!0;if(a.deletedAt)return!1;try{b=RegExp(G,"i")}catch{let b=G.toLowerCase(),c=(0,m.formatTitle)(a.title).toLowerCase(),d=(0,m.formatAuthors)(a.author).toLowerCase();return c.includes(b)||d.includes(b)||a.format.toLowerCase().includes(b)||a.groupName&&a.groupName.toLowerCase().includes(b)||a.metadata?.description&&a.metadata.description.toLowerCase().includes(b)}let c=(0,m.formatTitle)(a.title),d=(0,m.formatAuthors)(a.author);return b.test(c)||b.test(d)||b.test(a.format)||a.groupName&&b.test(a.groupName)||a.metadata?.description&&b.test(a.metadata?.description)};return G?a.filter(a=>b(a)):a},[a,G]),aj=(0,h.useMemo)(()=>{let a,b=af(F)||"";return F&&!b?[]:((a=ai.reduce((a,c)=>{if(c.deletedAt||b&&(!c.groupName||!c.groupName.startsWith(b)))return a;c.groupId=c.groupId||K.BOOK_UNGROUPED_ID,c.groupName=c.groupName||K.BOOK_UNGROUPED_NAME;let d=c.groupName.indexOf("/",b.length+1),e=c.groupName.substring(b?b.length+1:0,d>0?d:void 0),f=b?`${b}${e?`/${e}`:""}`:e,g=a.findIndex(a=>a.name===f||b&&a.name===b||e===K.BOOK_UNGROUPED_NAME&&a.name===K.BOOK_UNGROUPED_NAME),h=a[g];return h?(h.books.push(c),h.updatedAt=Math.max(h.updatedAt,c.updatedAt)):a.push({id:f===b?K.BOOK_UNGROUPED_ID:(0,a2.md5Fingerprint)(f),name:f===b?K.BOOK_UNGROUPED_NAME:f,displayName:e,books:[c],updatedAt:c.updatedAt}),a},[])).forEach(a=>{a.books.sort((a,b)=>b.updatedAt-a.updatedAt)}),[...a.find(a=>a.name===K.BOOK_UNGROUPED_NAME||a.name===b)?.books||[],...a.filter(a=>a.name!==K.BOOK_UNGROUPED_NAME&&a.name!==b)].sort((a,b)=>b.updatedAt-a.updatedAt))},[ai,F,af]);(0,h.useEffect)(()=>{F&&0===aj.length?ah({group:null}):ah({})},[v,F,aj.length,ah]);let ak=(0,h.useMemo)(()=>{let a=(a,b)=>{switch(I){case"title":let c=(0,m.formatTitle)(a.title),d=(0,m.formatTitle)(b.title);return c.localeCompare(d,ag||navigator.language);case"author":let e=(0,m.formatAuthors)(a.author,a?.primaryLanguage||"en",!0),f=(0,m.formatAuthors)(b.author,b?.primaryLanguage||"en",!0);return e.localeCompare(f,ag||navigator.language);case"updated":default:return new Date(a.updatedAt).getTime()-new Date(b.updatedAt).getTime();case"created":return new Date(a.createdAt).getTime()-new Date(b.createdAt).getTime();case"format":return a.format.localeCompare(b.format,ag||navigator.language);case"published":let g=a.metadata?.published||"0001-01-01",h=b.metadata?.published||"0001-01-01",i=new Date(g).getTime(),j=new Date(h).getTime();if(isNaN(i)&&isNaN(j))return g.localeCompare(h,ag||navigator.language);if(isNaN(i))return 1;if(isNaN(j))return -1;return i-j}},b="asc"===J?1:-1;return aj.sort((c,d)=>{if("updated"===I)return(new Date(c.updatedAt).getTime()-new Date(d.updatedAt).getTime())*b;if("name"in c||"name"in d){let a="name"in c?c.name:(0,m.formatTitle)(c.title),e="name"in d?d.name:(0,m.formatTitle)(d.title);return a.localeCompare(e,ag||navigator.language)*b}return"name"in c||"name"in d?0:a(c,d)*b})},[J,I,ag,aj]);(0,h.useEffect)(()=>{!Y.current&&(Y.current=!0,W&&x&&(async()=>{console.log("Importing book from URL:",W);let b=await x.importBook(W,a);b&&(ab(a),x.saveLibraryBooks(a),(0,l.navigateToReader)(u,[b.hash]))})())},[W,x]),(0,h.useEffect)(()=>{_(aj)},[aj,_]);let al=(0,h.useCallback)(a=>{ae(a)},[ae]),am=()=>{let a=[];return Q.forEach(b=>{for(let c of ai.filter(a=>a.hash===b||a.groupId===b))c&&!c.deletedAt&&a.push(c)}),a},an=async()=>{let a=am();for(let b=0;b<a.length;b+=20){if(X.current){X.current=!1;break}let c=a.slice(b,b+20);await Promise.all(c.map(a=>o(a,!1)))}r(),ac([]),T(!1),P(!0)},ao=()=>{P(!1),V(!0)},ap=a=>{let{ids:b}=a.detail;R(b),P(!1),T(!0)};(0,h.useEffect)(()=>{b?(P(!0),c?ac(aj.map(a=>"hash"in a?a.hash:a.id)):d&&ac([])):(ac([]),P(!1))},[b,c,d,aj]),(0,h.useEffect)(()=>(n.eventDispatcher.on("delete-books",ap),()=>{n.eventDispatcher.off("delete-books",ap)}),[]);let aq=ad();return(0,f.jsxs)("div",{className:"bookshelf",children:[(0,f.jsxs)("div",{ref:$,tabIndex:-1,className:(0,g.default)("bookshelf-items transform-wrapper focus:outline-none","grid"===H&&"grid flex-1 grid-cols-3 gap-x-4 px-4 sm:gap-x-0 sm:px-2","grid"===H&&"sm:grid-cols-4 md:grid-cols-6 xl:grid-cols-8 2xl:grid-cols-12","list"===H&&"flex flex-col"),style:{gridTemplateColumns:"grid"!==H||D.libraryAutoColumns?void 0:`repeat(${D.libraryColumns}, minmax(0, 1fr))`},role:"main","aria-label":t("Bookshelf"),children:[ak.map(a=>(0,f.jsx)(a8,{item:a,mode:H,coverFit:L,isSelectMode:b,itemSelected:"hash"in a?aq.includes(a.hash):aq.includes(a.id),setLoading:N,toggleSelection:al,handleGroupBooks:ao,handleBookUpload:i,handleBookDownload:k,handleBookDelete:o,handleSetSelectMode:p,handleShowDetailsBook:q,transferProgress:"hash"in a&&s[a.hash]||null},`library-item-${"hash"in a?a.hash:a.id}`)),"grid"===H&&aj.length>0&&(0,f.jsx)("div",{className:(0,g.default)("mx-0 my-2 sm:mx-4 sm:my-4"),style:"fit"===L&&"grid"===H?{display:"flex",paddingBottom:`${Z+24}px`}:void 0,children:(0,f.jsx)("button",{"aria-label":t("Import Books"),className:(0,g.default)("bookitem-main bg-base-100 hover:bg-base-300/50","flex items-center justify-center","aspect-[28/41] w-full"),onClick:e,children:(0,f.jsx)("div",{className:"flex items-center justify-center",children:(0,f.jsx)(at.PiPlus,{className:"size-10",color:"gray"})})})})]}),M&&(0,f.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:(0,f.jsx)(ar.default,{loading:!0})}),!U&&b&&O&&(0,f.jsx)(bb,{selectedBooks:aq,safeAreaBottom:E?.bottom||0,onOpen:()=>{p(!1),x?.hasWindow&&D.openBookInNewWindow?(0,l.showReaderWindow)(x,ad()):(setTimeout(()=>N(!0),200),(0,l.navigateToReader)(u,ad()))},onGroup:ao,onDetails:()=>{p(!1);let b=ad(),c=a.find(a=>a.hash===b[0]);c&&q(c)},onDelete:()=>{R(ad()),P(!1),T(!0)},onCancel:()=>p(!1)}),U&&aq.length>0&&(0,f.jsx)(aa,{children:(0,f.jsx)(bg,{libraryBooks:a,selectedBooks:aq,parentGroupName:af(F)||"",onCancel:()=>{V(!1),P(!0)},onConfirm:()=>{V(!1),p(!1)}})}),S&&(0,f.jsx)("div",{className:(0,g.default)("delete-alert fixed bottom-0 left-0 right-0 z-50 flex justify-center"),style:{paddingBottom:`${(E?.bottom||0)+16}px`},children:(0,f.jsx)(aQ.default,{title:t("Confirm Deletion"),message:t("Are you sure to delete {{count}} selected book(s)?",{count:am().length}),onCancel:()=>{X.current=!0,T(!1),P(!0)},onConfirm:an})})]})};var bi=a.i(466939);let bj=()=>{let a=(0,z.useTranslation)();return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)("div",{className:"drag-overlay"}),(0,f.jsx)("div",{className:"drop-indicator",children:(0,f.jsxs)("div",{className:"flex flex-col items-center justify-center",children:[(0,f.jsx)(bi.HiArrowDownTray,{className:"h-12 w-12"}),(0,f.jsx)("p",{className:"mt-2 font-medium",children:a("Drop to Import Books")})]})})]})};var bk=a.i(642196);let bl=({status:a,type:b,size:c})=>{switch(a){case"completed":return(0,f.jsx)(i.MdCheckCircle,{className:"text-success",size:c});case"failed":return(0,f.jsx)(i.MdError,{className:"text-error",size:c});case"cancelled":return(0,f.jsx)(i.MdCancel,{className:"text-warning",size:c});default:return"upload"===b?(0,f.jsx)(i.MdCloudUpload,{className:"text-primary",size:c}):"delete"===b?(0,f.jsx)(i.MdDeleteSweep,{className:"text-primary",size:c}):(0,f.jsx)(i.MdCloudDownload,{className:"text-primary",size:c})}},bm=({transfer:a,onCancel:b,onRetry:c,iconSize:d})=>{let e,g,h,j,k,l,m,n=(0,z.useTranslation)(),o={upload:n("Uploaded"),download:n("Downloaded"),delete:n("Deleted")};return(0,f.jsxs)("div",{className:"hover:bg-base-200 flex items-center gap-3 rounded-lg p-3",children:[(0,f.jsx)(bl,{status:a.status,type:a.type,size:d}),(0,f.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,f.jsx)("div",{className:"truncate font-medium",children:a.bookTitle}),(0,f.jsxs)("div",{className:"text-base-content/60 text-xs",children:["in_progress"===a.status&&(0,f.jsxs)(f.Fragment,{children:[Math.round(a.progress),"% - ",(e=a.transferSpeed,`${(a=>{if(0===a)return"0 B";let b=Math.floor(Math.log(a)/Math.log(1024));return`${parseFloat((a/Math.pow(1024,b)).toFixed(1))} ${["B","KB","MB","GB"][b]}`})(e)}/s`)]}),"pending"===a.status&&a.error&&(0,f.jsx)("span",{className:"text-warning",children:a.error}),"pending"===a.status&&!a.error&&n("Waiting..."),"failed"===a.status&&(0,f.jsx)("span",{className:"text-error",children:a.error||n("Failed")}),"completed"===a.status&&(o[a.type]||n("Completed")),"cancelled"===a.status&&n("Cancelled")," Â· ",(g=new Date(a.completedAt||a.startedAt||a.createdAt),h=new Date,j=g.toDateString()===h.toDateString(),(k=new Date(h)).setDate(k.getDate()-1),l=g.toDateString()===k.toDateString(),m=g.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),j?m:l?`Yesterday ${m}`:g.toLocaleDateString([],{month:"short",day:"numeric"})+" "+m)]}),"in_progress"===a.status&&(0,f.jsx)("div",{className:"bg-base-300 mt-1 h-1.5 w-full overflow-hidden rounded-full",children:(0,f.jsx)("div",{className:"bg-primary h-full transition-all",style:{width:`${a.progress}%`}})})]}),(0,f.jsxs)("div",{className:"flex items-center gap-1",children:[("failed"===a.status||"cancelled"===a.status)&&(0,f.jsx)("button",{onClick:()=>c(a.id),className:"btn btn-ghost btn-sm btn-circle","aria-label":n("Retry"),children:(0,f.jsx)(i.MdRefresh,{size:d})}),["pending","in_progress"].includes(a.status)&&(0,f.jsx)("button",{onClick:()=>b(a.id),className:"btn btn-ghost btn-sm btn-circle","aria-label":n("Cancel"),children:(0,f.jsx)(i.MdClose,{size:d})})]})]})},bn=()=>{let a=(0,z.useTranslation)(),b=(0,C.useResponsiveSize)(18),c=(0,M.useTransferStore)(a=>a.setIsTransferQueueOpen),d=(0,A.useLibraryStore)(a=>a.getVisibleLibrary),{transfers:e,stats:j,isQueuePaused:k,cancelTransfer:l,retryTransfer:m,retryAllFailed:n,pauseQueue:o,resumeQueue:p,clearCompleted:q,clearFailed:r,queueUpload:s,queueDownload:t}=(0,ao.useTransferQueue)(),[u,v]=(0,h.useState)("all"),w=()=>c(!1),x=(0,ba.useKeyDownActions)({onCancel:w,onConfirm:w}),y=d().filter(a=>a.downloadedAt&&!a.uploadedAt),B=d().filter(a=>a.uploadedAt&&!a.downloadedAt),D=e.filter(a=>{switch(u){case"active":return["pending","in_progress"].includes(a.status);case"completed":return"completed"===a.status;case"failed":return"failed"===a.status||"cancelled"===a.status;default:return!0}}).sort((a,b)=>{let c={in_progress:0,pending:1,failed:2,cancelled:3,completed:4},d=c[a.status]-c[b.status];return 0!==d?d:b.createdAt-a.createdAt}),E={all:a("All"),active:a("Active"),completed:a("Completed"),failed:a("Failed")};return(0,f.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[(0,f.jsx)("div",{className:"absolute inset-0 bg-black/50",onClick:w}),(0,f.jsxs)("div",{ref:x,className:(0,g.default)("modal-box bg-base-100 relative flex max-h-[85%] min-h-[65%] w-[95%] flex-col rounded-2xl p-0 shadow-xl","min-w-64 max-w-lg overflow-hidden"),children:[(0,f.jsxs)("div",{className:"border-base-300 flex items-center justify-between border-b p-4",children:[(0,f.jsx)("h2",{className:"text-lg font-semibold",children:a("Transfer Queue")}),(0,f.jsxs)("div",{className:"flex items-center gap-2",children:[y.length>0&&(0,f.jsxs)("button",{onClick:()=>{y.forEach(a=>s(a))},className:"btn btn-ghost btn-sm gap-1",title:a("Upload All"),"aria-label":a("Upload All"),children:[(0,f.jsx)(i.MdCloudUpload,{size:b}),(0,f.jsx)("span",{className:"text-xs",children:y.length})]}),B.length>0&&(0,f.jsxs)("button",{onClick:()=>{B.forEach(a=>t(a))},className:"btn btn-ghost btn-sm gap-1",title:a("Download All"),"aria-label":a("Download All"),children:[(0,f.jsx)(i.MdCloudDownload,{size:b}),(0,f.jsx)("span",{className:"text-xs",children:B.length})]}),(0,f.jsx)("button",{onClick:k?p:o,className:"btn btn-ghost btn-sm btn-circle",title:a(k?"Resume Transfers":"Pause Transfers"),"aria-label":a(k?"Resume Transfers":"Pause Transfers"),children:k?(0,f.jsx)(i.MdPlayArrow,{size:b}):(0,f.jsx)(i.MdPause,{size:b})}),(0,f.jsx)("button",{onClick:w,className:"btn btn-ghost btn-sm btn-circle",title:a("Close"),"aria-label":a("Close"),children:(0,f.jsx)(i.MdClose,{size:b})})]})]}),(0,f.jsxs)("div",{className:"bg-base-200 flex items-center gap-4 px-4 py-2 text-sm",children:[(0,f.jsxs)("span",{children:[a("Active"),": ",j.active]}),(0,f.jsxs)("span",{children:[a("Pending"),": ",j.pending]}),(0,f.jsxs)("span",{children:[a("Completed"),": ",j.completed]}),(0,f.jsxs)("span",{children:[a("Failed"),": ",j.failed]})]}),(0,f.jsx)("div",{className:"border-base-300 flex gap-2 border-b p-4",children:["all","active","completed","failed"].map(a=>(0,f.jsx)("button",{onClick:()=>v(a),className:(0,g.default)("rounded-lg px-3 py-1 text-sm transition-colors",u===a?"bg-primary text-primary-content":"bg-base-200 hover:bg-base-300"),children:E[a]},a))}),(0,f.jsx)("div",{className:"flex-1 overflow-y-auto p-2",children:0===D.length?(0,f.jsx)("div",{className:"text-base-content/60 py-8 text-center",children:a("No transfers")}):D.map(a=>(0,f.jsx)(bm,{transfer:a,onCancel:l,onRetry:m,iconSize:b},a.id))}),(0,f.jsxs)("div",{className:"border-base-300 flex items-center justify-between border-t p-4",children:[(0,f.jsx)("div",{className:"flex items-center gap-2",children:j.failed>0&&(0,f.jsxs)("button",{onClick:n,className:"btn btn-ghost btn-sm gap-1",children:[(0,f.jsx)(i.MdRefresh,{size:b-2}),a("Retry All")]})}),(0,f.jsxs)("div",{className:"flex items-center gap-2",children:[j.completed>0&&(0,f.jsxs)("button",{onClick:q,className:"btn btn-ghost btn-sm gap-1",children:[(0,f.jsx)(i.MdDeleteSweep,{size:b-2}),a("Clear Completed")]}),j.failed>0&&(0,f.jsxs)("button",{onClick:r,className:"btn btn-ghost btn-sm gap-1",children:[(0,f.jsx)(i.MdDeleteSweep,{size:b-2}),a("Clear Failed")]})]})]})]})]})},bo=({isOpen:a,onClose:b,onConfirm:c,reconcileBookPaths:d,applyReconciliation:e,books:g})=>{let[j,k]=(0,h.useState)(!1),[l,m]=(0,h.useState)(!1),[n,o]=(0,h.useState)(null),[p,q]=(0,h.useState)(new Set);if(!a)return null;let r=async()=>{k(!0),m(!1);try{let a=await d(g);if(o(a),m(!0),a.results){let b=a.results.filter(a=>"moved"===a.status).map(a=>a.hash);q(new Set(b))}}catch(a){console.error("è·¯å¾„æ ¡å‡†å¤±è´¥:",a),alert("è·¯å¾„æ ¡å‡†å¤±è´¥ï¼Œè¯·æŸ¥çœ‹æŽ§åˆ¶å°æ—¥å¿—")}finally{k(!1)}},s=async()=>{if(!n||!n.results)return;let a=n.results.filter(a=>p.has(a.hash));try{await e(g,a),c(a),b()}catch(a){console.error("åº”ç”¨æ ¡å‡†ç»“æžœå¤±è´¥:",a),alert("åº”ç”¨æ ¡å‡†ç»“æžœå¤±è´¥ï¼Œè¯·æŸ¥çœ‹æŽ§åˆ¶å°æ—¥å¿—")}};return(0,f.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",children:(0,f.jsxs)("div",{className:"bg-base-100 rounded-2xl shadow-xl w-full max-w-4xl max-h-[80vh] overflow-hidden flex flex-col",children:[(0,f.jsxs)("div",{className:"px-6 py-4 border-b border-base-300",children:[(0,f.jsxs)("h2",{className:"text-xl font-bold flex items-center gap-2",children:[(0,f.jsx)(i.MdSync,{size:24}),"ä¹¦ç±è·¯å¾„æ ¡å‡†"]}),(0,f.jsx)("p",{className:"text-sm text-base-content/70 mt-2",children:"æ‰«ææ–‡ä»¶ç³»ç»Ÿï¼Œæ£€æµ‹ä¹¦ç±æ–‡ä»¶ä½ç½®å˜åŒ–å¹¶åŒæ­¥åˆ°ä¹¦åº“"})]}),(0,f.jsx)("div",{className:"flex-1 overflow-y-auto px-6 py-4",children:l?(0,f.jsxs)("div",{children:[n?.summary&&(0,f.jsxs)("div",{className:"stats stats-horizontal shadow w-full mb-6",children:[(0,f.jsxs)("div",{className:"stat",children:[(0,f.jsx)("div",{className:"stat-title",children:"æ€»è®¡"}),(0,f.jsx)("div",{className:"stat-value text-2xl",children:n.summary.total})]}),(0,f.jsxs)("div",{className:"stat",children:[(0,f.jsx)("div",{className:"stat-title",children:"åŒ¹é…"}),(0,f.jsx)("div",{className:"stat-value text-2xl text-success",children:n.summary.matched})]}),(0,f.jsxs)("div",{className:"stat",children:[(0,f.jsx)("div",{className:"stat-title",children:"å·²ç§»åŠ¨"}),(0,f.jsx)("div",{className:"stat-value text-2xl text-warning",children:n.summary.moved})]}),(0,f.jsxs)("div",{className:"stat",children:[(0,f.jsx)("div",{className:"stat-title",children:"ä¸¢å¤±"}),(0,f.jsx)("div",{className:"stat-value text-2xl text-error",children:n.summary.missing})]})]}),n?.results&&n.results.length>0&&(0,f.jsxs)("div",{className:"space-y-2",children:[(0,f.jsx)("h3",{className:"font-semibold mb-2",children:"è¯¦ç»†ç»“æžœ"}),n.results.filter(a=>"matched"!==a.status).map(a=>(0,f.jsx)("div",{className:"card bg-base-200 shadow-sm hover:shadow-md transition-shadow",children:(0,f.jsx)("div",{className:"card-body p-4",children:(0,f.jsxs)("div",{className:"flex items-start gap-3",children:["moved"===a.status&&(0,f.jsx)("input",{type:"checkbox",className:"checkbox checkbox-primary mt-1",checked:p.has(a.hash),onChange:()=>{var b;let c;return b=a.hash,void((c=new Set(p)).has(b)?c.delete(b):c.add(b),q(c))}}),(0,f.jsxs)("div",{className:"flex-1",children:[(0,f.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(a=>{switch(a){case"matched":return(0,f.jsx)(i.MdCheckCircle,{className:"text-success",size:20});case"moved":return(0,f.jsx)(i.MdWarning,{className:"text-warning",size:20});case"missing":return(0,f.jsx)(i.MdError,{className:"text-error",size:20});default:return null}})(a.status),(0,f.jsx)("span",{className:"font-semibold",children:(a=>{switch(a){case"matched":return"è·¯å¾„åŒ¹é…";case"moved":return"æ–‡ä»¶å·²ç§»åŠ¨";case"missing":return"æ–‡ä»¶ä¸¢å¤±";default:return a}})(a.status)})]}),a.oldRelativePath&&(0,f.jsxs)("div",{className:"text-sm",children:[(0,f.jsx)("span",{className:"text-base-content/60",children:"åŽŸè·¯å¾„: "}),(0,f.jsx)("span",{className:"font-mono",children:a.oldRelativePath})]}),a.newRelativePath&&"moved"===a.status&&(0,f.jsxs)("div",{className:"text-sm",children:[(0,f.jsx)("span",{className:"text-base-content/60",children:"æ–°è·¯å¾„: "}),(0,f.jsx)("span",{className:"font-mono text-success",children:a.newRelativePath})]}),void 0!==a.suggestedGroupName&&(0,f.jsxs)("div",{className:"text-sm",children:[(0,f.jsx)("span",{className:"text-base-content/60",children:"å»ºè®®åˆ†ç»„: "}),(0,f.jsx)("span",{className:"badge badge-primary badge-sm",children:a.suggestedGroupName||"æœªåˆ†ç»„"})]}),a.message&&(0,f.jsx)("div",{className:"text-xs text-base-content/50 mt-1",children:a.message})]})]})})},a.hash))]}),n?.unmatchedFiles&&n.unmatchedFiles.length>0&&(0,f.jsxs)("div",{className:"mt-6",children:[(0,f.jsx)("h3",{className:"font-semibold mb-2",children:"æœªåŒ¹é…çš„æ–‡ä»¶"}),(0,f.jsx)("p",{className:"text-sm text-base-content/60 mb-2",children:"è¿™äº›æ–‡ä»¶å­˜åœ¨äºŽæ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œä½†ä¸åœ¨ä¹¦åº“è®°å½•ä¸­"}),(0,f.jsx)("div",{className:"space-y-1 max-h-40 overflow-y-auto",children:n.unmatchedFiles.map(a=>(0,f.jsx)("div",{className:"text-sm font-mono bg-base-300 px-3 py-2 rounded",children:a},a))})]})]}):(0,f.jsxs)("div",{className:"text-center py-12",children:[(0,f.jsx)("button",{onClick:r,disabled:j,className:"btn btn-primary btn-lg",children:j?(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)("span",{className:"loading loading-spinner"}),"æ‰«æä¸­..."]}):(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(i.MdSync,{size:20}),"å¼€å§‹æ‰«æ"]})}),(0,f.jsx)("p",{className:"text-sm text-base-content/60 mt-4",children:"ç‚¹å‡»å¼€å§‹æ‰«ææ–‡ä»¶ç³»ç»Ÿï¼ŒæŸ¥æ‰¾è·¯å¾„ä¸ä¸€è‡´çš„ä¹¦ç±"})]})}),(0,f.jsxs)("div",{className:"px-6 py-4 border-t border-base-300 flex justify-end gap-3",children:[(0,f.jsx)("button",{onClick:b,className:"btn btn-ghost",children:"å–æ¶ˆ"}),l&&n?.summary?.moved>0&&(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)("button",{onClick:r,className:"btn btn-ghost",children:"é‡æ–°æ‰«æ"}),(0,f.jsxs)("button",{onClick:s,className:"btn btn-primary",disabled:0===p.size,children:["åº”ç”¨é€‰ä¸­çš„è°ƒæ•´ (",p.size,")"]})]})]})]})})},bp=()=>{let a=(0,j.useSearchParams)();return(0,f.jsx)(bq,{searchParams:a})},bq=({searchParams:a})=>{let b=(0,j.useRouter)(),{envConfig:c,appService:d}=(0,w.useEnv)(),{token:e,user:G}=(0,x.useAuth)(),{library:H,isSyncing:R,syncProgress:X,updateBook:Y,updateBooks:Z,setLibrary:$,getGroupId:_,getGroupName:ab,refreshGroups:ac,checkOpenWithBooks:ad,checkLastOpenBooks:ae,setCheckOpenWithBooks:ag,setCheckLastOpenBooks:ah}=(0,A.useLibraryStore)(),ai=(0,z.useTranslation)(),{selectFiles:aj}=(0,P.useFileSelector)(d,ai),{safeAreaInsets:ak,isRoundedWindow:al}=(0,y.useThemeStore)(),{clearBookData:am}=(0,L.useBookDataStore)(),{settings:as,setSettings:at,saveSettings:au}=(0,B.useSettingsStore)(),{isSettingsDialogOpen:av,setSettingsDialogOpen:aw}=(0,B.useSettingsStore)(),{isTransferQueueOpen:ay}=(0,M.useTransferStore)(),[az,aA]=(0,h.useState)(a?.get("opds")==="true"),[aB,aC]=(0,h.useState)(!1),[aD,aE]=(0,h.useState)(!1),[aF,aG]=(0,h.useState)(!1),[aH,aI]=(0,h.useState)(!1),[aJ,aK]=(0,h.useState)(!1),[aL,aM]=(0,h.useState)(null),[aN,aP]=(0,h.useState)(!1),[aQ,aR]=(0,h.useState)(void 0),[aS,aT]=(0,h.useState)({}),[aU,aV]=(0,h.useState)(null),aW=(0,h.useRef)(!1),aX=(0,C.useResponsiveSize)(18),aY=as.globalViewSettings,aZ=(()=>{let{envConfig:a}=(0,w.useEnv)(),[b,c]=(0,h.useState)([]),d=(0,h.useRef)(!1);return(0,h.useEffect)(()=>{if(d.current)return;d.current=!0;let b=(0,F.getUserLang)(),e=async()=>{try{let d=await a.getAppService(),e=I[b]||I.en,f=await Promise.all(e.library.map(a=>d.importBook(a,[],!1,!0)));c(f.filter(a=>null!==a))}catch(a){console.error("Failed to import demo books:",a)}},f=localStorage.getItem("demoBooksFetched");(0,s.isWebAppPlatform)()&&!f&&(e(),localStorage.setItem("demoBooksFetched","true"))},[]),b})(),a$=(0,h.useRef)(null),a_=(0,h.useRef)(null),a0=(0,h.useRef)(null);(0,D.useTheme)({systemUIVisible:!0,appThemeColor:"base-200"}),(0,E.useUICSS)(),(0,O.useOpenWithBooks)(),(0,ao.useTransferQueue)(aD);let{pullLibrary:a1,pushLibrary:a2}=(()=>{let{user:a}=(0,x.useAuth)(),{appService:b}=(0,w.useEnv)(),{library:c,isSyncing:d,setLibrary:e,setIsSyncing:f,setSyncProgress:g}=(0,A.useLibraryStore)(),{useSyncInited:i,syncedBooks:j,syncBooks:k,lastSyncedAtBooks:l}=(0,J.useSync)(),m=(0,h.useRef)(!1),n=(0,h.useCallback)(()=>a?{books:A.useLibraryStore.getState().library.filter(a=>!a.syncedAt||l<a.updatedAt||l<(a.deletedAt??0)),lastSyncedAt:l}:{},[a,l]),p=(0,h.useCallback)(async()=>{if(a){if(m.current)return void console.log("Pull already in progress, skipping...");try{m.current=!0,await k([],"pull")}finally{m.current=!1}}},[a,k]),q=(0,h.useCallback)((0,o.throttle)(()=>{let a=n();a.lastSyncedAt&&k(a.books,"both")},1e3*K.SYNC_BOOKS_INTERVAL_SEC,{emitLast:!0}),[k]);(0,h.useEffect)(()=>{!a||m.current||q()},[a,c,q]);let r=(0,h.useCallback)(async()=>{if(!a)return;let b=n();b.lastSyncedAt&&await k(b?.books,"push")},[a,k,n]);(0,h.useEffect)(()=>{a&&i&&p()},[a,i,p]);let s=async()=>{if(d||!j?.length)return;j.sort((a,b)=>a.updatedAt-b.updatedAt);let a=new Set(j.map(a=>a.hash)),h=c.filter(b=>a.has(b.hash)).filter(a=>!a.deletedAt&&a.uploadedAt&&!a.coverDownloadedAt),i=async a=>{let c=j.find(b=>b.hash===a.hash);return c?(c.deletedAt||!c.uploadedAt||a.coverDownloadedAt||(a.coverImageUrl=await b?.generateCoverImageUrl(a)),c.updatedAt>=a.updatedAt?{...a,...c,syncedAt:Date.now()}:{...c,...a,syncedAt:Date.now()}):a};for(let a=0;a<h.length;a+=100)console.log("Skipping cloud cover download for",h.slice(a,a+100).length,"books");let k=await Promise.all(c.map(i));e(k),b?.saveLibraryBooks(k);let l=new Set(k.map(a=>a.hash)),m=j.filter(a=>!l.has(a.hash)&&a.uploadedAt&&!a.deletedAt),n=async a=>{a.coverImageUrl=await b?.generateCoverImageUrl(a),a.syncedAt=Date.now(),k.push(a)};m.length>0&&f(!0);try{for(let a=0;a<m.length;a+=10){let c=m.slice(a,a+10);console.log("Skipping cloud cover download for",c.length,"books"),await Promise.all(c.map(n));let d=Math.min((a+10)/m.length,1);g(d),e([...k]),b?.saveLibraryBooks(k)}}catch(a){console.error("Error updating new books:",a)}finally{m.length>0&&f(!1)}};return(0,h.useEffect)(()=>{s()},[j]),{pullLibrary:p,pushLibrary:r}})(),{isDragging:a3}=(()=>{let a=(0,z.useTranslation)(),b=(0,j.useSearchParams)(),c=b?.get("group")||"",{appService:d}=(0,w.useEnv)(),[e,f]=(0,h.useState)(!1),g=async b=>{if(0===b.length)return;let e=b.filter(a=>{let b;return b="string"==typeof a?a.split(".").pop()?.toLowerCase():a.name.split(".").pop()?.toLowerCase(),K.BOOK_ACCEPT_FORMATS.includes(`.${b}`)});if(0===e.length)return void n.eventDispatcher.dispatch("toast",{message:a("No supported files found. Supported formats: {{formats}}",{formats:K.BOOK_ACCEPT_FORMATS}),type:"error"});d?.hasHaptics&&(0,u.impactFeedback)("medium");let f=e.map(a=>({file:"string"==typeof a?void 0:a,path:"string"==typeof a?a:void 0}));n.eventDispatcher.dispatch("import-book-files",{files:f,groupId:c})},i=a=>{a.preventDefault(),a.stopPropagation(),f(!0)},k=a=>{a.preventDefault(),a.stopPropagation(),f(!1)},l=async a=>{a.preventDefault(),a.stopPropagation(),f(!1),a.dataTransfer?.files&&a.dataTransfer.files.length>0&&g(Array.from(a.dataTransfer.files))};return(0,h.useEffect)(()=>{let a=document.querySelector(".library-page");if(d?.isMobile||(a?.addEventListener("dragover",i),a?.addEventListener("dragleave",k),a?.addEventListener("drop",l)),(0,s.isTauriAppPlatform)()){let a=(0,v.getCurrentWebview)().onDragDropEvent(a=>{"over"===a.payload.type?f(!0):"drop"===a.payload.type?(f(!1),g(a.payload.paths)):f(!1)});return()=>{a.then(a=>a())}}return()=>{d?.isMobile||(a?.removeEventListener("dragover",i),a?.removeEventListener("dragleave",k),a?.removeEventListener("drop",l))}},[c]),{isDragging:e}})();(0,h.useEffect)(()=>{let a=a_.current;if(a)return a.addEventListener("touchstart",b,{passive:!0}),()=>{a.removeEventListener("touchstart",b)};function b(a){let b=a_.current;if(!b||b.scrollTop>0)return;let c=a.touches[0].clientX,d=a.touches[0].clientY;function e(a){let b,e=a_.current;if(!e)return;let g=a.touches[0].clientX,h=a.touches[0].clientY-d;if(h<0||2*Math.abs(g-c)>Math.abs(h))return;let i=e.parentNode;h>120?(b=i.querySelector(".pull-indicator"))&&!b.classList.contains("flip")&&b.classList.add("flip"):h>60?function(a){let b=a.querySelector(".pull-indicator");if(b){b.classList.contains("flip")&&b.classList.remove("flip");return}let c=document.querySelector(".titlebar"),d=document.createElement("div"),e=c?.getBoundingClientRect().bottom||0;d.style.top=`${e+30}px`,d.className="pull-indicator text-gray-500",d.innerHTML=`
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 19c-.3 0-.6-.1-.8-.3l-6-6c-.4-.4-.4-1 0-1.4s1-.4 1.4 0L11 16.2V5c0-.6.4-1 1-1s1 .4 1 1v11.2l4.4-4.4c.4-.4 1-.4 1.4 0s.4 1 0 1.4l-6 6c-.2.2-.5.3-.8.3z"/>
          </svg>
        `,a.appendChild(d)}(i):f(i);let j=e.querySelector(".transform-wrapper");j&&(j.style.transform=`translate3d(0, ${128*(1-Math.exp(-.4*h/128))}px, 0)`)}function f(a){let b=a.querySelector(".pull-indicator");b&&b.remove()}function g(){let a=a_.current;a&&(a.style.transition="",a.removeEventListener("transitionend",g))}b.addEventListener("touchmove",e,{passive:!0}),b.addEventListener("touchend",function a(b){let c=a_.current;if(!c)return;let h=c.querySelector(".transform-wrapper");h&&(h.style.transform="translateY(0)"),f(c.parentNode),c.style.transition="transform 0.2s",b.changedTouches[0].clientY-d>120&&a1(),c.addEventListener("transitionend",g),c.removeEventListener("touchmove",e),c.removeEventListener("touchend",a)})}},[a_.current]),(0,N.useScreenWakeLock)(as.screenWakeLock),(0,ax.default)({onToggleFullscreen:async()=>{(0,s.isTauriAppPlatform)()&&await (0,T.tauriHandleToggleFullScreen)()},onCloseWindow:async()=>{(0,s.isTauriAppPlatform)()&&await (0,T.tauriHandleClose)()},onQuitApp:async()=>{(0,s.isTauriAppPlatform)()&&await (0,T.tauriQuitApp)()},onOpenFontLayoutSettings:()=>{aw(!0)},onOpenBooks:()=>{bd()}}),(0,h.useEffect)(()=>{sessionStorage.setItem("lastLibraryParams",a?.toString()||"")},[a]),(0,h.useEffect)(()=>{let a=async()=>{d?.hasUpdater&&as.autoCheckUpdates?await (0,t.checkForAppUpdates)(ai):d?.hasUpdater===!1&&(0,t.checkAppReleaseNotes)()};as.alwaysOnTop&&(0,T.tauriHandleSetAlwaysOnTop)(as.alwaysOnTop),a()},[d?.hasUpdater,as]),(0,h.useEffect)(()=>{d?.isMobileApp&&(0,Q.lockScreenOrientation)({orientation:"auto"})},[d]);let a4=(0,h.useCallback)(async()=>{let a=await c.getAppService(),b=await a.loadSettings(),d=await a.loadLibraryBooks();at(b),$(d)},[c,d]);(0,h.useEffect)(()=>{if(d?.hasWindow){let a=(0,v.getCurrentWebview)().listen("close-reader-window",async()=>{a4()});return()=>{a.then(a=>a())}}},[d,a4]);let a5=(0,h.useCallback)(async a=>{let b=a.detail.files,c=a.detail.groupId||"";0!==b.length&&await a8(b,c)},[]);(0,h.useEffect)(()=>(n.eventDispatcher.on("import-book-files",a5),()=>{n.eventDispatcher.off("import-book-files",a5)}),[a5]),(0,h.useEffect)(()=>{ac(),H.some(a=>!a.deletedAt)||bf(!1)},[H]);let a6=(0,h.useCallback)(async(a,b,c)=>{let d=await a.loadSettings(),e=[];for(let f of b){console.log("Open with book:",f);try{let b=!a.isMobile&&!d.autoImportBooksOnOpen,g=await a.importBook(f,c,!0,!0,!1,b);g&&e.push(g.hash),G&&g&&!b&&!g.uploadedAt&&d.autoUpload&&setTimeout(()=>{console.log("Queueing upload for book:",g.title),p.transferManager.queueUpload(g)},3e3)}catch(a){console.log("Failed to import book:",f,a)}}return $(c),a.saveLibraryBooks(c),console.log("Opening books:",e),e.length>0&&(aV(e),!0)},[]),a7=async(a,b,c)=>{if(0===b.length)return!1;let d=[];for(let e of b){let b=c.find(a=>a.hash===e);b&&await a.isBookAvailable(b)&&d.push(b.hash)}return console.log("Opening last books:",d),d.length>0&&(aV(d),!0)};(0,h.useEffect)(()=>{aU&&(aV(null),aU.length>0&&(0,l.navigateToReader)(b,aU))},[aU,d,b]),(0,h.useEffect)(()=>{if(aW.current)return;aW.current=!0;let a=async()=>{let a=await c.getAppService(),d=await a.loadSettings();e&&G?d.keepLogin||(d.keepLogin=!0,at(d),au(c,d)):d.keepLogin&&b.push("/auth")},d=setTimeout(()=>aC(!0),300),f=async()=>{let a=await c.getAppService(),b=await a.loadSettings();at(b);let e=H.length>0?H:await a.loadLibraryBooks(),f=!1;ad&&(f=await g(a,e)),ag(f),!f&&ae&&b.openLastBooks&&(f=await a7(a,b.lastOpenBooks,e)),ah(f),$(e),aE(!0),d&&clearTimeout(d),aC(!1)},g=async(a,b)=>{let c=await (0,r.parseOpenWithFiles)(a)||[];return c.length>0&&await a6(a,c,b)};return a(),f(),()=>{ag(!1),ah(!1),aW.current=!1}},[a]),(0,h.useEffect)(()=>{aR(ab(a?.get("group")||""))},[H,a,ab]),(0,h.useEffect)(()=>{if(aZ.length>0&&aD){let a=[...H];for(let b of aZ){let c=a.findIndex(a=>a.hash===b.hash);-1===c?a.push(b):a[c]=b}$(a),d?.saveLibraryBooks(a)}},[aZ,aD]);let a8=async(a,b)=>{aC(!0);let{library:e}=A.useLibraryStore.getState(),f=[],g=[],h=[["No chapters detected",ai("No chapters detected")],["Failed to parse EPUB",ai("Failed to parse the EPUB file")],["Unsupported format",ai("This book format is not supported")],["Failed to open file",ai("Failed to open the book file")],["Invalid or empty book file",ai("The book file is empty")],["Unsupported or corrupted book file",ai("The book file is corrupted")]],i=async a=>{let c=a.file||a.path;if(!c)return null;try{let{path:f,basePath:h}=a,i="";if(b)i=ab(b)||"";else if(f&&h){let a=(0,q.getDirPath)(h);i=(0,q.getDirPath)(f).replace(a,"").replace(/^\//,"")}let j=await d?.importBook(c,e,!0,!0,!1,!1,{targetGroupName:i});if(!j)return null;return b?(j.groupId=b,j.groupName=i):i&&(j.groupName=i,j.groupId=_(i)),G&&!j.uploadedAt&&as.autoUpload&&(console.log("Queueing upload for book:",j.title),p.transferManager.queueUpload(j)),g.push(j.title),j}catch(e){let a="string"==typeof c?c:c.name,b=(0,q.getFilename)(a),d=e instanceof Error?h.find(([a])=>e.message.includes(a))?.[1]||e.message:"";return f.push({filename:b,errorMessage:d}),console.error("Failed to import book:",a,e),null}};for(let b=0;b<a.length;b+=4){let d=a.slice(b,b+4),e=(await Promise.all(d.map(i))).filter(a=>!!a);await Z(c,e)}if(a2(),f.length>0){let a=f.map(a=>a.filename),b=f.find(a=>a.errorMessage)?.errorMessage||"";n.eventDispatcher.dispatch("toast",{message:ai("Failed to import book(s): {{filenames}}",{filenames:(0,m.listFormater)(!1).format(a)})+(b?`
${b}`:""),timeout:5e3,type:"error"})}else g.length>0&&n.eventDispatcher.dispatch("toast",{message:ai("Successfully imported {{count}} book(s)",{count:g.length}),timeout:2e3,type:"success"});aC(!1)};(0,o.throttle)((a,b)=>{if(0===b.total)return;let c=b.progress/b.total*100;aT(b=>({...b,[a]:c}))},500);let a9=(0,h.useCallback)(async(a,b=!0)=>!!p.transferManager.queueUpload(a,1)&&(n.eventDispatcher.dispatch("toast",{type:"info",timeout:2e3,message:ai("Upload queued: {{title}}",{title:a.title})}),!0),[]),ba=(0,h.useCallback)(async(a,b={})=>(n.eventDispatcher.dispatch("toast",{message:ai("Cloud download has been removed. All books are stored locally on the server."),type:"info"}),!1),[d]),bb=a=>async(b,e=!0)=>{let f={both:ai("Book deleted: {{title}}",{title:b.title}),cloud:ai("Deleted cloud backup of the book: {{title}}",{title:b.title}),local:ai("Deleted local copy of the book: {{title}}",{title:b.title})},g={both:ai("Failed to delete book: {{title}}",{title:b.title}),cloud:ai("Failed to delete cloud backup of the book: {{title}}",{title:b.title}),local:ai("Failed to delete local copy of the book: {{title}}",{title:b.title})};try{if(("local"===a||"both"===a)&&(await d?.deleteBook(b,"local"),"both"===a&&(b.deletedAt=Date.now(),b.downloadedAt=null,b.coverDownloadedAt=null),await Y(c,b),am(b.hash),e&&a2()),("cloud"===a||"both"===a)&&!p.transferManager.queueDelete(b,1,!0))throw Error("Failed to queue cloud deletion");return n.eventDispatcher.dispatch("toast",{type:"info",timeout:1e3,message:f[a]}),!0}catch{return n.eventDispatcher.dispatch("toast",{message:g[a],type:"error"}),!1}},bc=async(a,b)=>{if(a.metadata=b,a.title=(0,m.formatTitle)(b.title),a.author=(0,m.formatAuthors)(b.author),a.primaryLanguage=(0,m.getPrimaryLanguage)(b.language),a.updatedAt=Date.now(),b.coverImageBlobUrl||b.coverImageUrl||b.coverImageFile){a.coverImageUrl=b.coverImageBlobUrl||b.coverImageUrl;try{await d?.updateCoverImage(a,b.coverImageBlobUrl||b.coverImageUrl,b.coverImageFile)}catch(a){console.warn("Failed to update cover image:",a)}}(0,s.isWebAppPlatform)()?b.coverImageBlobUrl&&(b.coverImageUrl=void 0):b.coverImageUrl=void 0,b.coverImageBlobUrl=void 0,b.coverImageFile=void 0,await Y(c,a)},bd=async()=>{aG(!1),console.log("Importing books from files..."),aj({type:"books",multiple:!0}).then(b=>{if(0===b.files.length||b.error)return;let c=a?.get("group")||"";a8(b.files,c)})},be=async()=>{if(!d||!(0,s.isTauriAppPlatform)())return;aG(!1),console.log("Importing books from directory...");let a="";if(d.isAndroidApp){if(!await S())return;a=(await (0,Q.selectDirectory)()).path}else a=await d.selectDirectory?.("read");if(!a)return void console.log("No directory selected");let b=(await d.readDirectory(a,"None")).filter(a=>{let b=a.path.split(".").pop()?.toLowerCase()||"";return K.SUPPORTED_BOOK_EXTS.includes(b)});a8(await Promise.all(b.map(async b=>({path:await (0,q.joinPaths)(a,b.path),basePath:a}))),void 0)},bf=a=>{a&&d?.hasHaptics&&(0,u.impactFeedback)("medium"),aG(a),aI(!1),aK(!1)},bg=c=>{let d=c?_(c):"",e=new URLSearchParams(a?.toString());d?e.set("group",d):e.delete("group"),aI(!1),aK(!1),(0,l.navigateToLibrary)(b,`${e.toString()}`),setTimeout(()=>{aR(c)},300)};if(!d||!ak||ad||ae)return(0,f.jsx)("div",{className:(0,g.default)("full-height",!d?.isLinuxApp&&"bg-base-200")});let bi=aD||H.length>0;return(0,f.jsxs)("div",{ref:a0,"aria-label":"Your Library",className:(0,g.default)("library-page text-base-content full-height flex select-none flex-col overflow-hidden",aY?.isEink?"bg-base-100":"bg-base-200",d?.hasRoundedWindow&&al&&"window-border rounded-window"),children:[(0,f.jsxs)("div",{className:"relative top-0 z-40 w-full",role:"banner",tabIndex:-1,"aria-label":ai("Library Header"),children:[(0,f.jsx)(aO,{isSelectMode:aF,isSelectAll:aH,onImportBooksFromFiles:bd,onImportBooksFromDirectory:d?.canReadExternalDir?be:void 0,onOpenCatalogManager:()=>{aA(!0)},onToggleSelectMode:()=>bf(!aF),onSelectAll:()=>{aI(!0),aK(!1)},onDeselectAll:()=>{aK(!0),aI(!1)},onReconcilePaths:()=>aP(!0)}),(0,f.jsx)("progress",{className:(0,g.default)("progress progress-success absolute bottom-0 left-0 right-0 h-1 translate-y-[2px] transition-opacity duration-200 sm:translate-y-[4px]",R?"opacity-100":"opacity-0"),value:100*X,max:"100"})]}),(aB||R)&&(0,f.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:(0,f.jsx)(ar.default,{loading:!0})}),aQ&&(0,f.jsx)("div",{className:`transition-all duration-300 ease-in-out ${aQ?"opacity-100":"max-h-0 opacity-0"}`,children:(0,f.jsxs)("div",{className:"flex flex-wrap items-center gap-y-1 px-4 text-base",children:[(0,f.jsx)("button",{onClick:()=>bg(void 0),className:"hover:bg-base-300 text-base-content/85 rounded px-2 py-1",children:ai("All")}),aq(aQ).map((a,b,c)=>{let d=b===c.length-1;return(0,f.jsxs)(h.Fragment,{children:[(0,f.jsx)(i.MdChevronRight,{size:aX,className:"text-neutral-content"}),d?(0,f.jsx)("span",{className:"truncate rounded px-2 py-1",children:a.name}):(0,f.jsx)("button",{onClick:()=>bg(a.path),className:"hover:bg-base-300 text-base-content/85 truncate rounded px-2 py-1",children:a.name})]},b)})]})}),bi&&(H.some(a=>!a.deletedAt)?(0,f.jsx)(k.OverlayScrollbarsComponent,{defer:!0,"aria-label":"",ref:a$,className:"flex-grow",options:{scrollbars:{autoHide:"scroll"}},events:{initialized:a=>{let{content:b}=a.elements();b&&(a_.current=b)}},children:(0,f.jsxs)("div",{className:(0,g.default)("scroll-container drop-zone flex-grow",a3&&"drag-over"),style:{paddingTop:"0px",paddingRight:`${ak.right}px`,paddingBottom:`${ak.bottom}px`,paddingLeft:`${ak.left}px`},children:[(0,f.jsx)(bj,{}),(0,f.jsx)(bh,{libraryBooks:H,isSelectMode:aF,isSelectAll:aH,isSelectNone:aJ,handleImportBooks:bd,handleBookUpload:a9,handleBookDownload:ba,handleBookDelete:bb("both"),handleSetSelectMode:bf,handleShowDetailsBook:a=>{aM(a)},booksTransferProgress:aS,handlePushLibrary:a2})]})}):(0,f.jsxs)("div",{className:"hero drop-zone h-screen items-center justify-center",children:[(0,f.jsx)(bj,{}),(0,f.jsx)("div",{className:"hero-content text-neutral-content text-center",children:(0,f.jsxs)("div",{className:"max-w-md",children:[(0,f.jsx)("h1",{className:"mb-5 text-5xl font-bold",children:ai("Your Library")}),(0,f.jsx)("p",{className:"mb-5",children:ai("Welcome to your library. You can import your books here and read them anytime.")}),(0,f.jsx)("button",{className:"btn btn-primary rounded-xl",onClick:bd,children:ai("Import Books")})]})})]})),aL&&(0,f.jsx)(V.BookDetailModal,{isOpen:!!aL,book:aL,onClose:()=>aM(null),handleBookUpload:a9,handleBookDownload:ba,handleBookDelete:bb("both"),handleBookDeleteCloudBackup:bb("cloud"),handleBookDeleteLocalCopy:bb("local"),handleBookMetadataUpdate:bc}),ay&&(0,f.jsx)(aa,{children:(0,f.jsx)(bn,{})}),(0,f.jsx)(U.AboutWindow,{}),(0,f.jsx)(W.UpdaterWindow,{}),(0,f.jsx)(an,{}),av&&(0,f.jsx)(bk.default,{bookKey:""}),az&&(0,f.jsx)(af,{onClose:()=>{aA(!1);let c=new URLSearchParams(a?.toString());c.delete("opds"),(0,l.navigateToLibrary)(b,`${c.toString()}`)}}),aN&&d&&(0,f.jsx)(bo,{isOpen:aN,onClose:()=>aP(!1),onConfirm:a=>{console.log("æ ¡å‡†å®Œæˆï¼Œæ›´æ–°äº†",a.length,"æœ¬ä¹¦"),aP(!1),a4()},reconcileBookPaths:d.reconcileBookPaths.bind(d),applyReconciliation:d.applyReconciliation.bind(d),books:H}),(0,f.jsx)(ap.Toast,{})]})};a.s(["default",0,()=>(0,f.jsx)(h.Suspense,{fallback:(0,f.jsx)("div",{className:"full-height"}),children:(0,f.jsx)(bp,{})})],393121)}];

//# sourceMappingURL=apps_readest-app_src_app_library_page_tsx_2546fd29._.js.map