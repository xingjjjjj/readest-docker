module.exports=[587995,a=>{"use strict";let b="http://www.w3.org/XML/1998/namespace",c="http://www.w3.org/2001/10/synthesis",d=new Set(["article","aside","audio","blockquote","caption","details","dialog","div","dl","dt","dd","figure","footer","form","figcaption","h1","h2","h3","h4","h5","h6","header","hgroup","hr","li","main","math","nav","ol","p","pre","section","tr"]),e=a=>a.lang||a?.getAttributeNS?.(b,"lang")||(a.parentElement?e(a.parentElement):null),f=a=>a?.getAttributeNS?.(b,"lang")||(a.parentElement?f(a.parentElement):null),g=a=>!a.toString().trim();class h{#a=[];#b;#c=-1;#d;constructor(a,b=a=>a){this.#b=a,this.#d=b}current(){if(this.#a[this.#c])return this.#d(this.#a[this.#c])}first(){if(this.#a[0])return this.#c=0,this.#d(this.#a[0])}prev(){let a=this.#c-1;if(this.#a[a])return this.#c=a,this.#d(this.#a[a])}next(){let a=this.#c+1;if(this.#a[a])return this.#c=a,this.#d(this.#a[a]);for(;;){let{done:b,value:c}=this.#b.next();if(b)break;if(this.#a.push(c),this.#a[a])return this.#c=a,this.#d(this.#a[a])}}find(a){let b=this.#a.findIndex(b=>a(b));if(b>-1)return this.#c=b,this.#d(this.#a[b]);for(;;){let{done:b,value:c}=this.#b.next();if(b)break;if(this.#a.push(c),a(c))return this.#c=this.#a.length-1,this.#d(c)}}}class i{#e;#f;#g;#h=new XMLSerializer;constructor(a,i,j,k,l){this.doc=a,this.highlight=k,this.#e=new h(function*(a){let b,c=a.createTreeWalker(a.body,NodeFilter.SHOW_ELEMENT);for(let e=c.nextNode();e;e=c.nextNode()){let c=e.tagName.toLowerCase();d.has(c)&&(b&&(b.setEndBefore(e),g(b)||(yield b)),(b=a.createRange()).setStart(e,0))}b||(b=a.createRange()).setStart(a.body.firstChild??a.body,0),b.setEndAfter(a.body.lastChild??a.body),g(b)||(yield b)}(a),a=>{let{entries:d,ssml:g}=((a,d,g,h)=>{let i=e(a.commonAncestorContainer),j=f(a.commonAncestorContainer),k=((a="en",b="word")=>{let c=new Intl.Segmenter(a,{granularity:b}),d="word"===b;return function*(a,b){let e=a.join("").replace(/\r\n/g,"  ").replace(/\r/g," ").replace(/\n/g," "),f=0,g=-1,h=0,i=Array.from(c.segment(e)),j=[];for(let a=0;a<i.length;a++){let b=i[a],c=i[a+1],d=b.segment.trim(),e=c?.segment?.trim(),f=/(?:^|\s)([A-Z][a-z]{1,5})\.$/.test(d),g=/^[A-Z]/.test(e||"");if(f&&g){let d={index:b.index,segment:b.segment+(c?.segment||""),isWordLike:!0};j.push(d),a++}else j.push(b)}for(let{index:c,segment:i,isWordLike:k}of j){if(d&&!k)continue;for(;h<=c;)h+=a[++g].length;let j=g,l=c-(h-a[g].length),m=c+i.length-1;if(m<e.length)for(;h<=m;)h+=a[++g].length;let n=g,o=m-(h-a[g].length)+1;yield[(f++).toString(),b(j,l,n,o)]}}})(i,h),l=a.cloneContents(),m=[...d(a,k,g)];for(let[a,b]of[...d(l,k,g)]){let c=document.createElement("foliate-mark");c.dataset.name=a,b.insertNode(c)}let n=((a,d,e)=>{let f=document.implementation.createDocument(c,"speak"),{lang:g}=e;g&&f.documentElement.setAttributeNS(b,"lang",g);let h=(a,e,g)=>{let i;if(!a)return;if(3===a.nodeType)return f.createTextNode(a.textContent);if(4===a.nodeType)return f.createCDATASection(a.textContent);if(1!==a.nodeType&&11!==a.nodeType||d&&d(a)===NodeFilter.FILTER_REJECT)return;let j=a.nodeName.toLowerCase();"foliate-mark"===j?(i=f.createElementNS(c,"mark")).setAttribute("name",a.dataset.name):"br"===j?i=f.createElementNS(c,"break"):("em"===j||"strong"===j)&&(i=f.createElementNS(c,"emphasis"));let k=a.lang||a.getAttributeNS?.(b,"lang");k&&(i||(i=f.createElementNS(c,"lang")),i.setAttributeNS(b,"lang",k));let l=a.getAttributeNS?.(c,"alphabet")||g;if(!i){let b=a.getAttributeNS?.(c,"ph");b&&(i=f.createElementNS(c,"phoneme"),l&&i.setAttribute("alphabet",l),i.setAttribute("ph",b))}i||(i=e);let m=a.firstChild;for(;m;){let a=h(m,i,l);a&&i!==a&&i.append(a),m=m.nextSibling}return i};return h(a,f.documentElement,e.alphabet),f})(l,g,{lang:i,alphabet:j});return{entries:m,ssml:n}})(a,i,j,l);return this.#f=new Map(d),[g,a]})}#i(a,b){return b?a.querySelector(`mark[name="${CSS.escape(b)}"`):null}#j(a,b){if(!a)return;if(!b)return this.#h.serializeToString(a);let d=document.implementation.createDocument(c,"speak");d.documentElement.replaceWith(d.importNode(a.documentElement,!0));let e=b(d)?.previousSibling;for(;e;){let a=e.previousSibling??e.parentNode?.previousSibling;e.parentNode.removeChild(e),e=a}return this.#h.serializeToString(d)}start(){this.#g=null;let[a]=this.#e.first()??[];return a?this.#j(a,a=>this.#i(a,this.#g)):this.next()}resume(){let[a]=this.#e.current()??[];return a?this.#j(a,a=>this.#i(a,this.#g)):this.next()}prev(a){this.#g=null;let[b,c]=this.#e.prev()??[];return a&&c&&this.highlight(c.cloneRange()),this.#j(b)}next(a){this.#g=null;let[b,c]=this.#e.next()??[];return a&&c&&this.highlight(c.cloneRange()),this.#j(b)}prevMark(a){let b=Array.from(this.#f.keys());if(0===b.length)return;let c=this.#g?b.indexOf(this.#g):-1;if(c>0){let d=b[c-1],e=this.#f.get(d);if(e){this.#g=d,a&&this.highlight(e.cloneRange());let[b]=this.#e.current()??[];return this.#j(b,a=>this.#i(a,d))}}else{let[b,c]=this.#e.prev()??[];if(b&&c){let d=Array.from(this.#f.keys());if(!(d.length>0))return this.#g=null,a&&this.highlight(c.cloneRange()),this.#j(b);{let c=d[d.length-1],e=this.#f.get(c);if(e)return this.#g=c,a&&this.highlight(e.cloneRange()),this.#j(b,a=>this.#i(a,c))}}}}nextMark(a){let b=Array.from(this.#f.keys());if(0===b.length)return;let c=this.#g?b.indexOf(this.#g):-1;if(c>=0&&c<b.length-1){let d=b[c+1],e=this.#f.get(d);if(e){this.#g=d,a&&this.highlight(e.cloneRange());let[b]=this.#e.current()??[];return this.#j(b,a=>this.#i(a,d))}}else{let[b,c]=this.#e.next()??[];if(b&&c){let d=Array.from(this.#f.keys());if(!(d.length>0))return this.#g=null,a&&this.highlight(c.cloneRange()),this.#j(b);{let c=d[0],e=this.#f.get(c);if(e)return this.#g=c,a&&this.highlight(e.cloneRange()),this.#j(b,a=>this.#i(a,c))}}}}from(a){let b;this.#g=null;let[c]=this.#e.find(b=>0>=a.compareBoundaryPoints(Range.END_TO_START,b));for(let[c,d]of this.#f.entries())if(0>=a.compareBoundaryPoints(Range.START_TO_START,d)){b=c;break}return this.#j(c,a=>this.#i(a,b))}setMark(a){let b=this.#f.get(a);if(b)return this.#g=a,this.highlight(b.cloneRange()),b}}a.s(["TTS",()=>i])}];

//# sourceMappingURL=packages_foliate-js_tts_b94ffa52.js.map