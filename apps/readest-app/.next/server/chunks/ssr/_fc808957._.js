module.exports=[494268,(a,b,c)=>{!function(){"use strict";if("undefined"!=typeof document&&!("adoptedStyleSheets"in document)){var a="ShadyCSS"in window&&!ShadyCSS.nativeShadow,b=document.implementation.createHTMLDocument(""),c=new WeakMap,d="object"==typeof DOMException?Error:DOMException,e=Object.defineProperty,f=Array.prototype.forEach,g=/@import.+?;?$/gm,h=CSSStyleSheet.prototype;h.replace=function(){return Promise.reject(new d("Can't call replace on non-constructed CSSStyleSheets."))},h.replaceSync=function(){throw new d("Failed to execute 'replaceSync' on 'CSSStyleSheet': Can't call replaceSync on non-constructed CSSStyleSheets.")};var i=new WeakMap,j=new WeakMap,k=new WeakMap,l=new WeakMap,m=B.prototype;m.replace=function(a){try{return this.replaceSync(a),Promise.resolve(this)}catch(a){return Promise.reject(a)}},m.replaceSync=function(a){if(A(this),"string"==typeof a){var b,c,d=this;i.get(d).textContent=((c=(b=a).replace(g,""))!==b&&console.warn("@import rules are not allowed here. See https://github.com/WICG/construct-stylesheets/issues/119#issuecomment-588352418"),c.trim()),l.set(d,[]),j.get(d).forEach(function(a){a.isConnected()&&z(d,y(d,a))})}},e(m,"cssRules",{configurable:!0,enumerable:!0,get:function(){return A(this),i.get(this).sheet.cssRules}}),e(m,"media",{configurable:!0,enumerable:!0,get:function(){return A(this),i.get(this).sheet.media}}),["addRule","deleteRule","insertRule","removeRule"].forEach(function(a){m[a]=function(){var b=this;A(b);var c=arguments;l.get(b).push({method:a,args:c}),j.get(b).forEach(function(d){if(d.isConnected()){var e=y(b,d).sheet;e[a].apply(e,c)}});var d=i.get(b).sheet;return d[a].apply(d,c)}}),e(B,Symbol.hasInstance,{configurable:!0,value:w});var n={childList:!0,subtree:!0},o=new WeakMap,p=new WeakMap,q=new WeakMap,r=new WeakMap;if(H.prototype={isConnected:function(){var a,b=p.get(this);return b instanceof Document?"loading"!==b.readyState:"isConnected"in(a=b.host)?a.isConnected:document.contains(a)},connect:function(){var a=F(this);r.get(this).observe(a,n),q.get(this).length>0&&G(this),E(a,function(a){C(a).connect()})},disconnect:function(){r.get(this).disconnect()},update:function(a){var b,c,d,e=this,f=p.get(e)===document?"Document":"ShadowRoot";if(!Array.isArray(a))throw TypeError("Failed to set the 'adoptedStyleSheets' property on "+f+": Iterator getter is not callable.");if(!a.every(w))throw TypeError("Failed to set the 'adoptedStyleSheets' property on "+f+": Failed to convert value to 'CSSStyleSheet'");if(a.some(x))throw TypeError("Failed to set the 'adoptedStyleSheets' property on "+f+": Can't adopt non-constructed stylesheets");e.sheets=a;var g=q.get(e),h=(b=a).filter(function(a,c){return b.indexOf(a)===c});(c=g,d=h,c.filter(function(a){return -1===d.indexOf(a)})).forEach(function(a){var b,c,d;(b=y(a,e)).parentNode.removeChild(b),c=a,d=e,k.get(c).delete(d),j.set(c,j.get(c).filter(function(a){return a!==d}))}),q.set(e,h),e.isConnected()&&h.length>0&&G(e)}},window.CSSStyleSheet=B,D(Document),"ShadowRoot"in window){D(ShadowRoot);var s=Element.prototype,t=s.attachShadow;s.attachShadow=function(a){var b=t.call(this,a);return"closed"===a.mode&&c.set(this,b),b}}var u=C(document);u.isConnected()?u.connect():document.addEventListener("DOMContentLoaded",u.connect.bind(u))}function v(a){return a.shadowRoot||c.get(a)}function w(a){return"object"==typeof a&&(m.isPrototypeOf(a)||h.isPrototypeOf(a))}function x(a){return"object"==typeof a&&h.isPrototypeOf(a)}function y(a,b){return k.get(a).get(b)}function z(a,b){requestAnimationFrame(function(){b.textContent=i.get(a).textContent,l.get(a).forEach(function(a){return b.sheet[a.method].apply(b.sheet,a.args)})})}function A(a){if(!i.has(a))throw TypeError("Illegal invocation")}function B(){var a=document.createElement("style");b.body.appendChild(a),i.set(this,a),j.set(this,[]),k.set(this,new WeakMap),l.set(this,[])}function C(a){var b=o.get(a);return b||(b=new H(a),o.set(a,b)),b}function D(a){e(a.prototype,"adoptedStyleSheets",{configurable:!0,enumerable:!0,get:function(){return C(this).sheets},set:function(a){C(this).update(a)}})}function E(a,b){for(var c=document.createNodeIterator(a,NodeFilter.SHOW_ELEMENT,function(a){return v(a)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT},null,!1),d=void 0;d=c.nextNode();)b(v(d))}function F(a){var b=p.get(a);return b instanceof Document?b.body:b}function G(a){var b=document.createDocumentFragment(),c=q.get(a),d=r.get(a),e=F(a);d.disconnect(),c.forEach(function(c){var d;b.appendChild(y(c,a)||(d=document.createElement("style"),k.get(c).set(a,d),j.get(c).push(a),d))}),e.insertBefore(b,null),d.observe(e,n),c.forEach(function(b){z(b,y(b,a))})}function H(b){var c=this;c.sheets=[],p.set(c,b),q.set(c,[]),r.set(c,new MutationObserver(function(b,d){document?b.forEach(function(b){a||f.call(b.addedNodes,function(a){a instanceof Element&&E(a,function(a){C(a).connect()})}),f.call(b.removedNodes,function(b){b instanceof Element&&(b instanceof HTMLStyleElement&&q.get(c).some(function(a){return y(a,c)})&&G(c),a||E(b,function(a){C(a).disconnect()}))})}):d.disconnect()}))}}()},464617,a=>{"use strict";a.i(494268);let b=a=>a?.split(/[,;\s]/)?.filter(a=>a)?.map(a=>a.split("=").map(a=>a.trim()));class c extends HTMLElement{static observedAttributes=["zoom","scale-factor","spread"];#a=this.attachShadow({mode:"open"});#b=new ResizeObserver(()=>this.#c());#d;#e=-1;defaultViewport;spread;#f=!1;#g;#h;#i;#j;#k;#l=1;#m=1;#n=!1;#o=!1;#p=!1;#q=new Map;#r=new Map;#s=new Map;#t=1;#u=1;#v=2;#w=[];#x=0;constructor(){super();const a=new CSSStyleSheet;this.#a.adoptedStyleSheets=[a],a.replaceSync(`:host {
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: flex-start;
            align-items: center;
            overflow: auto;
        }
        @supports (justify-content: safe center) {
          :host {
            justify-content: safe center;
          }
        }`),this.#b.observe(this)}attributeChangedCallback(a,b,c){switch(a){case"zoom":this.#k="fit-width"!==c&&"fit-page"!==c?parseFloat(c):c,this.#c();break;case"scale-factor":this.#l=parseFloat(c)/100,this.#c();break;case"spread":this.#y(c)}}async #z({index:a,src:c,detached:d=!1}){let e="string"==typeof c,f=e?c:c?.src,g=e?null:c?.data,h=e?null:c?.onZoom,i=document.createElement("div");i.setAttribute("dir","ltr");let j=document.createElement("iframe");return(i.append(j),Object.assign(j.style,{border:"0",display:"none",overflow:"hidden"}),j.setAttribute("sandbox","allow-same-origin allow-scripts"),j.setAttribute("scrolling","no"),j.setAttribute("part","filter"),this.#a.append(i),d&&Object.assign(i.style,{position:"absolute",visibility:"hidden",pointerEvents:"none"}),f)?new Promise(c=>{j.addEventListener("load",()=>{let e=j.contentDocument;this.dispatchEvent(new CustomEvent("load",{detail:{doc:e,index:a}}));let{width:f,height:g}=((a,c)=>{if("svg"===a.documentElement.localName){let[,,b,c]=a.documentElement.getAttribute("viewBox")?.split(/\s/)??[];return{width:b,height:c}}let d=b(a.querySelector('meta[name="viewport"]')?.getAttribute("content"));if(d)return Object.fromEntries(d);if("string"==typeof c)return b(c);if(c?.width&&c.height)return c;let e=a.querySelector("img");return e?{width:e.naturalWidth,height:e.naturalHeight}:(console.warn(Error("Missing viewport properties")),{width:1e3,height:2e3})})(e,this.defaultViewport);c({element:i,iframe:j,width:parseFloat(f),height:parseFloat(g),onZoom:h,detached:d})},{once:!0}),g?j.srcdoc=g:j.src=f}):{blank:!0,element:i,iframe:j}}#c(a=this.#j){if(!a)return;let b=this.#g??{},c=this.#i??this.#h??{},d="left"===a?b:c,{width:e,height:f}=this.getBoundingClientRect(),g="both"!==this.spread&&"portrait"!==this.spread&&f>1.2*e;this.#f=g;let h=b.width??c.width??0,i=b.height??c.height??0,j="number"!=typeof this.#k||isNaN(this.#k)?("fit-width"===this.#k?g||this.#i?e/(d.width??h):e/((b.width??h)+(c.width??h)):g||this.#i?Math.min(e/(d.width??h),f/(d.height??i)):Math.min(e/((b.width??h)+(c.width??h)),f/Math.max(b.height??i,c.height??i)))||1:this.#k;j*=this.#l,this.#m=j;let k=({frame:a,styles:b})=>{let{element:c,iframe:e,width:f,height:k,blank:l,onZoom:m}=a;if(!e)return;m&&m({doc:a.iframe.contentDocument,scale:j});let n=m?j:1,o=this.#l<1;Object.assign(e.style,{width:`${f*n}px`,height:`${k*n}px`,transform:m?"none":`scale(${j})`,transformOrigin:"top left",display:l?"none":"block"}),Object.assign(c.style,{width:`${(f??h)*j}px`,height:`${(k??i)*j}px`,flexShrink:"0",display:o?"flex":"block",marginBlock:o?void 0:"auto",alignItems:o?"center":void 0,justifyContent:o?"center":void 0,...b}),g&&a!==d&&(c.style.display="none");let p=c.parentNode.host,q=p.clientWidth,r=p.clientHeight;return p.scrollLeft=(c.clientWidth-q)/2,{width:c.clientWidth,height:c.clientHeight,containerWidth:q,containerHeight:r}};if(this.#i){let{width:a,height:b,containerWidth:c,containerHeight:d}=k({frame:this.#i,styles:{marginInline:"auto"}});this.#o=a>c,this.#p=b>d}else{let a=k({frame:b,styles:{marginInlineStart:"auto"}}),d=k({frame:c,styles:{marginInlineEnd:"auto"}}),{width:e,height:f,containerWidth:g,containerHeight:h}=a,{width:i,height:j}=d;this.#o=e+i>g,this.#p=Math.max(f,j)>h}}async #A({left:a,right:b,center:c,side:d,spreadIndex:e}){this.#g=null,this.#h=null,this.#i=null;let f=void 0!==e?`spread-${e}`:null,g=f?this.#r.get(f):null;g?(this.#s.set(f,Date.now()),g.center?this.#i=g.center:(this.#g=g.left,this.#h=g.right)):c?(this.#i=await this.#z(c),f&&(this.#r.set(f,{center:this.#i}),this.#s.set(f,Date.now()))):(this.#g=await this.#z(a),this.#h=await this.#z(b),f&&(this.#r.set(f,{left:this.#g,right:this.#h}),this.#s.set(f,Date.now()))),this.#j=c?"center":this.#g.blank?"right":this.#h.blank?"left":d;let h=c?[this.#i?.element]:[this.#g?.element,this.#h?.element];Array.from(this.#a.children).forEach(a=>{let b=h.includes(a);Object.assign(a.style,{position:b?"relative":"absolute",visibility:b?"visible":"hidden",pointerEvents:b?"auto":"none"})}),this.#c()}#B(){if(!(this.#i||this.#g?.blank)&&this.#f&&this.#g?.element?.style?.display==="none")return this.#j="left",this.#c(),this.#C("page"),!0}#D(){if(!(this.#i||this.#h?.blank)&&this.#f&&this.#h?.element?.style?.display==="none")return this.#j="right",this.#c(),this.#C("page"),!0}open(a){this.book=a,this.defaultViewport=a.rendition?.viewport,this.rtl="rtl"===a.dir,this.#E()}#E(a){let b=this.book,{rendition:c}=b,d=this.rtl,e=!d;this.spread=a||c?.spread,"none"===this.spread?this.#d=b.sections.map(a=>({center:a})):this.#d=b.sections.reduce((a,b,c)=>{let f=a[a.length-1],{pageSpread:g}=b,h=()=>{let b={};return a.push(b),b};return"center"===g?(f.left||f.right?h():f).center=b:"left"===g?(f.center||f.left||e&&c?h():f).left=b:"right"===g?(f.center||f.right||d&&c?h():f).right=b:e?f.center||f.right?h().left=b:f.left||!c?f.right=b:f.left=b:f.center||f.left?h().right=b:f.right||!c?f.left=b:f.right=b,a},[{}])}#y(a){if(-1===this.#e)return;let b=this.book.sections[this.index];this.#E(a);let{index:c}=this.getSpreadOf(b);for(let a of(this.#e=-1,this.#q.clear(),this.#r.values()))a.center?a.center.element?.remove():(a.left?.element?.remove(),a.right?.element?.remove());this.#r.clear(),this.#s.clear(),this.goToSpread(c,this.rtl?"right":"left","page")}get index(){let a=this.#d[this.#e],b=a?.center??("left"===this.#j?a.left??a.right:a.right??a.left);return this.book.sections.indexOf(b)}get scrollLocked(){return this.#n}set scrollLocked(a){this.#n=a}get isOverflowX(){return this.#o}get isOverflowY(){return this.#p}#C(a){this.dispatchEvent(new CustomEvent("relocate",{detail:{reason:a,range:null,index:this.index,fraction:0,size:1}}))}getSpreadOf(a){let b=this.#d;for(let c=0;c<b.length;c++){let{left:d,right:e,center:f}=b[c];if(d===a)return{index:c,side:"left"};if(e===a)return{index:c,side:"right"};if(f===a)return{index:c,side:"center"}}}async goToSpread(a,b,c){if(a<0||a>this.#d.length-1)return;if(a===this.#e)return void this.#c(b);this.#e=a;let d=this.#d[a],e=`spread-${a}`,f=this.#q.get(e);if(f&&"loading"!==f)if(f.center){let c=this.book.sections.indexOf(d.center);await this.#A({center:{index:c,src:f.center},spreadIndex:a,side:b})}else{let c=this.book.sections.indexOf(d.left),e=this.book.sections.indexOf(d.right),g={index:c,src:f.left},h={index:e,src:f.right};await this.#A({left:g,right:h,side:b,spreadIndex:a})}else if(d.center){let c=this.book.sections.indexOf(d.center),e=await d.center?.load?.();await this.#A({center:{index:c,src:e},spreadIndex:a,side:b})}else{let c=this.book.sections.indexOf(d.left),e=this.book.sections.indexOf(d.right),f=await d.left?.load?.(),g=await d.right?.load?.();await this.#A({left:{index:c,src:f},right:{index:e,src:g},side:b,spreadIndex:a})}this.#C(c),this.#F()}#F(){if(this.#G(),this.#u<=0)return;let a=[],b=Math.max(1,this.#u-1),c=Math.max(0,this.#u-b);for(let c=1;c<=b;c++){let b=this.#e+c;b>=0&&b<this.#d.length&&a.push({index:b,direction:"forward",distance:c})}for(let b=1;b<=c;b++){let c=this.#e-b;c>=0&&c<this.#d.length&&a.push({index:c,direction:"backward",distance:b})}for(let{index:b,direction:c}of a){let a=`spread-${b}`;if(this.#r.has(a))continue;let d=this.#d[b];d&&this.#w.push({targetIndex:b,direction:c,spread:d,cacheKey:a})}this.#H()}async #H(){for(;this.#w.length>0&&this.#x<this.#t;){let a=this.#w.shift();if(!a)break;let{spread:b,cacheKey:c}=a;this.#q.set(c,"loading"),this.#x++,Promise.resolve().then(async()=>{try{if(b.center){let a=await b.center?.load?.();this.#q.set(c,{center:a});let d=this.book.sections.indexOf(b.center),e=await this.#z({index:d,src:a,detached:!0});if(this.#r.set(c,{center:e}),this.#s.set(c,Date.now()),e.onZoom){let a=e.iframe.contentDocument;e.onZoom({doc:a,scale:this.#m})}}else{let a=await b.left?.load?.(),d=await b.right?.load?.();this.#q.set(c,{left:a,right:d});let e=this.book.sections.indexOf(b.left),f=this.book.sections.indexOf(b.right),g=await this.#z({index:e,src:a,detached:!0}),h=await this.#z({index:f,src:d,detached:!0});if(this.#r.set(c,{left:g,right:h}),this.#s.set(c,Date.now()),g.onZoom){let a=g.iframe.contentDocument;g.onZoom({doc:a,scale:this.#m})}if(h.onZoom){let a=h.iframe.contentDocument;h.onZoom({doc:a,scale:this.#m})}}}catch{this.#q.delete(c),this.#r.delete(c)}finally{this.#x--,this.#H()}})}}#G(){let a=this.#v;if(this.#r.size<=a)return;let b=Array.from(this.#r.keys()).map(a=>({key:a,accessTime:this.#s.get(a)||0})).sort((a,b)=>a.accessTime-b.accessTime),c=this.#r.size-a,d=b.slice(0,c).map(a=>a.key);d.length>0&&d.forEach(a=>{let b=this.#r.get(a);b&&(b.center?b.center.element?.remove():(b.left?.element?.remove(),b.right?.element?.remove())),this.#r.delete(a),this.#s.delete(a),this.#q.delete(a)})}async select(a){await this.goTo(a)}async goTo(a){let{book:b}=this,c=await a,d=b.sections[c.index];if(!d)return;let{index:e,side:f}=this.getSpreadOf(d);await this.goToSpread(e,f)}async next(){if(!(this.rtl?this.#B():this.#D()))return this.goToSpread(this.#e+1,this.rtl?"right":"left","page")}async prev(){if(!(this.rtl?this.#D():this.#B()))return this.goToSpread(this.#e-1,this.rtl?"left":"right","page")}async pan(a,b){this.#n||(this.#n=!0,(c=>{let{element:d,iframe:e}=c;if(!e||!d)return;let f=d.parentNode.host;f.scrollLeft+=a,f.scrollTop+=b})(this.#i??this.#h??{}),this.#n=!1)}getContents(){return Array.from(this.#a.querySelectorAll("iframe"),a=>({doc:a.contentDocument}))}destroy(){for(let a of(this.#b.unobserve(this),this.#r.values()))a.center?a.center.element?.remove():(a.left?.element?.remove(),a.right?.element?.remove());this.#r.clear(),this.#q.clear(),this.#s.clear()}}customElements.define("foliate-fxl",c),a.s(["FixedLayout",()=>c])}];

//# sourceMappingURL=_fc808957._.js.map