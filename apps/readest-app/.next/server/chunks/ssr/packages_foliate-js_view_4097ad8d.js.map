{"version":3,"sources":["../../../../../../packages/foliate-js/view.js","../../../../../../packages/foliate-js/progress.js","../../../../../../packages/foliate-js/text-walker.js"],"sourcesContent":["import * as CFI from './epubcfi.js'\nimport { TOCProgress, SectionProgress } from './progress.js'\nimport { Overlayer } from './overlayer.js'\nimport { textWalker } from './text-walker.js'\n\nconst SEARCH_PREFIX = 'foliate-search:'\n\nconst NOTE_PREFIX = 'foliate-note:'\n\nconst isZip = async file => {\n    const arr = new Uint8Array(await file.slice(0, 4).arrayBuffer())\n    return arr[0] === 0x50 && arr[1] === 0x4b && arr[2] === 0x03 && arr[3] === 0x04\n}\n\nconst isPDF = async file => {\n    const arr = new Uint8Array(await file.slice(0, 5).arrayBuffer())\n    return arr[0] === 0x25\n        && arr[1] === 0x50 && arr[2] === 0x44 && arr[3] === 0x46\n        && arr[4] === 0x2d\n}\n\nconst isCBZ = ({ name, type }) =>\n    type === 'application/vnd.comicbook+zip' || name.endsWith('.cbz')\n\nconst isFB2 = ({ name, type }) =>\n    type === 'application/x-fictionbook+xml' || name.endsWith('.fb2')\n\nconst isFBZ = ({ name, type }) =>\n    type === 'application/x-zip-compressed-fb2'\n    || name.endsWith('.fb2.zip') || name.endsWith('.fbz')\n\nconst makeZipLoader = async file => {\n    const { configure, ZipReader, BlobReader, TextWriter, BlobWriter } =\n        await import('./vendor/zip.js')\n    configure({ useWebWorkers: false })\n    const reader = new ZipReader(new BlobReader(file))\n    const entries = await reader.getEntries()\n    const map = new Map(entries.map(entry => [entry.filename, entry]))\n    const load = f => (name, ...args) =>\n        map.has(name) ? f(map.get(name), ...args) : null\n    const loadText = load(entry => entry.getData(new TextWriter()))\n    const loadBlob = load((entry, type) => entry.getData(new BlobWriter(type)))\n    const getSize = name => map.get(name)?.uncompressedSize ?? 0\n    return { entries, loadText, loadBlob, getSize }\n}\n\nconst getFileEntries = async entry => entry.isFile ? entry\n    : (await Promise.all(Array.from(\n        await new Promise((resolve, reject) => entry.createReader()\n            .readEntries(entries => resolve(entries), error => reject(error))),\n        getFileEntries))).flat()\n\nconst makeDirectoryLoader = async entry => {\n    const entries = await getFileEntries(entry)\n    const files = await Promise.all(\n        entries.map(entry => new Promise((resolve, reject) =>\n            entry.file(file => resolve([file, entry.fullPath]),\n                error => reject(error)))))\n    const map = new Map(files.map(([file, path]) =>\n        [path.replace(entry.fullPath + '/', ''), file]))\n    const decoder = new TextDecoder()\n    const decode = x => x ? decoder.decode(x) : null\n    const getBuffer = name => map.get(name)?.arrayBuffer() ?? null\n    const loadText = async name => decode(await getBuffer(name))\n    const loadBlob = name => map.get(name)\n    const getSize = name => map.get(name)?.size ?? 0\n    return { loadText, loadBlob, getSize }\n}\n\nexport class ResponseError extends Error {}\nexport class NotFoundError extends Error {}\nexport class UnsupportedTypeError extends Error {}\n\nconst fetchFile = async url => {\n    const res = await fetch(url)\n    if (!res.ok) throw new ResponseError(\n        `${res.status} ${res.statusText}`, { cause: res })\n    return new File([await res.blob()], new URL(res.url).pathname)\n}\n\nexport const makeBook = async file => {\n    if (typeof file === 'string') file = await fetchFile(file)\n    let book\n    if (file.isDirectory) {\n        const loader = await makeDirectoryLoader(file)\n        const { EPUB } = await import('./epub.js')\n        book = await new EPUB(loader).init()\n    }\n    else if (!file.size) throw new NotFoundError('File not found')\n    else if (await isZip(file)) {\n        const loader = await makeZipLoader(file)\n        if (isCBZ(file)) {\n            const { makeComicBook } = await import('./comic-book.js')\n            book = makeComicBook(loader, file)\n        }\n        else if (isFBZ(file)) {\n            const { makeFB2 } = await import('./fb2.js')\n            const { entries } = loader\n            const entry = entries.find(entry => entry.filename.endsWith('.fb2'))\n            const blob = await loader.loadBlob((entry ?? entries[0]).filename)\n            book = await makeFB2(blob)\n        }\n        else {\n            const { EPUB } = await import('./epub.js')\n            book = await new EPUB(loader).init()\n        }\n    }\n    else if (await isPDF(file)) {\n        const { makePDF } = await import('./pdf.js')\n        book = await makePDF(file)\n    }\n    else {\n        const { isMOBI, MOBI } = await import('./mobi.js')\n        if (await isMOBI(file)) {\n            const fflate = await import('./vendor/fflate.js')\n            book = await new MOBI({ unzlib: fflate.unzlibSync }).open(file)\n        }\n        else if (isFB2(file)) {\n            const { makeFB2 } = await import('./fb2.js')\n            book = await makeFB2(file)\n        }\n    }\n    if (!book) throw new UnsupportedTypeError('File type not supported')\n    return book\n}\n\nclass CursorAutohider {\n    #timeout\n    #el\n    #check\n    #state\n    constructor(el, check, state = {}) {\n        this.#el = el\n        this.#check = check\n        this.#state = state\n        if (this.#state.hidden) this.hide()\n        this.#el.addEventListener('mousemove', ({ screenX, screenY }) => {\n            // check if it actually moved\n            if (screenX === this.#state.x && screenY === this.#state.y) return\n            this.#state.x = screenX, this.#state.y = screenY\n            this.show()\n            if (this.#timeout) clearTimeout(this.#timeout)\n            if (check()) this.#timeout = setTimeout(this.hide.bind(this), 1000)\n        }, false)\n    }\n    cloneFor(el) {\n        return new CursorAutohider(el, this.#check, this.#state)\n    }\n    hide() {\n        this.#el.style.cursor = 'none'\n        this.#state.hidden = true\n    }\n    show() {\n        this.#el.style.removeProperty('cursor')\n        this.#state.hidden = false\n    }\n}\n\nclass History extends EventTarget {\n    #arr = []\n    #index = -1\n    pushState(x) {\n        const last = this.#arr[this.#index]\n        if (last === x || last?.fraction && last.fraction === x.fraction) return\n        this.#arr[++this.#index] = x\n        this.#arr.length = this.#index + 1\n        this.dispatchEvent(new Event('index-change'))\n    }\n    replaceState(x) {\n        const index = this.#index\n        this.#arr[index] = x\n    }\n    back() {\n        const index = this.#index\n        if (index <= 0) return\n        const detail = { state: this.#arr[index - 1] }\n        this.#index = index - 1\n        this.dispatchEvent(new CustomEvent('popstate', { detail }))\n        this.dispatchEvent(new Event('index-change'))\n    }\n    forward() {\n        const index = this.#index\n        if (index >= this.#arr.length - 1) return\n        const detail = { state: this.#arr[index + 1] }\n        this.#index = index + 1\n        this.dispatchEvent(new CustomEvent('popstate', { detail }))\n        this.dispatchEvent(new Event('index-change'))\n    }\n    get canGoBack() {\n        return this.#index > 0\n    }\n    get canGoForward() {\n        return this.#index < this.#arr.length - 1\n    }\n    clear() {\n        this.#arr = []\n        this.#index = -1\n    }\n}\n\nconst languageInfo = lang => {\n    if (!lang) return {}\n    try {\n        const canonical = Intl.getCanonicalLocales(lang)[0]\n        const locale = new Intl.Locale(canonical)\n        const isCJK = ['zh', 'ja', 'kr'].includes(locale.language)\n        const direction = (locale.getTextInfo?.() ?? locale.textInfo)?.direction\n        return { canonical, locale, isCJK, direction }\n    } catch (e) {\n        console.warn(e)\n        return {}\n    }\n}\n\nexport class View extends HTMLElement {\n    #root = this.attachShadow({ mode: 'open' })\n    #sectionProgress\n    #tocProgress\n    #pageProgress\n    #searchResults = new Map()\n    #cursorAutohider = new CursorAutohider(this, () =>\n        this.hasAttribute('autohide-cursor'))\n    isFixedLayout = false\n    lastLocation\n    history = new History()\n    constructor() {\n        super()\n        this.history.addEventListener('popstate', ({ detail }) => {\n            const resolved = this.resolveNavigation(detail.state)\n            this.renderer.goTo(resolved)\n        })\n    }\n    async open(book) {\n        if (typeof book === 'string'\n        || typeof book.arrayBuffer === 'function'\n        || book.isDirectory) book = await makeBook(book)\n        this.book = book\n        this.language = languageInfo(book.metadata?.language)\n\n        if (book.splitTOCHref && book.getTOCFragment) {\n            const ids = book.sections.map(s => s.id)\n            this.#sectionProgress = new SectionProgress(book.sections, 1500, 1600)\n            const splitHref = book.splitTOCHref.bind(book)\n            const getFragment = book.getTOCFragment.bind(book)\n            this.#tocProgress = new TOCProgress()\n            await this.#tocProgress.init({\n                toc: book.toc ?? [], ids, splitHref, getFragment })\n            this.#pageProgress = new TOCProgress()\n            await this.#pageProgress.init({\n                toc: book.pageList ?? [], ids, splitHref, getFragment })\n        }\n\n        this.isFixedLayout = this.book.rendition?.layout === 'pre-paginated'\n        if (this.isFixedLayout) {\n            await import('./fixed-layout.js')\n            this.renderer = document.createElement('foliate-fxl')\n        } else {\n            await import('./paginator.js')\n            this.renderer = document.createElement('foliate-paginator')\n        }\n        this.renderer.setAttribute('exportparts', 'head,foot,filter,container')\n        this.renderer.addEventListener('load', e => this.#onLoad(e.detail))\n        this.renderer.addEventListener('relocate', e => this.#onRelocate(e.detail))\n        this.renderer.addEventListener('create-overlayer', e =>\n            e.detail.attach(this.#createOverlayer(e.detail)))\n        this.renderer.open(book)\n        this.#root.append(this.renderer)\n\n        if (book.sections.some(section => section.mediaOverlay)) {\n            const activeClass = book.media.activeClass\n            const playbackActiveClass = book.media.playbackActiveClass\n            this.mediaOverlay = book.getMediaOverlay()\n            let lastActive\n            this.mediaOverlay.addEventListener('highlight', e => {\n                const resolved = this.resolveNavigation(e.detail.text)\n                this.renderer.goTo(resolved)\n                    .then(() => {\n                        const { doc } = this.renderer.getContents()\n                            .find(x => x.index = resolved.index)\n                        const el = resolved.anchor(doc)\n                        el.classList.add(activeClass)\n                        if (playbackActiveClass) el.ownerDocument\n                            .documentElement.classList.add(playbackActiveClass)\n                        lastActive = new WeakRef(el)\n                    })\n            })\n            this.mediaOverlay.addEventListener('unhighlight', () => {\n                const el = lastActive?.deref()\n                if (el) {\n                    el.classList.remove(activeClass)\n                    if (playbackActiveClass) el.ownerDocument\n                        .documentElement.classList.remove(playbackActiveClass)\n                }\n            })\n        }\n    }\n    close() {\n        this.renderer?.destroy()\n        this.renderer?.remove()\n        this.#sectionProgress = null\n        this.#tocProgress = null\n        this.#pageProgress = null\n        this.#searchResults = new Map()\n        this.lastLocation = null\n        this.history.clear()\n        this.tts = null\n        this.mediaOverlay = null\n    }\n    goToTextStart() {\n        return this.goTo(this.book.landmarks\n            ?.find(m => m.type.includes('bodymatter') || m.type.includes('text'))\n            ?.href ?? this.book.sections.findIndex(s => s.linear !== 'no'))\n    }\n    async init({ lastLocation, showTextStart }) {\n        const resolved = lastLocation ? this.resolveNavigation(lastLocation) : null\n        if (resolved) {\n            await this.renderer.goTo(resolved)\n            this.history.pushState(lastLocation)\n        }\n        else if (showTextStart) await this.goToTextStart()\n        else {\n            this.history.pushState(0)\n            await this.next()\n        }\n    }\n    #emit(name, detail, cancelable) {\n        return this.dispatchEvent(new CustomEvent(name, { detail, cancelable }))\n    }\n    #onRelocate({ reason, range, index, fraction, size }) {\n        const progress = this.#sectionProgress?.getProgress(index, fraction, size) ?? {}\n        const tocItem = this.#tocProgress?.getProgress(index, range)\n        const pageItem = this.#pageProgress?.getProgress(index, range)\n        const cfi = this.getCFI(index, range)\n        this.lastLocation = { ...progress, tocItem, pageItem, cfi, range }\n        if (reason === 'snap' || reason === 'page' || reason === 'scroll')\n            this.history.replaceState(cfi)\n        this.#emit('relocate', this.lastLocation)\n    }\n    #onLoad({ doc, index }) {\n        // set language and dir if not already set\n        doc.documentElement.lang ||= this.language.canonical ?? ''\n        if (!this.language.isCJK)\n            doc.documentElement.dir ||= this.language.direction ?? ''\n\n        this.#handleLinks(doc, index)\n        this.#cursorAutohider.cloneFor(doc.documentElement)\n\n        this.#emit('load', { doc, index })\n    }\n    #handleLinks(doc, index) {\n        const { book } = this\n        const section = book.sections[index]\n        doc.addEventListener('click', e => {\n            const a = e.target.closest('a[href]')\n            if (!a) return\n            e.preventDefault()\n            const href_ = a.getAttribute('href')\n            const href = section?.resolveHref?.(href_) ?? href_\n            if (book?.isExternal?.(href))\n                Promise.resolve(this.#emit('external-link', { a, href }, true))\n                    .then(x => x ? globalThis.open(href, '_blank') : null)\n                    .catch(e => console.error(e))\n            else {\n                let internalHref = href\n                if (!book.resolveHref(href)) {\n                    const hashIndex = href_.indexOf('#')\n                    if (hashIndex >= 0) {\n                        const hash = href_.slice(hashIndex)\n                        internalHref = section?.resolveHref?.(hash) ?? href\n                    }\n                }\n                Promise.resolve(this.#emit('link', { a, href: internalHref }, true))\n                    .then(x => x ? this.goTo(internalHref) : null)\n                    .catch(e => console.error(e))\n            }\n        })\n    }\n    async addAnnotation(annotation, remove) {\n        const { value } = annotation\n        if (value.startsWith(SEARCH_PREFIX)) {\n            const cfi = value.replace(SEARCH_PREFIX, '')\n            const { index, anchor } = await this.resolveNavigation(cfi)\n            const obj = this.#getOverlayer(index)\n            if (obj) {\n                const { overlayer, doc } = obj\n                if (remove) {\n                    overlayer.remove(value)\n                    return\n                }\n                const range = doc ? anchor(doc) : anchor\n                overlayer.add(value, range, Overlayer.outline)\n            }\n            return\n        } else if (value.startsWith(NOTE_PREFIX)) {\n            const cfi = value.replace(NOTE_PREFIX, '')\n            const { index, anchor } = await this.resolveNavigation(cfi)\n            const obj = this.#getOverlayer(index)\n            if (obj) {\n                const { overlayer, doc } = obj\n                if (remove) {\n                    overlayer.remove(value)\n                    return\n                }\n                const range = doc ? anchor(doc) : anchor\n                const draw = (func, opts) => overlayer.add(value, range, func, opts)\n                this.#emit('draw-annotation', { draw, annotation, doc, range })\n            }\n            return\n        }\n        const { index, anchor } = await this.resolveNavigation(value)\n        const obj = this.#getOverlayer(index)\n        if (obj) {\n            const { overlayer, doc } = obj\n            overlayer.remove(value)\n            if (!remove) {\n                const range = doc ? anchor(doc) : anchor\n                const draw = (func, opts) => overlayer.add(value, range, func, opts)\n                this.#emit('draw-annotation', { draw, annotation, doc, range })\n            }\n        }\n        const label = this.#tocProgress.getProgress(index)?.label ?? ''\n        return { index, label }\n    }\n    deleteAnnotation(annotation) {\n        return this.addAnnotation(annotation, true)\n    }\n    #getOverlayer(index) {\n        return this.renderer.getContents()\n            .find(x => x.index === index && x.overlayer)\n    }\n    #createOverlayer({ doc, index }) {\n        const overlayer = new Overlayer(doc)\n        doc.addEventListener('click', e => {\n            const [value, range, rect] = overlayer.hitTest(e)\n            if (value && !value.startsWith(SEARCH_PREFIX)) {\n                this.#emit('show-annotation', { value, index, range, rect })\n            }\n        }, false)\n\n        let lastHitTestTime = 0\n        const THROTTLE_MS = 200\n        const isAndroid = /Android/i.test(navigator.userAgent)\n\n        doc.addEventListener('mousemove', (e) => {\n            if (isAndroid) return\n            const now = performance.now()\n            if (now - lastHitTestTime < THROTTLE_MS) return\n            lastHitTestTime = now\n            const [value] = overlayer.hitTest(e)\n            if (value && !value.startsWith(SEARCH_PREFIX)) {\n                doc.body.style.cursor = 'pointer'\n            } else {\n                doc.body.style.cursor = ''\n            }\n        })\n\n        const list = this.#searchResults.get(index)\n        if (list) for (const item of list) this.addAnnotation(item)\n\n        this.#emit('create-overlay', { index })\n        return overlayer\n    }\n    async showAnnotation(annotation) {\n        const { value } = annotation\n        const resolved = await this.goTo(value)\n        if (resolved) {\n            const { index, anchor } = resolved\n            const { doc } =  this.#getOverlayer(index)\n            const range = anchor(doc)\n            this.#emit('show-annotation', { value, index, range })\n        }\n    }\n    getCFI(index, range) {\n        const baseCFI = this.book.sections[index].cfi ?? CFI.fake.fromIndex(index)\n        if (!range) return baseCFI\n        return CFI.joinIndir(baseCFI, CFI.fromRange(range))\n    }\n    resolveCFI(cfi) {\n        if (this.book.resolveCFI)\n            return this.book.resolveCFI(cfi)\n        else {\n            const parts = CFI.parse(cfi)\n            const index = CFI.fake.toIndex((parts.parent ?? parts).shift())\n            const anchor = doc => CFI.toRange(doc, parts)\n            return { index, anchor }\n        }\n    }\n    resolveNavigation(target) {\n        try {\n            if (typeof target === 'number') return { index: target }\n            if (typeof target.fraction === 'number') {\n                const [index, anchor] = this.#sectionProgress.getSection(target.fraction)\n                return { index, anchor }\n            }\n            if (CFI.isCFI.test(target)) return this.resolveCFI(target)\n            return this.book.resolveHref(target)\n        } catch (e) {\n            console.error(e)\n            console.error(`Could not resolve target ${target}`)\n        }\n    }\n    async goTo(target) {\n        const resolved = this.resolveNavigation(target)\n        try {\n            await this.renderer.goTo(resolved)\n            this.history.pushState(target)\n            return resolved\n        } catch(e) {\n            console.error(e)\n            console.error(`Could not go to ${target}`)\n        }\n    }\n    async goToFraction(frac) {\n        const [index, anchor] = this.#sectionProgress.getSection(frac)\n        await this.renderer.goTo({ index, anchor })\n        this.history.pushState({ fraction: frac })\n    }\n    async select(target) {\n        try {\n            const obj = await this.resolveNavigation(target)\n            await this.renderer.goTo({ ...obj, select: true })\n            this.history.pushState(target)\n        } catch(e) {\n            console.error(e)\n            console.error(`Could not go to ${target}`)\n        }\n    }\n    deselect() {\n        for (const { doc } of this.renderer.getContents())\n            doc.defaultView.getSelection().removeAllRanges()\n    }\n    getSectionFractions() {\n        return (this.#sectionProgress?.sectionFractions ?? [])\n            .map(x => x + Number.EPSILON)\n    }\n    getProgressOf(index, range) {\n        const tocItem = this.#tocProgress?.getProgress(index, range)\n        const pageItem = this.#pageProgress?.getProgress(index, range)\n        return { tocItem, pageItem }\n    }\n    async getTOCItemOf(target) {\n        try {\n            const { index, anchor } = await this.resolveNavigation(target)\n            const doc = await this.book.sections[index].createDocument()\n            const frag = anchor(doc)\n            const isRange = frag instanceof Range\n            const range = isRange ? frag : doc.createRange()\n            if (!isRange) range.selectNodeContents(frag)\n            return this.#tocProgress.getProgress(index, range)\n        } catch(e) {\n            console.error(e)\n            console.error(`Could not get ${target}`)\n        }\n    }\n    async prev(distance) {\n        await this.renderer.prev(distance)\n    }\n    async next(distance) {\n        await this.renderer.next(distance)\n    }\n    async pan(dx, dy) {\n        await this.renderer.pan(dx, dy)\n    }\n    isOverflowX() {\n        return this.renderer.isOverflowX\n    }\n    isOverflowY() {\n        return this.renderer.isOverflowY\n    }\n    goLeft() {\n        return this.book.dir === 'rtl' ? this.next() : this.prev()\n    }\n    goRight() {\n        return this.book.dir === 'rtl' ? this.prev() : this.next()\n    }\n    async * #searchSection(matcher, query, index) {\n        const doc = await this.book.sections[index].createDocument()\n        for (const { range, excerpt } of matcher(doc, query))\n            yield { cfi: this.getCFI(index, range), excerpt }\n    }\n    async * #searchBook(matcher, query) {\n        const { sections } = this.book\n        for (const [index, { createDocument }] of sections.entries()) {\n            if (!createDocument) continue\n            const doc = await createDocument()\n            const subitems = Array.from(matcher(doc, query), ({ range, excerpt }) =>\n                ({ cfi: this.getCFI(index, range), excerpt }))\n            const progress = (index + 1) / sections.length\n            yield { progress }\n            if (subitems.length) yield { index, subitems }\n        }\n    }\n    async * search(opts) {\n        this.clearSearch()\n        const { searchMatcher } = await import('./search.js')\n        const { sections } = this.book\n        const { query, index, results } = opts\n        const matcher = searchMatcher(textWalker,\n            { defaultLocale: this.language, ...opts })\n\n        const iter = results?.length\n            ? (async function* () {\n                for (const result of results) {\n                    if (result.subitems) {\n                        const progress = (result.index + 1) / sections.length\n                        yield { progress }\n                        yield { index: result.index, subitems: result.subitems }\n                    } else {\n                        yield { cfi: result.cfi, excerpt: result.excerpt }\n                    }\n                }\n            })()\n            : index != null\n                ? this.#searchSection(matcher, query, index)\n                : this.#searchBook(matcher, query)\n\n        const list = []\n        this.#searchResults.set(index, list)\n\n        for await (const result of iter) {\n            if (result.subitems){\n                const list = result.subitems\n                    .map(({ cfi }) => ({ value: SEARCH_PREFIX + cfi }))\n                this.#searchResults.set(result.index, list)\n                for (const item of list) this.addAnnotation(item)\n                yield {\n                    index: result.index,\n                    label: this.#tocProgress.getProgress(result.index)?.label ?? '',\n                    subitems: result.subitems,\n                }\n            }\n            else {\n                if (result.cfi) {\n                    const item = { value: SEARCH_PREFIX + result.cfi }\n                    list.push(item)\n                    this.addAnnotation(item)\n                }\n                yield result\n            }\n        }\n        yield 'done'\n    }\n    clearSearch() {\n        for (const list of this.#searchResults.values())\n            for (const item of list) this.deleteAnnotation(item)\n        this.#searchResults.clear()\n    }\n    async initTTS(granularity = 'word', nodeFilter, highlighter) {\n        const doc = this.renderer.getContents()[0].doc\n        if (this.tts && this.tts.doc === doc) return\n        const { TTS } = await import('./tts.js')\n        this.tts = new TTS(doc, textWalker, nodeFilter, highlighter || (range =>\n            this.renderer.scrollToAnchor(range, true)), granularity)\n    }\n    startMediaOverlay() {\n        const { index } = this.renderer.getContents()[0]\n        return this.mediaOverlay.start(index)\n    }\n}\n\ncustomElements.define('foliate-view', View)\n","// assign a unique ID for each TOC item\nconst assignIDs = toc => {\n    let id = 0\n    const assignID = item => {\n        item.id = id++\n        if (item.subitems) for (const subitem of item.subitems) assignID(subitem)\n    }\n    for (const item of toc) assignID(item)\n    return toc\n}\n\nconst flatten = items => items\n    .map(item => item.subitems?.length\n        ? [item, flatten(item.subitems)].flat()\n        : item)\n    .flat()\n\nexport class TOCProgress {\n    async init({ toc, ids, splitHref, getFragment }) {\n        assignIDs(toc)\n        const items = flatten(toc)\n        const grouped = new Map()\n        for (const [i, item] of items.entries()) {\n            const [id, fragment] = await splitHref(item?.href) ?? []\n            const value = { fragment, item }\n            if (grouped.has(id)) grouped.get(id).items.push(value)\n            else grouped.set(id, { prev: items[i - 1], items: [value] })\n        }\n        const map = new Map()\n        for (const [i, id] of ids.entries()) {\n            if (grouped.has(id)) map.set(id, grouped.get(id))\n            else map.set(id, map.get(ids[i - 1]))\n        }\n        this.ids = ids\n        this.map = map\n        this.getFragment = getFragment\n    }\n    getProgress(index, range) {\n        if (!this.ids) return\n        const id = this.ids[index]\n        const obj = this.map.get(id)\n        if (!obj) return null\n        const { prev, items } = obj\n        if (!items) return prev\n        if (!range || items.length === 1 && !items[0].fragment) return items[0].item\n\n        const doc = range.startContainer.getRootNode()\n        for (const [i, { fragment }] of items.entries()) {\n            const el = this.getFragment(doc, fragment)\n            if (!el) continue\n            if (range.comparePoint(el, 0) > 0)\n                return (items[i - 1]?.item ?? prev)\n        }\n        return items[items.length - 1].item\n    }\n}\n\nexport class SectionProgress {\n    constructor(sections, sizePerLoc, sizePerTimeUnit) {\n        this.sizes = sections.map(s => s.linear != 'no' && s.size > 0 ? s.size : 0)\n        this.sizePerLoc = sizePerLoc\n        this.sizePerTimeUnit = sizePerTimeUnit\n        this.sizeTotal = this.sizes.reduce((a, b) => a + b, 0)\n        this.sectionFractions = this.#getSectionFractions()\n    }\n    #getSectionFractions() {\n        const { sizeTotal } = this\n        const results = [0]\n        let sum = 0\n        for (const size of this.sizes) results.push((sum += size) / sizeTotal)\n        return results\n    }\n    // get progress given index of and fractions within a section\n    getProgress(index, fractionInSection, pageFraction = 0) {\n        const { sizes, sizePerLoc, sizePerTimeUnit, sizeTotal } = this\n        const sizeInSection = sizes[index] ?? 0\n        const sizeBefore = sizes.slice(0, index).reduce((a, b) => a + b, 0)\n        const size = sizeBefore + fractionInSection * sizeInSection\n        const nextSize = size + pageFraction * sizeInSection\n        const remainingTotal = sizeTotal - size\n        const remainingSection = (1 - fractionInSection) * sizeInSection\n        return {\n            fraction: nextSize / sizeTotal,\n            section: {\n                current: index,\n                total: sizes.length,\n            },\n            location: {\n                current: Math.floor(size / sizePerLoc),\n                next: Math.floor(nextSize / sizePerLoc),\n                total: Math.ceil(sizeTotal / sizePerLoc),\n            },\n            time: {\n                section: remainingSection / sizePerTimeUnit,\n                total: remainingTotal / sizePerTimeUnit,\n            },\n        }\n    }\n    // the inverse of `getProgress`\n    // get index of and fraction in section based on total fraction\n    getSection(fraction) {\n        if (fraction <= 0) return [0, 0]\n        if (fraction >= 1) return [this.sizes.length - 1, 1]\n        fraction = fraction + Number.EPSILON\n        const { sizeTotal } = this\n        let index = this.sectionFractions.findIndex(x => x > fraction) - 1\n        if (index < 0) return [0, 0]\n        while (!this.sizes[index]) index++\n        const fractionInSection = (fraction - this.sectionFractions[index])\n            / (this.sizes[index] / sizeTotal)\n        return [index, fractionInSection]\n    }\n}\n","const walkRange = (range, walker) => {\n    const nodes = []\n    for (let node = walker.currentNode; node; node = walker.nextNode()) {\n        const compare = range.comparePoint(node, 0)\n        if (compare === 0) nodes.push(node)\n        else if (compare > 0) break\n    }\n    return nodes\n}\n\nconst walkDocument = (_, walker) => {\n    const nodes = []\n    for (let node = walker.nextNode(); node; node = walker.nextNode())\n        nodes.push(node)\n    return nodes\n}\n\nconst filter = NodeFilter.SHOW_ELEMENT | NodeFilter.SHOW_TEXT\n    | NodeFilter.SHOW_CDATA_SECTION\n\nconst acceptNode = node => {\n    if (node.nodeType === 1) {\n        const name = node.tagName.toLowerCase()\n        if (name === 'script' || name === 'style') return NodeFilter.FILTER_REJECT\n        return NodeFilter.FILTER_SKIP\n    }\n    return NodeFilter.FILTER_ACCEPT\n}\n\nexport const textWalker = function* (x, func, filterFunc) {\n    const root = x.commonAncestorContainer ?? x.body ?? x\n    const walker = document.createTreeWalker(root, filter, { acceptNode: filterFunc || acceptNode })\n    const walk = x.commonAncestorContainer ? walkRange : walkDocument\n    const nodes = walk(x, walker)\n    const strs = nodes.map(node => node.nodeValue ?? '')\n    const makeRange = (startIndex, startOffset, endIndex, endOffset) => {\n        const range = document.createRange()\n        range.setStart(nodes[startIndex], startOffset)\n        range.setEnd(nodes[endIndex], endOffset)\n        return range\n    }\n    for (const match of func(strs, makeRange)) yield match\n}\n"],"names":[],"mappings":"uCAAA,IAAA,EAAA,EAAA,CAAA,CAAA,QCWA,IAAM,EAAU,GAAS,EACpB,GAAG,CAAC,GAAQ,EAAK,QAAQ,EAAE,OACtB,CAAC,EAAM,EAAQ,EAAK,QAAQ,EAAE,CAAC,IAAI,GACnC,GACL,IAAI,EAEF,OAAM,EACT,MAAM,KAAK,KAAE,CAAG,KAAE,CAAG,WAAE,CAAS,CAAE,aAAW,CAAE,CAAE,CAC7C,AAlBU,CAAA,IACd,IAAI,EAAK,EACH,EAAW,IAEb,GADA,EAAK,EAAE,CAAG,IACN,EAAK,QAAQ,CAAE,IAAK,IAAM,KAAW,EAAK,QAAQ,CAAE,EAAS,EACrE,EACA,IAAK,IAAM,KAAQ,EAAK,EAAS,GAErC,EAUkB,GACV,IAAM,EAAQ,EAAQ,GAChB,EAAU,IAAI,IACpB,IAAK,GAAM,CAAC,EAAG,EAAK,GAAI,EAAM,OAAO,GAAI,CACrC,GAAM,CAAC,EAAI,EAAS,CAAG,MAAM,EAAU,GAAM,OAAS,EAAE,CAClD,EAAQ,UAAE,OAAU,CAAK,EAC3B,EAAQ,GAAG,CAAC,GAAK,EAAQ,GAAG,CAAC,GAAI,KAAK,CAAC,IAAI,CAAC,GAC3C,EAAQ,GAAG,CAAC,EAAI,CAAE,KAAM,CAAK,CAAC,EAAI,EAAE,CAAE,MAAO,CAAC,EAAM,AAAC,EAC9D,CACA,IAAM,EAAM,IAAI,IAChB,IAAK,GAAM,CAAC,EAAG,EAAG,GAAI,EAAI,OAAO,GAAI,AAC7B,EAAQ,GAAG,CAAC,GAAK,EAAI,GAAG,CAAC,EAAI,EAAQ,GAAG,CAAC,IACxC,EAAI,GAAG,CAAC,EAAI,EAAI,GAAG,CAAC,CAAG,CAAC,EAAI,EAAE,GAEvC,IAAI,CAAC,GAAG,CAAG,EACX,IAAI,CAAC,GAAG,CAAG,EACX,IAAI,CAAC,WAAW,CAAG,CACvB,CACA,YAAY,CAAK,CAAE,CAAK,CAAE,CACtB,GAAI,CAAC,IAAI,CAAC,GAAG,CAAE,OACf,IAAM,EAAK,IAAI,CAAC,GAAG,CAAC,EAAM,CACpB,EAAM,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,GACzB,GAAI,CAAC,EAAK,OAAO,KACjB,GAAM,MAAE,CAAI,CAAE,OAAK,CAAE,CAAG,EACxB,GAAI,CAAC,EAAO,OAAO,EACnB,GAAI,CAAC,GAAS,AAAiB,MAAX,MAAM,EAAU,CAAC,CAAK,CAAC,EAAE,CAAC,QAAQ,CAAE,OAAO,CAAK,CAAC,EAAE,CAAC,IAAI,CAE5E,IAAM,EAAM,EAAM,cAAc,CAAC,WAAW,GAC5C,IAAK,GAAM,CAAC,EAAG,CAAE,UAAQ,CAAE,CAAC,GAAI,EAAM,OAAO,GAAI,CAC7C,IAAM,EAAK,IAAI,CAAC,WAAW,CAAC,EAAK,GACjC,GAAK,CAAD,EACA,CADK,CACC,YAAY,CAAC,EAAI,GAAK,EAC5B,OAAQ,CAAK,CAAC,EAAI,EAAE,EAAE,MAAQ,CACtC,CACA,OAAO,CAAK,CAAC,EAAM,MAAM,CAAG,EAAE,CAAC,IAAI,AACvC,CACJ,CAEO,MAAM,EACT,YAAY,CAAQ,CAAE,CAAU,CAAE,CAAe,CAAE,CAC/C,IAAI,CAAC,KAAK,CAAG,EAAS,GAAG,CAAC,GAAiB,MAAZ,EAAE,MAAM,EAAY,EAAE,IAAI,CAAG,EAAI,EAAE,IAAI,CAAG,GACzE,IAAI,CAAC,UAAU,CAAG,EAClB,IAAI,CAAC,eAAe,CAAG,EACvB,IAAI,CAAC,SAAS,CAAG,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC,EAAG,IAAM,EAAI,EAAG,GACpD,IAAI,CAAC,gBAAgB,CAAG,IAAI,EAAC,CAAA,AAAoB,EACrD,EACA,CAAA,AAAoB,GAChB,GAAM,WAAE,CAAS,CAAE,CAAG,IAAI,CACpB,EAAU,CAAC,EAAE,CACf,EAAM,EACV,IAAK,IAAM,KAAQ,IAAI,CAAC,KAAK,CAAE,EAAQ,IAAI,CAAC,CAAC,GAAO,CAAA,CAAI,CAAI,GAC5D,OAAO,CACX,CAEA,YAAY,CAAK,CAAE,CAAiB,CAAE,EAAe,CAAC,CAAE,CACpD,GAAM,CAAE,OAAK,YAAE,CAAU,iBAAE,CAAe,WAAE,CAAS,CAAE,CAAG,IAAI,CACxD,EAAgB,CAAK,CAAC,EAAM,EAAI,EAEhC,EADa,AACN,EADY,KAAK,CAAC,EAAG,GAAO,MAAM,CAAC,CAAC,EAAG,IAAM,EAAI,EAAG,GACvC,EAAoB,EACxC,EAAW,EAAO,EAAe,EAGvC,MAAO,CACH,SAAU,EAAW,EACrB,QAAS,CACL,QAAS,EACT,MAAO,EAAM,MAAM,AACvB,EACA,SAAU,CACN,QAAS,KAAK,KAAK,CAAC,EAAO,GAC3B,KAAM,KAAK,KAAK,CAAC,EAAW,GAC5B,MAAO,KAAK,IAAI,CAAC,EAAY,EACjC,EACA,KAAM,CACF,QAAS,CAbS,EAAI,CAAA,CAAiB,CAAI,EAaf,EAC5B,MAAO,CAfQ,EAAY,CAAA,EAeH,CAC5B,CACJ,CACJ,CAGA,WAAW,CAAQ,CAAE,CACjB,GAAI,GAAY,EAAG,MAAO,CAAC,EAAG,EAAE,CAChC,GAAI,GAAY,EAAG,MAAO,CAAC,IAAI,CAAC,KAAK,CAAC,MAAM,CAAG,EAAG,EAAE,CACpD,GAAsB,OAAO,CAAlB,MAAyB,CACpC,GAAM,WAAE,CAAS,CAAE,CAAG,IAAI,CACtB,EAAQ,IAAI,CAAC,gBAAgB,CAAC,SAAS,CAAC,GAAK,EAAI,GAAY,EACjE,GAAI,EAAQ,EAAG,MAAO,CAAC,EAAG,EAAE,CAC5B,KAAO,CAAC,IAAI,CAAC,KAAK,CAAC,EAAM,EAAE,IAC3B,IAAM,EAAoB,CAAC,EAAW,IAAI,CAAC,gBAAgB,CAAC,EAAA,AAAM,GAC3D,CAAD,GAAK,CAAC,KAAK,CAAC,EAAM,CAAG,CAAA,CAAS,CACpC,MAAO,CAAC,EAAO,EAAkB,AACrC,CACJ,CD9GA,IAAA,EAAA,EAAA,CAAA,CAAA,QEFA,IAiBM,EAjBA,AAiBS,WAAW,YAAY,CAAG,WAAW,SAAS,CACvD,WAAW,kBAAkB,CAE7B,EAAa,IACf,GAAsB,IAAlB,EAAK,QAAQ,CAAQ,CACrB,IAAM,EAAO,EAAK,OAAO,CAAC,WAAW,SACrC,AAAa,WAAT,GAAqB,AAAS,SAAS,GAAO,WAAW,aAAa,CACnE,WAAW,WAAW,AACjC,CACA,OAAO,WAAW,aAAa,AACnC,EAEa,EAAa,UAAW,CAAC,CAAE,CAAI,CAAE,CAAU,EACpD,IAAM,EAAO,EAAE,uBAAuB,EAAI,EAAE,IAAI,EAAI,EAC9C,EAAS,SAAS,gBAAgB,CAAC,EAAM,EAAQ,CAAE,WAAY,GAAc,CAAW,GAExF,EAAQ,AADD,GAAE,uBAAuB,CAhCxB,CAAC,CAgC0B,CAhCnB,KACtB,IAAM,EAAQ,AA+BuC,EA/BrC,CAChB,IAAK,IAAI,EAAO,EAAO,WAAW,CAAE,EAAM,EAAO,EAAO,QAAQ,GAAI,CAChE,IAAM,EAAU,EAAM,YAAY,CAAC,EAAM,GACzC,GAAgB,IAAZ,EAAe,EAAM,IAAI,CAAC,QACzB,GAAI,EAAU,EAAG,KAC1B,CACA,OAAO,CACX,EAEqB,CAAC,EAAG,KACrB,IAAM,EAAQ,EAAE,CAChB,IAAK,IAAI,EAAO,EAAO,QAAQ,GAAI,EAAM,EAAO,EAAO,QAAQ,GAC3D,EAAM,IAAI,CAAC,GACf,OAAO,CACX,CAiByD,EAClC,EAAG,GAQtB,IAAK,IAAM,KAAS,EAPP,EAAM,CAOM,EAPH,CAAC,GAAQ,AAOA,EAPK,SAAS,EAAI,IAC/B,CAAC,EAAY,EAAa,EAAU,KAClD,IAAM,EAAQ,SAAS,WAAW,GAGlC,OAFA,EAAM,QAAQ,CAAC,CAAK,CAAC,EAAW,CAAE,GAClC,EAAM,MAAM,CAAC,CAAK,CAAC,EAAS,CAAE,GACvB,CACX,GAC2C,MAAM,CACrD,EFrCM,EAAgB,kBAEhB,EAAc,gBAEd,EAAQ,MAAM,IAChB,IAAM,EAAM,IAAI,WAAW,MAAM,EAAK,KAAK,CAAC,EAAG,GAAG,WAAW,IAC7D,OAAkB,KAAX,CAAG,CAAC,EAAE,EAAwB,KAAX,CAAG,CAAC,EAAE,EAAwB,AAAX,KAAG,CAAC,EAAE,EAAwB,IAAX,CAAG,CAAC,EAAE,AAC1E,EAEM,EAAQ,MAAM,IAChB,IAAM,EAAM,IAAI,WAAW,MAAM,EAAK,KAAK,CAAC,EAAG,GAAG,WAAW,IAC7D,OAAO,AAAW,MAAR,CAAC,EAAE,EACK,KAAX,CAAG,CAAC,EAAE,EAAwB,KAAX,CAAG,CAAC,EAAE,EAAwB,AAAX,MAAG,CAAC,EAAE,EACjC,KAAX,CAAG,CAAC,EAAE,AACjB,EAYM,EAAgB,MAAM,IACxB,GAAM,WAAE,CAAS,WAAE,CAAS,YAAE,CAAU,YAAE,CAAU,CAAE,YAAU,CAAE,CAC9D,MAAA,EAAA,CAAA,CAAA,QACJ,EAAU,CAAE,eAAe,CAAM,GACjC,IAAM,EAAS,IAAI,EAAU,IAAI,EAAW,IACtC,EAAU,MAAM,EAAO,UAAU,GACjC,EAAM,IAAI,IAAI,EAAQ,GAAG,CAAC,GAAS,CAAC,EAAM,QAAQ,CAAE,EAAM,GAC1D,EAAO,GAAK,CAAC,EAAM,GAAG,IACxB,EAAI,GAAG,CAAC,GAAQ,EAAE,EAAI,GAAG,CAAC,MAAU,GAAQ,KAC1C,EAAW,EAAK,GAAS,EAAM,OAAO,CAAC,IAAI,IAGjD,MAAO,SAAE,WAAS,EAAU,SAFX,EAAK,CAAC,EAAO,IAAS,EAAM,OAAO,CAAC,IAAI,EAAW,KAE9B,QADtB,GAAQ,EAAI,GAAG,CAAC,IAAO,kBAAoB,CACb,CAClD,EAEM,EAAiB,MAAM,GAAS,EAAM,MAAM,CAAG,EAC/C,CAAC,MAAM,QAAQ,GAAG,CAAC,MAAM,IAAI,CAC3B,MAAM,IAAI,QAAQ,CAAC,EAAS,IAAW,EAAM,YAAY,GACpD,WAAW,CAAC,GAAW,EAAQ,GAAU,GAAS,EAAO,KAC9D,GAAA,CAAgB,CAAE,IAAI,GAExB,EAAsB,MAAM,IAC9B,IAAM,EAAU,MAAM,EAAe,GAK/B,EAAM,IAAI,IAAI,CAJN,MAAM,QAAQ,GAAG,CAC3B,EAAQ,GAAG,CAAC,GAAS,IAAI,QAAQ,CAAC,EAAS,IACvC,EAAM,IAAI,CAAC,GAAQ,EAAQ,CAAC,EAAM,EAAM,QAAQ,CAAC,EAC7C,GAAS,EAAO,MAAA,EACF,GAAG,CAAC,CAAC,CAAC,EAAM,EAAK,GACvC,CAAC,EAAK,OAAO,CAAC,EAAM,QAAQ,CAAG,IAAK,IAAK,EAAK,GAC5C,EAAU,IAAI,YAMpB,MAAO,CAAE,SAHQ,MAAM,OAAQ,SAFX,CAAL,EAEuB,MAAM,CADlB,EAAI,GAAG,CAAC,AACoB,IADb,eAAiB,IAAA,GADlC,EAAQ,MAAM,CAAC,GAAK,MAKzB,SAFF,GAAQ,EAAI,GAAG,CAAC,GAEJ,QADb,GAAQ,EAAI,GAAG,CAAC,IAAO,MAAQ,CACV,CACzC,CAEO,OAAM,UAAsB,MAAO,CACnC,MAAM,UAAsB,MAAO,CACnC,MAAM,UAA6B,MAAO,CAEjD,IAAM,EAAY,MAAM,IACpB,IAAM,EAAM,MAAM,MAAM,GACxB,GAAI,CAAC,EAAI,EAAE,CAAE,MAAM,IAAI,EACnB,CAAA,EAAG,EAAI,MAAM,CAAC,CAAC,EAAE,EAAI,UAAU,CAAA,CAAE,CAAE,CAAE,MAAO,CAAI,GACpD,OAAO,IAAI,KAAK,CAAC,MAAM,EAAI,IAAI,GAAG,CAAE,IAAI,IAAI,EAAI,GAAG,EAAE,QAAQ,CACjE,EAEa,EAAW,MAAM,QAEtB,EACJ,GAFoB,UAAhB,OAAO,IAAmB,EAAO,MAAM,EAAU,EAAA,EAEjD,EAAK,WAAW,CAAE,CAClB,IAAM,EAAS,MAAM,EAAoB,GACnC,CAAE,MAAI,CAAE,CAAG,MAAA,EAAA,CAAA,CAAA,QACjB,EAAO,MAAM,IAAI,EAAK,GAAQ,IAAI,EACtC,MACK,GAAK,CAAD,CAAM,IAAI,CACd,GAAI,MAAM,EAAM,GAAO,CACxB,IAAM,EAAS,MAAM,EAAc,GACnC,GAAI,CAtEE,CAAC,MAAE,CAAI,CAAE,MAAI,CAAE,GAChB,kCAAT,GAA4C,EAAK,QAAQ,CAAC,OAAA,EAqE5C,GAAO,CACb,GAAM,eAAE,CAAa,CAAE,CAAG,MAAA,EAAA,CAAA,CAAA,QAC1B,EAAO,EAAc,EAAQ,EACjC,MACK,GAAI,CApEH,CAAC,MAAE,CAAI,MAAE,CAAI,CAAE,GAChB,qCAAT,GACG,EAAK,QAAQ,CAAC,aAAe,EAAK,QAAQ,CAAC,OAAA,EAkE3B,GAAO,CAClB,GAAM,CAAE,SAAO,CAAE,CAAG,MAAA,EAAA,CAAA,CAAA,QACd,SAAE,CAAO,CAAE,CAAG,EACd,EAAQ,EAAQ,IAAI,CAAC,GAAS,EAAM,QAAQ,CAAC,QAAQ,CAAC,SACtD,EAAO,MAAM,EAAO,QAAQ,CAAC,CAAC,GAAS,CAAO,CAAC,EAAA,AAAE,EAAE,QAAQ,EACjE,EAAO,MAAM,EAAQ,EACzB,KACK,CACD,GAAM,MAAE,CAAI,CAAE,CAAG,MAAA,EAAA,CAAA,CAAA,QACjB,EAAO,MAAM,IAAI,EAAK,GAAQ,IAAI,EACtC,CACJ,MACK,GAAI,MAAM,EAAM,GAAO,CACxB,GAAM,SAAE,CAAO,CAAE,CAAG,MAAA,EAAA,CAAA,CAAA,QACpB,EAAO,MAAM,EAAQ,EACzB,KACK,CACD,GAAM,QAAE,CAAM,MAAE,CAAI,CAAE,CAAG,MAAA,EAAA,CAAA,CAAA,QACzB,GAAI,MAAM,EAAO,GAAO,CACpB,IAAM,EAAS,MAAA,EAAA,CAAA,CAAA,OACf,EAAO,MAAM,IAAI,EAAK,CAAE,OAAQ,EAAO,UAAW,AAAD,GAAI,IAAI,CAAC,EAC9D,MACK,GAAI,CA7FH,CAAC,MAAE,CAAI,MAAE,CAAI,CAAE,GAChB,kCAAT,GAA4C,EAAK,QAAQ,CAAC,OAAA,EA4FvC,GAAO,CAClB,GAAM,CAAE,SAAO,CAAE,CAAG,MAAA,EAAA,CAAA,CAAA,QACpB,EAAO,MAAM,EAAQ,EACzB,CACJ,MAjCqB,MAAM,IAAI,EAAc,kBAkC7C,GAAI,CAAC,EAAM,MAAM,IAAI,EAAqB,2BAC1C,OAAO,CACX,CAEA,OAAM,GACF,CAAA,AAAQ,EACR,CAAA,AAAG,EACH,CAAM,AAAN,AACA,CAAA,EACA,AADM,aACM,CAAE,CAAE,CAAK,CAAE,EAAQ,CAAC,CAAC,CAAE,CAC/B,IAAI,EAAC,CAAA,AAAG,CAAG,EACX,IAAI,CAAC,CAAA,CAAM,CAAG,EACd,IAAI,EAAC,CAAA,AAAM,CAAG,EACV,IAAI,EAAC,CAAA,AAAM,CAAC,MAAM,EAAE,IAAI,CAAC,IAAI,GACjC,IAAI,EAAC,CAAA,AAAG,CAAC,gBAAgB,CAAC,YAAa,CAAC,SAAE,CAAO,SAAE,CAAO,CAAE,IAEpD,KAAY,IAAI,CAAC,CAAA,CAAM,CAAC,CAAC,EAAI,IAAY,IAAI,EAAC,CAAM,AAAN,EAAO,AAAC,EAAE,EAC5D,IAAI,EAAC,CAAA,AAAM,CAAC,CAAC,CAAG,EAAS,IAAI,EAAC,CAAA,AAAM,CAAC,CAAC,CAAG,EACzC,IAAI,CAAC,IAAI,GACL,IAAI,EAAC,CAAA,AAAQ,EAAE,aAAa,IAAI,EAAC,CAAA,AAAQ,EACzC,MAAS,IAAI,EAAC,CAAA,AAAQ,CAAG,WAAW,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,EAAG,IAAA,EAClE,GAAG,EACP,CACA,SAAS,CAAE,CAAE,CACT,OAAO,IAAI,EAAgB,EAAI,IAAI,CAAC,CAAA,CAAM,CAAE,IAAI,EAAC,CAAA,AAAM,CAC3D,CACA,MAAO,CACH,IAAI,EAAC,CAAA,AAAG,CAAC,KAAK,CAAC,MAAM,CAAG,OACxB,IAAI,CAAC,CAAA,CAAM,CAAC,MAAM,EAAG,CACzB,CACA,MAAO,CACH,IAAI,EAAC,CAAA,AAAG,CAAC,KAAK,CAAC,cAAc,CAAC,UAC9B,IAAI,EAAC,CAAA,AAAM,CAAC,MAAM,EAAG,CACzB,CACJ,CAEA,MAAM,UAAgB,aAClB,CAAI,AAAJ,CAAO,EAAE,EACT,CAAA,AAAM,CAAG,CAAC,CAAC,CACX,UAAU,CAAC,CAAE,CACT,IAAM,EAAO,IAAI,EAAC,CAAI,AAAJ,CAAK,IAAI,EAAC,CAAA,AAAM,CAAC,CAC/B,IAAS,GAAK,GAAM,UAAY,EAAK,QAAQ,GAAK,EAAE,QAAQ,EAAE,CAClE,IAAI,EAAC,CAAA,AAAI,CAAC,EAAE,IAAI,CAAC,CAAA,CAAM,CAAC,CAAG,EAC3B,IAAI,EAAC,CAAA,AAAI,CAAC,MAAM,CAAG,IAAI,EAAC,CAAA,AAAM,CAAG,EACjC,IAAI,CAAC,aAAa,CAAC,IAAI,MAAM,iBACjC,CACA,aAAa,CAAC,CAAE,CACZ,IAAM,EAAQ,IAAI,EAAC,CAAA,AAAM,CACzB,IAAI,EAAC,CAAA,AAAI,CAAC,EAAM,CAAG,CACvB,CACA,MAAO,CACH,IAAM,EAAQ,IAAI,EAAC,CAAM,AAAN,CACnB,GAAI,GAAS,EAAG,OAChB,IAAM,EAAS,CAAE,MAAO,IAAI,EAAC,CAAA,AAAI,CAAC,EAAQ,EAAE,AAAC,EAC7C,IAAI,EAAC,CAAA,AAAM,CAAG,EAAQ,EACtB,IAAI,CAAC,aAAa,CAAC,IAAI,YAAY,WAAY,QAAE,CAAO,IACxD,IAAI,CAAC,aAAa,CAAC,IAAI,MAAM,gBACjC,CACA,SAAU,CACN,IAAM,EAAQ,IAAI,EAAC,CAAA,AAAM,CACzB,GAAI,GAAS,IAAI,EAAC,CAAA,AAAI,CAAC,MAAM,CAAG,EAAG,OACnC,IAAM,EAAS,CAAE,MAAO,IAAI,EAAC,CAAA,AAAI,CAAC,EAAQ,EAAE,AAAC,EAC7C,IAAI,EAAC,CAAA,AAAM,CAAG,EAAQ,EACtB,IAAI,CAAC,aAAa,CAAC,IAAI,YAAY,WAAY,QAAE,CAAO,IACxD,IAAI,CAAC,aAAa,CAAC,IAAI,MAAM,gBACjC,CACA,IAAI,WAAY,CACZ,OAAO,IAAI,CAAC,CAAA,CAAM,CAAG,CACzB,CACA,IAAI,cAAe,CACf,OAAO,IAAI,EAAC,CAAA,AAAM,CAAG,IAAI,EAAC,CAAA,AAAI,CAAC,MAAM,CAAG,CAC5C,CACA,OAAQ,CACJ,IAAI,EAAC,CAAI,AAAJ,CAAO,EAAE,CACd,IAAI,EAAC,CAAA,AAAM,CAAG,CAAC,CACnB,CACJ,CAgBO,MAAM,UAAa,YACtB,CAAA,CAAK,CAAG,IAAI,CAAC,YAAY,CAAC,CAAE,KAAM,MAAO,EAAE,EAC3C,CAAgB,AAAhB,AAAgB,EAChB,CAAA,AAAY,EACZ,CAAA,AAAa,EACb,CAAA,AAAc,CAAG,IAAI,GAAK,EAC1B,CAAA,AAAgB,CAAG,IAAI,EAAgB,IAAI,CAAE,IACzC,IAAI,CAAC,YAAY,CAAC,mBAAmB,CACzC,eAAgB,CAAK,CACrB,YAAY,CACZ,QAAU,IAAI,CAAS,AACvB,cAAc,CACV,KAAK,GACL,IAAI,CAAC,OAAO,CAAC,gBAAgB,CAAC,WAAY,CAAC,QAAE,CAAM,CAAE,IACjD,IAAM,EAAW,IAAI,CAAC,iBAAiB,CAAC,EAAO,KAAK,EACpD,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,EACvB,EACJ,CACA,MAAM,KAAK,CAAI,CAAE,CAOb,IANoB,UAAhB,OAAO,GACoB,YAA5B,OAAO,EAAK,WAAW,EACvB,EAAK,WAAA,AAAW,IAAE,EAAO,MAAM,EAAS,EAAA,EAC3C,IAAI,CAAC,IAAI,CAAG,EACZ,IAAI,CAAC,QAAQ,CAAG,CArCH,IACjB,GAAI,CAAC,EAAM,MAAO,CAAC,EACnB,GAAI,CACA,IAAM,EAAY,KAAK,mBAAmB,CAAC,EAAK,CAAC,EAAE,CAC7C,EAAS,IAAI,KAAK,MAAM,CAAC,GACzB,EAAQ,CAAC,KAAM,KAAM,KAAK,CAAC,QAAQ,CAAC,EAAO,QAAQ,EACnD,GAAa,EAAO,OAAR,IAAmB,MAAQ,EAAO,QAAA,AAAQ,GAAG,UAC/D,MAAO,WAAE,EAAW,eAAQ,YAAO,CAAU,CACjD,CAAE,MAAO,EAAG,CAER,OADA,QAAQ,IAAI,CAAC,GACN,CAAC,CACZ,CACJ,GAyBqC,EAAK,QAAQ,EAAE,UAExC,EAAK,YAAY,EAAI,EAAK,cAAc,CAAE,CAC1C,IAAM,EAAM,EAAK,QAAQ,CAAC,GAAG,CAAC,GAAK,EAAE,EAAE,EACvC,IAAI,EAAC,CAAA,AAAgB,CAAG,IAAI,EAAgB,EAAK,QAAQ,CAAE,KAAM,MACjE,IAAM,EAAY,EAAK,YAAY,CAAC,IAAI,CAAC,GACnC,EAAc,EAAK,cAAc,CAAC,IAAI,CAAC,GAC7C,IAAI,EAAC,CAAA,AAAY,CAAG,IAAI,EACxB,MAAM,IAAI,EAAC,CAAA,AAAY,CAAC,IAAI,CAAC,CACzB,IAAK,EAAK,GAAG,EAAI,EAAE,KAAE,YAAK,cAAW,CAAY,GACrD,IAAI,CAAC,CAAA,CAAa,CAAG,IAAI,EACzB,MAAM,IAAI,EAAC,CAAa,AAAb,CAAc,IAAI,CAAC,CAC1B,IAAK,EAAK,QAAQ,EAAI,EAAE,CAAE,gBAAK,cAAW,CAAY,EAC9D,CAkBA,GAhBA,IAAI,CAAC,aAAa,CAAG,IAAI,CAAC,IAAI,CAAC,SAAS,EAAE,SAAW,gBACjD,IAAI,CAAC,aAAa,EAAE,AACpB,MAAA,EAAA,CAAA,CAAA,QACA,IAAI,CAAC,QAAQ,CAAG,SAAS,aAAa,CAAC,iBAEvC,MAAA,EAAA,CAAA,CAAA,QACA,IAAI,CAAC,QAAQ,CAAG,SAAS,aAAa,CAAC,sBAE3C,IAAI,CAAC,QAAQ,CAAC,YAAY,CAAC,cAAe,8BAC1C,IAAI,CAAC,QAAQ,CAAC,gBAAgB,CAAC,OAAQ,GAAK,IAAI,EAAC,CAAA,AAAO,CAAC,EAAE,MAAM,GACjE,IAAI,CAAC,QAAQ,CAAC,gBAAgB,CAAC,WAAY,GAAK,IAAI,EAAC,CAAA,AAAW,CAAC,EAAE,MAAM,GACzE,IAAI,CAAC,QAAQ,CAAC,gBAAgB,CAAC,mBAAoB,GAC/C,EAAE,MAAM,CAAC,MAAM,CAAC,IAAI,EAAC,CAAA,AAAgB,CAAC,EAAE,MAAM,IAClD,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,GACnB,IAAI,EAAC,CAAA,AAAK,CAAC,MAAM,CAAC,IAAI,CAAC,QAAQ,EAE3B,EAAK,QAAQ,CAAC,IAAI,CAAC,GAAW,EAAQ,YAAY,EAAG,CACrD,IAGI,EAHE,EAAc,EAAK,KAAK,CAAC,WAAW,CACpC,EAAsB,EAAK,KAAK,CAAC,mBAAmB,CAC1D,IAAI,CAAC,YAAY,CAAG,EAAK,eAAe,GAExC,IAAI,CAAC,YAAY,CAAC,gBAAgB,CAAC,YAAa,IAC5C,IAAM,EAAW,IAAI,CAAC,iBAAiB,CAAC,EAAE,MAAM,CAAC,IAAI,EACrD,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,GACd,IAAI,CAAC,KACF,GAAM,KAAE,CAAG,CAAE,CAAG,IAAI,CAAC,QAAQ,CAAC,WAAW,GACpC,IAAI,CAAC,GAAK,EAAE,KAAK,CAAG,EAAS,KAAK,EACjC,EAAK,EAAS,MAAM,CAAC,GAC3B,EAAG,SAAS,CAAC,GAAG,CAAC,GACb,GAAqB,EAAG,aAAa,CACpC,eAAe,CAAC,SAAS,CAAC,GAAG,CAAC,GACnC,EAAa,IAAI,QAAQ,EAC7B,EACR,GACA,IAAI,CAAC,YAAY,CAAC,gBAAgB,CAAC,cAAe,KAC9C,IAAM,EAAK,GAAY,QACnB,IAAI,AACJ,EAAG,SAAS,CAAC,MAAM,CAAC,GAChB,GAAqB,EAAG,aAAa,CACpC,eAAe,CAAC,SAAS,CAAC,MAAM,CAAC,GAE9C,EACJ,CACJ,CACA,OAAQ,CACJ,IAAI,CAAC,QAAQ,EAAE,UACf,IAAI,CAAC,QAAQ,EAAE,SACf,IAAI,EAAC,CAAA,AAAgB,CAAG,KACxB,IAAI,EAAC,CAAA,AAAY,CAAG,KACpB,IAAI,EAAC,CAAA,AAAa,CAAG,KACrB,IAAI,EAAC,CAAA,AAAc,CAAG,IAAI,IAC1B,IAAI,CAAC,YAAY,CAAG,KACpB,IAAI,CAAC,OAAO,CAAC,KAAK,GAClB,IAAI,CAAC,GAAG,CAAG,KACX,IAAI,CAAC,YAAY,CAAG,IACxB,CACA,eAAgB,CACZ,OAAO,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,SAAS,EAC9B,KAAK,GAAK,EAAE,IAAI,CAAC,QAAQ,CAAC,eAAiB,EAAE,IAAI,CAAC,QAAQ,CAAC,UAC3D,MAAQ,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC,GAAkB,OAAb,EAAE,MAAM,EAC5D,CACA,MAAM,KAAK,cAAE,CAAY,eAAE,CAAa,CAAE,CAAE,CACxC,IAAM,EAAW,EAAe,IAAI,CAAC,iBAAiB,CAAC,GAAgB,KACnE,GACA,MAAM,CADI,GACA,CAAC,QAAQ,CAAC,IAAI,CAAC,GACzB,IAAI,CAAC,OAAO,CAAC,SAAS,CAAC,IAElB,EAAe,MAAM,IAAI,CAAC,aAAa,IAE5C,IAAI,CAAC,OAAO,CAAC,SAAS,CAAC,GACvB,MAAM,IAAI,CAAC,IAAI,GAEvB,EACA,CAAA,AAAK,CAAC,CAAI,CAAE,CAAM,CAAE,CAAU,EAC1B,OAAO,IAAI,CAAC,aAAa,CAAC,IAAI,YAAY,EAAM,QAAE,aAAQ,CAAW,GACzE,CACA,CAAA,CAAW,CAAC,QAAE,CAAM,OAAE,CAAK,OAAE,CAAK,UAAE,CAAQ,MAAE,CAAI,CAAE,EAChD,IAAM,EAAW,IAAI,EAAC,CAAgB,AAAhB,EAAkB,YAAY,EAAO,EAAU,IAAS,CAAC,EACzE,EAAU,IAAI,EAAC,CAAA,AAAY,EAAE,YAAY,EAAO,GAChD,EAAW,IAAI,EAAC,CAAA,AAAa,EAAE,YAAY,EAAO,GAClD,EAAM,IAAI,CAAC,MAAM,CAAC,EAAO,EAC/B,KAAI,CAAC,YAAY,CAAG,CAAE,GAAG,CAAQ,SAAE,WAAS,MAAU,QAAK,CAAM,GAClD,SAAX,GAAgC,AAAX,YAAgC,WAAX,CAAW,GACrD,IAAI,CAAC,OAAO,CAAC,YAAY,CAAC,GAC9B,IAAI,EAAC,CAAA,AAAK,CAAC,WAAY,IAAI,CAAC,YAAY,CAC5C,EACA,CAAA,AAAO,CAAC,CAAE,KAAG,OAAE,CAAK,CAAE,EAElB,EAAI,eAAe,CAAC,IAAI,GAAK,IAAI,CAAC,QAAQ,CAAC,SAAS,EAAI,GACnD,AAAD,IAAK,CAAC,QAAQ,CAAC,KAAK,GACpB,EAAI,eAAe,CAAC,GAAG,GAAK,IAAI,CAAC,QAAQ,CAAC,SAAS,EAAI,EAAA,EAE3D,IAAI,EAAC,CAAA,AAAY,CAAC,EAAK,GACvB,IAAI,EAAC,CAAA,AAAgB,CAAC,QAAQ,CAAC,EAAI,eAAe,EAElD,IAAI,EAAC,CAAA,AAAK,CAAC,OAAQ,KAAE,QAAK,CAAM,EACpC,EACA,CAAY,AAAZ,CAAa,CAAG,CAAE,CAAK,EACnB,GAAM,MAAE,CAAI,CAAE,CAAG,IAAI,CACf,EAAU,EAAK,QAAQ,CAAC,EAAM,CACpC,EAAI,gBAAgB,CAAC,QAAS,IAC1B,IAAM,EAAI,EAAE,MAAM,CAAC,OAAO,CAAC,WAC3B,GAAI,CAAC,EAAG,OACR,EAAE,cAAc,GAChB,IAAM,EAAQ,EAAE,YAAY,CAAC,QACvB,EAAO,GAAS,cAAc,IAAU,EAC9C,GAAI,GAAM,aAAa,GACnB,QAAQ,OAAO,CAAC,IAAI,EAAC,CAAA,AAAK,CAAC,gBAAiB,GAAE,OAAG,CAAK,GAAG,IACpD,IAAI,CAAC,GAAK,EAAI,WAAW,IAAI,CAAC,EAAM,UAAY,MAChD,KAAK,CAAC,GAAK,QAAQ,KAAK,CAAC,QAC7B,CACD,IAAI,EAAe,EACnB,GAAI,CAAC,EAAK,WAAW,CAAC,GAAO,CACzB,IAAM,EAAY,EAAM,OAAO,CAAC,KAChC,GAAI,GAAa,EAAG,CAChB,IAAM,EAAO,EAAM,KAAK,CAAC,GACzB,EAAe,GAAS,cAAc,IAAS,CACnD,CACJ,CACA,QAAQ,OAAO,CAAC,IAAI,EAAC,CAAA,AAAK,CAAC,OAAQ,CAAE,IAAG,KAAM,CAAa,GAAG,IACzD,IAAI,CAAC,GAAK,EAAI,IAAI,CAAC,IAAI,CAAC,GAAgB,MACxC,KAAK,CAAC,GAAK,QAAQ,KAAK,CAAC,GAClC,CACJ,EACJ,CACA,MAAM,cAAc,CAAU,CAAE,CAAM,CAAE,CACpC,GAAM,OAAE,CAAK,CAAE,CAAG,EAClB,GAAI,EAAM,UAAU,CAAC,GAAgB,CACjC,IAAM,EAAM,EAAM,OAAO,CAAC,EAAe,IACnC,OAAE,CAAK,QAAE,CAAM,CAAE,CAAG,MAAM,IAAI,CAAC,iBAAiB,CAAC,GACjD,EAAM,IAAI,EAAC,CAAA,AAAa,CAAC,GAC/B,GAAI,EAAK,CACL,GAAM,WAAE,CAAS,CAAE,KAAG,CAAE,CAAG,EAC3B,GAAI,EAAQ,YACR,EAAU,MAAM,CAAC,GAGrB,IAAM,EAAQ,EAAM,EAAO,GAAO,EAClC,EAAU,GAAG,CAAC,EAAO,EAAO,EAAA,SAAS,CAAC,OAAO,CACjD,CACA,MACJ,CAAO,GAAI,EAAM,UAAU,CAAC,GAAc,CACtC,IAAM,EAAM,EAAM,OAAO,CAAC,EAAa,IACjC,OAAE,CAAK,QAAE,CAAM,CAAE,CAAG,MAAM,IAAI,CAAC,iBAAiB,CAAC,GACjD,EAAM,IAAI,EAAC,CAAA,AAAa,CAAC,GAC/B,GAAI,EAAK,CACL,GAAM,WAAE,CAAS,KAAE,CAAG,CAAE,CAAG,EAC3B,GAAI,EAAQ,YACR,EAAU,MAAM,CAAC,GAGrB,IAAM,EAAQ,EAAM,EAAO,GAAO,EAElC,IAAI,CAAC,CAAA,CAAK,CAAC,kBAAmB,CAAE,KADnB,CAAC,EAAM,IAAS,EAAU,GAAG,CAAC,EAAO,EAAO,EAAM,cACzB,EAAY,YAAK,CAAM,EACjE,CACA,MACJ,CACA,GAAM,OAAE,CAAK,QAAE,CAAM,CAAE,CAAG,MAAM,IAAI,CAAC,iBAAiB,CAAC,GACjD,EAAM,IAAI,EAAC,CAAA,AAAa,CAAC,GAC/B,GAAI,EAAK,CACL,GAAM,WAAE,CAAS,KAAE,CAAG,CAAE,CAAG,EAE3B,GADA,EAAU,MAAM,CAAC,GACb,CAAC,EAAQ,CACT,IAAM,EAAQ,EAAM,EAAO,GAAO,EAElC,IAAI,EAAC,CAAA,AAAK,CAAC,kBAAmB,CAAE,KADnB,CAAC,EAAM,IAAS,EAAU,GAAG,CAAC,EAAO,EAAO,EAAM,cACzB,MAAY,QAAK,CAAM,EACjE,CACJ,CACA,IAAM,EAAQ,IAAI,CAAC,CAAA,CAAY,CAAC,WAAW,CAAC,IAAQ,OAAS,GAC7D,MAAO,OAAE,QAAO,CAAM,CAC1B,CACA,iBAAiB,CAAU,CAAE,CACzB,OAAO,IAAI,CAAC,aAAa,CAAC,GAAY,EAC1C,CACA,CAAA,CAAa,CAAC,CAAK,EACf,OAAO,IAAI,CAAC,QAAQ,CAAC,WAAW,GAC3B,IAAI,CAAC,GAAK,EAAE,KAAK,GAAK,GAAS,EAAE,SAAS,CACnD,CACA,CAAA,CAAgB,CAAC,KAAE,CAAG,OAAE,CAAK,CAAE,EAC3B,IAAM,EAAY,IAAI,EAAA,SAAS,CAAC,GAChC,EAAI,gBAAgB,CAAC,QAAS,IAC1B,GAAM,CAAC,EAAO,EAAO,EAAK,CAAG,EAAU,OAAO,CAAC,EAC3C,IAAS,CAAC,EAAM,UAAU,CAAC,IAC3B,IAAI,EAAC,CAAA,AAAK,CAAC,IADgC,cACb,OAAE,QAAO,QAAO,OAAO,CAAK,EAElE,GAAG,GAEH,IAAI,EAAkB,EAEhB,EAAY,WAAW,IAAI,CAAC,UAAU,SAAS,EAErD,EAAI,gBAAgB,CAAC,YAAa,AAAC,IAC/B,GAAI,EAAW,OACf,IAAM,EAAM,YAAY,GAAG,GAC3B,GAAI,EAAM,EANM,IAMyB,OACzC,EAAkB,EAClB,CAF4B,EAEtB,CAAC,EAAM,CAAG,EAAU,OAAO,CAAC,GAC9B,GAAS,CAAC,EAAM,UAAU,CAAC,GAC3B,EAAI,IAAI,CAAC,KAAK,CAD6B,AAC5B,MAAM,CAAG,UAExB,EAAI,IAAI,CAAC,KAAK,CAAC,MAAM,CAAG,EAEhC,GAEA,IAAM,EAAO,IAAI,EAAC,CAAc,AAAd,CAAe,GAAG,CAAC,GACrC,GAAI,EAAM,IAAK,IAAM,KAAQ,EAAM,IAAI,CAAC,aAAa,CAAC,GAGtD,OADA,IAAI,EAAC,CAAA,AAAK,CAAC,iBAAkB,OAAE,CAAM,GAC9B,CACX,CACA,MAAM,eAAe,CAAU,CAAE,CAC7B,GAAM,OAAE,CAAK,CAAE,CAAG,EACZ,EAAW,MAAM,IAAI,CAAC,IAAI,CAAC,GACjC,GAAI,EAAU,CACV,GAAM,OAAE,CAAK,QAAE,CAAM,CAAE,CAAG,EACpB,KAAE,CAAG,CAAE,CAAI,IAAI,EAAC,CAAA,AAAa,CAAC,GAC9B,EAAQ,EAAO,GACrB,IAAI,EAAC,CAAA,AAAK,CAAC,kBAAmB,OAAE,QAAO,QAAO,CAAM,EACxD,CACJ,CACA,OAAO,CAAK,CAAE,CAAK,CAAE,CACjB,IAAM,EAAU,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,EAAM,CAAC,GAAG,EAAI,EAAA,IAAQ,CAAC,SAAS,CAAC,UACpE,AAAK,EACE,EAAA,AADH,GAAQ,MACQ,CAAC,EAAS,EAAA,SAAa,CAAC,IADzB,CAEvB,CACA,WAAW,CAAG,CAAE,CACZ,GAAI,IAAI,CAAC,IAAI,CAAC,UAAU,CACpB,OAAO,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC,EAC3B,EACD,IAAM,EAAQ,EAAA,KAAS,CAAC,GAGxB,MAAO,CAAE,MAFK,EAAA,IAAQ,CAAC,OAAO,CAAC,CAAC,EAAM,MAAM,EAAI,CAAA,CAAK,CAAE,KAAK,IAE5C,OADD,GAAO,EAAA,OAAW,CAAC,EAAK,EAChB,CAC3B,CACJ,CACA,kBAAkB,CAAM,CAAE,CACtB,GAAI,CACA,GAAsB,UAAlB,OAAO,EAAqB,MAAO,CAAE,MAAO,CAAO,EACvD,GAAI,AAA2B,iBAApB,EAAO,QAAQ,CAAe,CACrC,GAAM,CAAC,EAAO,EAAO,CAAG,IAAI,EAAC,CAAgB,AAAhB,CAAiB,UAAU,CAAC,EAAO,QAAQ,EACxE,MAAO,OAAE,SAAO,CAAO,CAC3B,CACA,GAAI,EAAA,KAAS,CAAC,IAAI,CAAC,GAAS,OAAO,IAAI,CAAC,UAAU,CAAC,GACnD,OAAO,IAAI,CAAC,IAAI,CAAC,WAAW,CAAC,EACjC,CAAE,MAAO,EAAG,CACR,QAAQ,KAAK,CAAC,GACd,QAAQ,KAAK,CAAC,CAAC,yBAAyB,EAAE,EAAA,CAAQ,CACtD,CACJ,CACA,MAAM,KAAK,CAAM,CAAE,CACf,IAAM,EAAW,IAAI,CAAC,iBAAiB,CAAC,GACxC,GAAI,CAGA,OAFA,MAAM,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,GACzB,IAAI,CAAC,OAAO,CAAC,SAAS,CAAC,GAChB,CACX,CAAE,MAAM,EAAG,CACP,QAAQ,KAAK,CAAC,GACd,QAAQ,KAAK,CAAC,CAAC,gBAAgB,EAAE,EAAA,CAAQ,CAC7C,CACJ,CACA,MAAM,aAAa,CAAI,CAAE,CACrB,GAAM,CAAC,EAAO,EAAO,CAAG,IAAI,CAAC,CAAA,CAAgB,CAAC,UAAU,CAAC,EACzD,OAAM,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,OAAE,SAAO,CAAO,GACzC,IAAI,CAAC,OAAO,CAAC,SAAS,CAAC,CAAE,SAAU,CAAK,EAC5C,CACA,MAAM,OAAO,CAAM,CAAE,CACjB,GAAI,CACA,IAAM,EAAM,MAAM,IAAI,CAAC,iBAAiB,CAAC,EACzC,OAAM,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAE,GAAG,CAAG,CAAE,QAAQ,CAAK,GAChD,IAAI,CAAC,OAAO,CAAC,SAAS,CAAC,EAC3B,CAAE,MAAM,EAAG,CACP,QAAQ,KAAK,CAAC,GACd,QAAQ,KAAK,CAAC,CAAC,gBAAgB,EAAE,EAAA,CAAQ,CAC7C,CACJ,CACA,UAAW,CACP,IAAK,GAAM,CAAE,KAAG,CAAE,GAAI,IAAI,CAAC,QAAQ,CAAC,WAAW,GAC3C,EAAI,WAAW,CAAC,YAAY,GAAG,eAAe,EACtD,CACA,qBAAsB,CAClB,MAAO,CAAC,IAAI,EAAC,CAAA,AAAgB,EAAE,kBAAoB,EAAA,AAAE,EAChD,GAAG,CAAC,GAAK,EAAI,OAAO,OAAO,CACpC,CACA,cAAc,CAAK,CAAE,CAAK,CAAE,CAGxB,MAAO,CAAE,QAFO,IAAI,EAAC,CAAA,AAAY,EAAE,YAAY,EAAO,GAEpC,SADD,IAAI,EAAC,CAAA,AAAa,EAAE,YAAY,EAAO,EAC7B,CAC/B,CACA,MAAM,aAAa,CAAM,CAAE,CACvB,GAAI,CACA,GAAM,OAAE,CAAK,QAAE,CAAM,CAAE,CAAG,MAAM,IAAI,CAAC,iBAAiB,CAAC,GACjD,EAAM,MAAM,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,EAAM,CAAC,cAAc,GACpD,EAAO,EAAO,GACd,EAAU,aAAgB,MAC1B,EAAQ,EAAU,EAAO,EAAI,WAAW,GAE9C,OADI,AAAC,GAAS,EAAM,kBAAkB,CAAC,GAChC,IAAI,EAAC,CAAA,AAAY,CAAC,WAAW,CAAC,EAAO,EAChD,CAAE,MAAM,EAAG,CACP,QAAQ,KAAK,CAAC,GACd,QAAQ,KAAK,CAAC,CAAC,cAAc,EAAE,EAAA,CAAQ,CAC3C,CACJ,CACA,MAAM,KAAK,CAAQ,CAAE,CACjB,MAAM,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,EAC7B,CACA,MAAM,KAAK,CAAQ,CAAE,CACjB,MAAM,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,EAC7B,CACA,MAAM,IAAI,CAAE,CAAE,CAAE,CAAE,CACd,MAAM,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,EAAI,EAChC,CACA,aAAc,CACV,OAAO,IAAI,CAAC,QAAQ,CAAC,WAAW,AACpC,CACA,aAAc,CACV,OAAO,IAAI,CAAC,QAAQ,CAAC,WAAW,AACpC,CACA,QAAS,CACL,MAAyB,QAAlB,IAAI,CAAC,IAAI,CAAC,GAAG,CAAa,IAAI,CAAC,IAAI,GAAK,IAAI,CAAC,IAAI,EAC5D,CACA,SAAU,CACN,MAAyB,QAAlB,IAAI,CAAC,IAAI,CAAC,GAAG,CAAa,IAAI,CAAC,IAAI,GAAK,IAAI,CAAC,IAAI,EAC5D,CACA,QAAQ,CAAc,AAAd,CAAe,CAAO,CAAE,CAAK,CAAE,CAAK,EAExC,IAAK,GAAM,CAAE,OAAK,SAAE,CAAO,CAAE,GAAI,EADrB,MAAM,AACuB,IADnB,CAAC,IAAI,CAAC,QAAQ,CAAC,EAAM,CAAC,cAAc,GACZ,GAC1C,KAAM,CAAE,IAAK,IAAI,CAAC,MAAM,CAAC,EAAO,WAAQ,CAAQ,CACxD,CACA,QAAQ,CAAA,AAAW,CAAC,CAAO,CAAE,CAAK,EAC9B,GAAM,UAAE,CAAQ,CAAE,CAAG,IAAI,CAAC,IAAI,CAC9B,IAAK,GAAM,CAAC,EAAO,gBAAE,CAAc,CAAE,CAAC,GAAI,EAAS,OAAO,GAAI,CAC1D,GAAI,CAAC,EAAgB,SAErB,IAAM,EAAW,MAAM,IAAI,CAAC,EADhB,MACwB,AADlB,IACuB,GAAQ,CAAC,OAAE,CAAK,SAAE,CAAO,CAAE,GAChE,CAAC,CAAE,IAAK,IAAI,CAAC,MAAM,CAAC,EAAO,WAAQ,EAAQ,CAAC,EAC1C,EAAW,CAAC,GAAQ,CAAC,CAAI,EAAS,MAAM,AAC9C,MAAM,UAAE,CAAS,EACb,EAAS,MAAM,GAAE,KAAM,OAAE,WAAO,EAAS,CACjD,CACJ,CACA,OAAQ,OAAO,CAAI,CAAE,CACjB,IAAI,CAAC,WAAW,GAChB,GAAM,eAAE,CAAa,CAAE,CAAG,MAAA,EAAA,CAAA,CAAA,QACpB,UAAE,CAAQ,CAAE,CAAG,IAAI,CAAC,IAAI,CACxB,OAAE,CAAK,OAAE,CAAK,SAAE,CAAO,CAAE,CAAG,EAC5B,EAAU,EAAc,EAC1B,CAAE,cAAe,IAAI,CAAC,QAAQ,CAAE,GAAG,CAAI,AAAC,GAEtC,EAAO,GAAS,OACf,kBACC,IAAK,IAAM,KAAU,EACjB,GAAI,EAAO,CADe,OACP,CAAE,CACjB,IAAM,EAAW,CAAC,EAAO,KAAK,EAAG,CAAC,CAAI,EAAS,MAAM,AACrD,MAAM,UAAE,CAAS,EACjB,KAAM,CAAE,MAAO,EAAO,KAAK,CAAE,SAAU,EAAO,QAAS,AAAD,CAC1D,MACI,CADG,IACG,CAAE,IAAK,EAAO,GAAG,CAAE,QAAS,EAAO,OAAO,AAAC,CAG7D,IACW,MAAT,EACI,IAAI,EAAC,CAAA,AAAc,CAAC,EAAS,EAAO,GACpC,IAAI,EAAC,CAAA,AAAW,CAAC,EAAS,GAE9B,EAAO,EAAE,CAGf,UAAW,IAAM,KAFjB,IAAI,EAAC,CAAA,AAAc,CAAC,GAAG,CAAC,EAAO,GAEJ,GACvB,EAD6B,CACzB,EAAO,QAAQ,CAAC,CAChB,IAAM,EAAO,EAAO,QAAQ,CACvB,GAAG,CAAC,CAAC,CAAE,KAAG,CAAE,GAAK,CAAC,CAAE,MAAO,EAAgB,EAAI,CAAC,EAErD,IAAK,IAAM,KADX,IAAI,EAAC,CAAA,AAAc,CAAC,GAAG,CAAC,EAAO,KAAK,CAAE,GACnB,GAAM,IAAI,CAAC,aAAa,CAAC,EAC5C,MAAM,CACF,MAAO,EAAO,KAAK,CACnB,MAAO,IAAI,EAAC,CAAA,AAAY,CAAC,WAAW,CAAC,EAAO,KAAK,GAAG,OAAS,GAC7D,SAAU,EAAO,QACrB,AAD6B,CAEjC,KACK,CACD,GAAI,EAAO,GAAG,CAAE,CACZ,IAAM,EAAO,CAAE,MAAO,EAAgB,EAAO,GAAG,AAAC,EACjD,EAAK,IAAI,CAAC,GACV,IAAI,CAAC,aAAa,CAAC,EACvB,CACA,MAAM,CACV,CAEJ,KAAM,MACV,CACA,aAAc,CACV,IAAK,IAAM,KAAQ,IAAI,EAAC,CAAA,AAAc,CAAC,MAAM,GACzC,IAAK,IAAM,KAAQ,EAAM,IAAI,CAAC,gBAAgB,CAAC,GACnD,IAAI,EAAC,CAAA,AAAc,CAAC,KAAK,EAC7B,CACA,MAAM,QAAQ,EAAc,MAAM,CAAE,CAAU,CAAE,CAAW,CAAE,CACzD,IAAM,EAAM,IAAI,CAAC,QAAQ,CAAC,WAAW,EAAE,CAAC,EAAE,CAAC,GAAG,CAC9C,GAAI,IAAI,CAAC,GAAG,EAAI,IAAI,CAAC,GAAG,CAAC,GAAG,GAAK,EAAK,OACtC,GAAM,KAAE,CAAG,CAAE,CAAG,MAAA,EAAA,CAAA,CAAA,QAChB,IAAI,CAAC,GAAG,CAAG,IAAI,EAAI,EAAK,EAAY,EAAY,IAAgB,GAC5D,IAAI,CAAC,GADsD,KAC9C,CAAC,cAAc,CAAC,GAAO,EAAA,CAAK,CAAG,EACpD,CACA,mBAAoB,CAChB,GAAM,OAAE,CAAK,CAAE,CAAG,IAAI,CAAC,QAAQ,CAAC,WAAW,EAAE,CAAC,EAAE,CAChD,OAAO,IAAI,CAAC,YAAY,CAAC,KAAK,CAAC,EACnC,CACJ,CAEA,eAAe,MAAM,CAAC,eAAgB"}