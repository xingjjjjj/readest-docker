{"version":3,"sources":["../../../../../../packages/foliate-js/uri-template.js"],"sourcesContent":["// URI Template: https://datatracker.ietf.org/doc/html/rfc6570\n\nconst regex = /{([+#./;?&])?([^}]+?)}/g\nconst varspecRegex = /(.+?)(\\*|:[1-9]\\d{0,3})?$/\n\nconst table = {\n    undefined: { first: '', sep: ',' },\n    '+': { first: '', sep: ',', allowReserved: true },\n    '.': { first: '.', sep: '.' },\n    '/': { first: '/', sep: '/' },\n    ';': { first: ';', sep: ';', named: true, ifemp: '' },\n    '?': { first: '?', sep: '&', named: true, ifemp: '=' },\n    '&': { first: '&', sep: '&', named: true, ifemp: '=' },\n    '#': { first: '&', sep: '&', allowReserved: true },\n}\n\n// 2.4.1 Prefix Values, \"Note that this numbering is in characters, not octets\"\nconst prefix = (maxLength, str) => {\n    let result = ''\n    for (const char of str) {\n        const newResult = char\n        if (newResult.length > maxLength) return result\n        else result = newResult\n    }\n    return result\n}\n\nexport const replace = (str, map) => str.replace(regex, (_, operator, variableList) => {\n    const { first, sep, named, ifemp, allowReserved } = table[operator]\n    // TODO: this isn't spec compliant\n    const encode = allowReserved ? encodeURI : encodeURIComponent\n    const values = variableList.split(',').map(varspec => {\n        const match = varspec.match(varspecRegex)\n        if (!match) return\n        const [, name, modifier] = match\n        let value = map.get(name)\n        if (modifier?.startsWith(':')) {\n            const maxLength = parseInt(modifier.slice(1))\n            value = prefix(maxLength, value)\n        }\n        return [name, value ? encode(value) : null]\n    })\n    if (!values.filter(([, value]) => value).length) return ''\n    return first + values\n        .map(([name, value]) => value\n            ? (named ? name + (value ? '=' + value : ifemp) : value) : '')\n        .filter(x => x).join(sep)\n})\n\nexport const getVariables = str => new Set(Array.from(str.matchAll(regex),\n    ([,, variableList]) => variableList.split(',')\n        .map(varspec => varspec.match(varspecRegex)?.[1])).flat())\n"],"names":[],"mappings":"uCAEA,IAAM,EAAQ,0BACR,EAAe,4BAEf,EAAQ,CACV,UAAW,CAAE,MAAO,GAAI,IAAK,GAAI,EACjC,IAAK,CAAE,MAAO,GAAI,IAAK,IAAK,eAAe,CAAK,EAChD,IAAK,CAAE,MAAO,IAAK,IAAK,GAAI,EAC5B,IAAK,CAAE,MAAO,IAAK,IAAK,GAAI,EAC5B,IAAK,CAAE,MAAO,IAAK,IAAK,IAAK,OAAO,EAAM,MAAO,EAAG,EACpD,IAAK,CAAE,MAAO,IAAK,IAAK,IAAK,OAAO,EAAM,MAAO,GAAI,EACrD,IAAK,CAAE,MAAO,IAAK,IAAK,IAAK,OAAO,EAAM,MAAO,GAAI,EACrD,IAAK,CAAE,MAAO,IAAK,IAAK,IAAK,eAAe,CAAK,CACrD,wBAmC4B,GAAO,IAAI,IAAI,MAAM,IAAI,CAAC,EAAI,QAAQ,CAAC,GAC/D,CAAC,GAAI,EAAa,GAAK,EAAa,KAAK,CAAC,KACrC,GAAG,CAAC,GAAW,EAAQ,KAAK,CAAC,IAAe,CAAC,EAAE,GAAG,IAAI,gBAxBxC,CAAC,EAAK,IAAQ,EAAI,OAAO,CAAC,EAAO,CAAC,EAAG,EAAU,KAClE,GAAM,OAAE,CAAK,KAAE,CAAG,OAAE,CAAK,OAAE,CAAK,eAAE,CAAa,CAAE,CAAG,CAAK,CAAC,EAAS,CAE7D,EAAS,EAAgB,UAAY,mBACrC,EAAS,EAAa,KAAK,CAAC,KAAK,GAAG,CAAC,IACvC,IAAM,EAAQ,EAAQ,KAAK,CAAC,GAC5B,GAAI,CAAC,EAAO,OACZ,GAAM,EAAG,EAAM,EAAS,CAAG,EACvB,EAAQ,EAAI,GAAG,CAAC,GAKpB,OAJI,GAAU,WAAW,MAAM,CAE3B,EAAQ,CArBL,CAAC,EAAW,GAqBA,EApBvB,IAAI,EAAS,GACb,IAAK,IAAM,KAAQ,EAAK,CAEpB,GAAI,EAAU,MAAM,CAAG,EAAW,MAC7B,CADoC,CADvB,CAGtB,CACA,KAFkB,EAEX,EACX,EAY8B,SAAS,EAAS,KAAK,CAAC,IAChB,EAAA,EAEvB,CAAC,EAAM,EAAQ,EAAO,GAAS,KAC1C,AAD+C,UAE/C,AAAK,EAAO,EAAR,IAAc,CAAC,CAAC,EAAG,EAAM,GAAK,GAAO,MAAM,CACxC,CAD0C,CAClC,EACV,GAAG,CAAC,CAAC,CAAC,EAAM,EAAM,GAAK,EACjB,EAAQ,GAAQ,EAAQ,EAAT,EAAe,EAAQ,CAAA,CAAK,CAAI,EAAS,IAC9D,MAAM,CAAC,GAAK,GAAG,IAAI,CAAC,GAJ+B,EAK5D"}