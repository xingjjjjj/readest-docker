module.exports=[696351,e=>e.a(async(t,r)=>{try{let t=await e.y("uuid");e.n(t),r()}catch(e){r(e)}},!0),747153,e=>{"use strict";let t,r=(e,t)=>[-1,...t,e.length].reduce(({xs:t,a:r},i)=>({xs:t?.concat([e.slice(r+1,i)])??[],a:i}),{}).xs,i=/\d/,a=/^epubcfi\((.*)\)$/,n=e=>e.replace(/[\^[\](),;=]/g,"^$&"),s=e=>a.test(e)?e:`epubcfi(${e})`,o=(t=(...e)=>e.join("!"),(...e)=>`epubcfi(${t(...e.map(e=>e.match(a)?.[1]??e))})`),l=(e,t)=>{let r;return r=([e])=>e===t,e.map((e,t,i)=>r(e,t,i)?t:null).filter(e=>null!=e)},f=e=>{let t,r=[];for(let[i,a]of e){if("/"===i)r.push({index:a});else{let e=r[r.length-1];if(":"===i)e.offset=a;else if("~"===i)e.temporal=a;else if("@"===i)e.spatial=(e.spatial??[]).concat(a);else if(";s"===i)e.side=a;else if("["===i)if("/"===t&&a)e.id=a;else{e.text=(e.text??[]).concat(a);continue}}t=i}return r},c=e=>r(e,l(e,"!")).map(f),u=e=>{let t=(e=>{let t=[],r,a,n="",s=e=>(t.push(e),r=null,n=""),o=e=>(n+=e,a=!1);for(let t of Array.from(e.trim()).concat("")){if("^"===t&&!a){a=!0;continue}if("!"===r)s(["!"]);else if(","===r)s([","]);else if("/"===r||":"===r)if(i.test(t)){o(t);continue}else s([r,parseInt(n)]);else if("~"===r)if(i.test(t)||"."===t){o(t);continue}else s(["~",parseFloat(n)]);else if("@"===r){if(":"===t){s(["@",parseFloat(n)]),r="@";continue}if(i.test(t)||"."===t){o(t);continue}s(["@",parseFloat(n)])}else if("["===r){";"!==t||a?","!==t||a?"]"!==t||a?o(t):s(["[",n]):(s(["[",n]),r="["):(s(["[",n]),r=";");continue}else if(r?.startsWith(";")){"="!==t||a?";"!==t||a?"]"!==t||a?o(t):s([r,n]):(s([r,n]),r=";"):(r=`;${n}`,n="");continue}("/"===t||":"===t||"~"===t||"@"===t||"["===t||"!"===t||","===t)&&(r=t)}return t})(e.match(a)?.[1]??e),n=l(t,",");if(!n.length)return c(t);let[s,o,f]=r(t,n).map(c);return{parent:s,start:o,end:f}},h=({index:e,id:t,offset:r,temporal:i,spatial:a,text:s,side:o})=>{let l=o?`;s=${o}`:"";return`/${e}`+(t?`[${n(t)}${l}]`:"")+(null!=r&&e%2?`:${r}`:"")+(i?`~${i}`:"")+(a?`@${a.join(":")}`:"")+(s||!t&&o?"["+(s?.map(n)?.join(",")??"")+l+"]":"")},p=e=>e.parent?[e.parent,e.start,e.end].map(p).join(","):e.map(e=>e.map(h).join("")).join("!"),d=e=>s(p(e)),m=(e,t)=>{let r,i;return"string"==typeof e?d(m(u(e),t)):e.parent?(r=e.parent,i=e[t?"end":"start"],r.slice(0,-1).concat([r[r.length-1].concat(i[0])]).concat(i.slice(1))):e},g=(e,t)=>{"string"==typeof e&&(e=u(e)),"string"==typeof t&&(t=u(t)),e=m(e),t=m(t,!0);let r=e[e.length-1],i=t[t.length-1],a=[],n=[],s=[],o=!0,l=Math.max(r.length,i.length);for(let e=0;e<l;e++){let t=r[e],l=i[e];(o&&=t?.index===l?.index&&!t?.offset&&!l?.offset)?a.push(t):(t&&n.push(t),l&&s.push(l))}return d({parent:e.slice(0,-1).concat([a]),start:[n],end:[s]})},y=(e,t)=>{if("string"==typeof e&&(e=u(e)),"string"==typeof t&&(t=u(t)),e.start||t.start)return y(m(e),m(t))||y(m(e,!0),m(t,!0));for(let r=0;r<Math.max(e.length,t.length);r++){let i=e[r]??[],a=t[r]??[],n=Math.max(i.length,a.length)-1;for(let e=0;e<=n;e++){let t=i[e],r=a[e];if(!t)return -1;if(!r||t.index>r.index)return 1;if(t.index<r.index)return -1;if(e===n){if(t.offset>r.offset)return 1;if(t.offset<r.offset)return -1}}}return 0},b=({nodeType:e})=>3===e||4===e,w=(e,t)=>{let r=Array.from(e.childNodes).filter(e=>b(e)||(({nodeType:e})=>1===e)(e));return t?r.map(e=>{let r=t(e);return r===NodeFilter.FILTER_REJECT?null:r===NodeFilter.FILTER_SKIP?w(e,t):e}).flat().filter(e=>e):r},R=(e,t)=>{let r=w(e,t).reduce((e,t)=>{let r=e[e.length-1];return r?b(t)?Array.isArray(r)?r.push(t):b(r)?e[e.length-1]=[r,t]:e.push(t):(({nodeType:e})=>1===e)(r)?e.push(null,t):e.push(t):e.push(t),e},[]);return(({nodeType:e})=>1===e)(r[0])&&r.unshift("first"),(({nodeType:e})=>1===e)(r[r.length-1])&&r.push("last"),r.unshift("before"),r.push("after"),r},v=(e,t,r)=>{let{id:i}=t[t.length-1];if(i){let t=e.ownerDocument.getElementById(i);if(t)return{node:t,offset:0}}for(let{index:i}of t){let t=e?R(e,r)[i]:null;if("first"===t)return{node:e.firstChild??e};if("last"===t)return{node:e.lastChild??e};if("before"===t)return{node:e,before:!0};if("after"===t)return{node:e,after:!0};e=t}let{offset:a}=t[t.length-1];if(!Array.isArray(e))return{node:e,offset:a};let n=0;for(let t of e){let{length:e}=t.nodeValue;if(n+e>=a)return{node:t,offset:a-n};n+=e}},F=(e,t,r)=>{let{parentNode:i,id:a}=e,n=R(i,r),s=n.findIndex(t=>Array.isArray(t)?t.some(t=>t===e):t===e),o=n[s];if(Array.isArray(o)){let r=0;for(let i of o)if(i===e){r+=t;break}else r+=i.nodeValue.length;t=r}let l={id:a,index:s,offset:t};return(i!==e.ownerDocument.documentElement?F(i,null,r).concat(l):[l]).filter(e=>-1!==e.index)},P={fromIndex:e=>s(`/6/${(e+1)*2}`),toIndex:e=>e?.at(-1).index/2-1};e.s(["collapse",0,m,"compare",0,y,"fake",0,P,"fromCalibreHighlight",0,({spine_index:e,start_cfi:t,end_cfi:r})=>{let i=P.fromIndex(e)+"!";return g(i+t.slice(2),i+r.slice(2))},"fromCalibrePos",0,e=>{let[t]=u(e),r=t.shift();return t.shift(),d([[{index:6},r],t])},"fromElements",0,e=>{let t=[],{parentNode:r}=e[0],i=F(r);for(let[a,n]of R(r).entries()){let r=e[t.length];n===r&&t.push(d([i.concat({id:r.id,index:a})]))}return t},"fromRange",0,(e,t)=>{let{startContainer:r,startOffset:i,endContainer:a,endOffset:n}=e,s=F(r,i,t);return e.collapsed?d([s]):g([s],[F(a,n,t)])},"isCFI",0,a,"joinIndir",0,o,"parse",0,u,"toElement",0,(e,t)=>v(e.documentElement,m(t)).node,"toRange",0,(e,t,r)=>{let i=m(t),a=m(t,!0),n=e.documentElement,s=v(n,i[0],r),o=v(n,a[0],r),l=e.createRange();return s.before?l.setStartBefore(s.node):s.after?l.setStartAfter(s.node):l.setStart(s.node,s.offset),o.before?l.setEndBefore(o.node):o.after?l.setEndAfter(o.node):l.setEnd(o.node,o.offset),l}])},375253,e=>{"use strict";var t=e.i(191587),r=e.i(585260),i=e.i(827667);let a=async()=>"";e.s(["apiFileSystem",0,{resolvePath:(e,t)=>{let r="undefined"!=typeof process;switch("undefined"!=typeof process&&console.log("[ResolvePath] Env Check - NEXT_PUBLIC_STORAGE_MODE:","local","isLocalMode:",r,"base:",t,"path:",e),t){case"Data":return{baseDir:0,basePrefix:a,fp:`${i.DATA_SUBDIR}/${e}`,base:t};case"Settings":return{baseDir:0,basePrefix:a,fp:`.readest/${e}`,base:t};case"Books":if("library.json"===e||"library.json.bak"===e||"library_backup.json"===e)return console.log("[ResolvePath] Books/Library detected, routing to .readest"),{baseDir:0,basePrefix:a,fp:`.readest/${e}`,base:t};return console.log("[ResolvePath] ✓ Books base, flat path (no prefix):",e),console.log("[ResolvePath] ✓ Returning fp:",e),{baseDir:0,basePrefix:a,fp:e,base:t};case"Fonts":return{baseDir:0,basePrefix:a,fp:`${i.LOCAL_FONTS_SUBDIR}/${e}`,base:t};case"Images":return{baseDir:0,basePrefix:a,fp:`${i.LOCAL_IMAGES_SUBDIR}/${e}`,base:t};case"None":return{baseDir:0,basePrefix:a,fp:e,base:t};default:return{baseDir:0,basePrefix:a,fp:`${t}/${e}`,base:t}}},async getPrefix(e){let{basePrefix:t,fp:r}=this.resolvePath("",e),i=await t();return(r?i?`${i}/${r}`:r:i).replace(/\/+$/,"")},getURL:e=>(0,t.isValidURL)(e)?e:`/api/storage/file?filePath=${encodeURIComponent(e)}`,async getBlobURL(e,t){try{let r=await this.readFile(e,t,"binary");return URL.createObjectURL(new Blob([r]))}catch{return e}},async getImageURL(e){return this.getURL(e)},async openFile(e,i,a){if((0,t.isValidURL)(e))return await new r.RemoteFile(e,a).open();let{fp:n}=this.resolvePath(e,i),s=await fetch(`/api/storage/file?filePath=${encodeURIComponent(n)}`);if(!s.ok)throw Error("File not found");return new File([await s.arrayBuffer()],a||e)},async copyFile(e,t,r){let i=await this.openFile(e,r);await this.writeFile(t,r,i)},async readFile(e,t,r){let{fp:i}=this.resolvePath(e,t),a=await fetch(`/api/storage/file?filePath=${encodeURIComponent(i)}`);if(!a.ok)throw Error(`File not found: ${i}`);return"text"===r?await a.text():await a.arrayBuffer()},async writeFile(e,t,r){let i,{fp:a}=this.resolvePath(e,t);if(console.log("[APIFileSystem.writeFile] 11. Input path:",e),console.log("[APIFileSystem.writeFile] 12. Base:",t),console.log("[APIFileSystem.writeFile] 13. Resolved fp:",a),i=r instanceof File?Buffer.from(await r.arrayBuffer()):Buffer.from(r),console.log("[APIFileSystem.writeFile] 14. Calling PUT /api/storage/file with filePath:",a),!(await fetch(`/api/storage/file?filePath=${encodeURIComponent(a)}`,{method:"PUT",body:i})).ok)throw Error("Failed to write file")},async removeFile(e,t){let{fp:r}=this.resolvePath(e,t);if(!(await fetch(`/api/storage/delete?fileKey=${encodeURIComponent(r)}`,{method:"DELETE"})).ok)throw Error("Failed to delete file")},async createDir(e,t){},async removeDir(e,t){},readDir:async(e,t)=>[],async exists(e,t){let{fp:r}=this.resolvePath(e,t);return(await fetch(`/api/storage/file?filePath=${encodeURIComponent(r)}`)).ok},async stats(e,t){let{fp:r}=this.resolvePath(e,t),i=await fetch(`/api/storage/file?filePath=${encodeURIComponent(r)}`);if(!i.ok)throw Error("File not found");return{isFile:!0,isDirectory:!1,size:(await i.arrayBuffer()).byteLength,mtime:null,atime:null,birthtime:null}}}])},184220,e=>e.a(async(t,r)=>{try{var i=e.i(191587);e.i(585260);var a=e.i(667814),n=e.i(869734),s=(e.i(827667),e.i(375253)),o=t([n]);[n]=o.then?(await o)():o;class l extends n.BaseAppService{get fs(){return s.apiFileSystem}isMobile=["android","ios"].includes((0,i.getOSPlatform)());appPlatform="web";hasSafeAreaInset=(0,a.isPWA)();async init(){await this.loadSettings(),await this.prepareBooksDir(),await this.runMigrations()}async runMigrations(){try{let e=await this.loadSettings(),t=e.migrationVersion||0;await super.runMigrations(t),t<this.CURRENT_MIGRATION_VERSION&&await this.saveSettings({...e,migrationVersion:this.CURRENT_MIGRATION_VERSION})}catch(e){console.error("Failed to run migrations:",e)}}resolvePath(e,t){return this.fs.resolvePath(e,t)}async setCustomRootDir(){}async selectDirectory(){throw Error("selectDirectory is not supported in browser")}async selectFiles(){throw Error("selectFiles is not supported in browser")}async saveFile(e,t,r){try{let i=new Blob([t],{type:r||"application/octet-stream"}),a=URL.createObjectURL(i),n=document.createElement("a");return n.href=a,n.download=e,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(a),!0}catch(e){return console.error("Failed to save file:",e),!1}}}e.s(["WebAppService",()=>l]),r()}catch(e){r(e)}},!1),831930,e=>{e.v(t=>Promise.all(["server/chunks/[externals]_@zip_js_zip_4d21a2e3.js"].map(t=>e.l(t))).then(()=>t(436738)))},334401,e=>{e.v(t=>Promise.all(["server/chunks/packages_foliate-js_mobi_09383c34.js"].map(t=>e.l(t))).then(()=>t(690606)))},695,e=>{e.v(t=>Promise.all(["server/chunks/packages_foliate-js_fb2_65908e1c.js"].map(t=>e.l(t))).then(()=>t(679346)))},871513,e=>{e.v(t=>Promise.all(["server/chunks/packages_foliate-js_vendor_fflate_1f591fdd.js"].map(t=>e.l(t))).then(()=>t(498866)))},497701,e=>{e.v(t=>Promise.all(["server/chunks/packages_foliate-js_pdf_4807594a.js"].map(t=>e.l(t))).then(()=>t(633640)))},157117,e=>{e.v(t=>Promise.all(["server/chunks/packages_foliate-js_epub_f73ceaff.js"].map(t=>e.l(t))).then(()=>t(690357)))},701822,e=>{e.v(t=>Promise.all(["server/chunks/packages_foliate-js_comic-book_ba207c9b.js"].map(t=>e.l(t))).then(()=>t(166102)))}];

//# sourceMappingURL=%5Broot-of-the-server%5D__05766552._.js.map