{"version":3,"sources":["../../../../../apps/readest-app/src/services/environment.ts"],"sourcesContent":["import { AppService } from '@/types/system';\nimport { READEST_NODE_BASE_URL, READEST_WEB_BASE_URL } from './constants';\n\ndeclare global {\n  interface Window {\n    __READEST_CLI_ACCESS?: boolean;\n  }\n}\n\nconst appPlatform = process.env['NEXT_PUBLIC_APP_PLATFORM'] || 'web';\nexport const isTauriAppPlatform = () => appPlatform === 'tauri';\nexport const isWebAppPlatform = () => appPlatform === 'web';\nexport const hasCli = () => window.__READEST_CLI_ACCESS === true;\nexport const isPWA = () => window.matchMedia('(display-mode: standalone)').matches;\nexport const getBaseUrl = () => process.env['NEXT_PUBLIC_API_BASE_URL'] ?? READEST_WEB_BASE_URL;\nexport const getNodeBaseUrl = () =>\n  process.env['NEXT_PUBLIC_NODE_BASE_URL'] ?? READEST_NODE_BASE_URL;\n\nconst isWebDevMode = () => process.env['NODE_ENV'] === 'development' && isWebAppPlatform();\n\n// Dev API only in development mode and web platform\n// with command `pnpm dev-web`\n// for production build or tauri app use the production Web API\nexport const getAPIBaseUrl = () => (isWebDevMode() ? '/api' : `${getBaseUrl()}/api`);\n\n// For Node.js API that currently not supported in some edge runtimes\nexport const getNodeAPIBaseUrl = () => (isWebDevMode() ? '/api' : `${getNodeBaseUrl()}/api`);\n\nexport interface EnvConfigType {\n  getAppService: () => Promise<AppService>;\n}\n\nlet nativeAppService: AppService | null = null;\nconst getNativeAppService = async () => {\n  if (!nativeAppService) {\n    const { NativeAppService } = await import('@/services/nativeAppService');\n    nativeAppService = new NativeAppService();\n    await nativeAppService.init();\n  }\n  return nativeAppService;\n};\n\nlet webAppService: AppService | null = null;\nconst getWebAppService = async () => {\n  if (!webAppService) {\n    const { WebAppService } = await import('@/services/webAppService');\n    webAppService = new WebAppService();\n    await webAppService.init();\n  }\n  return webAppService;\n};\n\nconst environmentConfig: EnvConfigType = {\n  getAppService: async () => {\n    // Check if actually running in Tauri environment (runtime check)\n    const isTauriRuntime = typeof window !== 'undefined' && (window as any).__TAURI__;\n\n    if (isTauriAppPlatform() && isTauriRuntime) {\n      return getNativeAppService();\n    } else {\n      return getWebAppService();\n    }\n  },\n};\n\nexport default environmentConfig;\n"],"names":[],"mappings":"yuBACA,EAAA,CAAA,CAAA,+BAsB6B,IAAO,AAA0B,GAAG,aAAa,CAAzB,GAA6B,CAAC,iBAV9D,IAAM,OAAO,UAAU,CAAC,8BAA8B,OAAO,wBAHhD,KAAM,gBAAgB,OACxB,KAAM,gBAAgB"}