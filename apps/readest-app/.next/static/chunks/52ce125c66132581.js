(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,446270,t=>{"use strict";let e=(t,e,i)=>{let r;return(...s)=>{let n=i&&!r;r&&clearTimeout(r),r=setTimeout(()=>{r=null,i||t(...s)},e),n&&t(...s)}},i=(t,e,i)=>i*(e-t)+t,r=t=>1-(1-t)*(1-t),s=(t,e,i,r=i)=>{let s=t.createRange();return s.setStart(e,i),s.setEnd(e,r),s},n=(t,e,i,r=0,o=e.nodeValue.length)=>{if(o-r==1)return 0>i(s(t,e,r),s(t,e,o))?r:o;let a=Math.floor(r+(o-r)/2),l=i(s(t,e,r,a),s(t,e,a,o));return l<0?n(t,e,i,r,a):l>0?n(t,e,i,a,o):a},{SHOW_ELEMENT:o,SHOW_TEXT:a,SHOW_CDATA_SECTION:l,FILTER_ACCEPT:h,FILTER_REJECT:c,FILTER_SKIP:d}=NodeFilter,u=o|a|l,m=t=>{let e=1/0,i=-1/0,r=1/0,s=-1/0;for(let n of t.getClientRects())r=Math.min(r,n.left),e=Math.min(e,n.top),i=Math.max(i,n.right),s=Math.max(s,n.bottom);return new DOMRect(r,e,i-r,s-e)},g=(t,e,i,r)=>{let s=t.createTreeWalker(t.body,u,{acceptNode:s=>{let n=s.localName?.toLowerCase();if("script"===n||"style"===n)return c;if(1===s.nodeType){let{left:t,right:n}=r(s.getBoundingClientRect());if(n<e||t>i)return c;if(t>=e&&n<=i)return h}else{if(!s.nodeValue?.trim())return d;let n=t.createRange();n.selectNodeContents(s);let{left:o,right:a}=r(n.getBoundingClientRect());if(a>=e&&o<=i)return h}return d}}),o=[];for(let t=s.nextNode();t;t=s.nextNode())o.push(t);let a=o[0]??t.body,l=o[o.length-1]??a,g=1===a.nodeType?0:n(t,a,(t,i)=>{let s=r(m(t)),n=r(m(i));return s.right<e&&n.left>e?0:n.left>e?-1:1}),p=1===l.nodeType?0:n(t,l,(t,e)=>{let s=r(m(t)),n=r(m(e));return s.right<i&&n.left>i?0:n.left>i?-1:1}),v=t.createRange();return v.setStart(a,g),v.setEnd(l,p),v},p=t=>{let e=document.createRange();return e.setStart(t.anchorNode,t.anchorOffset),e.setEnd(t.focusNode,t.focusOffset),e.collapsed},v=(t,e)=>{let i;if(t.startContainer?i=t.cloneRange():t.nodeType&&(i=document.createRange()).selectNode(t),i){let t=i.startContainer.ownerDocument?.defaultView.getSelection();t&&(t.removeAllRanges(),-1===e?i.collapse(!0):1===e&&i.collapse(),t.addRange(i))}},f=(t,e)=>Array.from({length:t},()=>{let t=document.createElement("div"),i=document.createElement("div");return t.append(i),i.setAttribute("part",e),t}),y=(t,e)=>{let{style:i}=t;for(let[t,r]of Object.entries(e))i.setProperty(t,r,"important")};class x{#t=new ResizeObserver(()=>this.expand());#e=document.createElement("div");#i=document.createElement("iframe");#r=document.createRange();#s;#n=!1;#o=!1;#a=!0;#l;#h={};constructor({container:t,onExpand:e}){this.container=t,this.onExpand=e,this.#i.setAttribute("part","filter"),this.#e.append(this.#i),Object.assign(this.#e.style,{boxSizing:"content-box",position:"relative",overflow:"hidden",flex:"0 0 auto",width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center"}),Object.assign(this.#i.style,{overflow:"hidden",border:"0",display:"none",width:"100%",height:"100%"}),this.#i.setAttribute("sandbox","allow-same-origin allow-scripts"),this.#i.setAttribute("scrolling","no")}get element(){return this.#e}get document(){return this.#i.contentDocument}async load(t,e,i,r){if("string"!=typeof t)throw Error(`${t} is not string`);return new Promise(s=>{this.#i.addEventListener("load",()=>{let t,e=this.document;i?.(e),this.#i.setAttribute("aria-label",e.title),this.#i.style.display="block";let{vertical:n,rtl:o}=(t=>{let{defaultView:e}=t,{writingMode:i,direction:r}=e.getComputedStyle(t.body);return{vertical:"vertical-rl"===i||"vertical-lr"===i,rtl:"rtl"===t.body.dir||"rtl"===r||"rtl"===t.documentElement.dir}})(e);this.docBackground="rgba(0, 0, 0, 0)"===(t=e.defaultView.getComputedStyle(e.body)).backgroundColor&&"none"===t.backgroundImage?e.defaultView.getComputedStyle(e.documentElement).background:t.background,e.body.style.background="none";let a=this.docBackground;this.#i.style.display="none",this.#n=n,this.#o=o,this.#r.selectNodeContents(e.body);let l=r?.({vertical:n,rtl:o,background:a});this.#i.style.display="block",this.render(l),this.#t.observe(e.body),e.fonts.ready.then(()=>this.expand()),s()},{once:!0}),e?this.#i.srcdoc=e:this.#i.src=t})}render(t){t&&this.document&&(this.#a="scrolled"!==t.flow,this.#h=t,this.#a?this.columnize(t):this.scrolled(t))}scrolled({marginTop:t,marginRight:e,marginBottom:i,marginLeft:r,gap:s,columnWidth:n}){let o=this.#n,a=this.document;y(a.documentElement,{"box-sizing":"border-box",padding:o?`${1.5*t}px ${e}px ${1.5*i}px ${r}px`:`${t}px ${s/2+e/2}px ${i}px ${s/2+r/2}px`,"column-width":"auto",height:"auto",width:"auto","--page-margin-top":`${o?1.5*t:t}px`,"--page-margin-right":`${o?e:e+s/2}px`,"--page-margin-bottom":`${o?1.5*i:i}px`,"--page-margin-left":`${o?r:r+s/2}px`,"--available-width":`${Math.trunc(Math.min(window.innerWidth,n)-r-e-s-60)}`,"--available-height":`${Math.trunc(window.innerHeight-t-i)}`}),y(a.body,{[o?"max-height":"max-width"]:`${n}px`,margin:"auto"}),this.setImageSize(),this.expand()}columnize({width:t,height:e,marginTop:i,marginRight:r,marginBottom:s,marginLeft:n,gap:o,columnWidth:a}){let l=this.#n;this.#l=l?e:t;let h=this.document;y(h.documentElement,{"box-sizing":"border-box","column-width":`${Math.trunc(a)}px`,"column-gap":l?`${(i+s)*1.5}px`:`${o+r/2+n/2}px`,"column-fill":"auto",...l?{width:`${t}px`}:{height:`${e}px`},padding:l?`${1.5*i}px ${r}px ${1.5*s}px ${n}px`:`${i}px ${o/2+r/2}px ${s}px ${o/2+n/2}px`,overflow:"hidden","overflow-wrap":"break-word",position:"static",border:"0",margin:"0","max-height":"none","max-width":"none","min-height":"none","min-width":"none","-webkit-line-box-contain":"block glyphs replaced","--page-margin-top":`${l?1.5*i:i}px`,"--page-margin-right":`${l?r:r/2+o/2}px`,"--page-margin-bottom":`${l?1.5*s:s}px`,"--page-margin-left":`${l?n:n/2+o/2}px`,"--available-width":`${Math.trunc(a-n-r-o)}`,"--available-height":`${Math.trunc(e-i-s)}`}),y(h.body,{"max-height":"none","max-width":"none",margin:"0"}),this.setImageSize(),this.expand()}setImageSize(){let{width:t,height:e,marginTop:i,marginRight:r,marginBottom:s,marginLeft:n}=this.#h,o=this.#n,a=this.document;for(let l of a.body.querySelectorAll("img, svg, video")){let{maxHeight:h,maxWidth:c}=a.defaultView.getComputedStyle(l);y(l,{"max-height":o?"none"!==h&&"0px"!==h?h:"100%":`${e-i-s}px`,"max-width":o?`${t-n-r}px`:"none"!==c&&"0px"!==c?c:"100%","object-fit":"contain","page-break-inside":"avoid","break-inside":"avoid","box-sizing":"border-box"})}}get #c(){return/^((?!chrome|android).)*AppleWebKit/i.test(navigator.userAgent)&&!window.chrome&&window.getComputedStyle(this.document.body).zoom||1}expand(){if(!this.document)return;let{documentElement:t}=this.document;if(this.#a){let e=this.#n?"height":"width",i=this.#n?"width":"height",r=this.#r.getBoundingClientRect(),s=t.getBoundingClientRect(),n=Math.ceil(((this.#n?0:this.#o?s.right-r.right:r.left-s.left)+r[e])*this.#c/this.#l)*this.#l;this.#e.style.padding="0",this.#i.style[e]=`${n}px`,this.#e.style[e]=`${n+2*this.#l}px`,this.#i.style[i]="100%",this.#e.style[i]="100%",t.style[e]=`${this.#l}px`,this.#s&&(this.#s.element.style.margin="0",this.#s.element.style.left=this.#n?"0":`${this.#l}px`,this.#s.element.style.top=this.#n?`${this.#l}px`:"0",this.#s.element.style[e]=`${n}px`,this.#s.redraw())}else{let e=this.#n?"width":"height",i=this.#n?"height":"width",r=t.getBoundingClientRect()[e];this.#e.style.padding="0",this.#i.style[e]=`${r}px`,this.#e.style[e]=`${r}px`,this.#i.style[i]="100%",this.#e.style[i]="100%",this.#s&&(this.#s.element.style.margin="0",this.#s.element.style.left="0",this.#s.element.style.top="0",this.#s.element.style[e]=`${r}px`,this.#s.redraw())}this.onExpand()}set overlayer(t){this.#s=t,this.#e.append(t.element)}get overlayer(){return this.#s}destroy(){this.document&&this.#t.unobserve(this.document.body)}}class b extends HTMLElement{static observedAttributes=["flow","gap","margin-top","margin-bottom","margin-left","margin-right","max-inline-size","max-block-size","max-column-count"];#d=this.attachShadow({mode:"open"});#t=new ResizeObserver(()=>this.render());#u;#m;#g;#p;#v;#f;#n=!1;#o=!1;#y=0;#x=0;#b=-1;#w=0;#T=!1;#E=!1;#k;#S=new WeakMap;#M=matchMedia("(prefers-color-scheme: dark)");#_;#z;#C;#$;#R;#A=!1;constructor(){super(),this.#d.innerHTML=`<style>
        :host {
            display: block;
            container-type: size;
        }
        :host, #top {
            box-sizing: border-box;
            position: relative;
            overflow: hidden;
            width: 100%;
            height: 100%;
        }
        #top {
            --_gap: 7%;
            --_margin-top: 48px;
            --_margin-right: 48px;
            --_margin-bottom: 48px;
            --_margin-left: 48px;
            --_max-inline-size: 720px;
            --_max-block-size: 1440px;
            --_max-column-count: 2;
            --_max-column-count-portrait: var(--_max-column-count);
            --_max-column-count-spread: var(--_max-column-count);
            --_half-gap: calc(var(--_gap) / 2);
            --_half-margin-left: calc(var(--_margin-left) / 2);
            --_half-margin-right: calc(var(--_margin-right) / 2);
            --_max-width: calc(var(--_max-inline-size) * var(--_max-column-count-spread));
            --_max-height: var(--_max-block-size);
            display: grid;
            grid-template-columns:
                minmax(0, 1fr)
                var(--_margin-left)
                minmax(0, calc(var(--_max-width) - var(--_gap)))
                var(--_margin-right)
                minmax(0, 1fr);
            grid-template-rows:
                minmax(var(--_margin-top), 1fr)
                minmax(0, var(--_max-height))
                minmax(var(--_margin-bottom), 1fr);
            &.vertical {
                --_max-column-count-spread: var(--_max-column-count-portrait);
                --_max-width: var(--_max-block-size);
                --_max-height: calc(var(--_max-inline-size) * var(--_max-column-count-spread));
            }
            @container (orientation: portrait) {
                & {
                    --_max-column-count-spread: var(--_max-column-count-portrait);
                }
                &.vertical {
                    --_max-column-count-spread: var(--_max-column-count);
                }
            }
        }
        #background {
            grid-column: 1 / -1;
            grid-row: 1 / -1;
        }
        #container {
            grid-column: 2 / 5;
            grid-row: 1 / -1;
            overflow: hidden;
        }
        :host([flow="scrolled"]) #container {
            grid-column: 2 / 5;
            grid-row: 1 / -1;
            overflow: auto;
        }
        #header {
            grid-column: 3 / 4;
            grid-row: 1;
        }
        #footer {
            grid-column: 3 / 4;
            grid-row: 3;
            align-self: end;
        }
        #header {
            display: grid;
            height: var(--_margin-top);
        }
        #footer {
            display: grid;
            height: var(--_margin-bottom);
        }
        :is(#header, #footer) > * {
            display: flex;
            align-items: center;
            min-width: 0;
        }
        :is(#header, #footer) > * > * {
            width: 100%;
            overflow: hidden;
            white-space: nowrap;
            text-overflow: ellipsis;
            text-align: center;
            font-size: .75em;
            opacity: .6;
        }
        </style>
        <div id="top">
            <div id="background" part="filter"></div>
            <div id="header"></div>
            <div id="container" part="container"></div>
            <div id="footer"></div>
        </div>
        `,this.#u=this.#d.getElementById("top"),this.#m=this.#d.getElementById("background"),this.#g=this.#d.getElementById("container"),this.#p=this.#d.getElementById("header"),this.#v=this.#d.getElementById("footer"),this.#t.observe(this.#g),this.#g.addEventListener("scroll",()=>this.dispatchEvent(new Event("scroll"))),this.#g.addEventListener("scroll",e(()=>{this.scrolled&&(this.#T?this.#T=!1:this.#P("scroll"))},250));const t={passive:!1};this.addEventListener("touchstart",this.#B.bind(this),t),this.addEventListener("touchmove",this.#L.bind(this),t),this.addEventListener("touchend",this.#V.bind(this)),this.addEventListener("load",({detail:{doc:e}})=>{e.addEventListener("touchstart",this.#B.bind(this),t),e.addEventListener("touchmove",this.#L.bind(this),t),e.addEventListener("touchend",this.#V.bind(this))}),this.addEventListener("relocate",({detail:t})=>{"selection"===t.reason?v(this.#w,0):"navigation"===t.reason&&(1===this.#w?v(t.range,1):"number"==typeof this.#w?v(t.range,-1):v(this.#w,-1))});const i=e((t,e)=>{if(!e.rangeCount)return;let i=e.getRangeAt(0),r=p(e);r&&0>i.compareBoundaryPoints(Range.START_TO_START,t)?this.prev():!r&&i.compareBoundaryPoints(Range.END_TO_END,t)>0&&this.next()},700);this.addEventListener("load",({detail:{doc:t}})=>{let e=!1;t.addEventListener("pointerdown",()=>e=!0),t.addEventListener("pointerup",()=>e=!1);let r=!1;t.addEventListener("keydown",()=>r=!0),t.addEventListener("keyup",()=>r=!1),t.addEventListener("selectionchange",()=>{if(this.scrolled)return;let s=this.#R;if(!s)return;let n=t.getSelection();if(n.rangeCount){if(!e&&e&&"Range"===n.type)i(s,n);else if(r){let t=n.getRangeAt(0).cloneRange();p(n)||t.collapse(),this.#I(t)}}}),t.addEventListener("focusin",t=>{if(this.scrolled)return null;this.#g&&this.#g.contains(t.target)&&requestAnimationFrame(()=>this.#I(t.target))})}),this.#_=()=>{this.#f&&this.#j(this.#f.docBackground,this.columnCount)},this.#M.addEventListener("change",this.#_)}attributeChangedCallback(t,e,i){switch(t){case"flow":this.render();break;case"gap":case"margin-top":case"margin-bottom":case"margin-left":case"margin-right":case"max-block-size":case"max-column-count":case"max-inline-size":this.#u.style.setProperty("--_"+t,i),this.render()}}open(t){this.bookDir=t.dir,this.sections=t.sections,t.transformTarget?.addEventListener("data",({detail:t})=>{"text/css"===t.type&&(t.data=Promise.resolve(t.data).then(t=>t.replace(/([{\s;])-epub-/gi,"$1").replace(/page-break-(after|before|inside)\s*:/gi,(t,e)=>`-webkit-column-break-${e}:`).replace(/break-(after|before|inside)\s*:\s*(avoid-)?page/gi,(t,e,i)=>`break-${e}: ${i??""}column`)))})}#N(){return this.#f&&(this.#f.destroy(),this.#g.removeChild(this.#f.element)),this.#f=new x({container:this,onExpand:()=>this.#I(this.#w)}),this.#g.append(this.#f.element),this.#f}#j(t,e){let i=this.#f?.document;if(!i)return;let r=i.defaultView.getComputedStyle(i.documentElement),s=r.getPropertyValue("--theme-bg-color"),n="true"===r.getPropertyValue("--override-color"),o=r.getPropertyValue("--bg-texture-id"),a="dark"===r.getPropertyValue("color-scheme");if(t&&s){let e=t.split(/\s(?=(?:url|rgb|hsl|#[0-9a-fA-F]{3,6}))/);(a||n)&&("none"===o||!o)&&(e[0]=s),t=e.join(" ")}this.#m.innerHTML="",this.#m.style.display="grid",this.#m.style.gridTemplateColumns=`repeat(${e}, 1fr)`;for(let i=0;i<e;i++){let e=document.createElement("div");e.style.background=t,e.style.width="100%",e.style.height="100%",this.#m.appendChild(e)}}#O({vertical:t,rtl:e,background:i}){this.#n=t,this.#o=e,this.#u.classList.toggle("vertical",t);let{width:r,height:s}=this.#g.getBoundingClientRect(),n=t?s:r,o=getComputedStyle(this.#u),a=parseFloat(o.getPropertyValue("--_max-inline-size")),l=parseInt(o.getPropertyValue("--_max-column-count-spread")),h=parseFloat(o.getPropertyValue("--_margin-top")),c=parseFloat(o.getPropertyValue("--_margin-right")),d=parseFloat(o.getPropertyValue("--_margin-bottom")),u=parseFloat(o.getPropertyValue("--_margin-left"));this.#y=h,this.#x=d;let m=parseFloat(o.getPropertyValue("--_gap"))/100,g=-m/(m-1)*n,p=this.getAttribute("flow");if("scrolled"===p)return this.setAttribute("dir",t?"rtl":"ltr"),this.#u.style.padding="0",this.heads=null,this.feet=null,this.#p.replaceChildren(),this.#v.replaceChildren(),{flow:p,marginTop:h,marginRight:c,marginBottom:d,marginLeft:u,gap:g,columnWidth:a};let v=Math.min(l+ +!!t,Math.ceil(Math.floor(n)/Math.floor(a))),y=t?n/v-1.5*h-1.5*d:n/v-g-c/2-u/2;this.setAttribute("dir",e?"rtl":"ltr"),this.columnCount=v,this.#j(i,this.columnCount);let x=t?Math.min(2,Math.ceil(Math.floor(r)/Math.floor(a))):v,b={gridTemplateColumns:`repeat(${x}, 1fr)`,gap:`${g}px`,direction:"rtl"===this.bookDir?"rtl":"ltr"};Object.assign(this.#p.style,b),Object.assign(this.#v.style,b);let w=f(x,"head"),T=f(x,"foot");return this.heads=w.map(t=>t.children[0]),this.feet=T.map(t=>t.children[0]),this.#p.replaceChildren(...w),this.#v.replaceChildren(...T),{height:s,width:r,marginTop:h,marginRight:c,marginBottom:d,marginLeft:u,gap:g,columnWidth:y}}render(){this.#f&&(this.#f.render(this.#O({vertical:this.#n,rtl:this.#o,background:this.#f.docBackground})),this.#I(this.#w))}get scrolled(){return"scrolled"===this.getAttribute("flow")}get scrollProp(){let{scrolled:t}=this;return this.#n?t?"scrollLeft":"scrollTop":t?"scrollTop":"scrollLeft"}get sideProp(){let{scrolled:t}=this;return this.#n?t?"width":"height":t?"height":"width"}get size(){return this.#g.getBoundingClientRect()[this.sideProp]}get viewSize(){return this.#f&&this.#f.element?this.#f.element.getBoundingClientRect()[this.sideProp]:0}get start(){return Math.abs(this.#g[this.scrollProp])}get end(){return this.start+this.size}get page(){return Math.floor((this.start+this.end)/2/this.size)}get pages(){return Math.round(this.viewSize/this.size)}get containerPosition(){return this.#g[this.scrollProp]}get isOverflowX(){return!1}get isOverflowY(){return!1}set containerPosition(t){this.#g[this.scrollProp]=t}set scrollLocked(t){this.#A=t}scrollBy(t,e){let i=this.#n?e:t,[r,s,n]=this.#z,o=this.#o;this.containerPosition=Math.max(o?r-n:r-s,Math.min(o?r+s:r+n,this.containerPosition+i))}snap(t,e){let i=this.#n?e:t,r=2*Math.abs(t)>Math.abs(e),s=this.#n?!r:r,[n,o,a]=this.#z,{start:l,end:h,pages:c,size:d}=this,u=Math.abs(n)-o,m=Math.abs(n)+a,g=i*(this.#o?-d:d)*!!s,p=Math.floor(Math.max(u,Math.min(m,(l+h)/2+(isNaN(g)?0:2*g)))/d);this.#F(p,"snap").then(()=>{let t=p<=0?-1:p>=c-1?1:null;if(t)return this.#D({index:this.#Q(t),anchor:t<0?()=>1:()=>0})})}#B(t){let e=t.changedTouches[0];this.#C={x:e?.screenX,y:e?.screenY,t:t.timeStamp,vx:0,xy:0,dx:0,dy:0}}#L(t){let e=this.#C;if(e.pinched||(e.pinched=globalThis.visualViewport.scale>1,this.scrolled||e.pinched))return;if(t.touches.length>1){this.#$&&t.preventDefault();return}let i=this.#f?.document,r=i?.getSelection();if(r&&r.rangeCount>0&&!r.isCollapsed)return;let s=t.changedTouches[0],n="stylus"===s.touchType;if(n||t.preventDefault(),this.#A)return;let o=s.screenX,a=s.screenY,l=e.x-o,h=e.y-a,c=t.timeStamp-e.t;e.x=o,e.y=a,e.t=t.timeStamp,e.vx=l/c,e.vy=h/c,e.dx+=l,e.dy+=h,this.#$=!0,!(!this.hasAttribute("animated")||this.hasAttribute("eink"))&&(!this.#n&&Math.abs(e.dx)>=Math.abs(e.dy)&&!this.hasAttribute("eink")&&(!n||Math.abs(l)>1)?this.scrollBy(l,0):this.#n&&Math.abs(e.dx)<Math.abs(e.dy)&&!this.hasAttribute("eink")&&(!n||Math.abs(h)>1)&&this.scrollBy(0,h))}#V(){!this.#$||(this.#$=!1,this.scrolled||requestAnimationFrame(()=>{1===globalThis.visualViewport.scale&&this.snap(this.#C.vx,this.#C.vy)}))}#q(){if(this.scrolled){let t=this.viewSize,e=this.#y,i=this.#x;return this.#n?({left:r,right:s})=>({left:t-s-e,right:t-r-i}):({top:t,bottom:r})=>({left:t-e,right:r-i})}let t=this.pages*this.size;return this.#o?({left:e,right:i})=>({left:t-i,right:t-e}):this.#n?({top:t,bottom:e})=>({left:t,right:e}):t=>t}async #W(t,e){if(this.scrolled){let i=this.#q()(t).left-4;return this.#H(i,e)}let i=this.#q()(t).left;return this.#F(Math.floor(i/this.size)+(this.#o?-1:1),e)}async #H(t,e,s){let{size:n}=this;if(this.containerPosition===t){this.#z=[t,this.atStart?0:n,this.atEnd?0:n],this.#P(e);return}if(this.scrolled&&this.#n&&(t=-t),("snap"===e||s)&&this.hasAttribute("animated")&&!this.hasAttribute("eink")){let s,o,a;return(s=this.containerPosition,o=t,a=t=>this.containerPosition=t,new Promise(t=>{let e,n=l=>{if(document.hidden)return a(i(s,o,1)),t();e??=l;let h=Math.min(1,(l-e)/300);a(i(s,o,r(h))),h<1?requestAnimationFrame(n):t()};if(document.hidden)return a(i(s,o,1)),t();requestAnimationFrame(n)})).then(()=>{this.#z=[t,this.atStart?0:n,this.atEnd?0:n],this.#P(e)})}this.containerPosition=t,this.#z=[t,this.atStart?0:n,this.atEnd?0:n],this.#P(e)}async #F(t,e,i){let r=this.size*(this.#o?-t:t);return this.#H(r,e,i)}async scrollToAnchor(t,e){return this.#I(t,e?"selection":"navigation")}async #I(t,e="anchor"){this.#w=t;let i=(t=>{if(!t?.collapsed)return t;let{endOffset:e,endContainer:i}=t;if(1===i.nodeType){let t=i.childNodes[e];return t?.nodeType===1?t:i}if(e+1<i.length)t.setEnd(i,e+1);else{if(!(e>1))return i.parentNode;t.setStart(i,e-1)}return t})(t)?.getClientRects?.();if(i){let r=Array.from(i).find(t=>t.width>0&&t.height>0&&t.x>=0&&t.y>=0)||i[0];if(!r)return;if(await this.#W(r,e),"navigation"===e){let e=t.focus?t:void 0;!e&&t.startContainer&&(e=t.startContainer).nodeType===Node.TEXT_NODE&&(e=e.parentElement),e&&e.focus&&(e.tabIndex=-1,e.style.outline="none",e.focus({preventScroll:!0}))}return}if(this.scrolled)return void await this.#H(t*this.viewSize,e);let{pages:r}=this;if(!r)return;let s=Math.round(t*(r-2-1));await this.#F(s+1,e)}#X(){if(this.scrolled)return g(this.#f.document,this.start,this.end,this.#q());let t=this.#o?-this.size:this.size;return g(this.#f.document,this.start-t,this.end-t,this.#q())}#P(t){let e=this.#X();this.#R=e,"selection"!==t&&"navigation"!==t&&"anchor"!==t?this.#w=e:this.#T=!0;let i={reason:t,range:e,index:this.#b};if(this.scrolled)i.fraction=this.start/this.viewSize;else if(this.pages>0){let{page:t,pages:e}=this;this.#p.style.visibility=t>1?"visible":"hidden",i.fraction=(t-1)/(e-2),i.size=1/(e-2)}this.dispatchEvent(new CustomEvent("relocate",{detail:i}))}async #G(t){let{index:e,src:i,data:r,anchor:s,onLoad:n,select:o}=await t;this.#b=e;let a=this.#f?.document?.hasFocus();if(i){let t=this.#N(),s=t=>{if(t.head){let e=t.createElement("style");t.head.prepend(e);let i=t.createElement("style");t.head.append(i),this.#S.set(t,[e,i])}n?.({doc:t,index:e})},o=this.#O.bind(this);await t.load(i,r,s,o),this.dispatchEvent(new CustomEvent("create-overlayer",{detail:{doc:t.document,index:e,attach:e=>t.overlayer=e}})),this.#f=t}await this.scrollToAnchor(("function"==typeof s?s(this.#f.document):s)??0,o),a&&this.focusView()}#K(t){return t>=0&&t<=this.sections.length-1}async #D({index:t,anchor:e,select:i}){if(t===this.#b)await this.#G({index:t,anchor:e,select:i});else{let r=this.#b,s=t=>{this.sections[r]?.unload?.(),this.setStyles(this.#k),this.dispatchEvent(new CustomEvent("load",{detail:t}))};await this.#G(Promise.resolve(this.sections[t].load()).then(async r=>{let n=await this.sections[t].loadContent?.();return{index:t,src:r,data:n,anchor:e,onLoad:s,select:i}}).catch(e=>(console.warn(e),console.warn(Error(`Failed to load section ${t}`)),{})))}}async goTo(t){if(this.#E)return;let e=await t;if(this.#K(e.index))return this.#D(e)}#Y(t){if(!this.#f)return!0;if(this.scrolled)return this.start>0?this.#H(Math.max(0,this.start-(t??this.size)),null,!0):!this.atStart;if(this.atStart)return;let e=this.page-1;return this.#F(e,"page",!0).then(()=>e<=0)}#U(t){if(!this.#f)return!0;if(this.scrolled)return this.viewSize-this.end>2?this.#H(Math.min(this.viewSize,t?this.start+t:this.end),null,!0):!this.atEnd;if(this.atEnd)return;let e=this.page+1,i=this.pages;return this.#F(e,"page",!0).then(()=>e>=i-1)}get atStart(){return null==this.#Q(-1)&&this.page<=1}get atEnd(){return null==this.#Q(1)&&this.page>=this.pages-2}#Q(t){for(let e=this.#b+t;this.#K(e);e+=t)if(this.sections[e]?.linear!=="no")return e}async #J(t,e){if(this.#E)return;this.#E=!0;let i=-1===t,r=await (i?this.#Y(e):this.#U(e));r&&await this.#D({index:this.#Q(t),anchor:i?()=>1:()=>0}),(r||!this.hasAttribute("animated"))&&await new Promise(t=>setTimeout(t,100)),this.#E=!1}async prev(t){return await this.#J(-1,t)}async next(t){return await this.#J(1,t)}async pan(t,e){this.#E||(this.#E=!0,this.scrollBy(t,e),this.#E=!1)}prevSection(){return this.goTo({index:this.#Q(-1)})}nextSection(){return this.goTo({index:this.#Q(1)})}firstSection(){let t=this.sections.findIndex(t=>"no"!==t.linear);return this.goTo({index:t})}lastSection(){let t=this.sections.findLastIndex(t=>"no"!==t.linear);return this.goTo({index:t})}getContents(){return this.#f?[{index:this.#b,overlayer:this.#f.overlayer,doc:this.#f.document}]:[]}setStyles(t){this.#k=t;let e=this.#S.get(this.#f?.document);if(!e)return;let[i,r]=e;if(Array.isArray(t)){let[e,s]=t;i.textContent=e,r.textContent=s}else r.textContent=t;requestAnimationFrame(()=>{this.#j(this.#f.docBackground,this.columnCount)}),this.#f?.document?.fonts?.ready?.then(()=>this.#f.expand())}focusView(){this.#f.document.defaultView.focus()}destroy(){this.#t.unobserve(this),this.#f.destroy(),this.#f=null,this.sections[this.#b]?.unload?.(),this.#M.removeEventListener("change",this.#_)}}customElements.define("foliate-paginator",b),t.s(["Paginator",()=>b])}]);