(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,922713,(e,t,r)=>{!function(){"use strict";if("undefined"!=typeof document&&!("adoptedStyleSheets"in document)){var e="ShadyCSS"in window&&!ShadyCSS.nativeShadow,t=document.implementation.createHTMLDocument(""),r=new WeakMap,i="object"==typeof DOMException?Error:DOMException,s=Object.defineProperty,n=Array.prototype.forEach,o=/@import.+?;?$/gm,a=CSSStyleSheet.prototype;a.replace=function(){return Promise.reject(new i("Can't call replace on non-constructed CSSStyleSheets."))},a.replaceSync=function(){throw new i("Failed to execute 'replaceSync' on 'CSSStyleSheet': Can't call replaceSync on non-constructed CSSStyleSheets.")};var h=new WeakMap,l=new WeakMap,c=new WeakMap,d=new WeakMap,p=T.prototype;p.replace=function(e){try{return this.replaceSync(e),Promise.resolve(this)}catch(e){return Promise.reject(e)}},p.replaceSync=function(e){if(O(this),"string"==typeof e){var t,r,i=this;h.get(i).textContent=((r=(t=e).replace(o,""))!==t&&console.warn("@import rules are not allowed here. See https://github.com/WICG/construct-stylesheets/issues/119#issuecomment-588352418"),r.trim()),d.set(i,[]),l.get(i).forEach(function(e){e.isConnected()&&k(i,E(i,e))})}},s(p,"cssRules",{configurable:!0,enumerable:!0,get:function(){return O(this),h.get(this).sheet.cssRules}}),s(p,"media",{configurable:!0,enumerable:!0,get:function(){return O(this),h.get(this).sheet.media}}),["addRule","deleteRule","insertRule","removeRule"].forEach(function(e){p[e]=function(){var t=this;O(t);var r=arguments;d.get(t).push({method:e,args:r}),l.get(t).forEach(function(i){if(i.isConnected()){var s=E(t,i).sheet;s[e].apply(s,r)}});var i=h.get(t).sheet;return i[e].apply(i,r)}}),s(T,Symbol.hasInstance,{configurable:!0,value:x});var f={childList:!0,subtree:!0},u=new WeakMap,m=new WeakMap,g=new WeakMap,w=new WeakMap;if(D.prototype={isConnected:function(){var e,t=m.get(this);return t instanceof Document?"loading"!==t.readyState:"isConnected"in(e=t.host)?e.isConnected:document.contains(e)},connect:function(){var e=M(this);w.get(this).observe(e,f),g.get(this).length>0&&P(this),L(e,function(e){F(e).connect()})},disconnect:function(){w.get(this).disconnect()},update:function(e){var t,r,i,s=this,n=m.get(s)===document?"Document":"ShadowRoot";if(!Array.isArray(e))throw TypeError("Failed to set the 'adoptedStyleSheets' property on "+n+": Iterator getter is not callable.");if(!e.every(x))throw TypeError("Failed to set the 'adoptedStyleSheets' property on "+n+": Failed to convert value to 'CSSStyleSheet'");if(e.some(C))throw TypeError("Failed to set the 'adoptedStyleSheets' property on "+n+": Can't adopt non-constructed stylesheets");s.sheets=e;var o=g.get(s),a=(t=e).filter(function(e,r){return t.indexOf(e)===r});(r=o,i=a,r.filter(function(e){return -1===i.indexOf(e)})).forEach(function(e){var t,r,i;(t=E(e,s)).parentNode.removeChild(t),r=e,i=s,c.get(r).delete(i),l.set(r,l.get(r).filter(function(e){return e!==i}))}),g.set(s,a),s.isConnected()&&a.length>0&&P(s)}},window.CSSStyleSheet=T,A(Document),"ShadowRoot"in window){A(ShadowRoot);var S=Element.prototype,y=S.attachShadow;S.attachShadow=function(e){var t=y.call(this,e);return"closed"===e.mode&&r.set(this,t),t}}var v=F(document);v.isConnected()?v.connect():document.addEventListener("DOMContentLoaded",v.connect.bind(v))}function b(e){return e.shadowRoot||r.get(e)}function x(e){return"object"==typeof e&&(p.isPrototypeOf(e)||a.isPrototypeOf(e))}function C(e){return"object"==typeof e&&a.isPrototypeOf(e)}function E(e,t){return c.get(e).get(t)}function k(e,t){requestAnimationFrame(function(){t.textContent=h.get(e).textContent,d.get(e).forEach(function(e){return t.sheet[e.method].apply(t.sheet,e.args)})})}function O(e){if(!h.has(e))throw TypeError("Illegal invocation")}function T(){var e=document.createElement("style");t.body.appendChild(e),h.set(this,e),l.set(this,[]),c.set(this,new WeakMap),d.set(this,[])}function F(e){var t=u.get(e);return t||(t=new D(e),u.set(e,t)),t}function A(e){s(e.prototype,"adoptedStyleSheets",{configurable:!0,enumerable:!0,get:function(){return F(this).sheets},set:function(e){F(this).update(e)}})}function L(e,t){for(var r=document.createNodeIterator(e,NodeFilter.SHOW_ELEMENT,function(e){return b(e)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT},null,!1),i=void 0;i=r.nextNode();)t(b(i))}function M(e){var t=m.get(e);return t instanceof Document?t.body:t}function P(e){var t=document.createDocumentFragment(),r=g.get(e),i=w.get(e),s=M(e);i.disconnect(),r.forEach(function(r){var i;t.appendChild(E(r,e)||(i=document.createElement("style"),c.get(r).set(e,i),l.get(r).push(e),i))}),s.insertBefore(t,null),i.observe(s,f),r.forEach(function(t){k(t,E(t,e))})}function D(t){var r=this;r.sheets=[],m.set(r,t),g.set(r,[]),w.set(r,new MutationObserver(function(t,i){document?t.forEach(function(t){e||n.call(t.addedNodes,function(e){e instanceof Element&&L(e,function(e){F(e).connect()})}),n.call(t.removedNodes,function(t){t instanceof Element&&(t instanceof HTMLStyleElement&&g.get(r).some(function(e){return E(e,r)})&&P(r),e||L(t,function(e){F(e).disconnect()}))})}):i.disconnect()}))}}()},858649,e=>{"use strict";e.i(922713);let t=e=>e?.split(/[,;\s]/)?.filter(e=>e)?.map(e=>e.split("=").map(e=>e.trim()));class r extends HTMLElement{static observedAttributes=["zoom","scale-factor","spread"];#e=this.attachShadow({mode:"open"});#t=new ResizeObserver(()=>this.#r());#i;#s=-1;defaultViewport;spread;#n=!1;#o;#a;#h;#l;#c;#d=1;#p=1;#f=!1;#u=!1;#m=!1;#g=new Map;#w=new Map;#S=new Map;#y=1;#v=1;#b=2;#x=[];#C=0;constructor(){super();const e=new CSSStyleSheet;this.#e.adoptedStyleSheets=[e],e.replaceSync(`:host {
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: flex-start;
            align-items: center;
            overflow: auto;
        }
        @supports (justify-content: safe center) {
          :host {
            justify-content: safe center;
          }
        }`),this.#t.observe(this)}attributeChangedCallback(e,t,r){switch(e){case"zoom":this.#c="fit-width"!==r&&"fit-page"!==r?parseFloat(r):r,this.#r();break;case"scale-factor":this.#d=parseFloat(r)/100,this.#r();break;case"spread":this.#E(r)}}async #k({index:e,src:r,detached:i=!1}){let s="string"==typeof r,n=s?r:r?.src,o=s?null:r?.data,a=s?null:r?.onZoom,h=document.createElement("div");h.setAttribute("dir","ltr");let l=document.createElement("iframe");return(h.append(l),Object.assign(l.style,{border:"0",display:"none",overflow:"hidden"}),l.setAttribute("sandbox","allow-same-origin allow-scripts"),l.setAttribute("scrolling","no"),l.setAttribute("part","filter"),this.#e.append(h),i&&Object.assign(h.style,{position:"absolute",visibility:"hidden",pointerEvents:"none"}),n)?new Promise(r=>{l.addEventListener("load",()=>{let s=l.contentDocument;this.dispatchEvent(new CustomEvent("load",{detail:{doc:s,index:e}}));let{width:n,height:o}=((e,r)=>{if("svg"===e.documentElement.localName){let[,,t,r]=e.documentElement.getAttribute("viewBox")?.split(/\s/)??[];return{width:t,height:r}}let i=t(e.querySelector('meta[name="viewport"]')?.getAttribute("content"));if(i)return Object.fromEntries(i);if("string"==typeof r)return t(r);if(r?.width&&r.height)return r;let s=e.querySelector("img");return s?{width:s.naturalWidth,height:s.naturalHeight}:(console.warn(Error("Missing viewport properties")),{width:1e3,height:2e3})})(s,this.defaultViewport);r({element:h,iframe:l,width:parseFloat(n),height:parseFloat(o),onZoom:a,detached:i})},{once:!0}),o?l.srcdoc=o:l.src=n}):{blank:!0,element:h,iframe:l}}#r(e=this.#l){if(!e)return;let t=this.#o??{},r=this.#h??this.#a??{},i="left"===e?t:r,{width:s,height:n}=this.getBoundingClientRect(),o="both"!==this.spread&&"portrait"!==this.spread&&n>1.2*s;this.#n=o;let a=t.width??r.width??0,h=t.height??r.height??0,l="number"!=typeof this.#c||isNaN(this.#c)?("fit-width"===this.#c?o||this.#h?s/(i.width??a):s/((t.width??a)+(r.width??a)):o||this.#h?Math.min(s/(i.width??a),n/(i.height??h)):Math.min(s/((t.width??a)+(r.width??a)),n/Math.max(t.height??h,r.height??h)))||1:this.#c;l*=this.#d,this.#p=l;let c=({frame:e,styles:t})=>{let{element:r,iframe:s,width:n,height:c,blank:d,onZoom:p}=e;if(!s)return;p&&p({doc:e.iframe.contentDocument,scale:l});let f=p?l:1,u=this.#d<1;Object.assign(s.style,{width:`${n*f}px`,height:`${c*f}px`,transform:p?"none":`scale(${l})`,transformOrigin:"top left",display:d?"none":"block"}),Object.assign(r.style,{width:`${(n??a)*l}px`,height:`${(c??h)*l}px`,flexShrink:"0",display:u?"flex":"block",marginBlock:u?void 0:"auto",alignItems:u?"center":void 0,justifyContent:u?"center":void 0,...t}),o&&e!==i&&(r.style.display="none");let m=r.parentNode.host,g=m.clientWidth,w=m.clientHeight;return m.scrollLeft=(r.clientWidth-g)/2,{width:r.clientWidth,height:r.clientHeight,containerWidth:g,containerHeight:w}};if(this.#h){let{width:e,height:t,containerWidth:r,containerHeight:i}=c({frame:this.#h,styles:{marginInline:"auto"}});this.#u=e>r,this.#m=t>i}else{let e=c({frame:t,styles:{marginInlineStart:"auto"}}),i=c({frame:r,styles:{marginInlineEnd:"auto"}}),{width:s,height:n,containerWidth:o,containerHeight:a}=e,{width:h,height:l}=i;this.#u=s+h>o,this.#m=Math.max(n,l)>a}}async #O({left:e,right:t,center:r,side:i,spreadIndex:s}){this.#o=null,this.#a=null,this.#h=null;let n=void 0!==s?`spread-${s}`:null,o=n?this.#w.get(n):null;o?(this.#S.set(n,Date.now()),o.center?this.#h=o.center:(this.#o=o.left,this.#a=o.right)):r?(this.#h=await this.#k(r),n&&(this.#w.set(n,{center:this.#h}),this.#S.set(n,Date.now()))):(this.#o=await this.#k(e),this.#a=await this.#k(t),n&&(this.#w.set(n,{left:this.#o,right:this.#a}),this.#S.set(n,Date.now()))),this.#l=r?"center":this.#o.blank?"right":this.#a.blank?"left":i;let a=r?[this.#h?.element]:[this.#o?.element,this.#a?.element];Array.from(this.#e.children).forEach(e=>{let t=a.includes(e);Object.assign(e.style,{position:t?"relative":"absolute",visibility:t?"visible":"hidden",pointerEvents:t?"auto":"none"})}),this.#r()}#T(){if(!(this.#h||this.#o?.blank)&&this.#n&&this.#o?.element?.style?.display==="none")return this.#l="left",this.#r(),this.#F("page"),!0}#A(){if(!(this.#h||this.#a?.blank)&&this.#n&&this.#a?.element?.style?.display==="none")return this.#l="right",this.#r(),this.#F("page"),!0}open(e){this.book=e,this.defaultViewport=e.rendition?.viewport,this.rtl="rtl"===e.dir,this.#L()}#L(e){let t=this.book,{rendition:r}=t,i=this.rtl,s=!i;this.spread=e||r?.spread,"none"===this.spread?this.#i=t.sections.map(e=>({center:e})):this.#i=t.sections.reduce((e,t,r)=>{let n=e[e.length-1],{pageSpread:o}=t,a=()=>{let t={};return e.push(t),t};return"center"===o?(n.left||n.right?a():n).center=t:"left"===o?(n.center||n.left||s&&r?a():n).left=t:"right"===o?(n.center||n.right||i&&r?a():n).right=t:s?n.center||n.right?a().left=t:n.left||!r?n.right=t:n.left=t:n.center||n.left?a().right=t:n.right||!r?n.left=t:n.right=t,e},[{}])}#E(e){if(-1===this.#s)return;let t=this.book.sections[this.index];this.#L(e);let{index:r}=this.getSpreadOf(t);for(let e of(this.#s=-1,this.#g.clear(),this.#w.values()))e.center?e.center.element?.remove():(e.left?.element?.remove(),e.right?.element?.remove());this.#w.clear(),this.#S.clear(),this.goToSpread(r,this.rtl?"right":"left","page")}get index(){let e=this.#i[this.#s],t=e?.center??("left"===this.#l?e.left??e.right:e.right??e.left);return this.book.sections.indexOf(t)}get scrollLocked(){return this.#f}set scrollLocked(e){this.#f=e}get isOverflowX(){return this.#u}get isOverflowY(){return this.#m}#F(e){this.dispatchEvent(new CustomEvent("relocate",{detail:{reason:e,range:null,index:this.index,fraction:0,size:1}}))}getSpreadOf(e){let t=this.#i;for(let r=0;r<t.length;r++){let{left:i,right:s,center:n}=t[r];if(i===e)return{index:r,side:"left"};if(s===e)return{index:r,side:"right"};if(n===e)return{index:r,side:"center"}}}async goToSpread(e,t,r){if(e<0||e>this.#i.length-1)return;if(e===this.#s)return void this.#r(t);this.#s=e;let i=this.#i[e],s=`spread-${e}`,n=this.#g.get(s);if(n&&"loading"!==n)if(n.center){let r=this.book.sections.indexOf(i.center);await this.#O({center:{index:r,src:n.center},spreadIndex:e,side:t})}else{let r=this.book.sections.indexOf(i.left),s=this.book.sections.indexOf(i.right),o={index:r,src:n.left},a={index:s,src:n.right};await this.#O({left:o,right:a,side:t,spreadIndex:e})}else if(i.center){let r=this.book.sections.indexOf(i.center),s=await i.center?.load?.();await this.#O({center:{index:r,src:s},spreadIndex:e,side:t})}else{let r=this.book.sections.indexOf(i.left),s=this.book.sections.indexOf(i.right),n=await i.left?.load?.(),o=await i.right?.load?.();await this.#O({left:{index:r,src:n},right:{index:s,src:o},side:t,spreadIndex:e})}this.#F(r),this.#M()}#M(){if(this.#P(),this.#v<=0)return;let e=[],t=Math.max(1,this.#v-1),r=Math.max(0,this.#v-t);for(let r=1;r<=t;r++){let t=this.#s+r;t>=0&&t<this.#i.length&&e.push({index:t,direction:"forward",distance:r})}for(let t=1;t<=r;t++){let r=this.#s-t;r>=0&&r<this.#i.length&&e.push({index:r,direction:"backward",distance:t})}for(let{index:t,direction:r}of e){let e=`spread-${t}`;if(this.#w.has(e))continue;let i=this.#i[t];i&&this.#x.push({targetIndex:t,direction:r,spread:i,cacheKey:e})}this.#D()}async #D(){for(;this.#x.length>0&&this.#C<this.#y;){let e=this.#x.shift();if(!e)break;let{spread:t,cacheKey:r}=e;this.#g.set(r,"loading"),this.#C++,Promise.resolve().then(async()=>{try{if(t.center){let e=await t.center?.load?.();this.#g.set(r,{center:e});let i=this.book.sections.indexOf(t.center),s=await this.#k({index:i,src:e,detached:!0});if(this.#w.set(r,{center:s}),this.#S.set(r,Date.now()),s.onZoom){let e=s.iframe.contentDocument;s.onZoom({doc:e,scale:this.#p})}}else{let e=await t.left?.load?.(),i=await t.right?.load?.();this.#g.set(r,{left:e,right:i});let s=this.book.sections.indexOf(t.left),n=this.book.sections.indexOf(t.right),o=await this.#k({index:s,src:e,detached:!0}),a=await this.#k({index:n,src:i,detached:!0});if(this.#w.set(r,{left:o,right:a}),this.#S.set(r,Date.now()),o.onZoom){let e=o.iframe.contentDocument;o.onZoom({doc:e,scale:this.#p})}if(a.onZoom){let e=a.iframe.contentDocument;a.onZoom({doc:e,scale:this.#p})}}}catch{this.#g.delete(r),this.#w.delete(r)}finally{this.#C--,this.#D()}})}}#P(){let e=this.#b;if(this.#w.size<=e)return;let t=Array.from(this.#w.keys()).map(e=>({key:e,accessTime:this.#S.get(e)||0})).sort((e,t)=>e.accessTime-t.accessTime),r=this.#w.size-e,i=t.slice(0,r).map(e=>e.key);i.length>0&&i.forEach(e=>{let t=this.#w.get(e);t&&(t.center?t.center.element?.remove():(t.left?.element?.remove(),t.right?.element?.remove())),this.#w.delete(e),this.#S.delete(e),this.#g.delete(e)})}async select(e){await this.goTo(e)}async goTo(e){let{book:t}=this,r=await e,i=t.sections[r.index];if(!i)return;let{index:s,side:n}=this.getSpreadOf(i);await this.goToSpread(s,n)}async next(){if(!(this.rtl?this.#T():this.#A()))return this.goToSpread(this.#s+1,this.rtl?"right":"left","page")}async prev(){if(!(this.rtl?this.#A():this.#T()))return this.goToSpread(this.#s-1,this.rtl?"left":"right","page")}async pan(e,t){this.#f||(this.#f=!0,(r=>{let{element:i,iframe:s}=r;if(!s||!i)return;let n=i.parentNode.host;n.scrollLeft+=e,n.scrollTop+=t})(this.#h??this.#a??{}),this.#f=!1)}getContents(){return Array.from(this.#e.querySelectorAll("iframe"),e=>({doc:e.contentDocument}))}destroy(){for(let e of(this.#t.unobserve(this),this.#w.values()))e.center?e.center.element?.remove():(e.left?.element?.remove(),e.right?.element?.remove());this.#w.clear(),this.#g.clear(),this.#S.clear()}}customElements.define("foliate-fxl",r),e.s(["FixedLayout",()=>r])}]);