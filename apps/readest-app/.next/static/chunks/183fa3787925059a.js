(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,939260,e=>{"use strict";var t=e.i(684658);let i=e=>e.map(e=>e.subitems?.length?[e,i(e.subitems)].flat():e).flat();class s{async init({toc:e,ids:t,splitHref:s,getFragment:r}){(e=>{let t=0,i=e=>{if(e.id=t++,e.subitems)for(let t of e.subitems)i(t)};for(let t of e)i(t)})(e);let a=i(e),n=new Map;for(let[e,t]of a.entries()){let[i,r]=await s(t?.href)??[],o={fragment:r,item:t};n.has(i)?n.get(i).items.push(o):n.set(i,{prev:a[e-1],items:[o]})}let o=new Map;for(let[e,i]of t.entries())n.has(i)?o.set(i,n.get(i)):o.set(i,o.get(t[e-1]));this.ids=t,this.map=o,this.getFragment=r}getProgress(e,t){if(!this.ids)return;let i=this.ids[e],s=this.map.get(i);if(!s)return null;let{prev:r,items:a}=s;if(!a)return r;if(!t||1===a.length&&!a[0].fragment)return a[0].item;let n=t.startContainer.getRootNode();for(let[e,{fragment:i}]of a.entries()){let s=this.getFragment(n,i);if(s&&t.comparePoint(s,0)>0)return a[e-1]?.item??r}return a[a.length-1].item}}class r{constructor(e,t,i){this.sizes=e.map(e=>"no"!=e.linear&&e.size>0?e.size:0),this.sizePerLoc=t,this.sizePerTimeUnit=i,this.sizeTotal=this.sizes.reduce((e,t)=>e+t,0),this.sectionFractions=this.#e()}#e(){let{sizeTotal:e}=this,t=[0],i=0;for(let s of this.sizes)t.push((i+=s)/e);return t}getProgress(e,t,i=0){let{sizes:s,sizePerLoc:r,sizePerTimeUnit:a,sizeTotal:n}=this,o=s[e]??0,l=s.slice(0,e).reduce((e,t)=>e+t,0)+t*o,h=l+i*o;return{fraction:h/n,section:{current:e,total:s.length},location:{current:Math.floor(l/r),next:Math.floor(h/r),total:Math.ceil(n/r)},time:{section:(1-t)*o/a,total:(n-l)/a}}}getSection(e){if(e<=0)return[0,0];if(e>=1)return[this.sizes.length-1,1];e+=Number.EPSILON;let{sizeTotal:t}=this,i=this.sectionFractions.findIndex(t=>t>e)-1;if(i<0)return[0,0];for(;!this.sizes[i];)i++;let s=(e-this.sectionFractions[i])/(this.sizes[i]/t);return[i,s]}}var a=e.i(816188);let n=NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_TEXT|NodeFilter.SHOW_CDATA_SECTION,o=e=>{if(1===e.nodeType){let t=e.tagName.toLowerCase();return"script"===t||"style"===t?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_SKIP}return NodeFilter.FILTER_ACCEPT},l=function*(e,t,i){let s=e.commonAncestorContainer??e.body??e,r=document.createTreeWalker(s,n,{acceptNode:i||o}),a=(e.commonAncestorContainer?(e,t)=>{let i=[];for(let s=t.currentNode;s;s=t.nextNode()){let t=e.comparePoint(s,0);if(0===t)i.push(s);else if(t>0)break}return i}:(e,t)=>{let i=[];for(let e=t.nextNode();e;e=t.nextNode())i.push(e);return i})(e,r);for(let e of t(a.map(e=>e.nodeValue??""),(e,t,i,s)=>{let r=document.createRange();return r.setStart(a[e],t),r.setEnd(a[i],s),r}))yield e},h="foliate-search:",c="foliate-note:",d=async e=>{let t=new Uint8Array(await e.slice(0,4).arrayBuffer());return 80===t[0]&&75===t[1]&&3===t[2]&&4===t[3]},u=async e=>{let t=new Uint8Array(await e.slice(0,5).arrayBuffer());return 37===t[0]&&80===t[1]&&68===t[2]&&70===t[3]&&45===t[4]},f=async t=>{let{configure:i,ZipReader:s,BlobReader:r,TextWriter:a,BlobWriter:n}=await e.A(455008);i({useWebWorkers:!1});let o=new s(new r(t)),l=await o.getEntries(),h=new Map(l.map(e=>[e.filename,e])),c=e=>(t,...i)=>h.has(t)?e(h.get(t),...i):null,d=c(e=>e.getData(new a));return{entries:l,loadText:d,loadBlob:c((e,t)=>e.getData(new n(t))),getSize:e=>h.get(e)?.uncompressedSize??0}},g=async e=>e.isFile?e:(await Promise.all(Array.from(await new Promise((t,i)=>e.createReader().readEntries(e=>t(e),e=>i(e))),g))).flat(),m=async e=>{let t=await g(e),i=new Map((await Promise.all(t.map(e=>new Promise((t,i)=>e.file(i=>t([i,e.fullPath]),e=>i(e)))))).map(([t,i])=>[i.replace(e.fullPath+"/",""),t])),s=new TextDecoder;return{loadText:async e=>{let t;return(t=await (i.get(e)?.arrayBuffer()??null))?s.decode(t):null},loadBlob:e=>i.get(e),getSize:e=>i.get(e)?.size??0}};class p extends Error{}class w extends Error{}class v extends Error{}let y=async e=>{let t=await fetch(e);if(!t.ok)throw new p(`${t.status} ${t.statusText}`,{cause:t});return new File([await t.blob()],new URL(t.url).pathname)},b=async t=>{let i;if("string"==typeof t&&(t=await y(t)),t.isDirectory){let s=await m(t),{EPUB:r}=await e.A(996714);i=await new r(s).init()}else if(t.size)if(await d(t)){let s=await f(t);if((({name:e,type:t})=>"application/vnd.comicbook+zip"===t||e.endsWith(".cbz"))(t)){let{makeComicBook:r}=await e.A(237758);i=r(s,t)}else if((({name:e,type:t})=>"application/x-zip-compressed-fb2"===t||e.endsWith(".fb2.zip")||e.endsWith(".fbz"))(t)){let{makeFB2:t}=await e.A(858577),{entries:r}=s,a=r.find(e=>e.filename.endsWith(".fb2")),n=await s.loadBlob((a??r[0]).filename);i=await t(n)}else{let{EPUB:t}=await e.A(996714);i=await new t(s).init()}}else if(await u(t)){let{makePDF:s}=await e.A(573601);i=await s(t)}else{let{isMOBI:s,MOBI:r}=await e.A(277226);if(await s(t)){let s=await e.A(723039);i=await new r({unzlib:s.unzlibSync}).open(t)}else if((({name:e,type:t})=>"application/x-fictionbook+xml"===t||e.endsWith(".fb2"))(t)){let{makeFB2:s}=await e.A(858577);i=await s(t)}}else throw new w("File not found");if(!i)throw new v("File type not supported");return i};class x{#t;#i;#s;#r;constructor(e,t,i={}){this.#i=e,this.#s=t,this.#r=i,this.#r.hidden&&this.hide(),this.#i.addEventListener("mousemove",({screenX:e,screenY:i})=>{(e!==this.#r.x||i!==this.#r.y)&&(this.#r.x=e,this.#r.y=i,this.show(),this.#t&&clearTimeout(this.#t),t()&&(this.#t=setTimeout(this.hide.bind(this),1e3)))},!1)}cloneFor(e){return new x(e,this.#s,this.#r)}hide(){this.#i.style.cursor="none",this.#r.hidden=!0}show(){this.#i.style.removeProperty("cursor"),this.#r.hidden=!1}}class P extends EventTarget{#a=[];#n=-1;pushState(e){let t=this.#a[this.#n];t===e||t?.fraction&&t.fraction===e.fraction||(this.#a[++this.#n]=e,this.#a.length=this.#n+1,this.dispatchEvent(new Event("index-change")))}replaceState(e){let t=this.#n;this.#a[t]=e}back(){let e=this.#n;if(e<=0)return;let t={state:this.#a[e-1]};this.#n=e-1,this.dispatchEvent(new CustomEvent("popstate",{detail:t})),this.dispatchEvent(new Event("index-change"))}forward(){let e=this.#n;if(e>=this.#a.length-1)return;let t={state:this.#a[e+1]};this.#n=e+1,this.dispatchEvent(new CustomEvent("popstate",{detail:t})),this.dispatchEvent(new Event("index-change"))}get canGoBack(){return this.#n>0}get canGoForward(){return this.#n<this.#a.length-1}clear(){this.#a=[],this.#n=-1}}class E extends HTMLElement{#o=this.attachShadow({mode:"open"});#l;#h;#c;#d=new Map;#u=new x(this,()=>this.hasAttribute("autohide-cursor"));isFixedLayout=!1;lastLocation;history=new P;constructor(){super(),this.history.addEventListener("popstate",({detail:e})=>{let t=this.resolveNavigation(e.state);this.renderer.goTo(t)})}async open(t){if(("string"==typeof t||"function"==typeof t.arrayBuffer||t.isDirectory)&&(t=await b(t)),this.book=t,this.language=(e=>{if(!e)return{};try{let t=Intl.getCanonicalLocales(e)[0],i=new Intl.Locale(t),s=["zh","ja","kr"].includes(i.language),r=(i.getTextInfo?.()??i.textInfo)?.direction;return{canonical:t,locale:i,isCJK:s,direction:r}}catch(e){return console.warn(e),{}}})(t.metadata?.language),t.splitTOCHref&&t.getTOCFragment){let e=t.sections.map(e=>e.id);this.#l=new r(t.sections,1500,1600);let i=t.splitTOCHref.bind(t),a=t.getTOCFragment.bind(t);this.#h=new s,await this.#h.init({toc:t.toc??[],ids:e,splitHref:i,getFragment:a}),this.#c=new s,await this.#c.init({toc:t.pageList??[],ids:e,splitHref:i,getFragment:a})}if(this.isFixedLayout=this.book.rendition?.layout==="pre-paginated",this.isFixedLayout?(await e.A(996425),this.renderer=document.createElement("foliate-fxl")):(await e.A(413226),this.renderer=document.createElement("foliate-paginator")),this.renderer.setAttribute("exportparts","head,foot,filter,container"),this.renderer.addEventListener("load",e=>this.#f(e.detail)),this.renderer.addEventListener("relocate",e=>this.#g(e.detail)),this.renderer.addEventListener("create-overlayer",e=>e.detail.attach(this.#m(e.detail))),this.renderer.open(t),this.#o.append(this.renderer),t.sections.some(e=>e.mediaOverlay)){let e,i=t.media.activeClass,s=t.media.playbackActiveClass;this.mediaOverlay=t.getMediaOverlay(),this.mediaOverlay.addEventListener("highlight",t=>{let r=this.resolveNavigation(t.detail.text);this.renderer.goTo(r).then(()=>{let{doc:t}=this.renderer.getContents().find(e=>e.index=r.index),a=r.anchor(t);a.classList.add(i),s&&a.ownerDocument.documentElement.classList.add(s),e=new WeakRef(a)})}),this.mediaOverlay.addEventListener("unhighlight",()=>{let t=e?.deref();t&&(t.classList.remove(i),s&&t.ownerDocument.documentElement.classList.remove(s))})}}close(){this.renderer?.destroy(),this.renderer?.remove(),this.#l=null,this.#h=null,this.#c=null,this.#d=new Map,this.lastLocation=null,this.history.clear(),this.tts=null,this.mediaOverlay=null}goToTextStart(){return this.goTo(this.book.landmarks?.find(e=>e.type.includes("bodymatter")||e.type.includes("text"))?.href??this.book.sections.findIndex(e=>"no"!==e.linear))}async init({lastLocation:e,showTextStart:t}){let i=e?this.resolveNavigation(e):null;i?(await this.renderer.goTo(i),this.history.pushState(e)):t?await this.goToTextStart():(this.history.pushState(0),await this.next())}#p(e,t,i){return this.dispatchEvent(new CustomEvent(e,{detail:t,cancelable:i}))}#g({reason:e,range:t,index:i,fraction:s,size:r}){let a=this.#l?.getProgress(i,s,r)??{},n=this.#h?.getProgress(i,t),o=this.#c?.getProgress(i,t),l=this.getCFI(i,t);this.lastLocation={...a,tocItem:n,pageItem:o,cfi:l,range:t},("snap"===e||"page"===e||"scroll"===e)&&this.history.replaceState(l),this.#p("relocate",this.lastLocation)}#f({doc:e,index:t}){e.documentElement.lang||=this.language.canonical??"",this.language.isCJK||(e.documentElement.dir||=this.language.direction??""),this.#w(e,t),this.#u.cloneFor(e.documentElement),this.#p("load",{doc:e,index:t})}#w(e,t){let{book:i}=this,s=i.sections[t];e.addEventListener("click",e=>{let t=e.target.closest("a[href]");if(!t)return;e.preventDefault();let r=t.getAttribute("href"),a=s?.resolveHref?.(r)??r;if(i?.isExternal?.(a))Promise.resolve(this.#p("external-link",{a:t,href:a},!0)).then(e=>e?globalThis.open(a,"_blank"):null).catch(e=>console.error(e));else{let e=a;if(!i.resolveHref(a)){let t=r.indexOf("#");if(t>=0){let i=r.slice(t);e=s?.resolveHref?.(i)??a}}Promise.resolve(this.#p("link",{a:t,href:e},!0)).then(t=>t?this.goTo(e):null).catch(e=>console.error(e))}})}async addAnnotation(e,t){let{value:i}=e;if(i.startsWith(h)){let e=i.replace(h,""),{index:s,anchor:r}=await this.resolveNavigation(e),n=this.#v(s);if(n){let{overlayer:e,doc:s}=n;if(t)return void e.remove(i);let o=s?r(s):r;e.add(i,o,a.Overlayer.outline)}return}if(i.startsWith(c)){let s=i.replace(c,""),{index:r,anchor:a}=await this.resolveNavigation(s),n=this.#v(r);if(n){let{overlayer:s,doc:r}=n;if(t)return void s.remove(i);let o=r?a(r):a;this.#p("draw-annotation",{draw:(e,t)=>s.add(i,o,e,t),annotation:e,doc:r,range:o})}return}let{index:s,anchor:r}=await this.resolveNavigation(i),n=this.#v(s);if(n){let{overlayer:s,doc:a}=n;if(s.remove(i),!t){let t=a?r(a):r;this.#p("draw-annotation",{draw:(e,r)=>s.add(i,t,e,r),annotation:e,doc:a,range:t})}}let o=this.#h.getProgress(s)?.label??"";return{index:s,label:o}}deleteAnnotation(e){return this.addAnnotation(e,!0)}#v(e){return this.renderer.getContents().find(t=>t.index===e&&t.overlayer)}#m({doc:e,index:t}){let i=new a.Overlayer(e);e.addEventListener("click",e=>{let[s,r,a]=i.hitTest(e);s&&!s.startsWith(h)&&this.#p("show-annotation",{value:s,index:t,range:r,rect:a})},!1);let s=0,r=/Android/i.test(navigator.userAgent);e.addEventListener("mousemove",t=>{if(r)return;let a=performance.now();if(a-s<200)return;s=a;let[n]=i.hitTest(t);n&&!n.startsWith(h)?e.body.style.cursor="pointer":e.body.style.cursor=""});let n=this.#d.get(t);if(n)for(let e of n)this.addAnnotation(e);return this.#p("create-overlay",{index:t}),i}async showAnnotation(e){let{value:t}=e,i=await this.goTo(t);if(i){let{index:e,anchor:s}=i,{doc:r}=this.#v(e),a=s(r);this.#p("show-annotation",{value:t,index:e,range:a})}}getCFI(e,i){let s=this.book.sections[e].cfi??t.fake.fromIndex(e);return i?t.joinIndir(s,t.fromRange(i)):s}resolveCFI(e){if(this.book.resolveCFI)return this.book.resolveCFI(e);{let i=t.parse(e);return{index:t.fake.toIndex((i.parent??i).shift()),anchor:e=>t.toRange(e,i)}}}resolveNavigation(e){try{if("number"==typeof e)return{index:e};if("number"==typeof e.fraction){let[t,i]=this.#l.getSection(e.fraction);return{index:t,anchor:i}}if(t.isCFI.test(e))return this.resolveCFI(e);return this.book.resolveHref(e)}catch(t){console.error(t),console.error(`Could not resolve target ${e}`)}}async goTo(e){let t=this.resolveNavigation(e);try{return await this.renderer.goTo(t),this.history.pushState(e),t}catch(t){console.error(t),console.error(`Could not go to ${e}`)}}async goToFraction(e){let[t,i]=this.#l.getSection(e);await this.renderer.goTo({index:t,anchor:i}),this.history.pushState({fraction:e})}async select(e){try{let t=await this.resolveNavigation(e);await this.renderer.goTo({...t,select:!0}),this.history.pushState(e)}catch(t){console.error(t),console.error(`Could not go to ${e}`)}}deselect(){for(let{doc:e}of this.renderer.getContents())e.defaultView.getSelection().removeAllRanges()}getSectionFractions(){return(this.#l?.sectionFractions??[]).map(e=>e+Number.EPSILON)}getProgressOf(e,t){return{tocItem:this.#h?.getProgress(e,t),pageItem:this.#c?.getProgress(e,t)}}async getTOCItemOf(e){try{let{index:t,anchor:i}=await this.resolveNavigation(e),s=await this.book.sections[t].createDocument(),r=i(s),a=r instanceof Range,n=a?r:s.createRange();return a||n.selectNodeContents(r),this.#h.getProgress(t,n)}catch(t){console.error(t),console.error(`Could not get ${e}`)}}async prev(e){await this.renderer.prev(e)}async next(e){await this.renderer.next(e)}async pan(e,t){await this.renderer.pan(e,t)}isOverflowX(){return this.renderer.isOverflowX}isOverflowY(){return this.renderer.isOverflowY}goLeft(){return"rtl"===this.book.dir?this.next():this.prev()}goRight(){return"rtl"===this.book.dir?this.prev():this.next()}async *#y(e,t,i){for(let{range:s,excerpt:r}of e(await this.book.sections[i].createDocument(),t))yield{cfi:this.getCFI(i,s),excerpt:r}}async *#b(e,t){let{sections:i}=this.book;for(let[s,{createDocument:r}]of i.entries()){if(!r)continue;let a=Array.from(e(await r(),t),({range:e,excerpt:t})=>({cfi:this.getCFI(s,e),excerpt:t})),n=(s+1)/i.length;yield{progress:n},a.length&&(yield{index:s,subitems:a})}}async *search(t){this.clearSearch();let{searchMatcher:i}=await e.A(593979),{sections:s}=this.book,{query:r,index:a,results:n}=t,o=i(l,{defaultLocale:this.language,...t}),c=n?.length?async function*(){for(let e of n)if(e.subitems){let t=(e.index+1)/s.length;yield{progress:t},yield{index:e.index,subitems:e.subitems}}else yield{cfi:e.cfi,excerpt:e.excerpt}}():null!=a?this.#y(o,r,a):this.#b(o,r),d=[];for await(let e of(this.#d.set(a,d),c))if(e.subitems){let t=e.subitems.map(({cfi:e})=>({value:h+e}));for(let i of(this.#d.set(e.index,t),t))this.addAnnotation(i);yield{index:e.index,label:this.#h.getProgress(e.index)?.label??"",subitems:e.subitems}}else{if(e.cfi){let t={value:h+e.cfi};d.push(t),this.addAnnotation(t)}yield e}yield"done"}clearSearch(){for(let e of this.#d.values())for(let t of e)this.deleteAnnotation(t);this.#d.clear()}async initTTS(t="word",i,s){let r=this.renderer.getContents()[0].doc;if(this.tts&&this.tts.doc===r)return;let{TTS:a}=await e.A(552402);this.tts=new a(r,l,i,s||(e=>this.renderer.scrollToAnchor(e,!0)),t)}startMediaOverlay(){let{index:e}=this.renderer.getContents()[0];return this.mediaOverlay.start(e)}}customElements.define("foliate-view",E),e.s(["NotFoundError",()=>w,"ResponseError",()=>p,"UnsupportedTypeError",()=>v,"View",()=>E,"makeBook",0,b],939260)},455008,e=>{e.v(t=>Promise.all(["static/chunks/5b0269c1b793be72.js"].map(t=>e.l(t))).then(()=>t(558693)))},277226,e=>{e.v(t=>Promise.all(["static/chunks/096039d244e363cc.js"].map(t=>e.l(t))).then(()=>t(18337)))},858577,e=>{e.v(t=>Promise.all(["static/chunks/c3789c62da092ab3.js"].map(t=>e.l(t))).then(()=>t(343776)))},723039,e=>{e.v(t=>Promise.all(["static/chunks/d35e704bc36da78b.js"].map(t=>e.l(t))).then(()=>t(626030)))},573601,e=>{e.v(t=>Promise.all(["static/chunks/69ed564344afa31e.js"].map(t=>e.l(t))).then(()=>t(914447)))},996714,e=>{e.v(t=>Promise.all(["static/chunks/a1f2c41ac4ac6382.js"].map(t=>e.l(t))).then(()=>t(92833)))},237758,e=>{e.v(t=>Promise.all(["static/chunks/b6b3249f38909eab.js"].map(t=>e.l(t))).then(()=>t(918531)))},413226,e=>{e.v(t=>Promise.all(["static/chunks/7adfc8d2a6aee17a.js"].map(t=>e.l(t))).then(()=>t(243418)))},996425,e=>{e.v(t=>Promise.all(["static/chunks/9c4f3fb4c65e8497.js"].map(t=>e.l(t))).then(()=>t(858649)))},593979,e=>{e.v(t=>Promise.all(["static/chunks/d83daab32e0cb8fd.js"].map(t=>e.l(t))).then(()=>t(203621)))},552402,e=>{e.v(t=>Promise.all(["static/chunks/4fe813a0ada49be5.js"].map(t=>e.l(t))).then(()=>t(731935)))}]);