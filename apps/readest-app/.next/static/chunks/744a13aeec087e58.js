(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,957476,e=>{"use strict";var t,a,s,l,n=e.i(374517),r=e.i(7284),i=e.i(917409),o=e.i(875245),d=e.i(553438),c=e.i(267813),u=e.i(647735),m=e.i(955066),h=e.i(305133),p=e.i(137432),x=e.i(707697),g=e.i(329748),b=e.i(47816),f=e.i(141886),v=e.i(265107),w=e.i(837122),y=e.i(894019),k=e.i(96508),j=e.i(57290),N=e.i(981441),S=e.i(604111),C=e.i(559147),A=e.i(424439),D=e.i(34970),B=e.i(29755),P=e.i(426320),L=e.i(62725),F=e.i(529742),M=e.i(944996);let T={en:F.default,zh:M.default};var I=e.i(778912),E=e.i(262504),R=e.i(885449),U=e.i(17913),O=e.i(852955),_=e.i(501747),z=e.i(667358),W=e.i(341537),$=e.i(871611);let G=async()=>{let e=await (0,$.invoke)("plugin:native-bridge|checkPermissions");return"granted"!==e.manageStorage&&(e=await (0,$.invoke)("plugin:native-bridge|request_manage_storage_permission")),"granted"===e.manageStorage};var q=e.i(345598),K=e.i(353642);e.i(86987);var V=e.i(675510),H=e.i(653184);e.i(307178);var Y=e.i(971319),Q=e.i(132810),X=e.i(619316),Z=e.i(271947),J=e.i(65518);let ee=({children:e,showOverlay:t=!0})=>J.default.createPortal((0,n.jsx)("div",{className:(0,r.default)("fixed inset-0 isolate z-[100] flex items-center justify-center",t&&"bg-black bg-opacity-50"),style:{transform:"translateZ(0)"},children:e}),document.body),et=[{id:"gutenberg",name:"Project Gutenberg",url:"https://m.gutenberg.org/ebooks.opds/",description:"World's largest collection of free ebooks",icon:"ðŸ›ï¸"},{id:"standardebooks",name:"Standard Ebooks",url:"https://standardebooks.org/feeds/opds",description:"Free and liberated ebooks, carefully produced for the true book lover",icon:"ðŸ“š"},{id:"manybooks",name:"ManyBooks",url:"https://manybooks.net/opds/index.php",description:"Over 50,000 free ebooks",icon:"ðŸ“–"},{id:"unglue.it",name:"Unglue.it",url:"https://unglue.it/api/opds/",description:'Free ebooks from authors who have "unglued" their books',icon:"ðŸ”“"}];async function ea(e,t,a){let s=await (0,Z.validateOPDSURL)(e,t,a,(0,f.isWebAppPlatform)());return{valid:s.isValid,error:s.error}}function es(){let e=(0,S.useTranslation)(),t=(0,d.useRouter)(),{envConfig:a}=(0,k.useEnv)(),{settings:s}=(0,A.useSettingsStore)(),[l,r]=(0,i.useState)(()=>s.opdsCatalogs||[]),[o,c]=(0,i.useState)(!1),[u,m]=(0,i.useState)({name:"",url:"",description:"",username:"",password:""}),[h,p]=(0,i.useState)(!1),[x,g]=(0,i.useState)(""),[b,v]=(0,i.useState)(!1),w=e=>{r(e),(0,Q.saveSysSettings)(a,"opdsCatalogs",e)},y=async()=>{if(!u.name||!u.url)return;let t=u.url.trim().toLowerCase();if(!t.startsWith("http://")&&!t.startsWith("https://"))return void g(e("URL must start with http:// or https://"));if((0,f.isWebAppPlatform)()&&(0,X.isLanAddress)(u.url))return void g(e("Adding LAN addresses is not supported in the web app version."));v(!0),g("");let a=await ea(u.url,u.username||void 0,u.password||void 0);if(!a.valid){g(a.error||e("Invalid OPDS catalog. Please check the URL.")),v(!1);return}w([{id:Date.now().toString(),name:u.name,url:u.url,description:u.description,username:u.username||void 0,password:u.password||void 0},...l]),m({name:"",url:"",description:"",username:"",password:""}),g(""),v(!1),c(!1)},j=e=>{let a=new URLSearchParams({url:e.url});e.username&&a.set("id",e.id),t.push(`/opds?${a.toString()}`)};return(0,n.jsxs)("div",{className:"container max-w-2xl",children:[(0,n.jsxs)("div",{className:"mb-8",children:[(0,n.jsx)("h1",{className:"mb-2 text-base font-bold",children:e("OPDS Catalogs")}),(0,n.jsx)("p",{className:"text-base-content/70 text-xs",children:e("Browse and download books from online catalogs")})]}),(0,n.jsxs)("section",{className:"mb-12 text-base",children:[(0,n.jsxs)("div",{className:"mb-4 flex items-center justify-between",children:[(0,n.jsx)("h2",{className:"font-semibold",children:e("My Catalogs")}),(0,n.jsxs)("button",{onClick:()=>c(!0),className:"btn btn-primary btn-sm",children:[(0,n.jsx)(Y.IoAdd,{className:"h-4 w-4"}),e("Add Catalog")]})]}),0===l.length?(0,n.jsxs)("div",{className:"border-base-300 rounded-lg border-2 border-dashed p-12 text-center",children:[(0,n.jsx)(Y.IoBook,{className:"text-base-content/30 mx-auto mb-4 h-12 w-12"}),(0,n.jsx)("h3",{className:"mb-2 font-semibold",children:e("No catalogs yet")}),(0,n.jsx)("p",{className:"text-base-content/70 mb-4 text-sm",children:e("Add your first OPDS catalog to start browsing books")}),(0,n.jsx)("button",{onClick:()=>c(!0),className:"btn btn-primary btn-sm",children:e("Add Your First Catalog")})]}):(0,n.jsx)("div",{className:"grid gap-4 sm:grid-cols-2",children:l.map(t=>(0,n.jsx)("div",{className:"card bg-base-100 border-base-300 h-full border shadow-sm transition-shadow hover:shadow-md",children:(0,n.jsxs)("div",{className:"card-body h-full justify-between p-4",children:[(0,n.jsx)("div",{className:"flex items-center justify-between",children:(0,n.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,n.jsxs)("div",{className:"mb-1 flex items-center justify-between",children:[(0,n.jsxs)("h3",{className:"card-title line-clamp-1 text-sm",children:[t.icon&&(0,n.jsx)("span",{className:"",children:t.icon}),t.name]}),(0,n.jsx)("button",{onClick:()=>{var e;return e=t.id,void w(l.filter(t=>t.id!==e))},className:"btn btn-ghost btn-xs btn-square",title:"Remove",children:(0,n.jsx)(Y.IoTrash,{className:"h-4 w-4"})})]}),t.description&&(0,n.jsx)("p",{className:"text-base-content/70 mb-2 line-clamp-1 h-6 text-sm sm:line-clamp-2 sm:h-10",children:t.description}),(0,n.jsx)("p",{className:"text-base-content/50 line-clamp-1 text-xs",children:t.url}),t.username&&(0,n.jsxs)("p",{className:"text-base-content/50 mt-1 text-xs",children:[e("Username"),": ",t.username]})]})}),(0,n.jsx)("div",{className:"card-actions mt-4 justify-end",children:(0,n.jsxs)("button",{onClick:()=>j(t),className:"btn btn-sm btn-primary",children:[(0,n.jsx)(Y.IoOpenOutline,{className:"h-4 w-4"}),e("Browse")]})})]})},t.id))})]}),(0,n.jsxs)("section",{className:"text-base",children:[(0,n.jsx)("h2",{className:"mb-4 font-semibold",children:e("Popular Catalogs")}),(0,n.jsx)("div",{className:"grid gap-4 sm:grid-cols-2",children:et.filter(e=>!e.disabled).map(t=>{let a=l.some(e=>e.url===t.url);return(0,n.jsx)("div",{className:"card bg-base-100 border-base-300 border shadow-sm transition-shadow hover:shadow-md",children:(0,n.jsxs)("div",{className:"card-body p-4",children:[(0,n.jsxs)("h3",{className:"card-title mb-1 text-sm",children:[t.icon&&(0,n.jsx)("span",{className:"",children:t.icon}),t.name]}),t.description&&(0,n.jsx)("p",{className:"text-base-content/70 line-clamp-2 text-sm",children:t.description}),(0,n.jsxs)("div",{className:"card-actions mt-4 justify-end gap-2",children:[!a&&(0,n.jsxs)("button",{onClick:()=>{!l.some(e=>e.url===t.url)&&w([...l,{...t}])},className:"btn btn-sm",children:[(0,n.jsx)(Y.IoAdd,{className:"h-4 w-4"}),e("Add")]}),(0,n.jsxs)("button",{onClick:()=>j(t),className:"btn btn-sm btn-primary",children:[(0,n.jsx)(Y.IoOpenOutline,{className:"h-4 w-4"}),e("Browse")]})]})]})},t.id)})})]}),o&&(0,n.jsx)(ee,{children:(0,n.jsx)("dialog",{className:"modal modal-open",children:(0,n.jsxs)("div",{className:"modal-box",children:[(0,n.jsx)("h3",{className:"mb-4 text-lg font-bold",children:e("Add OPDS Catalog")}),(0,n.jsxs)("form",{onSubmit:e=>{e.preventDefault(),y()},className:"space-y-4",children:[(0,n.jsxs)("div",{className:"form-control",children:[(0,n.jsx)("div",{className:"label",children:(0,n.jsxs)("span",{className:"label-text",children:[e("Catalog Name")," *"]})}),(0,n.jsx)("input",{type:"text",value:u.name,onChange:e=>m({...u,name:e.target.value}),placeholder:e("My Calibre Library"),className:"input input-bordered placeholder:text-sm",disabled:b,required:!0})]}),(0,n.jsxs)("div",{className:"form-control",children:[(0,n.jsx)("div",{className:"label",children:(0,n.jsxs)("span",{className:"label-text",children:[e("OPDS URL")," *"]})}),(0,n.jsx)("input",{type:"url",value:u.url,onChange:e=>m({...u,url:e.target.value}),placeholder:"https://example.com/opds",className:"input input-bordered placeholder:text-sm",disabled:b,required:!0}),x&&(0,n.jsx)("div",{className:"label",children:(0,n.jsx)("span",{className:"label-text-alt text-error",children:x})})]}),(0,n.jsxs)("div",{className:"form-control",children:[(0,n.jsx)("div",{className:"label",children:(0,n.jsx)("span",{className:"label-text",children:e("Username (optional)")})}),(0,n.jsx)("input",{type:"text",value:u.username,onChange:e=>m({...u,username:e.target.value}),placeholder:e("Username"),className:"input input-bordered placeholder:text-sm",disabled:b,autoComplete:"username"})]}),(0,n.jsxs)("div",{className:"form-control",children:[(0,n.jsx)("div",{className:"label",children:(0,n.jsx)("span",{className:"label-text",children:e("Password (optional)")})}),(0,n.jsxs)("div",{className:"relative",children:[(0,n.jsx)("input",{type:h?"text":"password",value:u.password,onChange:e=>m({...u,password:e.target.value}),placeholder:e("Password"),className:"input input-bordered w-full pr-10 placeholder:text-sm",disabled:b,autoComplete:"current-password"}),(0,n.jsx)("button",{type:"button",onClick:()=>p(!h),className:"btn btn-ghost btn-sm btn-square absolute right-1 top-1/2 -translate-y-1/2",tabIndex:-1,children:h?(0,n.jsx)(Y.IoEyeOff,{className:"h-4 w-4"}):(0,n.jsx)(Y.IoEye,{className:"h-4 w-4"})})]})]}),(0,n.jsxs)("div",{className:"form-control",children:[(0,n.jsx)("div",{className:"label",children:(0,n.jsx)("span",{className:"label-text",children:e("Description (optional)")})}),(0,n.jsx)("textarea",{value:u.description,onChange:e=>m({...u,description:e.target.value}),placeholder:e("A brief description of this catalog"),className:"textarea textarea-bordered text-sm placeholder:text-sm",rows:2,disabled:b})]}),(0,n.jsxs)("div",{className:"modal-action",children:[(0,n.jsx)("button",{type:"button",onClick:()=>{c(!1),m({name:"",url:"",description:"",username:"",password:""}),g(""),p(!1)},className:"btn",disabled:b,children:e("Cancel")}),(0,n.jsx)("button",{type:"submit",className:"btn btn-primary",disabled:b,children:b?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("span",{className:"loading loading-spinner loading-sm"}),e("Validating...")]}):e("Add Catalog")})]})]})]})})})]})}var el=e.i(260805);function en({onClose:e}){let t=(0,S.useTranslation)();return(0,n.jsx)(el.default,{isOpen:!0,title:t("Online Library"),onClose:e,bgClassName:"sm:!bg-black/75",boxClassName:"sm:min-w-[520px] sm:w-3/4 sm:h-[85%] sm:!max-w-screen-sm",children:(0,n.jsx)("div",{className:(0,r.clsx)("bg-base-100 relative flex flex-col overflow-y-auto pb-4"),children:(0,n.jsx)(es,{})})})}var er=e.i(917742),ei=e.i(99500),eo=e.i(44438),ed=e.i(699475);let ec={macos:(0,L.stubTranslation)("Reveal in Finder"),windows:(0,L.stubTranslation)("Reveal in File Explorer"),linux:(0,L.stubTranslation)("Reveal in Folder"),default:(0,L.stubTranslation)("Reveal in Folder")};var eu=e.i(209051),em=e.i(887442);let eh=()=>{let e=(0,S.useTranslation)(),{appService:t,envConfig:a}=(0,k.useEnv)(),{settings:s,setSettings:l,saveSettings:o}=(0,A.useSettingsStore)(),[d,c]=(0,i.useState)(!1),[u,h]=(0,i.useState)(""),[p,x]=(0,i.useState)(""),[b,f]=(0,i.useState)("idle"),[v,w]=(0,i.useState)({current:0,total:0}),[y,j]=(0,i.useState)(""),[N,C]=(0,i.useState)([]),[D,B]=(0,i.useState)(""),[P,F]=(0,i.useState)(0),[M,T]=(0,i.useState)([]);(0,i.useEffect)(()=>{let e=e=>{c(e.detail.visible),e.detail.visible&&(I(),R())},t=document.getElementById("migrate_data_dir_window");return t&&t.addEventListener("setDialogVisibility",e),()=>{t&&t.removeEventListener("setDialogVisibility",e)}},[]);let I=async()=>{try{if(!t)return;let e=await t.resolveFilePath("","Data");h(e);let a=await t.readDirectory(e,"None");C(a),B(a.length.toLocaleString()),F(a.reduce((e,t)=>e+t.size,0))}catch(e){console.error("Error loading current data directory:",e)}},R=async()=>{try{if(t?.isAndroidApp){let e=await (0,W.getExternalSDCardPath)(),a=[{path:"/storage/emulated/0",label:"/sdcard/0"},{path:"/storage/emulated/0/Books",label:"/sdcard/0/Books"},{path:"/storage/emulated/0/Documents",label:"/sdcard/0/Documents"},{path:"/storage/emulated/0/Download",label:"/sdcard/0/Download"}];if(e.path){let t=e.path;a=[...a,{path:t,label:"/sdcard/1"},{path:`${t}/Books`,label:"/sdcard/1/Books"},{path:`${t}/Documents`,label:"/sdcard/1/Documents"},{path:`${t}/Download`,label:"/sdcard/1/Download"}]}let s=await (0,ei.documentDir)();T([...t?.distChannel==="playstore"?[]:a,{path:s,label:"/sdcard/APPDATA/Documents"}])}}catch(e){console.error("Error loading app local data directory:",e)}},U=async()=>{f("selecting"),j("");try{let e=await t?.selectDirectory?.("write");if(e){let a=await (0,ei.join)(e,E.DATA_SUBDIR);await t?.createDir(a,"None",!0),x(a),f("idle")}else f("idle")}catch(t){console.error("Error selecting directory:",t),j(e("Failed to select directory")),f("error")}},O=async a=>{if(j(""),a.includes("Android/data")||await G())try{let e=await (0,ei.join)(a,E.DATA_SUBDIR);await t?.createDir(e,"None",!0),x(e),f("idle")}catch(t){console.error("Error selecting directory:",t),j(e("Failed to select directory")),f("error")}},_=async()=>{if(t&&u&&p&&N.length){f("migrating"),j(""),w({current:0,total:0});try{if(p===u)throw Error(e("The new data directory must be different from the current one."));for(let e=0;e<N.length;e++){let a=N[e];w({current:e+1,total:N.length,currentFile:a.path});let s=await (0,ei.join)(u,a.path),l=await (0,ei.join)(p,a.path);await t.copyFile(s,l,"None")}let n=await t.readDirectory(p,"None");for(let e of N)if(!n.find(t=>t.path===e.path&&t.size===e.size))throw Error(`File ${e.path} failed to copy.`);await t.deleteDir(u,"None",!0);let r=(0,g.getDirPath)(p);await t.setCustomRootDir(r),s.customRootDir=r,s.localBooksDir=await t.resolveFilePath("","Books"),l({...s}),await o(a,s),f("completed"),h(p),C([]),B(""),F(0),I()}catch(t){console.error("Error migrating data:",t),j(e("Migration failed: {{error}}",{error:t||"Unknown error"})),f("error")}}},z=()=>{"migrating"!==b&&(c(!1),x(""),f("idle"),j(""),w({current:0,total:0}))},$=e=>{e&&t?.isDesktopApp&&(0,ed.revealItemInDir)(e)},q=v.total>0?Math.round(v.current/v.total*100):0,K=p&&p!==u&&"idle"===b,V=ec[(0,L.getOSPlatform)()]||ec.default;return(0,n.jsx)(el.default,{id:"migrate_data_dir_window",isOpen:d,title:e("Change Data Location"),onClose:z,boxClassName:"sm:!w-[520px] sm:!max-w-screen-sm sm:h-auto",children:d&&(0,n.jsxs)("div",{className:"migrate-data-dir-content flex flex-col gap-6 px-6 py-4",children:[(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)("h3",{className:"text-base-content text-sm font-semibold",children:e("Current Data Location")}),(0,n.jsxs)("button",{title:e(V),className:"bg-base-200 flex w-full items-center gap-2 rounded-lg p-3",onClick:()=>$(u),children:[(0,n.jsx)(er.RiFolderOpenLine,{className:"text-base-content/70 h-4 w-4 flex-shrink-0"}),(0,n.jsx)("span",{className:"text-base-content/80 break-all text-start font-mono text-sm",children:u||e("Loading...")})]}),D?(0,n.jsxs)("div",{className:"flex space-x-4",children:[(0,n.jsx)("p",{className:"text-base-content/60 text-xs",children:e("File count: {{size}}",{size:D})}),(0,n.jsx)("p",{className:"text-base-content/60 text-xs",children:e("Total size: {{size}}",{size:(0,m.formatBytes)(P)})})]}):(0,n.jsx)("p",{className:"text-base-content/60 text-xs",children:e("Calculating file info...")})]}),(0,n.jsxs)("div",{className:"space-y-3",children:[(0,n.jsx)("h3",{className:"text-base-content text-sm font-semibold",children:e("New Data Location")}),p&&(0,n.jsxs)("button",{title:e(V),className:"bg-primary/10 border-primary/20 flex w-full items-center gap-2 rounded-lg border p-3",onClick:()=>$(p),children:[(0,n.jsx)(er.RiFolderOpenLine,{className:"text-primary h-4 w-4 flex-shrink-0"}),(0,n.jsx)("span",{className:"text-primary break-all text-start font-mono text-sm",children:p})]}),t?.isAndroidApp?(0,n.jsx)(eu.default,{label:e("Choose New Folder"),className:"dropdown-bottom flex w-full justify-center",buttonClassName:"btn btn-ghost btn-outline w-full",toggleButton:(0,n.jsx)("div",{children:p?e("Choose Different Folder"):e("Choose New Folder")}),children:(0,n.jsx)("div",{className:(0,r.default)("folder-menu dropdown-content dropdown-center no-triangle","border-base-300 !bg-base-200 z-20 mt-1 max-w-[90vw] shadow-2xl"),children:M.map(e=>(0,n.jsx)(em.default,{toggled:p.split(`/${E.DATA_SUBDIR}`)[0]===e.path,transient:!0,label:e.label,onClick:()=>O(e.path)},e.path))})}):(0,n.jsxs)("button",{className:"btn btn-outline btn-sm w-full",onClick:U,disabled:"migrating"===b||"selecting"===b,children:["selecting"===b&&(0,n.jsx)(er.RiLoader2Line,{className:"h-4 w-4 animate-spin"}),p?e("Choose Different Folder"):e("Choose New Folder")]})]}),"migrating"===b&&(0,n.jsxs)("div",{className:"space-y-3",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)(er.RiLoader2Line,{className:"text-primary h-4 w-4 animate-spin"}),(0,n.jsx)("span",{className:"text-base-content text-sm font-medium",children:e("Migrating data...")}),(0,n.jsxs)("span",{className:"text-base-content/70 text-sm",children:[q,"%"]})]}),(0,n.jsx)("div",{className:"bg-base-200 h-2 w-full rounded-full",children:(0,n.jsx)("div",{className:"bg-primary h-2 rounded-full transition-all duration-300",style:{width:`${q}%`}})}),v.currentFile&&(0,n.jsx)("p",{className:"text-base-content/60 overflow-hidden font-mono text-xs",style:{direction:"rtl",textAlign:"left",whiteSpace:"nowrap",textOverflow:"ellipsis"},children:e("Copying: {{file}}",{file:v.currentFile})}),(0,n.jsx)("p",{className:"text-base-content/60 text-xs",children:e("{{current}} of {{total}} files",{current:v.current.toLocaleString(),total:v.total.toLocaleString()})})]}),"completed"===b&&(0,n.jsxs)("div",{className:"space-y-3",children:[(0,n.jsxs)("div",{className:"text-success flex items-center gap-2",children:[(0,n.jsx)(er.RiCheckboxCircleFill,{className:"h-5 w-5"}),(0,n.jsx)("span",{className:"font-medium",children:e("Migration completed successfully!")})]}),(0,n.jsx)("div",{className:"bg-success/10 border-success/20 rounded-lg border p-3",children:(0,n.jsx)("p",{className:"text-success/80 text-sm",children:e("Your data has been moved to the new location. Please restart the application to complete the process.")})})]}),"error"===b&&y&&(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsxs)("div",{className:"text-error flex items-center gap-2",children:[(0,n.jsx)(er.RiErrorWarningFill,{className:"h-5 w-5"}),(0,n.jsx)("span",{className:"font-medium",children:e("Migration failed")})]}),(0,n.jsx)("div",{className:"bg-error/10 border-error/20 rounded-lg border p-3",children:(0,n.jsx)("p",{className:"text-error/80 break-all text-sm",children:y})})]}),K&&(0,n.jsx)("div",{className:"bg-warning/10 border-warning/20 rounded-lg border p-3",children:(0,n.jsxs)("div",{className:"flex items-start gap-2",children:[(0,n.jsx)(er.RiErrorWarningFill,{className:"text-warning mt-0.5 h-4 w-4 flex-shrink-0"}),(0,n.jsxs)("div",{className:"space-y-1",children:[(0,n.jsx)("p",{className:"text-base-content text-sm font-medium",children:e("Important Notice")}),(0,n.jsx)("p",{className:"text-base-content/80 text-sm",children:e("This will move all your app data to the new location. Make sure the destination has enough free space.")})]})]})}),(0,n.jsx)("div",{className:"flex gap-3 pt-2",children:"completed"===b?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("button",{className:"btn btn-outline flex-1",onClick:z,children:e("Close")}),(0,n.jsx)("button",{className:"btn btn-primary flex-1",onClick:()=>{(0,eo.relaunch)()},children:e("Restart App")})]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("button",{className:"btn btn-outline flex-1",onClick:z,disabled:"migrating"===b,children:e("Cancel")}),(0,n.jsxs)("button",{className:"btn btn-primary flex-1",onClick:_,disabled:!K||"idle"!==b,children:["migrating"===b&&(0,n.jsx)(er.RiLoader2Line,{className:"h-4 w-4 animate-spin"}),e("Start Migration")]})]})})]})})};var ep=e.i(943583),ex=e.i(168375);let eg=e=>{if(!e)return[];let t=e.split("/");return t.map((e,a)=>({name:e,path:t.slice(0,a+1).join("/")}))};var eb=e.i(409383),ef=e.i(205560),ev=e.i(270436),ew=e.i(360289),ey=e.i(698353),ek=e.i(302814),ej=e.i(452612),eN=e.i(675788),eS=e.i(806463),eC=e.i(624098),eA=e.i(995970),eD=e.i(542748);let eB=e=>`avatar_${btoa(e).replace(/[^a-zA-Z0-9]/g,"")}`,eP=({url:e,size:t,className:a,borderClassName:s,DefaultIcon:l})=>{let[o,d]=(0,i.useState)(()=>e?localStorage.getItem(eB(e)):null);return(0,i.useEffect)(()=>{if(!e)return;let t=eB(e),a=localStorage.getItem(t);a&&a===o||(async()=>{try{let a=await fetch(e,{referrerPolicy:"no-referrer"}),s=await a.blob(),l=new FileReader;l.onloadend=()=>{let e=l.result;try{localStorage.setItem(t,e),d(e)}catch(e){console.warn("Failed to cache avatar in localStorage:",e)}},l.readAsDataURL(s)}catch(e){console.error("Failed to cache avatar:",e)}})()},[e,o]),(0,n.jsx)("div",{className:"relative flex h-full w-full items-center justify-center rounded-full",style:{width:t,height:t},children:e?(0,n.jsxs)("div",{children:[(0,n.jsx)(eD.default,{src:o||e,alt:"User Avatar",className:(0,r.default)("rounded-full",a,s),referrerPolicy:"no-referrer",width:t,height:t,onError:e=>{e.target.style.display="none",e.target.nextElementSibling?.classList.remove("invisible")}}),(0,n.jsx)("div",{className:"invisible absolute inset-0 flex items-center justify-center",children:(0,n.jsx)(l,{className:(0,r.default)("text-neutral-content",a)})})]}):(0,n.jsx)(l,{className:"text-neutral-content",size:t})})},eL=({quotas:e,showProgress:t,className:a,labelClassName:s})=>(0,n.jsx)("div",{className:(0,r.default)("text-base-content w-full rounded-md text-base sm:text-sm",a),children:e.map(e=>{let a=e.used/e.total*100,l="bg-green-500";return a>80?l="bg-red-500":a>50&&(l="bg-yellow-500"),(0,n.jsxs)("div",{className:(0,r.default)("relative w-full overflow-hidden rounded-md",t&&"bg-base-300"),children:[t&&(0,n.jsx)("div",{className:`absolute left-0 top-0 h-full ${l}`,style:{width:`${a}%`}}),(0,n.jsxs)("div",{className:(0,r.default)("relative flex items-center justify-between gap-4 p-2",s),children:[(0,n.jsx)("span",{className:"truncate",title:e.tooltip,children:e.name}),(0,n.jsxs)("div",{className:"text-right text-sm",children:[e.used," / ",e.total," ",e.unit]})]})]},e.name)})});var eF=e.i(549651);let eM=({setIsDropdownOpen:e})=>{let t=(0,S.useTranslation)(),a=(0,d.useRouter)(),{envConfig:s,appService:l}=(0,k.useEnv)(),{user:c}=(0,j.useAuth)(),{userProfilePlan:m,quotas:h}=((e=!1)=>{let t=(0,S.useTranslation)(),{token:a,user:s}=(0,j.useAuth)(),[l,n]=(0,i.useState)([]),[r,o]=(0,i.useState)(void 0);return(0,i.useEffect)(()=>{if(!s||!a)return;let l=(0,eC.getStoragePlanData)(a),r=l.quota>1e9,i={name:e?t("Storage"):t("Cloud Sync Storage"),tooltip:t("{{percentage}}% of Cloud Sync Space Used.",{percentage:Math.round(l.usage/l.quota*100)}),used:parseFloat((l.usage/1024/1024/(r?1024:1)).toFixed(2)),total:Math.round(l.quota/1024/1024/(r?1024:1)*10)/10,unit:r?"GB":"MB"},d=(0,eC.getTranslationPlanData)(a),c={name:e?t("Translation"):t("Translation Characters"),tooltip:t("{{percentage}}% of Daily Translation Characters Used.",{percentage:Math.round(d.usage/d.quota*100)}),used:Math.round(d.usage/1024),total:Math.round(d.quota/1024),unit:"K"};o((0,eC.getUserProfilePlan)(a)),n([i,c])},[a]),{quotas:l,userProfilePlan:r}})(!0),{themeMode:p,setThemeMode:x}=(0,N.useThemeStore)(),{settings:g,setSettingsDialogOpen:b}=(0,A.useSettingsStore)(),[v,w]=(0,i.useState)(g.autoUpload),[y,C]=(0,i.useState)(g.autoCheckUpdates),[B,P]=(0,i.useState)(g.alwaysOnTop),[L,F]=(0,i.useState)(g.alwaysShowStatusBar),[M,T]=(0,i.useState)(g.screenWakeLock),[I,R]=(0,i.useState)(g.openLastBooks),[U,O]=(0,i.useState)(g.autoImportBooksOnOpen),[_,z]=(0,i.useState)(g.telemetryEnabled),[V,H]=(0,i.useState)(g.alwaysInForeground),[Y,X]=(0,i.useState)(g.savedBookCoverForLockScreen||""),Z=(0,D.useResponsiveSize)(16),{stats:J,hasActiveTransfers:ee,setIsTransferQueueOpen:et}=(0,ep.useTransferQueue)(),ea=()=>{(0,u.navigateToProfile)(a),e?.(!1)},es=async()=>{if(!await G()&&l?.distChannel==="readest")return;let e=g.savedBookCoverForLockScreen?"":"default";if(e){let e=await (0,W.selectDirectory)();e.path&&(0,Q.saveSysSettings)(s,"savedBookCoverForLockScreenPath",e.path)}(0,Q.saveSysSettings)(s,"savedBookCoverForLockScreen",e),X(e)},el=async()=>{let e=!g.alwaysInForeground;if(e){let e=await (0,$.invoke)("plugin:native-tts|checkPermissions");if("granted"!==e.postNotification&&(e=await (0,$.invoke)("plugin:native-tts|requestPermissions",{permissions:["postNotification"]})),"granted"!==e.postNotification)return}(0,Q.saveSysSettings)(s,"alwaysInForeground",e),H(e)},en=c?.user_metadata?.picture||c?.user_metadata?.avatar_url,er=c?.user_metadata?.full_name,ei=er?er.split(" ")[0]:null,eo=t("dark"===p?"Dark Mode":"light"===p?"Light Mode":"Auto Mode"),ed=g.savedBookCoverForLockScreenPath,ec=ed?ed.split("/").pop():"Images",eu=`ðŸ’¾ ${ec}/last-book-cover.png`;return(0,n.jsxs)(eF.default,{className:(0,r.default)("settings-menu dropdown-content no-triangle","z-20 mt-2 max-w-[90vw] shadow-2xl"),onCancel:()=>e?.(!1),children:[c?(0,n.jsx)(em.default,{label:ei?t("Logged in as {{userDisplayName}}",{userDisplayName:ei}):t("Logged in"),labelClass:"!max-w-40","aria-label":t("View account details and quota"),Icon:en?(0,n.jsx)(eP,{url:en,size:Z,DefaultIcon:ev.PiUserCircleCheck}):ev.PiUserCircleCheck,children:(0,n.jsxs)("ul",{className:"flex flex-col",children:[(0,n.jsx)("button",{onClick:ea,className:"w-full",children:(0,n.jsx)(eL,{quotas:h,labelClassName:"h-10 pl-3 pr-2"})}),(0,n.jsx)(em.default,{label:t("Account"),noIcon:!0,onClick:ea})]})}):(0,n.jsx)(em.default,{label:t("Sign In"),Icon:ev.PiUserCircle,onClick:()=>{(0,u.navigateToLogin)(a),e?.(!1)}}),c&&(0,n.jsx)(em.default,{label:t("Cloud File Transfers"),Icon:o.MdCloudSync,description:ee?t("{{activeCount}} active, {{pendingCount}} pending",{activeCount:J.active,pendingCount:J.pending}):J.failed>0?t("{{failedCount}} failed",{failedCount:J.failed}):"",onClick:()=>{et(!0),e?.(!1)}}),(0,f.isTauriAppPlatform)()&&!l?.isMobile&&(0,n.jsx)(em.default,{label:t("Auto Import on File Open"),toggled:U,onClick:()=>{let e=!g.autoImportBooksOnOpen;(0,Q.saveSysSettings)(s,"autoImportBooksOnOpen",e),O(e)}}),(0,f.isTauriAppPlatform)()&&(0,n.jsx)(em.default,{label:t("Open Last Book on Start"),toggled:I,onClick:()=>{let e=!g.openLastBooks;(0,Q.saveSysSettings)(s,"openLastBooks",e),R(e)}}),l?.hasUpdater&&(0,n.jsx)(em.default,{label:t("Check Updates on Start"),toggled:y,onClick:()=>{let e=!g.autoCheckUpdates;(0,Q.saveSysSettings)(s,"autoCheckUpdates",e),C(e)}}),(0,n.jsx)("hr",{"aria-hidden":"true",className:"border-base-200 my-1"}),l?.hasWindow&&(0,n.jsx)(em.default,{label:t("Open Book in New Window"),toggled:g.openBookInNewWindow,onClick:()=>{(0,Q.saveSysSettings)(s,"openBookInNewWindow",!g.openBookInNewWindow),e?.(!1)}}),l?.hasWindow&&(0,n.jsx)(em.default,{label:t("Fullscreen"),onClick:()=>{(0,q.tauriHandleToggleFullScreen)(),e?.(!1)}}),l?.hasWindow&&(0,n.jsx)(em.default,{label:t("Always on Top"),toggled:B,onClick:()=>{let t=!g.alwaysOnTop;(0,Q.saveSysSettings)(s,"alwaysOnTop",t),P(t),(0,q.tauriHandleSetAlwaysOnTop)(t),e?.(!1)}}),l?.isMobileApp&&(0,n.jsx)(em.default,{label:t("Always Show Status Bar"),toggled:L,onClick:()=>{let e=!g.alwaysShowStatusBar;(0,Q.saveSysSettings)(s,"alwaysShowStatusBar",e),F(e)}}),(0,n.jsx)(em.default,{label:t("Keep Screen Awake"),toggled:M,onClick:()=>{let e=!g.screenWakeLock;(0,Q.saveSysSettings)(s,"screenWakeLock",e),T(e)}}),l?.isAndroidApp&&(0,n.jsx)(em.default,{label:t(t("Background Read Aloud")),toggled:V,onClick:el}),(0,n.jsx)(em.default,{label:t("Reload Page"),onClick:()=>{window.location.reload(),e?.(!1)}}),(0,n.jsx)(em.default,{label:eo,Icon:"dark"===p?ev.PiMoon:"light"===p?ev.PiSun:eS.TbSunMoon,onClick:()=>{x("auto"===p?"light":"light"===p?"dark":"auto")}}),(0,n.jsx)(em.default,{label:t("Settings"),Icon:ev.PiGear,onClick:()=>{e?.(!1),b(!0)}}),l?.canCustomizeRootDir&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("hr",{"aria-hidden":"true",className:"border-base-200 my-1"}),(0,n.jsx)(em.default,{label:t("Advanced Settings"),children:(0,n.jsxs)("ul",{className:"flex flex-col",children:[(0,n.jsx)(em.default,{label:t("Change Data Location"),noIcon:!l?.isAndroidApp,onClick:()=>{let t=document.getElementById("migrate_data_dir_window");if(t){let e=new CustomEvent("setDialogVisibility",{detail:{visible:!0}});t.dispatchEvent(e)}e?.(!1)}}),l?.isAndroidApp&&l?.distChannel!=="playstore"&&(0,n.jsx)(em.default,{label:t("Save Book Cover"),tooltip:t("Auto-save last book cover"),description:Y?eu:"",toggled:!!Y,onClick:es})]})})]}),(0,n.jsx)("hr",{"aria-hidden":"true",className:"border-base-200 my-1"}),c&&"free"===m&&(0,n.jsx)(em.default,{label:t("Upgrade to Readest Premium"),onClick:()=>{(0,u.navigateToProfile)(a),e?.(!1)}}),(0,f.isWebAppPlatform)()&&(0,n.jsx)(em.default,{label:t("Download Readest"),onClick:()=>{window.open(E.DOWNLOAD_READEST_URL,"_blank"),e?.(!1)}}),(0,n.jsx)(em.default,{label:t("About Readest"),onClick:()=>{(0,K.setAboutDialogVisible)(!0),e?.(!1)}}),(0,n.jsx)(em.default,{label:t("Help improve Readest"),description:_?t("Sharing anonymized statistics"):"",toggled:_,onClick:()=>{let e=!g.telemetryEnabled;(0,Q.saveSysSettings)(s,"telemetryEnabled",e),z(e),e?(0,eA.optInTelemetry)():(0,eA.optOutTelemetry)()}})]})},eT=({setIsDropdownOpen:e,onImportBooksFromFiles:t,onImportBooksFromDirectory:a,onOpenCatalogManager:s})=>{let l=(0,S.useTranslation)();return(0,n.jsxs)(eF.default,{className:(0,r.default)("dropdown-content bg-base-100 rounded-box z-[1] mt-3 p-2 shadow"),onCancel:()=>e?.(!1),children:[(0,n.jsx)(em.default,{label:l("From Local File"),Icon:(0,n.jsx)(Y.IoFileTray,{className:"h-5 w-5"}),onClick:()=>{t(),e?.(!1)}}),a&&(0,n.jsx)(em.default,{label:l("From Directory"),Icon:(0,n.jsx)(Y.IoFileTray,{className:"h-5 w-5"}),onClick:()=>{a?.(),e?.(!1)}}),(0,n.jsx)(em.default,{label:l("Online Library"),Icon:(0,n.jsx)(o.MdRssFeed,{className:"h-5 w-5"}),onClick:()=>{s(),e?.(!1)}})]})};var eI=e.i(418521);let eE=({setIsDropdownOpen:e})=>{let t=(0,S.useTranslation)(),a=(0,d.useRouter)(),s=(0,d.useSearchParams)(),{envConfig:l}=(0,k.useEnv)(),{settings:r}=(0,A.useSettingsStore)(),i=r.libraryViewMode,o=r.librarySortBy,c=r.librarySortAscending,m=r.libraryCoverFit,h=r.libraryAutoColumns,p=r.libraryColumns,x=[{label:t("List"),value:"list"},{label:t("Grid"),value:"grid"}],g=[{label:t("Crop"),value:"crop"},{label:t("Fit"),value:"fit"}],b=[{label:t("Title"),value:"title"},{label:t("Author"),value:"author"},{label:t("Format"),value:"format"},{label:t("Date Read"),value:"updated"},{label:t("Date Added"),value:"created"},{label:t("Date Published"),value:"published"}],f=[{label:t("Ascending"),value:!0},{label:t("Descending"),value:!1}],v=async t=>{await (0,Q.saveSysSettings)(l,"libraryViewMode",t),e?.(!1);let n=new URLSearchParams(s?.toString());n.set("view",t),(0,u.navigateToLibrary)(a,`${n.toString()}`)},w=async t=>{await (0,Q.saveSysSettings)(l,"libraryCoverFit",t),e?.(!1);let n=new URLSearchParams(s?.toString());n.set("cover",t),(0,u.navigateToLibrary)(a,`${n.toString()}`)},y=async()=>{let e=!r.libraryAutoColumns;await (0,Q.saveSysSettings)(l,"libraryAutoColumns",e)},j=async e=>{await (0,Q.saveSysSettings)(l,"libraryColumns",e),await (0,Q.saveSysSettings)(l,"libraryAutoColumns",!1)},N=async t=>{await (0,Q.saveSysSettings)(l,"librarySortBy",t),e?.(!1);let n=new URLSearchParams(s?.toString());n.set("sort",t),(0,u.navigateToLibrary)(a,`${n.toString()}`)},C=async t=>{await (0,Q.saveSysSettings)(l,"librarySortAscending",t),e?.(!1);let n=new URLSearchParams(s?.toString());n.set("order",t?"asc":"desc"),(0,u.navigateToLibrary)(a,`${n.toString()}`)};return(0,n.jsxs)(eF.default,{className:"view-menu dropdown-content no-triangle z-20 mt-2 shadow-2xl",onCancel:()=>e?.(!1),children:[x.map(e=>(0,n.jsx)(em.default,{label:e.label,buttonClass:"h-8",toggled:i===e.value,onClick:()=>v(e.value)},e.value)),(0,n.jsx)("hr",{"aria-hidden":"true",className:"border-base-200 my-1"}),(0,n.jsx)(em.default,{label:t("Columns"),buttonClass:"h-8",labelClass:"text-sm sm:text-xs",disabled:!0}),(0,n.jsx)(em.default,{label:t("Auto"),buttonClass:"h-10",toggled:h,disabled:"list"===i,siblings:(0,n.jsx)(eI.default,{className:"!h-10 !p-0 !pe-1 !ps-0",inputClassName:`!p-0 text-center text-base sm:text-sm !w-10 !h-6 !pe-0 ${h?"opacity-50":""}`,label:"",value:p,disabled:"list"===i,onChange:j,min:window.innerWidth<640?1:window.innerWidth<1024?2:3,max:window.innerWidth<640?4:window.innerWidth<1024?6:12}),onClick:()=>y()}),(0,n.jsx)("hr",{"aria-hidden":"true",className:"border-base-200 my-1"}),(0,n.jsx)(em.default,{label:t("Book Covers"),buttonClass:"h-8",labelClass:"text-sm sm:text-xs",disabled:!0}),g.map(e=>(0,n.jsx)(em.default,{label:e.label,buttonClass:"h-8",toggled:m===e.value,onClick:()=>w(e.value)},e.value)),(0,n.jsx)("hr",{"aria-hidden":"true",className:"border-base-200 my-1"}),(0,n.jsx)(em.default,{label:t("Sort by..."),buttonClass:"h-8",labelClass:"text-sm sm:text-xs",disabled:!0}),b.map(e=>(0,n.jsx)(em.default,{label:e.label,buttonClass:"h-8",toggled:o===e.value,onClick:()=>N(e.value)},e.value)),(0,n.jsx)("hr",{"aria-hidden":"true",className:"border-base-200 my-1"}),f.map(e=>(0,n.jsx)(em.default,{label:e.label,buttonClass:"h-8",toggled:c===e.value,onClick:()=>C(e.value)},e.value.toString()))]})};var eR=e.i(326066),eU=e.i(769217);let eO=()=>{let e=(0,S.useTranslation)(),{envConfig:t}=(0,k.useEnv)(),{library:a,updateBooks:s}=(0,C.useLibraryStore)(),[l,r]=(0,i.useState)(!1),o=async()=>{if(!l){r(!0),await h.eventDispatcher.dispatch("toast",{type:"info",timeout:0,message:e("Scanning books directory...")});try{console.log("[ScanBooks] 1. Starting scan books process");let l=await t.getAppService(),n=await (0,eU.scanBooks)();if(console.log("[ScanBooks] 2. Scan completed, found",n.count,"books:",n.books?.map(e=>e.relativePath)),0===n.count)return void h.eventDispatcher.dispatch("toast",{type:"success",timeout:3e3,message:e("No new books found")});let r=[],i=[],o=new Set(a.map(e=>e.hash));console.log("[ScanBooks] 3. Current library has",a.length,"books"),console.log("[ScanBooks] 4. Found",n.books.length,"books to process");let d=[];for(let t of n.books)try{console.log("[ScanBooks] 5. Processing book:",t.relativePath);let e=t.relativePath.split("/").slice(0,-1).join("/")||"",s=t.filePath;console.log("[ScanBooks] 6. Calling importBook with:",{sourcePath:s,relativePath:t.relativePath,groupName:e});let n=await l.importBook(s,a,!1,!0,!1,!0,{targetRelativePath:t.relativePath,targetGroupName:e});if(n){let e=!o.has(n.hash);if(console.log("[ScanBooks] 7. Book hash:",n.hash,"isNew:",e),e)r.push(n),i.push(n);else{let e=a.find(e=>e.hash===n.hash);if(e&&e.relativePath&&e.relativePath!==t.relativePath){console.log("[ScanBooks] Book moved: from",e.relativePath,"to",t.relativePath);try{let t=(0,m.getCoverFilename)(e),a=(0,m.getCoverFilename)(n);if(t!==a&&await l.exists(t,"Books")){console.log("[ScanBooks] Moving cover from:",t,"to:",a);let e=await l.openFile(t,"Books");await l.writeFile(a,"Books",e),await l.deleteFile(t,"Books"),console.log("[ScanBooks] âœ“ Cover moved successfully")}let s=(0,m.getConfigFilename)(e),r=(0,m.getConfigFilename)(n);if(s!==r&&await l.exists(s,"Books")){console.log("[ScanBooks] Moving config from:",s,"to:",r);let e=await l.readFile(s,"Books","text");await l.writeFile(r,"Books",e),await l.deleteFile(s,"Books"),console.log("[ScanBooks] âœ“ Config moved successfully")}let i=e.relativePath.replace(/\.[^.]+$/,"");try{let e=await l.readDirectory(i,"Books");0===e.length&&(await l.deleteDir(i,"Books",!0),console.log("[ScanBooks] âœ“ Old directory removed"))}catch(e){console.log("[ScanBooks] Old directory still contains files or cannot be deleted")}}catch(e){console.warn("[ScanBooks] Failed to move metadata files:",e)}e.relativePath=t.relativePath}}}}catch(s){let a=s?.message||"Unknown error";console.error("[ScanBooks] Error importing book:",t.relativePath,s),d.push({name:t.fileName,error:a}),h.eventDispatcher.dispatch("toast",{type:"error",timeout:4e3,message:e('Failed to import "{{name}}": {{error}}',{name:t.fileName,error:a})})}if(console.log("[ScanBooks] 8. Imported",r.length,"books,",i.length,"are new,",d.length,"failed"),r.length>0){if(await s(t,r),i.length>0){let t=i.map(e=>e.title).join(", "),a=1===i.length?e("Found 1 new book: {{title}}",{title:t}):e("Found {{count}} new books: {{titles}}",{count:i.length,titles:t});h.eventDispatcher.dispatch("toast",{type:"success",timeout:5e3,message:a})}else h.eventDispatcher.dispatch("toast",{type:"info",timeout:3e3,message:e("No new books found, library has {{count}} book(s)",{count:a.length})});if(d.length>0&&d.length<=3){let t=d.map(e=>e.name).join(", ");h.eventDispatcher.dispatch("toast",{type:"warning",timeout:6e3,message:e("Failed to import {{count}} book(s): {{names}}",{count:d.length,names:t})})}else d.length>3&&h.eventDispatcher.dispatch("toast",{type:"warning",timeout:6e3,message:e("Failed to import {{count}} books. Check console for details.",{count:d.length})})}else d.length>0?h.eventDispatcher.dispatch("toast",{type:"error",timeout:5e3,message:e("All {{count}} book(s) failed to import. Check console for details.",{count:d.length})}):h.eventDispatcher.dispatch("toast",{type:"info",timeout:3e3,message:e("No books found in directory")})}catch(t){console.error("[Scan] Error:",t),h.eventDispatcher.dispatch("toast",{type:"error",timeout:5e3,message:e("Failed to scan books: {{error}}",{error:t?.message||"Unknown error"})})}finally{r(!1)}}};return(0,n.jsxs)("button",{onClick:o,disabled:l,className:"btn btn-ghost btn-sm gap-2","aria-label":e("Scan books directory"),title:e("Scan books directory for new files"),children:[(0,n.jsx)(eR.BiScan,{className:l?"animate-spin":"",size:18}),e("Scan Books")]})},e_=({isSelectMode:e,isSelectAll:t,onImportBooksFromFiles:a,onImportBooksFromDirectory:s,onOpenCatalogManager:l,onToggleSelectMode:c,onSelectAll:u,onDeselectAll:m,onReconcilePaths:h})=>{let p=(0,S.useTranslation)(),x=(0,d.useRouter)(),g=(0,d.useSearchParams)(),{appService:b}=(0,k.useEnv)(),{systemUIVisible:v,statusBarHeight:w}=(0,N.useThemeStore)(),{currentBookshelf:y}=(0,C.useLibraryStore)(),{isTrafficLightVisible:j}=(0,ey.useTrafficLight)(),[A,B]=(0,i.useState)(g?.get("q")??""),P=(0,i.useRef)(null),L=(0,D.useResponsiveSize)(18),{safeAreaInsets:F}=(0,N.useThemeStore)();(0,ej.default)({onToggleSelectMode:c});let M=(0,i.useCallback)((0,ek.debounce)(e=>{let t=new URLSearchParams(g?.toString());e?t.set("q",e):t.delete("q"),x.push(`?${t.toString()}`)},500),[g]),T=b?.hasWindowBar&&!j,I=y.reduce((e,t)=>e+("books"in t?t.books.length:1),0);if(!F)return null;let E=b?.isMobile||window.innerWidth<=640;return(0,n.jsx)("div",{ref:P,className:(0,r.default)("titlebar z-10 flex h-[52px] w-full items-center py-2 pr-4 sm:h-[48px]",T?"sm:pr-4":"sm:pr-6",j?"pl-16":"pl-0 sm:pl-2"),style:{marginTop:b?.hasSafeAreaInset?`max(${F.top}px, ${v?w:0}px)`:"0px"},children:(0,n.jsxs)("div",{className:"flex w-full items-center justify-between space-x-6 sm:space-x-12",children:[(0,n.jsxs)("div",{className:"exclude-title-bar-mousedown relative flex w-full items-center pl-4",children:[(0,n.jsxs)("div",{className:"relative flex h-9 w-full items-center sm:h-7",children:[(0,n.jsx)("span",{className:"text-base-content/50 absolute ps-3",children:(0,n.jsx)(ef.FaSearch,{className:"h-4 w-4"})}),(0,n.jsx)("input",{type:"text",value:A,placeholder:I>1?p("Search in {{count}} Book(s)...",{count:I}):p("Search Books..."),onChange:e=>{let t=e.target.value;B(t),M(t)},spellCheck:"false",className:(0,r.default)("search-input input h-9 w-full rounded-full pr-[30%] ps-10 sm:h-7","bg-base-300/45 border-0","font-sans text-sm font-light","placeholder:text-base-content/50 truncate","focus:outline-none focus:ring-0")})]}),(0,n.jsxs)("div",{className:"text-base-content/50 absolute right-4 flex items-center space-x-2 sm:space-x-4",children:[A&&(0,n.jsx)("button",{type:"button",onClick:()=>{B(""),M("")},className:"text-base-content/40 hover:text-base-content/60 pe-1","aria-label":p("Clear Search"),children:(0,n.jsx)(ew.IoMdCloseCircle,{className:"h-4 w-4"})}),(0,n.jsx)("span",{className:"bg-base-content/50 mx-2 h-4 w-[0.5px]"}),(0,n.jsx)(eu.default,{label:p("Import Books"),className:(0,r.default)("exclude-title-bar-mousedown dropdown-bottom dropdown-center flex h-6 cursor-pointer justify-center"),buttonClassName:"p-0 h-6 min-h-6 w-6 flex touch-target items-center justify-center !bg-transparent",toggleButton:(0,n.jsx)(ev.PiPlus,{role:"none",className:"m-0.5 h-5 w-5"}),children:(0,n.jsx)(eT,{onImportBooksFromFiles:a,onImportBooksFromDirectory:s,onOpenCatalogManager:l})}),E?null:(0,n.jsx)("button",{onClick:c,"aria-label":p("Select Books"),title:p("Select Books"),className:"h-6",children:e?(0,n.jsx)(ev.PiSelectionAllFill,{role:"button",className:"text-base-content/60 h-6 w-6"}):(0,n.jsx)(ev.PiSelectionAll,{role:"button",className:"text-base-content/60 h-6 w-6"})})]})]}),e?(0,n.jsx)("div",{className:(0,r.default)("flex h-full items-center","w-max-[72px] w-min-[72px] sm:w-max-[80px] sm:w-min-[80px]"),children:(0,n.jsx)("button",{onClick:t?m:u,className:"btn btn-ghost text-base-content/85 h-8 min-h-8 w-[72px] p-0 sm:w-[80px]","aria-label":p(t?"Deselect":"Select All"),children:(0,n.jsx)("span",{className:"font-sans text-base font-normal sm:text-sm",children:p(t?"Deselect":"Select All")})})}):(0,n.jsxs)("div",{className:"flex h-full items-center gap-x-2 sm:gap-x-4",children:[(0,f.isWebAppPlatform)()&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(eO,{}),h&&(0,n.jsx)("button",{onClick:h,className:"btn btn-ghost h-8 min-h-8 px-2",title:"æ ¡å‡†ä¹¦ç±è·¯å¾„",children:(0,n.jsx)("span",{className:"text-xs",children:"æ ¡å‡†"})})]}),(0,n.jsx)(eu.default,{label:p("View Menu"),className:"exclude-title-bar-mousedown dropdown-bottom dropdown-end",buttonClassName:"btn btn-ghost h-8 min-h-8 w-8 p-0",toggleButton:(0,n.jsx)(ev.PiDotsThreeCircle,{role:"none",size:L}),children:(0,n.jsx)(eE,{})}),(0,n.jsx)(eu.default,{label:p("Settings Menu"),className:"exclude-title-bar-mousedown dropdown-bottom dropdown-end",buttonClassName:"btn btn-ghost h-8 min-h-8 w-8 p-0",toggleButton:(0,n.jsx)(o.MdOutlineMenu,{role:"none",size:L}),children:(0,n.jsx)(eM,{})}),b?.hasWindowBar&&(0,n.jsx)(eN.default,{headerRef:P,showMinimize:T,showMaximize:T,showClose:T})]})]})})};var ez=e.i(621081),eW=e.i(427972),e$=e.i(325365),eG=$,eq=e.i(25011);async function eK(e,t){let a=new eG.Channel;return t&&"object"==typeof t&&("action"in t&&t.action&&(a.onmessage=t.action,delete t.action),"item"in t&&t.item&&"object"==typeof t.item&&"About"in t.item&&t.item.About&&"object"==typeof t.item.About&&"icon"in t.item.About&&t.item.About.icon&&(t.item.About.icon=(0,eq.transformImage)(t.item.About.icon)),"icon"in t&&t.icon&&(t.icon=(0,eq.transformImage)(t.icon)),"items"in t&&t.items&&(t.items=t.items.map(function e(t){var a;return"rid"in t?[t.rid,t.kind]:("item"in t&&"object"==typeof t.item&&(null==(a=t.item.About)?void 0:a.icon)&&(t.item.About.icon=(0,eq.transformImage)(t.item.About.icon)),"icon"in t&&t.icon&&(t.icon=(0,eq.transformImage)(t.icon)),"items"in t&&t.items&&(t.items=t.items.map(e)),function e(t){var a;if("items"in t)t.items=null==(a=t.items)?void 0:a.map(t=>"rid"in t?t:e(t));else if("action"in t&&t.action){let e=new eG.Channel;return e.onmessage=t.action,delete t.action,{...t,handler:e}}return t}(t))}))),(0,eG.invoke)("plugin:menu|new",{kind:e,options:t,handler:a})}class eV extends eG.Resource{get id(){return(0,e$.__classPrivateFieldGet)(this,a,"f")}get kind(){return(0,e$.__classPrivateFieldGet)(this,s,"f")}constructor(e,t,l){super(e),a.set(this,void 0),s.set(this,void 0),(0,e$.__classPrivateFieldSet)(this,a,t,"f"),(0,e$.__classPrivateFieldSet)(this,s,l,"f")}}a=new WeakMap,s=new WeakMap;class eH extends eV{constructor(e,t){super(e,t,"MenuItem")}static async new(e){return eK("MenuItem",e).then(([e,t])=>new eH(e,t))}async text(){return(0,$.invoke)("plugin:menu|text",{rid:this.rid,kind:this.kind})}async setText(e){return(0,$.invoke)("plugin:menu|set_text",{rid:this.rid,kind:this.kind,text:e})}async isEnabled(){return(0,$.invoke)("plugin:menu|is_enabled",{rid:this.rid,kind:this.kind})}async setEnabled(e){return(0,$.invoke)("plugin:menu|set_enabled",{rid:this.rid,kind:this.kind,enabled:e})}async setAccelerator(e){return(0,$.invoke)("plugin:menu|set_accelerator",{rid:this.rid,kind:this.kind,accelerator:e})}}class eY extends eV{constructor(e,t){super(e,t,"Check")}static async new(e){return eK("Check",e).then(([e,t])=>new eY(e,t))}async text(){return(0,$.invoke)("plugin:menu|text",{rid:this.rid,kind:this.kind})}async setText(e){return(0,$.invoke)("plugin:menu|set_text",{rid:this.rid,kind:this.kind,text:e})}async isEnabled(){return(0,$.invoke)("plugin:menu|is_enabled",{rid:this.rid,kind:this.kind})}async setEnabled(e){return(0,$.invoke)("plugin:menu|set_enabled",{rid:this.rid,kind:this.kind,enabled:e})}async setAccelerator(e){return(0,$.invoke)("plugin:menu|set_accelerator",{rid:this.rid,kind:this.kind,accelerator:e})}async isChecked(){return(0,$.invoke)("plugin:menu|is_checked",{rid:this.rid})}async setChecked(e){return(0,$.invoke)("plugin:menu|set_checked",{rid:this.rid,checked:e})}}(t=l||(l={})).Add="Add",t.Advanced="Advanced",t.Bluetooth="Bluetooth",t.Bookmarks="Bookmarks",t.Caution="Caution",t.ColorPanel="ColorPanel",t.ColumnView="ColumnView",t.Computer="Computer",t.EnterFullScreen="EnterFullScreen",t.Everyone="Everyone",t.ExitFullScreen="ExitFullScreen",t.FlowView="FlowView",t.Folder="Folder",t.FolderBurnable="FolderBurnable",t.FolderSmart="FolderSmart",t.FollowLinkFreestanding="FollowLinkFreestanding",t.FontPanel="FontPanel",t.GoLeft="GoLeft",t.GoRight="GoRight",t.Home="Home",t.IChatTheater="IChatTheater",t.IconView="IconView",t.Info="Info",t.InvalidDataFreestanding="InvalidDataFreestanding",t.LeftFacingTriangle="LeftFacingTriangle",t.ListView="ListView",t.LockLocked="LockLocked",t.LockUnlocked="LockUnlocked",t.MenuMixedState="MenuMixedState",t.MenuOnState="MenuOnState",t.MobileMe="MobileMe",t.MultipleDocuments="MultipleDocuments",t.Network="Network",t.Path="Path",t.PreferencesGeneral="PreferencesGeneral",t.QuickLook="QuickLook",t.RefreshFreestanding="RefreshFreestanding",t.Refresh="Refresh",t.Remove="Remove",t.RevealFreestanding="RevealFreestanding",t.RightFacingTriangle="RightFacingTriangle",t.Share="Share",t.Slideshow="Slideshow",t.SmartBadge="SmartBadge",t.StatusAvailable="StatusAvailable",t.StatusNone="StatusNone",t.StatusPartiallyAvailable="StatusPartiallyAvailable",t.StatusUnavailable="StatusUnavailable",t.StopProgressFreestanding="StopProgressFreestanding",t.StopProgress="StopProgress",t.TrashEmpty="TrashEmpty",t.TrashFull="TrashFull",t.User="User",t.UserAccounts="UserAccounts",t.UserGroup="UserGroup",t.UserGuest="UserGuest";class eQ extends eV{constructor(e,t){super(e,t,"Icon")}static async new(e){return eK("Icon",e).then(([e,t])=>new eQ(e,t))}async text(){return(0,$.invoke)("plugin:menu|text",{rid:this.rid,kind:this.kind})}async setText(e){return(0,$.invoke)("plugin:menu|set_text",{rid:this.rid,kind:this.kind,text:e})}async isEnabled(){return(0,$.invoke)("plugin:menu|is_enabled",{rid:this.rid,kind:this.kind})}async setEnabled(e){return(0,$.invoke)("plugin:menu|set_enabled",{rid:this.rid,kind:this.kind,enabled:e})}async setAccelerator(e){return(0,$.invoke)("plugin:menu|set_accelerator",{rid:this.rid,kind:this.kind,accelerator:e})}async setIcon(e){return(0,$.invoke)("plugin:menu|set_icon",{rid:this.rid,kind:this.kind,icon:(0,eq.transformImage)(e)})}}class eX extends eV{constructor(e,t){super(e,t,"Predefined")}static async new(e){return eK("Predefined",e).then(([e,t])=>new eX(e,t))}async text(){return(0,$.invoke)("plugin:menu|text",{rid:this.rid,kind:this.kind})}async setText(e){return(0,$.invoke)("plugin:menu|set_text",{rid:this.rid,kind:this.kind,text:e})}}var eZ=e.i(650047);function eJ([e,t,a]){switch(a){case"Submenu":return new e0(e,t);case"Predefined":return new eX(e,t);case"Check":return new eY(e,t);case"Icon":return new eQ(e,t);default:return new eH(e,t)}}class e0 extends eV{constructor(e,t){super(e,t,"Submenu")}static async new(e){return eK("Submenu",e).then(([e,t])=>new e0(e,t))}async text(){return(0,$.invoke)("plugin:menu|text",{rid:this.rid,kind:this.kind})}async setText(e){return(0,$.invoke)("plugin:menu|set_text",{rid:this.rid,kind:this.kind,text:e})}async isEnabled(){return(0,$.invoke)("plugin:menu|is_enabled",{rid:this.rid,kind:this.kind})}async setEnabled(e){return(0,$.invoke)("plugin:menu|set_enabled",{rid:this.rid,kind:this.kind,enabled:e})}async append(e){return(0,$.invoke)("plugin:menu|append",{rid:this.rid,kind:this.kind,items:(Array.isArray(e)?e:[e]).map(e=>"rid"in e?[e.rid,e.kind]:e)})}async prepend(e){return(0,$.invoke)("plugin:menu|prepend",{rid:this.rid,kind:this.kind,items:(Array.isArray(e)?e:[e]).map(e=>"rid"in e?[e.rid,e.kind]:e)})}async insert(e,t){return(0,$.invoke)("plugin:menu|insert",{rid:this.rid,kind:this.kind,items:(Array.isArray(e)?e:[e]).map(e=>"rid"in e?[e.rid,e.kind]:e),position:t})}async remove(e){return(0,$.invoke)("plugin:menu|remove",{rid:this.rid,kind:this.kind,item:[e.rid,e.kind]})}async removeAt(e){return(0,$.invoke)("plugin:menu|remove_at",{rid:this.rid,kind:this.kind,position:e}).then(eJ)}async items(){return(0,$.invoke)("plugin:menu|items",{rid:this.rid,kind:this.kind}).then(e=>e.map(eJ))}async get(e){return(0,$.invoke)("plugin:menu|get",{rid:this.rid,kind:this.kind,id:e}).then(e=>e?eJ(e):null)}async popup(e,t){var a;return(0,$.invoke)("plugin:menu|popup",{rid:this.rid,kind:this.kind,window:null!=(a=null==t?void 0:t.label)?a:null,at:e instanceof eZ.Position?e:e?new eZ.Position(e):null})}async setAsWindowsMenuForNSApp(){return(0,$.invoke)("plugin:menu|set_as_windows_menu_for_nsapp",{rid:this.rid})}async setAsHelpMenuForNSApp(){return(0,$.invoke)("plugin:menu|set_as_help_menu_for_nsapp",{rid:this.rid})}async setIcon(e){return(0,$.invoke)("plugin:menu|set_icon",{rid:this.rid,kind:this.kind,icon:(0,eq.transformImage)(e)})}}class e1 extends eV{constructor(e,t){super(e,t,"Menu")}static async new(e){return eK("Menu",e).then(([e,t])=>new e1(e,t))}static async default(){return(0,$.invoke)("plugin:menu|create_default").then(([e,t])=>new e1(e,t))}async append(e){return(0,$.invoke)("plugin:menu|append",{rid:this.rid,kind:this.kind,items:(Array.isArray(e)?e:[e]).map(e=>"rid"in e?[e.rid,e.kind]:e)})}async prepend(e){return(0,$.invoke)("plugin:menu|prepend",{rid:this.rid,kind:this.kind,items:(Array.isArray(e)?e:[e]).map(e=>"rid"in e?[e.rid,e.kind]:e)})}async insert(e,t){return(0,$.invoke)("plugin:menu|insert",{rid:this.rid,kind:this.kind,items:(Array.isArray(e)?e:[e]).map(e=>"rid"in e?[e.rid,e.kind]:e),position:t})}async remove(e){return(0,$.invoke)("plugin:menu|remove",{rid:this.rid,kind:this.kind,item:[e.rid,e.kind]})}async removeAt(e){return(0,$.invoke)("plugin:menu|remove_at",{rid:this.rid,kind:this.kind,position:e}).then(eJ)}async items(){return(0,$.invoke)("plugin:menu|items",{rid:this.rid,kind:this.kind}).then(e=>e.map(eJ))}async get(e){return(0,$.invoke)("plugin:menu|get",{rid:this.rid,kind:this.kind,id:e}).then(e=>e?eJ(e):null)}async popup(e,t){var a;return(0,$.invoke)("plugin:menu|popup",{rid:this.rid,kind:this.kind,window:null!=(a=null==t?void 0:t.label)?a:null,at:e instanceof eZ.Position?e:e?new eZ.Position(e):null})}async setAsAppMenu(){return(0,$.invoke)("plugin:menu|set_as_app_menu",{rid:this.rid}).then(e=>e?new e1(e[0],e[1]):null)}async setAsWindowMenu(e){var t;return(0,$.invoke)("plugin:menu|set_as_window_menu",{rid:this.rid,window:null!=(t=null==e?void 0:e.label)?t:null}).then(e=>e?new e1(e[0],e[1]):null)}}var e2=e.i(431263),e4=e.i(784178);let e5=(0,i.memo)(({book:e})=>{let t=(0,i.useMemo)(()=>e.progress&&e.progress[1]?e.progress&&1===e.progress[1]?100:Math.max(0,Math.min(100,Math.round(e.progress[0]/e.progress[1]*100))):null,[e]);return null===t||Number.isNaN(t)?null:(0,n.jsx)("div",{className:"text-neutral-content/70 flex justify-between text-xs",role:"status","aria-label":`${t}%`,children:(0,n.jsxs)("span",{children:[t,"%"]})})},(e,t)=>e.book.hash===t.book.hash&&e.book.updatedAt===t.book.updatedAt);e5.displayName="ReadingProgress";var e3=e.i(534736);let e6=({book:e,mode:t,coverFit:a,isSelectMode:s,bookSelected:l,transferProgress:i,handleBookUpload:c,handleBookDownload:h,showBookDetailsModal:p})=>{let x=(0,S.useTranslation)(),g=(0,d.useRouter)(),{user:b}=(0,j.useAuth)(),{appService:f}=(0,k.useEnv)(),v=(0,D.useResponsiveSize)(15);return(0,n.jsxs)("div",{role:"none",className:(0,r.default)("book-item flex","grid"===t&&"h-full flex-col justify-end","list"===t&&"h-28 flex-row gap-4 overflow-hidden","list"===t?"library-list-item":"library-grid-item",f?.hasContextMenu?"cursor-pointer":""),onClick:e=>e.stopPropagation(),children:[(0,n.jsxs)("div",{className:(0,r.default)("bookitem-main relative flex aspect-[28/41] justify-center rounded","crop"===a&&"overflow-hidden shadow-md","grid"===t&&"items-end","list"===t&&"min-w-20 items-center"),children:[(0,n.jsx)(e3.default,{mode:t,book:e,coverFit:a,showSpine:!1,imageClassName:"rounded shadow-md"}),l&&(0,n.jsx)("div",{className:"absolute inset-0 bg-black opacity-30 transition-opacity duration-300"}),s&&(0,n.jsx)("div",{className:"absolute bottom-1 right-1",children:l?(0,n.jsx)(o.MdCheckCircle,{className:"fill-blue-500"}):(0,n.jsx)(o.MdCheckCircleOutline,{className:"fill-gray-300 drop-shadow-sm"})})]}),(0,n.jsxs)("div",{className:(0,r.default)("flex w-full flex-col p-0","grid"===t&&"pt-2","list"===t&&"gap-2 py-0"),children:[(0,n.jsxs)("div",{className:(0,r.default)("min-w-0 flex-1","list"===t&&"flex flex-col gap-2"),children:[(0,n.jsx)("h4",{className:(0,r.default)("overflow-hidden text-ellipsis font-semibold","grid"===t&&"block whitespace-nowrap text-[0.6em] text-xs","list"===t&&"line-clamp-2 text-base"),children:e.title}),"list"===t&&(0,n.jsx)("p",{className:"text-neutral-content line-clamp-1 text-sm",children:(0,m.formatAuthors)(e.author,e.primaryLanguage)||""})]}),"list"===t&&(0,n.jsx)("h4",{className:"text-neutral-content line-clamp-1 text-sm",children:(0,m.formatDescription)(e.metadata?.description)}),(0,n.jsxs)("div",{className:(0,r.default)("flex items-center",e.progress?"justify-between":"justify-end"),style:{height:`${v}px`,minHeight:`${v}px`},children:[e.progress&&(0,n.jsx)(e5,{book:e}),(0,n.jsxs)("div",{className:"flex items-center justify-center gap-x-2",children:[!f?.isMobile&&(0,n.jsx)("button",{"aria-label":x("Show Book Details"),className:"show-detail-button -m-2 p-2 sm:opacity-0 sm:group-hover:opacity-100",onPointerDown:e=>e.stopPropagation(),onClick:()=>{p(e)},children:(0,n.jsx)("div",{className:"pt-[2px] sm:pt-[1px]",children:(0,n.jsx)(e4.LiaInfoCircleSolid,{size:v})})}),null!==i?100===i?null:(0,n.jsx)("div",{className:"radial-progress",style:{"--value":i,"--size":`${v}px`,"--thickness":"2px"},role:"progressbar"}):(!e.uploadedAt||e.uploadedAt&&!e.downloadedAt)&&(0,n.jsxs)("button",{className:"show-cloud-button -m-2 p-2",onPointerDown:e=>e.stopPropagation(),onClick:()=>{b?e.uploadedAt?e.downloadedAt||h(e,{queued:!0}):c(e):(0,u.navigateToLogin)(g)},children:[!e.uploadedAt&&(0,n.jsx)(e4.LiaCloudUploadAltSolid,{size:v}),e.uploadedAt&&!e.downloadedAt&&(0,n.jsx)(e4.LiaCloudDownloadAltSolid,{size:v})]})]})]})]})]})},e8=({mode:e,group:t,isSelectMode:a,groupSelected:s})=>{let{appService:l}=(0,k.useEnv)(),d=(0,D.useResponsiveSize)(15),c=(0,i.useRef)(null),[u,m]=(0,i.useState)(!1),[h,p]=(0,i.useState)(!1),x=()=>{if("list"===e&&c.current){let e=c.current;if(e.scrollWidth>e.clientWidth){let t=e.scrollLeft<=5,a=e.scrollLeft>=e.scrollWidth-e.clientWidth-5;m(!t),p(!a)}else m(!1),p(!1)}else m(!1),p(!1)};(0,i.useEffect)(()=>{if(x(),"list"===e&&c.current){let e=c.current;setTimeout(()=>{e.style.transform="translateZ(0)",e.scrollLeft=0},0)}},[e,t.books.length,c.current]);let g=e=>{e.preventDefault(),e.stopPropagation()};return(0,n.jsxs)("div",{className:(0,r.default)("group-item",l?.hasContextMenu?"cursor-pointer":""),children:[(0,n.jsxs)("div",{className:(0,r.default)("groupitem-main relative flex overflow-hidden rounded","grid"===e&&"bg-base-100 aspect-[28/41] items-center justify-center shadow-md","list"===e&&"items-center justify-start gap-4 py-2"),children:[(0,n.jsxs)("div",{className:(0,r.default)("grid"===e&&"flex h-full w-full p-2","list"===e&&"relative min-w-0 max-w-[85%]"),children:[(0,n.jsx)("div",{ref:"list"===e?c:void 0,className:(0,r.default)("grid"===e&&"grid w-full grid-cols-2 grid-rows-2 gap-1 overflow-hidden","list"===e&&"flex h-28 gap-2 overflow-x-auto overflow-y-hidden","list"===e?"library-list-item":"library-grid-item"),style:"list"===e?{scrollbarWidth:"none",msOverflowStyle:"none",WebkitOverflowScrolling:"touch",transform:"translateZ(0)",willChange:"scroll-position"}:void 0,onScroll:"list"===e?()=>{x()}:void 0,children:t.books.slice(0,"grid"===e?4:void 0).map(t=>(0,n.jsx)("div",{className:(0,r.default)("relative aspect-[28/41] h-full","grid"===e&&"w-full","list"===e&&"flex-shrink-0"),children:(0,n.jsx)(e3.default,{book:t,isPreview:!0,imageClassName:"rounded-[2px]"})},t.hash))}),"list"===e&&u&&(0,n.jsxs)("div",{className:"absolute left-[-0.5px] top-0 h-full w-12",children:[(0,n.jsx)("div",{className:"from-base-200/85 via-base-200/20 absolute inset-0 bg-gradient-to-r to-transparent"}),(0,n.jsx)("button",{onClick:e=>{if(e.preventDefault(),e.stopPropagation(),c.current){let e=c.current,t=.5*e.clientWidth,a=Math.max(0,e.scrollLeft-t);e.scrollTo({left:a,behavior:"smooth"})}},onPointerDown:e=>g(e),onPointerUp:e=>g(e),onPointerMove:e=>g(e),onPointerCancel:e=>g(e),onPointerLeave:e=>g(e),className:"absolute left-2 top-1/2 -translate-y-1/2 transition-all duration-200 hover:scale-110",children:(0,n.jsx)("div",{className:"bg-base-100 border-base-content/10 hover:border-base-content/30 rounded-full border p-1 shadow-sm transition-colors duration-200",children:(0,n.jsx)(o.MdChevronLeft,{size:16,className:"text-base-content/50 hover:text-base-content/70"})})})]}),"list"===e&&h&&(0,n.jsxs)("div",{className:"absolute right-[-0.5px] top-0 h-full w-12",children:[(0,n.jsx)("div",{className:"from-base-200/85 via-base-200/20 absolute inset-0 bg-gradient-to-l to-transparent"}),(0,n.jsx)("button",{onClick:e=>{if(e.preventDefault(),e.stopPropagation(),c.current){let e=c.current,t=.5*e.clientWidth,a=e.scrollLeft,s=Math.min(e.scrollWidth-e.clientWidth,a+t);e.scrollTo({left:s,behavior:"smooth"})}},onPointerDown:e=>g(e),onPointerUp:e=>g(e),onPointerMove:e=>g(e),onPointerCancel:e=>g(e),onPointerLeave:e=>g(e),className:"absolute right-2 top-1/2 -translate-y-1/2 transition-all duration-200 hover:scale-110",children:(0,n.jsx)("div",{className:"bg-base-100 border-base-content/10 hover:border-base-content/30 rounded-full border p-1 shadow-sm transition-colors duration-200",children:(0,n.jsx)(o.MdChevronRight,{size:16,className:"text-base-content/50 hover:text-base-content/70"})})})]})]}),"list"===e&&(0,n.jsx)("div",{className:"text-base-content/75 w-28 min-w-24 max-w-40 overflow-hidden text-ellipsis text-base font-semibold",children:t.displayName}),s&&(0,n.jsx)("div",{className:"absolute inset-0 bg-black opacity-30 transition-opacity duration-300"}),a&&(0,n.jsx)("div",{className:"absolute bottom-1 right-1",children:s?(0,n.jsx)(o.MdCheckCircle,{className:"fill-blue-500"}):(0,n.jsx)(o.MdCheckCircleOutline,{className:"fill-gray-300 drop-shadow-sm"})})]}),"grid"===e&&(0,n.jsxs)("div",{className:(0,r.default)("flex w-full flex-col pt-2"),children:[(0,n.jsx)("div",{className:"min-w-0 flex-1",children:(0,n.jsx)("h4",{className:"block overflow-hidden text-ellipsis whitespace-nowrap text-xs font-semibold",children:t.displayName})}),(0,n.jsx)("div",{className:"placeholder",style:{height:`${d}px`}})]})]})},e7=({mode:e,item:t,coverFit:a,isSelectMode:s,itemSelected:l,transferProgress:o,setLoading:c,toggleSelection:m,handleGroupBooks:x,handleBookUpload:g,handleBookDownload:b,handleSetSelectMode:f,handleShowDetailsBook:v})=>{let w=(0,S.useTranslation)(),y=(0,d.useRouter)(),j=(0,d.useSearchParams)(),{envConfig:N,appService:D}=(0,k.useEnv)(),{settings:B}=(0,A.useSettingsStore)(),{updateBook:P}=(0,C.useLibraryStore)(),F=(0,i.useCallback)(async e=>{v(e)},[]),M=async e=>{if(e.uploadedAt&&!e.downloadedAt){if(await D?.isBookAvailable(e))return e.downloadedAt&&e.coverDownloadedAt||(e.downloadedAt=Date.now(),e.coverDownloadedAt=Date.now(),await P(N,e)),!0;let t=!1,a=setTimeout(()=>c(!0),200);try{t=await b(e,{queued:!1}),await P(N,e)}finally{return a&&clearTimeout(a),c(!1),t}}return!0},T=(0,i.useCallback)(async e=>{if(s)m(e.hash);else{if(!await M(e))return;D?.hasWindow&&B.openBookInNewWindow?(0,u.showReaderWindow)(D,[e.hash]):setTimeout(()=>{(0,u.navigateToReader)(y,[e.hash])},0)}},[s,B.openBookInNewWindow,D]),I=(0,i.useCallback)(e=>{if(s)m(e.id);else{let t=new URLSearchParams(j?.toString());t.set("group",e.id),setTimeout(()=>{(0,u.navigateToLibrary)(y,`${t.toString()}`)},0)}},[s,j]),E=async e=>{if(!D?.hasContextMenu)return;let t=ec[(0,L.getOSPlatform)()]||ec.default,a=await eH.new({text:l?w("Deselect Book"):w("Select Book"),action:async()=>{s||f(!0),m(e.hash)}}),n=await eH.new({text:w("Group Books"),action:async()=>{s||f(!0),l||m(e.hash),x()}}),r=await eH.new({text:w(t),action:async()=>{let t=e.relativePath?`${B.localBooksDir}/${e.relativePath.replace(/\/[^/]+$/,"")}`:B.localBooksDir;(0,ed.revealItemInDir)(t)}}),i=await eH.new({text:w("Show Book Details"),action:async()=>{F(e)}}),o=await eH.new({text:w("Delete"),action:async()=>{h.eventDispatcher.dispatch("delete-books",{ids:[e.hash]})}}),d=await e1.new();d.append(a),d.append(n),d.append(i),d.append(r),d.append(o),d.popup()},R=async e=>{if(!D?.hasContextMenu)return;let t=await eH.new({text:l?w("Deselect Group"):w("Select Group"),action:async()=>{s||f(!0),m(e.id)}}),a=await eH.new({text:w("Group Books"),action:async()=>{s||f(!0),l||m(e.id),x()}}),n=await eH.new({text:w("Delete"),action:async()=>{h.eventDispatcher.dispatch("delete-books",{ids:[e.id]})}}),r=await e1.new();r.append(t),r.append(a),r.append(n),r.popup()},U=(0,i.useCallback)((0,p.throttle)(()=>{s||f(!0),"format"in t?m(t.hash):m(t.id)},100),[s]),O=(0,i.useCallback)((0,p.throttle)(()=>{s?U():"format"in t?T(t):I(t)},100),[U,T,I]),_=(0,i.useCallback)((0,p.throttle)(()=>{"format"in t?E(t):R(t)},100),[l,B.localBooksDir]),{pressing:z,handlers:W}=(({onTap:e,onLongPress:t,onContextMenu:a,onCancel:s,threshold:l=500,moveThreshold:n=10},r)=>{let[o,d]=(0,i.useState)(!1),c=(0,i.useRef)(),u=(0,i.useRef)(null),m=(0,i.useRef)(null),h=(0,i.useRef)(!1),p=(0,i.useRef)(),x=(0,i.useRef)(!1),g=(0,i.useCallback)(()=>{d(!1),x.current=!1,u.current=null,m.current=null,clearTimeout(c.current)},[]),b=(0,i.useCallback)(e=>{("mouse"!==e.pointerType||0===e.button)&&(h.current=!0,clearTimeout(p.current),m.current=e.pointerId,u.current={x:e.clientX,y:e.clientY},x.current=!1,d(!0),c.current=setTimeout(()=>{u.current&&(x.current=!0,t?.(),d(!1))},l))},[t,l]),f=(0,i.useCallback)(e=>{if(e.pointerId!==m.current||!u.current)return;let t=Math.abs(e.clientX-u.current.x),a=Math.abs(e.clientY-u.current.y);(t>n||a>n)&&(s?.(),g())},[n,s,g]),v=(0,i.useCallback)(t=>{if(t.pointerId===m.current){if(!x.current&&u.current){let a=Math.abs(t.clientX-u.current.x),s=Math.abs(t.clientY-u.current.y);a<=n&&s<=n&&e?.()}g(),p.current=setTimeout(()=>{h.current=!1},200)}},[e,n,g]),w=(0,i.useCallback)(e=>{e.pointerId===m.current&&(s?.(),g(),p.current=setTimeout(()=>{h.current=!1},200))},[s,g]),y=(0,i.useCallback)(()=>{h.current||e?.()},[e]),k=(0,i.useCallback)(e=>{a&&(e.preventDefault(),e.stopPropagation(),a()),g()},[a,g]);return(0,i.useEffect)(()=>()=>{clearTimeout(c.current)},r),{pressing:o,handlers:{onPointerDown:b,onPointerUp:v,onPointerMove:f,onPointerCancel:w,onPointerLeave:w,onClick:y,onContextMenu:k}}})({onLongPress:()=>{U()},onTap:()=>{O()},onContextMenu:()=>{D?.hasContextMenu?_():D?.isAndroidApp&&U()}},[s,U,O,_]);return(0,n.jsx)("div",{className:(0,r.default)("list"===e&&"sm:hover:bg-base-300/50 px-4 sm:px-6"),children:(0,n.jsx)("div",{className:(0,r.default)("visible-focus-inset-2 group","grid"===e&&"sm:hover:bg-base-300/50 flex h-full flex-col px-0 py-2 sm:px-4 sm:py-4","list"===e&&"border-base-300 flex flex-col border-b py-2",D?.isMobileApp&&"no-context-menu",z&&"grid"===e?"not-eink:scale-95":"scale-100"),role:"button",tabIndex:0,"aria-label":"format"in t?t.title:t.name,style:{transition:"transform 0.2s"},onKeyDown:e=>{("Enter"===e.key||" "===e.key)&&(e.preventDefault(),O()),("ContextMenu"===e.key||e.shiftKey&&"F10"===e.key)&&(e.preventDefault(),_())},...W,children:(0,n.jsx)("div",{className:"flex h-full flex-col justify-end",children:"format"in t?(0,n.jsx)(e6,{mode:e,book:t,coverFit:a,isSelectMode:s,bookSelected:l,transferProgress:o,handleBookUpload:g,handleBookDownload:b,showBookDetailsModal:F}):(0,n.jsx)(e8,{mode:e,group:t,isSelectMode:s,groupSelected:l})})})})};var e9=e.i(163845),te=e.i(722913);let tt=({selectedBooks:e,safeAreaBottom:t,onOpen:a,onGroup:s,onDetails:l,onDelete:i,onCancel:d})=>{let c=(0,S.useTranslation)(),u=e.length>0,m=e.every(e=>(0,e2.isMd5)(e)),h=1===e.length,p=(0,te.useKeyDownActions)({onCancel:d});return(0,n.jsx)("div",{ref:p,className:"fixed bottom-0 left-0 right-0 z-40",style:{paddingBottom:`${t+16}px`},children:(0,n.jsxs)("div",{className:(0,r.default)("text-base-content flex items-center justify-center text-xs shadow-lg","not-eink:bg-base-300 eink:bg-base-100 eink:border eink:border-base-content","mx-auto w-fit space-x-6 rounded-lg p-4"),children:[(0,n.jsxs)("button",{onClick:a,className:(0,r.default)("flex flex-col items-center justify-center gap-1",(!u||!m)&&"btn-disabled opacity-50"),children:[(0,n.jsx)(o.MdOpenInNew,{}),(0,n.jsx)("div",{children:c("Open")})]}),(0,n.jsxs)("button",{onClick:s,className:(0,r.default)("flex flex-col items-center justify-center gap-1",!u&&"btn-disabled opacity-50"),children:[(0,n.jsx)(e9.LuFolderPlus,{}),(0,n.jsx)("div",{children:c("Group")})]}),(0,n.jsxs)("button",{onClick:l,className:(0,r.default)("flex flex-col items-center justify-center gap-1",(!h||!m)&&"btn-disabled opacity-50"),children:[(0,n.jsx)(o.MdInfoOutline,{}),(0,n.jsx)("div",{children:c("Details")})]}),(0,n.jsxs)("button",{onClick:i,className:(0,r.default)("flex flex-col items-center justify-center gap-1",!u&&"btn-disabled opacity-50"),children:[(0,n.jsx)(o.MdDelete,{className:"text-red-500"}),(0,n.jsx)("div",{className:"text-red-500",children:c("Delete")})]}),(0,n.jsxs)("button",{onClick:d,className:"flex flex-col items-center justify-center gap-1",children:[(0,n.jsx)(o.MdOutlineCancel,{}),(0,n.jsx)("div",{children:c("Cancel")})]})]})})};var ta=e.i(943897);function ts(e){return(0,ta.GenIcon)({tag:"svg",attr:{fill:"none",viewBox:"0 0 24 24",strokeWidth:"2",stroke:"currentColor","aria-hidden":"true"},child:[{tag:"path",attr:{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 13h6m-3-3v6m-9 1V7a2 2 0 012-2h6l2 2h6a2 2 0 012 2v8a2 2 0 01-2 2H5a2 2 0 01-2-2z"},child:[]}]})(e)}function tl(e){return(0,ta.GenIcon)({tag:"svg",attr:{fill:"none",viewBox:"0 0 24 24",strokeWidth:"2",stroke:"currentColor","aria-hidden":"true"},child:[{tag:"path",attr:{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 13h6M3 17V7a2 2 0 012-2h6l2 2h6a2 2 0 012 2v8a2 2 0 01-2 2H5a2 2 0 01-2-2z"},child:[]}]})(e)}function tn(e){return(0,ta.GenIcon)({tag:"svg",attr:{fill:"none",viewBox:"0 0 24 24",strokeWidth:"2",stroke:"currentColor","aria-hidden":"true"},child:[{tag:"path",attr:{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"},child:[]}]})(e)}let tr=({libraryBooks:e,selectedBooks:t,parentGroupName:a,onCancel:s,onConfirm:l})=>{let d=(0,S.useTranslation)(),{appService:c}=(0,k.useEnv)(),{setLibrary:u,addGroup:m,getGroups:h,getGroupId:p,getGroupsByParent:x,getParentPath:g,refreshGroups:b}=(0,C.useLibraryStore)(),[f,v]=(0,i.useState)(void 0),[w,y]=(0,i.useState)(!1),[j,N]=(0,i.useState)(""),[A,B]=(0,i.useState)(null),[P,L]=(0,i.useState)(null),[F,M]=(0,i.useState)(!1),[T,I]=(0,i.useState)(null),R=(0,te.useKeyDownActions)({onCancel:s,onConfirm:l}),U=(0,i.useRef)(null),O=(0,D.useResponsiveSize)(16),_=h(),z=x(f),W=!P||z.some(e=>e.id===P.id)||z.some(e=>P.name.startsWith(e.name))?z:[P,...z],$=t.some(e=>!(0,e2.isMd5)(e))||t.map(t=>e.find(e=>e.hash===t)?.groupId).some(e=>e&&e!==E.BOOK_UNGROUPED_NAME),G=1===t.length&&t.every(e=>!(0,e2.isMd5)(e)),q=G?_.find(e=>e.id===t[0]):null,K=()=>{let t=j.trim();if(t)if(F&&T)e.forEach(e=>{if(e.groupName===T){let a=t;e.relativePath&&c?.reclassifyBook&&c.reclassifyBook(e,a,T).catch(e=>{console.error("Failed to reclassify book files during rename:",e)}),e.groupName=a,e.groupId=p(e.groupName),e.updatedAt=Date.now()}else if(e.groupName?.startsWith(T+"/")){let a=e.groupName.replace(T,t);e.relativePath&&c?.reclassifyBook&&c.reclassifyBook(e,a,e.groupName).catch(e=>{console.error("Failed to reclassify book files during rename:",e)}),e.groupName=a,e.groupId=p(e.groupName),e.updatedAt=Date.now()}}),u([...e]),c?.saveLibraryBooks(e),b(),y(!1),M(!1),I(null);else{f&&!t.startsWith(f+"/")&&(t=`${f}/${t}`);let e=m(t);L(e),B(e),y(!1);let a=g(t);a&&v(a)}},V=e=>{v(e)},H=async()=>{t.forEach(t=>{for(let a of e.filter(e=>e.hash===t||e.groupId===t))if(a&&A){let e=a.groupName;a.groupId=A.id,a.groupName=A.name,a.updatedAt=Date.now(),a.relativePath&&c?.reclassifyBook&&c.reclassifyBook(a,A.name,e).catch(e=>{console.error("Failed to reclassify book files:",e)})}}),u([...e]),c?.saveLibraryBooks(e),l()};return(0,i.useEffect)(()=>{U.current&&U.current.select()},[w]),(0,i.useEffect)(()=>{b()},[b]),(0,i.useEffect)(()=>{let a=t.map(t=>e.find(e=>e.hash===t||e.groupId===t)?.groupId).filter(e=>e);1===Array.from(new Set(a)).length&&setTimeout(()=>{let e=h().find(e=>e.id===a[0]);B(e||null),e&&!f&&v(g(e.name))},0)},[]),(0,n.jsx)("div",{className:"fixed inset-0 flex items-center justify-center",children:(0,n.jsxs)("div",{ref:R,className:(0,r.default)("modal-box bg-base-100 overflow-y-auto rounded-2xl shadow-xl","max-h-[85%] w-[95%] min-w-64 max-w-[440px] p-6 sm:w-[70%]"),children:[(0,n.jsx)("h2",{className:"text-center text-lg font-bold",children:d("Group Books")}),(0,n.jsxs)("div",{className:(0,r.default)("mt-4 grid grid-cols-1 gap-2 text-base md:grid-cols-2"),children:[(0,n.jsxs)("button",{onClick:()=>{t.forEach(t=>{for(let a of e.filter(e=>e.hash===t||e.groupId===t))a&&a.groupId&&a.groupName&&a.groupId!==E.BOOK_UNGROUPED_ID&&a.groupName!==E.BOOK_UNGROUPED_NAME&&(a.groupId=void 0,a.groupName=void 0,a.updatedAt=Date.now())}),u([...e]),c?.saveLibraryBooks(e),l()},className:"flex items-center space-x-2 p-2 text-blue-500 disabled:text-gray-400",disabled:!$,children:[(0,n.jsx)(tl,{size:O}),(0,n.jsx)("span",{className:"truncate",children:d("Remove From Group")})]}),(0,n.jsxs)("button",{onClick:()=>{let e,t,s,l,n,r;N((e=d("Untitled Group"),s=(t=a?`${a}/${e}`:f?`${f}/${e}`:e).replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),l=RegExp(`^${s}\\s*(\\d+)?$`),r=(n=_.map(e=>{let t=e.name.match(l);return t?parseInt(t[1]||"1",10):null}).filter(e=>null!==e)).length>0?Math.max(...n)+1:1,`${t} ${r}`)),y(!0),M(!1),I(null),B(null)},className:"flex items-center space-x-2 p-2 text-blue-500 disabled:text-gray-400",children:[(0,n.jsx)(ts,{size:O}),(0,n.jsx)("span",{className:"truncate",children:d("Create New Group")})]}),(0,n.jsxs)("button",{onClick:()=>{q&&(N(q.name),I(q.name),y(!0),M(!0))},className:"flex items-center space-x-2 p-2 text-blue-500 disabled:text-gray-400",disabled:!G,children:[(0,n.jsx)(o.MdEdit,{size:O}),(0,n.jsx)("span",{className:"truncate",children:d("Rename Group")})]})]}),w&&(0,n.jsx)("div",{className:"mt-4 space-y-2",children:(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("input",{type:"text",ref:U,value:j,onChange:e=>N(e.target.value),onKeyDown:e=>{"Enter"===e.key&&K(),"Escape"===e.key&&(y(!1),M(!1),I(null)),e.stopPropagation()},className:"input input-ghost w-full border-0 px-2 text-base !outline-none sm:text-sm"}),(0,n.jsx)("button",{className:(0,r.default)("btn btn-ghost settings-content hover:bg-transparent","flex h-[1.3em] min-h-[1.3em] items-end p-0",j?"":"btn-disabled !bg-opacity-0"),onClick:()=>K(),children:(0,n.jsx)("div",{className:"pr-1 align-bottom text-base text-blue-500 sm:text-sm",children:d("Save")})})]})}),f&&(0,n.jsxs)("div",{className:"mt-4 flex flex-wrap items-center gap-2 text-base",children:[(0,n.jsx)("button",{onClick:()=>{v(f?g(f):void 0)},className:"hover:bg-base-300 flex items-center gap-1 rounded px-2 py-1",children:(0,n.jsx)(ew.IoMdArrowBack,{size:O})}),(0,n.jsx)("button",{onClick:()=>V(void 0),className:"hover:bg-base-300 rounded px-2 py-1",children:d("All")}),eg(f).map((e,t,a)=>{let s=t===a.length-1;return(0,n.jsxs)(i.default.Fragment,{children:[(0,n.jsx)(o.MdChevronRight,{size:O,className:"text-neutral-content"}),s?(0,n.jsx)("span",{className:"truncate rounded px-2 py-1",children:e.name}):(0,n.jsx)("button",{onClick:()=>V(e.path),className:"hover:bg-base-300 truncate rounded px-2 py-1",children:e.name})]},t)})]}),(0,n.jsx)("ul",{className:"groups-list mt-4 grid grid-cols-2 gap-2 overflow-x-hidden",children:W.map((e,t)=>{let a,s=(a=e.name.split("/"))[a.length-1],l=_.some(t=>t.name.startsWith(e.name+"/"));return(0,n.jsxs)("div",{className:"flex min-w-0 gap-1",children:[(0,n.jsxs)("button",{className:(0,r.default)("hover:bg-base-300 text-base-content flex min-w-0 max-w-[90%] flex-1","items-center justify-between gap-2 rounded-md px-2 py-2"),onClick:()=>{B(t=>t?.id===e.id?null:e)},children:[(0,n.jsxs)("div",{className:"flex min-w-0 flex-1 items-center gap-2",children:[(0,n.jsx)("span",{className:"shrink-0",children:(0,n.jsx)(tn,{size:O})}),(0,n.jsx)("span",{className:"min-w-0 truncate text-base sm:text-sm",children:s})]}),(0,n.jsx)("span",{className:"text-neutral-content flex shrink-0 text-sm",children:A&&A.id===e.id&&(0,n.jsx)(o.MdCheck,{className:"fill-blue-500",size:O})})]}),l&&(0,n.jsx)("button",{onClick:()=>{v(e.name)},className:"hover:bg-base-300 flex shrink-0 items-center rounded-md px-1",children:(0,n.jsx)(o.MdChevronRight,{size:O})})]},t)})}),(0,n.jsxs)("div",{className:"mt-6 flex justify-end gap-x-8 p-2",children:[(0,n.jsx)("button",{onClick:s,className:"flex items-center",children:d("Cancel")}),(0,n.jsx)("button",{onClick:H,className:(0,r.default)("flex items-center text-blue-500",!A&&"btn-disabled opacity-50"),children:d("Confirm")})]})]})})},ti=({libraryBooks:e,isSelectMode:t,isSelectAll:a,isSelectNone:s,handleImportBooks:l,handleBookUpload:o,handleBookDownload:c,handleBookDelete:p,handleSetSelectMode:x,handleShowDetailsBook:g,handlePushLibrary:b,booksTransferProgress:f})=>{let v=(0,S.useTranslation)(),w=(0,d.useRouter)(),y=(0,d.useSearchParams)(),{appService:j}=(0,k.useEnv)(),{settings:B}=(0,A.useSettingsStore)(),{safeAreaInsets:P}=(0,N.useThemeStore)(),L=y?.get("group")||"",F=y?.get("q")||null,M=y?.get("view")||B.libraryViewMode,T=y?.get("sort")||B.librarySortBy,I=y?.get("order")||(B.librarySortAscending?"asc":"desc"),R=y?.get("cover")||B.libraryCoverFit,[U,O]=(0,i.useState)(!1),[_,z]=(0,i.useState)(!1),[W,$]=(0,i.useState)([]),[G,q]=(0,i.useState)(!1),[K,V]=(0,i.useState)(!1),[H]=(0,i.useState)(y?.get("url")||""),Y=(0,i.useRef)(!1),Q=(0,i.useRef)(!1),X=(0,D.useResponsiveSize)(15),Z=(0,ez.useAutoFocus)(),{setCurrentBookshelf:J,setLibrary:et}=(0,C.useLibraryStore)(),{setSelectedBooks:ea,getSelectedBooks:es,toggleSelectedBook:el}=(0,C.useLibraryStore)(),{getGroupName:en}=(0,C.useLibraryStore)(),er=localStorage?.getItem("i18nextLng")||"",ei=(0,i.useCallback)(e=>{let t=new URLSearchParams(y?.toString());Object.entries(e).forEach(([e,a])=>{null===a||""===a?t.delete(e):t.set(e,a)}),"updated"===t.get("sort")&&t.delete("sort"),"desc"===t.get("order")&&t.delete("order"),"crop"===t.get("cover")&&t.delete("cover"),"grid"===t.get("view")&&t.delete("view");let a=t.toString();a!==(y?.toString()||"")&&(0,u.navigateToLibrary)(w,a)},[w,y]),eo=(0,i.useMemo)(()=>{let t=e=>{let t;if(!F)return!0;if(e.deletedAt)return!1;try{t=RegExp(F,"i")}catch{let t=F.toLowerCase(),a=(0,m.formatTitle)(e.title).toLowerCase(),s=(0,m.formatAuthors)(e.author).toLowerCase();return a.includes(t)||s.includes(t)||e.format.toLowerCase().includes(t)||e.groupName&&e.groupName.toLowerCase().includes(t)||e.metadata?.description&&e.metadata.description.toLowerCase().includes(t)}let a=(0,m.formatTitle)(e.title),s=(0,m.formatAuthors)(e.author);return t.test(a)||t.test(s)||t.test(e.format)||e.groupName&&t.test(e.groupName)||e.metadata?.description&&t.test(e.metadata?.description)};return F?e.filter(e=>t(e)):e},[e,F]),ed=(0,i.useMemo)(()=>{let e,t=en(L)||"";return L&&!t?[]:((e=eo.reduce((e,a)=>{if(a.deletedAt||t&&(!a.groupName||!a.groupName.startsWith(t)))return e;a.groupId=a.groupId||E.BOOK_UNGROUPED_ID,a.groupName=a.groupName||E.BOOK_UNGROUPED_NAME;let s=a.groupName.indexOf("/",t.length+1),l=a.groupName.substring(t?t.length+1:0,s>0?s:void 0),n=t?`${t}${l?`/${l}`:""}`:l,r=e.findIndex(e=>e.name===n||t&&e.name===t||l===E.BOOK_UNGROUPED_NAME&&e.name===E.BOOK_UNGROUPED_NAME),i=e[r];return i?(i.books.push(a),i.updatedAt=Math.max(i.updatedAt,a.updatedAt)):e.push({id:n===t?E.BOOK_UNGROUPED_ID:(0,e2.md5Fingerprint)(n),name:n===t?E.BOOK_UNGROUPED_NAME:n,displayName:l,books:[a],updatedAt:a.updatedAt}),e},[])).forEach(e=>{e.books.sort((e,t)=>t.updatedAt-e.updatedAt)}),[...e.find(e=>e.name===E.BOOK_UNGROUPED_NAME||e.name===t)?.books||[],...e.filter(e=>e.name!==E.BOOK_UNGROUPED_NAME&&e.name!==t)].sort((e,t)=>t.updatedAt-e.updatedAt))},[eo,L,en]);(0,i.useEffect)(()=>{L&&0===ed.length?ei({group:null}):ei({})},[y,L,ed.length,ei]);let ec=(0,i.useMemo)(()=>{let e=(e,t)=>{switch(T){case"title":let a=(0,m.formatTitle)(e.title),s=(0,m.formatTitle)(t.title);return a.localeCompare(s,er||navigator.language);case"author":let l=(0,m.formatAuthors)(e.author,e?.primaryLanguage||"en",!0),n=(0,m.formatAuthors)(t.author,t?.primaryLanguage||"en",!0);return l.localeCompare(n,er||navigator.language);case"updated":default:return new Date(e.updatedAt).getTime()-new Date(t.updatedAt).getTime();case"created":return new Date(e.createdAt).getTime()-new Date(t.createdAt).getTime();case"format":return e.format.localeCompare(t.format,er||navigator.language);case"published":let r=e.metadata?.published||"0001-01-01",i=t.metadata?.published||"0001-01-01",o=new Date(r).getTime(),d=new Date(i).getTime();if(isNaN(o)&&isNaN(d))return r.localeCompare(i,er||navigator.language);if(isNaN(o))return 1;if(isNaN(d))return -1;return o-d}},t="asc"===I?1:-1;return ed.sort((a,s)=>{if("updated"===T)return(new Date(a.updatedAt).getTime()-new Date(s.updatedAt).getTime())*t;if("name"in a||"name"in s){let e="name"in a?a.name:(0,m.formatTitle)(a.title),l="name"in s?s.name:(0,m.formatTitle)(s.title);return e.localeCompare(l,er||navigator.language)*t}return"name"in a||"name"in s?0:e(a,s)*t})},[I,T,er,ed]);(0,i.useEffect)(()=>{!Q.current&&(Q.current=!0,H&&j&&(async()=>{console.log("Importing book from URL:",H);let t=await j.importBook(H,e);t&&(et(e),j.saveLibraryBooks(e),(0,u.navigateToReader)(w,[t.hash]))})())},[H,j]),(0,i.useEffect)(()=>{J(ed)},[ed,J]);let eu=(0,i.useCallback)(e=>{el(e)},[el]),em=()=>{let e=[];return W.forEach(t=>{for(let a of eo.filter(e=>e.hash===t||e.groupId===t))a&&!a.deletedAt&&e.push(a)}),e},eh=async()=>{let e=em();for(let t=0;t<e.length;t+=20){if(Y.current){Y.current=!1;break}let a=e.slice(t,t+20);await Promise.all(a.map(e=>p(e,!1)))}b(),ea([]),q(!1),z(!0)},ep=()=>{z(!1),V(!0)},ex=e=>{let{ids:t}=e.detail;$(t),z(!1),q(!0)};(0,i.useEffect)(()=>{t?(z(!0),a?ea(ed.map(e=>"hash"in e?e.hash:e.id)):s&&ea([])):(ea([]),z(!1))},[t,a,s,ed]),(0,i.useEffect)(()=>(h.eventDispatcher.on("delete-books",ex),()=>{h.eventDispatcher.off("delete-books",ex)}),[]);let eg=es();return(0,n.jsxs)("div",{className:"bookshelf",children:[(0,n.jsxs)("div",{ref:Z,tabIndex:-1,className:(0,r.default)("bookshelf-items transform-wrapper focus:outline-none","grid"===M&&"grid flex-1 grid-cols-3 gap-x-4 px-4 sm:gap-x-0 sm:px-2","grid"===M&&"sm:grid-cols-4 md:grid-cols-6 xl:grid-cols-8 2xl:grid-cols-12","list"===M&&"flex flex-col"),style:{gridTemplateColumns:"grid"!==M||B.libraryAutoColumns?void 0:`repeat(${B.libraryColumns}, minmax(0, 1fr))`},role:"main","aria-label":v("Bookshelf"),children:[ec.map(e=>(0,n.jsx)(e7,{item:e,mode:M,coverFit:R,isSelectMode:t,itemSelected:"hash"in e?eg.includes(e.hash):eg.includes(e.id),setLoading:O,toggleSelection:eu,handleGroupBooks:ep,handleBookUpload:o,handleBookDownload:c,handleBookDelete:p,handleSetSelectMode:x,handleShowDetailsBook:g,transferProgress:"hash"in e&&f[e.hash]||null},`library-item-${"hash"in e?e.hash:e.id}`)),"grid"===M&&ed.length>0&&(0,n.jsx)("div",{className:(0,r.default)("mx-0 my-2 sm:mx-4 sm:my-4"),style:"fit"===R&&"grid"===M?{display:"flex",paddingBottom:`${X+24}px`}:void 0,children:(0,n.jsx)("button",{"aria-label":v("Import Books"),className:(0,r.default)("bookitem-main bg-base-100 hover:bg-base-300/50","flex items-center justify-center","aspect-[28/41] w-full"),onClick:l,children:(0,n.jsx)("div",{className:"flex items-center justify-center",children:(0,n.jsx)(ev.PiPlus,{className:"size-10",color:"gray"})})})})]}),U&&(0,n.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:(0,n.jsx)(eb.default,{loading:!0})}),!K&&t&&_&&(0,n.jsx)(tt,{selectedBooks:eg,safeAreaBottom:P?.bottom||0,onOpen:()=>{x(!1),j?.hasWindow&&B.openBookInNewWindow?(0,u.showReaderWindow)(j,es()):(setTimeout(()=>O(!0),200),(0,u.navigateToReader)(w,es()))},onGroup:ep,onDetails:()=>{x(!1);let t=es(),a=e.find(e=>e.hash===t[0]);a&&g(a)},onDelete:()=>{$(es()),z(!1),q(!0)},onCancel:()=>x(!1)}),K&&eg.length>0&&(0,n.jsx)(ee,{children:(0,n.jsx)(tr,{libraryBooks:e,selectedBooks:eg,parentGroupName:en(L)||"",onCancel:()=>{V(!1),z(!0)},onConfirm:()=>{V(!1),x(!1)}})}),G&&(0,n.jsx)("div",{className:(0,r.default)("delete-alert fixed bottom-0 left-0 right-0 z-50 flex justify-center"),style:{paddingBottom:`${(P?.bottom||0)+16}px`},children:(0,n.jsx)(eW.default,{title:v("Confirm Deletion"),message:v("Are you sure to delete {{count}} selected book(s)?",{count:em().length}),onCancel:()=>{Y.current=!0,q(!1),z(!0)},onConfirm:eh})})]})};var to=e.i(996459);let td=()=>{let e=(0,S.useTranslation)();return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"drag-overlay"}),(0,n.jsx)("div",{className:"drop-indicator",children:(0,n.jsxs)("div",{className:"flex flex-col items-center justify-center",children:[(0,n.jsx)(to.HiArrowDownTray,{className:"h-12 w-12"}),(0,n.jsx)("p",{className:"mt-2 font-medium",children:e("Drop to Import Books")})]})})]})};var tc=e.i(798525);let tu=({status:e,type:t,size:a})=>{switch(e){case"completed":return(0,n.jsx)(o.MdCheckCircle,{className:"text-success",size:a});case"failed":return(0,n.jsx)(o.MdError,{className:"text-error",size:a});case"cancelled":return(0,n.jsx)(o.MdCancel,{className:"text-warning",size:a});default:return"upload"===t?(0,n.jsx)(o.MdCloudUpload,{className:"text-primary",size:a}):"delete"===t?(0,n.jsx)(o.MdDeleteSweep,{className:"text-primary",size:a}):(0,n.jsx)(o.MdCloudDownload,{className:"text-primary",size:a})}},tm=({transfer:e,onCancel:t,onRetry:a,iconSize:s})=>{let l,r,i,d,c,u,m,h=(0,S.useTranslation)(),p={upload:h("Uploaded"),download:h("Downloaded"),delete:h("Deleted")};return(0,n.jsxs)("div",{className:"hover:bg-base-200 flex items-center gap-3 rounded-lg p-3",children:[(0,n.jsx)(tu,{status:e.status,type:e.type,size:s}),(0,n.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,n.jsx)("div",{className:"truncate font-medium",children:e.bookTitle}),(0,n.jsxs)("div",{className:"text-base-content/60 text-xs",children:["in_progress"===e.status&&(0,n.jsxs)(n.Fragment,{children:[Math.round(e.progress),"% - ",(l=e.transferSpeed,`${(e=>{if(0===e)return"0 B";let t=Math.floor(Math.log(e)/Math.log(1024));return`${parseFloat((e/Math.pow(1024,t)).toFixed(1))} ${["B","KB","MB","GB"][t]}`})(l)}/s`)]}),"pending"===e.status&&e.error&&(0,n.jsx)("span",{className:"text-warning",children:e.error}),"pending"===e.status&&!e.error&&h("Waiting..."),"failed"===e.status&&(0,n.jsx)("span",{className:"text-error",children:e.error||h("Failed")}),"completed"===e.status&&(p[e.type]||h("Completed")),"cancelled"===e.status&&h("Cancelled")," Â· ",(r=new Date(e.completedAt||e.startedAt||e.createdAt),i=new Date,d=r.toDateString()===i.toDateString(),(c=new Date(i)).setDate(c.getDate()-1),u=r.toDateString()===c.toDateString(),m=r.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),d?m:u?`Yesterday ${m}`:r.toLocaleDateString([],{month:"short",day:"numeric"})+" "+m)]}),"in_progress"===e.status&&(0,n.jsx)("div",{className:"bg-base-300 mt-1 h-1.5 w-full overflow-hidden rounded-full",children:(0,n.jsx)("div",{className:"bg-primary h-full transition-all",style:{width:`${e.progress}%`}})})]}),(0,n.jsxs)("div",{className:"flex items-center gap-1",children:[("failed"===e.status||"cancelled"===e.status)&&(0,n.jsx)("button",{onClick:()=>a(e.id),className:"btn btn-ghost btn-sm btn-circle","aria-label":h("Retry"),children:(0,n.jsx)(o.MdRefresh,{size:s})}),["pending","in_progress"].includes(e.status)&&(0,n.jsx)("button",{onClick:()=>t(e.id),className:"btn btn-ghost btn-sm btn-circle","aria-label":h("Cancel"),children:(0,n.jsx)(o.MdClose,{size:s})})]})]})},th=()=>{let e=(0,S.useTranslation)(),t=(0,D.useResponsiveSize)(18),a=(0,U.useTransferStore)(e=>e.setIsTransferQueueOpen),s=(0,C.useLibraryStore)(e=>e.getVisibleLibrary),{transfers:l,stats:d,isQueuePaused:c,cancelTransfer:u,retryTransfer:m,retryAllFailed:h,pauseQueue:p,resumeQueue:x,clearCompleted:g,clearFailed:b,queueUpload:f,queueDownload:v}=(0,ep.useTransferQueue)(),[w,y]=(0,i.useState)("all"),k=()=>a(!1),j=(0,te.useKeyDownActions)({onCancel:k,onConfirm:k}),N=s().filter(e=>e.downloadedAt&&!e.uploadedAt),A=s().filter(e=>e.uploadedAt&&!e.downloadedAt),B=l.filter(e=>{switch(w){case"active":return["pending","in_progress"].includes(e.status);case"completed":return"completed"===e.status;case"failed":return"failed"===e.status||"cancelled"===e.status;default:return!0}}).sort((e,t)=>{let a={in_progress:0,pending:1,failed:2,cancelled:3,completed:4},s=a[e.status]-a[t.status];return 0!==s?s:t.createdAt-e.createdAt}),P={all:e("All"),active:e("Active"),completed:e("Completed"),failed:e("Failed")};return(0,n.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[(0,n.jsx)("div",{className:"absolute inset-0 bg-black/50",onClick:k}),(0,n.jsxs)("div",{ref:j,className:(0,r.default)("modal-box bg-base-100 relative flex max-h-[85%] min-h-[65%] w-[95%] flex-col rounded-2xl p-0 shadow-xl","min-w-64 max-w-lg overflow-hidden"),children:[(0,n.jsxs)("div",{className:"border-base-300 flex items-center justify-between border-b p-4",children:[(0,n.jsx)("h2",{className:"text-lg font-semibold",children:e("Transfer Queue")}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[N.length>0&&(0,n.jsxs)("button",{onClick:()=>{N.forEach(e=>f(e))},className:"btn btn-ghost btn-sm gap-1",title:e("Upload All"),"aria-label":e("Upload All"),children:[(0,n.jsx)(o.MdCloudUpload,{size:t}),(0,n.jsx)("span",{className:"text-xs",children:N.length})]}),A.length>0&&(0,n.jsxs)("button",{onClick:()=>{A.forEach(e=>v(e))},className:"btn btn-ghost btn-sm gap-1",title:e("Download All"),"aria-label":e("Download All"),children:[(0,n.jsx)(o.MdCloudDownload,{size:t}),(0,n.jsx)("span",{className:"text-xs",children:A.length})]}),(0,n.jsx)("button",{onClick:c?x:p,className:"btn btn-ghost btn-sm btn-circle",title:e(c?"Resume Transfers":"Pause Transfers"),"aria-label":e(c?"Resume Transfers":"Pause Transfers"),children:c?(0,n.jsx)(o.MdPlayArrow,{size:t}):(0,n.jsx)(o.MdPause,{size:t})}),(0,n.jsx)("button",{onClick:k,className:"btn btn-ghost btn-sm btn-circle",title:e("Close"),"aria-label":e("Close"),children:(0,n.jsx)(o.MdClose,{size:t})})]})]}),(0,n.jsxs)("div",{className:"bg-base-200 flex items-center gap-4 px-4 py-2 text-sm",children:[(0,n.jsxs)("span",{children:[e("Active"),": ",d.active]}),(0,n.jsxs)("span",{children:[e("Pending"),": ",d.pending]}),(0,n.jsxs)("span",{children:[e("Completed"),": ",d.completed]}),(0,n.jsxs)("span",{children:[e("Failed"),": ",d.failed]})]}),(0,n.jsx)("div",{className:"border-base-300 flex gap-2 border-b p-4",children:["all","active","completed","failed"].map(e=>(0,n.jsx)("button",{onClick:()=>y(e),className:(0,r.default)("rounded-lg px-3 py-1 text-sm transition-colors",w===e?"bg-primary text-primary-content":"bg-base-200 hover:bg-base-300"),children:P[e]},e))}),(0,n.jsx)("div",{className:"flex-1 overflow-y-auto p-2",children:0===B.length?(0,n.jsx)("div",{className:"text-base-content/60 py-8 text-center",children:e("No transfers")}):B.map(e=>(0,n.jsx)(tm,{transfer:e,onCancel:u,onRetry:m,iconSize:t},e.id))}),(0,n.jsxs)("div",{className:"border-base-300 flex items-center justify-between border-t p-4",children:[(0,n.jsx)("div",{className:"flex items-center gap-2",children:d.failed>0&&(0,n.jsxs)("button",{onClick:h,className:"btn btn-ghost btn-sm gap-1",children:[(0,n.jsx)(o.MdRefresh,{size:t-2}),e("Retry All")]})}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[d.completed>0&&(0,n.jsxs)("button",{onClick:g,className:"btn btn-ghost btn-sm gap-1",children:[(0,n.jsx)(o.MdDeleteSweep,{size:t-2}),e("Clear Completed")]}),d.failed>0&&(0,n.jsxs)("button",{onClick:b,className:"btn btn-ghost btn-sm gap-1",children:[(0,n.jsx)(o.MdDeleteSweep,{size:t-2}),e("Clear Failed")]})]})]})]})]})},tp=({isOpen:e,onClose:t,onConfirm:a,reconcileBookPaths:s,applyReconciliation:l,books:r})=>{let[d,c]=(0,i.useState)(!1),[u,m]=(0,i.useState)(!1),[h,p]=(0,i.useState)(null),[x,g]=(0,i.useState)(new Set);if(!e)return null;let b=async()=>{c(!0),m(!1);try{let e=await s(r);if(p(e),m(!0),e.results){let t=e.results.filter(e=>"moved"===e.status).map(e=>e.hash);g(new Set(t))}}catch(e){console.error("è·¯å¾„æ ¡å‡†å¤±è´¥:",e),alert("è·¯å¾„æ ¡å‡†å¤±è´¥ï¼Œè¯·æŸ¥çœ‹æŽ§åˆ¶å°æ—¥å¿—")}finally{c(!1)}},f=async()=>{if(!h||!h.results)return;let e=h.results.filter(e=>x.has(e.hash));try{await l(r,e),a(e),t()}catch(e){console.error("åº”ç”¨æ ¡å‡†ç»“æžœå¤±è´¥:",e),alert("åº”ç”¨æ ¡å‡†ç»“æžœå¤±è´¥ï¼Œè¯·æŸ¥çœ‹æŽ§åˆ¶å°æ—¥å¿—")}};return(0,n.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",children:(0,n.jsxs)("div",{className:"bg-base-100 rounded-2xl shadow-xl w-full max-w-4xl max-h-[80vh] overflow-hidden flex flex-col",children:[(0,n.jsxs)("div",{className:"px-6 py-4 border-b border-base-300",children:[(0,n.jsxs)("h2",{className:"text-xl font-bold flex items-center gap-2",children:[(0,n.jsx)(o.MdSync,{size:24}),"ä¹¦ç±è·¯å¾„æ ¡å‡†"]}),(0,n.jsx)("p",{className:"text-sm text-base-content/70 mt-2",children:"æ‰«ææ–‡ä»¶ç³»ç»Ÿï¼Œæ£€æµ‹ä¹¦ç±æ–‡ä»¶ä½ç½®å˜åŒ–å¹¶åŒæ­¥åˆ°ä¹¦åº“"})]}),(0,n.jsx)("div",{className:"flex-1 overflow-y-auto px-6 py-4",children:u?(0,n.jsxs)("div",{children:[h?.summary&&(0,n.jsxs)("div",{className:"stats stats-horizontal shadow w-full mb-6",children:[(0,n.jsxs)("div",{className:"stat",children:[(0,n.jsx)("div",{className:"stat-title",children:"æ€»è®¡"}),(0,n.jsx)("div",{className:"stat-value text-2xl",children:h.summary.total})]}),(0,n.jsxs)("div",{className:"stat",children:[(0,n.jsx)("div",{className:"stat-title",children:"åŒ¹é…"}),(0,n.jsx)("div",{className:"stat-value text-2xl text-success",children:h.summary.matched})]}),(0,n.jsxs)("div",{className:"stat",children:[(0,n.jsx)("div",{className:"stat-title",children:"å·²ç§»åŠ¨"}),(0,n.jsx)("div",{className:"stat-value text-2xl text-warning",children:h.summary.moved})]}),(0,n.jsxs)("div",{className:"stat",children:[(0,n.jsx)("div",{className:"stat-title",children:"ä¸¢å¤±"}),(0,n.jsx)("div",{className:"stat-value text-2xl text-error",children:h.summary.missing})]})]}),h?.results&&h.results.length>0&&(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)("h3",{className:"font-semibold mb-2",children:"è¯¦ç»†ç»“æžœ"}),h.results.filter(e=>"matched"!==e.status).map(e=>(0,n.jsx)("div",{className:"card bg-base-200 shadow-sm hover:shadow-md transition-shadow",children:(0,n.jsx)("div",{className:"card-body p-4",children:(0,n.jsxs)("div",{className:"flex items-start gap-3",children:["moved"===e.status&&(0,n.jsx)("input",{type:"checkbox",className:"checkbox checkbox-primary mt-1",checked:x.has(e.hash),onChange:()=>{var t;let a;return t=e.hash,void((a=new Set(x)).has(t)?a.delete(t):a.add(t),g(a))}}),(0,n.jsxs)("div",{className:"flex-1",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(e=>{switch(e){case"matched":return(0,n.jsx)(o.MdCheckCircle,{className:"text-success",size:20});case"moved":return(0,n.jsx)(o.MdWarning,{className:"text-warning",size:20});case"missing":return(0,n.jsx)(o.MdError,{className:"text-error",size:20});default:return null}})(e.status),(0,n.jsx)("span",{className:"font-semibold",children:(e=>{switch(e){case"matched":return"è·¯å¾„åŒ¹é…";case"moved":return"æ–‡ä»¶å·²ç§»åŠ¨";case"missing":return"æ–‡ä»¶ä¸¢å¤±";default:return e}})(e.status)})]}),e.oldRelativePath&&(0,n.jsxs)("div",{className:"text-sm",children:[(0,n.jsx)("span",{className:"text-base-content/60",children:"åŽŸè·¯å¾„: "}),(0,n.jsx)("span",{className:"font-mono",children:e.oldRelativePath})]}),e.newRelativePath&&"moved"===e.status&&(0,n.jsxs)("div",{className:"text-sm",children:[(0,n.jsx)("span",{className:"text-base-content/60",children:"æ–°è·¯å¾„: "}),(0,n.jsx)("span",{className:"font-mono text-success",children:e.newRelativePath})]}),void 0!==e.suggestedGroupName&&(0,n.jsxs)("div",{className:"text-sm",children:[(0,n.jsx)("span",{className:"text-base-content/60",children:"å»ºè®®åˆ†ç»„: "}),(0,n.jsx)("span",{className:"badge badge-primary badge-sm",children:e.suggestedGroupName||"æœªåˆ†ç»„"})]}),e.message&&(0,n.jsx)("div",{className:"text-xs text-base-content/50 mt-1",children:e.message})]})]})})},e.hash))]}),h?.unmatchedFiles&&h.unmatchedFiles.length>0&&(0,n.jsxs)("div",{className:"mt-6",children:[(0,n.jsx)("h3",{className:"font-semibold mb-2",children:"æœªåŒ¹é…çš„æ–‡ä»¶"}),(0,n.jsx)("p",{className:"text-sm text-base-content/60 mb-2",children:"è¿™äº›æ–‡ä»¶å­˜åœ¨äºŽæ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œä½†ä¸åœ¨ä¹¦åº“è®°å½•ä¸­"}),(0,n.jsx)("div",{className:"space-y-1 max-h-40 overflow-y-auto",children:h.unmatchedFiles.map(e=>(0,n.jsx)("div",{className:"text-sm font-mono bg-base-300 px-3 py-2 rounded",children:e},e))})]})]}):(0,n.jsxs)("div",{className:"text-center py-12",children:[(0,n.jsx)("button",{onClick:b,disabled:d,className:"btn btn-primary btn-lg",children:d?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("span",{className:"loading loading-spinner"}),"æ‰«æä¸­..."]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(o.MdSync,{size:20}),"å¼€å§‹æ‰«æ"]})}),(0,n.jsx)("p",{className:"text-sm text-base-content/60 mt-4",children:"ç‚¹å‡»å¼€å§‹æ‰«ææ–‡ä»¶ç³»ç»Ÿï¼ŒæŸ¥æ‰¾è·¯å¾„ä¸ä¸€è‡´çš„ä¹¦ç±"})]})}),(0,n.jsxs)("div",{className:"px-6 py-4 border-t border-base-300 flex justify-end gap-3",children:[(0,n.jsx)("button",{onClick:t,className:"btn btn-ghost",children:"å–æ¶ˆ"}),u&&h?.summary?.moved>0&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("button",{onClick:b,className:"btn btn-ghost",children:"é‡æ–°æ‰«æ"}),(0,n.jsxs)("button",{onClick:f,className:"btn btn-primary",disabled:0===x.size,children:["åº”ç”¨é€‰ä¸­çš„è°ƒæ•´ (",x.size,")"]})]})]})]})})},tx=()=>{let e=(0,d.useSearchParams)();return(0,n.jsx)(tg,{searchParams:e})},tg=({searchParams:e})=>{let t=(0,d.useRouter)(),{envConfig:a,appService:s}=(0,k.useEnv)(),{token:l,user:F}=(0,j.useAuth)(),{library:M,isSyncing:$,syncProgress:Y,updateBook:Q,updateBooks:X,setLibrary:Z,getGroupId:J,getGroupName:et,refreshGroups:ea,checkOpenWithBooks:es,checkLastOpenBooks:el,setCheckOpenWithBooks:er,setCheckLastOpenBooks:ei}=(0,C.useLibraryStore)(),eo=(0,S.useTranslation)(),{selectFiles:ed}=(0,z.useFileSelector)(s,eo),{safeAreaInsets:ec,isRoundedWindow:eu}=(0,N.useThemeStore)(),{clearBookData:em}=(0,R.useBookDataStore)(),{settings:ef,setSettings:ev,saveSettings:ew}=(0,A.useSettingsStore)(),{isSettingsDialogOpen:ey,setSettingsDialogOpen:ek}=(0,A.useSettingsStore)(),{isTransferQueueOpen:eN}=(0,U.useTransferStore)(),[eS,eC]=(0,i.useState)(e?.get("opds")==="true"),[eA,eD]=(0,i.useState)(!1),[eB,eP]=(0,i.useState)(!1),[eL,eF]=(0,i.useState)(!1),[eM,eT]=(0,i.useState)(!1),[eI,eE]=(0,i.useState)(!1),[eR,eU]=(0,i.useState)(null),[eO,ez]=(0,i.useState)(!1),[eW,e$]=(0,i.useState)(void 0),[eG,eq]=(0,i.useState)({}),[eK,eV]=(0,i.useState)(null),eH=(0,i.useRef)(!1),eY=(0,D.useResponsiveSize)(18),eQ=ef.globalViewSettings,eX=(()=>{let{envConfig:e}=(0,k.useEnv)(),[t,a]=(0,i.useState)([]),s=(0,i.useRef)(!1);return(0,i.useEffect)(()=>{if(s.current)return;s.current=!0;let t=(0,L.getUserLang)(),l=async()=>{try{let s=await e.getAppService(),l=T[t]||T.en,n=await Promise.all(l.library.map(e=>s.importBook(e,[],!1,!0)));a(n.filter(e=>null!==e))}catch(e){console.error("Failed to import demo books:",e)}},n=localStorage.getItem("demoBooksFetched");(0,f.isWebAppPlatform)()&&!n&&(l(),localStorage.setItem("demoBooksFetched","true"))},[]),t})(),eZ=(0,i.useRef)(null),eJ=(0,i.useRef)(null),e0=(0,i.useRef)(null);(0,B.useTheme)({systemUIVisible:!0,appThemeColor:"base-200"}),(0,P.useUICSS)(),(0,_.useOpenWithBooks)(),(0,ep.useTransferQueue)(eB);let{pullLibrary:e1,pushLibrary:e2}=(()=>{let{user:e}=(0,j.useAuth)(),{appService:t}=(0,k.useEnv)(),{library:a,isSyncing:s,setLibrary:l,setIsSyncing:n,setSyncProgress:r}=(0,C.useLibraryStore)(),{useSyncInited:o,syncedBooks:d,syncBooks:c,lastSyncedAtBooks:u}=(0,I.useSync)(),m=(0,i.useRef)(!1),h=(0,i.useCallback)(()=>e?{books:C.useLibraryStore.getState().library.filter(e=>!e.syncedAt||u<e.updatedAt||u<(e.deletedAt??0)),lastSyncedAt:u}:{},[e,u]),x=(0,i.useCallback)(async()=>{if(e){if(m.current)return void console.log("Pull already in progress, skipping...");try{m.current=!0,await c([],"pull")}finally{m.current=!1}}},[e,c]),g=(0,i.useCallback)((0,p.throttle)(()=>{let e=h();e.lastSyncedAt&&c(e.books,"both")},1e3*E.SYNC_BOOKS_INTERVAL_SEC,{emitLast:!0}),[c]);(0,i.useEffect)(()=>{!e||m.current||g()},[e,a,g]);let b=(0,i.useCallback)(async()=>{if(!e)return;let t=h();t.lastSyncedAt&&await c(t?.books,"push")},[e,c,h]);(0,i.useEffect)(()=>{e&&o&&x()},[e,o,x]);let f=async()=>{if(s||!d?.length)return;d.sort((e,t)=>e.updatedAt-t.updatedAt);let e=new Set(d.map(e=>e.hash)),i=a.filter(t=>e.has(t.hash)).filter(e=>!e.deletedAt&&e.uploadedAt&&!e.coverDownloadedAt),o=async e=>{let a=d.find(t=>t.hash===e.hash);return a?(a.deletedAt||!a.uploadedAt||e.coverDownloadedAt||(e.coverImageUrl=await t?.generateCoverImageUrl(e)),a.updatedAt>=e.updatedAt?{...e,...a,syncedAt:Date.now()}:{...a,...e,syncedAt:Date.now()}):e};for(let e=0;e<i.length;e+=100)console.log("Skipping cloud cover download for",i.slice(e,e+100).length,"books");let c=await Promise.all(a.map(o));l(c),t?.saveLibraryBooks(c);let u=new Set(c.map(e=>e.hash)),m=d.filter(e=>!u.has(e.hash)&&e.uploadedAt&&!e.deletedAt),h=async e=>{e.coverImageUrl=await t?.generateCoverImageUrl(e),e.syncedAt=Date.now(),c.push(e)};m.length>0&&n(!0);try{for(let e=0;e<m.length;e+=10){let a=m.slice(e,e+10);console.log("Skipping cloud cover download for",a.length,"books"),await Promise.all(a.map(h));let s=Math.min((e+10)/m.length,1);r(s),l([...c]),t?.saveLibraryBooks(c)}}catch(e){console.error("Error updating new books:",e)}finally{m.length>0&&n(!1)}};return(0,i.useEffect)(()=>{f()},[d]),{pullLibrary:x,pushLibrary:b}})(),{isDragging:e4}=(()=>{let e=(0,S.useTranslation)(),t=(0,d.useSearchParams)(),a=t?.get("group")||"",{appService:s}=(0,k.useEnv)(),[l,n]=(0,i.useState)(!1),r=async t=>{if(0===t.length)return;let l=t.filter(e=>{let t;return t="string"==typeof e?e.split(".").pop()?.toLowerCase():e.name.split(".").pop()?.toLowerCase(),E.BOOK_ACCEPT_FORMATS.includes(`.${t}`)});if(0===l.length)return void h.eventDispatcher.dispatch("toast",{message:e("No supported files found. Supported formats: {{formats}}",{formats:E.BOOK_ACCEPT_FORMATS}),type:"error"});s?.hasHaptics&&(0,w.impactFeedback)("medium");let n=l.map(e=>({file:"string"==typeof e?void 0:e,path:"string"==typeof e?e:void 0}));h.eventDispatcher.dispatch("import-book-files",{files:n,groupId:a})},o=e=>{e.preventDefault(),e.stopPropagation(),n(!0)},c=e=>{e.preventDefault(),e.stopPropagation(),n(!1)},u=async e=>{e.preventDefault(),e.stopPropagation(),n(!1),e.dataTransfer?.files&&e.dataTransfer.files.length>0&&r(Array.from(e.dataTransfer.files))};return(0,i.useEffect)(()=>{let e=document.querySelector(".library-page");if(s?.isMobile||(e?.addEventListener("dragover",o),e?.addEventListener("dragleave",c),e?.addEventListener("drop",u)),(0,f.isTauriAppPlatform)()){let e=(0,y.getCurrentWebview)().onDragDropEvent(e=>{"over"===e.payload.type?n(!0):"drop"===e.payload.type?(n(!1),r(e.payload.paths)):n(!1)});return()=>{e.then(e=>e())}}return()=>{s?.isMobile||(e?.removeEventListener("dragover",o),e?.removeEventListener("dragleave",c),e?.removeEventListener("drop",u))}},[a]),{isDragging:l}})();(0,i.useEffect)(()=>{let e=eJ.current;if(e)return e.addEventListener("touchstart",t,{passive:!0}),()=>{e.removeEventListener("touchstart",t)};function t(e){let t=eJ.current;if(!t||t.scrollTop>0)return;let a=e.touches[0].clientX,s=e.touches[0].clientY;function l(e){let t,l=eJ.current;if(!l)return;let r=e.touches[0].clientX,i=e.touches[0].clientY-s;if(i<0||2*Math.abs(r-a)>Math.abs(i))return;let o=l.parentNode;i>120?(t=o.querySelector(".pull-indicator"))&&!t.classList.contains("flip")&&t.classList.add("flip"):i>60?function(e){let t=e.querySelector(".pull-indicator");if(t){t.classList.contains("flip")&&t.classList.remove("flip");return}let a=document.querySelector(".titlebar"),s=document.createElement("div"),l=a?.getBoundingClientRect().bottom||0;s.style.top=`${l+30}px`,s.className="pull-indicator text-gray-500",s.innerHTML=`
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 19c-.3 0-.6-.1-.8-.3l-6-6c-.4-.4-.4-1 0-1.4s1-.4 1.4 0L11 16.2V5c0-.6.4-1 1-1s1 .4 1 1v11.2l4.4-4.4c.4-.4 1-.4 1.4 0s.4 1 0 1.4l-6 6c-.2.2-.5.3-.8.3z"/>
          </svg>
        `,e.appendChild(s)}(o):n(o);let d=l.querySelector(".transform-wrapper");d&&(d.style.transform=`translate3d(0, ${128*(1-Math.exp(-.4*i/128))}px, 0)`)}function n(e){let t=e.querySelector(".pull-indicator");t&&t.remove()}function r(){let e=eJ.current;e&&(e.style.transition="",e.removeEventListener("transitionend",r))}t.addEventListener("touchmove",l,{passive:!0}),t.addEventListener("touchend",function e(t){let a=eJ.current;if(!a)return;let i=a.querySelector(".transform-wrapper");i&&(i.style.transform="translateY(0)"),n(a.parentNode),a.style.transition="transform 0.2s",t.changedTouches[0].clientY-s>120&&e1(),a.addEventListener("transitionend",r),a.removeEventListener("touchmove",l),a.removeEventListener("touchend",e)})}},[eJ.current]),(0,O.useScreenWakeLock)(ef.screenWakeLock),(0,ej.default)({onToggleFullscreen:async()=>{(0,f.isTauriAppPlatform)()&&await (0,q.tauriHandleToggleFullScreen)()},onCloseWindow:async()=>{(0,f.isTauriAppPlatform)()&&await (0,q.tauriHandleClose)()},onQuitApp:async()=>{(0,f.isTauriAppPlatform)()&&await (0,q.tauriQuitApp)()},onOpenFontLayoutSettings:()=>{ek(!0)},onOpenBooks:()=>{ts()}}),(0,i.useEffect)(()=>{sessionStorage.setItem("lastLibraryParams",e?.toString()||"")},[e]),(0,i.useEffect)(()=>{let e=async()=>{s?.hasUpdater&&ef.autoCheckUpdates?await (0,v.checkForAppUpdates)(eo):s?.hasUpdater===!1&&(0,v.checkAppReleaseNotes)()};ef.alwaysOnTop&&(0,q.tauriHandleSetAlwaysOnTop)(ef.alwaysOnTop),e()},[s?.hasUpdater,ef]),(0,i.useEffect)(()=>{s?.isMobileApp&&(0,W.lockScreenOrientation)({orientation:"auto"})},[s]);let e5=(0,i.useCallback)(async()=>{let e=await a.getAppService(),t=await e.loadSettings(),s=await e.loadLibraryBooks();ev(t),Z(s)},[a,s]);(0,i.useEffect)(()=>{if(s?.hasWindow){let e=(0,y.getCurrentWebview)().listen("close-reader-window",async()=>{e5()});return()=>{e.then(e=>e())}}},[s,e5]);let e3=(0,i.useCallback)(async e=>{let t=e.detail.files,a=e.detail.groupId||"";0!==t.length&&await e7(t,a)},[]);(0,i.useEffect)(()=>(h.eventDispatcher.on("import-book-files",e3),()=>{h.eventDispatcher.off("import-book-files",e3)}),[e3]),(0,i.useEffect)(()=>{ea(),M.some(e=>!e.deletedAt)||tn(!1)},[M]);let e6=(0,i.useCallback)(async(e,t,a)=>{let s=await e.loadSettings(),l=[];for(let n of t){console.log("Open with book:",n);try{let t=!e.isMobile&&!s.autoImportBooksOnOpen,r=await e.importBook(n,a,!0,!0,!1,t);r&&l.push(r.hash),F&&r&&!t&&!r.uploadedAt&&s.autoUpload&&setTimeout(()=>{console.log("Queueing upload for book:",r.title),x.transferManager.queueUpload(r)},3e3)}catch(e){console.log("Failed to import book:",n,e)}}return Z(a),e.saveLibraryBooks(a),console.log("Opening books:",l),l.length>0&&(eV(l),!0)},[]),e8=async(e,t,a)=>{if(0===t.length)return!1;let s=[];for(let l of t){let t=a.find(e=>e.hash===l);t&&await e.isBookAvailable(t)&&s.push(t.hash)}return console.log("Opening last books:",s),s.length>0&&(eV(s),!0)};(0,i.useEffect)(()=>{eK&&(eV(null),eK.length>0&&(0,u.navigateToReader)(t,eK))},[eK,s,t]),(0,i.useEffect)(()=>{if(eH.current)return;eH.current=!0;let e=async()=>{let e=await a.getAppService(),s=await e.loadSettings();l&&F?s.keepLogin||(s.keepLogin=!0,ev(s),ew(a,s)):s.keepLogin&&t.push("/auth")},s=setTimeout(()=>eD(!0),300),n=async()=>{let e=await a.getAppService(),t=await e.loadSettings();ev(t);let l=M.length>0?M:await e.loadLibraryBooks(),n=!1;es&&(n=await r(e,l)),er(n),!n&&el&&t.openLastBooks&&(n=await e8(e,t.lastOpenBooks,l)),ei(n),Z(l),eP(!0),s&&clearTimeout(s),eD(!1)},r=async(e,t)=>{let a=await (0,b.parseOpenWithFiles)(e)||[];return a.length>0&&await e6(e,a,t)};return e(),n(),()=>{er(!1),ei(!1),eH.current=!1}},[e]),(0,i.useEffect)(()=>{e$(et(e?.get("group")||""))},[M,e,et]),(0,i.useEffect)(()=>{if(eX.length>0&&eB){let e=[...M];for(let t of eX){let a=e.findIndex(e=>e.hash===t.hash);-1===a?e.push(t):e[a]=t}Z(e),s?.saveLibraryBooks(e)}},[eX,eB]);let e7=async(e,t)=>{eD(!0);let{library:l}=C.useLibraryStore.getState(),n=[],r=[],i=[["No chapters detected",eo("No chapters detected")],["Failed to parse EPUB",eo("Failed to parse the EPUB file")],["Unsupported format",eo("This book format is not supported")],["Failed to open file",eo("Failed to open the book file")],["Invalid or empty book file",eo("The book file is empty")],["Unsupported or corrupted book file",eo("The book file is corrupted")]],o=async e=>{let a=e.file||e.path;if(!a)return null;try{let{path:n,basePath:i}=e,o="";if(t)o=et(t)||"";else if(n&&i){let e=(0,g.getDirPath)(i);o=(0,g.getDirPath)(n).replace(e,"").replace(/^\//,"")}let d=await s?.importBook(a,l,!0,!0,!1,!1,{targetGroupName:o});if(!d)return null;return t?(d.groupId=t,d.groupName=o):o&&(d.groupName=o,d.groupId=J(o)),F&&!d.uploadedAt&&ef.autoUpload&&(console.log("Queueing upload for book:",d.title),x.transferManager.queueUpload(d)),r.push(d.title),d}catch(l){let e="string"==typeof a?a:a.name,t=(0,g.getFilename)(e),s=l instanceof Error?i.find(([e])=>l.message.includes(e))?.[1]||l.message:"";return n.push({filename:t,errorMessage:s}),console.error("Failed to import book:",e,l),null}};for(let t=0;t<e.length;t+=4){let s=e.slice(t,t+4),l=(await Promise.all(s.map(o))).filter(e=>!!e);await X(a,l)}if(e2(),n.length>0){let e=n.map(e=>e.filename),t=n.find(e=>e.errorMessage)?.errorMessage||"";h.eventDispatcher.dispatch("toast",{message:eo("Failed to import book(s): {{filenames}}",{filenames:(0,m.listFormater)(!1).format(e)})+(t?`
${t}`:""),timeout:5e3,type:"error"})}else r.length>0&&h.eventDispatcher.dispatch("toast",{message:eo("Successfully imported {{count}} book(s)",{count:r.length}),timeout:2e3,type:"success"});eD(!1)};(0,p.throttle)((e,t)=>{if(0===t.total)return;let a=t.progress/t.total*100;eq(t=>({...t,[e]:a}))},500);let e9=(0,i.useCallback)(async(e,t=!0)=>!!x.transferManager.queueUpload(e,1)&&(h.eventDispatcher.dispatch("toast",{type:"info",timeout:2e3,message:eo("Upload queued: {{title}}",{title:e.title})}),!0),[]),te=(0,i.useCallback)(async(e,t={})=>(h.eventDispatcher.dispatch("toast",{message:eo("Cloud download has been removed. All books are stored locally on the server."),type:"info"}),!1),[s]),tt=e=>async(t,l=!0)=>{let n={both:eo("Book deleted: {{title}}",{title:t.title}),cloud:eo("Deleted cloud backup of the book: {{title}}",{title:t.title}),local:eo("Deleted local copy of the book: {{title}}",{title:t.title})},r={both:eo("Failed to delete book: {{title}}",{title:t.title}),cloud:eo("Failed to delete cloud backup of the book: {{title}}",{title:t.title}),local:eo("Failed to delete local copy of the book: {{title}}",{title:t.title})};try{if(("local"===e||"both"===e)&&(await s?.deleteBook(t,"local"),"both"===e&&(t.deletedAt=Date.now(),t.downloadedAt=null,t.coverDownloadedAt=null),await Q(a,t),em(t.hash),l&&e2()),("cloud"===e||"both"===e)&&!x.transferManager.queueDelete(t,1,!0))throw Error("Failed to queue cloud deletion");return h.eventDispatcher.dispatch("toast",{type:"info",timeout:1e3,message:n[e]}),!0}catch{return h.eventDispatcher.dispatch("toast",{message:r[e],type:"error"}),!1}},ta=async(e,t)=>{if(e.metadata=t,e.title=(0,m.formatTitle)(t.title),e.author=(0,m.formatAuthors)(t.author),e.primaryLanguage=(0,m.getPrimaryLanguage)(t.language),e.updatedAt=Date.now(),t.coverImageBlobUrl||t.coverImageUrl||t.coverImageFile){e.coverImageUrl=t.coverImageBlobUrl||t.coverImageUrl;try{await s?.updateCoverImage(e,t.coverImageBlobUrl||t.coverImageUrl,t.coverImageFile)}catch(e){console.warn("Failed to update cover image:",e)}}(0,f.isWebAppPlatform)()?t.coverImageBlobUrl&&(t.coverImageUrl=void 0):t.coverImageUrl=void 0,t.coverImageBlobUrl=void 0,t.coverImageFile=void 0,await Q(a,e)},ts=async()=>{eF(!1),console.log("Importing books from files..."),ed({type:"books",multiple:!0}).then(t=>{if(0===t.files.length||t.error)return;let a=e?.get("group")||"";e7(t.files,a)})},tl=async()=>{if(!s||!(0,f.isTauriAppPlatform)())return;eF(!1),console.log("Importing books from directory...");let e="";if(s.isAndroidApp){if(!await G())return;e=(await (0,W.selectDirectory)()).path}else e=await s.selectDirectory?.("read");if(!e)return void console.log("No directory selected");let t=(await s.readDirectory(e,"None")).filter(e=>{let t=e.path.split(".").pop()?.toLowerCase()||"";return E.SUPPORTED_BOOK_EXTS.includes(t)});e7(await Promise.all(t.map(async t=>({path:await (0,g.joinPaths)(e,t.path),basePath:e}))),void 0)},tn=e=>{e&&s?.hasHaptics&&(0,w.impactFeedback)("medium"),eF(e),eT(!1),eE(!1)},tr=a=>{let s=a?J(a):"",l=new URLSearchParams(e?.toString());s?l.set("group",s):l.delete("group"),eT(!1),eE(!1),(0,u.navigateToLibrary)(t,`${l.toString()}`),setTimeout(()=>{e$(a)},300)};if(!s||!ec||es||el)return(0,n.jsx)("div",{className:(0,r.default)("full-height",!s?.isLinuxApp&&"bg-base-200")});let to=eB||M.length>0;return(0,n.jsxs)("div",{ref:e0,"aria-label":"Your Library",className:(0,r.default)("library-page text-base-content full-height flex select-none flex-col overflow-hidden",eQ?.isEink?"bg-base-100":"bg-base-200",s?.hasRoundedWindow&&eu&&"window-border rounded-window"),children:[(0,n.jsxs)("div",{className:"relative top-0 z-40 w-full",role:"banner",tabIndex:-1,"aria-label":eo("Library Header"),children:[(0,n.jsx)(e_,{isSelectMode:eL,isSelectAll:eM,onImportBooksFromFiles:ts,onImportBooksFromDirectory:s?.canReadExternalDir?tl:void 0,onOpenCatalogManager:()=>{eC(!0)},onToggleSelectMode:()=>tn(!eL),onSelectAll:()=>{eT(!0),eE(!1)},onDeselectAll:()=>{eE(!0),eT(!1)},onReconcilePaths:()=>ez(!0)}),(0,n.jsx)("progress",{className:(0,r.default)("progress progress-success absolute bottom-0 left-0 right-0 h-1 translate-y-[2px] transition-opacity duration-200 sm:translate-y-[4px]",$?"opacity-100":"opacity-0"),value:100*Y,max:"100"})]}),(eA||$)&&(0,n.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:(0,n.jsx)(eb.default,{loading:!0})}),eW&&(0,n.jsx)("div",{className:`transition-all duration-300 ease-in-out ${eW?"opacity-100":"max-h-0 opacity-0"}`,children:(0,n.jsxs)("div",{className:"flex flex-wrap items-center gap-y-1 px-4 text-base",children:[(0,n.jsx)("button",{onClick:()=>tr(void 0),className:"hover:bg-base-300 text-base-content/85 rounded px-2 py-1",children:eo("All")}),eg(eW).map((e,t,a)=>{let s=t===a.length-1;return(0,n.jsxs)(i.Fragment,{children:[(0,n.jsx)(o.MdChevronRight,{size:eY,className:"text-neutral-content"}),s?(0,n.jsx)("span",{className:"truncate rounded px-2 py-1",children:e.name}):(0,n.jsx)("button",{onClick:()=>tr(e.path),className:"hover:bg-base-300 text-base-content/85 truncate rounded px-2 py-1",children:e.name})]},t)})]})}),to&&(M.some(e=>!e.deletedAt)?(0,n.jsx)(c.OverlayScrollbarsComponent,{defer:!0,"aria-label":"",ref:eZ,className:"flex-grow",options:{scrollbars:{autoHide:"scroll"}},events:{initialized:e=>{let{content:t}=e.elements();t&&(eJ.current=t)}},children:(0,n.jsxs)("div",{className:(0,r.default)("scroll-container drop-zone flex-grow",e4&&"drag-over"),style:{paddingTop:"0px",paddingRight:`${ec.right}px`,paddingBottom:`${ec.bottom}px`,paddingLeft:`${ec.left}px`},children:[(0,n.jsx)(td,{}),(0,n.jsx)(ti,{libraryBooks:M,isSelectMode:eL,isSelectAll:eM,isSelectNone:eI,handleImportBooks:ts,handleBookUpload:e9,handleBookDownload:te,handleBookDelete:tt("both"),handleSetSelectMode:tn,handleShowDetailsBook:e=>{eU(e)},booksTransferProgress:eG,handlePushLibrary:e2})]})}):(0,n.jsxs)("div",{className:"hero drop-zone h-screen items-center justify-center",children:[(0,n.jsx)(td,{}),(0,n.jsx)("div",{className:"hero-content text-neutral-content text-center",children:(0,n.jsxs)("div",{className:"max-w-md",children:[(0,n.jsx)("h1",{className:"mb-5 text-5xl font-bold",children:eo("Your Library")}),(0,n.jsx)("p",{className:"mb-5",children:eo("Welcome to your library. You can import your books here and read them anytime.")}),(0,n.jsx)("button",{className:"btn btn-primary rounded-xl",onClick:ts,children:eo("Import Books")})]})})]})),eR&&(0,n.jsx)(V.BookDetailModal,{isOpen:!!eR,book:eR,onClose:()=>eU(null),handleBookUpload:e9,handleBookDownload:te,handleBookDelete:tt("both"),handleBookDeleteCloudBackup:tt("cloud"),handleBookDeleteLocalCopy:tt("local"),handleBookMetadataUpdate:ta}),eN&&(0,n.jsx)(ee,{children:(0,n.jsx)(th,{})}),(0,n.jsx)(K.AboutWindow,{}),(0,n.jsx)(H.UpdaterWindow,{}),(0,n.jsx)(eh,{}),ey&&(0,n.jsx)(tc.default,{bookKey:""}),eS&&(0,n.jsx)(en,{onClose:()=>{eC(!1);let a=new URLSearchParams(e?.toString());a.delete("opds"),(0,u.navigateToLibrary)(t,`${a.toString()}`)}}),eO&&s&&(0,n.jsx)(tp,{isOpen:eO,onClose:()=>ez(!1),onConfirm:e=>{console.log("æ ¡å‡†å®Œæˆï¼Œæ›´æ–°äº†",e.length,"æœ¬ä¹¦"),ez(!1),e5()},reconcileBookPaths:s.reconcileBookPaths.bind(s),applyReconciliation:s.applyReconciliation.bind(s),books:M}),(0,n.jsx)(ex.Toast,{})]})};e.s(["default",0,()=>(0,n.jsx)(i.Suspense,{fallback:(0,n.jsx)("div",{className:"full-height"}),children:(0,n.jsx)(tx,{})})],957476)}]);