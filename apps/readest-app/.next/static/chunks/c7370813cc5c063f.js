(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,270658,(e,t,r)=>{},881626,(e,t,r)=>{var n=e.i(307178);e.r(270658);var i=e.r(917409),a=function(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}(i);function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function s(e,t,r){return t&&o(e.prototype,t),r&&o(e,r),e}var l=void 0!==n.default&&n.default.env&&!0,c=function(e){return"[object String]"===Object.prototype.toString.call(e)},f=function(){function e(e){var t=void 0===e?{}:e,r=t.name,n=void 0===r?"stylesheet":r,i=t.optimizeForSpeed,a=void 0===i?l:i;u(c(n),"`name` must be a string"),this._name=n,this._deletedRulePlaceholder="#"+n+"-deleted-rule____{}",u("boolean"==typeof a,"`optimizeForSpeed` must be a boolean"),this._optimizeForSpeed=a,this._serverSheet=void 0,this._tags=[],this._injected=!1,this._rulesCount=0;var o="undefined"!=typeof window&&document.querySelector('meta[property="csp-nonce"]');this._nonce=o?o.getAttribute("content"):null}var t=e.prototype;return t.setOptimizeForSpeed=function(e){u("boolean"==typeof e,"`setOptimizeForSpeed` accepts a boolean"),u(0===this._rulesCount,"optimizeForSpeed cannot be when rules have already been inserted"),this.flush(),this._optimizeForSpeed=e,this.inject()},t.isOptimizeForSpeed=function(){return this._optimizeForSpeed},t.inject=function(){var e=this;if(u(!this._injected,"sheet already injected"),this._injected=!0,"undefined"!=typeof window&&this._optimizeForSpeed){this._tags[0]=this.makeStyleTag(this._name),this._optimizeForSpeed="insertRule"in this.getSheet(),this._optimizeForSpeed||(l||console.warn("StyleSheet: optimizeForSpeed mode not supported falling back to standard mode."),this.flush(),this._injected=!0);return}this._serverSheet={cssRules:[],insertRule:function(t,r){return"number"==typeof r?e._serverSheet.cssRules[r]={cssText:t}:e._serverSheet.cssRules.push({cssText:t}),r},deleteRule:function(t){e._serverSheet.cssRules[t]=null}}},t.getSheetForTag=function(e){if(e.sheet)return e.sheet;for(var t=0;t<document.styleSheets.length;t++)if(document.styleSheets[t].ownerNode===e)return document.styleSheets[t]},t.getSheet=function(){return this.getSheetForTag(this._tags[this._tags.length-1])},t.insertRule=function(e,t){if(u(c(e),"`insertRule` accepts only strings"),"undefined"==typeof window)return"number"!=typeof t&&(t=this._serverSheet.cssRules.length),this._serverSheet.insertRule(e,t),this._rulesCount++;if(this._optimizeForSpeed){var r=this.getSheet();"number"!=typeof t&&(t=r.cssRules.length);try{r.insertRule(e,t)}catch(t){return l||console.warn("StyleSheet: illegal rule: \n\n"+e+"\n\nSee https://stackoverflow.com/q/20007992 for more info"),-1}}else{var n=this._tags[t];this._tags.push(this.makeStyleTag(this._name,e,n))}return this._rulesCount++},t.replaceRule=function(e,t){if(this._optimizeForSpeed||"undefined"==typeof window){var r="undefined"!=typeof window?this.getSheet():this._serverSheet;if(t.trim()||(t=this._deletedRulePlaceholder),!r.cssRules[e])return e;r.deleteRule(e);try{r.insertRule(t,e)}catch(n){l||console.warn("StyleSheet: illegal rule: \n\n"+t+"\n\nSee https://stackoverflow.com/q/20007992 for more info"),r.insertRule(this._deletedRulePlaceholder,e)}}else{var n=this._tags[e];u(n,"old rule at index `"+e+"` not found"),n.textContent=t}return e},t.deleteRule=function(e){if("undefined"==typeof window)return void this._serverSheet.deleteRule(e);if(this._optimizeForSpeed)this.replaceRule(e,"");else{var t=this._tags[e];u(t,"rule at index `"+e+"` not found"),t.parentNode.removeChild(t),this._tags[e]=null}},t.flush=function(){this._injected=!1,this._rulesCount=0,"undefined"!=typeof window?(this._tags.forEach(function(e){return e&&e.parentNode.removeChild(e)}),this._tags=[]):this._serverSheet.cssRules=[]},t.cssRules=function(){var e=this;return"undefined"==typeof window?this._serverSheet.cssRules:this._tags.reduce(function(t,r){return r?t=t.concat(Array.prototype.map.call(e.getSheetForTag(r).cssRules,function(t){return t.cssText===e._deletedRulePlaceholder?null:t})):t.push(null),t},[])},t.makeStyleTag=function(e,t,r){t&&u(c(t),"makeStyleTag accepts only strings as second parameter");var n=document.createElement("style");this._nonce&&n.setAttribute("nonce",this._nonce),n.type="text/css",n.setAttribute("data-"+e,""),t&&n.appendChild(document.createTextNode(t));var i=document.head||document.getElementsByTagName("head")[0];return r?i.insertBefore(n,r):i.appendChild(n),n},s(e,[{key:"length",get:function(){return this._rulesCount}}]),e}();function u(e,t){if(!e)throw Error("StyleSheet: "+t+".")}var d=function(e){for(var t=5381,r=e.length;r;)t=33*t^e.charCodeAt(--r);return t>>>0},h=function(e){return e.replace(/\/style/gi,"\\/style")},p={};function b(e,t){if(!t)return"jsx-"+e;var r=String(t),n=e+r;return p[n]||(p[n]="jsx-"+d(e+"-"+r)),p[n]}function m(e,t){var r=/__jsx-style-dynamic-selector/g;"undefined"==typeof window&&(t=h(t));var n=e+t;return p[n]||(p[n]=t.replace(r,e)),p[n]}function g(e,t){return void 0===t&&(t={}),e.map(function(e){var r=e[0],n=e[1];return a.default.createElement("style",{id:"__"+r,key:"__"+r,nonce:t.nonce?t.nonce:void 0,dangerouslySetInnerHTML:{__html:n}})})}var y=function(){function e(e){var t=void 0===e?{}:e,r=t.styleSheet,n=void 0===r?null:r,i=t.optimizeForSpeed,a=void 0!==i&&i;this._sheet=n||new f({name:"styled-jsx",optimizeForSpeed:a}),this._sheet.inject(),n&&"boolean"==typeof a&&(this._sheet.setOptimizeForSpeed(a),this._optimizeForSpeed=this._sheet.isOptimizeForSpeed()),this._fromServer=void 0,this._indices={},this._instancesCounts={}}var t=e.prototype;return t.add=function(e){var t=this;void 0===this._optimizeForSpeed&&(this._optimizeForSpeed=Array.isArray(e.children),this._sheet.setOptimizeForSpeed(this._optimizeForSpeed),this._optimizeForSpeed=this._sheet.isOptimizeForSpeed()),"undefined"==typeof window||this._fromServer||(this._fromServer=this.selectFromServer(),this._instancesCounts=Object.keys(this._fromServer).reduce(function(e,t){return e[t]=0,e},{}));var r=this.getIdAndRules(e),n=r.styleId,i=r.rules;if(n in this._instancesCounts){this._instancesCounts[n]+=1;return}var a=i.map(function(e){return t._sheet.insertRule(e)}).filter(function(e){return -1!==e});this._indices[n]=a,this._instancesCounts[n]=1},t.remove=function(e){var t=this,r=this.getIdAndRules(e).styleId;if(v(r in this._instancesCounts,"styleId: `"+r+"` not found"),this._instancesCounts[r]-=1,this._instancesCounts[r]<1){var n=this._fromServer&&this._fromServer[r];n?(n.parentNode.removeChild(n),delete this._fromServer[r]):(this._indices[r].forEach(function(e){return t._sheet.deleteRule(e)}),delete this._indices[r]),delete this._instancesCounts[r]}},t.update=function(e,t){this.add(t),this.remove(e)},t.flush=function(){this._sheet.flush(),this._sheet.inject(),this._fromServer=void 0,this._indices={},this._instancesCounts={}},t.cssRules=function(){var e=this,t=this._fromServer?Object.keys(this._fromServer).map(function(t){return[t,e._fromServer[t]]}):[],r=this._sheet.cssRules();return t.concat(Object.keys(this._indices).map(function(t){return[t,e._indices[t].map(function(e){return r[e].cssText}).join(e._optimizeForSpeed?"":"\n")]}).filter(function(e){return!!e[1]}))},t.styles=function(e){return g(this.cssRules(),e)},t.getIdAndRules=function(e){var t=e.children,r=e.dynamic,n=e.id;if(r){var i=b(n,r);return{styleId:i,rules:Array.isArray(t)?t.map(function(e){return m(i,e)}):[m(i,t)]}}return{styleId:b(n),rules:Array.isArray(t)?t:[t]}},t.selectFromServer=function(){return Array.prototype.slice.call(document.querySelectorAll('[id^="__jsx-"]')).reduce(function(e,t){return e[t.id.slice(2)]=t,e},{})},e}();function v(e,t){if(!e)throw Error("StyleSheetRegistry: "+t+".")}var x=i.createContext(null);function w(){return new y}function S(e){var t=e.registry,r=e.children,n=i.useContext(x),o=i.useState(function(){return n||t||w()})[0];return a.default.createElement(x.Provider,{value:o},r)}function k(){return i.useContext(x)}x.displayName="StyleSheetContext";var _=a.default.useInsertionEffect||a.default.useLayoutEffect,E="undefined"!=typeof window?w():void 0;function M(e){var t=E||k();return t&&("undefined"==typeof window?t.add(e):_(function(){return t.add(e),function(){t.remove(e)}},[e.id,String(e.dynamic)])),null}M.dynamic=function(e){return e.map(function(e){return b(e[0],e[1])}).join(" ")},r.StyleRegistry=S,r.createStyleRegistry=w,r.style=M,r.useStyleRegistry=k},150773,(e,t,r)=>{t.exports=e.r(881626).style},210102,(e,t,r)=>{"use strict";r.byteLength=f,r.toByteArray=d,r.fromByteArray=b;for(var n=[],i=[],a="undefined"!=typeof Uint8Array?Uint8Array:Array,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0,l=o.length;s<l;++s)n[s]=o[s],i[o.charCodeAt(s)]=s;function c(e){var t=e.length;if(t%4>0)throw Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");-1===r&&(r=t);var n=r===t?0:4-r%4;return[r,n]}function f(e){var t=c(e),r=t[0],n=t[1];return(r+n)*3/4-n}function u(e,t,r){return(t+r)*3/4-r}function d(e){var t,r,n=c(e),o=n[0],s=n[1],l=new a(u(e,o,s)),f=0,d=s>0?o-4:o;for(r=0;r<d;r+=4)t=i[e.charCodeAt(r)]<<18|i[e.charCodeAt(r+1)]<<12|i[e.charCodeAt(r+2)]<<6|i[e.charCodeAt(r+3)],l[f++]=t>>16&255,l[f++]=t>>8&255,l[f++]=255&t;return 2===s&&(t=i[e.charCodeAt(r)]<<2|i[e.charCodeAt(r+1)]>>4,l[f++]=255&t),1===s&&(t=i[e.charCodeAt(r)]<<10|i[e.charCodeAt(r+1)]<<4|i[e.charCodeAt(r+2)]>>2,l[f++]=t>>8&255,l[f++]=255&t),l}function h(e){return n[e>>18&63]+n[e>>12&63]+n[e>>6&63]+n[63&e]}function p(e,t,r){for(var n=[],i=t;i<r;i+=3)n.push(h((e[i]<<16&0xff0000)+(e[i+1]<<8&65280)+(255&e[i+2])));return n.join("")}function b(e){for(var t,r=e.length,i=r%3,a=[],o=16383,s=0,l=r-i;s<l;s+=o)a.push(p(e,s,s+o>l?l:s+o));return 1===i?a.push(n[(t=e[r-1])>>2]+n[t<<4&63]+"=="):2===i&&a.push(n[(t=(e[r-2]<<8)+e[r-1])>>10]+n[t>>4&63]+n[t<<2&63]+"="),a.join("")}i[45]=62,i[95]=63},962866,(e,t,r)=>{r.read=function(e,t,r,n,i){var a,o,s=8*i-n-1,l=(1<<s)-1,c=l>>1,f=-7,u=r?i-1:0,d=r?-1:1,h=e[t+u];for(u+=d,a=h&(1<<-f)-1,h>>=-f,f+=s;f>0;a=256*a+e[t+u],u+=d,f-=8);for(o=a&(1<<-f)-1,a>>=-f,f+=n;f>0;o=256*o+e[t+u],u+=d,f-=8);if(0===a)a=1-c;else{if(a===l)return o?NaN:1/0*(h?-1:1);o+=Math.pow(2,n),a-=c}return(h?-1:1)*o*Math.pow(2,a-n)},r.write=function(e,t,r,n,i,a){var o,s,l,c=8*a-i-1,f=(1<<c)-1,u=f>>1,d=5960464477539062e-23*(23===i),h=n?0:a-1,p=n?1:-1,b=+(t<0||0===t&&1/t<0);for(isNaN(t=Math.abs(t))||t===1/0?(s=+!!isNaN(t),o=f):(o=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-o))<1&&(o--,l*=2),o+u>=1?t+=d/l:t+=d*Math.pow(2,1-u),t*l>=2&&(o++,l/=2),o+u>=f?(s=0,o=f):o+u>=1?(s=(t*l-1)*Math.pow(2,i),o+=u):(s=t*Math.pow(2,u-1)*Math.pow(2,i),o=0));i>=8;e[r+h]=255&s,h+=p,s/=256,i-=8);for(o=o<<i|s,c+=i;c>0;e[r+h]=255&o,h+=p,o/=256,c-=8);e[r+h-p]|=128*b}},259390,(e,t,r)=>{"use strict";let n=e.r(210102),i=e.r(962866),a="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;r.Buffer=c,r.SlowBuffer=x,r.INSPECT_MAX_BYTES=50;let o=0x7fffffff;function s(){try{let e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}function l(e){if(e>o)throw RangeError('The value "'+e+'" is invalid for option "size"');let t=new Uint8Array(e);return Object.setPrototypeOf(t,c.prototype),t}function c(e,t,r){if("number"==typeof e){if("string"==typeof t)throw TypeError('The "string" argument must be of type string. Received type number');return h(e)}return f(e,t,r)}function f(e,t,r){if("string"==typeof e)return p(e,t);if(ArrayBuffer.isView(e))return m(e);if(null==e)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(eo(e,ArrayBuffer)||e&&eo(e.buffer,ArrayBuffer)||"undefined"!=typeof SharedArrayBuffer&&(eo(e,SharedArrayBuffer)||e&&eo(e.buffer,SharedArrayBuffer)))return g(e,t,r);if("number"==typeof e)throw TypeError('The "value" argument must not be of type number. Received type number');let n=e.valueOf&&e.valueOf();if(null!=n&&n!==e)return c.from(n,t,r);let i=y(e);if(i)return i;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return c.from(e[Symbol.toPrimitive]("string"),t,r);throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function u(e){if("number"!=typeof e)throw TypeError('"size" argument must be of type number');if(e<0)throw RangeError('The value "'+e+'" is invalid for option "size"')}function d(e,t,r){return(u(e),e<=0)?l(e):void 0!==t?"string"==typeof r?l(e).fill(t,r):l(e).fill(t):l(e)}function h(e){return u(e),l(e<0?0:0|v(e))}function p(e,t){if(("string"!=typeof t||""===t)&&(t="utf8"),!c.isEncoding(t))throw TypeError("Unknown encoding: "+t);let r=0|w(e,t),n=l(r),i=n.write(e,t);return i!==r&&(n=n.slice(0,i)),n}function b(e){let t=e.length<0?0:0|v(e.length),r=l(t);for(let n=0;n<t;n+=1)r[n]=255&e[n];return r}function m(e){if(eo(e,Uint8Array)){let t=new Uint8Array(e);return g(t.buffer,t.byteOffset,t.byteLength)}return b(e)}function g(e,t,r){let n;if(t<0||e.byteLength<t)throw RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(r||0))throw RangeError('"length" is outside of buffer bounds');return Object.setPrototypeOf(n=void 0===t&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,t):new Uint8Array(e,t,r),c.prototype),n}function y(e){if(c.isBuffer(e)){let t=0|v(e.length),r=l(t);return 0===r.length||e.copy(r,0,0,t),r}return void 0!==e.length?"number"!=typeof e.length||es(e.length)?l(0):b(e):"Buffer"===e.type&&Array.isArray(e.data)?b(e.data):void 0}function v(e){if(e>=o)throw RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o.toString(16)+" bytes");return 0|e}function x(e){return+e!=e&&(e=0),c.alloc(+e)}function w(e,t){if(c.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||eo(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);let r=e.length,n=arguments.length>2&&!0===arguments[2];if(!n&&0===r)return 0;let i=!1;for(;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return et(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return ei(e).length;default:if(i)return n?-1:et(e).length;t=(""+t).toLowerCase(),i=!0}}function S(e,t,r){let n=!1;if((void 0===t||t<0)&&(t=0),t>this.length||((void 0===r||r>this.length)&&(r=this.length),r<=0||(r>>>=0)<=(t>>>=0)))return"";for(e||(e="utf8");;)switch(e){case"hex":return O(this,t,r);case"utf8":case"utf-8":return j(this,t,r);case"ascii":return P(this,t,r);case"latin1":case"binary":return B(this,t,r);case"base64":return C(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return D(this,t,r);default:if(n)throw TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}function k(e,t,r){let n=e[t];e[t]=e[r],e[r]=n}function _(e,t,r,n,i){if(0===e.length)return -1;if("string"==typeof r?(n=r,r=0):r>0x7fffffff?r=0x7fffffff:r<-0x80000000&&(r=-0x80000000),es(r*=1)&&(r=i?0:e.length-1),r<0&&(r=e.length+r),r>=e.length)if(i)return -1;else r=e.length-1;else if(r<0)if(!i)return -1;else r=0;if("string"==typeof t&&(t=c.from(t,n)),c.isBuffer(t))return 0===t.length?-1:E(e,t,r,n,i);if("number"==typeof t){if(t&=255,"function"==typeof Uint8Array.prototype.indexOf)if(i)return Uint8Array.prototype.indexOf.call(e,t,r);else return Uint8Array.prototype.lastIndexOf.call(e,t,r);return E(e,[t],r,n,i)}throw TypeError("val must be string, number or Buffer")}function E(e,t,r,n,i){let a,o=1,s=e.length,l=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return -1;o=2,s/=2,l/=2,r/=2}function c(e,t){return 1===o?e[t]:e.readUInt16BE(t*o)}if(i){let n=-1;for(a=r;a<s;a++)if(c(e,a)===c(t,-1===n?0:a-n)){if(-1===n&&(n=a),a-n+1===l)return n*o}else -1!==n&&(a-=a-n),n=-1}else for(r+l>s&&(r=s-l),a=r;a>=0;a--){let r=!0;for(let n=0;n<l;n++)if(c(e,a+n)!==c(t,n)){r=!1;break}if(r)return a}return -1}function M(e,t,r,n){let i;r=Number(r)||0;let a=e.length-r;n?(n=Number(n))>a&&(n=a):n=a;let o=t.length;for(n>o/2&&(n=o/2),i=0;i<n;++i){let n=parseInt(t.substr(2*i,2),16);if(es(n))break;e[r+i]=n}return i}function N(e,t,r,n){return ea(et(t,e.length-r),e,r,n)}function A(e,t,r,n){return ea(er(t),e,r,n)}function T(e,t,r,n){return ea(ei(t),e,r,n)}function R(e,t,r,n){return ea(en(t,e.length-r),e,r,n)}function C(e,t,r){return 0===t&&r===e.length?n.fromByteArray(e):n.fromByteArray(e.slice(t,r))}function j(e,t,r){r=Math.min(e.length,r);let n=[],i=t;for(;i<r;){let t=e[i],a=null,o=t>239?4:t>223?3:t>191?2:1;if(i+o<=r){let r,n,s,l;switch(o){case 1:t<128&&(a=t);break;case 2:(192&(r=e[i+1]))==128&&(l=(31&t)<<6|63&r)>127&&(a=l);break;case 3:r=e[i+1],n=e[i+2],(192&r)==128&&(192&n)==128&&(l=(15&t)<<12|(63&r)<<6|63&n)>2047&&(l<55296||l>57343)&&(a=l);break;case 4:r=e[i+1],n=e[i+2],s=e[i+3],(192&r)==128&&(192&n)==128&&(192&s)==128&&(l=(15&t)<<18|(63&r)<<12|(63&n)<<6|63&s)>65535&&l<1114112&&(a=l)}}null===a?(a=65533,o=1):a>65535&&(a-=65536,n.push(a>>>10&1023|55296),a=56320|1023&a),n.push(a),i+=o}return L(n)}r.kMaxLength=0x7fffffff,c.TYPED_ARRAY_SUPPORT=s(),c.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(c.prototype,"parent",{enumerable:!0,get:function(){if(c.isBuffer(this))return this.buffer}}),Object.defineProperty(c.prototype,"offset",{enumerable:!0,get:function(){if(c.isBuffer(this))return this.byteOffset}}),c.poolSize=8192,c.from=function(e,t,r){return f(e,t,r)},Object.setPrototypeOf(c.prototype,Uint8Array.prototype),Object.setPrototypeOf(c,Uint8Array),c.alloc=function(e,t,r){return d(e,t,r)},c.allocUnsafe=function(e){return h(e)},c.allocUnsafeSlow=function(e){return h(e)},c.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==c.prototype},c.compare=function(e,t){if(eo(e,Uint8Array)&&(e=c.from(e,e.offset,e.byteLength)),eo(t,Uint8Array)&&(t=c.from(t,t.offset,t.byteLength)),!c.isBuffer(e)||!c.isBuffer(t))throw TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;let r=e.length,n=t.length;for(let i=0,a=Math.min(r,n);i<a;++i)if(e[i]!==t[i]){r=e[i],n=t[i];break}return r<n?-1:+(n<r)},c.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},c.concat=function(e,t){let r;if(!Array.isArray(e))throw TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return c.alloc(0);if(void 0===t)for(r=0,t=0;r<e.length;++r)t+=e[r].length;let n=c.allocUnsafe(t),i=0;for(r=0;r<e.length;++r){let t=e[r];if(eo(t,Uint8Array))i+t.length>n.length?(c.isBuffer(t)||(t=c.from(t)),t.copy(n,i)):Uint8Array.prototype.set.call(n,t,i);else if(c.isBuffer(t))t.copy(n,i);else throw TypeError('"list" argument must be an Array of Buffers');i+=t.length}return n},c.byteLength=w,c.prototype._isBuffer=!0,c.prototype.swap16=function(){let e=this.length;if(e%2!=0)throw RangeError("Buffer size must be a multiple of 16-bits");for(let t=0;t<e;t+=2)k(this,t,t+1);return this},c.prototype.swap32=function(){let e=this.length;if(e%4!=0)throw RangeError("Buffer size must be a multiple of 32-bits");for(let t=0;t<e;t+=4)k(this,t,t+3),k(this,t+1,t+2);return this},c.prototype.swap64=function(){let e=this.length;if(e%8!=0)throw RangeError("Buffer size must be a multiple of 64-bits");for(let t=0;t<e;t+=8)k(this,t,t+7),k(this,t+1,t+6),k(this,t+2,t+5),k(this,t+3,t+4);return this},c.prototype.toString=function(){let e=this.length;return 0===e?"":0==arguments.length?j(this,0,e):S.apply(this,arguments)},c.prototype.toLocaleString=c.prototype.toString,c.prototype.equals=function(e){if(!c.isBuffer(e))throw TypeError("Argument must be a Buffer");return this===e||0===c.compare(this,e)},c.prototype.inspect=function(){let e="",t=r.INSPECT_MAX_BYTES;return e=this.toString("hex",0,t).replace(/(.{2})/g,"$1 ").trim(),this.length>t&&(e+=" ... "),"<Buffer "+e+">"},a&&(c.prototype[a]=c.prototype.inspect),c.prototype.compare=function(e,t,r,n,i){if(eo(e,Uint8Array)&&(e=c.from(e,e.offset,e.byteLength)),!c.isBuffer(e))throw TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),t<0||r>e.length||n<0||i>this.length)throw RangeError("out of range index");if(n>=i&&t>=r)return 0;if(n>=i)return -1;if(t>=r)return 1;if(t>>>=0,r>>>=0,n>>>=0,i>>>=0,this===e)return 0;let a=i-n,o=r-t,s=Math.min(a,o),l=this.slice(n,i),f=e.slice(t,r);for(let e=0;e<s;++e)if(l[e]!==f[e]){a=l[e],o=f[e];break}return a<o?-1:+(o<a)},c.prototype.includes=function(e,t,r){return -1!==this.indexOf(e,t,r)},c.prototype.indexOf=function(e,t,r){return _(this,e,t,r,!0)},c.prototype.lastIndexOf=function(e,t,r){return _(this,e,t,r,!1)},c.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else if(isFinite(t))t>>>=0,isFinite(r)?(r>>>=0,void 0===n&&(n="utf8")):(n=r,r=void 0);else throw Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");let i=this.length-t;if((void 0===r||r>i)&&(r=i),e.length>0&&(r<0||t<0)||t>this.length)throw RangeError("Attempt to write outside buffer bounds");n||(n="utf8");let a=!1;for(;;)switch(n){case"hex":return M(this,e,t,r);case"utf8":case"utf-8":return N(this,e,t,r);case"ascii":case"latin1":case"binary":return A(this,e,t,r);case"base64":return T(this,e,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return R(this,e,t,r);default:if(a)throw TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),a=!0}},c.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};let I=4096;function L(e){let t=e.length;if(t<=I)return String.fromCharCode.apply(String,e);let r="",n=0;for(;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=I));return r}function P(e,t,r){let n="";r=Math.min(e.length,r);for(let i=t;i<r;++i)n+=String.fromCharCode(127&e[i]);return n}function B(e,t,r){let n="";r=Math.min(e.length,r);for(let i=t;i<r;++i)n+=String.fromCharCode(e[i]);return n}function O(e,t,r){let n=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>n)&&(r=n);let i="";for(let n=t;n<r;++n)i+=el[e[n]];return i}function D(e,t,r){let n=e.slice(t,r),i="";for(let e=0;e<n.length-1;e+=2)i+=String.fromCharCode(n[e]+256*n[e+1]);return i}function z(e,t,r){if(e%1!=0||e<0)throw RangeError("offset is not uint");if(e+t>r)throw RangeError("Trying to access beyond buffer length")}function F(e,t,r,n,i,a){if(!c.isBuffer(e))throw TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<a)throw RangeError('"value" argument is out of bounds');if(r+n>e.length)throw RangeError("Index out of range")}function U(e,t,r,n,i){Y(t,n,i,e,r,7);let a=Number(t&BigInt(0xffffffff));e[r++]=a,a>>=8,e[r++]=a,a>>=8,e[r++]=a,a>>=8,e[r++]=a;let o=Number(t>>BigInt(32)&BigInt(0xffffffff));return e[r++]=o,o>>=8,e[r++]=o,o>>=8,e[r++]=o,o>>=8,e[r++]=o,r}function $(e,t,r,n,i){Y(t,n,i,e,r,7);let a=Number(t&BigInt(0xffffffff));e[r+7]=a,a>>=8,e[r+6]=a,a>>=8,e[r+5]=a,a>>=8,e[r+4]=a;let o=Number(t>>BigInt(32)&BigInt(0xffffffff));return e[r+3]=o,o>>=8,e[r+2]=o,o>>=8,e[r+1]=o,o>>=8,e[r]=o,r+8}function H(e,t,r,n,i,a){if(r+n>e.length||r<0)throw RangeError("Index out of range")}function q(e,t,r,n,a){return t*=1,r>>>=0,a||H(e,t,r,4,34028234663852886e22,-34028234663852886e22),i.write(e,t,r,n,23,4),r+4}function V(e,t,r,n,a){return t*=1,r>>>=0,a||H(e,t,r,8,17976931348623157e292,-17976931348623157e292),i.write(e,t,r,n,52,8),r+8}c.prototype.slice=function(e,t){let r=this.length;e=~~e,t=void 0===t?r:~~t,e<0?(e+=r)<0&&(e=0):e>r&&(e=r),t<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e);let n=this.subarray(e,t);return Object.setPrototypeOf(n,c.prototype),n},c.prototype.readUintLE=c.prototype.readUIntLE=function(e,t,r){e>>>=0,t>>>=0,r||z(e,t,this.length);let n=this[e],i=1,a=0;for(;++a<t&&(i*=256);)n+=this[e+a]*i;return n},c.prototype.readUintBE=c.prototype.readUIntBE=function(e,t,r){e>>>=0,t>>>=0,r||z(e,t,this.length);let n=this[e+--t],i=1;for(;t>0&&(i*=256);)n+=this[e+--t]*i;return n},c.prototype.readUint8=c.prototype.readUInt8=function(e,t){return e>>>=0,t||z(e,1,this.length),this[e]},c.prototype.readUint16LE=c.prototype.readUInt16LE=function(e,t){return e>>>=0,t||z(e,2,this.length),this[e]|this[e+1]<<8},c.prototype.readUint16BE=c.prototype.readUInt16BE=function(e,t){return e>>>=0,t||z(e,2,this.length),this[e]<<8|this[e+1]},c.prototype.readUint32LE=c.prototype.readUInt32LE=function(e,t){return e>>>=0,t||z(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+0x1000000*this[e+3]},c.prototype.readUint32BE=c.prototype.readUInt32BE=function(e,t){return e>>>=0,t||z(e,4,this.length),0x1000000*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},c.prototype.readBigUInt64LE=ec(function(e){Z(e>>>=0,"offset");let t=this[e],r=this[e+7];(void 0===t||void 0===r)&&J(e,this.length-8);let n=t+256*this[++e]+65536*this[++e]+0x1000000*this[++e],i=this[++e]+256*this[++e]+65536*this[++e]+0x1000000*r;return BigInt(n)+(BigInt(i)<<BigInt(32))}),c.prototype.readBigUInt64BE=ec(function(e){Z(e>>>=0,"offset");let t=this[e],r=this[e+7];(void 0===t||void 0===r)&&J(e,this.length-8);let n=0x1000000*t+65536*this[++e]+256*this[++e]+this[++e],i=0x1000000*this[++e]+65536*this[++e]+256*this[++e]+r;return(BigInt(n)<<BigInt(32))+BigInt(i)}),c.prototype.readIntLE=function(e,t,r){e>>>=0,t>>>=0,r||z(e,t,this.length);let n=this[e],i=1,a=0;for(;++a<t&&(i*=256);)n+=this[e+a]*i;return n>=(i*=128)&&(n-=Math.pow(2,8*t)),n},c.prototype.readIntBE=function(e,t,r){e>>>=0,t>>>=0,r||z(e,t,this.length);let n=t,i=1,a=this[e+--n];for(;n>0&&(i*=256);)a+=this[e+--n]*i;return a>=(i*=128)&&(a-=Math.pow(2,8*t)),a},c.prototype.readInt8=function(e,t){return(e>>>=0,t||z(e,1,this.length),128&this[e])?-((255-this[e]+1)*1):this[e]},c.prototype.readInt16LE=function(e,t){e>>>=0,t||z(e,2,this.length);let r=this[e]|this[e+1]<<8;return 32768&r?0xffff0000|r:r},c.prototype.readInt16BE=function(e,t){e>>>=0,t||z(e,2,this.length);let r=this[e+1]|this[e]<<8;return 32768&r?0xffff0000|r:r},c.prototype.readInt32LE=function(e,t){return e>>>=0,t||z(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},c.prototype.readInt32BE=function(e,t){return e>>>=0,t||z(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},c.prototype.readBigInt64LE=ec(function(e){Z(e>>>=0,"offset");let t=this[e],r=this[e+7];return(void 0===t||void 0===r)&&J(e,this.length-8),(BigInt(this[e+4]+256*this[e+5]+65536*this[e+6]+(r<<24))<<BigInt(32))+BigInt(t+256*this[++e]+65536*this[++e]+0x1000000*this[++e])}),c.prototype.readBigInt64BE=ec(function(e){Z(e>>>=0,"offset");let t=this[e],r=this[e+7];return(void 0===t||void 0===r)&&J(e,this.length-8),(BigInt((t<<24)+65536*this[++e]+256*this[++e]+this[++e])<<BigInt(32))+BigInt(0x1000000*this[++e]+65536*this[++e]+256*this[++e]+r)}),c.prototype.readFloatLE=function(e,t){return e>>>=0,t||z(e,4,this.length),i.read(this,e,!0,23,4)},c.prototype.readFloatBE=function(e,t){return e>>>=0,t||z(e,4,this.length),i.read(this,e,!1,23,4)},c.prototype.readDoubleLE=function(e,t){return e>>>=0,t||z(e,8,this.length),i.read(this,e,!0,52,8)},c.prototype.readDoubleBE=function(e,t){return e>>>=0,t||z(e,8,this.length),i.read(this,e,!1,52,8)},c.prototype.writeUintLE=c.prototype.writeUIntLE=function(e,t,r,n){if(e*=1,t>>>=0,r>>>=0,!n){let n=Math.pow(2,8*r)-1;F(this,e,t,r,n,0)}let i=1,a=0;for(this[t]=255&e;++a<r&&(i*=256);)this[t+a]=e/i&255;return t+r},c.prototype.writeUintBE=c.prototype.writeUIntBE=function(e,t,r,n){if(e*=1,t>>>=0,r>>>=0,!n){let n=Math.pow(2,8*r)-1;F(this,e,t,r,n,0)}let i=r-1,a=1;for(this[t+i]=255&e;--i>=0&&(a*=256);)this[t+i]=e/a&255;return t+r},c.prototype.writeUint8=c.prototype.writeUInt8=function(e,t,r){return e*=1,t>>>=0,r||F(this,e,t,1,255,0),this[t]=255&e,t+1},c.prototype.writeUint16LE=c.prototype.writeUInt16LE=function(e,t,r){return e*=1,t>>>=0,r||F(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},c.prototype.writeUint16BE=c.prototype.writeUInt16BE=function(e,t,r){return e*=1,t>>>=0,r||F(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},c.prototype.writeUint32LE=c.prototype.writeUInt32LE=function(e,t,r){return e*=1,t>>>=0,r||F(this,e,t,4,0xffffffff,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},c.prototype.writeUint32BE=c.prototype.writeUInt32BE=function(e,t,r){return e*=1,t>>>=0,r||F(this,e,t,4,0xffffffff,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},c.prototype.writeBigUInt64LE=ec(function(e,t=0){return U(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))}),c.prototype.writeBigUInt64BE=ec(function(e,t=0){return $(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))}),c.prototype.writeIntLE=function(e,t,r,n){if(e*=1,t>>>=0,!n){let n=Math.pow(2,8*r-1);F(this,e,t,r,n-1,-n)}let i=0,a=1,o=0;for(this[t]=255&e;++i<r&&(a*=256);)e<0&&0===o&&0!==this[t+i-1]&&(o=1),this[t+i]=(e/a|0)-o&255;return t+r},c.prototype.writeIntBE=function(e,t,r,n){if(e*=1,t>>>=0,!n){let n=Math.pow(2,8*r-1);F(this,e,t,r,n-1,-n)}let i=r-1,a=1,o=0;for(this[t+i]=255&e;--i>=0&&(a*=256);)e<0&&0===o&&0!==this[t+i+1]&&(o=1),this[t+i]=(e/a|0)-o&255;return t+r},c.prototype.writeInt8=function(e,t,r){return e*=1,t>>>=0,r||F(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},c.prototype.writeInt16LE=function(e,t,r){return e*=1,t>>>=0,r||F(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},c.prototype.writeInt16BE=function(e,t,r){return e*=1,t>>>=0,r||F(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},c.prototype.writeInt32LE=function(e,t,r){return e*=1,t>>>=0,r||F(this,e,t,4,0x7fffffff,-0x80000000),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},c.prototype.writeInt32BE=function(e,t,r){return e*=1,t>>>=0,r||F(this,e,t,4,0x7fffffff,-0x80000000),e<0&&(e=0xffffffff+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},c.prototype.writeBigInt64LE=ec(function(e,t=0){return U(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),c.prototype.writeBigInt64BE=ec(function(e,t=0){return $(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),c.prototype.writeFloatLE=function(e,t,r){return q(this,e,t,!0,r)},c.prototype.writeFloatBE=function(e,t,r){return q(this,e,t,!1,r)},c.prototype.writeDoubleLE=function(e,t,r){return V(this,e,t,!0,r)},c.prototype.writeDoubleBE=function(e,t,r){return V(this,e,t,!1,r)},c.prototype.copy=function(e,t,r,n){if(!c.isBuffer(e))throw TypeError("argument should be a Buffer");if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<r&&(n=r),n===r||0===e.length||0===this.length)return 0;if(t<0)throw RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw RangeError("Index out of range");if(n<0)throw RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);let i=n-r;return this===e&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(t,r,n):Uint8Array.prototype.set.call(e,this.subarray(r,n),t),i},c.prototype.fill=function(e,t,r,n){let i;if("string"==typeof e){if("string"==typeof t?(n=t,t=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),void 0!==n&&"string"!=typeof n)throw TypeError("encoding must be a string");if("string"==typeof n&&!c.isEncoding(n))throw TypeError("Unknown encoding: "+n);if(1===e.length){let t=e.charCodeAt(0);("utf8"===n&&t<128||"latin1"===n)&&(e=t)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<r)throw RangeError("Out of range index");if(r<=t)return this;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(i=t;i<r;++i)this[i]=e;else{let a=c.isBuffer(e)?e:c.from(e,n),o=a.length;if(0===o)throw TypeError('The value "'+e+'" is invalid for argument "value"');for(i=0;i<r-t;++i)this[i+t]=a[i%o]}return this};let W={};function K(e,t,r){W[e]=class extends r{constructor(){super(),Object.defineProperty(this,"message",{value:t.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${e}]`,this.stack,delete this.name}get code(){return e}set code(e){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:e,writable:!0})}toString(){return`${this.name} [${e}]: ${this.message}`}}}function G(e){let t="",r=e.length,n=+("-"===e[0]);for(;r>=n+4;r-=3)t=`_${e.slice(r-3,r)}${t}`;return`${e.slice(0,r)}${t}`}function X(e,t,r){Z(t,"offset"),(void 0===e[t]||void 0===e[t+r])&&J(t,e.length-(r+1))}function Y(e,t,r,n,i,a){if(e>r||e<t){let n,i="bigint"==typeof t?"n":"";throw n=a>3?0===t||t===BigInt(0)?`>= 0${i} and < 2${i} ** ${(a+1)*8}${i}`:`>= -(2${i} ** ${(a+1)*8-1}${i}) and < 2 ** ${(a+1)*8-1}${i}`:`>= ${t}${i} and <= ${r}${i}`,new W.ERR_OUT_OF_RANGE("value",n,e)}X(n,i,a)}function Z(e,t){if("number"!=typeof e)throw new W.ERR_INVALID_ARG_TYPE(t,"number",e)}function J(e,t,r){if(Math.floor(e)!==e)throw Z(e,r),new W.ERR_OUT_OF_RANGE(r||"offset","an integer",e);if(t<0)throw new W.ERR_BUFFER_OUT_OF_BOUNDS;throw new W.ERR_OUT_OF_RANGE(r||"offset",`>= ${+!!r} and <= ${t}`,e)}K("ERR_BUFFER_OUT_OF_BOUNDS",function(e){return e?`${e} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),K("ERR_INVALID_ARG_TYPE",function(e,t){return`The "${e}" argument must be of type number. Received type ${typeof t}`},TypeError),K("ERR_OUT_OF_RANGE",function(e,t,r){let n=`The value of "${e}" is out of range.`,i=r;return Number.isInteger(r)&&Math.abs(r)>0x100000000?i=G(String(r)):"bigint"==typeof r&&(i=String(r),(r>BigInt(2)**BigInt(32)||r<-(BigInt(2)**BigInt(32)))&&(i=G(i)),i+="n"),n+=` It must be ${t}. Received ${i}`},RangeError);let Q=/[^+/0-9A-Za-z-_]/g;function ee(e){if((e=(e=e.split("=")[0]).trim().replace(Q,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}function et(e,t){let r;t=t||1/0;let n=e.length,i=null,a=[];for(let o=0;o<n;++o){if((r=e.charCodeAt(o))>55295&&r<57344){if(!i){if(r>56319||o+1===n){(t-=3)>-1&&a.push(239,191,189);continue}i=r;continue}if(r<56320){(t-=3)>-1&&a.push(239,191,189),i=r;continue}r=(i-55296<<10|r-56320)+65536}else i&&(t-=3)>-1&&a.push(239,191,189);if(i=null,r<128){if((t-=1)<0)break;a.push(r)}else if(r<2048){if((t-=2)<0)break;a.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;a.push(r>>12|224,r>>6&63|128,63&r|128)}else if(r<1114112){if((t-=4)<0)break;a.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}else throw Error("Invalid code point")}return a}function er(e){let t=[];for(let r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}function en(e,t){let r,n,i=[];for(let a=0;a<e.length&&!((t-=2)<0);++a)n=(r=e.charCodeAt(a))>>8,i.push(r%256),i.push(n);return i}function ei(e){return n.toByteArray(ee(e))}function ea(e,t,r,n){let i;for(i=0;i<n&&!(i+r>=t.length)&&!(i>=e.length);++i)t[i+r]=e[i];return i}function eo(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function es(e){return e!=e}let el=function(){let e="0123456789abcdef",t=Array(256);for(let r=0;r<16;++r){let n=16*r;for(let i=0;i<16;++i)t[n+i]=e[r]+e[i]}return t}();function ec(e){return"undefined"==typeof BigInt?ef:e}function ef(){throw Error("BigInt not supported")}},679877,(e,t,r)=>{"use strict";var n,i="object"==typeof Reflect?Reflect:null,a=i&&"function"==typeof i.apply?i.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)};function o(e){console&&console.warn&&console.warn(e)}n=i&&"function"==typeof i.ownKeys?i.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var s=Number.isNaN||function(e){return e!=e};function l(){l.init.call(this)}t.exports=l,t.exports.once=x,l.EventEmitter=l,l.prototype._events=void 0,l.prototype._eventsCount=0,l.prototype._maxListeners=void 0;var c=10;function f(e){if("function"!=typeof e)throw TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function u(e){return void 0===e._maxListeners?l.defaultMaxListeners:e._maxListeners}function d(e,t,r,n){if(f(r),void 0===(a=e._events)?(a=e._events=Object.create(null),e._eventsCount=0):(void 0!==a.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),a=e._events),s=a[t]),void 0===s)s=a[t]=r,++e._eventsCount;else if("function"==typeof s?s=a[t]=n?[r,s]:[s,r]:n?s.unshift(r):s.push(r),(i=u(e))>0&&s.length>i&&!s.warned){s.warned=!0;var i,a,s,l=Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=e,l.type=t,l.count=s.length,o(l)}return e}function h(){if(!this.fired)return(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0==arguments.length)?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function p(e,t,r){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},i=h.bind(n);return i.listener=r,n.wrapFn=i,i}function b(e,t,r){var n=e._events;if(void 0===n)return[];var i=n[t];return void 0===i?[]:"function"==typeof i?r?[i.listener||i]:[i]:r?v(i):g(i,i.length)}function m(e){var t=this._events;if(void 0!==t){var r=t[e];if("function"==typeof r)return 1;if(void 0!==r)return r.length}return 0}function g(e,t){for(var r=Array(t),n=0;n<t;++n)r[n]=e[n];return r}function y(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}function v(e){for(var t=Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}function x(e,t){return new Promise(function(r,n){function i(r){e.removeListener(t,a),n(r)}function a(){"function"==typeof e.removeListener&&e.removeListener("error",i),r([].slice.call(arguments))}S(e,t,a,{once:!0}),"error"!==t&&w(e,i,{once:!0})})}function w(e,t,r){"function"==typeof e.on&&S(e,"error",t,r)}function S(e,t,r,n){if("function"==typeof e.on)n.once?e.once(t,r):e.on(t,r);else if("function"==typeof e.addEventListener)e.addEventListener(t,function i(a){n.once&&e.removeEventListener(t,i),r(a)});else throw TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e)}Object.defineProperty(l,"defaultMaxListeners",{enumerable:!0,get:function(){return c},set:function(e){if("number"!=typeof e||e<0||s(e))throw RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");c=e}}),l.init=function(){(void 0===this._events||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},l.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||s(e))throw RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},l.prototype.getMaxListeners=function(){return u(this)},l.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var n="error"===e,i=this._events;if(void 0!==i)n=n&&void 0===i.error;else if(!n)return!1;if(n){if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var o,s=Error("Unhandled error."+(o?" ("+o.message+")":""));throw s.context=o,s}var l=i[e];if(void 0===l)return!1;if("function"==typeof l)a(l,this,t);else for(var c=l.length,f=g(l,c),r=0;r<c;++r)a(f[r],this,t);return!0},l.prototype.addListener=function(e,t){return d(this,e,t,!1)},l.prototype.on=l.prototype.addListener,l.prototype.prependListener=function(e,t){return d(this,e,t,!0)},l.prototype.once=function(e,t){return f(t),this.on(e,p(this,e,t)),this},l.prototype.prependOnceListener=function(e,t){return f(t),this.prependListener(e,p(this,e,t)),this},l.prototype.removeListener=function(e,t){var r,n,i,a,o;if(f(t),void 0===(n=this._events)||void 0===(r=n[e]))return this;if(r===t||r.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(i=-1,a=r.length-1;a>=0;a--)if(r[a]===t||r[a].listener===t){o=r[a].listener,i=a;break}if(i<0)return this;0===i?r.shift():y(r,i),1===r.length&&(n[e]=r[0]),void 0!==n.removeListener&&this.emit("removeListener",e,o||t)}return this},l.prototype.off=l.prototype.removeListener,l.prototype.removeAllListeners=function(e){var t,r,n;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0==arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete r[e]),this;if(0==arguments.length){var i,a=Object.keys(r);for(n=0;n<a.length;++n)"removeListener"!==(i=a[n])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(void 0!==t)for(n=t.length-1;n>=0;n--)this.removeListener(e,t[n]);return this},l.prototype.listeners=function(e){return b(this,e,!0)},l.prototype.rawListeners=function(e){return b(this,e,!1)},l.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):m.call(e,t)},l.prototype.listenerCount=m,l.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]}},561125,(e,t,r)=>{var n=e.i(316377),i=e.i(307178);!function(){var r={8992:function(e){e.exports=function(e,r,n){if(e.filter)return e.filter(r,n);if(null==e||"function"!=typeof r)throw TypeError();for(var i=[],a=0;a<e.length;a++)if(t.call(e,a)){var o=e[a];r.call(n,o,a,e)&&i.push(o)}return i};var t=Object.prototype.hasOwnProperty},5555:function(e,t,r){"use strict";var n=r(1212),i=r(1909),a=r(8737);e.exports=r(8772)||n.call(a,i)},9905:function(e,t,r){"use strict";var n=r(1212),i=r(1909),a=r(5555);e.exports=function(){return a(n,i,arguments)}},1909:function(e){"use strict";e.exports=Function.prototype.apply},8737:function(e){"use strict";e.exports=Function.prototype.call},7152:function(e,t,r){"use strict";var n=r(1212),i=r(8202),a=r(8737),o=r(5555);e.exports=function(e){if(e.length<1||"function"!=typeof e[0])throw new i("a function is required");return o(n,a,e)}},8772:function(e){"use strict";e.exports="undefined"!=typeof Reflect&&Reflect&&Reflect.apply},516:function(e,t,r){"use strict";var n=r(3197),i=r(9042),a=i(n("String.prototype.indexOf"));e.exports=function(e,t){var r=n(e,!!t);return"function"==typeof r&&a(e,".prototype.")>-1?i(r):r}},9042:function(e,t,r){"use strict";var n=r(3143),i=r(446),a=r(7152),o=r(9905);e.exports=function(e){var t=a(arguments),r=e.length-(arguments.length-1);return n(t,1+(r>0?r:0),!0)},i?i(e.exports,"apply",{value:o}):e.exports.apply=o},819:function(e,t,r){"use strict";var n=r(446),i=r(5182),a=r(8202),o=r(3990);e.exports=function(e,t,r){if(!e||"object"!=typeof e&&"function"!=typeof e)throw new a("`obj` must be an object or a function`");if("string"!=typeof t&&"symbol"!=typeof t)throw new a("`property` must be a string or a symbol`");if(arguments.length>3&&"boolean"!=typeof arguments[3]&&null!==arguments[3])throw new a("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&"boolean"!=typeof arguments[4]&&null!==arguments[4])throw new a("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&"boolean"!=typeof arguments[5]&&null!==arguments[5])throw new a("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&"boolean"!=typeof arguments[6])throw new a("`loose`, if provided, must be a boolean");var s=arguments.length>3?arguments[3]:null,l=arguments.length>4?arguments[4]:null,c=arguments.length>5?arguments[5]:null,f=arguments.length>6&&arguments[6],u=!!o&&o(e,t);if(n)n(e,t,{configurable:null===c&&u?u.configurable:!c,enumerable:null===s&&u?u.enumerable:!s,value:r,writable:null===l&&u?u.writable:!l});else if(!f&&(s||l||c))throw new i("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.");else e[t]=r}},6211:function(e,t,r){"use strict";var n,i=r(7152),a=r(3990);try{n=[].__proto__===Array.prototype}catch(e){if(!e||"object"!=typeof e||!("code"in e)||"ERR_PROTO_ACCESS"!==e.code)throw e}var o=!!n&&a&&a(Object.prototype,"__proto__"),s=Object,l=s.getPrototypeOf;e.exports=o&&"function"==typeof o.get?i([o.get]):"function"==typeof l&&function(e){return l(null==e?e:s(e))}},446:function(e){"use strict";var t=Object.defineProperty||!1;if(t)try{t({},"a",{value:1})}catch(e){t=!1}e.exports=t},7181:function(e){"use strict";e.exports=EvalError},1545:function(e){"use strict";e.exports=Error},22:function(e){"use strict";e.exports=RangeError},2803:function(e){"use strict";e.exports=ReferenceError},5182:function(e){"use strict";e.exports=SyntaxError},8202:function(e){"use strict";e.exports=TypeError},3284:function(e){"use strict";e.exports=URIError},2811:function(e){"use strict";e.exports=Object},6144:function(e){var t=Object.prototype.hasOwnProperty,r=Object.prototype.toString;e.exports=function(e,n,i){if("[object Function]"!==r.call(n))throw TypeError("iterator must be a function");var a=e.length;if(a===+a)for(var o=0;o<a;o++)n.call(i,e[o],o,e);else for(var s in e)t.call(e,s)&&n.call(i,e[s],s,e)}},3136:function(e){"use strict";var t="Function.prototype.bind called on incompatible ",r=Object.prototype.toString,n=Math.max,i="[object Function]",a=function(e,t){for(var r=[],n=0;n<e.length;n+=1)r[n]=e[n];for(var i=0;i<t.length;i+=1)r[i+e.length]=t[i];return r},o=function(e,t){for(var r=[],n=t||0,i=0;n<e.length;n+=1,i+=1)r[i]=e[n];return r},s=function(e,t){for(var r="",n=0;n<e.length;n+=1)r+=e[n],n+1<e.length&&(r+=t);return r};e.exports=function(e){var l,c=this;if("function"!=typeof c||r.apply(c)!==i)throw TypeError(t+c);for(var f=o(arguments,1),u=function(){if(this instanceof l){var t=c.apply(this,a(f,arguments));return Object(t)===t?t:this}return c.apply(e,a(f,arguments))},d=n(0,c.length-f.length),h=[],p=0;p<d;p++)h[p]="$"+p;if(l=Function("binder","return function ("+s(h,",")+"){ return binder.apply(this,arguments); }")(u),c.prototype){var b=function(){};b.prototype=c.prototype,l.prototype=new b,b.prototype=null}return l}},1212:function(e,t,r){"use strict";var n=r(3136);e.exports=Function.prototype.bind||n},3197:function(e,t,r){"use strict";var n,i=r(2811),a=r(1545),o=r(7181),s=r(22),l=r(2803),c=r(5182),f=r(8202),u=r(3284),d=r(7173),h=r(847),p=r(2916),b=r(9882),m=r(3291),g=r(553),y=r(8629),v=Function,x=function(e){try{return v('"use strict"; return ('+e+").constructor;")()}catch(e){}},w=r(3990),S=r(446),k=function(){throw new f},_=w?function(){try{return arguments.callee,k}catch(e){try{return w(arguments,"callee").get}catch(e){return k}}}():k,E=r(4871)(),M=r(699),N=r(7823),A=r(7904),T=r(1909),R=r(8737),C={},j="undefined"!=typeof Uint8Array&&M?M(Uint8Array):n,I={__proto__:null,"%AggregateError%":"undefined"==typeof AggregateError?n:AggregateError,"%Array%":Array,"%ArrayBuffer%":"undefined"==typeof ArrayBuffer?n:ArrayBuffer,"%ArrayIteratorPrototype%":E&&M?M([][Symbol.iterator]()):n,"%AsyncFromSyncIteratorPrototype%":n,"%AsyncFunction%":C,"%AsyncGenerator%":C,"%AsyncGeneratorFunction%":C,"%AsyncIteratorPrototype%":C,"%Atomics%":"undefined"==typeof Atomics?n:Atomics,"%BigInt%":"undefined"==typeof BigInt?n:BigInt,"%BigInt64Array%":"undefined"==typeof BigInt64Array?n:BigInt64Array,"%BigUint64Array%":"undefined"==typeof BigUint64Array?n:BigUint64Array,"%Boolean%":Boolean,"%DataView%":"undefined"==typeof DataView?n:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":a,"%eval%":eval,"%EvalError%":o,"%Float16Array%":"undefined"==typeof Float16Array?n:Float16Array,"%Float32Array%":"undefined"==typeof Float32Array?n:Float32Array,"%Float64Array%":"undefined"==typeof Float64Array?n:Float64Array,"%FinalizationRegistry%":"undefined"==typeof FinalizationRegistry?n:FinalizationRegistry,"%Function%":v,"%GeneratorFunction%":C,"%Int8Array%":"undefined"==typeof Int8Array?n:Int8Array,"%Int16Array%":"undefined"==typeof Int16Array?n:Int16Array,"%Int32Array%":"undefined"==typeof Int32Array?n:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":E&&M?M(M([][Symbol.iterator]())):n,"%JSON%":"object"==typeof JSON?JSON:n,"%Map%":"undefined"==typeof Map?n:Map,"%MapIteratorPrototype%":"undefined"!=typeof Map&&E&&M?M((new Map)[Symbol.iterator]()):n,"%Math%":Math,"%Number%":Number,"%Object%":i,"%Object.getOwnPropertyDescriptor%":w,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":"undefined"==typeof Promise?n:Promise,"%Proxy%":"undefined"==typeof Proxy?n:Proxy,"%RangeError%":s,"%ReferenceError%":l,"%Reflect%":"undefined"==typeof Reflect?n:Reflect,"%RegExp%":RegExp,"%Set%":"undefined"==typeof Set?n:Set,"%SetIteratorPrototype%":"undefined"!=typeof Set&&E&&M?M((new Set)[Symbol.iterator]()):n,"%SharedArrayBuffer%":"undefined"==typeof SharedArrayBuffer?n:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":E&&M?M(""[Symbol.iterator]()):n,"%Symbol%":E?Symbol:n,"%SyntaxError%":c,"%ThrowTypeError%":_,"%TypedArray%":j,"%TypeError%":f,"%Uint8Array%":"undefined"==typeof Uint8Array?n:Uint8Array,"%Uint8ClampedArray%":"undefined"==typeof Uint8ClampedArray?n:Uint8ClampedArray,"%Uint16Array%":"undefined"==typeof Uint16Array?n:Uint16Array,"%Uint32Array%":"undefined"==typeof Uint32Array?n:Uint32Array,"%URIError%":u,"%WeakMap%":"undefined"==typeof WeakMap?n:WeakMap,"%WeakRef%":"undefined"==typeof WeakRef?n:WeakRef,"%WeakSet%":"undefined"==typeof WeakSet?n:WeakSet,"%Function.prototype.call%":R,"%Function.prototype.apply%":T,"%Object.defineProperty%":S,"%Object.getPrototypeOf%":N,"%Math.abs%":d,"%Math.floor%":h,"%Math.max%":p,"%Math.min%":b,"%Math.pow%":m,"%Math.round%":g,"%Math.sign%":y,"%Reflect.getPrototypeOf%":A};if(M)try{null.error}catch(e){var L=M(M(e));I["%Error.prototype%"]=L}var P=function e(t){var r;if("%AsyncFunction%"===t)r=x("async function () {}");else if("%GeneratorFunction%"===t)r=x("function* () {}");else if("%AsyncGeneratorFunction%"===t)r=x("async function* () {}");else if("%AsyncGenerator%"===t){var n=e("%AsyncGeneratorFunction%");n&&(r=n.prototype)}else if("%AsyncIteratorPrototype%"===t){var i=e("%AsyncGenerator%");i&&M&&(r=M(i.prototype))}return I[t]=r,r},B={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},O=r(1212),D=r(3270),z=O.call(R,Array.prototype.concat),F=O.call(T,Array.prototype.splice),U=O.call(R,String.prototype.replace),$=O.call(R,String.prototype.slice),H=O.call(R,RegExp.prototype.exec),q=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,V=/\\(\\)?/g,W=function(e){var t=$(e,0,1),r=$(e,-1);if("%"===t&&"%"!==r)throw new c("invalid intrinsic syntax, expected closing `%`");if("%"===r&&"%"!==t)throw new c("invalid intrinsic syntax, expected opening `%`");var n=[];return U(e,q,function(e,t,r,i){n[n.length]=r?U(i,V,"$1"):t||e}),n},K=function(e,t){var r,n=e;if(D(B,n)&&(n="%"+(r=B[n])[0]+"%"),D(I,n)){var i=I[n];if(i===C&&(i=P(n)),void 0===i&&!t)throw new f("intrinsic "+e+" exists, but is not available. Please file an issue!");return{alias:r,name:n,value:i}}throw new c("intrinsic "+e+" does not exist!")};e.exports=function(e,t){if("string"!=typeof e||0===e.length)throw new f("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!=typeof t)throw new f('"allowMissing" argument must be a boolean');if(null===H(/^%?[^%]*%?$/,e))throw new c("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var r=W(e),n=r.length>0?r[0]:"",i=K("%"+n+"%",t),a=i.name,o=i.value,s=!1,l=i.alias;l&&(n=l[0],F(r,z([0,1],l)));for(var u=1,d=!0;u<r.length;u+=1){var h=r[u],p=$(h,0,1),b=$(h,-1);if(('"'===p||"'"===p||"`"===p||'"'===b||"'"===b||"`"===b)&&p!==b)throw new c("property names with quotes must have matching quotes");if("constructor"!==h&&d||(s=!0),n+="."+h,D(I,a="%"+n+"%"))o=I[a];else if(null!=o){if(!(h in o)){if(!t)throw new f("base intrinsic for "+e+" exists, but the property is not available.");return}if(w&&u+1>=r.length){var m=w(o,h);o=(d=!!m)&&"get"in m&&!("originalValue"in m.get)?m.get:o[h]}else d=D(o,h),o=o[h];d&&!s&&(I[a]=o)}}return o}},7823:function(e,t,r){"use strict";e.exports=r(2811).getPrototypeOf||null},7904:function(e){"use strict";e.exports="undefined"!=typeof Reflect&&Reflect.getPrototypeOf||null},699:function(e,t,r){"use strict";var n=r(7904),i=r(7823),a=r(6211);e.exports=n?function(e){return n(e)}:i?function(e){if(!e||"object"!=typeof e&&"function"!=typeof e)throw TypeError("getProto: not an object");return i(e)}:a?function(e){return a(e)}:null},4596:function(e){"use strict";e.exports=Object.getOwnPropertyDescriptor},3990:function(e,t,r){"use strict";var n=r(4596);if(n)try{n([],"length")}catch(e){n=null}e.exports=n},7122:function(e,t,r){"use strict";var n=r(446),i=function(){return!!n};i.hasArrayLengthDefineBug=function(){if(!n)return null;try{return 1!==n([],"length",{value:1}).length}catch(e){return!0}},e.exports=i},9942:function(e,t,r){"use strict";var n="undefined"!=typeof Symbol&&Symbol,i=r(3773);e.exports=function(){return"function"==typeof n&&"function"==typeof Symbol&&"symbol"==typeof n("foo")&&"symbol"==typeof Symbol("bar")&&i()}},3773:function(e){"use strict";e.exports=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"==typeof Symbol.iterator)return!0;var e={},t=Symbol("test"),r=Object(t);if("string"==typeof t||"[object Symbol]"!==Object.prototype.toString.call(t)||"[object Symbol]"!==Object.prototype.toString.call(r))return!1;var n=42;for(t in e[t]=n,e)return!1;if("function"==typeof Object.keys&&0!==Object.keys(e).length||"function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(e).length)return!1;var i=Object.getOwnPropertySymbols(e);if(1!==i.length||i[0]!==t||!Object.prototype.propertyIsEnumerable.call(e,t))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){var a=Object.getOwnPropertyDescriptor(e,t);if(a.value!==n||!0!==a.enumerable)return!1}return!0}},4871:function(e,t,r){"use strict";var n="undefined"!=typeof Symbol&&Symbol,i=r(5960);e.exports=function(){return"function"==typeof n&&"function"==typeof Symbol&&"symbol"==typeof n("foo")&&"symbol"==typeof Symbol("bar")&&i()}},5960:function(e){"use strict";e.exports=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"==typeof Symbol.iterator)return!0;var e={},t=Symbol("test"),r=Object(t);if("string"==typeof t||"[object Symbol]"!==Object.prototype.toString.call(t)||"[object Symbol]"!==Object.prototype.toString.call(r))return!1;var n=42;for(var i in e[t]=n,e)return!1;if("function"==typeof Object.keys&&0!==Object.keys(e).length||"function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(e).length)return!1;var a=Object.getOwnPropertySymbols(e);if(1!==a.length||a[0]!==t||!Object.prototype.propertyIsEnumerable.call(e,t))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){var o=Object.getOwnPropertyDescriptor(e,t);if(o.value!==n||!0!==o.enumerable)return!1}return!0}},3270:function(e,t,r){"use strict";var n=Function.prototype.call,i=Object.prototype.hasOwnProperty;e.exports=r(1212).call(n,i)},3782:function(e){"function"==typeof Object.create?e.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:e.exports=function(e,t){if(t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}}},5157:function(e){"use strict";var t="function"==typeof Symbol&&"symbol"==typeof Symbol.toStringTag,r=Object.prototype.toString,n=function(e){return(!t||!e||"object"!=typeof e||!(Symbol.toStringTag in e))&&"[object Arguments]"===r.call(e)},i=function(e){return!!n(e)||null!==e&&"object"==typeof e&&"number"==typeof e.length&&e.length>=0&&"[object Array]"!==r.call(e)&&"[object Function]"===r.call(e.callee)},a=function(){return n(arguments)}();n.isLegacyArguments=i,e.exports=a?n:i},3391:function(e){"use strict";var t=Object.prototype.toString,r=Function.prototype.toString,n=/^\s*(?:function)?\*/,i="function"==typeof Symbol&&"symbol"==typeof Symbol.toStringTag,a=Object.getPrototypeOf,o=function(){if(!i)return!1;try{return Function("return function*() {}")()}catch(e){}}(),s=o?a(o):{};e.exports=function(e){return"function"==typeof e&&(!!n.test(r.call(e))||(i?a(e)===s:"[object GeneratorFunction]"===t.call(e)))}},994:function(t,r,n){"use strict";var i=n(6144),a=n(1349),o=n(516),s=o("Object.prototype.toString"),l=n(9942)()&&"symbol"==typeof Symbol.toStringTag,c=a(),f=o("Array.prototype.indexOf",!0)||function(e,t){for(var r=0;r<e.length;r+=1)if(e[r]===t)return r;return -1},u=o("String.prototype.slice"),d={},h=n(2154),p=Object.getPrototypeOf;l&&h&&p&&i(c,function(t){var r=new e.g[t];if(!(Symbol.toStringTag in r))throw EvalError("this engine has support for Symbol.toStringTag, but "+t+" does not have the property! Please report this.");var n=p(r),i=h(n,Symbol.toStringTag);i||(i=h(p(n),Symbol.toStringTag)),d[t]=i.get});var b=function(e){var t=!1;return i(d,function(r,n){if(!t)try{t=r.call(e)===n}catch(e){}}),t};t.exports=function(e){return!!e&&"object"==typeof e&&(l?!!h&&b(e):f(c,u(s(e),8,-1))>-1)}},7173:function(e){"use strict";e.exports=Math.abs},847:function(e){"use strict";e.exports=Math.floor},219:function(e){"use strict";e.exports=Number.isNaN||function(e){return e!=e}},2916:function(e){"use strict";e.exports=Math.max},9882:function(e){"use strict";e.exports=Math.min},3291:function(e){"use strict";e.exports=Math.pow},553:function(e){"use strict";e.exports=Math.round},8629:function(e,t,r){"use strict";var n=r(219);e.exports=function(e){return n(e)||0===e?e:e<0?-1:1}},3143:function(e,t,r){"use strict";var n=r(3197),i=r(819),a=r(7122)(),o=r(3990),s=r(8202),l=n("%Math.floor%");e.exports=function(e,t){if("function"!=typeof e)throw new s("`fn` is not a function");if("number"!=typeof t||t<0||t>0xffffffff||l(t)!==t)throw new s("`length` must be a positive 32-bit integer");var r=arguments.length>2&&!!arguments[2],n=!0,c=!0;if("length"in e&&o){var f=o(e,"length");f&&!f.configurable&&(n=!1),f&&!f.writable&&(c=!1)}return(n||c||!r)&&(a?i(e,"length",t,!0,!0):i(e,"length",t)),e}},2369:function(e){e.exports=function(e){return e instanceof n.Buffer}},5584:function(e,t,r){"use strict";var n=r(5157),i=r(3391),a=r(1490),o=r(994);function s(e){return e.call.bind(e)}var l="undefined"!=typeof BigInt,c="undefined"!=typeof Symbol,f=s(Object.prototype.toString),u=s(Number.prototype.valueOf),d=s(String.prototype.valueOf),h=s(Boolean.prototype.valueOf);if(l)var p=s(BigInt.prototype.valueOf);if(c)var b=s(Symbol.prototype.valueOf);function m(e,t){if("object"!=typeof e)return!1;try{return t(e),!0}catch(e){return!1}}function g(e){return"[object Map]"===f(e)}function y(e){return"[object Set]"===f(e)}function v(e){return"[object WeakMap]"===f(e)}function x(e){return"[object WeakSet]"===f(e)}function w(e){return"[object ArrayBuffer]"===f(e)}function S(e){return"undefined"!=typeof ArrayBuffer&&(w.working?w(e):e instanceof ArrayBuffer)}function k(e){return"[object DataView]"===f(e)}function _(e){return"undefined"!=typeof DataView&&(k.working?k(e):e instanceof DataView)}t.isArgumentsObject=n,t.isGeneratorFunction=i,t.isTypedArray=o,t.isPromise=function(e){return"undefined"!=typeof Promise&&e instanceof Promise||null!==e&&"object"==typeof e&&"function"==typeof e.then&&"function"==typeof e.catch},t.isArrayBufferView=function(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):o(e)||_(e)},t.isUint8Array=function(e){return"Uint8Array"===a(e)},t.isUint8ClampedArray=function(e){return"Uint8ClampedArray"===a(e)},t.isUint16Array=function(e){return"Uint16Array"===a(e)},t.isUint32Array=function(e){return"Uint32Array"===a(e)},t.isInt8Array=function(e){return"Int8Array"===a(e)},t.isInt16Array=function(e){return"Int16Array"===a(e)},t.isInt32Array=function(e){return"Int32Array"===a(e)},t.isFloat32Array=function(e){return"Float32Array"===a(e)},t.isFloat64Array=function(e){return"Float64Array"===a(e)},t.isBigInt64Array=function(e){return"BigInt64Array"===a(e)},t.isBigUint64Array=function(e){return"BigUint64Array"===a(e)},g.working="undefined"!=typeof Map&&g(new Map),t.isMap=function(e){return"undefined"!=typeof Map&&(g.working?g(e):e instanceof Map)},y.working="undefined"!=typeof Set&&y(new Set),t.isSet=function(e){return"undefined"!=typeof Set&&(y.working?y(e):e instanceof Set)},v.working="undefined"!=typeof WeakMap&&v(new WeakMap),t.isWeakMap=function(e){return"undefined"!=typeof WeakMap&&(v.working?v(e):e instanceof WeakMap)},x.working="undefined"!=typeof WeakSet&&x(new WeakSet),t.isWeakSet=function(e){return x(e)},w.working="undefined"!=typeof ArrayBuffer&&w(new ArrayBuffer),t.isArrayBuffer=S,k.working="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView&&k(new DataView(new ArrayBuffer(1),0,1)),t.isDataView=_;var E="undefined"!=typeof SharedArrayBuffer?SharedArrayBuffer:void 0;function M(e){return"[object SharedArrayBuffer]"===f(e)}function N(e){return void 0!==E&&(void 0===M.working&&(M.working=M(new E)),M.working?M(e):e instanceof E)}function A(e){return m(e,u)}function T(e){return m(e,d)}function R(e){return m(e,h)}function C(e){return l&&m(e,p)}function j(e){return c&&m(e,b)}t.isSharedArrayBuffer=N,t.isAsyncFunction=function(e){return"[object AsyncFunction]"===f(e)},t.isMapIterator=function(e){return"[object Map Iterator]"===f(e)},t.isSetIterator=function(e){return"[object Set Iterator]"===f(e)},t.isGeneratorObject=function(e){return"[object Generator]"===f(e)},t.isWebAssemblyCompiledModule=function(e){return"[object WebAssembly.Module]"===f(e)},t.isNumberObject=A,t.isStringObject=T,t.isBooleanObject=R,t.isBigIntObject=C,t.isSymbolObject=j,t.isBoxedPrimitive=function(e){return A(e)||T(e)||R(e)||C(e)||j(e)},t.isAnyArrayBuffer=function(e){return"undefined"!=typeof Uint8Array&&(S(e)||N(e))},["isProxy","isExternal","isModuleNamespaceObject"].forEach(function(e){Object.defineProperty(t,e,{enumerable:!1,value:function(){throw Error(e+" is not supported in userland")}})})},8177:function(e,t,r){var n=Object.getOwnPropertyDescriptors||function(e){for(var t=Object.keys(e),r={},n=0;n<t.length;n++)r[t[n]]=Object.getOwnPropertyDescriptor(e,t[n]);return r},a=/%[sdj%]/g;t.format=function(e){if(!k(e)){for(var t=[],r=0;r<arguments.length;r++)t.push(c(arguments[r]));return t.join(" ")}for(var r=1,n=arguments,i=n.length,o=String(e).replace(a,function(e){if("%%"===e)return"%";if(r>=i)return e;switch(e){case"%s":return String(n[r++]);case"%d":return Number(n[r++]);case"%j":try{return JSON.stringify(n[r++])}catch(e){return"[Circular]"}default:return e}}),s=n[r];r<i;s=n[++r])w(s)||!M(s)?o+=" "+s:o+=" "+c(s);return o},t.deprecate=function(e,r){if(void 0!==i.default&&!0===i.default.noDeprecation)return e;if(void 0===i.default)return function(){return t.deprecate(e,r).apply(this,arguments)};var n=!1;return function(){if(!n){if(i.default.throwDeprecation)throw Error(r);i.default.traceDeprecation?console.trace(r):console.error(r),n=!0}return e.apply(this,arguments)}};var o={},s=/^$/;if(i.default.env.NODE_DEBUG){var l=i.default.env.NODE_DEBUG;s=RegExp("^"+(l=l.replace(/[|\\{}()[\]^$+?.]/g,"\\$&").replace(/\*/g,".*").replace(/,/g,"$|^").toUpperCase())+"$","i")}function c(e,r){var n={seen:[],stylize:u};return arguments.length>=3&&(n.depth=arguments[2]),arguments.length>=4&&(n.colors=arguments[3]),x(r)?n.showHidden=r:r&&t._extend(n,r),_(n.showHidden)&&(n.showHidden=!1),_(n.depth)&&(n.depth=2),_(n.colors)&&(n.colors=!1),_(n.customInspect)&&(n.customInspect=!0),n.colors&&(n.stylize=f),h(n,e,n.depth)}function f(e,t){var r=c.styles[t];return r?"\x1b["+c.colors[r][0]+"m"+e+"\x1b["+c.colors[r][1]+"m":e}function u(e,t){return e}function d(e){var t={};return e.forEach(function(e,r){t[e]=!0}),t}function h(e,r,n){if(e.customInspect&&r&&T(r.inspect)&&r.inspect!==t.inspect&&!(r.constructor&&r.constructor.prototype===r)){var i,a=r.inspect(n,e);return k(a)||(a=h(e,a,n)),a}var o=p(e,r);if(o)return o;var s=Object.keys(r),l=d(s);if(e.showHidden&&(s=Object.getOwnPropertyNames(r)),A(r)&&(s.indexOf("message")>=0||s.indexOf("description")>=0))return b(r);if(0===s.length){if(T(r)){var c=r.name?": "+r.name:"";return e.stylize("[Function"+c+"]","special")}if(E(r))return e.stylize(RegExp.prototype.toString.call(r),"regexp");if(N(r))return e.stylize(Date.prototype.toString.call(r),"date");if(A(r))return b(r)}var f="",u=!1,x=["{","}"];if(v(r)&&(u=!0,x=["[","]"]),T(r)&&(f=" [Function"+(r.name?": "+r.name:"")+"]"),E(r)&&(f=" "+RegExp.prototype.toString.call(r)),N(r)&&(f=" "+Date.prototype.toUTCString.call(r)),A(r)&&(f=" "+b(r)),0===s.length&&(!u||0==r.length))return x[0]+f+x[1];if(n<0)if(E(r))return e.stylize(RegExp.prototype.toString.call(r),"regexp");else return e.stylize("[Object]","special");return e.seen.push(r),i=u?m(e,r,n,l,s):s.map(function(t){return g(e,r,n,l,t,u)}),e.seen.pop(),y(i,f,x)}function p(e,t){if(_(t))return e.stylize("undefined","undefined");if(k(t)){var r="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(r,"string")}return S(t)?e.stylize(""+t,"number"):x(t)?e.stylize(""+t,"boolean"):w(t)?e.stylize("null","null"):void 0}function b(e){return"["+Error.prototype.toString.call(e)+"]"}function m(e,t,r,n,i){for(var a=[],o=0,s=t.length;o<s;++o)L(t,String(o))?a.push(g(e,t,r,n,String(o),!0)):a.push("");return i.forEach(function(i){i.match(/^\d+$/)||a.push(g(e,t,r,n,i,!0))}),a}function g(e,t,r,n,i,a){var o,s,l;if((l=Object.getOwnPropertyDescriptor(t,i)||{value:t[i]}).get?s=l.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):l.set&&(s=e.stylize("[Setter]","special")),L(n,i)||(o="["+i+"]"),!s&&(0>e.seen.indexOf(l.value)?(s=w(r)?h(e,l.value,null):h(e,l.value,r-1)).indexOf("\n")>-1&&(s=a?s.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+s.split("\n").map(function(e){return"   "+e}).join("\n")):s=e.stylize("[Circular]","special")),_(o)){if(a&&i.match(/^\d+$/))return s;(o=JSON.stringify(""+i)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(o=o.substr(1,o.length-2),o=e.stylize(o,"name")):(o=o.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),o=e.stylize(o,"string"))}return o+": "+s}function y(e,t,r){var n=0;return e.reduce(function(e,t){return n++,t.indexOf("\n")>=0&&n++,e+t.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60?r[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+r[1]:r[0]+t+" "+e.join(", ")+" "+r[1]}function v(e){return Array.isArray(e)}function x(e){return"boolean"==typeof e}function w(e){return null===e}function S(e){return"number"==typeof e}function k(e){return"string"==typeof e}function _(e){return void 0===e}function E(e){return M(e)&&"[object RegExp]"===R(e)}function M(e){return"object"==typeof e&&null!==e}function N(e){return M(e)&&"[object Date]"===R(e)}function A(e){return M(e)&&("[object Error]"===R(e)||e instanceof Error)}function T(e){return"function"==typeof e}function R(e){return Object.prototype.toString.call(e)}function C(e){return e<10?"0"+e.toString(10):e.toString(10)}t.debuglog=function(e){if(!o[e=e.toUpperCase()])if(s.test(e)){var r=i.default.pid;o[e]=function(){var n=t.format.apply(t,arguments);console.error("%s %d: %s",e,r,n)}}else o[e]=function(){};return o[e]},t.inspect=c,c.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},c.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},t.types=r(5584),t.isArray=v,t.isBoolean=x,t.isNull=w,t.isNullOrUndefined=function(e){return null==e},t.isNumber=S,t.isString=k,t.isSymbol=function(e){return"symbol"==typeof e},t.isUndefined=_,t.isRegExp=E,t.types.isRegExp=E,t.isObject=M,t.isDate=N,t.types.isDate=N,t.isError=A,t.types.isNativeError=A,t.isFunction=T,t.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},t.isBuffer=r(2369);var j=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function I(){var e=new Date,t=[C(e.getHours()),C(e.getMinutes()),C(e.getSeconds())].join(":");return[e.getDate(),j[e.getMonth()],t].join(" ")}function L(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.log=function(){console.log("%s - %s",I(),t.format.apply(t,arguments))},t.inherits=r(3782),t._extend=function(e,t){if(!t||!M(t))return e;for(var r=Object.keys(t),n=r.length;n--;)e[r[n]]=t[r[n]];return e};var P="undefined"!=typeof Symbol?Symbol("util.promisify.custom"):void 0;function B(e,t){if(!e){var r=Error("Promise was rejected with a falsy value");r.reason=e,e=r}return t(e)}t.promisify=function(e){if("function"!=typeof e)throw TypeError('The "original" argument must be of type Function');if(P&&e[P]){var t=e[P];if("function"!=typeof t)throw TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(t,P,{value:t,enumerable:!1,writable:!1,configurable:!0}),t}function t(){for(var t,r,n=new Promise(function(e,n){t=e,r=n}),i=[],a=0;a<arguments.length;a++)i.push(arguments[a]);i.push(function(e,n){e?r(e):t(n)});try{e.apply(this,i)}catch(e){r(e)}return n}return Object.setPrototypeOf(t,Object.getPrototypeOf(e)),P&&Object.defineProperty(t,P,{value:t,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(t,n(e))},t.promisify.custom=P,t.callbackify=function(e){if("function"!=typeof e)throw TypeError('The "original" argument must be of type Function');function t(){for(var t=[],r=0;r<arguments.length;r++)t.push(arguments[r]);var n=t.pop();if("function"!=typeof n)throw TypeError("The last argument must be of type Function");var a=this,o=function(){return n.apply(a,arguments)};e.apply(this,t).then(function(e){i.default.nextTick(o.bind(null,null,e))},function(e){i.default.nextTick(B.bind(null,e,o))})}return Object.setPrototypeOf(t,Object.getPrototypeOf(e)),Object.defineProperties(t,n(e)),t}},1490:function(t,r,n){"use strict";var i=n(6144),a=n(1349),o=n(516),s=o("Object.prototype.toString"),l=n(9942)()&&"symbol"==typeof Symbol.toStringTag,c=a(),f=o("String.prototype.slice"),u={},d=n(2154),h=Object.getPrototypeOf;l&&d&&h&&i(c,function(t){if("function"==typeof e.g[t]){var r=new e.g[t];if(!(Symbol.toStringTag in r))throw EvalError("this engine has support for Symbol.toStringTag, but "+t+" does not have the property! Please report this.");var n=h(r),i=d(n,Symbol.toStringTag);i||(i=d(h(n),Symbol.toStringTag)),u[t]=i.get}});var p=function(e){var t=!1;return i(u,function(r,n){if(!t)try{var i=r.call(e);i===n&&(t=i)}catch(e){}}),t},b=n(994);t.exports=function(e){return!!b(e)&&(l?p(e):f(s(e),8,-1))}},1349:function(t,r,n){"use strict";var i=n(8992);t.exports=function(){return i(["BigInt64Array","BigUint64Array","Float32Array","Float64Array","Int16Array","Int32Array","Int8Array","Uint16Array","Uint32Array","Uint8Array","Uint8ClampedArray"],function(t){return"function"==typeof e.g[t]})}},2154:function(e,t,r){"use strict";e.exports=r(3990)}},a={};function o(e){var t=a[e];if(void 0!==t)return t.exports;var n=a[e]={exports:{}},i=!0;try{r[e](n,n.exports,o),i=!1}finally{i&&delete a[e]}return n.exports}o.ab="/ROOT/node_modules/.pnpm/next@16.0.10_@babel+core@7.28.0_react-dom@19.2.0_react@19.2.0__react@19.2.0/node_modules/next/dist/compiled/util/",t.exports=o(8177)}()},873795,(e,t,r)=>{var n=e.i(307178);!function(){var r={782:function(e){"function"==typeof Object.create?e.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:e.exports=function(e,t){if(t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}}},646:function(e){"use strict";let t={};function r(e,r,n){function i(e,t,n){return"string"==typeof r?r:r(e,t,n)}n||(n=Error);class a extends n{constructor(e,t,r){super(i(e,t,r))}}a.prototype.name=n.name,a.prototype.code=e,t[e]=a}function n(e,t){if(!Array.isArray(e))return`of ${t} ${String(e)}`;{let r=e.length;return(e=e.map(e=>String(e)),r>2)?`one of ${t} ${e.slice(0,r-1).join(", ")}, or `+e[r-1]:2===r?`one of ${t} ${e[0]} or ${e[1]}`:`of ${t} ${e[0]}`}}function i(e,t,r){return e.substr(!r||r<0?0:+r,t.length)===t}function a(e,t,r){return(void 0===r||r>e.length)&&(r=e.length),e.substring(r-t.length,r)===t}function o(e,t,r){return"number"!=typeof r&&(r=0),!(r+t.length>e.length)&&-1!==e.indexOf(t,r)}r("ERR_INVALID_OPT_VALUE",function(e,t){return'The value "'+t+'" is invalid for option "'+e+'"'},TypeError),r("ERR_INVALID_ARG_TYPE",function(e,t,r){let s,l;if("string"==typeof t&&i(t,"not ")?(s="must not be",t=t.replace(/^not /,"")):s="must be",a(e," argument"))l=`The ${e} ${s} ${n(t,"type")}`;else{let r=o(e,".")?"property":"argument";l=`The "${e}" ${r} ${s} ${n(t,"type")}`}return l+`. Received type ${typeof r}`},TypeError),r("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF"),r("ERR_METHOD_NOT_IMPLEMENTED",function(e){return"The "+e+" method is not implemented"}),r("ERR_STREAM_PREMATURE_CLOSE","Premature close"),r("ERR_STREAM_DESTROYED",function(e){return"Cannot call "+e+" after a stream was destroyed"}),r("ERR_MULTIPLE_CALLBACK","Callback called multiple times"),r("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable"),r("ERR_STREAM_WRITE_AFTER_END","write after end"),r("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),r("ERR_UNKNOWN_ENCODING",function(e){return"Unknown encoding: "+e},TypeError),r("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event"),e.exports.q=t},403:function(e,t,r){"use strict";var i=Object.keys||function(e){var t=[];for(var r in e)t.push(r);return t};e.exports=f;var a=r(709),o=r(337);r(782)(f,a);for(var s=i(o.prototype),l=0;l<s.length;l++){var c=s[l];f.prototype[c]||(f.prototype[c]=o.prototype[c])}function f(e){if(!(this instanceof f))return new f(e);a.call(this,e),o.call(this,e),this.allowHalfOpen=!0,e&&(!1===e.readable&&(this.readable=!1),!1===e.writable&&(this.writable=!1),!1===e.allowHalfOpen&&(this.allowHalfOpen=!1,this.once("end",u)))}function u(){this._writableState.ended||n.default.nextTick(d,this)}function d(e){e.end()}Object.defineProperty(f.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(f.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(f.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(f.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&this._readableState.destroyed&&this._writableState.destroyed},set:function(e){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=e,this._writableState.destroyed=e)}})},889:function(e,t,r){"use strict";e.exports=i;var n=r(170);function i(e){if(!(this instanceof i))return new i(e);n.call(this,e)}r(782)(i,n),i.prototype._transform=function(e,t,r){r(null,e)}},709:function(t,r,i){"use strict";t.exports=T,T.ReadableState=A,i(361).EventEmitter;var a,o,s,l,c,f=function(e,t){return e.listeners(t).length},u=i(678),d=i(300).Buffer,h=e.g.Uint8Array||function(){};function p(e){return d.from(e)}function b(e){return d.isBuffer(e)||e instanceof h}var m=i(837);o=m&&m.debuglog?m.debuglog("stream"):function(){};var g=i(379),y=i(25),v=i(776).getHighWaterMark,x=i(646).q,w=x.ERR_INVALID_ARG_TYPE,S=x.ERR_STREAM_PUSH_AFTER_EOF,k=x.ERR_METHOD_NOT_IMPLEMENTED,_=x.ERR_STREAM_UNSHIFT_AFTER_END_EVENT;i(782)(T,u);var E=y.errorOrDestroy,M=["error","close","destroy","pause","resume"];function N(e,t,r){if("function"==typeof e.prependListener)return e.prependListener(t,r);e._events&&e._events[t]?Array.isArray(e._events[t])?e._events[t].unshift(r):e._events[t]=[r,e._events[t]]:e.on(t,r)}function A(e,t,r){a=a||i(403),e=e||{},"boolean"!=typeof r&&(r=t instanceof a),this.objectMode=!!e.objectMode,r&&(this.objectMode=this.objectMode||!!e.readableObjectMode),this.highWaterMark=v(this,e,"readableHighWaterMark",r),this.buffer=new g,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=!1!==e.emitClose,this.autoDestroy=!!e.autoDestroy,this.destroyed=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(s||(s=i(704).s),this.decoder=new s(e.encoding),this.encoding=e.encoding)}function T(e){if(a=a||i(403),!(this instanceof T))return new T(e);var t=this instanceof a;this._readableState=new A(e,this,t),this.readable=!0,e&&("function"==typeof e.read&&(this._read=e.read),"function"==typeof e.destroy&&(this._destroy=e.destroy)),u.call(this)}function R(e,t,r,n,i){o("readableAddChunk",t);var a,s=e._readableState;if(null===t)s.reading=!1,B(e,s);else if(i||(a=j(s,t)),a)E(e,a);else if(s.objectMode||t&&t.length>0)if("string"==typeof t||s.objectMode||Object.getPrototypeOf(t)===d.prototype||(t=p(t)),n)s.endEmitted?E(e,new _):C(e,s,t,!0);else if(s.ended)E(e,new S);else{if(s.destroyed)return!1;s.reading=!1,s.decoder&&!r?(t=s.decoder.write(t),s.objectMode||0!==t.length?C(e,s,t,!1):z(e,s)):C(e,s,t,!1)}else n||(s.reading=!1,z(e,s));return!s.ended&&(s.length<s.highWaterMark||0===s.length)}function C(e,t,r,n){t.flowing&&0===t.length&&!t.sync?(t.awaitDrain=0,e.emit("data",r)):(t.length+=t.objectMode?1:r.length,n?t.buffer.unshift(r):t.buffer.push(r),t.needReadable&&O(e)),z(e,t)}function j(e,t){var r;return b(t)||"string"==typeof t||void 0===t||e.objectMode||(r=new w("chunk",["string","Buffer","Uint8Array"],t)),r}Object.defineProperty(T.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),T.prototype.destroy=y.destroy,T.prototype._undestroy=y.undestroy,T.prototype._destroy=function(e,t){t(e)},T.prototype.push=function(e,t){var r,n=this._readableState;return n.objectMode?r=!0:"string"==typeof e&&((t=t||n.defaultEncoding)!==n.encoding&&(e=d.from(e,t),t=""),r=!0),R(this,e,t,!1,r)},T.prototype.unshift=function(e){return R(this,e,null,!0,!1)},T.prototype.isPaused=function(){return!1===this._readableState.flowing},T.prototype.setEncoding=function(e){s||(s=i(704).s);var t=new s(e);this._readableState.decoder=t,this._readableState.encoding=this._readableState.decoder.encoding;for(var r=this._readableState.buffer.head,n="";null!==r;)n+=t.write(r.data),r=r.next;return this._readableState.buffer.clear(),""!==n&&this._readableState.buffer.push(n),this._readableState.length=n.length,this};var I=0x40000000;function L(e){return e>=I?e=I:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}function P(e,t){if(e<=0||0===t.length&&t.ended)return 0;if(t.objectMode)return 1;if(e!=e)if(t.flowing&&t.length)return t.buffer.head.data.length;else return t.length;return(e>t.highWaterMark&&(t.highWaterMark=L(e)),e<=t.length)?e:t.ended?t.length:(t.needReadable=!0,0)}function B(e,t){if(o("onEofChunk"),!t.ended){if(t.decoder){var r=t.decoder.end();r&&r.length&&(t.buffer.push(r),t.length+=t.objectMode?1:r.length)}t.ended=!0,t.sync?O(e):(t.needReadable=!1,t.emittedReadable||(t.emittedReadable=!0,D(e)))}}function O(e){var t=e._readableState;o("emitReadable",t.needReadable,t.emittedReadable),t.needReadable=!1,t.emittedReadable||(o("emitReadable",t.flowing),t.emittedReadable=!0,n.default.nextTick(D,e))}function D(e){var t=e._readableState;o("emitReadable_",t.destroyed,t.length,t.ended),!t.destroyed&&(t.length||t.ended)&&(e.emit("readable"),t.emittedReadable=!1),t.needReadable=!t.flowing&&!t.ended&&t.length<=t.highWaterMark,W(e)}function z(e,t){t.readingMore||(t.readingMore=!0,n.default.nextTick(F,e,t))}function F(e,t){for(;!t.reading&&!t.ended&&(t.length<t.highWaterMark||t.flowing&&0===t.length);){var r=t.length;if(o("maybeReadMore read 0"),e.read(0),r===t.length)break}t.readingMore=!1}function U(e){return function(){var t=e._readableState;o("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&f(e,"data")&&(t.flowing=!0,W(e))}}function $(e){var t=e._readableState;t.readableListening=e.listenerCount("readable")>0,t.resumeScheduled&&!t.paused?t.flowing=!0:e.listenerCount("data")>0&&e.resume()}function H(e){o("readable nexttick read 0"),e.read(0)}function q(e,t){t.resumeScheduled||(t.resumeScheduled=!0,n.default.nextTick(V,e,t))}function V(e,t){o("resume",t.reading),t.reading||e.read(0),t.resumeScheduled=!1,e.emit("resume"),W(e),t.flowing&&!t.reading&&e.read(0)}function W(e){var t=e._readableState;for(o("flow",t.flowing);t.flowing&&null!==e.read(););}function K(e,t){var r;return 0===t.length?null:(t.objectMode?r=t.buffer.shift():!e||e>=t.length?(r=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.first():t.buffer.concat(t.length),t.buffer.clear()):r=t.buffer.consume(e,t.decoder),r)}function G(e){var t=e._readableState;o("endReadable",t.endEmitted),t.endEmitted||(t.ended=!0,n.default.nextTick(X,t,e))}function X(e,t){if(o("endReadableNT",e.endEmitted,e.length),!e.endEmitted&&0===e.length&&(e.endEmitted=!0,t.readable=!1,t.emit("end"),e.autoDestroy)){var r=t._writableState;(!r||r.autoDestroy&&r.finished)&&t.destroy()}}function Y(e,t){for(var r=0,n=e.length;r<n;r++)if(e[r]===t)return r;return -1}T.prototype.read=function(e){o("read",e),e=parseInt(e,10);var t,r=this._readableState,n=e;if(0!==e&&(r.emittedReadable=!1),0===e&&r.needReadable&&((0!==r.highWaterMark?r.length>=r.highWaterMark:r.length>0)||r.ended))return o("read: emitReadable",r.length,r.ended),0===r.length&&r.ended?G(this):O(this),null;if(0===(e=P(e,r))&&r.ended)return 0===r.length&&G(this),null;var i=r.needReadable;return o("need readable",i),(0===r.length||r.length-e<r.highWaterMark)&&o("length less than watermark",i=!0),r.ended||r.reading?o("reading or ended",i=!1):i&&(o("do read"),r.reading=!0,r.sync=!0,0===r.length&&(r.needReadable=!0),this._read(r.highWaterMark),r.sync=!1,r.reading||(e=P(n,r))),null===(t=e>0?K(e,r):null)?(r.needReadable=r.length<=r.highWaterMark,e=0):(r.length-=e,r.awaitDrain=0),0===r.length&&(r.ended||(r.needReadable=!0),n!==e&&r.ended&&G(this)),null!==t&&this.emit("data",t),t},T.prototype._read=function(e){E(this,new k("_read()"))},T.prototype.pipe=function(e,t){var r=this,i=this._readableState;switch(i.pipesCount){case 0:i.pipes=e;break;case 1:i.pipes=[i.pipes,e];break;default:i.pipes.push(e)}i.pipesCount+=1,o("pipe count=%d opts=%j",i.pipesCount,t);var a=t&&!1===t.end||e===n.default.stdout||e===n.default.stderr?g:l;function s(e,t){o("onunpipe"),e===r&&t&&!1===t.hasUnpiped&&(t.hasUnpiped=!0,d())}function l(){o("onend"),e.end()}i.endEmitted?n.default.nextTick(a):r.once("end",a),e.on("unpipe",s);var c=U(r);e.on("drain",c);var u=!1;function d(){o("cleanup"),e.removeListener("close",b),e.removeListener("finish",m),e.removeListener("drain",c),e.removeListener("error",p),e.removeListener("unpipe",s),r.removeListener("end",l),r.removeListener("end",g),r.removeListener("data",h),u=!0,i.awaitDrain&&(!e._writableState||e._writableState.needDrain)&&c()}function h(t){o("ondata");var n=e.write(t);o("dest.write",n),!1===n&&((1===i.pipesCount&&i.pipes===e||i.pipesCount>1&&-1!==Y(i.pipes,e))&&!u&&(o("false write response, pause",i.awaitDrain),i.awaitDrain++),r.pause())}function p(t){o("onerror",t),g(),e.removeListener("error",p),0===f(e,"error")&&E(e,t)}function b(){e.removeListener("finish",m),g()}function m(){o("onfinish"),e.removeListener("close",b),g()}function g(){o("unpipe"),r.unpipe(e)}return r.on("data",h),N(e,"error",p),e.once("close",b),e.once("finish",m),e.emit("pipe",r),i.flowing||(o("pipe resume"),r.resume()),e},T.prototype.unpipe=function(e){var t=this._readableState,r={hasUnpiped:!1};if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes||(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,r)),this;if(!e){var n=t.pipes,i=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var a=0;a<i;a++)n[a].emit("unpipe",this,{hasUnpiped:!1});return this}var o=Y(t.pipes,e);return -1===o||(t.pipes.splice(o,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,r)),this},T.prototype.on=function(e,t){var r=u.prototype.on.call(this,e,t),i=this._readableState;return"data"===e?(i.readableListening=this.listenerCount("readable")>0,!1!==i.flowing&&this.resume()):"readable"!==e||i.endEmitted||i.readableListening||(i.readableListening=i.needReadable=!0,i.flowing=!1,i.emittedReadable=!1,o("on readable",i.length,i.reading),i.length?O(this):i.reading||n.default.nextTick(H,this)),r},T.prototype.addListener=T.prototype.on,T.prototype.removeListener=function(e,t){var r=u.prototype.removeListener.call(this,e,t);return"readable"===e&&n.default.nextTick($,this),r},T.prototype.removeAllListeners=function(e){var t=u.prototype.removeAllListeners.apply(this,arguments);return("readable"===e||void 0===e)&&n.default.nextTick($,this),t},T.prototype.resume=function(){var e=this._readableState;return e.flowing||(o("resume"),e.flowing=!e.readableListening,q(this,e)),e.paused=!1,this},T.prototype.pause=function(){return o("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(o("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this},T.prototype.wrap=function(e){var t=this,r=this._readableState,n=!1;for(var i in e.on("end",function(){if(o("wrapped end"),r.decoder&&!r.ended){var e=r.decoder.end();e&&e.length&&t.push(e)}t.push(null)}),e.on("data",function(i){o("wrapped data"),r.decoder&&(i=r.decoder.write(i)),r.objectMode&&null==i||(r.objectMode||i&&i.length)&&(t.push(i)||(n=!0,e.pause()))}),e)void 0===this[i]&&"function"==typeof e[i]&&(this[i]=function(t){return function(){return e[t].apply(e,arguments)}}(i));for(var a=0;a<M.length;a++)e.on(M[a],this.emit.bind(this,M[a]));return this._read=function(t){o("wrapped _read",t),n&&(n=!1,e.resume())},this},"function"==typeof Symbol&&(T.prototype[Symbol.asyncIterator]=function(){return void 0===l&&(l=i(871)),l(this)}),Object.defineProperty(T.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(T.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(T.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(e){this._readableState&&(this._readableState.flowing=e)}}),T._fromList=K,Object.defineProperty(T.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}}),"function"==typeof Symbol&&(T.from=function(e,t){return void 0===c&&(c=i(727)),c(T,e,t)})},170:function(e,t,r){"use strict";e.exports=f;var n=r(646).q,i=n.ERR_METHOD_NOT_IMPLEMENTED,a=n.ERR_MULTIPLE_CALLBACK,o=n.ERR_TRANSFORM_ALREADY_TRANSFORMING,s=n.ERR_TRANSFORM_WITH_LENGTH_0,l=r(403);function c(e,t){var r=this._transformState;r.transforming=!1;var n=r.writecb;if(null===n)return this.emit("error",new a);r.writechunk=null,r.writecb=null,null!=t&&this.push(t),n(e);var i=this._readableState;i.reading=!1,(i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}function f(e){if(!(this instanceof f))return new f(e);l.call(this,e),this._transformState={afterTransform:c.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.on("prefinish",u)}function u(){var e=this;"function"!=typeof this._flush||this._readableState.destroyed?d(this,null,null):this._flush(function(t,r){d(e,t,r)})}function d(e,t,r){if(t)return e.emit("error",t);if(null!=r&&e.push(r),e._writableState.length)throw new s;if(e._transformState.transforming)throw new o;return e.push(null)}r(782)(f,l),f.prototype.push=function(e,t){return this._transformState.needTransform=!1,l.prototype.push.call(this,e,t)},f.prototype._transform=function(e,t,r){r(new i("_transform()"))},f.prototype._write=function(e,t,r){var n=this._transformState;if(n.writecb=r,n.writechunk=e,n.writeencoding=t,!n.transforming){var i=this._readableState;(n.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},f.prototype._read=function(e){var t=this._transformState;null===t.writechunk||t.transforming?t.needTransform=!0:(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform))},f.prototype._destroy=function(e,t){l.prototype._destroy.call(this,e,function(e){t(e)})}},337:function(t,r,i){"use strict";function a(e){var t=this;this.next=null,this.entry=null,this.finish=function(){V(t,e)}}t.exports=A,A.WritableState=N;var o,s,l={deprecate:i(769)},c=i(678),f=i(300).Buffer,u=e.g.Uint8Array||function(){};function d(e){return f.from(e)}function h(e){return f.isBuffer(e)||e instanceof u}var p=i(25),b=i(776).getHighWaterMark,m=i(646).q,g=m.ERR_INVALID_ARG_TYPE,y=m.ERR_METHOD_NOT_IMPLEMENTED,v=m.ERR_MULTIPLE_CALLBACK,x=m.ERR_STREAM_CANNOT_PIPE,w=m.ERR_STREAM_DESTROYED,S=m.ERR_STREAM_NULL_VALUES,k=m.ERR_STREAM_WRITE_AFTER_END,_=m.ERR_UNKNOWN_ENCODING,E=p.errorOrDestroy;function M(){}function N(e,t,r){o=o||i(403),e=e||{},"boolean"!=typeof r&&(r=t instanceof o),this.objectMode=!!e.objectMode,r&&(this.objectMode=this.objectMode||!!e.writableObjectMode),this.highWaterMark=b(this,e,"writableHighWaterMark",r),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var n=!1===e.decodeStrings;this.decodeStrings=!n,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){B(t,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=!1!==e.emitClose,this.autoDestroy=!!e.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new a(this)}function A(e){var t=this instanceof(o=o||i(403));if(!t&&!s.call(A,this))return new A(e);this._writableState=new N(e,this,t),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev),"function"==typeof e.destroy&&(this._destroy=e.destroy),"function"==typeof e.final&&(this._final=e.final)),c.call(this)}function T(e,t){var r=new k;E(e,r),n.default.nextTick(t,r)}function R(e,t,r,i){var a;return null===r?a=new S:"string"==typeof r||t.objectMode||(a=new g("chunk",["string","Buffer"],r)),!a||(E(e,a),n.default.nextTick(i,a),!1)}function C(e,t,r){return e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=f.from(t,r)),t}function j(e,t,r,n,i,a){if(!r){var o=C(t,n,i);n!==o&&(r=!0,i="buffer",n=o)}var s=t.objectMode?1:n.length;t.length+=s;var l=t.length<t.highWaterMark;if(l||(t.needDrain=!0),t.writing||t.corked){var c=t.lastBufferedRequest;t.lastBufferedRequest={chunk:n,encoding:i,isBuf:r,callback:a,next:null},c?c.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else I(e,t,!1,s,n,i,a);return l}function I(e,t,r,n,i,a,o){t.writelen=n,t.writecb=o,t.writing=!0,t.sync=!0,t.destroyed?t.onwrite(new w("write")):r?e._writev(i,t.onwrite):e._write(i,a,t.onwrite),t.sync=!1}function L(e,t,r,i,a){--t.pendingcb,r?(n.default.nextTick(a,i),n.default.nextTick(H,e,t),e._writableState.errorEmitted=!0,E(e,i)):(a(i),e._writableState.errorEmitted=!0,E(e,i),H(e,t))}function P(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}function B(e,t){var r=e._writableState,i=r.sync,a=r.writecb;if("function"!=typeof a)throw new v;if(P(r),t)L(e,r,i,t,a);else{var o=F(r)||e.destroyed;o||r.corked||r.bufferProcessing||!r.bufferedRequest||z(e,r),i?n.default.nextTick(O,e,r,o,a):O(e,r,o,a)}}function O(e,t,r,n){r||D(e,t),t.pendingcb--,n(),H(e,t)}function D(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}function z(e,t){t.bufferProcessing=!0;var r=t.bufferedRequest;if(e._writev&&r&&r.next){var n=Array(t.bufferedRequestCount),i=t.corkedRequestsFree;i.entry=r;for(var o=0,s=!0;r;)n[o]=r,r.isBuf||(s=!1),r=r.next,o+=1;n.allBuffers=s,I(e,t,!0,t.length,n,"",i.finish),t.pendingcb++,t.lastBufferedRequest=null,i.next?(t.corkedRequestsFree=i.next,i.next=null):t.corkedRequestsFree=new a(t),t.bufferedRequestCount=0}else{for(;r;){var l=r.chunk,c=r.encoding,f=r.callback,u=t.objectMode?1:l.length;if(I(e,t,!1,u,l,c,f),r=r.next,t.bufferedRequestCount--,t.writing)break}null===r&&(t.lastBufferedRequest=null)}t.bufferedRequest=r,t.bufferProcessing=!1}function F(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function U(e,t){e._final(function(r){t.pendingcb--,r&&E(e,r),t.prefinished=!0,e.emit("prefinish"),H(e,t)})}function $(e,t){t.prefinished||t.finalCalled||("function"!=typeof e._final||t.destroyed?(t.prefinished=!0,e.emit("prefinish")):(t.pendingcb++,t.finalCalled=!0,n.default.nextTick(U,e,t)))}function H(e,t){var r=F(t);if(r&&($(e,t),0===t.pendingcb)&&(t.finished=!0,e.emit("finish"),t.autoDestroy)){var n=e._readableState;(!n||n.autoDestroy&&n.endEmitted)&&e.destroy()}return r}function q(e,t,r){t.ending=!0,H(e,t),r&&(t.finished?n.default.nextTick(r):e.once("finish",r)),t.ended=!0,e.writable=!1}function V(e,t,r){var n=e.entry;for(e.entry=null;n;){var i=n.callback;t.pendingcb--,i(r),n=n.next}t.corkedRequestsFree.next=e}i(782)(A,c),N.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(N.prototype,"buffer",{get:l.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(e){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(s=Function.prototype[Symbol.hasInstance],Object.defineProperty(A,Symbol.hasInstance,{value:function(e){return!!s.call(this,e)||this===A&&e&&e._writableState instanceof N}})):s=function(e){return e instanceof this},A.prototype.pipe=function(){E(this,new x)},A.prototype.write=function(e,t,r){var n=this._writableState,i=!1,a=!n.objectMode&&h(e);return a&&!f.isBuffer(e)&&(e=d(e)),"function"==typeof t&&(r=t,t=null),a?t="buffer":t||(t=n.defaultEncoding),"function"!=typeof r&&(r=M),n.ending?T(this,r):(a||R(this,n,e,r))&&(n.pendingcb++,i=j(this,n,a,e,t,r)),i},A.prototype.cork=function(){this._writableState.corked++},A.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.bufferProcessing||!e.bufferedRequest||z(this,e))},A.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new _(e);return this._writableState.defaultEncoding=e,this},Object.defineProperty(A.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(A.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),A.prototype._write=function(e,t,r){r(new y("_write()"))},A.prototype._writev=null,A.prototype.end=function(e,t,r){var n=this._writableState;return"function"==typeof e?(r=e,e=null,t=null):"function"==typeof t&&(r=t,t=null),null!=e&&this.write(e,t),n.corked&&(n.corked=1,this.uncork()),n.ending||q(this,n,r),this},Object.defineProperty(A.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(A.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}}),A.prototype.destroy=p.destroy,A.prototype._undestroy=p.undestroy,A.prototype._destroy=function(e,t){t(e)}},871:function(e,t,r){"use strict";function i(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var a,o=r(698),s=Symbol("lastResolve"),l=Symbol("lastReject"),c=Symbol("error"),f=Symbol("ended"),u=Symbol("lastPromise"),d=Symbol("handlePromise"),h=Symbol("stream");function p(e,t){return{value:e,done:t}}function b(e){var t=e[s];if(null!==t){var r=e[h].read();null!==r&&(e[u]=null,e[s]=null,e[l]=null,t(p(r,!1)))}}function m(e){n.default.nextTick(b,e)}function g(e,t){return function(r,n){e.then(function(){t[f]?r(p(void 0,!0)):t[d](r,n)},n)}}var y=Object.getPrototypeOf(function(){}),v=Object.setPrototypeOf((i(a={get stream(){return this[h]},next:function(){var e,t=this,r=this[c];if(null!==r)return Promise.reject(r);if(this[f])return Promise.resolve(p(void 0,!0));if(this[h].destroyed)return new Promise(function(e,r){n.default.nextTick(function(){t[c]?r(t[c]):e(p(void 0,!0))})});var i=this[u];if(i)e=new Promise(g(i,this));else{var a=this[h].read();if(null!==a)return Promise.resolve(p(a,!1));e=new Promise(this[d])}return this[u]=e,e}},Symbol.asyncIterator,function(){return this}),i(a,"return",function(){var e=this;return new Promise(function(t,r){e[h].destroy(null,function(e){e?r(e):t(p(void 0,!0))})})}),a),y);e.exports=function(e){var t,r=Object.create(v,(i(t={},h,{value:e,writable:!0}),i(t,s,{value:null,writable:!0}),i(t,l,{value:null,writable:!0}),i(t,c,{value:null,writable:!0}),i(t,f,{value:e._readableState.endEmitted,writable:!0}),i(t,d,{value:function(e,t){var n=r[h].read();n?(r[u]=null,r[s]=null,r[l]=null,e(p(n,!1))):(r[s]=e,r[l]=t)},writable:!0}),t));return r[u]=null,o(e,function(e){if(e&&"ERR_STREAM_PREMATURE_CLOSE"!==e.code){var t=r[l];null!==t&&(r[u]=null,r[s]=null,r[l]=null,t(e)),r[c]=e;return}var n=r[s];null!==n&&(r[u]=null,r[s]=null,r[l]=null,n(p(void 0,!0))),r[f]=!0}),e.on("readable",m.bind(null,r)),r}},379:function(e,t,r){"use strict";function n(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?n(Object(r),!0).forEach(function(t){a(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):n(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}function s(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function l(e,t,r){return t&&s(e.prototype,t),r&&s(e,r),e}var c=r(300).Buffer,f=r(837).inspect,u=f&&f.custom||"inspect";function d(e,t,r){c.prototype.copy.call(e,t,r)}e.exports=function(){function e(){o(this,e),this.head=null,this.tail=null,this.length=0}return l(e,[{key:"push",value:function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length}},{key:"unshift",value:function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length}},{key:"shift",value:function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(e){if(0===this.length)return"";for(var t=this.head,r=""+t.data;t=t.next;)r+=e+t.data;return r}},{key:"concat",value:function(e){if(0===this.length)return c.alloc(0);for(var t=c.allocUnsafe(e>>>0),r=this.head,n=0;r;)d(r.data,t,n),n+=r.data.length,r=r.next;return t}},{key:"consume",value:function(e,t){var r;return e<this.head.data.length?(r=this.head.data.slice(0,e),this.head.data=this.head.data.slice(e)):r=e===this.head.data.length?this.shift():t?this._getString(e):this._getBuffer(e),r}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(e){var t=this.head,r=1,n=t.data;for(e-=n.length;t=t.next;){var i=t.data,a=e>i.length?i.length:e;if(a===i.length?n+=i:n+=i.slice(0,e),0==(e-=a)){a===i.length?(++r,t.next?this.head=t.next:this.head=this.tail=null):(this.head=t,t.data=i.slice(a));break}++r}return this.length-=r,n}},{key:"_getBuffer",value:function(e){var t=c.allocUnsafe(e),r=this.head,n=1;for(r.data.copy(t),e-=r.data.length;r=r.next;){var i=r.data,a=e>i.length?i.length:e;if(i.copy(t,t.length-e,0,a),0==(e-=a)){a===i.length?(++n,r.next?this.head=r.next:this.head=this.tail=null):(this.head=r,r.data=i.slice(a));break}++n}return this.length-=n,t}},{key:u,value:function(e,t){return f(this,i({},t,{depth:0,customInspect:!1}))}}]),e}()},25:function(e){"use strict";function t(e,t){i(e,t),r(e)}function r(e){e._writableState&&!e._writableState.emitClose||(!e._readableState||e._readableState.emitClose)&&e.emit("close")}function i(e,t){e.emit("error",t)}e.exports={destroy:function(e,a){var o=this,s=this._readableState&&this._readableState.destroyed,l=this._writableState&&this._writableState.destroyed;return s||l?a?a(e):e&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,n.default.nextTick(i,this,e)):n.default.nextTick(i,this,e)):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(e||null,function(e){!a&&e?o._writableState?o._writableState.errorEmitted?n.default.nextTick(r,o):(o._writableState.errorEmitted=!0,n.default.nextTick(t,o,e)):n.default.nextTick(t,o,e):a?(n.default.nextTick(r,o),a(e)):n.default.nextTick(r,o)})),this},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)},errorOrDestroy:function(e,t){var r=e._readableState,n=e._writableState;r&&r.autoDestroy||n&&n.autoDestroy?e.destroy(t):e.emit("error",t)}}},698:function(e,t,r){"use strict";var n=r(646).q.ERR_STREAM_PREMATURE_CLOSE;function i(e){var t=!1;return function(){if(!t){t=!0;for(var r=arguments.length,n=Array(r),i=0;i<r;i++)n[i]=arguments[i];e.apply(this,n)}}}function a(){}function o(e){return e.setHeader&&"function"==typeof e.abort}function s(e,t,r){if("function"==typeof t)return s(e,null,t);t||(t={}),r=i(r||a);var l=t.readable||!1!==t.readable&&e.readable,c=t.writable||!1!==t.writable&&e.writable,f=function(){e.writable||d()},u=e._writableState&&e._writableState.finished,d=function(){c=!1,u=!0,l||r.call(e)},h=e._readableState&&e._readableState.endEmitted,p=function(){l=!1,h=!0,c||r.call(e)},b=function(t){r.call(e,t)},m=function(){var t;return l&&!h?(e._readableState&&e._readableState.ended||(t=new n),r.call(e,t)):c&&!u?(e._writableState&&e._writableState.ended||(t=new n),r.call(e,t)):void 0},g=function(){e.req.on("finish",d)};return o(e)?(e.on("complete",d),e.on("abort",m),e.req?g():e.on("request",g)):c&&!e._writableState&&(e.on("end",f),e.on("close",f)),e.on("end",p),e.on("finish",d),!1!==t.error&&e.on("error",b),e.on("close",m),function(){e.removeListener("complete",d),e.removeListener("abort",m),e.removeListener("request",g),e.req&&e.req.removeListener("finish",d),e.removeListener("end",f),e.removeListener("close",f),e.removeListener("finish",d),e.removeListener("end",p),e.removeListener("error",b),e.removeListener("close",m)}}e.exports=s},727:function(e,t,r){"use strict";function n(e,t,r,n,i,a,o){try{var s=e[a](o),l=s.value}catch(e){r(e);return}s.done?t(l):Promise.resolve(l).then(n,i)}function i(e){return function(){var t=this,r=arguments;return new Promise(function(i,a){var o=e.apply(t,r);function s(e){n(o,i,a,s,l,"next",e)}function l(e){n(o,i,a,s,l,"throw",e)}s(void 0)})}}function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function o(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),!0).forEach(function(t){s(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function s(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var l=r(646).q.ERR_INVALID_ARG_TYPE;e.exports=function(e,t,r){if(t&&"function"==typeof t.next)n=t;else if(t&&t[Symbol.asyncIterator])n=t[Symbol.asyncIterator]();else if(t&&t[Symbol.iterator])n=t[Symbol.iterator]();else throw new l("iterable",["Iterable"],t);var n,a=new e(o({objectMode:!0},r)),s=!1;function c(){return f.apply(this,arguments)}function f(){return(f=i(function*(){try{var e=yield n.next(),t=e.value;e.done?a.push(null):a.push((yield t))?c():s=!1}catch(e){a.destroy(e)}})).apply(this,arguments)}return a._read=function(){s||(s=!0,c())},a}},442:function(e,t,r){"use strict";function n(e){var t=!1;return function(){t||(t=!0,e.apply(void 0,arguments))}}var i,a=r(646).q,o=a.ERR_MISSING_ARGS,s=a.ERR_STREAM_DESTROYED;function l(e){if(e)throw e}function c(e){return e.setHeader&&"function"==typeof e.abort}function f(e,t,a,o){o=n(o);var l=!1;e.on("close",function(){l=!0}),void 0===i&&(i=r(698)),i(e,{readable:t,writable:a},function(e){if(e)return o(e);l=!0,o()});var f=!1;return function(t){if(!l&&!f){if(f=!0,c(e))return e.abort();if("function"==typeof e.destroy)return e.destroy();o(t||new s("pipe"))}}}function u(e){e()}function d(e,t){return e.pipe(t)}function h(e){return e.length&&"function"==typeof e[e.length-1]?e.pop():l}e.exports=function(){for(var e,t=arguments.length,r=Array(t),n=0;n<t;n++)r[n]=arguments[n];var i=h(r);if(Array.isArray(r[0])&&(r=r[0]),r.length<2)throw new o("streams");var a=r.map(function(t,n){var o=n<r.length-1;return f(t,o,n>0,function(t){e||(e=t),t&&a.forEach(u),o||(a.forEach(u),i(e))})});return r.reduce(d)}},776:function(e,t,r){"use strict";var n=r(646).q.ERR_INVALID_OPT_VALUE;function i(e,t,r){return null!=e.highWaterMark?e.highWaterMark:t?e[r]:null}e.exports={getHighWaterMark:function(e,t,r,a){var o=i(t,a,r);if(null!=o){if(!(isFinite(o)&&Math.floor(o)===o)||o<0)throw new n(a?r:"highWaterMark",o);return Math.floor(o)}return e.objectMode?16:16384}}},678:function(e,t,r){e.exports=r(781)},55:function(e,t,r){var n=r(300),i=n.Buffer;function a(e,t){for(var r in e)t[r]=e[r]}function o(e,t,r){return i(e,t,r)}i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?e.exports=n:(a(n,t),t.Buffer=o),o.prototype=Object.create(i.prototype),a(i,o),o.from=function(e,t,r){if("number"==typeof e)throw TypeError("Argument must not be a number");return i(e,t,r)},o.alloc=function(e,t,r){if("number"!=typeof e)throw TypeError("Argument must be a number");var n=i(e);return void 0!==t?"string"==typeof r?n.fill(t,r):n.fill(t):n.fill(0),n},o.allocUnsafe=function(e){if("number"!=typeof e)throw TypeError("Argument must be a number");return i(e)},o.allocUnsafeSlow=function(e){if("number"!=typeof e)throw TypeError("Argument must be a number");return n.SlowBuffer(e)}},173:function(e,t,r){e.exports=i;var n=r(361).EventEmitter;function i(){n.call(this)}r(782)(i,n),i.Readable=r(709),i.Writable=r(337),i.Duplex=r(403),i.Transform=r(170),i.PassThrough=r(889),i.finished=r(698),i.pipeline=r(442),i.Stream=i,i.prototype.pipe=function(e,t){var r=this;function i(t){e.writable&&!1===e.write(t)&&r.pause&&r.pause()}function a(){r.readable&&r.resume&&r.resume()}r.on("data",i),e.on("drain",a),e._isStdio||t&&!1===t.end||(r.on("end",s),r.on("close",l));var o=!1;function s(){o||(o=!0,e.end())}function l(){o||(o=!0,"function"==typeof e.destroy&&e.destroy())}function c(e){if(f(),0===n.listenerCount(this,"error"))throw e}function f(){r.removeListener("data",i),e.removeListener("drain",a),r.removeListener("end",s),r.removeListener("close",l),r.removeListener("error",c),e.removeListener("error",c),r.removeListener("end",f),r.removeListener("close",f),e.removeListener("close",f)}return r.on("error",c),e.on("error",c),r.on("end",f),r.on("close",f),e.on("close",f),e.emit("pipe",r),e}},704:function(e,t,r){"use strict";var n=r(55).Buffer,i=n.isEncoding||function(e){switch((e=""+e)&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function a(e){var t;if(!e)return"utf8";for(;;)switch(e){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:if(t)return;e=(""+e).toLowerCase(),t=!0}}function o(e){var t=a(e);if("string"!=typeof t&&(n.isEncoding===i||!i(e)))throw Error("Unknown encoding: "+e);return t||e}function s(e){var t;switch(this.encoding=o(e),this.encoding){case"utf16le":this.text=p,this.end=b,t=4;break;case"utf8":this.fillLast=u,t=4;break;case"base64":this.text=m,this.end=g,t=3;break;default:this.write=y,this.end=v;return}this.lastNeed=0,this.lastTotal=0,this.lastChar=n.allocUnsafe(t)}function l(e){return e<=127?0:e>>5==6?2:e>>4==14?3:e>>3==30?4:e>>6==2?-1:-2}function c(e,t,r){var n=t.length-1;if(n<r)return 0;var i=l(t[n]);return i>=0?(i>0&&(e.lastNeed=i-1),i):--n<r||-2===i?0:(i=l(t[n]))>=0?(i>0&&(e.lastNeed=i-2),i):--n<r||-2===i?0:(i=l(t[n]))>=0?(i>0&&(2===i?i=0:e.lastNeed=i-3),i):0}function f(e,t,r){if((192&t[0])!=128)return e.lastNeed=0,"";if(e.lastNeed>1&&t.length>1){if((192&t[1])!=128)return e.lastNeed=1,"";if(e.lastNeed>2&&t.length>2&&(192&t[2])!=128)return e.lastNeed=2,""}}function u(e){var t=this.lastTotal-this.lastNeed,r=f(this,e,t);return void 0!==r?r:this.lastNeed<=e.length?(e.copy(this.lastChar,t,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):void(e.copy(this.lastChar,t,0,e.length),this.lastNeed-=e.length)}function d(e,t){var r=c(this,e,t);if(!this.lastNeed)return e.toString("utf8",t);this.lastTotal=r;var n=e.length-(r-this.lastNeed);return e.copy(this.lastChar,0,n),e.toString("utf8",t,n)}function h(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+"":t}function p(e,t){if((e.length-t)%2==0){var r=e.toString("utf16le",t);if(r){var n=r.charCodeAt(r.length-1);if(n>=55296&&n<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],r.slice(0,-1)}return r}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],e.toString("utf16le",t,e.length-1)}function b(e){var t=e&&e.length?this.write(e):"";if(this.lastNeed){var r=this.lastTotal-this.lastNeed;return t+this.lastChar.toString("utf16le",0,r)}return t}function m(e,t){var r=(e.length-t)%3;return 0===r?e.toString("base64",t):(this.lastNeed=3-r,this.lastTotal=3,1===r?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString("base64",t,e.length-r))}function g(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+this.lastChar.toString("base64",0,3-this.lastNeed):t}function y(e){return e.toString(this.encoding)}function v(e){return e&&e.length?this.write(e):""}t.s=s,s.prototype.write=function(e){var t,r;if(0===e.length)return"";if(this.lastNeed){if(void 0===(t=this.fillLast(e)))return"";r=this.lastNeed,this.lastNeed=0}else r=0;return r<e.length?t?t+this.text(e,r):this.text(e,r):t||""},s.prototype.end=h,s.prototype.text=d,s.prototype.fillLast=function(e){if(this.lastNeed<=e.length)return e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length}},769:function(t){function r(t){try{if(!e.g.localStorage)return!1}catch(e){return!1}var r=e.g.localStorage[t];return null!=r&&"true"===String(r).toLowerCase()}t.exports=function e(e,t){if(r("noDeprecation"))return e;var n=!1;return function(){if(!n){if(r("throwDeprecation"))throw Error(t);r("traceDeprecation")?console.trace(t):console.warn(t),n=!0}return e.apply(this,arguments)}}},300:function(t){"use strict";t.exports=e.r(259390)},361:function(t){"use strict";t.exports=e.r(679877)},781:function(t){"use strict";t.exports=e.r(679877).EventEmitter},837:function(t){"use strict";t.exports=e.r(561125)}},i={};function a(e){var t=i[e];if(void 0!==t)return t.exports;var n=i[e]={exports:{}},o=!0;try{r[e](n,n.exports,a),o=!1}finally{o&&delete i[e]}return n.exports}a.ab="/ROOT/node_modules/.pnpm/next@16.0.10_@babel+core@7.28.0_react-dom@19.2.0_react@19.2.0__react@19.2.0/node_modules/next/dist/compiled/stream-browserify/",t.exports=a(173)}()},309870,(e,t,r)=>{var n=e.r(259390),i=n.Buffer;function a(e,t){for(var r in e)t[r]=e[r]}function o(e,t,r){return i(e,t,r)}i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?t.exports=n:(a(n,r),r.Buffer=o),o.prototype=Object.create(i.prototype),a(i,o),o.from=function(e,t,r){if("number"==typeof e)throw TypeError("Argument must not be a number");return i(e,t,r)},o.alloc=function(e,t,r){if("number"!=typeof e)throw TypeError("Argument must be a number");var n=i(e);return void 0!==t?"string"==typeof r?n.fill(t,r):n.fill(t):n.fill(0),n},o.allocUnsafe=function(e){if("number"!=typeof e)throw TypeError("Argument must be a number");return i(e)},o.allocUnsafeSlow=function(e){if("number"!=typeof e)throw TypeError("Argument must be a number");return n.SlowBuffer(e)}},924753,(e,t,r)=>{"use strict";var n=e.r(309870).Buffer,i=n.isEncoding||function(e){switch((e=""+e)&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function a(e){var t;if(!e)return"utf8";for(;;)switch(e){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:if(t)return;e=(""+e).toLowerCase(),t=!0}}function o(e){var t=a(e);if("string"!=typeof t&&(n.isEncoding===i||!i(e)))throw Error("Unknown encoding: "+e);return t||e}function s(e){var t;switch(this.encoding=o(e),this.encoding){case"utf16le":this.text=p,this.end=b,t=4;break;case"utf8":this.fillLast=u,t=4;break;case"base64":this.text=m,this.end=g,t=3;break;default:this.write=y,this.end=v;return}this.lastNeed=0,this.lastTotal=0,this.lastChar=n.allocUnsafe(t)}function l(e){return e<=127?0:e>>5==6?2:e>>4==14?3:e>>3==30?4:e>>6==2?-1:-2}function c(e,t,r){var n=t.length-1;if(n<r)return 0;var i=l(t[n]);return i>=0?(i>0&&(e.lastNeed=i-1),i):--n<r||-2===i?0:(i=l(t[n]))>=0?(i>0&&(e.lastNeed=i-2),i):--n<r||-2===i?0:(i=l(t[n]))>=0?(i>0&&(2===i?i=0:e.lastNeed=i-3),i):0}function f(e,t,r){if((192&t[0])!=128)return e.lastNeed=0,"";if(e.lastNeed>1&&t.length>1){if((192&t[1])!=128)return e.lastNeed=1,"";if(e.lastNeed>2&&t.length>2&&(192&t[2])!=128)return e.lastNeed=2,""}}function u(e){var t=this.lastTotal-this.lastNeed,r=f(this,e,t);return void 0!==r?r:this.lastNeed<=e.length?(e.copy(this.lastChar,t,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):void(e.copy(this.lastChar,t,0,e.length),this.lastNeed-=e.length)}function d(e,t){var r=c(this,e,t);if(!this.lastNeed)return e.toString("utf8",t);this.lastTotal=r;var n=e.length-(r-this.lastNeed);return e.copy(this.lastChar,0,n),e.toString("utf8",t,n)}function h(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+"":t}function p(e,t){if((e.length-t)%2==0){var r=e.toString("utf16le",t);if(r){var n=r.charCodeAt(r.length-1);if(n>=55296&&n<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],r.slice(0,-1)}return r}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],e.toString("utf16le",t,e.length-1)}function b(e){var t=e&&e.length?this.write(e):"";if(this.lastNeed){var r=this.lastTotal-this.lastNeed;return t+this.lastChar.toString("utf16le",0,r)}return t}function m(e,t){var r=(e.length-t)%3;return 0===r?e.toString("base64",t):(this.lastNeed=3-r,this.lastTotal=3,1===r?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString("base64",t,e.length-r))}function g(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+this.lastChar.toString("base64",0,3-this.lastNeed):t}function y(e){return e.toString(this.encoding)}function v(e){return e&&e.length?this.write(e):""}r.StringDecoder=s,s.prototype.write=function(e){var t,r;if(0===e.length)return"";if(this.lastNeed){if(void 0===(t=this.fillLast(e)))return"";r=this.lastNeed,this.lastNeed=0}else r=0;return r<e.length?t?t+this.text(e,r):this.text(e,r):t||""},s.prototype.end=h,s.prototype.text=d,s.prototype.fillLast=function(e){if(this.lastNeed<=e.length)return e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length}},331023,(__turbopack_context__,module,exports)=>{!function(){var __webpack_modules__={950:function(__unused_webpack_module,exports){var indexOf=function(e,t){if(e.indexOf)return e.indexOf(t);for(var r=0;r<e.length;r++)if(e[r]===t)return r;return -1},Object_keys=function(e){if(Object.keys)return Object.keys(e);var t=[];for(var r in e)t.push(r);return t},forEach=function(e,t){if(e.forEach)return e.forEach(t);for(var r=0;r<e.length;r++)t(e[r],r,e)},defineProp=function(){try{return Object.defineProperty({},"_",{}),function(e,t,r){Object.defineProperty(e,t,{writable:!0,enumerable:!1,configurable:!0,value:r})}}catch(e){return function(e,t,r){e[t]=r}}}(),globals=["Array","Boolean","Date","Error","EvalError","Function","Infinity","JSON","Math","NaN","Number","Object","RangeError","ReferenceError","RegExp","String","SyntaxError","TypeError","URIError","decodeURI","decodeURIComponent","encodeURI","encodeURIComponent","escape","eval","isFinite","isNaN","parseFloat","parseInt","undefined","unescape"];function Context(){}Context.prototype={};var Script=exports.Script=function(e){if(!(this instanceof Script))return new Script(e);this.code=e};Script.prototype.runInContext=function(e){if(!(e instanceof Context))throw TypeError("needs a 'context' argument.");var t=document.createElement("iframe");t.style||(t.style={}),t.style.display="none",document.body.appendChild(t);var r=t.contentWindow,n=r.eval,i=r.execScript;!n&&i&&(i.call(r,"null"),n=r.eval),forEach(Object_keys(e),function(t){r[t]=e[t]}),forEach(globals,function(t){e[t]&&(r[t]=e[t])});var a=Object_keys(r),o=n.call(r,this.code);return forEach(Object_keys(r),function(t){(t in e||-1===indexOf(a,t))&&(e[t]=r[t])}),forEach(globals,function(t){t in e||defineProp(e,t,r[t])}),document.body.removeChild(t),o},Script.prototype.runInThisContext=function(){return eval(this.code)},Script.prototype.runInNewContext=function(e){var t=Script.createContext(e),r=this.runInContext(t);return e&&forEach(Object_keys(t),function(r){e[r]=t[r]}),r},forEach(Object_keys(Script.prototype),function(e){exports[e]=Script[e]=function(t){var r=Script(t);return r[e].apply(r,[].slice.call(arguments,1))}}),exports.isContext=function(e){return e instanceof Context},exports.createScript=function(e){return exports.Script(e)},exports.createContext=Script.createContext=function(e){var t=new Context;return"object"==typeof e&&forEach(Object_keys(e),function(r){t[r]=e[r]}),t}}};"undefined"!=typeof __nccwpck_require__&&(__nccwpck_require__.ab="/ROOT/node_modules/.pnpm/next@16.0.10_@babel+core@7.28.0_react-dom@19.2.0_react@19.2.0__react@19.2.0/node_modules/next/dist/compiled/vm-browserify/");var __webpack_exports__={};__webpack_modules__[950](0,__webpack_exports__),module.exports=__webpack_exports__}()},906124,(e,t,r)=>{var n=e.i(316377),i=e.i(307178);!function(){var r={7160:function(e,t,r){var n=t;n.bignum=r(711),n.define=r(495).define,n.base=r(853),n.constants=r(7335),n.decoders=r(6701),n.encoders=r(3418)},495:function(e,t,r){var n=r(7160),i=r(3782);function a(e,t){this.name=e,this.body=t,this.decoders={},this.encoders={}}t.define=function(e,t){return new a(e,t)},a.prototype._createNamed=function(e){var t;try{t=r(6144).runInThisContext("(function "+this.name+"(entity) {\n  this._initNamed(entity);\n})")}catch(e){t=function(e){this._initNamed(e)}}return i(t,e),t.prototype._initNamed=function(t){e.call(this,t)},new t(this)},a.prototype._getDecoder=function(e){return e=e||"der",this.decoders.hasOwnProperty(e)||(this.decoders[e]=this._createNamed(n.decoders[e])),this.decoders[e]},a.prototype.decode=function(e,t,r){return this._getDecoder(t).decode(e,r)},a.prototype._getEncoder=function(e){return e=e||"der",this.encoders.hasOwnProperty(e)||(this.encoders[e]=this._createNamed(n.encoders[e])),this.encoders[e]},a.prototype.encode=function(e,t,r){return this._getEncoder(t).encode(e,r)}},6483:function(e,t,r){var n=r(3782),i=r(853).Reporter,a=r(4300).Buffer;function o(e,t){(i.call(this,t),a.isBuffer(e))?(this.base=e,this.offset=0,this.length=e.length):this.error("Input not Buffer")}function s(e,t){if(Array.isArray(e))this.length=0,this.value=e.map(function(e){return e instanceof s||(e=new s(e,t)),this.length+=e.length,e},this);else if("number"==typeof e){if(!(0<=e&&e<=255))return t.error("non-byte EncoderBuffer value");this.value=e,this.length=1}else if("string"==typeof e)this.value=e,this.length=a.byteLength(e);else{if(!a.isBuffer(e))return t.error("Unsupported type: "+typeof e);this.value=e,this.length=e.length}}n(o,i),t.C=o,o.prototype.save=function(){return{offset:this.offset,reporter:i.prototype.save.call(this)}},o.prototype.restore=function(e){var t=new o(this.base);return t.offset=e.offset,t.length=this.offset,this.offset=e.offset,i.prototype.restore.call(this,e.reporter),t},o.prototype.isEmpty=function(){return this.offset===this.length},o.prototype.readUInt8=function(e){return this.offset+1<=this.length?this.base.readUInt8(this.offset++,!0):this.error(e||"DecoderBuffer overrun")},o.prototype.skip=function(e,t){if(!(this.offset+e<=this.length))return this.error(t||"DecoderBuffer overrun");var r=new o(this.base);return r._reporterState=this._reporterState,r.offset=this.offset,r.length=this.offset+e,this.offset+=e,r},o.prototype.raw=function(e){return this.base.slice(e?e.offset:this.offset,this.length)},t.R=s,s.prototype.join=function(e,t){return e||(e=new a(this.length)),t||(t=0),0===this.length||(Array.isArray(this.value)?this.value.forEach(function(r){r.join(e,t),t+=r.length}):("number"==typeof this.value?e[t]=this.value:"string"==typeof this.value?e.write(this.value,t):a.isBuffer(this.value)&&this.value.copy(e,t),t+=this.length)),e}},853:function(e,t,r){var n=t;n.Reporter=r(1293).b,n.DecoderBuffer=r(6483).C,n.EncoderBuffer=r(6483).R,n.Node=r(9374)},9374:function(e,t,r){var n=r(853).Reporter,i=r(853).EncoderBuffer,a=r(853).DecoderBuffer,o=r(3523),s=["seq","seqof","set","setof","objid","bool","gentime","utctime","null_","enum","int","objDesc","bitstr","bmpstr","charstr","genstr","graphstr","ia5str","iso646str","numstr","octstr","printstr","t61str","unistr","utf8str","videostr"],l=["key","obj","use","optional","explicit","implicit","def","choice","any","contains"].concat(s),c=["_peekTag","_decodeTag","_use","_decodeStr","_decodeObjid","_decodeTime","_decodeNull","_decodeInt","_decodeBool","_decodeList","_encodeComposite","_encodeStr","_encodeObjid","_encodeTime","_encodeNull","_encodeInt","_encodeBool"];function f(e,t){var r={};this._baseState=r,r.enc=e,r.parent=t||null,r.children=null,r.tag=null,r.args=null,r.reverseArgs=null,r.choice=null,r.optional=!1,r.any=!1,r.obj=!1,r.use=null,r.useDecoder=null,r.key=null,r.default=null,r.explicit=null,r.implicit=null,r.contains=null,r.parent||(r.children=[],this._wrap())}e.exports=f;var u=["enc","parent","children","tag","args","reverseArgs","choice","optional","any","obj","use","alteredUse","key","default","explicit","implicit","contains"];f.prototype.clone=function(){var e=this._baseState,t={};u.forEach(function(r){t[r]=e[r]});var r=new this.constructor(t.parent);return r._baseState=t,r},f.prototype._wrap=function(){var e=this._baseState;l.forEach(function(t){this[t]=function(){var r=new this.constructor(this);return e.children.push(r),r[t].apply(r,arguments)}},this)},f.prototype._init=function(e){var t=this._baseState;o(null===t.parent),e.call(this),t.children=t.children.filter(function(e){return e._baseState.parent===this},this),o.equal(t.children.length,1,"Root node can have only one child")},f.prototype._useArgs=function(e){var t=this._baseState,r=e.filter(function(e){return e instanceof this.constructor},this);e=e.filter(function(e){return!(e instanceof this.constructor)},this),0!==r.length&&(o(null===t.children),t.children=r,r.forEach(function(e){e._baseState.parent=this},this)),0!==e.length&&(o(null===t.args),t.args=e,t.reverseArgs=e.map(function(e){if("object"!=typeof e||e.constructor!==Object)return e;var t={};return Object.keys(e).forEach(function(r){r==(0|r)&&(r|=0),t[e[r]]=r}),t}))},c.forEach(function(e){f.prototype[e]=function(){throw Error(e+" not implemented for encoding: "+this._baseState.enc)}}),s.forEach(function(e){f.prototype[e]=function(){var t=this._baseState,r=Array.prototype.slice.call(arguments);return o(null===t.tag),t.tag=e,this._useArgs(r),this}}),f.prototype.use=function(e){o(e);var t=this._baseState;return o(null===t.use),t.use=e,this},f.prototype.optional=function(){return this._baseState.optional=!0,this},f.prototype.def=function(e){var t=this._baseState;return o(null===t.default),t.default=e,t.optional=!0,this},f.prototype.explicit=function(e){var t=this._baseState;return o(null===t.explicit&&null===t.implicit),t.explicit=e,this},f.prototype.implicit=function(e){var t=this._baseState;return o(null===t.explicit&&null===t.implicit),t.implicit=e,this},f.prototype.obj=function(){var e=this._baseState,t=Array.prototype.slice.call(arguments);return e.obj=!0,0!==t.length&&this._useArgs(t),this},f.prototype.key=function(e){var t=this._baseState;return o(null===t.key),t.key=e,this},f.prototype.any=function(){return this._baseState.any=!0,this},f.prototype.choice=function(e){var t=this._baseState;return o(null===t.choice),t.choice=e,this._useArgs(Object.keys(e).map(function(t){return e[t]})),this},f.prototype.contains=function(e){var t=this._baseState;return o(null===t.use),t.contains=e,this},f.prototype._decode=function(e,t){var r,n=this._baseState;if(null===n.parent)return e.wrapResult(n.children[0]._decode(e,t));var i=n.default,o=!0,s=null;if(null!==n.key&&(s=e.enterKey(n.key)),n.optional){var l=null;if(null!==n.explicit?l=n.explicit:null!==n.implicit?l=n.implicit:null!==n.tag&&(l=n.tag),null!==l||n.any){if(o=this._peekTag(e,l,n.any),e.isError(o))return o}else{var c=e.save();try{null===n.choice?this._decodeGeneric(n.tag,e,t):this._decodeChoice(e,t),o=!0}catch(e){o=!1}e.restore(c)}}if(n.obj&&o&&(r=e.enterObject()),o){if(null!==n.explicit){var f=this._decodeTag(e,n.explicit);if(e.isError(f))return f;e=f}var u=e.offset;if(null===n.use&&null===n.choice){if(n.any)var c=e.save();var d=this._decodeTag(e,null!==n.implicit?n.implicit:n.tag,n.any);if(e.isError(d))return d;n.any?i=e.raw(c):e=d}if(t&&t.track&&null!==n.tag&&t.track(e.path(),u,e.length,"tagged"),t&&t.track&&null!==n.tag&&t.track(e.path(),e.offset,e.length,"content"),n.any||(i=null===n.choice?this._decodeGeneric(n.tag,e,t):this._decodeChoice(e,t)),e.isError(i))return i;if(n.any||null!==n.choice||null===n.children||n.children.forEach(function(r){r._decode(e,t)}),n.contains&&("octstr"===n.tag||"bitstr"===n.tag)){var h=new a(i);i=this._getUse(n.contains,e._reporterState.obj)._decode(h,t)}}return n.obj&&o&&(i=e.leaveObject(r)),null!==n.key&&(null!==i||!0===o)?e.leaveKey(s,n.key,i):null!==s&&e.exitKey(s),i},f.prototype._decodeGeneric=function(e,t,r){var n=this._baseState;if("seq"===e||"set"===e)return null;if("seqof"===e||"setof"===e)return this._decodeList(t,e,n.args[0],r);if(/str$/.test(e))return this._decodeStr(t,e,r);if("objid"===e&&n.args)return this._decodeObjid(t,n.args[0],n.args[1],r);if("objid"===e)return this._decodeObjid(t,null,null,r);if("gentime"===e||"utctime"===e)return this._decodeTime(t,e,r);else if("null_"===e)return this._decodeNull(t,r);else if("bool"===e)return this._decodeBool(t,r);else if("objDesc"===e)return this._decodeStr(t,e,r);else if("int"===e||"enum"===e)return this._decodeInt(t,n.args&&n.args[0],r);return null!==n.use?this._getUse(n.use,t._reporterState.obj)._decode(t,r):t.error("unknown tag: "+e)},f.prototype._getUse=function(e,t){var r=this._baseState;return r.useDecoder=this._use(e,t),o(null===r.useDecoder._baseState.parent),r.useDecoder=r.useDecoder._baseState.children[0],r.implicit!==r.useDecoder._baseState.implicit&&(r.useDecoder=r.useDecoder.clone(),r.useDecoder._baseState.implicit=r.implicit),r.useDecoder},f.prototype._decodeChoice=function(e,t){var r=this._baseState,n=null,i=!1;return(Object.keys(r.choice).some(function(a){var o=e.save(),s=r.choice[a];try{var l=s._decode(e,t);if(e.isError(l))return!1;n={type:a,value:l},i=!0}catch(t){return e.restore(o),!1}return!0},this),i)?n:e.error("Choice not matched")},f.prototype._createEncoderBuffer=function(e){return new i(e,this.reporter)},f.prototype._encode=function(e,t,r){var n=this._baseState;if(null===n.default||n.default!==e){var i=this._encodeValue(e,t,r);if(void 0!==i&&!this._skipDefault(i,t,r))return i}},f.prototype._encodeValue=function(e,t,r){var i,a=this._baseState;if(null===a.parent)return a.children[0]._encode(e,t||new n);var i=null;if(this.reporter=t,a.optional&&void 0===e)if(null===a.default)return;else e=a.default;var o=null,s=!1;if(a.any)i=this._createEncoderBuffer(e);else if(a.choice)i=this._encodeChoice(e,t);else if(a.contains)o=this._getUse(a.contains,r)._encode(e,t),s=!0;else if(a.children)o=a.children.map(function(r){if("null_"===r._baseState.tag)return r._encode(null,t,e);if(null===r._baseState.key)return t.error("Child should have a key");var n=t.enterKey(r._baseState.key);if("object"!=typeof e)return t.error("Child expected, but input is not object");var i=r._encode(e[r._baseState.key],t,e);return t.leaveKey(n),i},this).filter(function(e){return e}),o=this._createEncoderBuffer(o);else if("seqof"===a.tag||"setof"===a.tag){if(!(a.args&&1===a.args.length))return t.error("Too many args for : "+a.tag);if(!Array.isArray(e))return t.error("seqof/setof, but data is not Array");var l=this.clone();l._baseState.implicit=null,o=this._createEncoderBuffer(e.map(function(r){var n=this._baseState;return this._getUse(n.args[0],e)._encode(r,t)},l))}else null!==a.use?i=this._getUse(a.use,r)._encode(e,t):(o=this._encodePrimitive(a.tag,e),s=!0);if(!a.any&&null===a.choice){var c=null!==a.implicit?a.implicit:a.tag,f=null===a.implicit?"universal":"context";null===c?null===a.use&&t.error("Tag could be omitted only for .use()"):null===a.use&&(i=this._encodeComposite(c,s,f,o))}return null!==a.explicit&&(i=this._encodeComposite(a.explicit,!1,"context",i)),i},f.prototype._encodeChoice=function(e,t){var r=this._baseState,n=r.choice[e.type];return n||o(!1,e.type+" not found in "+JSON.stringify(Object.keys(r.choice))),n._encode(e.value,t)},f.prototype._encodePrimitive=function(e,t){var r=this._baseState;if(/str$/.test(e))return this._encodeStr(t,e);if("objid"===e&&r.args)return this._encodeObjid(t,r.reverseArgs[0],r.args[1]);if("objid"===e)return this._encodeObjid(t,null,null);if("gentime"===e||"utctime"===e)return this._encodeTime(t,e);if("null_"===e)return this._encodeNull();else if("int"===e||"enum"===e)return this._encodeInt(t,r.args&&r.reverseArgs[0]);else if("bool"===e)return this._encodeBool(t);else if("objDesc"===e)return this._encodeStr(t,e);else throw Error("Unsupported tag: "+e)},f.prototype._isNumstr=function(e){return/^[0-9 ]*$/.test(e)},f.prototype._isPrintstr=function(e){return/^[A-Za-z0-9 '\(\)\+,\-\.\/:=\?]*$/.test(e)}},1293:function(e,t,r){var n=r(3782);function i(e){this._reporterState={obj:null,path:[],options:e||{},errors:[]}}function a(e,t){this.path=e,this.rethrow(t)}t.b=i,i.prototype.isError=function(e){return e instanceof a},i.prototype.save=function(){var e=this._reporterState;return{obj:e.obj,pathLen:e.path.length}},i.prototype.restore=function(e){var t=this._reporterState;t.obj=e.obj,t.path=t.path.slice(0,e.pathLen)},i.prototype.enterKey=function(e){return this._reporterState.path.push(e)},i.prototype.exitKey=function(e){var t=this._reporterState;t.path=t.path.slice(0,e-1)},i.prototype.leaveKey=function(e,t,r){var n=this._reporterState;this.exitKey(e),null!==n.obj&&(n.obj[t]=r)},i.prototype.path=function(){return this._reporterState.path.join("/")},i.prototype.enterObject=function(){var e=this._reporterState,t=e.obj;return e.obj={},t},i.prototype.leaveObject=function(e){var t=this._reporterState,r=t.obj;return t.obj=e,r},i.prototype.error=function(e){var t,r=this._reporterState,n=e instanceof a;if(t=n?e:new a(r.path.map(function(e){return"["+JSON.stringify(e)+"]"}).join(""),e.message||e,e.stack),!r.options.partial)throw t;return n||r.errors.push(t),t},i.prototype.wrapResult=function(e){var t=this._reporterState;return t.options.partial?{result:this.isError(e)?null:e,errors:t.errors}:e},n(a,Error),a.prototype.rethrow=function(e){if(this.message=e+" at: "+(this.path||"(shallow)"),Error.captureStackTrace&&Error.captureStackTrace(this,a),!this.stack)try{throw Error(this.message)}catch(e){this.stack=e.stack}return this}},9791:function(e,t,r){var n=r(7335);t.tagClass={0:"universal",1:"application",2:"context",3:"private"},t.tagClassByName=n._reverse(t.tagClass),t.tag={0:"end",1:"bool",2:"int",3:"bitstr",4:"octstr",5:"null_",6:"objid",7:"objDesc",8:"external",9:"real",10:"enum",11:"embed",12:"utf8str",13:"relativeOid",16:"seq",17:"set",18:"numstr",19:"printstr",20:"t61str",21:"videostr",22:"ia5str",23:"utctime",24:"gentime",25:"graphstr",26:"iso646str",27:"genstr",28:"unistr",29:"charstr",30:"bmpstr"},t.tagByName=n._reverse(t.tag)},7335:function(e,t,r){var n=t;n._reverse=function(e){var t={};return Object.keys(e).forEach(function(r){(0|r)==r&&(r|=0),t[e[r]]=r}),t},n.der=r(9791)},2259:function(e,t,r){var n=r(3782),i=r(7160),a=i.base,o=i.bignum,s=i.constants.der;function l(e){this.enc="der",this.name=e.name,this.entity=e,this.tree=new c,this.tree._init(e.body)}function c(e){a.Node.call(this,"der",e)}function f(e,t){var r=e.readUInt8(t);if(e.isError(r))return r;var n=s.tagClass[r>>6],i=(32&r)==0;if((31&r)==31){var a=r;for(r=0;(128&a)==128;){if(a=e.readUInt8(t),e.isError(a))return a;r<<=7,r|=127&a}}else r&=31;var o=s.tag[r];return{cls:n,primitive:i,tag:r,tagStr:o}}function u(e,t,r){var n=e.readUInt8(r);if(e.isError(n))return n;if(!t&&128===n)return null;if((128&n)==0)return n;var i=127&n;if(i>4)return e.error("length octect is too long");n=0;for(var a=0;a<i;a++){n<<=8;var o=e.readUInt8(r);if(e.isError(o))return o;n|=o}return n}e.exports=l,l.prototype.decode=function(e,t){return e instanceof a.DecoderBuffer||(e=new a.DecoderBuffer(e,t)),this.tree._decode(e,t)},n(c,a.Node),c.prototype._peekTag=function(e,t,r){if(e.isEmpty())return!1;var n=e.save(),i=f(e,'Failed to peek tag: "'+t+'"');return e.isError(i)?i:(e.restore(n),i.tag===t||i.tagStr===t||i.tagStr+"of"===t||r)},c.prototype._decodeTag=function(e,t,r){var n=f(e,'Failed to decode tag of "'+t+'"');if(e.isError(n))return n;var i=u(e,n.primitive,'Failed to get length of "'+t+'"');if(e.isError(i))return i;if(!r&&n.tag!==t&&n.tagStr!==t&&n.tagStr+"of"!==t)return e.error('Failed to match tag: "'+t+'"');if(n.primitive||null!==i)return e.skip(i,'Failed to match body of: "'+t+'"');var a=e.save(),o=this._skipUntilEnd(e,'Failed to skip indefinite length body: "'+this.tag+'"');return e.isError(o)?o:(i=e.offset-a.offset,e.restore(a),e.skip(i,'Failed to match body of: "'+t+'"'))},c.prototype._skipUntilEnd=function(e,t){for(;;){var r,n=f(e,t);if(e.isError(n))return n;var i=u(e,n.primitive,t);if(e.isError(i))return i;if(r=n.primitive||null!==i?e.skip(i):this._skipUntilEnd(e,t),e.isError(r))return r;if("end"===n.tagStr)break}},c.prototype._decodeList=function(e,t,r,n){for(var i=[];!e.isEmpty();){var a=this._peekTag(e,"end");if(e.isError(a))return a;var o=r.decode(e,"der",n);if(e.isError(o)&&a)break;i.push(o)}return i},c.prototype._decodeStr=function(e,t){if("bitstr"===t){var r=e.readUInt8();return e.isError(r)?r:{unused:r,data:e.raw()}}if("bmpstr"===t){var n=e.raw();if(n.length%2==1)return e.error("Decoding of string type: bmpstr length mismatch");for(var i="",a=0;a<n.length/2;a++)i+=String.fromCharCode(n.readUInt16BE(2*a));return i}if("numstr"===t){var o=e.raw().toString("ascii");return this._isNumstr(o)?o:e.error("Decoding of string type: numstr unsupported characters")}if("octstr"===t)return e.raw();if("objDesc"===t)return e.raw();else if("printstr"===t){var s=e.raw().toString("ascii");return this._isPrintstr(s)?s:e.error("Decoding of string type: printstr unsupported characters")}else if(/str$/.test(t))return e.raw().toString();else return e.error("Decoding of string type: "+t+" unsupported")},c.prototype._decodeObjid=function(e,t,r){for(var n,i=[],a=0;!e.isEmpty();){var o=e.readUInt8();a<<=7,a|=127&o,(128&o)==0&&(i.push(a),a=0)}128&o&&i.push(a);var s=i[0]/40|0,l=i[0]%40;if(n=r?i:[s,l].concat(i.slice(1)),t){var c=t[n.join(" ")];void 0===c&&(c=t[n.join(".")]),void 0!==c&&(n=c)}return n},c.prototype._decodeTime=function(e,t){var r=e.raw().toString();if("gentime"===t)var n=0|r.slice(0,4),i=0|r.slice(4,6),a=0|r.slice(6,8),o=0|r.slice(8,10),s=0|r.slice(10,12),l=0|r.slice(12,14);else{if("utctime"!==t)return e.error("Decoding "+t+" time is not supported yet");var n=0|r.slice(0,2),i=0|r.slice(2,4),a=0|r.slice(4,6),o=0|r.slice(6,8),s=0|r.slice(8,10),l=0|r.slice(10,12);n=n<70?2e3+n:1900+n}return Date.UTC(n,i-1,a,o,s,l,0)},c.prototype._decodeNull=function(e){return null},c.prototype._decodeBool=function(e){var t=e.readUInt8();return e.isError(t)?t:0!==t},c.prototype._decodeInt=function(e,t){var r=new o(e.raw());return t&&(r=t[r.toString(10)]||r),r},c.prototype._use=function(e,t){return"function"==typeof e&&(e=e(t)),e._getDecoder("der").tree}},6701:function(e,t,r){var n=t;n.der=r(2259),n.pem=r(8527)},8527:function(e,t,r){var n=r(3782),i=r(4300).Buffer,a=r(2259);function o(e){a.call(this,e),this.enc="pem"}n(o,a),e.exports=o,o.prototype.decode=function(e,t){for(var r=e.toString().split(/[\r\n]+/g),n=t.label.toUpperCase(),o=/^-----(BEGIN|END) ([^-]+)-----$/,s=-1,l=-1,c=0;c<r.length;c++){var f=r[c].match(o);if(null!==f&&f[2]===n)if(-1===s){if("BEGIN"!==f[1])break;s=c}else{if("END"!==f[1])break;l=c;break}}if(-1===s||-1===l)throw Error("PEM section not found for: "+n);var u=r.slice(s+1,l).join("");u.replace(/[^a-z0-9\+\/=]+/gi,"");var d=new i(u,"base64");return a.prototype.decode.call(this,d,t)}},7804:function(e,t,r){var n=r(3782),i=r(4300).Buffer,a=r(7160),o=a.base,s=a.constants.der;function l(e){this.enc="der",this.name=e.name,this.entity=e,this.tree=new c,this.tree._init(e.body)}function c(e){o.Node.call(this,"der",e)}function f(e){return e<10?"0"+e:e}function u(e,t,r,n){var i;if("seqof"===e?e="seq":"setof"===e&&(e="set"),s.tagByName.hasOwnProperty(e))i=s.tagByName[e];else{if("number"!=typeof e||(0|e)!==e)return n.error("Unknown tag: "+e);i=e}return i>=31?n.error("Multi-octet tag encoding unsupported"):(t||(i|=32),i|=s.tagClassByName[r||"universal"]<<6)}e.exports=l,l.prototype.encode=function(e,t){return this.tree._encode(e,t).join()},n(c,o.Node),c.prototype._encodeComposite=function(e,t,r,n){var a=u(e,t,r,this.reporter);if(n.length<128){var o=new i(2);return o[0]=a,o[1]=n.length,this._createEncoderBuffer([o,n])}for(var s=1,l=n.length;l>=256;l>>=8)s++;var o=new i(2+s);o[0]=a,o[1]=128|s;for(var l=1+s,c=n.length;c>0;l--,c>>=8)o[l]=255&c;return this._createEncoderBuffer([o,n])},c.prototype._encodeStr=function(e,t){if("bitstr"===t)return this._createEncoderBuffer([0|e.unused,e.data]);if("bmpstr"===t){for(var r=new i(2*e.length),n=0;n<e.length;n++)r.writeUInt16BE(e.charCodeAt(n),2*n);return this._createEncoderBuffer(r)}if("numstr"===t)return this._isNumstr(e)?this._createEncoderBuffer(e):this.reporter.error("Encoding of string type: numstr supports only digits and space");if("printstr"===t)return this._isPrintstr(e)?this._createEncoderBuffer(e):this.reporter.error("Encoding of string type: printstr supports only latin upper and lower case letters, digits, space, apostrophe, left and rigth parenthesis, plus sign, comma, hyphen, dot, slash, colon, equal sign, question mark");if(/str$/.test(t))return this._createEncoderBuffer(e);else if("objDesc"===t)return this._createEncoderBuffer(e);else return this.reporter.error("Encoding of string type: "+t+" unsupported")},c.prototype._encodeObjid=function(e,t,r){if("string"==typeof e){if(!t)return this.reporter.error("string objid given, but no values map found");if(!t.hasOwnProperty(e))return this.reporter.error("objid not found in values map");e=t[e].split(/[\s\.]+/g);for(var n=0;n<e.length;n++)e[n]|=0}else if(Array.isArray(e)){e=e.slice();for(var n=0;n<e.length;n++)e[n]|=0}if(!Array.isArray(e))return this.reporter.error("objid() should be either array or string, got: "+JSON.stringify(e));if(!r){if(e[1]>=40)return this.reporter.error("Second objid identifier OOB");e.splice(0,2,40*e[0]+e[1])}for(var a=0,n=0;n<e.length;n++){var o=e[n];for(a++;o>=128;o>>=7)a++}for(var s=new i(a),l=s.length-1,n=e.length-1;n>=0;n--){var o=e[n];for(s[l--]=127&o;(o>>=7)>0;)s[l--]=128|127&o}return this._createEncoderBuffer(s)},c.prototype._encodeTime=function(e,t){var r,n=new Date(e);return"gentime"===t?r=""+f(n.getFullYear())+f(n.getUTCMonth()+1)+f(n.getUTCDate())+f(n.getUTCHours())+f(n.getUTCMinutes())+f(n.getUTCSeconds())+"Z":"utctime"===t?r=""+f(n.getFullYear()%100)+f(n.getUTCMonth()+1)+f(n.getUTCDate())+f(n.getUTCHours())+f(n.getUTCMinutes())+f(n.getUTCSeconds())+"Z":this.reporter.error("Encoding "+t+" time is not supported yet"),this._encodeStr(r,"octstr")},c.prototype._encodeNull=function(){return this._createEncoderBuffer("")},c.prototype._encodeInt=function(e,t){if("string"==typeof e){if(!t)return this.reporter.error("String int or enum given, but no values map");if(!t.hasOwnProperty(e))return this.reporter.error("Values map doesn't contain: "+JSON.stringify(e));e=t[e]}if("number"!=typeof e&&!i.isBuffer(e)){var r=e.toArray();!e.sign&&128&r[0]&&r.unshift(0),e=new i(r)}if(i.isBuffer(e)){var n=e.length;0===e.length&&n++;var a=new i(n);return e.copy(a),0===e.length&&(a[0]=0),this._createEncoderBuffer(a)}if(e<128)return this._createEncoderBuffer(e);if(e<256)return this._createEncoderBuffer([0,e]);for(var n=1,o=e;o>=256;o>>=8)n++;for(var a=Array(n),o=a.length-1;o>=0;o--)a[o]=255&e,e>>=8;return 128&a[0]&&a.unshift(0),this._createEncoderBuffer(new i(a))},c.prototype._encodeBool=function(e){return this._createEncoderBuffer(255*!!e)},c.prototype._use=function(e,t){return"function"==typeof e&&(e=e(t)),e._getEncoder("der").tree},c.prototype._skipDefault=function(e,t,r){var n,i=this._baseState;if(null===i.default)return!1;var a=e.join();if(void 0===i.defaultBuffer&&(i.defaultBuffer=this._encodeValue(i.default,t,r).join()),a.length!==i.defaultBuffer.length)return!1;for(n=0;n<a.length;n++)if(a[n]!==i.defaultBuffer[n])return!1;return!0}},3418:function(e,t,r){var n=t;n.der=r(7804),n.pem=r(1564)},1564:function(e,t,r){var n=r(3782),i=r(7804);function a(e){i.call(this,e),this.enc="pem"}n(a,i),e.exports=a,a.prototype.encode=function(e,t){for(var r=i.prototype.encode.call(this,e).toString("base64"),n=["-----BEGIN "+t.label+"-----"],a=0;a<r.length;a+=64)n.push(r.slice(a,a+64));return n.push("-----END "+t.label+"-----"),n.join("\n")}},711:function(e,t,r){!function(e,t){"use strict";function n(e,t){if(!e)throw Error(t||"Assertion failed")}function i(e,t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}function a(e,t,r){if(a.isBN(e))return e;this.negative=0,this.words=null,this.length=0,this.red=null,null!==e&&(("le"===t||"be"===t)&&(r=t,t=10),this._init(e||0,t||10,r||"be"))}"object"==typeof e?e.exports=a:t.BN=a,a.BN=a,a.wordSize=26;try{l=r(4300).Buffer}catch(e){}function o(e,t,r){for(var n=0,i=Math.min(e.length,r),a=t;a<i;a++){var o=e.charCodeAt(a)-48;n<<=4,o>=49&&o<=54?n|=o-49+10:o>=17&&o<=22?n|=o-17+10:n|=15&o}return n}function s(e,t,r,n){for(var i=0,a=Math.min(e.length,r),o=t;o<a;o++){var s=e.charCodeAt(o)-48;i*=n,s>=49?i+=s-49+10:s>=17?i+=s-17+10:i+=s}return i}a.isBN=function(e){return e instanceof a||null!==e&&"object"==typeof e&&e.constructor.wordSize===a.wordSize&&Array.isArray(e.words)},a.max=function(e,t){return e.cmp(t)>0?e:t},a.min=function(e,t){return 0>e.cmp(t)?e:t},a.prototype._init=function(e,t,r){if("number"==typeof e)return this._initNumber(e,t,r);if("object"==typeof e)return this._initArray(e,t,r);"hex"===t&&(t=16),n(t===(0|t)&&t>=2&&t<=36);var i=0;"-"===(e=e.toString().replace(/\s+/g,""))[0]&&i++,16===t?this._parseHex(e,i):this._parseBase(e,t,i),"-"===e[0]&&(this.negative=1),this.strip(),"le"===r&&this._initArray(this.toArray(),t,r)},a.prototype._initNumber=function(e,t,r){e<0&&(this.negative=1,e=-e),e<0x4000000?(this.words=[0x3ffffff&e],this.length=1):e<0x10000000000000?(this.words=[0x3ffffff&e,e/0x4000000&0x3ffffff],this.length=2):(n(e<0x20000000000000),this.words=[0x3ffffff&e,e/0x4000000&0x3ffffff,1],this.length=3),"le"===r&&this._initArray(this.toArray(),t,r)},a.prototype._initArray=function(e,t,r){if(n("number"==typeof e.length),e.length<=0)return this.words=[0],this.length=1,this;this.length=Math.ceil(e.length/3),this.words=Array(this.length);for(var i,a,o=0;o<this.length;o++)this.words[o]=0;var s=0;if("be"===r)for(o=e.length-1,i=0;o>=0;o-=3)a=e[o]|e[o-1]<<8|e[o-2]<<16,this.words[i]|=a<<s&0x3ffffff,this.words[i+1]=a>>>26-s&0x3ffffff,(s+=24)>=26&&(s-=26,i++);else if("le"===r)for(o=0,i=0;o<e.length;o+=3)a=e[o]|e[o+1]<<8|e[o+2]<<16,this.words[i]|=a<<s&0x3ffffff,this.words[i+1]=a>>>26-s&0x3ffffff,(s+=24)>=26&&(s-=26,i++);return this.strip()},a.prototype._parseHex=function(e,t){this.length=Math.ceil((e.length-t)/6),this.words=Array(this.length);for(var r,n,i=0;i<this.length;i++)this.words[i]=0;var a=0;for(i=e.length-6,r=0;i>=t;i-=6)n=o(e,i,i+6),this.words[r]|=n<<a&0x3ffffff,this.words[r+1]|=n>>>26-a&4194303,(a+=24)>=26&&(a-=26,r++);i+6!==t&&(n=o(e,t,i+6),this.words[r]|=n<<a&0x3ffffff,this.words[r+1]|=n>>>26-a&4194303),this.strip()},a.prototype._parseBase=function(e,t,r){this.words=[0],this.length=1;for(var n=0,i=1;i<=0x3ffffff;i*=t)n++;n--,i=i/t|0;for(var a=e.length-r,o=a%n,l=Math.min(a,a-o)+r,c=0,f=r;f<l;f+=n)c=s(e,f,f+n,t),this.imuln(i),this.words[0]+c<0x4000000?this.words[0]+=c:this._iaddn(c);if(0!==o){var u=1;for(c=s(e,f,e.length,t),f=0;f<o;f++)u*=t;this.imuln(u),this.words[0]+c<0x4000000?this.words[0]+=c:this._iaddn(c)}},a.prototype.copy=function(e){e.words=Array(this.length);for(var t=0;t<this.length;t++)e.words[t]=this.words[t];e.length=this.length,e.negative=this.negative,e.red=this.red},a.prototype.clone=function(){var e=new a(null);return this.copy(e),e},a.prototype._expand=function(e){for(;this.length<e;)this.words[this.length++]=0;return this},a.prototype.strip=function(){for(;this.length>1&&0===this.words[this.length-1];)this.length--;return this._normSign()},a.prototype._normSign=function(){return 1===this.length&&0===this.words[0]&&(this.negative=0),this},a.prototype.inspect=function(){return(this.red?"<BN-R: ":"<BN: ")+this.toString(16)+">"};var l,c=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000","000000000000000","0000000000000000","00000000000000000","000000000000000000","0000000000000000000","00000000000000000000","000000000000000000000","0000000000000000000000","00000000000000000000000","000000000000000000000000","0000000000000000000000000"],f=[0,0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],u=[0,0,0x2000000,0x290d741,0x1000000,0x2e90edd,0x39aa400,0x267bf47,0x1000000,0x290d741,1e7,0x12959c3,0x222c000,0x3bd7765,7529536,0xadcea1,0x1000000,0x1704f61,0x206fc40,0x2cddcf9,64e6,4084101,5153632,6436343,7962624,9765625,0xb54ba0,0xdaf26b,0x1069c00,0x138f9ad,243e5,0x1b4d89f,0x2000000,0x25528a1,0x2b54a20,0x3216b93,0x39aa400];function d(e){for(var t=Array(e.bitLength()),r=0;r<t.length;r++){var n=r/26|0,i=r%26;t[r]=(e.words[n]&1<<i)>>>i}return t}function h(e,t,r){r.negative=t.negative^e.negative;var n=e.length+t.length|0;r.length=n,n=n-1|0;var i=0|e.words[0],a=0|t.words[0],o=i*a,s=0x3ffffff&o,l=o/0x4000000|0;r.words[0]=s;for(var c=1;c<n;c++){for(var f=l>>>26,u=0x3ffffff&l,d=Math.min(c,t.length-1),h=Math.max(0,c-e.length+1);h<=d;h++){var p=c-h|0;f+=(o=(i=0|e.words[p])*(a=0|t.words[h])+u)/0x4000000|0,u=0x3ffffff&o}r.words[c]=0|u,l=0|f}return 0!==l?r.words[c]=0|l:r.length--,r.strip()}a.prototype.toString=function(e,t){if(t=0|t||1,16===(e=e||10)||"hex"===e){for(var r="",i=0,a=0,o=0;o<this.length;o++){var s=this.words[o],l=((s<<i|a)&0xffffff).toString(16);r=0!=(a=s>>>24-i&0xffffff)||o!==this.length-1?c[6-l.length]+l+r:l+r,(i+=2)>=26&&(i-=26,o--)}for(0!==a&&(r=a.toString(16)+r);r.length%t!=0;)r="0"+r;return 0!==this.negative&&(r="-"+r),r}if(e===(0|e)&&e>=2&&e<=36){var d=f[e],h=u[e];r="";var p=this.clone();for(p.negative=0;!p.isZero();){var b=p.modn(h).toString(e);r=(p=p.idivn(h)).isZero()?b+r:c[d-b.length]+b+r}for(this.isZero()&&(r="0"+r);r.length%t!=0;)r="0"+r;return 0!==this.negative&&(r="-"+r),r}n(!1,"Base should be between 2 and 36")},a.prototype.toNumber=function(){var e=this.words[0];return 2===this.length?e+=0x4000000*this.words[1]:3===this.length&&1===this.words[2]?e+=0x10000000000000+0x4000000*this.words[1]:this.length>2&&n(!1,"Number can only safely store up to 53 bits"),0!==this.negative?-e:e},a.prototype.toJSON=function(){return this.toString(16)},a.prototype.toBuffer=function(e,t){return n(void 0!==l),this.toArrayLike(l,e,t)},a.prototype.toArray=function(e,t){return this.toArrayLike(Array,e,t)},a.prototype.toArrayLike=function(e,t,r){var i,a,o=this.byteLength(),s=r||Math.max(1,o);n(o<=s,"byte array longer than desired length"),n(s>0,"Requested array length <= 0"),this.strip();var l="le"===t,c=new e(s),f=this.clone();if(l){for(a=0;!f.isZero();a++)i=f.andln(255),f.iushrn(8),c[a]=i;for(;a<s;a++)c[a]=0}else{for(a=0;a<s-o;a++)c[a]=0;for(a=0;!f.isZero();a++)i=f.andln(255),f.iushrn(8),c[s-a-1]=i}return c},Math.clz32?a.prototype._countBits=function(e){return 32-Math.clz32(e)}:a.prototype._countBits=function(e){var t=e,r=0;return t>=4096&&(r+=13,t>>>=13),t>=64&&(r+=7,t>>>=7),t>=8&&(r+=4,t>>>=4),t>=2&&(r+=2,t>>>=2),r+t},a.prototype._zeroBits=function(e){if(0===e)return 26;var t=e,r=0;return(8191&t)==0&&(r+=13,t>>>=13),(127&t)==0&&(r+=7,t>>>=7),(15&t)==0&&(r+=4,t>>>=4),(3&t)==0&&(r+=2,t>>>=2),(1&t)==0&&r++,r},a.prototype.bitLength=function(){var e=this.words[this.length-1],t=this._countBits(e);return(this.length-1)*26+t},a.prototype.zeroBits=function(){if(this.isZero())return 0;for(var e=0,t=0;t<this.length;t++){var r=this._zeroBits(this.words[t]);if(e+=r,26!==r)break}return e},a.prototype.byteLength=function(){return Math.ceil(this.bitLength()/8)},a.prototype.toTwos=function(e){return 0!==this.negative?this.abs().inotn(e).iaddn(1):this.clone()},a.prototype.fromTwos=function(e){return this.testn(e-1)?this.notn(e).iaddn(1).ineg():this.clone()},a.prototype.isNeg=function(){return 0!==this.negative},a.prototype.neg=function(){return this.clone().ineg()},a.prototype.ineg=function(){return this.isZero()||(this.negative^=1),this},a.prototype.iuor=function(e){for(;this.length<e.length;)this.words[this.length++]=0;for(var t=0;t<e.length;t++)this.words[t]=this.words[t]|e.words[t];return this.strip()},a.prototype.ior=function(e){return n((this.negative|e.negative)==0),this.iuor(e)},a.prototype.or=function(e){return this.length>e.length?this.clone().ior(e):e.clone().ior(this)},a.prototype.uor=function(e){return this.length>e.length?this.clone().iuor(e):e.clone().iuor(this)},a.prototype.iuand=function(e){var t;t=this.length>e.length?e:this;for(var r=0;r<t.length;r++)this.words[r]=this.words[r]&e.words[r];return this.length=t.length,this.strip()},a.prototype.iand=function(e){return n((this.negative|e.negative)==0),this.iuand(e)},a.prototype.and=function(e){return this.length>e.length?this.clone().iand(e):e.clone().iand(this)},a.prototype.uand=function(e){return this.length>e.length?this.clone().iuand(e):e.clone().iuand(this)},a.prototype.iuxor=function(e){this.length>e.length?(t=this,r=e):(t=e,r=this);for(var t,r,n=0;n<r.length;n++)this.words[n]=t.words[n]^r.words[n];if(this!==t)for(;n<t.length;n++)this.words[n]=t.words[n];return this.length=t.length,this.strip()},a.prototype.ixor=function(e){return n((this.negative|e.negative)==0),this.iuxor(e)},a.prototype.xor=function(e){return this.length>e.length?this.clone().ixor(e):e.clone().ixor(this)},a.prototype.uxor=function(e){return this.length>e.length?this.clone().iuxor(e):e.clone().iuxor(this)},a.prototype.inotn=function(e){n("number"==typeof e&&e>=0);var t=0|Math.ceil(e/26),r=e%26;this._expand(t),r>0&&t--;for(var i=0;i<t;i++)this.words[i]=0x3ffffff&~this.words[i];return r>0&&(this.words[i]=~this.words[i]&0x3ffffff>>26-r),this.strip()},a.prototype.notn=function(e){return this.clone().inotn(e)},a.prototype.setn=function(e,t){n("number"==typeof e&&e>=0);var r=e/26|0,i=e%26;return this._expand(r+1),t?this.words[r]=this.words[r]|1<<i:this.words[r]=this.words[r]&~(1<<i),this.strip()},a.prototype.iadd=function(e){if(0!==this.negative&&0===e.negative)return this.negative=0,t=this.isub(e),this.negative^=1,this._normSign();if(0===this.negative&&0!==e.negative)return e.negative=0,t=this.isub(e),e.negative=1,t._normSign();this.length>e.length?(r=this,n=e):(r=e,n=this);for(var t,r,n,i=0,a=0;a<n.length;a++)t=(0|r.words[a])+(0|n.words[a])+i,this.words[a]=0x3ffffff&t,i=t>>>26;for(;0!==i&&a<r.length;a++)t=(0|r.words[a])+i,this.words[a]=0x3ffffff&t,i=t>>>26;if(this.length=r.length,0!==i)this.words[this.length]=i,this.length++;else if(r!==this)for(;a<r.length;a++)this.words[a]=r.words[a];return this},a.prototype.add=function(e){var t;return 0!==e.negative&&0===this.negative?(e.negative=0,t=this.sub(e),e.negative^=1,t):0===e.negative&&0!==this.negative?(this.negative=0,t=e.sub(this),this.negative=1,t):this.length>e.length?this.clone().iadd(e):e.clone().iadd(this)},a.prototype.isub=function(e){if(0!==e.negative){e.negative=0;var t,r,n=this.iadd(e);return e.negative=1,n._normSign()}if(0!==this.negative)return this.negative=0,this.iadd(e),this.negative=1,this._normSign();var i=this.cmp(e);if(0===i)return this.negative=0,this.length=1,this.words[0]=0,this;i>0?(t=this,r=e):(t=e,r=this);for(var a=0,o=0;o<r.length;o++)a=(n=(0|t.words[o])-(0|r.words[o])+a)>>26,this.words[o]=0x3ffffff&n;for(;0!==a&&o<t.length;o++)a=(n=(0|t.words[o])+a)>>26,this.words[o]=0x3ffffff&n;if(0===a&&o<t.length&&t!==this)for(;o<t.length;o++)this.words[o]=t.words[o];return this.length=Math.max(this.length,o),t!==this&&(this.negative=1),this.strip()},a.prototype.sub=function(e){return this.clone().isub(e)};var p=function(e,t,r){var n,i,a,o=e.words,s=t.words,l=r.words,c=0,f=0|o[0],u=8191&f,d=f>>>13,h=0|o[1],p=8191&h,b=h>>>13,m=0|o[2],g=8191&m,y=m>>>13,v=0|o[3],x=8191&v,w=v>>>13,S=0|o[4],k=8191&S,_=S>>>13,E=0|o[5],M=8191&E,N=E>>>13,A=0|o[6],T=8191&A,R=A>>>13,C=0|o[7],j=8191&C,I=C>>>13,L=0|o[8],P=8191&L,B=L>>>13,O=0|o[9],D=8191&O,z=O>>>13,F=0|s[0],U=8191&F,$=F>>>13,H=0|s[1],q=8191&H,V=H>>>13,W=0|s[2],K=8191&W,G=W>>>13,X=0|s[3],Y=8191&X,Z=X>>>13,J=0|s[4],Q=8191&J,ee=J>>>13,et=0|s[5],er=8191&et,en=et>>>13,ei=0|s[6],ea=8191&ei,eo=ei>>>13,es=0|s[7],el=8191&es,ec=es>>>13,ef=0|s[8],eu=8191&ef,ed=ef>>>13,eh=0|s[9],ep=8191&eh,eb=eh>>>13;r.negative=e.negative^t.negative,r.length=19,n=Math.imul(u,U);var em=(c+n|0)+((8191&(i=(i=Math.imul(u,$))+Math.imul(d,U)|0))<<13)|0;c=((a=Math.imul(d,$))+(i>>>13)|0)+(em>>>26)|0,em&=0x3ffffff,n=Math.imul(p,U),i=(i=Math.imul(p,$))+Math.imul(b,U)|0,a=Math.imul(b,$),n=n+Math.imul(u,q)|0;var eg=(c+n|0)+((8191&(i=(i=i+Math.imul(u,V)|0)+Math.imul(d,q)|0))<<13)|0;c=((a=a+Math.imul(d,V)|0)+(i>>>13)|0)+(eg>>>26)|0,eg&=0x3ffffff,n=Math.imul(g,U),i=(i=Math.imul(g,$))+Math.imul(y,U)|0,a=Math.imul(y,$),n=n+Math.imul(p,q)|0,i=(i=i+Math.imul(p,V)|0)+Math.imul(b,q)|0,a=a+Math.imul(b,V)|0,n=n+Math.imul(u,K)|0;var ey=(c+n|0)+((8191&(i=(i=i+Math.imul(u,G)|0)+Math.imul(d,K)|0))<<13)|0;c=((a=a+Math.imul(d,G)|0)+(i>>>13)|0)+(ey>>>26)|0,ey&=0x3ffffff,n=Math.imul(x,U),i=(i=Math.imul(x,$))+Math.imul(w,U)|0,a=Math.imul(w,$),n=n+Math.imul(g,q)|0,i=(i=i+Math.imul(g,V)|0)+Math.imul(y,q)|0,a=a+Math.imul(y,V)|0,n=n+Math.imul(p,K)|0,i=(i=i+Math.imul(p,G)|0)+Math.imul(b,K)|0,a=a+Math.imul(b,G)|0,n=n+Math.imul(u,Y)|0;var ev=(c+n|0)+((8191&(i=(i=i+Math.imul(u,Z)|0)+Math.imul(d,Y)|0))<<13)|0;c=((a=a+Math.imul(d,Z)|0)+(i>>>13)|0)+(ev>>>26)|0,ev&=0x3ffffff,n=Math.imul(k,U),i=(i=Math.imul(k,$))+Math.imul(_,U)|0,a=Math.imul(_,$),n=n+Math.imul(x,q)|0,i=(i=i+Math.imul(x,V)|0)+Math.imul(w,q)|0,a=a+Math.imul(w,V)|0,n=n+Math.imul(g,K)|0,i=(i=i+Math.imul(g,G)|0)+Math.imul(y,K)|0,a=a+Math.imul(y,G)|0,n=n+Math.imul(p,Y)|0,i=(i=i+Math.imul(p,Z)|0)+Math.imul(b,Y)|0,a=a+Math.imul(b,Z)|0,n=n+Math.imul(u,Q)|0;var ex=(c+n|0)+((8191&(i=(i=i+Math.imul(u,ee)|0)+Math.imul(d,Q)|0))<<13)|0;c=((a=a+Math.imul(d,ee)|0)+(i>>>13)|0)+(ex>>>26)|0,ex&=0x3ffffff,n=Math.imul(M,U),i=(i=Math.imul(M,$))+Math.imul(N,U)|0,a=Math.imul(N,$),n=n+Math.imul(k,q)|0,i=(i=i+Math.imul(k,V)|0)+Math.imul(_,q)|0,a=a+Math.imul(_,V)|0,n=n+Math.imul(x,K)|0,i=(i=i+Math.imul(x,G)|0)+Math.imul(w,K)|0,a=a+Math.imul(w,G)|0,n=n+Math.imul(g,Y)|0,i=(i=i+Math.imul(g,Z)|0)+Math.imul(y,Y)|0,a=a+Math.imul(y,Z)|0,n=n+Math.imul(p,Q)|0,i=(i=i+Math.imul(p,ee)|0)+Math.imul(b,Q)|0,a=a+Math.imul(b,ee)|0,n=n+Math.imul(u,er)|0;var ew=(c+n|0)+((8191&(i=(i=i+Math.imul(u,en)|0)+Math.imul(d,er)|0))<<13)|0;c=((a=a+Math.imul(d,en)|0)+(i>>>13)|0)+(ew>>>26)|0,ew&=0x3ffffff,n=Math.imul(T,U),i=(i=Math.imul(T,$))+Math.imul(R,U)|0,a=Math.imul(R,$),n=n+Math.imul(M,q)|0,i=(i=i+Math.imul(M,V)|0)+Math.imul(N,q)|0,a=a+Math.imul(N,V)|0,n=n+Math.imul(k,K)|0,i=(i=i+Math.imul(k,G)|0)+Math.imul(_,K)|0,a=a+Math.imul(_,G)|0,n=n+Math.imul(x,Y)|0,i=(i=i+Math.imul(x,Z)|0)+Math.imul(w,Y)|0,a=a+Math.imul(w,Z)|0,n=n+Math.imul(g,Q)|0,i=(i=i+Math.imul(g,ee)|0)+Math.imul(y,Q)|0,a=a+Math.imul(y,ee)|0,n=n+Math.imul(p,er)|0,i=(i=i+Math.imul(p,en)|0)+Math.imul(b,er)|0,a=a+Math.imul(b,en)|0,n=n+Math.imul(u,ea)|0;var eS=(c+n|0)+((8191&(i=(i=i+Math.imul(u,eo)|0)+Math.imul(d,ea)|0))<<13)|0;c=((a=a+Math.imul(d,eo)|0)+(i>>>13)|0)+(eS>>>26)|0,eS&=0x3ffffff,n=Math.imul(j,U),i=(i=Math.imul(j,$))+Math.imul(I,U)|0,a=Math.imul(I,$),n=n+Math.imul(T,q)|0,i=(i=i+Math.imul(T,V)|0)+Math.imul(R,q)|0,a=a+Math.imul(R,V)|0,n=n+Math.imul(M,K)|0,i=(i=i+Math.imul(M,G)|0)+Math.imul(N,K)|0,a=a+Math.imul(N,G)|0,n=n+Math.imul(k,Y)|0,i=(i=i+Math.imul(k,Z)|0)+Math.imul(_,Y)|0,a=a+Math.imul(_,Z)|0,n=n+Math.imul(x,Q)|0,i=(i=i+Math.imul(x,ee)|0)+Math.imul(w,Q)|0,a=a+Math.imul(w,ee)|0,n=n+Math.imul(g,er)|0,i=(i=i+Math.imul(g,en)|0)+Math.imul(y,er)|0,a=a+Math.imul(y,en)|0,n=n+Math.imul(p,ea)|0,i=(i=i+Math.imul(p,eo)|0)+Math.imul(b,ea)|0,a=a+Math.imul(b,eo)|0,n=n+Math.imul(u,el)|0;var ek=(c+n|0)+((8191&(i=(i=i+Math.imul(u,ec)|0)+Math.imul(d,el)|0))<<13)|0;c=((a=a+Math.imul(d,ec)|0)+(i>>>13)|0)+(ek>>>26)|0,ek&=0x3ffffff,n=Math.imul(P,U),i=(i=Math.imul(P,$))+Math.imul(B,U)|0,a=Math.imul(B,$),n=n+Math.imul(j,q)|0,i=(i=i+Math.imul(j,V)|0)+Math.imul(I,q)|0,a=a+Math.imul(I,V)|0,n=n+Math.imul(T,K)|0,i=(i=i+Math.imul(T,G)|0)+Math.imul(R,K)|0,a=a+Math.imul(R,G)|0,n=n+Math.imul(M,Y)|0,i=(i=i+Math.imul(M,Z)|0)+Math.imul(N,Y)|0,a=a+Math.imul(N,Z)|0,n=n+Math.imul(k,Q)|0,i=(i=i+Math.imul(k,ee)|0)+Math.imul(_,Q)|0,a=a+Math.imul(_,ee)|0,n=n+Math.imul(x,er)|0,i=(i=i+Math.imul(x,en)|0)+Math.imul(w,er)|0,a=a+Math.imul(w,en)|0,n=n+Math.imul(g,ea)|0,i=(i=i+Math.imul(g,eo)|0)+Math.imul(y,ea)|0,a=a+Math.imul(y,eo)|0,n=n+Math.imul(p,el)|0,i=(i=i+Math.imul(p,ec)|0)+Math.imul(b,el)|0,a=a+Math.imul(b,ec)|0,n=n+Math.imul(u,eu)|0;var e_=(c+n|0)+((8191&(i=(i=i+Math.imul(u,ed)|0)+Math.imul(d,eu)|0))<<13)|0;c=((a=a+Math.imul(d,ed)|0)+(i>>>13)|0)+(e_>>>26)|0,e_&=0x3ffffff,n=Math.imul(D,U),i=(i=Math.imul(D,$))+Math.imul(z,U)|0,a=Math.imul(z,$),n=n+Math.imul(P,q)|0,i=(i=i+Math.imul(P,V)|0)+Math.imul(B,q)|0,a=a+Math.imul(B,V)|0,n=n+Math.imul(j,K)|0,i=(i=i+Math.imul(j,G)|0)+Math.imul(I,K)|0,a=a+Math.imul(I,G)|0,n=n+Math.imul(T,Y)|0,i=(i=i+Math.imul(T,Z)|0)+Math.imul(R,Y)|0,a=a+Math.imul(R,Z)|0,n=n+Math.imul(M,Q)|0,i=(i=i+Math.imul(M,ee)|0)+Math.imul(N,Q)|0,a=a+Math.imul(N,ee)|0,n=n+Math.imul(k,er)|0,i=(i=i+Math.imul(k,en)|0)+Math.imul(_,er)|0,a=a+Math.imul(_,en)|0,n=n+Math.imul(x,ea)|0,i=(i=i+Math.imul(x,eo)|0)+Math.imul(w,ea)|0,a=a+Math.imul(w,eo)|0,n=n+Math.imul(g,el)|0,i=(i=i+Math.imul(g,ec)|0)+Math.imul(y,el)|0,a=a+Math.imul(y,ec)|0,n=n+Math.imul(p,eu)|0,i=(i=i+Math.imul(p,ed)|0)+Math.imul(b,eu)|0,a=a+Math.imul(b,ed)|0,n=n+Math.imul(u,ep)|0;var eE=(c+n|0)+((8191&(i=(i=i+Math.imul(u,eb)|0)+Math.imul(d,ep)|0))<<13)|0;c=((a=a+Math.imul(d,eb)|0)+(i>>>13)|0)+(eE>>>26)|0,eE&=0x3ffffff,n=Math.imul(D,q),i=(i=Math.imul(D,V))+Math.imul(z,q)|0,a=Math.imul(z,V),n=n+Math.imul(P,K)|0,i=(i=i+Math.imul(P,G)|0)+Math.imul(B,K)|0,a=a+Math.imul(B,G)|0,n=n+Math.imul(j,Y)|0,i=(i=i+Math.imul(j,Z)|0)+Math.imul(I,Y)|0,a=a+Math.imul(I,Z)|0,n=n+Math.imul(T,Q)|0,i=(i=i+Math.imul(T,ee)|0)+Math.imul(R,Q)|0,a=a+Math.imul(R,ee)|0,n=n+Math.imul(M,er)|0,i=(i=i+Math.imul(M,en)|0)+Math.imul(N,er)|0,a=a+Math.imul(N,en)|0,n=n+Math.imul(k,ea)|0,i=(i=i+Math.imul(k,eo)|0)+Math.imul(_,ea)|0,a=a+Math.imul(_,eo)|0,n=n+Math.imul(x,el)|0,i=(i=i+Math.imul(x,ec)|0)+Math.imul(w,el)|0,a=a+Math.imul(w,ec)|0,n=n+Math.imul(g,eu)|0,i=(i=i+Math.imul(g,ed)|0)+Math.imul(y,eu)|0,a=a+Math.imul(y,ed)|0,n=n+Math.imul(p,ep)|0;var eM=(c+n|0)+((8191&(i=(i=i+Math.imul(p,eb)|0)+Math.imul(b,ep)|0))<<13)|0;c=((a=a+Math.imul(b,eb)|0)+(i>>>13)|0)+(eM>>>26)|0,eM&=0x3ffffff,n=Math.imul(D,K),i=(i=Math.imul(D,G))+Math.imul(z,K)|0,a=Math.imul(z,G),n=n+Math.imul(P,Y)|0,i=(i=i+Math.imul(P,Z)|0)+Math.imul(B,Y)|0,a=a+Math.imul(B,Z)|0,n=n+Math.imul(j,Q)|0,i=(i=i+Math.imul(j,ee)|0)+Math.imul(I,Q)|0,a=a+Math.imul(I,ee)|0,n=n+Math.imul(T,er)|0,i=(i=i+Math.imul(T,en)|0)+Math.imul(R,er)|0,a=a+Math.imul(R,en)|0,n=n+Math.imul(M,ea)|0,i=(i=i+Math.imul(M,eo)|0)+Math.imul(N,ea)|0,a=a+Math.imul(N,eo)|0,n=n+Math.imul(k,el)|0,i=(i=i+Math.imul(k,ec)|0)+Math.imul(_,el)|0,a=a+Math.imul(_,ec)|0,n=n+Math.imul(x,eu)|0,i=(i=i+Math.imul(x,ed)|0)+Math.imul(w,eu)|0,a=a+Math.imul(w,ed)|0,n=n+Math.imul(g,ep)|0;var eN=(c+n|0)+((8191&(i=(i=i+Math.imul(g,eb)|0)+Math.imul(y,ep)|0))<<13)|0;c=((a=a+Math.imul(y,eb)|0)+(i>>>13)|0)+(eN>>>26)|0,eN&=0x3ffffff,n=Math.imul(D,Y),i=(i=Math.imul(D,Z))+Math.imul(z,Y)|0,a=Math.imul(z,Z),n=n+Math.imul(P,Q)|0,i=(i=i+Math.imul(P,ee)|0)+Math.imul(B,Q)|0,a=a+Math.imul(B,ee)|0,n=n+Math.imul(j,er)|0,i=(i=i+Math.imul(j,en)|0)+Math.imul(I,er)|0,a=a+Math.imul(I,en)|0,n=n+Math.imul(T,ea)|0,i=(i=i+Math.imul(T,eo)|0)+Math.imul(R,ea)|0,a=a+Math.imul(R,eo)|0,n=n+Math.imul(M,el)|0,i=(i=i+Math.imul(M,ec)|0)+Math.imul(N,el)|0,a=a+Math.imul(N,ec)|0,n=n+Math.imul(k,eu)|0,i=(i=i+Math.imul(k,ed)|0)+Math.imul(_,eu)|0,a=a+Math.imul(_,ed)|0,n=n+Math.imul(x,ep)|0;var eA=(c+n|0)+((8191&(i=(i=i+Math.imul(x,eb)|0)+Math.imul(w,ep)|0))<<13)|0;c=((a=a+Math.imul(w,eb)|0)+(i>>>13)|0)+(eA>>>26)|0,eA&=0x3ffffff,n=Math.imul(D,Q),i=(i=Math.imul(D,ee))+Math.imul(z,Q)|0,a=Math.imul(z,ee),n=n+Math.imul(P,er)|0,i=(i=i+Math.imul(P,en)|0)+Math.imul(B,er)|0,a=a+Math.imul(B,en)|0,n=n+Math.imul(j,ea)|0,i=(i=i+Math.imul(j,eo)|0)+Math.imul(I,ea)|0,a=a+Math.imul(I,eo)|0,n=n+Math.imul(T,el)|0,i=(i=i+Math.imul(T,ec)|0)+Math.imul(R,el)|0,a=a+Math.imul(R,ec)|0,n=n+Math.imul(M,eu)|0,i=(i=i+Math.imul(M,ed)|0)+Math.imul(N,eu)|0,a=a+Math.imul(N,ed)|0,n=n+Math.imul(k,ep)|0;var eT=(c+n|0)+((8191&(i=(i=i+Math.imul(k,eb)|0)+Math.imul(_,ep)|0))<<13)|0;c=((a=a+Math.imul(_,eb)|0)+(i>>>13)|0)+(eT>>>26)|0,eT&=0x3ffffff,n=Math.imul(D,er),i=(i=Math.imul(D,en))+Math.imul(z,er)|0,a=Math.imul(z,en),n=n+Math.imul(P,ea)|0,i=(i=i+Math.imul(P,eo)|0)+Math.imul(B,ea)|0,a=a+Math.imul(B,eo)|0,n=n+Math.imul(j,el)|0,i=(i=i+Math.imul(j,ec)|0)+Math.imul(I,el)|0,a=a+Math.imul(I,ec)|0,n=n+Math.imul(T,eu)|0,i=(i=i+Math.imul(T,ed)|0)+Math.imul(R,eu)|0,a=a+Math.imul(R,ed)|0,n=n+Math.imul(M,ep)|0;var eR=(c+n|0)+((8191&(i=(i=i+Math.imul(M,eb)|0)+Math.imul(N,ep)|0))<<13)|0;c=((a=a+Math.imul(N,eb)|0)+(i>>>13)|0)+(eR>>>26)|0,eR&=0x3ffffff,n=Math.imul(D,ea),i=(i=Math.imul(D,eo))+Math.imul(z,ea)|0,a=Math.imul(z,eo),n=n+Math.imul(P,el)|0,i=(i=i+Math.imul(P,ec)|0)+Math.imul(B,el)|0,a=a+Math.imul(B,ec)|0,n=n+Math.imul(j,eu)|0,i=(i=i+Math.imul(j,ed)|0)+Math.imul(I,eu)|0,a=a+Math.imul(I,ed)|0,n=n+Math.imul(T,ep)|0;var eC=(c+n|0)+((8191&(i=(i=i+Math.imul(T,eb)|0)+Math.imul(R,ep)|0))<<13)|0;c=((a=a+Math.imul(R,eb)|0)+(i>>>13)|0)+(eC>>>26)|0,eC&=0x3ffffff,n=Math.imul(D,el),i=(i=Math.imul(D,ec))+Math.imul(z,el)|0,a=Math.imul(z,ec),n=n+Math.imul(P,eu)|0,i=(i=i+Math.imul(P,ed)|0)+Math.imul(B,eu)|0,a=a+Math.imul(B,ed)|0,n=n+Math.imul(j,ep)|0;var ej=(c+n|0)+((8191&(i=(i=i+Math.imul(j,eb)|0)+Math.imul(I,ep)|0))<<13)|0;c=((a=a+Math.imul(I,eb)|0)+(i>>>13)|0)+(ej>>>26)|0,ej&=0x3ffffff,n=Math.imul(D,eu),i=(i=Math.imul(D,ed))+Math.imul(z,eu)|0,a=Math.imul(z,ed),n=n+Math.imul(P,ep)|0;var eI=(c+n|0)+((8191&(i=(i=i+Math.imul(P,eb)|0)+Math.imul(B,ep)|0))<<13)|0;c=((a=a+Math.imul(B,eb)|0)+(i>>>13)|0)+(eI>>>26)|0,eI&=0x3ffffff,n=Math.imul(D,ep);var eL=(c+n|0)+((8191&(i=(i=Math.imul(D,eb))+Math.imul(z,ep)|0))<<13)|0;return c=((a=Math.imul(z,eb))+(i>>>13)|0)+(eL>>>26)|0,eL&=0x3ffffff,l[0]=em,l[1]=eg,l[2]=ey,l[3]=ev,l[4]=ex,l[5]=ew,l[6]=eS,l[7]=ek,l[8]=e_,l[9]=eE,l[10]=eM,l[11]=eN,l[12]=eA,l[13]=eT,l[14]=eR,l[15]=eC,l[16]=ej,l[17]=eI,l[18]=eL,0!==c&&(l[19]=c,r.length++),r};function b(e,t,r){r.negative=t.negative^e.negative,r.length=e.length+t.length;for(var n=0,i=0,a=0;a<r.length-1;a++){var o=i;i=0;for(var s=0x3ffffff&n,l=Math.min(a,t.length-1),c=Math.max(0,a-e.length+1);c<=l;c++){var f=a-c,u=(0|e.words[f])*(0|t.words[c]),d=0x3ffffff&u;o=o+(u/0x4000000|0)|0,s=0x3ffffff&(d=d+s|0),i+=(o=o+(d>>>26)|0)>>>26,o&=0x3ffffff}r.words[a]=s,n=o,o=i}return 0!==n?r.words[a]=n:r.length--,r.strip()}function m(e,t,r){return(new g).mulp(e,t,r)}function g(e,t){this.x=e,this.y=t}Math.imul||(p=h),a.prototype.mulTo=function(e,t){var r=this.length+e.length;return 10===this.length&&10===e.length?p(this,e,t):r<63?h(this,e,t):r<1024?b(this,e,t):m(this,e,t)},g.prototype.makeRBT=function(e){for(var t=Array(e),r=a.prototype._countBits(e)-1,n=0;n<e;n++)t[n]=this.revBin(n,r,e);return t},g.prototype.revBin=function(e,t,r){if(0===e||e===r-1)return e;for(var n=0,i=0;i<t;i++)n|=(1&e)<<t-i-1,e>>=1;return n},g.prototype.permute=function(e,t,r,n,i,a){for(var o=0;o<a;o++)n[o]=t[e[o]],i[o]=r[e[o]]},g.prototype.transform=function(e,t,r,n,i,a){this.permute(a,e,t,r,n,i);for(var o=1;o<i;o<<=1)for(var s=o<<1,l=Math.cos(2*Math.PI/s),c=Math.sin(2*Math.PI/s),f=0;f<i;f+=s)for(var u=l,d=c,h=0;h<o;h++){var p=r[f+h],b=n[f+h],m=r[f+h+o],g=n[f+h+o],y=u*m-d*g;g=u*g+d*m,m=y,r[f+h]=p+m,n[f+h]=b+g,r[f+h+o]=p-m,n[f+h+o]=b-g,h!==s&&(y=l*u-c*d,d=l*d+c*u,u=y)}},g.prototype.guessLen13b=function(e,t){var r=1|Math.max(t,e),n=1&r,i=0;for(r=r/2|0;r;r>>>=1)i++;return 1<<i+1+n},g.prototype.conjugate=function(e,t,r){if(!(r<=1))for(var n=0;n<r/2;n++){var i=e[n];e[n]=e[r-n-1],e[r-n-1]=i,i=t[n],t[n]=-t[r-n-1],t[r-n-1]=-i}},g.prototype.normalize13b=function(e,t){for(var r=0,n=0;n<t/2;n++){var i=8192*Math.round(e[2*n+1]/t)+Math.round(e[2*n]/t)+r;e[n]=0x3ffffff&i,r=i<0x4000000?0:i/0x4000000|0}return e},g.prototype.convert13b=function(e,t,r,i){for(var a=0,o=0;o<t;o++)a+=0|e[o],r[2*o]=8191&a,a>>>=13,r[2*o+1]=8191&a,a>>>=13;for(o=2*t;o<i;++o)r[o]=0;n(0===a),n((-8192&a)==0)},g.prototype.stub=function(e){for(var t=Array(e),r=0;r<e;r++)t[r]=0;return t},g.prototype.mulp=function(e,t,r){var n=2*this.guessLen13b(e.length,t.length),i=this.makeRBT(n),a=this.stub(n),o=Array(n),s=Array(n),l=Array(n),c=Array(n),f=Array(n),u=Array(n),d=r.words;d.length=n,this.convert13b(e.words,e.length,o,n),this.convert13b(t.words,t.length,c,n),this.transform(o,a,s,l,n,i),this.transform(c,a,f,u,n,i);for(var h=0;h<n;h++){var p=s[h]*f[h]-l[h]*u[h];l[h]=s[h]*u[h]+l[h]*f[h],s[h]=p}return this.conjugate(s,l,n),this.transform(s,l,d,a,n,i),this.conjugate(d,a,n),this.normalize13b(d,n),r.negative=e.negative^t.negative,r.length=e.length+t.length,r.strip()},a.prototype.mul=function(e){var t=new a(null);return t.words=Array(this.length+e.length),this.mulTo(e,t)},a.prototype.mulf=function(e){var t=new a(null);return t.words=Array(this.length+e.length),m(this,e,t)},a.prototype.imul=function(e){return this.clone().mulTo(e,this)},a.prototype.imuln=function(e){n("number"==typeof e),n(e<0x4000000);for(var t=0,r=0;r<this.length;r++){var i=(0|this.words[r])*e,a=(0x3ffffff&i)+(0x3ffffff&t);t>>=26,t+=(i/0x4000000|0)+(a>>>26),this.words[r]=0x3ffffff&a}return 0!==t&&(this.words[r]=t,this.length++),this},a.prototype.muln=function(e){return this.clone().imuln(e)},a.prototype.sqr=function(){return this.mul(this)},a.prototype.isqr=function(){return this.imul(this.clone())},a.prototype.pow=function(e){var t=d(e);if(0===t.length)return new a(1);for(var r=this,n=0;n<t.length&&0===t[n];n++,r=r.sqr());if(++n<t.length)for(var i=r.sqr();n<t.length;n++,i=i.sqr())0!==t[n]&&(r=r.mul(i));return r},a.prototype.iushln=function(e){n("number"==typeof e&&e>=0);var t,r=e%26,i=(e-r)/26,a=0x3ffffff>>>26-r<<26-r;if(0!==r){var o=0;for(t=0;t<this.length;t++){var s=this.words[t]&a,l=(0|this.words[t])-s<<r;this.words[t]=l|o,o=s>>>26-r}o&&(this.words[t]=o,this.length++)}if(0!==i){for(t=this.length-1;t>=0;t--)this.words[t+i]=this.words[t];for(t=0;t<i;t++)this.words[t]=0;this.length+=i}return this.strip()},a.prototype.ishln=function(e){return n(0===this.negative),this.iushln(e)},a.prototype.iushrn=function(e,t,r){n("number"==typeof e&&e>=0);var i=t?(t-t%26)/26:0,a=e%26,o=Math.min((e-a)/26,this.length),s=0x3ffffff^0x3ffffff>>>a<<a,l=r;if(i-=o,i=Math.max(0,i),l){for(var c=0;c<o;c++)l.words[c]=this.words[c];l.length=o}if(0===o);else if(this.length>o)for(this.length-=o,c=0;c<this.length;c++)this.words[c]=this.words[c+o];else this.words[0]=0,this.length=1;var f=0;for(c=this.length-1;c>=0&&(0!==f||c>=i);c--){var u=0|this.words[c];this.words[c]=f<<26-a|u>>>a,f=u&s}return l&&0!==f&&(l.words[l.length++]=f),0===this.length&&(this.words[0]=0,this.length=1),this.strip()},a.prototype.ishrn=function(e,t,r){return n(0===this.negative),this.iushrn(e,t,r)},a.prototype.shln=function(e){return this.clone().ishln(e)},a.prototype.ushln=function(e){return this.clone().iushln(e)},a.prototype.shrn=function(e){return this.clone().ishrn(e)},a.prototype.ushrn=function(e){return this.clone().iushrn(e)},a.prototype.testn=function(e){n("number"==typeof e&&e>=0);var t=e%26,r=(e-t)/26,i=1<<t;return!(this.length<=r)&&!!(this.words[r]&i)},a.prototype.imaskn=function(e){n("number"==typeof e&&e>=0);var t=e%26,r=(e-t)/26;if(n(0===this.negative,"imaskn works only with positive numbers"),this.length<=r)return this;if(0!==t&&r++,this.length=Math.min(r,this.length),0!==t){var i=0x3ffffff^0x3ffffff>>>t<<t;this.words[this.length-1]&=i}return this.strip()},a.prototype.maskn=function(e){return this.clone().imaskn(e)},a.prototype.iaddn=function(e){return(n("number"==typeof e),n(e<0x4000000),e<0)?this.isubn(-e):0!==this.negative?(1===this.length&&(0|this.words[0])<e?(this.words[0]=e-(0|this.words[0]),this.negative=0):(this.negative=0,this.isubn(e),this.negative=1),this):this._iaddn(e)},a.prototype._iaddn=function(e){this.words[0]+=e;for(var t=0;t<this.length&&this.words[t]>=0x4000000;t++)this.words[t]-=0x4000000,t===this.length-1?this.words[t+1]=1:this.words[t+1]++;return this.length=Math.max(this.length,t+1),this},a.prototype.isubn=function(e){if(n("number"==typeof e),n(e<0x4000000),e<0)return this.iaddn(-e);if(0!==this.negative)return this.negative=0,this.iaddn(e),this.negative=1,this;if(this.words[0]-=e,1===this.length&&this.words[0]<0)this.words[0]=-this.words[0],this.negative=1;else for(var t=0;t<this.length&&this.words[t]<0;t++)this.words[t]+=0x4000000,this.words[t+1]-=1;return this.strip()},a.prototype.addn=function(e){return this.clone().iaddn(e)},a.prototype.subn=function(e){return this.clone().isubn(e)},a.prototype.iabs=function(){return this.negative=0,this},a.prototype.abs=function(){return this.clone().iabs()},a.prototype._ishlnsubmul=function(e,t,r){var i,a,o=e.length+r;this._expand(o);var s=0;for(i=0;i<e.length;i++){a=(0|this.words[i+r])+s;var l=(0|e.words[i])*t;a-=0x3ffffff&l,s=(a>>26)-(l/0x4000000|0),this.words[i+r]=0x3ffffff&a}for(;i<this.length-r;i++)s=(a=(0|this.words[i+r])+s)>>26,this.words[i+r]=0x3ffffff&a;if(0===s)return this.strip();for(n(-1===s),s=0,i=0;i<this.length;i++)s=(a=-(0|this.words[i])+s)>>26,this.words[i]=0x3ffffff&a;return this.negative=1,this.strip()},a.prototype._wordDiv=function(e,t){var r,n=this.length-e.length,i=this.clone(),o=e,s=0|o.words[o.length-1];0!=(n=26-this._countBits(s))&&(o=o.ushln(n),i.iushln(n),s=0|o.words[o.length-1]);var l=i.length-o.length;if("mod"!==t){(r=new a(null)).length=l+1,r.words=Array(r.length);for(var c=0;c<r.length;c++)r.words[c]=0}var f=i.clone()._ishlnsubmul(o,1,l);0===f.negative&&(i=f,r&&(r.words[l]=1));for(var u=l-1;u>=0;u--){var d=(0|i.words[o.length+u])*0x4000000+(0|i.words[o.length+u-1]);for(d=Math.min(d/s|0,0x3ffffff),i._ishlnsubmul(o,d,u);0!==i.negative;)d--,i.negative=0,i._ishlnsubmul(o,1,u),i.isZero()||(i.negative^=1);r&&(r.words[u]=d)}return r&&r.strip(),i.strip(),"div"!==t&&0!==n&&i.iushrn(n),{div:r||null,mod:i}},a.prototype.divmod=function(e,t,r){var i,o,s;return(n(!e.isZero()),this.isZero())?{div:new a(0),mod:new a(0)}:0!==this.negative&&0===e.negative?(s=this.neg().divmod(e,t),"mod"!==t&&(i=s.div.neg()),"div"!==t&&(o=s.mod.neg(),r&&0!==o.negative&&o.iadd(e)),{div:i,mod:o}):0===this.negative&&0!==e.negative?(s=this.divmod(e.neg(),t),"mod"!==t&&(i=s.div.neg()),{div:i,mod:s.mod}):(this.negative&e.negative)!=0?(s=this.neg().divmod(e.neg(),t),"div"!==t&&(o=s.mod.neg(),r&&0!==o.negative&&o.isub(e)),{div:s.div,mod:o}):e.length>this.length||0>this.cmp(e)?{div:new a(0),mod:this}:1===e.length?"div"===t?{div:this.divn(e.words[0]),mod:null}:"mod"===t?{div:null,mod:new a(this.modn(e.words[0]))}:{div:this.divn(e.words[0]),mod:new a(this.modn(e.words[0]))}:this._wordDiv(e,t)},a.prototype.div=function(e){return this.divmod(e,"div",!1).div},a.prototype.mod=function(e){return this.divmod(e,"mod",!1).mod},a.prototype.umod=function(e){return this.divmod(e,"mod",!0).mod},a.prototype.divRound=function(e){var t=this.divmod(e);if(t.mod.isZero())return t.div;var r=0!==t.div.negative?t.mod.isub(e):t.mod,n=e.ushrn(1),i=e.andln(1),a=r.cmp(n);return a<0||1===i&&0===a?t.div:0!==t.div.negative?t.div.isubn(1):t.div.iaddn(1)},a.prototype.modn=function(e){n(e<=0x3ffffff);for(var t=0x4000000%e,r=0,i=this.length-1;i>=0;i--)r=(t*r+(0|this.words[i]))%e;return r},a.prototype.idivn=function(e){n(e<=0x3ffffff);for(var t=0,r=this.length-1;r>=0;r--){var i=(0|this.words[r])+0x4000000*t;this.words[r]=i/e|0,t=i%e}return this.strip()},a.prototype.divn=function(e){return this.clone().idivn(e)},a.prototype.egcd=function(e){n(0===e.negative),n(!e.isZero());var t=this,r=e.clone();t=0!==t.negative?t.umod(e):t.clone();for(var i=new a(1),o=new a(0),s=new a(0),l=new a(1),c=0;t.isEven()&&r.isEven();)t.iushrn(1),r.iushrn(1),++c;for(var f=r.clone(),u=t.clone();!t.isZero();){for(var d=0,h=1;(t.words[0]&h)==0&&d<26;++d,h<<=1);if(d>0)for(t.iushrn(d);d-- >0;)(i.isOdd()||o.isOdd())&&(i.iadd(f),o.isub(u)),i.iushrn(1),o.iushrn(1);for(var p=0,b=1;(r.words[0]&b)==0&&p<26;++p,b<<=1);if(p>0)for(r.iushrn(p);p-- >0;)(s.isOdd()||l.isOdd())&&(s.iadd(f),l.isub(u)),s.iushrn(1),l.iushrn(1);t.cmp(r)>=0?(t.isub(r),i.isub(s),o.isub(l)):(r.isub(t),s.isub(i),l.isub(o))}return{a:s,b:l,gcd:r.iushln(c)}},a.prototype._invmp=function(e){n(0===e.negative),n(!e.isZero());var t,r=this,i=e.clone();r=0!==r.negative?r.umod(e):r.clone();for(var o=new a(1),s=new a(0),l=i.clone();r.cmpn(1)>0&&i.cmpn(1)>0;){for(var c=0,f=1;(r.words[0]&f)==0&&c<26;++c,f<<=1);if(c>0)for(r.iushrn(c);c-- >0;)o.isOdd()&&o.iadd(l),o.iushrn(1);for(var u=0,d=1;(i.words[0]&d)==0&&u<26;++u,d<<=1);if(u>0)for(i.iushrn(u);u-- >0;)s.isOdd()&&s.iadd(l),s.iushrn(1);r.cmp(i)>=0?(r.isub(i),o.isub(s)):(i.isub(r),s.isub(o))}return 0>(t=0===r.cmpn(1)?o:s).cmpn(0)&&t.iadd(e),t},a.prototype.gcd=function(e){if(this.isZero())return e.abs();if(e.isZero())return this.abs();var t=this.clone(),r=e.clone();t.negative=0,r.negative=0;for(var n=0;t.isEven()&&r.isEven();n++)t.iushrn(1),r.iushrn(1);for(;;){for(;t.isEven();)t.iushrn(1);for(;r.isEven();)r.iushrn(1);var i=t.cmp(r);if(i<0){var a=t;t=r,r=a}else if(0===i||0===r.cmpn(1))break;t.isub(r)}return r.iushln(n)},a.prototype.invm=function(e){return this.egcd(e).a.umod(e)},a.prototype.isEven=function(){return(1&this.words[0])==0},a.prototype.isOdd=function(){return(1&this.words[0])==1},a.prototype.andln=function(e){return this.words[0]&e},a.prototype.bincn=function(e){n("number"==typeof e);var t=e%26,r=(e-t)/26,i=1<<t;if(this.length<=r)return this._expand(r+1),this.words[r]|=i,this;for(var a=i,o=r;0!==a&&o<this.length;o++){var s=0|this.words[o];s+=a,a=s>>>26,s&=0x3ffffff,this.words[o]=s}return 0!==a&&(this.words[o]=a,this.length++),this},a.prototype.isZero=function(){return 1===this.length&&0===this.words[0]},a.prototype.cmpn=function(e){var t,r=e<0;if(0!==this.negative&&!r)return -1;if(0===this.negative&&r)return 1;if(this.strip(),this.length>1)t=1;else{r&&(e=-e),n(e<=0x3ffffff,"Number is too big");var i=0|this.words[0];t=i===e?0:i<e?-1:1}return 0!==this.negative?0|-t:t},a.prototype.cmp=function(e){if(0!==this.negative&&0===e.negative)return -1;if(0===this.negative&&0!==e.negative)return 1;var t=this.ucmp(e);return 0!==this.negative?0|-t:t},a.prototype.ucmp=function(e){if(this.length>e.length)return 1;if(this.length<e.length)return -1;for(var t=0,r=this.length-1;r>=0;r--){var n=0|this.words[r],i=0|e.words[r];if(n!==i){n<i?t=-1:n>i&&(t=1);break}}return t},a.prototype.gtn=function(e){return 1===this.cmpn(e)},a.prototype.gt=function(e){return 1===this.cmp(e)},a.prototype.gten=function(e){return this.cmpn(e)>=0},a.prototype.gte=function(e){return this.cmp(e)>=0},a.prototype.ltn=function(e){return -1===this.cmpn(e)},a.prototype.lt=function(e){return -1===this.cmp(e)},a.prototype.lten=function(e){return 0>=this.cmpn(e)},a.prototype.lte=function(e){return 0>=this.cmp(e)},a.prototype.eqn=function(e){return 0===this.cmpn(e)},a.prototype.eq=function(e){return 0===this.cmp(e)},a.red=function(e){return new _(e)},a.prototype.toRed=function(e){return n(!this.red,"Already a number in reduction context"),n(0===this.negative,"red works only with positives"),e.convertTo(this)._forceRed(e)},a.prototype.fromRed=function(){return n(this.red,"fromRed works only with numbers in reduction context"),this.red.convertFrom(this)},a.prototype._forceRed=function(e){return this.red=e,this},a.prototype.forceRed=function(e){return n(!this.red,"Already a number in reduction context"),this._forceRed(e)},a.prototype.redAdd=function(e){return n(this.red,"redAdd works only with red numbers"),this.red.add(this,e)},a.prototype.redIAdd=function(e){return n(this.red,"redIAdd works only with red numbers"),this.red.iadd(this,e)},a.prototype.redSub=function(e){return n(this.red,"redSub works only with red numbers"),this.red.sub(this,e)},a.prototype.redISub=function(e){return n(this.red,"redISub works only with red numbers"),this.red.isub(this,e)},a.prototype.redShl=function(e){return n(this.red,"redShl works only with red numbers"),this.red.shl(this,e)},a.prototype.redMul=function(e){return n(this.red,"redMul works only with red numbers"),this.red._verify2(this,e),this.red.mul(this,e)},a.prototype.redIMul=function(e){return n(this.red,"redMul works only with red numbers"),this.red._verify2(this,e),this.red.imul(this,e)},a.prototype.redSqr=function(){return n(this.red,"redSqr works only with red numbers"),this.red._verify1(this),this.red.sqr(this)},a.prototype.redISqr=function(){return n(this.red,"redISqr works only with red numbers"),this.red._verify1(this),this.red.isqr(this)},a.prototype.redSqrt=function(){return n(this.red,"redSqrt works only with red numbers"),this.red._verify1(this),this.red.sqrt(this)},a.prototype.redInvm=function(){return n(this.red,"redInvm works only with red numbers"),this.red._verify1(this),this.red.invm(this)},a.prototype.redNeg=function(){return n(this.red,"redNeg works only with red numbers"),this.red._verify1(this),this.red.neg(this)},a.prototype.redPow=function(e){return n(this.red&&!e.red,"redPow(normalNum)"),this.red._verify1(this),this.red.pow(this,e)};var y={k256:null,p224:null,p192:null,p25519:null};function v(e,t){this.name=e,this.p=new a(t,16),this.n=this.p.bitLength(),this.k=new a(1).iushln(this.n).isub(this.p),this.tmp=this._tmp()}function x(){v.call(this,"k256","ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f")}function w(){v.call(this,"p224","ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001")}function S(){v.call(this,"p192","ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff")}function k(){v.call(this,"25519","7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed")}function _(e){if("string"==typeof e){var t=a._prime(e);this.m=t.p,this.prime=t}else n(e.gtn(1),"modulus must be greater than 1"),this.m=e,this.prime=null}function E(e){_.call(this,e),this.shift=this.m.bitLength(),this.shift%26!=0&&(this.shift+=26-this.shift%26),this.r=new a(1).iushln(this.shift),this.r2=this.imod(this.r.sqr()),this.rinv=this.r._invmp(this.m),this.minv=this.rinv.mul(this.r).isubn(1).div(this.m),this.minv=this.minv.umod(this.r),this.minv=this.r.sub(this.minv)}v.prototype._tmp=function(){var e=new a(null);return e.words=Array(Math.ceil(this.n/13)),e},v.prototype.ireduce=function(e){var t,r=e;do this.split(r,this.tmp),t=(r=(r=this.imulK(r)).iadd(this.tmp)).bitLength();while(t>this.n)var n=t<this.n?-1:r.ucmp(this.p);return 0===n?(r.words[0]=0,r.length=1):n>0?r.isub(this.p):void 0!==r.strip?r.strip():r._strip(),r},v.prototype.split=function(e,t){e.iushrn(this.n,0,t)},v.prototype.imulK=function(e){return e.imul(this.k)},i(x,v),x.prototype.split=function(e,t){for(var r=4194303,n=Math.min(e.length,9),i=0;i<n;i++)t.words[i]=e.words[i];if(t.length=n,e.length<=9){e.words[0]=0,e.length=1;return}var a=e.words[9];for(i=10,t.words[t.length++]=a&r;i<e.length;i++){var o=0|e.words[i];e.words[i-10]=(o&r)<<4|a>>>22,a=o}a>>>=22,e.words[i-10]=a,0===a&&e.length>10?e.length-=10:e.length-=9},x.prototype.imulK=function(e){e.words[e.length]=0,e.words[e.length+1]=0,e.length+=2;for(var t=0,r=0;r<e.length;r++){var n=0|e.words[r];t+=977*n,e.words[r]=0x3ffffff&t,t=64*n+(t/0x4000000|0)}return 0===e.words[e.length-1]&&(e.length--,0===e.words[e.length-1]&&e.length--),e},i(w,v),i(S,v),i(k,v),k.prototype.imulK=function(e){for(var t=0,r=0;r<e.length;r++){var n=(0|e.words[r])*19+t,i=0x3ffffff&n;n>>>=26,e.words[r]=i,t=n}return 0!==t&&(e.words[e.length++]=t),e},a._prime=function(e){var t;if(y[e])return y[e];if("k256"===e)t=new x;else if("p224"===e)t=new w;else if("p192"===e)t=new S;else if("p25519"===e)t=new k;else throw Error("Unknown prime "+e);return y[e]=t,t},_.prototype._verify1=function(e){n(0===e.negative,"red works only with positives"),n(e.red,"red works only with red numbers")},_.prototype._verify2=function(e,t){n((e.negative|t.negative)==0,"red works only with positives"),n(e.red&&e.red===t.red,"red works only with red numbers")},_.prototype.imod=function(e){return this.prime?this.prime.ireduce(e)._forceRed(this):e.umod(this.m)._forceRed(this)},_.prototype.neg=function(e){return e.isZero()?e.clone():this.m.sub(e)._forceRed(this)},_.prototype.add=function(e,t){this._verify2(e,t);var r=e.add(t);return r.cmp(this.m)>=0&&r.isub(this.m),r._forceRed(this)},_.prototype.iadd=function(e,t){this._verify2(e,t);var r=e.iadd(t);return r.cmp(this.m)>=0&&r.isub(this.m),r},_.prototype.sub=function(e,t){this._verify2(e,t);var r=e.sub(t);return 0>r.cmpn(0)&&r.iadd(this.m),r._forceRed(this)},_.prototype.isub=function(e,t){this._verify2(e,t);var r=e.isub(t);return 0>r.cmpn(0)&&r.iadd(this.m),r},_.prototype.shl=function(e,t){return this._verify1(e),this.imod(e.ushln(t))},_.prototype.imul=function(e,t){return this._verify2(e,t),this.imod(e.imul(t))},_.prototype.mul=function(e,t){return this._verify2(e,t),this.imod(e.mul(t))},_.prototype.isqr=function(e){return this.imul(e,e.clone())},_.prototype.sqr=function(e){return this.mul(e,e)},_.prototype.sqrt=function(e){if(e.isZero())return e.clone();var t=this.m.andln(3);if(n(t%2==1),3===t){var r=this.m.add(new a(1)).iushrn(2);return this.pow(e,r)}for(var i=this.m.subn(1),o=0;!i.isZero()&&0===i.andln(1);)o++,i.iushrn(1);n(!i.isZero());var s=new a(1).toRed(this),l=s.redNeg(),c=this.m.subn(1).iushrn(1),f=this.m.bitLength();for(f=new a(2*f*f).toRed(this);0!==this.pow(f,c).cmp(l);)f.redIAdd(l);for(var u=this.pow(f,i),d=this.pow(e,i.addn(1).iushrn(1)),h=this.pow(e,i),p=o;0!==h.cmp(s);){for(var b=h,m=0;0!==b.cmp(s);m++)b=b.redSqr();n(m<p);var g=this.pow(u,new a(1).iushln(p-m-1));d=d.redMul(g),u=g.redSqr(),h=h.redMul(u),p=m}return d},_.prototype.invm=function(e){var t=e._invmp(this.m);return 0!==t.negative?(t.negative=0,this.imod(t).redNeg()):this.imod(t)},_.prototype.pow=function(e,t){if(t.isZero())return new a(1).toRed(this);if(0===t.cmpn(1))return e.clone();var r=4,n=Array(16);n[0]=new a(1).toRed(this),n[1]=e;for(var i=2;i<n.length;i++)n[i]=this.mul(n[i-1],e);var o=n[0],s=0,l=0,c=t.bitLength()%26;for(0===c&&(c=26),i=t.length-1;i>=0;i--){for(var f=t.words[i],u=c-1;u>=0;u--){var d=f>>u&1;if(o!==n[0]&&(o=this.sqr(o)),0===d&&0===s){l=0;continue}s<<=1,s|=d,(++l===r||0===i&&0===u)&&(o=this.mul(o,n[s]),l=0,s=0)}c=26}return o},_.prototype.convertTo=function(e){var t=e.umod(this.m);return t===e?t.clone():t},_.prototype.convertFrom=function(e){var t=e.clone();return t.red=null,t},a.mont=function(e){return new E(e)},i(E,_),E.prototype.convertTo=function(e){return this.imod(e.ushln(this.shift))},E.prototype.convertFrom=function(e){var t=this.imod(e.mul(this.rinv));return t.red=null,t},E.prototype.imul=function(e,t){if(e.isZero()||t.isZero())return e.words[0]=0,e.length=1,e;var r=e.imul(t),n=r.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),i=r.isub(n).iushrn(this.shift),a=i;return i.cmp(this.m)>=0?a=i.isub(this.m):0>i.cmpn(0)&&(a=i.iadd(this.m)),a._forceRed(this)},E.prototype.mul=function(e,t){if(e.isZero()||t.isZero())return new a(0)._forceRed(this);var r=e.mul(t),n=r.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),i=r.isub(n).iushrn(this.shift),o=i;return i.cmp(this.m)>=0?o=i.isub(this.m):0>i.cmpn(0)&&(o=i.iadd(this.m)),o._forceRed(this)},E.prototype.invm=function(e){return this.imod(e._invmp(this.m).mul(this.r2))._forceRed(this)}}(e=r.nmd(e),this)},1670:function(e,t,r){!function(e,t){"use strict";function n(e,t){if(!e)throw Error(t||"Assertion failed")}function i(e,t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}function a(e,t,r){if(a.isBN(e))return e;this.negative=0,this.words=null,this.length=0,this.red=null,null!==e&&(("le"===t||"be"===t)&&(r=t,t=10),this._init(e||0,t||10,r||"be"))}"object"==typeof e?e.exports=a:t.BN=a,a.BN=a,a.wordSize=26;try{f=r(4300).Buffer}catch(e){}function o(e,t,r){for(var i=0,a=Math.min(e.length,r),o=0,s=t;s<a;s++){var l,c=e.charCodeAt(s)-48;i<<=4,i|=l=c>=49&&c<=54?c-49+10:c>=17&&c<=22?c-17+10:c,o|=l}return n(!(240&o),"Invalid character in "+e),i}function s(e,t,r,i){for(var a=0,o=0,s=Math.min(e.length,r),l=t;l<s;l++){var c=e.charCodeAt(l)-48;a*=i,o=c>=49?c-49+10:c>=17?c-17+10:c,n(c>=0&&o<i,"Invalid character"),a+=o}return a}function l(e,t){e.words=t.words,e.length=t.length,e.negative=t.negative,e.red=t.red}function c(){return(this.red?"<BN-R: ":"<BN: ")+this.toString(16)+">"}a.isBN=function(e){return e instanceof a||null!==e&&"object"==typeof e&&e.constructor.wordSize===a.wordSize&&Array.isArray(e.words)},a.max=function(e,t){return e.cmp(t)>0?e:t},a.min=function(e,t){return 0>e.cmp(t)?e:t},a.prototype._init=function(e,t,r){if("number"==typeof e)return this._initNumber(e,t,r);if("object"==typeof e)return this._initArray(e,t,r);"hex"===t&&(t=16),n(t===(0|t)&&t>=2&&t<=36);var i=0;"-"===(e=e.toString().replace(/\s+/g,""))[0]&&i++,16===t?this._parseHex(e,i):this._parseBase(e,t,i),"-"===e[0]&&(this.negative=1),this._strip(),"le"===r&&this._initArray(this.toArray(),t,r)},a.prototype._initNumber=function(e,t,r){e<0&&(this.negative=1,e=-e),e<0x4000000?(this.words=[0x3ffffff&e],this.length=1):e<0x10000000000000?(this.words=[0x3ffffff&e,e/0x4000000&0x3ffffff],this.length=2):(n(e<0x20000000000000),this.words=[0x3ffffff&e,e/0x4000000&0x3ffffff,1],this.length=3),"le"===r&&this._initArray(this.toArray(),t,r)},a.prototype._initArray=function(e,t,r){if(n("number"==typeof e.length),e.length<=0)return this.words=[0],this.length=1,this;this.length=Math.ceil(e.length/3),this.words=Array(this.length);for(var i,a,o=0;o<this.length;o++)this.words[o]=0;var s=0;if("be"===r)for(o=e.length-1,i=0;o>=0;o-=3)a=e[o]|e[o-1]<<8|e[o-2]<<16,this.words[i]|=a<<s&0x3ffffff,this.words[i+1]=a>>>26-s&0x3ffffff,(s+=24)>=26&&(s-=26,i++);else if("le"===r)for(o=0,i=0;o<e.length;o+=3)a=e[o]|e[o+1]<<8|e[o+2]<<16,this.words[i]|=a<<s&0x3ffffff,this.words[i+1]=a>>>26-s&0x3ffffff,(s+=24)>=26&&(s-=26,i++);return this._strip()},a.prototype._parseHex=function(e,t){this.length=Math.ceil((e.length-t)/6),this.words=Array(this.length);for(var r,n,i=0;i<this.length;i++)this.words[i]=0;var a=0;for(i=e.length-6,r=0;i>=t;i-=6)n=o(e,i,i+6),this.words[r]|=n<<a&0x3ffffff,this.words[r+1]|=n>>>26-a&4194303,(a+=24)>=26&&(a-=26,r++);i+6!==t&&(n=o(e,t,i+6),this.words[r]|=n<<a&0x3ffffff,this.words[r+1]|=n>>>26-a&4194303),this._strip()},a.prototype._parseBase=function(e,t,r){this.words=[0],this.length=1;for(var n=0,i=1;i<=0x3ffffff;i*=t)n++;n--,i=i/t|0;for(var a=e.length-r,o=a%n,l=Math.min(a,a-o)+r,c=0,f=r;f<l;f+=n)c=s(e,f,f+n,t),this.imuln(i),this.words[0]+c<0x4000000?this.words[0]+=c:this._iaddn(c);if(0!==o){var u=1;for(c=s(e,f,e.length,t),f=0;f<o;f++)u*=t;this.imuln(u),this.words[0]+c<0x4000000?this.words[0]+=c:this._iaddn(c)}},a.prototype.copy=function(e){e.words=Array(this.length);for(var t=0;t<this.length;t++)e.words[t]=this.words[t];e.length=this.length,e.negative=this.negative,e.red=this.red},a.prototype._move=function(e){l(e,this)},a.prototype.clone=function(){var e=new a(null);return this.copy(e),e},a.prototype._expand=function(e){for(;this.length<e;)this.words[this.length++]=0;return this},a.prototype._strip=function(){for(;this.length>1&&0===this.words[this.length-1];)this.length--;return this._normSign()},a.prototype._normSign=function(){return 1===this.length&&0===this.words[0]&&(this.negative=0),this},"undefined"!=typeof Symbol&&"function"==typeof Symbol.for?a.prototype[Symbol.for("nodejs.util.inspect.custom")]=c:a.prototype.inspect=c;var f,u=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000","000000000000000","0000000000000000","00000000000000000","000000000000000000","0000000000000000000","00000000000000000000","000000000000000000000","0000000000000000000000","00000000000000000000000","000000000000000000000000","0000000000000000000000000"],d=[0,0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],h=[0,0,0x2000000,0x290d741,0x1000000,0x2e90edd,0x39aa400,0x267bf47,0x1000000,0x290d741,1e7,0x12959c3,0x222c000,0x3bd7765,7529536,0xadcea1,0x1000000,0x1704f61,0x206fc40,0x2cddcf9,64e6,4084101,5153632,6436343,7962624,9765625,0xb54ba0,0xdaf26b,0x1069c00,0x138f9ad,243e5,0x1b4d89f,0x2000000,0x25528a1,0x2b54a20,0x3216b93,0x39aa400];a.prototype.toString=function(e,t){if(t=0|t||1,16===(e=e||10)||"hex"===e){for(var r="",i=0,a=0,o=0;o<this.length;o++){var s=this.words[o],l=((s<<i|a)&0xffffff).toString(16);r=0!=(a=s>>>24-i&0xffffff)||o!==this.length-1?u[6-l.length]+l+r:l+r,(i+=2)>=26&&(i-=26,o--)}for(0!==a&&(r=a.toString(16)+r);r.length%t!=0;)r="0"+r;return 0!==this.negative&&(r="-"+r),r}if(e===(0|e)&&e>=2&&e<=36){var c=d[e],f=h[e];r="";var p=this.clone();for(p.negative=0;!p.isZero();){var b=p.modrn(f).toString(e);r=(p=p.idivn(f)).isZero()?b+r:u[c-b.length]+b+r}for(this.isZero()&&(r="0"+r);r.length%t!=0;)r="0"+r;return 0!==this.negative&&(r="-"+r),r}n(!1,"Base should be between 2 and 36")},a.prototype.toNumber=function(){var e=this.words[0];return 2===this.length?e+=0x4000000*this.words[1]:3===this.length&&1===this.words[2]?e+=0x10000000000000+0x4000000*this.words[1]:this.length>2&&n(!1,"Number can only safely store up to 53 bits"),0!==this.negative?-e:e},a.prototype.toJSON=function(){return this.toString(16,2)},f&&(a.prototype.toBuffer=function(e,t){return this.toArrayLike(f,e,t)}),a.prototype.toArray=function(e,t){return this.toArrayLike(Array,e,t)};var p=function(e,t){return e.allocUnsafe?e.allocUnsafe(t):new e(t)};function b(e){for(var t=Array(e.bitLength()),r=0;r<t.length;r++){var n=r/26|0,i=r%26;t[r]=e.words[n]>>>i&1}return t}function m(e,t,r){r.negative=t.negative^e.negative;var n=e.length+t.length|0;r.length=n,n=n-1|0;var i=0|e.words[0],a=0|t.words[0],o=i*a,s=0x3ffffff&o,l=o/0x4000000|0;r.words[0]=s;for(var c=1;c<n;c++){for(var f=l>>>26,u=0x3ffffff&l,d=Math.min(c,t.length-1),h=Math.max(0,c-e.length+1);h<=d;h++){var p=c-h|0;f+=(o=(i=0|e.words[p])*(a=0|t.words[h])+u)/0x4000000|0,u=0x3ffffff&o}r.words[c]=0|u,l=0|f}return 0!==l?r.words[c]=0|l:r.length--,r._strip()}a.prototype.toArrayLike=function(e,t,r){this._strip();var i=this.byteLength(),a=r||Math.max(1,i);n(i<=a,"byte array longer than desired length"),n(a>0,"Requested array length <= 0");var o=p(e,a);return this["_toArrayLike"+("le"===t?"LE":"BE")](o,i),o},a.prototype._toArrayLikeLE=function(e,t){for(var r=0,n=0,i=0,a=0;i<this.length;i++){var o=this.words[i]<<a|n;e[r++]=255&o,r<e.length&&(e[r++]=o>>8&255),r<e.length&&(e[r++]=o>>16&255),6===a?(r<e.length&&(e[r++]=o>>24&255),n=0,a=0):(n=o>>>24,a+=2)}if(r<e.length)for(e[r++]=n;r<e.length;)e[r++]=0},a.prototype._toArrayLikeBE=function(e,t){for(var r=e.length-1,n=0,i=0,a=0;i<this.length;i++){var o=this.words[i]<<a|n;e[r--]=255&o,r>=0&&(e[r--]=o>>8&255),r>=0&&(e[r--]=o>>16&255),6===a?(r>=0&&(e[r--]=o>>24&255),n=0,a=0):(n=o>>>24,a+=2)}if(r>=0)for(e[r--]=n;r>=0;)e[r--]=0},Math.clz32?a.prototype._countBits=function(e){return 32-Math.clz32(e)}:a.prototype._countBits=function(e){var t=e,r=0;return t>=4096&&(r+=13,t>>>=13),t>=64&&(r+=7,t>>>=7),t>=8&&(r+=4,t>>>=4),t>=2&&(r+=2,t>>>=2),r+t},a.prototype._zeroBits=function(e){if(0===e)return 26;var t=e,r=0;return(8191&t)==0&&(r+=13,t>>>=13),(127&t)==0&&(r+=7,t>>>=7),(15&t)==0&&(r+=4,t>>>=4),(3&t)==0&&(r+=2,t>>>=2),(1&t)==0&&r++,r},a.prototype.bitLength=function(){var e=this.words[this.length-1],t=this._countBits(e);return(this.length-1)*26+t},a.prototype.zeroBits=function(){if(this.isZero())return 0;for(var e=0,t=0;t<this.length;t++){var r=this._zeroBits(this.words[t]);if(e+=r,26!==r)break}return e},a.prototype.byteLength=function(){return Math.ceil(this.bitLength()/8)},a.prototype.toTwos=function(e){return 0!==this.negative?this.abs().inotn(e).iaddn(1):this.clone()},a.prototype.fromTwos=function(e){return this.testn(e-1)?this.notn(e).iaddn(1).ineg():this.clone()},a.prototype.isNeg=function(){return 0!==this.negative},a.prototype.neg=function(){return this.clone().ineg()},a.prototype.ineg=function(){return this.isZero()||(this.negative^=1),this},a.prototype.iuor=function(e){for(;this.length<e.length;)this.words[this.length++]=0;for(var t=0;t<e.length;t++)this.words[t]=this.words[t]|e.words[t];return this._strip()},a.prototype.ior=function(e){return n((this.negative|e.negative)==0),this.iuor(e)},a.prototype.or=function(e){return this.length>e.length?this.clone().ior(e):e.clone().ior(this)},a.prototype.uor=function(e){return this.length>e.length?this.clone().iuor(e):e.clone().iuor(this)},a.prototype.iuand=function(e){var t;t=this.length>e.length?e:this;for(var r=0;r<t.length;r++)this.words[r]=this.words[r]&e.words[r];return this.length=t.length,this._strip()},a.prototype.iand=function(e){return n((this.negative|e.negative)==0),this.iuand(e)},a.prototype.and=function(e){return this.length>e.length?this.clone().iand(e):e.clone().iand(this)},a.prototype.uand=function(e){return this.length>e.length?this.clone().iuand(e):e.clone().iuand(this)},a.prototype.iuxor=function(e){this.length>e.length?(t=this,r=e):(t=e,r=this);for(var t,r,n=0;n<r.length;n++)this.words[n]=t.words[n]^r.words[n];if(this!==t)for(;n<t.length;n++)this.words[n]=t.words[n];return this.length=t.length,this._strip()},a.prototype.ixor=function(e){return n((this.negative|e.negative)==0),this.iuxor(e)},a.prototype.xor=function(e){return this.length>e.length?this.clone().ixor(e):e.clone().ixor(this)},a.prototype.uxor=function(e){return this.length>e.length?this.clone().iuxor(e):e.clone().iuxor(this)},a.prototype.inotn=function(e){n("number"==typeof e&&e>=0);var t=0|Math.ceil(e/26),r=e%26;this._expand(t),r>0&&t--;for(var i=0;i<t;i++)this.words[i]=0x3ffffff&~this.words[i];return r>0&&(this.words[i]=~this.words[i]&0x3ffffff>>26-r),this._strip()},a.prototype.notn=function(e){return this.clone().inotn(e)},a.prototype.setn=function(e,t){n("number"==typeof e&&e>=0);var r=e/26|0,i=e%26;return this._expand(r+1),t?this.words[r]=this.words[r]|1<<i:this.words[r]=this.words[r]&~(1<<i),this._strip()},a.prototype.iadd=function(e){if(0!==this.negative&&0===e.negative)return this.negative=0,t=this.isub(e),this.negative^=1,this._normSign();if(0===this.negative&&0!==e.negative)return e.negative=0,t=this.isub(e),e.negative=1,t._normSign();this.length>e.length?(r=this,n=e):(r=e,n=this);for(var t,r,n,i=0,a=0;a<n.length;a++)t=(0|r.words[a])+(0|n.words[a])+i,this.words[a]=0x3ffffff&t,i=t>>>26;for(;0!==i&&a<r.length;a++)t=(0|r.words[a])+i,this.words[a]=0x3ffffff&t,i=t>>>26;if(this.length=r.length,0!==i)this.words[this.length]=i,this.length++;else if(r!==this)for(;a<r.length;a++)this.words[a]=r.words[a];return this},a.prototype.add=function(e){var t;return 0!==e.negative&&0===this.negative?(e.negative=0,t=this.sub(e),e.negative^=1,t):0===e.negative&&0!==this.negative?(this.negative=0,t=e.sub(this),this.negative=1,t):this.length>e.length?this.clone().iadd(e):e.clone().iadd(this)},a.prototype.isub=function(e){if(0!==e.negative){e.negative=0;var t,r,n=this.iadd(e);return e.negative=1,n._normSign()}if(0!==this.negative)return this.negative=0,this.iadd(e),this.negative=1,this._normSign();var i=this.cmp(e);if(0===i)return this.negative=0,this.length=1,this.words[0]=0,this;i>0?(t=this,r=e):(t=e,r=this);for(var a=0,o=0;o<r.length;o++)a=(n=(0|t.words[o])-(0|r.words[o])+a)>>26,this.words[o]=0x3ffffff&n;for(;0!==a&&o<t.length;o++)a=(n=(0|t.words[o])+a)>>26,this.words[o]=0x3ffffff&n;if(0===a&&o<t.length&&t!==this)for(;o<t.length;o++)this.words[o]=t.words[o];return this.length=Math.max(this.length,o),t!==this&&(this.negative=1),this._strip()},a.prototype.sub=function(e){return this.clone().isub(e)};var g=function(e,t,r){var n,i,a,o=e.words,s=t.words,l=r.words,c=0,f=0|o[0],u=8191&f,d=f>>>13,h=0|o[1],p=8191&h,b=h>>>13,m=0|o[2],g=8191&m,y=m>>>13,v=0|o[3],x=8191&v,w=v>>>13,S=0|o[4],k=8191&S,_=S>>>13,E=0|o[5],M=8191&E,N=E>>>13,A=0|o[6],T=8191&A,R=A>>>13,C=0|o[7],j=8191&C,I=C>>>13,L=0|o[8],P=8191&L,B=L>>>13,O=0|o[9],D=8191&O,z=O>>>13,F=0|s[0],U=8191&F,$=F>>>13,H=0|s[1],q=8191&H,V=H>>>13,W=0|s[2],K=8191&W,G=W>>>13,X=0|s[3],Y=8191&X,Z=X>>>13,J=0|s[4],Q=8191&J,ee=J>>>13,et=0|s[5],er=8191&et,en=et>>>13,ei=0|s[6],ea=8191&ei,eo=ei>>>13,es=0|s[7],el=8191&es,ec=es>>>13,ef=0|s[8],eu=8191&ef,ed=ef>>>13,eh=0|s[9],ep=8191&eh,eb=eh>>>13;r.negative=e.negative^t.negative,r.length=19,n=Math.imul(u,U);var em=(c+n|0)+((8191&(i=(i=Math.imul(u,$))+Math.imul(d,U)|0))<<13)|0;c=((a=Math.imul(d,$))+(i>>>13)|0)+(em>>>26)|0,em&=0x3ffffff,n=Math.imul(p,U),i=(i=Math.imul(p,$))+Math.imul(b,U)|0,a=Math.imul(b,$),n=n+Math.imul(u,q)|0;var eg=(c+n|0)+((8191&(i=(i=i+Math.imul(u,V)|0)+Math.imul(d,q)|0))<<13)|0;c=((a=a+Math.imul(d,V)|0)+(i>>>13)|0)+(eg>>>26)|0,eg&=0x3ffffff,n=Math.imul(g,U),i=(i=Math.imul(g,$))+Math.imul(y,U)|0,a=Math.imul(y,$),n=n+Math.imul(p,q)|0,i=(i=i+Math.imul(p,V)|0)+Math.imul(b,q)|0,a=a+Math.imul(b,V)|0,n=n+Math.imul(u,K)|0;var ey=(c+n|0)+((8191&(i=(i=i+Math.imul(u,G)|0)+Math.imul(d,K)|0))<<13)|0;c=((a=a+Math.imul(d,G)|0)+(i>>>13)|0)+(ey>>>26)|0,ey&=0x3ffffff,n=Math.imul(x,U),i=(i=Math.imul(x,$))+Math.imul(w,U)|0,a=Math.imul(w,$),n=n+Math.imul(g,q)|0,i=(i=i+Math.imul(g,V)|0)+Math.imul(y,q)|0,a=a+Math.imul(y,V)|0,n=n+Math.imul(p,K)|0,i=(i=i+Math.imul(p,G)|0)+Math.imul(b,K)|0,a=a+Math.imul(b,G)|0,n=n+Math.imul(u,Y)|0;var ev=(c+n|0)+((8191&(i=(i=i+Math.imul(u,Z)|0)+Math.imul(d,Y)|0))<<13)|0;c=((a=a+Math.imul(d,Z)|0)+(i>>>13)|0)+(ev>>>26)|0,ev&=0x3ffffff,n=Math.imul(k,U),i=(i=Math.imul(k,$))+Math.imul(_,U)|0,a=Math.imul(_,$),n=n+Math.imul(x,q)|0,i=(i=i+Math.imul(x,V)|0)+Math.imul(w,q)|0,a=a+Math.imul(w,V)|0,n=n+Math.imul(g,K)|0,i=(i=i+Math.imul(g,G)|0)+Math.imul(y,K)|0,a=a+Math.imul(y,G)|0,n=n+Math.imul(p,Y)|0,i=(i=i+Math.imul(p,Z)|0)+Math.imul(b,Y)|0,a=a+Math.imul(b,Z)|0,n=n+Math.imul(u,Q)|0;var ex=(c+n|0)+((8191&(i=(i=i+Math.imul(u,ee)|0)+Math.imul(d,Q)|0))<<13)|0;c=((a=a+Math.imul(d,ee)|0)+(i>>>13)|0)+(ex>>>26)|0,ex&=0x3ffffff,n=Math.imul(M,U),i=(i=Math.imul(M,$))+Math.imul(N,U)|0,a=Math.imul(N,$),n=n+Math.imul(k,q)|0,i=(i=i+Math.imul(k,V)|0)+Math.imul(_,q)|0,a=a+Math.imul(_,V)|0,n=n+Math.imul(x,K)|0,i=(i=i+Math.imul(x,G)|0)+Math.imul(w,K)|0,a=a+Math.imul(w,G)|0,n=n+Math.imul(g,Y)|0,i=(i=i+Math.imul(g,Z)|0)+Math.imul(y,Y)|0,a=a+Math.imul(y,Z)|0,n=n+Math.imul(p,Q)|0,i=(i=i+Math.imul(p,ee)|0)+Math.imul(b,Q)|0,a=a+Math.imul(b,ee)|0,n=n+Math.imul(u,er)|0;var ew=(c+n|0)+((8191&(i=(i=i+Math.imul(u,en)|0)+Math.imul(d,er)|0))<<13)|0;c=((a=a+Math.imul(d,en)|0)+(i>>>13)|0)+(ew>>>26)|0,ew&=0x3ffffff,n=Math.imul(T,U),i=(i=Math.imul(T,$))+Math.imul(R,U)|0,a=Math.imul(R,$),n=n+Math.imul(M,q)|0,i=(i=i+Math.imul(M,V)|0)+Math.imul(N,q)|0,a=a+Math.imul(N,V)|0,n=n+Math.imul(k,K)|0,i=(i=i+Math.imul(k,G)|0)+Math.imul(_,K)|0,a=a+Math.imul(_,G)|0,n=n+Math.imul(x,Y)|0,i=(i=i+Math.imul(x,Z)|0)+Math.imul(w,Y)|0,a=a+Math.imul(w,Z)|0,n=n+Math.imul(g,Q)|0,i=(i=i+Math.imul(g,ee)|0)+Math.imul(y,Q)|0,a=a+Math.imul(y,ee)|0,n=n+Math.imul(p,er)|0,i=(i=i+Math.imul(p,en)|0)+Math.imul(b,er)|0,a=a+Math.imul(b,en)|0,n=n+Math.imul(u,ea)|0;var eS=(c+n|0)+((8191&(i=(i=i+Math.imul(u,eo)|0)+Math.imul(d,ea)|0))<<13)|0;c=((a=a+Math.imul(d,eo)|0)+(i>>>13)|0)+(eS>>>26)|0,eS&=0x3ffffff,n=Math.imul(j,U),i=(i=Math.imul(j,$))+Math.imul(I,U)|0,a=Math.imul(I,$),n=n+Math.imul(T,q)|0,i=(i=i+Math.imul(T,V)|0)+Math.imul(R,q)|0,a=a+Math.imul(R,V)|0,n=n+Math.imul(M,K)|0,i=(i=i+Math.imul(M,G)|0)+Math.imul(N,K)|0,a=a+Math.imul(N,G)|0,n=n+Math.imul(k,Y)|0,i=(i=i+Math.imul(k,Z)|0)+Math.imul(_,Y)|0,a=a+Math.imul(_,Z)|0,n=n+Math.imul(x,Q)|0,i=(i=i+Math.imul(x,ee)|0)+Math.imul(w,Q)|0,a=a+Math.imul(w,ee)|0,n=n+Math.imul(g,er)|0,i=(i=i+Math.imul(g,en)|0)+Math.imul(y,er)|0,a=a+Math.imul(y,en)|0,n=n+Math.imul(p,ea)|0,i=(i=i+Math.imul(p,eo)|0)+Math.imul(b,ea)|0,a=a+Math.imul(b,eo)|0,n=n+Math.imul(u,el)|0;var ek=(c+n|0)+((8191&(i=(i=i+Math.imul(u,ec)|0)+Math.imul(d,el)|0))<<13)|0;c=((a=a+Math.imul(d,ec)|0)+(i>>>13)|0)+(ek>>>26)|0,ek&=0x3ffffff,n=Math.imul(P,U),i=(i=Math.imul(P,$))+Math.imul(B,U)|0,a=Math.imul(B,$),n=n+Math.imul(j,q)|0,i=(i=i+Math.imul(j,V)|0)+Math.imul(I,q)|0,a=a+Math.imul(I,V)|0,n=n+Math.imul(T,K)|0,i=(i=i+Math.imul(T,G)|0)+Math.imul(R,K)|0,a=a+Math.imul(R,G)|0,n=n+Math.imul(M,Y)|0,i=(i=i+Math.imul(M,Z)|0)+Math.imul(N,Y)|0,a=a+Math.imul(N,Z)|0,n=n+Math.imul(k,Q)|0,i=(i=i+Math.imul(k,ee)|0)+Math.imul(_,Q)|0,a=a+Math.imul(_,ee)|0,n=n+Math.imul(x,er)|0,i=(i=i+Math.imul(x,en)|0)+Math.imul(w,er)|0,a=a+Math.imul(w,en)|0,n=n+Math.imul(g,ea)|0,i=(i=i+Math.imul(g,eo)|0)+Math.imul(y,ea)|0,a=a+Math.imul(y,eo)|0,n=n+Math.imul(p,el)|0,i=(i=i+Math.imul(p,ec)|0)+Math.imul(b,el)|0,a=a+Math.imul(b,ec)|0,n=n+Math.imul(u,eu)|0;var e_=(c+n|0)+((8191&(i=(i=i+Math.imul(u,ed)|0)+Math.imul(d,eu)|0))<<13)|0;c=((a=a+Math.imul(d,ed)|0)+(i>>>13)|0)+(e_>>>26)|0,e_&=0x3ffffff,n=Math.imul(D,U),i=(i=Math.imul(D,$))+Math.imul(z,U)|0,a=Math.imul(z,$),n=n+Math.imul(P,q)|0,i=(i=i+Math.imul(P,V)|0)+Math.imul(B,q)|0,a=a+Math.imul(B,V)|0,n=n+Math.imul(j,K)|0,i=(i=i+Math.imul(j,G)|0)+Math.imul(I,K)|0,a=a+Math.imul(I,G)|0,n=n+Math.imul(T,Y)|0,i=(i=i+Math.imul(T,Z)|0)+Math.imul(R,Y)|0,a=a+Math.imul(R,Z)|0,n=n+Math.imul(M,Q)|0,i=(i=i+Math.imul(M,ee)|0)+Math.imul(N,Q)|0,a=a+Math.imul(N,ee)|0,n=n+Math.imul(k,er)|0,i=(i=i+Math.imul(k,en)|0)+Math.imul(_,er)|0,a=a+Math.imul(_,en)|0,n=n+Math.imul(x,ea)|0,i=(i=i+Math.imul(x,eo)|0)+Math.imul(w,ea)|0,a=a+Math.imul(w,eo)|0,n=n+Math.imul(g,el)|0,i=(i=i+Math.imul(g,ec)|0)+Math.imul(y,el)|0,a=a+Math.imul(y,ec)|0,n=n+Math.imul(p,eu)|0,i=(i=i+Math.imul(p,ed)|0)+Math.imul(b,eu)|0,a=a+Math.imul(b,ed)|0,n=n+Math.imul(u,ep)|0;var eE=(c+n|0)+((8191&(i=(i=i+Math.imul(u,eb)|0)+Math.imul(d,ep)|0))<<13)|0;c=((a=a+Math.imul(d,eb)|0)+(i>>>13)|0)+(eE>>>26)|0,eE&=0x3ffffff,n=Math.imul(D,q),i=(i=Math.imul(D,V))+Math.imul(z,q)|0,a=Math.imul(z,V),n=n+Math.imul(P,K)|0,i=(i=i+Math.imul(P,G)|0)+Math.imul(B,K)|0,a=a+Math.imul(B,G)|0,n=n+Math.imul(j,Y)|0,i=(i=i+Math.imul(j,Z)|0)+Math.imul(I,Y)|0,a=a+Math.imul(I,Z)|0,n=n+Math.imul(T,Q)|0,i=(i=i+Math.imul(T,ee)|0)+Math.imul(R,Q)|0,a=a+Math.imul(R,ee)|0,n=n+Math.imul(M,er)|0,i=(i=i+Math.imul(M,en)|0)+Math.imul(N,er)|0,a=a+Math.imul(N,en)|0,n=n+Math.imul(k,ea)|0,i=(i=i+Math.imul(k,eo)|0)+Math.imul(_,ea)|0,a=a+Math.imul(_,eo)|0,n=n+Math.imul(x,el)|0,i=(i=i+Math.imul(x,ec)|0)+Math.imul(w,el)|0,a=a+Math.imul(w,ec)|0,n=n+Math.imul(g,eu)|0,i=(i=i+Math.imul(g,ed)|0)+Math.imul(y,eu)|0,a=a+Math.imul(y,ed)|0,n=n+Math.imul(p,ep)|0;var eM=(c+n|0)+((8191&(i=(i=i+Math.imul(p,eb)|0)+Math.imul(b,ep)|0))<<13)|0;c=((a=a+Math.imul(b,eb)|0)+(i>>>13)|0)+(eM>>>26)|0,eM&=0x3ffffff,n=Math.imul(D,K),i=(i=Math.imul(D,G))+Math.imul(z,K)|0,a=Math.imul(z,G),n=n+Math.imul(P,Y)|0,i=(i=i+Math.imul(P,Z)|0)+Math.imul(B,Y)|0,a=a+Math.imul(B,Z)|0,n=n+Math.imul(j,Q)|0,i=(i=i+Math.imul(j,ee)|0)+Math.imul(I,Q)|0,a=a+Math.imul(I,ee)|0,n=n+Math.imul(T,er)|0,i=(i=i+Math.imul(T,en)|0)+Math.imul(R,er)|0,a=a+Math.imul(R,en)|0,n=n+Math.imul(M,ea)|0,i=(i=i+Math.imul(M,eo)|0)+Math.imul(N,ea)|0,a=a+Math.imul(N,eo)|0,n=n+Math.imul(k,el)|0,i=(i=i+Math.imul(k,ec)|0)+Math.imul(_,el)|0,a=a+Math.imul(_,ec)|0,n=n+Math.imul(x,eu)|0,i=(i=i+Math.imul(x,ed)|0)+Math.imul(w,eu)|0,a=a+Math.imul(w,ed)|0,n=n+Math.imul(g,ep)|0;var eN=(c+n|0)+((8191&(i=(i=i+Math.imul(g,eb)|0)+Math.imul(y,ep)|0))<<13)|0;c=((a=a+Math.imul(y,eb)|0)+(i>>>13)|0)+(eN>>>26)|0,eN&=0x3ffffff,n=Math.imul(D,Y),i=(i=Math.imul(D,Z))+Math.imul(z,Y)|0,a=Math.imul(z,Z),n=n+Math.imul(P,Q)|0,i=(i=i+Math.imul(P,ee)|0)+Math.imul(B,Q)|0,a=a+Math.imul(B,ee)|0,n=n+Math.imul(j,er)|0,i=(i=i+Math.imul(j,en)|0)+Math.imul(I,er)|0,a=a+Math.imul(I,en)|0,n=n+Math.imul(T,ea)|0,i=(i=i+Math.imul(T,eo)|0)+Math.imul(R,ea)|0,a=a+Math.imul(R,eo)|0,n=n+Math.imul(M,el)|0,i=(i=i+Math.imul(M,ec)|0)+Math.imul(N,el)|0,a=a+Math.imul(N,ec)|0,n=n+Math.imul(k,eu)|0,i=(i=i+Math.imul(k,ed)|0)+Math.imul(_,eu)|0,a=a+Math.imul(_,ed)|0,n=n+Math.imul(x,ep)|0;var eA=(c+n|0)+((8191&(i=(i=i+Math.imul(x,eb)|0)+Math.imul(w,ep)|0))<<13)|0;c=((a=a+Math.imul(w,eb)|0)+(i>>>13)|0)+(eA>>>26)|0,eA&=0x3ffffff,n=Math.imul(D,Q),i=(i=Math.imul(D,ee))+Math.imul(z,Q)|0,a=Math.imul(z,ee),n=n+Math.imul(P,er)|0,i=(i=i+Math.imul(P,en)|0)+Math.imul(B,er)|0,a=a+Math.imul(B,en)|0,n=n+Math.imul(j,ea)|0,i=(i=i+Math.imul(j,eo)|0)+Math.imul(I,ea)|0,a=a+Math.imul(I,eo)|0,n=n+Math.imul(T,el)|0,i=(i=i+Math.imul(T,ec)|0)+Math.imul(R,el)|0,a=a+Math.imul(R,ec)|0,n=n+Math.imul(M,eu)|0,i=(i=i+Math.imul(M,ed)|0)+Math.imul(N,eu)|0,a=a+Math.imul(N,ed)|0,n=n+Math.imul(k,ep)|0;var eT=(c+n|0)+((8191&(i=(i=i+Math.imul(k,eb)|0)+Math.imul(_,ep)|0))<<13)|0;c=((a=a+Math.imul(_,eb)|0)+(i>>>13)|0)+(eT>>>26)|0,eT&=0x3ffffff,n=Math.imul(D,er),i=(i=Math.imul(D,en))+Math.imul(z,er)|0,a=Math.imul(z,en),n=n+Math.imul(P,ea)|0,i=(i=i+Math.imul(P,eo)|0)+Math.imul(B,ea)|0,a=a+Math.imul(B,eo)|0,n=n+Math.imul(j,el)|0,i=(i=i+Math.imul(j,ec)|0)+Math.imul(I,el)|0,a=a+Math.imul(I,ec)|0,n=n+Math.imul(T,eu)|0,i=(i=i+Math.imul(T,ed)|0)+Math.imul(R,eu)|0,a=a+Math.imul(R,ed)|0,n=n+Math.imul(M,ep)|0;var eR=(c+n|0)+((8191&(i=(i=i+Math.imul(M,eb)|0)+Math.imul(N,ep)|0))<<13)|0;c=((a=a+Math.imul(N,eb)|0)+(i>>>13)|0)+(eR>>>26)|0,eR&=0x3ffffff,n=Math.imul(D,ea),i=(i=Math.imul(D,eo))+Math.imul(z,ea)|0,a=Math.imul(z,eo),n=n+Math.imul(P,el)|0,i=(i=i+Math.imul(P,ec)|0)+Math.imul(B,el)|0,a=a+Math.imul(B,ec)|0,n=n+Math.imul(j,eu)|0,i=(i=i+Math.imul(j,ed)|0)+Math.imul(I,eu)|0,a=a+Math.imul(I,ed)|0,n=n+Math.imul(T,ep)|0;var eC=(c+n|0)+((8191&(i=(i=i+Math.imul(T,eb)|0)+Math.imul(R,ep)|0))<<13)|0;c=((a=a+Math.imul(R,eb)|0)+(i>>>13)|0)+(eC>>>26)|0,eC&=0x3ffffff,n=Math.imul(D,el),i=(i=Math.imul(D,ec))+Math.imul(z,el)|0,a=Math.imul(z,ec),n=n+Math.imul(P,eu)|0,i=(i=i+Math.imul(P,ed)|0)+Math.imul(B,eu)|0,a=a+Math.imul(B,ed)|0,n=n+Math.imul(j,ep)|0;var ej=(c+n|0)+((8191&(i=(i=i+Math.imul(j,eb)|0)+Math.imul(I,ep)|0))<<13)|0;c=((a=a+Math.imul(I,eb)|0)+(i>>>13)|0)+(ej>>>26)|0,ej&=0x3ffffff,n=Math.imul(D,eu),i=(i=Math.imul(D,ed))+Math.imul(z,eu)|0,a=Math.imul(z,ed),n=n+Math.imul(P,ep)|0;var eI=(c+n|0)+((8191&(i=(i=i+Math.imul(P,eb)|0)+Math.imul(B,ep)|0))<<13)|0;c=((a=a+Math.imul(B,eb)|0)+(i>>>13)|0)+(eI>>>26)|0,eI&=0x3ffffff,n=Math.imul(D,ep);var eL=(c+n|0)+((8191&(i=(i=Math.imul(D,eb))+Math.imul(z,ep)|0))<<13)|0;return c=((a=Math.imul(z,eb))+(i>>>13)|0)+(eL>>>26)|0,eL&=0x3ffffff,l[0]=em,l[1]=eg,l[2]=ey,l[3]=ev,l[4]=ex,l[5]=ew,l[6]=eS,l[7]=ek,l[8]=e_,l[9]=eE,l[10]=eM,l[11]=eN,l[12]=eA,l[13]=eT,l[14]=eR,l[15]=eC,l[16]=ej,l[17]=eI,l[18]=eL,0!==c&&(l[19]=c,r.length++),r};function y(e,t,r){r.negative=t.negative^e.negative,r.length=e.length+t.length;for(var n=0,i=0,a=0;a<r.length-1;a++){var o=i;i=0;for(var s=0x3ffffff&n,l=Math.min(a,t.length-1),c=Math.max(0,a-e.length+1);c<=l;c++){var f=a-c,u=(0|e.words[f])*(0|t.words[c]),d=0x3ffffff&u;o=o+(u/0x4000000|0)|0,s=0x3ffffff&(d=d+s|0),i+=(o=o+(d>>>26)|0)>>>26,o&=0x3ffffff}r.words[a]=s,n=o,o=i}return 0!==n?r.words[a]=n:r.length--,r._strip()}function v(e,t,r){return y(e,t,r)}function x(e,t){this.x=e,this.y=t}Math.imul||(g=m),a.prototype.mulTo=function(e,t){var r=this.length+e.length;return 10===this.length&&10===e.length?g(this,e,t):r<63?m(this,e,t):r<1024?y(this,e,t):v(this,e,t)},x.prototype.makeRBT=function(e){for(var t=Array(e),r=a.prototype._countBits(e)-1,n=0;n<e;n++)t[n]=this.revBin(n,r,e);return t},x.prototype.revBin=function(e,t,r){if(0===e||e===r-1)return e;for(var n=0,i=0;i<t;i++)n|=(1&e)<<t-i-1,e>>=1;return n},x.prototype.permute=function(e,t,r,n,i,a){for(var o=0;o<a;o++)n[o]=t[e[o]],i[o]=r[e[o]]},x.prototype.transform=function(e,t,r,n,i,a){this.permute(a,e,t,r,n,i);for(var o=1;o<i;o<<=1)for(var s=o<<1,l=Math.cos(2*Math.PI/s),c=Math.sin(2*Math.PI/s),f=0;f<i;f+=s)for(var u=l,d=c,h=0;h<o;h++){var p=r[f+h],b=n[f+h],m=r[f+h+o],g=n[f+h+o],y=u*m-d*g;g=u*g+d*m,m=y,r[f+h]=p+m,n[f+h]=b+g,r[f+h+o]=p-m,n[f+h+o]=b-g,h!==s&&(y=l*u-c*d,d=l*d+c*u,u=y)}},x.prototype.guessLen13b=function(e,t){var r=1|Math.max(t,e),n=1&r,i=0;for(r=r/2|0;r;r>>>=1)i++;return 1<<i+1+n},x.prototype.conjugate=function(e,t,r){if(!(r<=1))for(var n=0;n<r/2;n++){var i=e[n];e[n]=e[r-n-1],e[r-n-1]=i,i=t[n],t[n]=-t[r-n-1],t[r-n-1]=-i}},x.prototype.normalize13b=function(e,t){for(var r=0,n=0;n<t/2;n++){var i=8192*Math.round(e[2*n+1]/t)+Math.round(e[2*n]/t)+r;e[n]=0x3ffffff&i,r=i<0x4000000?0:i/0x4000000|0}return e},x.prototype.convert13b=function(e,t,r,i){for(var a=0,o=0;o<t;o++)a+=0|e[o],r[2*o]=8191&a,a>>>=13,r[2*o+1]=8191&a,a>>>=13;for(o=2*t;o<i;++o)r[o]=0;n(0===a),n((-8192&a)==0)},x.prototype.stub=function(e){for(var t=Array(e),r=0;r<e;r++)t[r]=0;return t},x.prototype.mulp=function(e,t,r){var n=2*this.guessLen13b(e.length,t.length),i=this.makeRBT(n),a=this.stub(n),o=Array(n),s=Array(n),l=Array(n),c=Array(n),f=Array(n),u=Array(n),d=r.words;d.length=n,this.convert13b(e.words,e.length,o,n),this.convert13b(t.words,t.length,c,n),this.transform(o,a,s,l,n,i),this.transform(c,a,f,u,n,i);for(var h=0;h<n;h++){var p=s[h]*f[h]-l[h]*u[h];l[h]=s[h]*u[h]+l[h]*f[h],s[h]=p}return this.conjugate(s,l,n),this.transform(s,l,d,a,n,i),this.conjugate(d,a,n),this.normalize13b(d,n),r.negative=e.negative^t.negative,r.length=e.length+t.length,r._strip()},a.prototype.mul=function(e){var t=new a(null);return t.words=Array(this.length+e.length),this.mulTo(e,t)},a.prototype.mulf=function(e){var t=new a(null);return t.words=Array(this.length+e.length),v(this,e,t)},a.prototype.imul=function(e){return this.clone().mulTo(e,this)},a.prototype.imuln=function(e){var t=e<0;t&&(e=-e),n("number"==typeof e),n(e<0x4000000);for(var r=0,i=0;i<this.length;i++){var a=(0|this.words[i])*e,o=(0x3ffffff&a)+(0x3ffffff&r);r>>=26,r+=(a/0x4000000|0)+(o>>>26),this.words[i]=0x3ffffff&o}return 0!==r&&(this.words[i]=r,this.length++),t?this.ineg():this},a.prototype.muln=function(e){return this.clone().imuln(e)},a.prototype.sqr=function(){return this.mul(this)},a.prototype.isqr=function(){return this.imul(this.clone())},a.prototype.pow=function(e){var t=b(e);if(0===t.length)return new a(1);for(var r=this,n=0;n<t.length&&0===t[n];n++,r=r.sqr());if(++n<t.length)for(var i=r.sqr();n<t.length;n++,i=i.sqr())0!==t[n]&&(r=r.mul(i));return r},a.prototype.iushln=function(e){n("number"==typeof e&&e>=0);var t,r=e%26,i=(e-r)/26,a=0x3ffffff>>>26-r<<26-r;if(0!==r){var o=0;for(t=0;t<this.length;t++){var s=this.words[t]&a,l=(0|this.words[t])-s<<r;this.words[t]=l|o,o=s>>>26-r}o&&(this.words[t]=o,this.length++)}if(0!==i){for(t=this.length-1;t>=0;t--)this.words[t+i]=this.words[t];for(t=0;t<i;t++)this.words[t]=0;this.length+=i}return this._strip()},a.prototype.ishln=function(e){return n(0===this.negative),this.iushln(e)},a.prototype.iushrn=function(e,t,r){n("number"==typeof e&&e>=0);var i=t?(t-t%26)/26:0,a=e%26,o=Math.min((e-a)/26,this.length),s=0x3ffffff^0x3ffffff>>>a<<a,l=r;if(i-=o,i=Math.max(0,i),l){for(var c=0;c<o;c++)l.words[c]=this.words[c];l.length=o}if(0===o);else if(this.length>o)for(this.length-=o,c=0;c<this.length;c++)this.words[c]=this.words[c+o];else this.words[0]=0,this.length=1;var f=0;for(c=this.length-1;c>=0&&(0!==f||c>=i);c--){var u=0|this.words[c];this.words[c]=f<<26-a|u>>>a,f=u&s}return l&&0!==f&&(l.words[l.length++]=f),0===this.length&&(this.words[0]=0,this.length=1),this._strip()},a.prototype.ishrn=function(e,t,r){return n(0===this.negative),this.iushrn(e,t,r)},a.prototype.shln=function(e){return this.clone().ishln(e)},a.prototype.ushln=function(e){return this.clone().iushln(e)},a.prototype.shrn=function(e){return this.clone().ishrn(e)},a.prototype.ushrn=function(e){return this.clone().iushrn(e)},a.prototype.testn=function(e){n("number"==typeof e&&e>=0);var t=e%26,r=(e-t)/26,i=1<<t;return!(this.length<=r)&&!!(this.words[r]&i)},a.prototype.imaskn=function(e){n("number"==typeof e&&e>=0);var t=e%26,r=(e-t)/26;if(n(0===this.negative,"imaskn works only with positive numbers"),this.length<=r)return this;if(0!==t&&r++,this.length=Math.min(r,this.length),0!==t){var i=0x3ffffff^0x3ffffff>>>t<<t;this.words[this.length-1]&=i}return this._strip()},a.prototype.maskn=function(e){return this.clone().imaskn(e)},a.prototype.iaddn=function(e){return(n("number"==typeof e),n(e<0x4000000),e<0)?this.isubn(-e):0!==this.negative?(1===this.length&&(0|this.words[0])<=e?(this.words[0]=e-(0|this.words[0]),this.negative=0):(this.negative=0,this.isubn(e),this.negative=1),this):this._iaddn(e)},a.prototype._iaddn=function(e){this.words[0]+=e;for(var t=0;t<this.length&&this.words[t]>=0x4000000;t++)this.words[t]-=0x4000000,t===this.length-1?this.words[t+1]=1:this.words[t+1]++;return this.length=Math.max(this.length,t+1),this},a.prototype.isubn=function(e){if(n("number"==typeof e),n(e<0x4000000),e<0)return this.iaddn(-e);if(0!==this.negative)return this.negative=0,this.iaddn(e),this.negative=1,this;if(this.words[0]-=e,1===this.length&&this.words[0]<0)this.words[0]=-this.words[0],this.negative=1;else for(var t=0;t<this.length&&this.words[t]<0;t++)this.words[t]+=0x4000000,this.words[t+1]-=1;return this._strip()},a.prototype.addn=function(e){return this.clone().iaddn(e)},a.prototype.subn=function(e){return this.clone().isubn(e)},a.prototype.iabs=function(){return this.negative=0,this},a.prototype.abs=function(){return this.clone().iabs()},a.prototype._ishlnsubmul=function(e,t,r){var i,a,o=e.length+r;this._expand(o);var s=0;for(i=0;i<e.length;i++){a=(0|this.words[i+r])+s;var l=(0|e.words[i])*t;a-=0x3ffffff&l,s=(a>>26)-(l/0x4000000|0),this.words[i+r]=0x3ffffff&a}for(;i<this.length-r;i++)s=(a=(0|this.words[i+r])+s)>>26,this.words[i+r]=0x3ffffff&a;if(0===s)return this._strip();for(n(-1===s),s=0,i=0;i<this.length;i++)s=(a=-(0|this.words[i])+s)>>26,this.words[i]=0x3ffffff&a;return this.negative=1,this._strip()},a.prototype._wordDiv=function(e,t){var r,n=this.length-e.length,i=this.clone(),o=e,s=0|o.words[o.length-1];0!=(n=26-this._countBits(s))&&(o=o.ushln(n),i.iushln(n),s=0|o.words[o.length-1]);var l=i.length-o.length;if("mod"!==t){(r=new a(null)).length=l+1,r.words=Array(r.length);for(var c=0;c<r.length;c++)r.words[c]=0}var f=i.clone()._ishlnsubmul(o,1,l);0===f.negative&&(i=f,r&&(r.words[l]=1));for(var u=l-1;u>=0;u--){var d=(0|i.words[o.length+u])*0x4000000+(0|i.words[o.length+u-1]);for(d=Math.min(d/s|0,0x3ffffff),i._ishlnsubmul(o,d,u);0!==i.negative;)d--,i.negative=0,i._ishlnsubmul(o,1,u),i.isZero()||(i.negative^=1);r&&(r.words[u]=d)}return r&&r._strip(),i._strip(),"div"!==t&&0!==n&&i.iushrn(n),{div:r||null,mod:i}},a.prototype.divmod=function(e,t,r){var i,o,s;return(n(!e.isZero()),this.isZero())?{div:new a(0),mod:new a(0)}:0!==this.negative&&0===e.negative?(s=this.neg().divmod(e,t),"mod"!==t&&(i=s.div.neg()),"div"!==t&&(o=s.mod.neg(),r&&0!==o.negative&&o.iadd(e)),{div:i,mod:o}):0===this.negative&&0!==e.negative?(s=this.divmod(e.neg(),t),"mod"!==t&&(i=s.div.neg()),{div:i,mod:s.mod}):(this.negative&e.negative)!=0?(s=this.neg().divmod(e.neg(),t),"div"!==t&&(o=s.mod.neg(),r&&0!==o.negative&&o.isub(e)),{div:s.div,mod:o}):e.length>this.length||0>this.cmp(e)?{div:new a(0),mod:this}:1===e.length?"div"===t?{div:this.divn(e.words[0]),mod:null}:"mod"===t?{div:null,mod:new a(this.modrn(e.words[0]))}:{div:this.divn(e.words[0]),mod:new a(this.modrn(e.words[0]))}:this._wordDiv(e,t)},a.prototype.div=function(e){return this.divmod(e,"div",!1).div},a.prototype.mod=function(e){return this.divmod(e,"mod",!1).mod},a.prototype.umod=function(e){return this.divmod(e,"mod",!0).mod},a.prototype.divRound=function(e){var t=this.divmod(e);if(t.mod.isZero())return t.div;var r=0!==t.div.negative?t.mod.isub(e):t.mod,n=e.ushrn(1),i=e.andln(1),a=r.cmp(n);return a<0||1===i&&0===a?t.div:0!==t.div.negative?t.div.isubn(1):t.div.iaddn(1)},a.prototype.modrn=function(e){var t=e<0;t&&(e=-e),n(e<=0x3ffffff);for(var r=0x4000000%e,i=0,a=this.length-1;a>=0;a--)i=(r*i+(0|this.words[a]))%e;return t?-i:i},a.prototype.modn=function(e){return this.modrn(e)},a.prototype.idivn=function(e){var t=e<0;t&&(e=-e),n(e<=0x3ffffff);for(var r=0,i=this.length-1;i>=0;i--){var a=(0|this.words[i])+0x4000000*r;this.words[i]=a/e|0,r=a%e}return this._strip(),t?this.ineg():this},a.prototype.divn=function(e){return this.clone().idivn(e)},a.prototype.egcd=function(e){n(0===e.negative),n(!e.isZero());var t=this,r=e.clone();t=0!==t.negative?t.umod(e):t.clone();for(var i=new a(1),o=new a(0),s=new a(0),l=new a(1),c=0;t.isEven()&&r.isEven();)t.iushrn(1),r.iushrn(1),++c;for(var f=r.clone(),u=t.clone();!t.isZero();){for(var d=0,h=1;(t.words[0]&h)==0&&d<26;++d,h<<=1);if(d>0)for(t.iushrn(d);d-- >0;)(i.isOdd()||o.isOdd())&&(i.iadd(f),o.isub(u)),i.iushrn(1),o.iushrn(1);for(var p=0,b=1;(r.words[0]&b)==0&&p<26;++p,b<<=1);if(p>0)for(r.iushrn(p);p-- >0;)(s.isOdd()||l.isOdd())&&(s.iadd(f),l.isub(u)),s.iushrn(1),l.iushrn(1);t.cmp(r)>=0?(t.isub(r),i.isub(s),o.isub(l)):(r.isub(t),s.isub(i),l.isub(o))}return{a:s,b:l,gcd:r.iushln(c)}},a.prototype._invmp=function(e){n(0===e.negative),n(!e.isZero());var t,r=this,i=e.clone();r=0!==r.negative?r.umod(e):r.clone();for(var o=new a(1),s=new a(0),l=i.clone();r.cmpn(1)>0&&i.cmpn(1)>0;){for(var c=0,f=1;(r.words[0]&f)==0&&c<26;++c,f<<=1);if(c>0)for(r.iushrn(c);c-- >0;)o.isOdd()&&o.iadd(l),o.iushrn(1);for(var u=0,d=1;(i.words[0]&d)==0&&u<26;++u,d<<=1);if(u>0)for(i.iushrn(u);u-- >0;)s.isOdd()&&s.iadd(l),s.iushrn(1);r.cmp(i)>=0?(r.isub(i),o.isub(s)):(i.isub(r),s.isub(o))}return 0>(t=0===r.cmpn(1)?o:s).cmpn(0)&&t.iadd(e),t},a.prototype.gcd=function(e){if(this.isZero())return e.abs();if(e.isZero())return this.abs();var t=this.clone(),r=e.clone();t.negative=0,r.negative=0;for(var n=0;t.isEven()&&r.isEven();n++)t.iushrn(1),r.iushrn(1);for(;;){for(;t.isEven();)t.iushrn(1);for(;r.isEven();)r.iushrn(1);var i=t.cmp(r);if(i<0){var a=t;t=r,r=a}else if(0===i||0===r.cmpn(1))break;t.isub(r)}return r.iushln(n)},a.prototype.invm=function(e){return this.egcd(e).a.umod(e)},a.prototype.isEven=function(){return(1&this.words[0])==0},a.prototype.isOdd=function(){return(1&this.words[0])==1},a.prototype.andln=function(e){return this.words[0]&e},a.prototype.bincn=function(e){n("number"==typeof e);var t=e%26,r=(e-t)/26,i=1<<t;if(this.length<=r)return this._expand(r+1),this.words[r]|=i,this;for(var a=i,o=r;0!==a&&o<this.length;o++){var s=0|this.words[o];s+=a,a=s>>>26,s&=0x3ffffff,this.words[o]=s}return 0!==a&&(this.words[o]=a,this.length++),this},a.prototype.isZero=function(){return 1===this.length&&0===this.words[0]},a.prototype.cmpn=function(e){var t,r=e<0;if(0!==this.negative&&!r)return -1;if(0===this.negative&&r)return 1;if(this._strip(),this.length>1)t=1;else{r&&(e=-e),n(e<=0x3ffffff,"Number is too big");var i=0|this.words[0];t=i===e?0:i<e?-1:1}return 0!==this.negative?0|-t:t},a.prototype.cmp=function(e){if(0!==this.negative&&0===e.negative)return -1;if(0===this.negative&&0!==e.negative)return 1;var t=this.ucmp(e);return 0!==this.negative?0|-t:t},a.prototype.ucmp=function(e){if(this.length>e.length)return 1;if(this.length<e.length)return -1;for(var t=0,r=this.length-1;r>=0;r--){var n=0|this.words[r],i=0|e.words[r];if(n!==i){n<i?t=-1:n>i&&(t=1);break}}return t},a.prototype.gtn=function(e){return 1===this.cmpn(e)},a.prototype.gt=function(e){return 1===this.cmp(e)},a.prototype.gten=function(e){return this.cmpn(e)>=0},a.prototype.gte=function(e){return this.cmp(e)>=0},a.prototype.ltn=function(e){return -1===this.cmpn(e)},a.prototype.lt=function(e){return -1===this.cmp(e)},a.prototype.lten=function(e){return 0>=this.cmpn(e)},a.prototype.lte=function(e){return 0>=this.cmp(e)},a.prototype.eqn=function(e){return 0===this.cmpn(e)},a.prototype.eq=function(e){return 0===this.cmp(e)},a.red=function(e){return new N(e)},a.prototype.toRed=function(e){return n(!this.red,"Already a number in reduction context"),n(0===this.negative,"red works only with positives"),e.convertTo(this)._forceRed(e)},a.prototype.fromRed=function(){return n(this.red,"fromRed works only with numbers in reduction context"),this.red.convertFrom(this)},a.prototype._forceRed=function(e){return this.red=e,this},a.prototype.forceRed=function(e){return n(!this.red,"Already a number in reduction context"),this._forceRed(e)},a.prototype.redAdd=function(e){return n(this.red,"redAdd works only with red numbers"),this.red.add(this,e)},a.prototype.redIAdd=function(e){return n(this.red,"redIAdd works only with red numbers"),this.red.iadd(this,e)},a.prototype.redSub=function(e){return n(this.red,"redSub works only with red numbers"),this.red.sub(this,e)},a.prototype.redISub=function(e){return n(this.red,"redISub works only with red numbers"),this.red.isub(this,e)},a.prototype.redShl=function(e){return n(this.red,"redShl works only with red numbers"),this.red.shl(this,e)},a.prototype.redMul=function(e){return n(this.red,"redMul works only with red numbers"),this.red._verify2(this,e),this.red.mul(this,e)},a.prototype.redIMul=function(e){return n(this.red,"redMul works only with red numbers"),this.red._verify2(this,e),this.red.imul(this,e)},a.prototype.redSqr=function(){return n(this.red,"redSqr works only with red numbers"),this.red._verify1(this),this.red.sqr(this)},a.prototype.redISqr=function(){return n(this.red,"redISqr works only with red numbers"),this.red._verify1(this),this.red.isqr(this)},a.prototype.redSqrt=function(){return n(this.red,"redSqrt works only with red numbers"),this.red._verify1(this),this.red.sqrt(this)},a.prototype.redInvm=function(){return n(this.red,"redInvm works only with red numbers"),this.red._verify1(this),this.red.invm(this)},a.prototype.redNeg=function(){return n(this.red,"redNeg works only with red numbers"),this.red._verify1(this),this.red.neg(this)},a.prototype.redPow=function(e){return n(this.red&&!e.red,"redPow(normalNum)"),this.red._verify1(this),this.red.pow(this,e)};var w={k256:null,p224:null,p192:null,p25519:null};function S(e,t){this.name=e,this.p=new a(t,16),this.n=this.p.bitLength(),this.k=new a(1).iushln(this.n).isub(this.p),this.tmp=this._tmp()}function k(){S.call(this,"k256","ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f")}function _(){S.call(this,"p224","ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001")}function E(){S.call(this,"p192","ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff")}function M(){S.call(this,"25519","7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed")}function N(e){if("string"==typeof e){var t=a._prime(e);this.m=t.p,this.prime=t}else n(e.gtn(1),"modulus must be greater than 1"),this.m=e,this.prime=null}function A(e){N.call(this,e),this.shift=this.m.bitLength(),this.shift%26!=0&&(this.shift+=26-this.shift%26),this.r=new a(1).iushln(this.shift),this.r2=this.imod(this.r.sqr()),this.rinv=this.r._invmp(this.m),this.minv=this.rinv.mul(this.r).isubn(1).div(this.m),this.minv=this.minv.umod(this.r),this.minv=this.r.sub(this.minv)}S.prototype._tmp=function(){var e=new a(null);return e.words=Array(Math.ceil(this.n/13)),e},S.prototype.ireduce=function(e){var t,r=e;do this.split(r,this.tmp),t=(r=(r=this.imulK(r)).iadd(this.tmp)).bitLength();while(t>this.n)var n=t<this.n?-1:r.ucmp(this.p);return 0===n?(r.words[0]=0,r.length=1):n>0?r.isub(this.p):void 0!==r.strip?r.strip():r._strip(),r},S.prototype.split=function(e,t){e.iushrn(this.n,0,t)},S.prototype.imulK=function(e){return e.imul(this.k)},i(k,S),k.prototype.split=function(e,t){for(var r=4194303,n=Math.min(e.length,9),i=0;i<n;i++)t.words[i]=e.words[i];if(t.length=n,e.length<=9){e.words[0]=0,e.length=1;return}var a=e.words[9];for(i=10,t.words[t.length++]=a&r;i<e.length;i++){var o=0|e.words[i];e.words[i-10]=(o&r)<<4|a>>>22,a=o}a>>>=22,e.words[i-10]=a,0===a&&e.length>10?e.length-=10:e.length-=9},k.prototype.imulK=function(e){e.words[e.length]=0,e.words[e.length+1]=0,e.length+=2;for(var t=0,r=0;r<e.length;r++){var n=0|e.words[r];t+=977*n,e.words[r]=0x3ffffff&t,t=64*n+(t/0x4000000|0)}return 0===e.words[e.length-1]&&(e.length--,0===e.words[e.length-1]&&e.length--),e},i(_,S),i(E,S),i(M,S),M.prototype.imulK=function(e){for(var t=0,r=0;r<e.length;r++){var n=(0|e.words[r])*19+t,i=0x3ffffff&n;n>>>=26,e.words[r]=i,t=n}return 0!==t&&(e.words[e.length++]=t),e},a._prime=function(e){var t;if(w[e])return w[e];if("k256"===e)t=new k;else if("p224"===e)t=new _;else if("p192"===e)t=new E;else if("p25519"===e)t=new M;else throw Error("Unknown prime "+e);return w[e]=t,t},N.prototype._verify1=function(e){n(0===e.negative,"red works only with positives"),n(e.red,"red works only with red numbers")},N.prototype._verify2=function(e,t){n((e.negative|t.negative)==0,"red works only with positives"),n(e.red&&e.red===t.red,"red works only with red numbers")},N.prototype.imod=function(e){return this.prime?this.prime.ireduce(e)._forceRed(this):(l(e,e.umod(this.m)._forceRed(this)),e)},N.prototype.neg=function(e){return e.isZero()?e.clone():this.m.sub(e)._forceRed(this)},N.prototype.add=function(e,t){this._verify2(e,t);var r=e.add(t);return r.cmp(this.m)>=0&&r.isub(this.m),r._forceRed(this)},N.prototype.iadd=function(e,t){this._verify2(e,t);var r=e.iadd(t);return r.cmp(this.m)>=0&&r.isub(this.m),r},N.prototype.sub=function(e,t){this._verify2(e,t);var r=e.sub(t);return 0>r.cmpn(0)&&r.iadd(this.m),r._forceRed(this)},N.prototype.isub=function(e,t){this._verify2(e,t);var r=e.isub(t);return 0>r.cmpn(0)&&r.iadd(this.m),r},N.prototype.shl=function(e,t){return this._verify1(e),this.imod(e.ushln(t))},N.prototype.imul=function(e,t){return this._verify2(e,t),this.imod(e.imul(t))},N.prototype.mul=function(e,t){return this._verify2(e,t),this.imod(e.mul(t))},N.prototype.isqr=function(e){return this.imul(e,e.clone())},N.prototype.sqr=function(e){return this.mul(e,e)},N.prototype.sqrt=function(e){if(e.isZero())return e.clone();var t=this.m.andln(3);if(n(t%2==1),3===t){var r=this.m.add(new a(1)).iushrn(2);return this.pow(e,r)}for(var i=this.m.subn(1),o=0;!i.isZero()&&0===i.andln(1);)o++,i.iushrn(1);n(!i.isZero());var s=new a(1).toRed(this),l=s.redNeg(),c=this.m.subn(1).iushrn(1),f=this.m.bitLength();for(f=new a(2*f*f).toRed(this);0!==this.pow(f,c).cmp(l);)f.redIAdd(l);for(var u=this.pow(f,i),d=this.pow(e,i.addn(1).iushrn(1)),h=this.pow(e,i),p=o;0!==h.cmp(s);){for(var b=h,m=0;0!==b.cmp(s);m++)b=b.redSqr();n(m<p);var g=this.pow(u,new a(1).iushln(p-m-1));d=d.redMul(g),u=g.redSqr(),h=h.redMul(u),p=m}return d},N.prototype.invm=function(e){var t=e._invmp(this.m);return 0!==t.negative?(t.negative=0,this.imod(t).redNeg()):this.imod(t)},N.prototype.pow=function(e,t){if(t.isZero())return new a(1).toRed(this);if(0===t.cmpn(1))return e.clone();var r=4,n=Array(16);n[0]=new a(1).toRed(this),n[1]=e;for(var i=2;i<n.length;i++)n[i]=this.mul(n[i-1],e);var o=n[0],s=0,l=0,c=t.bitLength()%26;for(0===c&&(c=26),i=t.length-1;i>=0;i--){for(var f=t.words[i],u=c-1;u>=0;u--){var d=f>>u&1;if(o!==n[0]&&(o=this.sqr(o)),0===d&&0===s){l=0;continue}s<<=1,s|=d,(++l===r||0===i&&0===u)&&(o=this.mul(o,n[s]),l=0,s=0)}c=26}return o},N.prototype.convertTo=function(e){var t=e.umod(this.m);return t===e?t.clone():t},N.prototype.convertFrom=function(e){var t=e.clone();return t.red=null,t},a.mont=function(e){return new A(e)},i(A,N),A.prototype.convertTo=function(e){return this.imod(e.ushln(this.shift))},A.prototype.convertFrom=function(e){var t=this.imod(e.mul(this.rinv));return t.red=null,t},A.prototype.imul=function(e,t){if(e.isZero()||t.isZero())return e.words[0]=0,e.length=1,e;var r=e.imul(t),n=r.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),i=r.isub(n).iushrn(this.shift),a=i;return i.cmp(this.m)>=0?a=i.isub(this.m):0>i.cmpn(0)&&(a=i.iadd(this.m)),a._forceRed(this)},A.prototype.mul=function(e,t){if(e.isZero()||t.isZero())return new a(0)._forceRed(this);var r=e.mul(t),n=r.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),i=r.isub(n).iushrn(this.shift),o=i;return i.cmp(this.m)>=0?o=i.isub(this.m):0>i.cmpn(0)&&(o=i.iadd(this.m)),o._forceRed(this)},A.prototype.invm=function(e){return this.imod(e._invmp(this.m).mul(this.r2))._forceRed(this)}}(e=r.nmd(e),this)},3500:function(e,t,r){var n;function i(e){this.rand=e}if(e.exports=function(e){return n||(n=new i(null)),n.generate(e)},e.exports.Rand=i,i.prototype.generate=function(e){return this._rand(e)},i.prototype._rand=function(e){if(this.rand.getBytes)return this.rand.getBytes(e);for(var t=new Uint8Array(e),r=0;r<t.length;r++)t[r]=this.rand.getByte();return t},"object"==typeof self)self.crypto&&self.crypto.getRandomValues?i.prototype._rand=function(e){var t=new Uint8Array(e);return self.crypto.getRandomValues(t),t}:self.msCrypto&&self.msCrypto.getRandomValues?i.prototype._rand=function(e){var t=new Uint8Array(e);return self.msCrypto.getRandomValues(t),t}:"object"==typeof window&&(i.prototype._rand=function(){throw Error("Not implemented yet")});else try{var a=r(6113);if("function"!=typeof a.randomBytes)throw Error("Not supported");i.prototype._rand=function(e){return a.randomBytes(e)}}catch(e){}},1387:function(e,t,r){var n=r(6911).Buffer;function i(e){n.isBuffer(e)||(e=n.from(e));for(var t=e.length/4|0,r=Array(t),i=0;i<t;i++)r[i]=e.readUInt32BE(4*i);return r}function a(e){for(var t=0;t<e.length;e++)e[t]=0}function o(e,t,r,n,i){for(var a,o,s,l,c=r[0],f=r[1],u=r[2],d=r[3],h=e[0]^t[0],p=e[1]^t[1],b=e[2]^t[2],m=e[3]^t[3],g=4,y=1;y<i;y++)a=c[h>>>24]^f[p>>>16&255]^u[b>>>8&255]^d[255&m]^t[g++],o=c[p>>>24]^f[b>>>16&255]^u[m>>>8&255]^d[255&h]^t[g++],s=c[b>>>24]^f[m>>>16&255]^u[h>>>8&255]^d[255&p]^t[g++],l=c[m>>>24]^f[h>>>16&255]^u[p>>>8&255]^d[255&b]^t[g++],h=a,p=o,b=s,m=l;return a=(n[h>>>24]<<24|n[p>>>16&255]<<16|n[b>>>8&255]<<8|n[255&m])^t[g++],o=(n[p>>>24]<<24|n[b>>>16&255]<<16|n[m>>>8&255]<<8|n[255&h])^t[g++],s=(n[b>>>24]<<24|n[m>>>16&255]<<16|n[h>>>8&255]<<8|n[255&p])^t[g++],[a>>>=0,o>>>=0,s>>>=0,l=((n[m>>>24]<<24|n[h>>>16&255]<<16|n[p>>>8&255]<<8|n[255&b])^t[g++])>>>0]}var s=[0,1,2,4,8,16,32,64,128,27,54],l=function(){for(var e=Array(256),t=0;t<256;t++)t<128?e[t]=t<<1:e[t]=t<<1^283;for(var r=[],n=[],i=[[],[],[],[]],a=[[],[],[],[]],o=0,s=0,l=0;l<256;++l){var c=s^s<<1^s<<2^s<<3^s<<4;c=c>>>8^255&c^99,r[o]=c,n[c]=o;var f=e[o],u=e[f],d=e[u],h=257*e[c]^0x1010100*c;i[0][o]=h<<24|h>>>8,i[1][o]=h<<16|h>>>16,i[2][o]=h<<8|h>>>24,i[3][o]=h,h=0x1010101*d^65537*u^257*f^0x1010100*o,a[0][c]=h<<24|h>>>8,a[1][c]=h<<16|h>>>16,a[2][c]=h<<8|h>>>24,a[3][c]=h,0===o?o=s=1:(o=f^e[e[e[d^f]]],s^=e[e[s]])}return{SBOX:r,INV_SBOX:n,SUB_MIX:i,INV_SUB_MIX:a}}();function c(e){this._key=i(e),this._reset()}c.blockSize=16,c.keySize=32,c.prototype.blockSize=c.blockSize,c.prototype.keySize=c.keySize,c.prototype._reset=function(){for(var e=this._key,t=e.length,r=t+6,n=(r+1)*4,i=[],a=0;a<t;a++)i[a]=e[a];for(a=t;a<n;a++){var o=i[a-1];a%t==0?(o=o<<8|o>>>24,o=(l.SBOX[o>>>24]<<24|l.SBOX[o>>>16&255]<<16|l.SBOX[o>>>8&255]<<8|l.SBOX[255&o])^s[a/t|0]<<24):t>6&&a%t==4&&(o=l.SBOX[o>>>24]<<24|l.SBOX[o>>>16&255]<<16|l.SBOX[o>>>8&255]<<8|l.SBOX[255&o]),i[a]=i[a-t]^o}for(var c=[],f=0;f<n;f++){var u=n-f,d=i[u-(f%4?0:4)];f<4||u<=4?c[f]=d:c[f]=l.INV_SUB_MIX[0][l.SBOX[d>>>24]]^l.INV_SUB_MIX[1][l.SBOX[d>>>16&255]]^l.INV_SUB_MIX[2][l.SBOX[d>>>8&255]]^l.INV_SUB_MIX[3][l.SBOX[255&d]]}this._nRounds=r,this._keySchedule=i,this._invKeySchedule=c},c.prototype.encryptBlockRaw=function(e){return o(e=i(e),this._keySchedule,l.SUB_MIX,l.SBOX,this._nRounds)},c.prototype.encryptBlock=function(e){var t=this.encryptBlockRaw(e),r=n.allocUnsafe(16);return r.writeUInt32BE(t[0],0),r.writeUInt32BE(t[1],4),r.writeUInt32BE(t[2],8),r.writeUInt32BE(t[3],12),r},c.prototype.decryptBlock=function(e){var t=(e=i(e))[1];e[1]=e[3],e[3]=t;var r=o(e,this._invKeySchedule,l.INV_SUB_MIX,l.INV_SBOX,this._nRounds),a=n.allocUnsafe(16);return a.writeUInt32BE(r[0],0),a.writeUInt32BE(r[3],4),a.writeUInt32BE(r[2],8),a.writeUInt32BE(r[1],12),a},c.prototype.scrub=function(){a(this._keySchedule),a(this._invKeySchedule),a(this._key)},e.exports.AES=c},6624:function(e,t,r){var n=r(1387),i=r(6911).Buffer,a=r(1043),o=r(3782),s=r(7225),l=r(4734),c=r(598);function f(e,t){var r=0;e.length!==t.length&&r++;for(var n=Math.min(e.length,t.length),i=0;i<n;++i)r+=e[i]^t[i];return r}function u(e,t,r){if(12===t.length)return e._finID=i.concat([t,i.from([0,0,0,1])]),i.concat([t,i.from([0,0,0,2])]);var n=new s(r),a=t.length,o=a%16;n.update(t),o&&(o=16-o,n.update(i.alloc(o,0))),n.update(i.alloc(8,0));var l=8*a,f=i.alloc(8);f.writeUIntBE(l,0,8),n.update(f),e._finID=n.state;var u=i.from(e._finID);return c(u),u}function d(e,t,r,o){a.call(this);var l=i.alloc(4,0);this._cipher=new n.AES(t);var c=this._cipher.encryptBlock(l);this._ghash=new s(c),r=u(this,r,c),this._prev=i.from(r),this._cache=i.allocUnsafe(0),this._secCache=i.allocUnsafe(0),this._decrypt=o,this._alen=0,this._len=0,this._mode=e,this._authTag=null,this._called=!1}o(d,a),d.prototype._update=function(e){if(!this._called&&this._alen){var t=16-this._alen%16;t<16&&(t=i.alloc(t,0),this._ghash.update(t))}this._called=!0;var r=this._mode.encrypt(this,e);return this._decrypt?this._ghash.update(e):this._ghash.update(r),this._len+=e.length,r},d.prototype._final=function(){if(this._decrypt&&!this._authTag)throw Error("Unsupported state or unable to authenticate data");var e=l(this._ghash.final(8*this._alen,8*this._len),this._cipher.encryptBlock(this._finID));if(this._decrypt&&f(e,this._authTag))throw Error("Unsupported state or unable to authenticate data");this._authTag=e,this._cipher.scrub()},d.prototype.getAuthTag=function(){if(this._decrypt||!i.isBuffer(this._authTag))throw Error("Attempting to get auth tag in unsupported state");return this._authTag},d.prototype.setAuthTag=function(e){if(!this._decrypt)throw Error("Attempting to set auth tag in unsupported state");this._authTag=e},d.prototype.setAAD=function(e){if(this._called)throw Error("Attempting to set AAD in unsupported state");this._ghash.update(e),this._alen+=e.length},e.exports=d},6594:function(e,t,r){var n=r(2),i=r(2598),a=r(5866);function o(){return Object.keys(a)}t.createCipher=t.Cipher=n.createCipher,t.createCipheriv=t.Cipheriv=n.createCipheriv,t.createDecipher=t.Decipher=i.createDecipher,t.createDecipheriv=t.Decipheriv=i.createDecipheriv,t.listCiphers=t.getCiphers=o},2598:function(e,t,r){var n=r(6624),i=r(6911).Buffer,a=r(6370),o=r(126),s=r(1043),l=r(1387),c=r(8368);function f(e,t,r){s.call(this),this._cache=new u,this._last=void 0,this._cipher=new l.AES(t),this._prev=i.from(r),this._mode=e,this._autopadding=!0}function u(){this.cache=i.allocUnsafe(0)}function d(e){var t=e[15];if(t<1||t>16)throw Error("unable to decrypt data");for(var r=-1;++r<t;)if(e[r+(16-t)]!==t)throw Error("unable to decrypt data");if(16!==t)return e.slice(0,16-t)}function h(e,t,r){var s=a[e.toLowerCase()];if(!s)throw TypeError("invalid suite type");if("string"==typeof r&&(r=i.from(r)),"GCM"!==s.mode&&r.length!==s.iv)throw TypeError("invalid iv length "+r.length);if("string"==typeof t&&(t=i.from(t)),t.length!==s.key/8)throw TypeError("invalid key length "+t.length);return"stream"===s.type?new o(s.module,t,r,!0):"auth"===s.type?new n(s.module,t,r,!0):new f(s.module,t,r)}r(3782)(f,s),f.prototype._update=function(e){this._cache.add(e);for(var t,r,n=[];t=this._cache.get(this._autopadding);)r=this._mode.decrypt(this,t),n.push(r);return i.concat(n)},f.prototype._final=function(){var e=this._cache.flush();if(this._autopadding)return d(this._mode.decrypt(this,e));if(e)throw Error("data not multiple of block length")},f.prototype.setAutoPadding=function(e){return this._autopadding=!!e,this},u.prototype.add=function(e){this.cache=i.concat([this.cache,e])},u.prototype.get=function(e){var t;if(e){if(this.cache.length>16)return t=this.cache.slice(0,16),this.cache=this.cache.slice(16),t}else if(this.cache.length>=16)return t=this.cache.slice(0,16),this.cache=this.cache.slice(16),t;return null},u.prototype.flush=function(){if(this.cache.length)return this.cache},t.createDecipher=function(e,t){var r=a[e.toLowerCase()];if(!r)throw TypeError("invalid suite type");var n=c(t,!1,r.key,r.iv);return h(e,n.key,n.iv)},t.createDecipheriv=h},2:function(e,t,r){var n=r(6370),i=r(6624),a=r(6911).Buffer,o=r(126),s=r(1043),l=r(1387),c=r(8368);function f(e,t,r){s.call(this),this._cache=new d,this._cipher=new l.AES(t),this._prev=a.from(r),this._mode=e,this._autopadding=!0}r(3782)(f,s),f.prototype._update=function(e){this._cache.add(e);for(var t,r,n=[];t=this._cache.get();)r=this._mode.encrypt(this,t),n.push(r);return a.concat(n)};var u=a.alloc(16,16);function d(){this.cache=a.allocUnsafe(0)}function h(e,t,r){var s=n[e.toLowerCase()];if(!s)throw TypeError("invalid suite type");if("string"==typeof t&&(t=a.from(t)),t.length!==s.key/8)throw TypeError("invalid key length "+t.length);if("string"==typeof r&&(r=a.from(r)),"GCM"!==s.mode&&r.length!==s.iv)throw TypeError("invalid iv length "+r.length);return"stream"===s.type?new o(s.module,t,r):"auth"===s.type?new i(s.module,t,r):new f(s.module,t,r)}function p(e,t){var r=n[e.toLowerCase()];if(!r)throw TypeError("invalid suite type");var i=c(t,!1,r.key,r.iv);return h(e,i.key,i.iv)}f.prototype._final=function(){var e=this._cache.flush();if(this._autopadding)return e=this._mode.encrypt(this,e),this._cipher.scrub(),e;if(!e.equals(u))throw this._cipher.scrub(),Error("data not multiple of block length")},f.prototype.setAutoPadding=function(e){return this._autopadding=!!e,this},d.prototype.add=function(e){this.cache=a.concat([this.cache,e])},d.prototype.get=function(){if(this.cache.length>15){var e=this.cache.slice(0,16);return this.cache=this.cache.slice(16),e}return null},d.prototype.flush=function(){for(var e=16-this.cache.length,t=a.allocUnsafe(e),r=-1;++r<e;)t.writeUInt8(e,r);return a.concat([this.cache,t])},t.createCipheriv=h,t.createCipher=p},7225:function(e,t,r){var n=r(6911).Buffer,i=n.alloc(16,0);function a(e){return[e.readUInt32BE(0),e.readUInt32BE(4),e.readUInt32BE(8),e.readUInt32BE(12)]}function o(e){var t=n.allocUnsafe(16);return t.writeUInt32BE(e[0]>>>0,0),t.writeUInt32BE(e[1]>>>0,4),t.writeUInt32BE(e[2]>>>0,8),t.writeUInt32BE(e[3]>>>0,12),t}function s(e){this.h=e,this.state=n.alloc(16,0),this.cache=n.allocUnsafe(0)}s.prototype.ghash=function(e){for(var t=-1;++t<e.length;)this.state[t]^=e[t];this._multiply()},s.prototype._multiply=function(){for(var e,t,r=a(this.h),n=[0,0,0,0],i=-1;++i<128;){for((this.state[~~(i/8)]&1<<7-i%8)!=0&&(n[0]^=r[0],n[1]^=r[1],n[2]^=r[2],n[3]^=r[3]),t=(1&r[3])!=0,e=3;e>0;e--)r[e]=r[e]>>>1|(1&r[e-1])<<31;r[0]=r[0]>>>1,t&&(r[0]=-0x1f000000^r[0])}this.state=o(n)},s.prototype.update=function(e){var t;for(this.cache=n.concat([this.cache,e]);this.cache.length>=16;)t=this.cache.slice(0,16),this.cache=this.cache.slice(16),this.ghash(t)},s.prototype.final=function(e,t){return this.cache.length&&this.ghash(n.concat([this.cache,i],16)),this.ghash(o([0,e,0,t])),this.state},e.exports=s},598:function(e){e.exports=function(e){for(var t,r=e.length;r--;)if(255===(t=e.readUInt8(r)))e.writeUInt8(0,r);else{t++,e.writeUInt8(t,r);break}}},9825:function(e,t,r){var n=r(4734);t.encrypt=function(e,t){var r=n(t,e._prev);return e._prev=e._cipher.encryptBlock(r),e._prev},t.decrypt=function(e,t){var r=e._prev;return e._prev=t,n(e._cipher.decryptBlock(t),r)}},321:function(e,t,r){var n=r(6911).Buffer,i=r(4734);function a(e,t,r){var a=t.length,o=i(t,e._cache);return e._cache=e._cache.slice(a),e._prev=n.concat([e._prev,r?t:o]),o}t.encrypt=function(e,t,r){for(var i,o=n.allocUnsafe(0);t.length;)if(0===e._cache.length&&(e._cache=e._cipher.encryptBlock(e._prev),e._prev=n.allocUnsafe(0)),e._cache.length<=t.length)i=e._cache.length,o=n.concat([o,a(e,t.slice(0,i),r)]),t=t.slice(i);else{o=n.concat([o,a(e,t,r)]);break}return o}},3147:function(e,t,r){var n=r(6911).Buffer;function i(e,t,r){for(var n,i,o,s=-1,l=8,c=0;++s<l;)n=e._cipher.encryptBlock(e._prev),i=t&1<<7-s?128:0,c+=(128&(o=n[0]^i))>>s%8,e._prev=a(e._prev,r?i:o);return c}function a(e,t){var r=e.length,i=-1,a=n.allocUnsafe(e.length);for(e=n.concat([e,n.from([t])]);++i<r;)a[i]=e[i]<<1|e[i+1]>>7;return a}t.encrypt=function(e,t,r){for(var a=t.length,o=n.allocUnsafe(a),s=-1;++s<a;)o[s]=i(e,t[s],r);return o}},2430:function(e,t,r){var n=r(6911).Buffer;function i(e,t,r){var i=e._cipher.encryptBlock(e._prev)[0]^t;return e._prev=n.concat([e._prev.slice(1),n.from([r?t:i])]),i}t.encrypt=function(e,t,r){for(var a=t.length,o=n.allocUnsafe(a),s=-1;++s<a;)o[s]=i(e,t[s],r);return o}},3361:function(e,t,r){var n=r(4734),i=r(6911).Buffer,a=r(598);function o(e){var t=e._cipher.encryptBlockRaw(e._prev);return a(e._prev),t}var s=16;t.encrypt=function(e,t){var r=Math.ceil(t.length/s),a=e._cache.length;e._cache=i.concat([e._cache,i.allocUnsafe(r*s)]);for(var l=0;l<r;l++){var c=o(e),f=a+l*s;e._cache.writeUInt32BE(c[0],f+0),e._cache.writeUInt32BE(c[1],f+4),e._cache.writeUInt32BE(c[2],f+8),e._cache.writeUInt32BE(c[3],f+12)}var u=e._cache.slice(0,t.length);return e._cache=e._cache.slice(t.length),n(t,u)}},1590:function(e,t){t.encrypt=function(e,t){return e._cipher.encryptBlock(t)},t.decrypt=function(e,t){return e._cipher.decryptBlock(t)}},6370:function(e,t,r){var n={ECB:r(1590),CBC:r(9825),CFB:r(321),CFB8:r(2430),CFB1:r(3147),OFB:r(3412),CTR:r(3361),GCM:r(3361)},i=r(5866);for(var a in i)i[a].module=n[i[a].mode];e.exports=i},3412:function(e,t,r){var i=r(4734);function a(e){return e._prev=e._cipher.encryptBlock(e._prev),e._prev}t.encrypt=function(e,t){for(;e._cache.length<t.length;)e._cache=n.Buffer.concat([e._cache,a(e)]);var r=e._cache.slice(0,t.length);return e._cache=e._cache.slice(t.length),i(t,r)}},126:function(e,t,r){var n=r(1387),i=r(6911).Buffer,a=r(1043);function o(e,t,r,o){a.call(this),this._cipher=new n.AES(t),this._prev=i.from(r),this._cache=i.allocUnsafe(0),this._secCache=i.allocUnsafe(0),this._decrypt=o,this._mode=e}r(3782)(o,a),o.prototype._update=function(e){return this._mode.encrypt(this,e,this._decrypt)},o.prototype._final=function(){this._cipher.scrub()},e.exports=o},8996:function(e,t,r){var n=r(5238),i=r(6594),a=r(6370),o=r(6280),s=r(8368);function l(e,t){if(a[e=e.toLowerCase()])r=a[e].key,n=a[e].iv;else if(o[e])r=8*o[e].key,n=o[e].iv;else throw TypeError("invalid suite type");var r,n,i=s(t,!1,r,n);return f(e,i.key,i.iv)}function c(e,t,r){if(a[e=e.toLowerCase()])return i.createCipheriv(e,t,r);if(o[e])return new n({key:t,iv:r,mode:e});throw TypeError("invalid suite type")}function f(e,t,r){if(a[e=e.toLowerCase()])return i.createDecipheriv(e,t,r);if(o[e])return new n({key:t,iv:r,mode:e,decrypt:!0});throw TypeError("invalid suite type")}function u(){return Object.keys(o).concat(i.getCiphers())}t.createCipher=t.Cipher=function(e,t){if(a[e=e.toLowerCase()])r=a[e].key,n=a[e].iv;else if(o[e])r=8*o[e].key,n=o[e].iv;else throw TypeError("invalid suite type");var r,n,i=s(t,!1,r,n);return c(e,i.key,i.iv)},t.createCipheriv=t.Cipheriv=c,t.createDecipher=t.Decipher=l,t.createDecipheriv=t.Decipheriv=f,t.listCiphers=t.getCiphers=u},5238:function(e,t,r){var n=r(1043),i=r(9536),a=r(3782),o=r(6911).Buffer,s={"des-ede3-cbc":i.CBC.instantiate(i.EDE),"des-ede3":i.EDE,"des-ede-cbc":i.CBC.instantiate(i.EDE),"des-ede":i.EDE,"des-cbc":i.CBC.instantiate(i.DES),"des-ecb":i.DES};function l(e){n.call(this);var t,r=e.mode.toLowerCase(),i=s[r];t=e.decrypt?"decrypt":"encrypt";var a=e.key;o.isBuffer(a)||(a=o.from(a)),("des-ede"===r||"des-ede-cbc"===r)&&(a=o.concat([a,a.slice(0,8)]));var l=e.iv;o.isBuffer(l)||(l=o.from(l)),this._des=i.create({key:a,iv:l,type:t})}s.des=s["des-cbc"],s.des3=s["des-ede3-cbc"],e.exports=l,a(l,n),l.prototype._update=function(e){return o.from(this._des.update(e))},l.prototype._final=function(){return o.from(this._des.final())}},6280:function(e,t){t["des-ecb"]={key:8,iv:0},t["des-cbc"]=t.des={key:8,iv:8},t["des-ede3-cbc"]=t.des3={key:24,iv:8},t["des-ede3"]={key:24,iv:0},t["des-ede-cbc"]={key:16,iv:8},t["des-ede"]={key:16,iv:0}},7166:function(e,t,r){var i=r(711),a=r(7223);function o(e){var t=l(e);return{blinder:t.toRed(i.mont(e.modulus)).redPow(new i(e.publicExponent)).fromRed(),unblinder:t.invm(e.modulus)}}function s(e,t){var r=o(t),a=t.modulus.byteLength();i.mont(t.modulus);var s=new i(e).mul(r.blinder).umod(t.modulus),l=s.toRed(i.mont(t.prime1)),c=s.toRed(i.mont(t.prime2)),f=t.coefficient,u=t.prime1,d=t.prime2,h=l.redPow(t.exponent1),p=c.redPow(t.exponent2);h=h.fromRed(),p=p.fromRed();var b=h.isub(p).imul(f).umod(u);return b.imul(d),p.iadd(b),new n.Buffer(p.imul(r.unblinder).umod(t.modulus).toArray(!1,a))}function l(e){for(var t=e.modulus.byteLength(),r=new i(a(t));r.cmp(e.modulus)>=0||!r.umod(e.prime1)||!r.umod(e.prime2);)r=new i(a(t));return r}e.exports=s,s.getr=l},9276:function(e,t,r){e.exports=r(2908)},4078:function(e,t,r){var n=r(6911).Buffer,i=r(9739),a=r(3726),o=r(3782),s=r(9807),l=r(4013),c=r(2908);function f(e){a.Writable.call(this);var t=c[e];if(!t)throw Error("Unknown message digest");this._hashType=t.hash,this._hash=i(t.hash),this._tag=t.id,this._signType=t.sign}function u(e){a.Writable.call(this);var t=c[e];if(!t)throw Error("Unknown message digest");this._hash=i(t.hash),this._tag=t.id,this._signType=t.sign}function d(e){return new f(e)}function h(e){return new u(e)}Object.keys(c).forEach(function(e){c[e].id=n.from(c[e].id,"hex"),c[e.toLowerCase()]=c[e]}),o(f,a.Writable),f.prototype._write=function(e,t,r){this._hash.update(e),r()},f.prototype.update=function(e,t){return"string"==typeof e&&(e=n.from(e,t)),this._hash.update(e),this},f.prototype.sign=function(e,t){this.end();var r=s(this._hash.digest(),e,this._hashType,this._signType,this._tag);return t?r.toString(t):r},o(u,a.Writable),u.prototype._write=function(e,t,r){this._hash.update(e),r()},u.prototype.update=function(e,t){return"string"==typeof e&&(e=n.from(e,t)),this._hash.update(e),this},u.prototype.verify=function(e,t,r){return"string"==typeof t&&(t=n.from(t,r)),this.end(),l(t,this._hash.digest(),e,this._signType,this._tag)},e.exports={Sign:d,Verify:h,createSign:d,createVerify:h}},9807:function(e,t,r){var n=r(6911).Buffer,i=r(4873),a=r(7166),o=r(949).ec,s=r(1670),l=r(9902),c=r(9267);function f(e,t){var r=c[t.curve.join(".")];if(!r)throw Error("unknown curve "+t.curve.join("."));var i=new o(r).keyFromPrivate(t.privateKey).sign(e);return n.from(i.toDER())}function u(e,t,r){for(var n,i=t.params.priv_key,a=t.params.p,o=t.params.q,l=t.params.g,c=new s(0),f=p(e,o).mod(o),u=!1,b=h(i,o,e,r);!1===u;)c=g(l,n=m(o,b,r),a,o),0===(u=n.invm(o).imul(f.add(i.mul(c))).mod(o)).cmpn(0)&&(u=!1,c=new s(0));return d(c,u)}function d(e,t){e=e.toArray(),t=t.toArray(),128&e[0]&&(e=[0].concat(e)),128&t[0]&&(t=[0].concat(t));var r=[48,e.length+t.length+4,2,e.length];return r=r.concat(e,[2,t.length],t),n.from(r)}function h(e,t,r,a){if((e=n.from(e.toArray())).length<t.byteLength()){var o=n.alloc(t.byteLength()-e.length);e=n.concat([o,e])}var s=r.length,l=b(r,t),c=n.alloc(s);c.fill(1);var f=n.alloc(s);return f=i(a,f).update(c).update(n.from([0])).update(e).update(l).digest(),c=i(a,f).update(c).digest(),f=i(a,f).update(c).update(n.from([1])).update(e).update(l).digest(),c=i(a,f).update(c).digest(),{k:f,v:c}}function p(e,t){var r=new s(e),n=(e.length<<3)-t.bitLength();return n>0&&r.ishrn(n),r}function b(e,t){e=(e=p(e,t)).mod(t);var r=n.from(e.toArray());if(r.length<t.byteLength()){var i=n.alloc(t.byteLength()-r.length);r=n.concat([i,r])}return r}function m(e,t,r){var a,o;do{for(a=n.alloc(0);8*a.length<e.bitLength();)t.v=i(r,t.k).update(t.v).digest(),a=n.concat([a,t.v]);o=p(a,e),t.k=i(r,t.k).update(t.v).update(n.from([0])).digest(),t.v=i(r,t.k).update(t.v).digest()}while(-1!==o.cmp(e))return o}function g(e,t,r,n){return e.toRed(s.mont(r)).redPow(t).fromRed().mod(n)}e.exports=function(e,t,r,i,o){var s=l(t);if(s.curve){if("ecdsa"!==i&&"ecdsa/rsa"!==i)throw Error("wrong private key type");return f(e,s)}if("dsa"===s.type){if("dsa"!==i)throw Error("wrong private key type");return u(e,s,r)}if("rsa"!==i&&"ecdsa/rsa"!==i)throw Error("wrong private key type");e=n.concat([o,e]);for(var c=s.modulus.byteLength(),d=[0,1];e.length+d.length+1<c;)d.push(255);d.push(0);for(var h=-1;++h<e.length;)d.push(e[h]);return a(d,s)},e.exports.getKey=h,e.exports.makeKey=m},4013:function(e,t,r){var n=r(6911).Buffer,i=r(1670),a=r(949).ec,o=r(9902),s=r(9267);function l(e,t,r){var n=s[r.data.algorithm.curve.join(".")];if(!n)throw Error("unknown curve "+r.data.algorithm.curve.join("."));var i=new a(n),o=r.data.subjectPrivateKey.data;return i.verify(t,e,o)}function c(e,t,r){var n=r.data.p,a=r.data.q,s=r.data.g,l=r.data.pub_key,c=o.signature.decode(e,"der"),u=c.s,d=c.r;f(u,a),f(d,a);var h=i.mont(n),p=u.invm(a);return 0===s.toRed(h).redPow(new i(t).mul(p).mod(a)).fromRed().mul(l.toRed(h).redPow(d.mul(p).mod(a)).fromRed()).mod(n).mod(a).cmp(d)}function f(e,t){if(0>=e.cmpn(0)||e.cmp(t)>=t)throw Error("invalid sig")}e.exports=function(e,t,r,a,s){var f=o(r);if("ec"===f.type){if("ecdsa"!==a&&"ecdsa/rsa"!==a)throw Error("wrong public key type");return l(e,t,f)}if("dsa"===f.type){if("dsa"!==a)throw Error("wrong public key type");return c(e,t,f)}if("rsa"!==a&&"ecdsa/rsa"!==a)throw Error("wrong public key type");t=n.concat([s,t]);for(var u=f.modulus.byteLength(),d=[1],h=0;t.length+d.length+2<u;)d.push(255),h++;d.push(0);for(var p=-1;++p<t.length;)d.push(t[p]);d=n.from(d);var b=i.mont(f.modulus);e=(e=new i(e).toRed(b)).redPow(new i(f.publicExponent));var m=+(h<8);for(u=Math.min((e=n.from(e.fromRed().toArray())).length,d.length),e.length!==d.length&&(m=1),p=-1;++p<u;)m|=e[p]^d[p];return 0===m}},4734:function(e){e.exports=function(e,t){for(var r=Math.min(e.length,t.length),i=new n.Buffer(r),a=0;a<r;++a)i[a]=e[a]^t[a];return i}},1043:function(e,t,r){var n=r(6911).Buffer,i=r(2781).Transform,a=r(1576).StringDecoder;function o(e){i.call(this),this.hashMode="string"==typeof e,this.hashMode?this[e]=this._finalOrDigest:this.final=this._finalOrDigest,this._final&&(this.__final=this._final,this._final=null),this._decoder=null,this._encoding=null}r(3782)(o,i),o.prototype.update=function(e,t,r){"string"==typeof e&&(e=n.from(e,t));var i=this._update(e);return this.hashMode?this:(r&&(i=this._toString(i,r)),i)},o.prototype.setAutoPadding=function(){},o.prototype.getAuthTag=function(){throw Error("trying to get auth tag in unsupported state")},o.prototype.setAuthTag=function(){throw Error("trying to set auth tag in unsupported state")},o.prototype.setAAD=function(){throw Error("trying to set aad in unsupported state")},o.prototype._transform=function(e,t,r){var n;try{this.hashMode?this._update(e):this.push(this._update(e))}catch(e){n=e}finally{r(n)}},o.prototype._flush=function(e){var t;try{this.push(this.__final())}catch(e){t=e}e(t)},o.prototype._finalOrDigest=function(e){var t=this.__final()||n.alloc(0);return e&&(t=this._toString(t,e,!0)),t},o.prototype._toString=function(e,t,r){if(this._decoder||(this._decoder=new a(t),this._encoding=t),this._encoding!==t)throw Error("can't switch encodings");var n=this._decoder.write(e);return r&&(n+=this._decoder.end()),n},e.exports=o},9942:function(e,t,r){var i=r(949),a=r(711);e.exports=function(e){return new s(e)};var o={secp256k1:{name:"secp256k1",byteLength:32},secp224r1:{name:"p224",byteLength:28},prime256v1:{name:"p256",byteLength:32},prime192v1:{name:"p192",byteLength:24},ed25519:{name:"ed25519",byteLength:32},secp384r1:{name:"p384",byteLength:48},secp521r1:{name:"p521",byteLength:66}};function s(e){this.curveType=o[e],this.curveType||(this.curveType={name:e}),this.curve=new i.ec(this.curveType.name),this.keys=void 0}function l(e,t,r){Array.isArray(e)||(e=e.toArray());var i=new n.Buffer(e);if(r&&i.length<r){var a=new n.Buffer(r-i.length);a.fill(0),i=n.Buffer.concat([a,i])}return t?i.toString(t):i}o.p224=o.secp224r1,o.p256=o.secp256r1=o.prime256v1,o.p192=o.secp192r1=o.prime192v1,o.p384=o.secp384r1,o.p521=o.secp521r1,s.prototype.generateKeys=function(e,t){return this.keys=this.curve.genKeyPair(),this.getPublicKey(e,t)},s.prototype.computeSecret=function(e,t,r){return t=t||"utf8",n.Buffer.isBuffer(e)||(e=new n.Buffer(e,t)),l(this.curve.keyFromPublic(e).getPublic().mul(this.keys.getPrivate()).getX(),r,this.curveType.byteLength)},s.prototype.getPublicKey=function(e,t){var r=this.keys.getPublic("compressed"===t,!0);return"hybrid"===t&&(r[r.length-1]%2?r[0]=7:r[0]=6),l(r,e)},s.prototype.getPrivateKey=function(e){return l(this.keys.getPrivate(),e)},s.prototype.setPublicKey=function(e,t){return t=t||"utf8",n.Buffer.isBuffer(e)||(e=new n.Buffer(e,t)),this.keys._importPublic(e),this},s.prototype.setPrivateKey=function(e,t){t=t||"utf8",n.Buffer.isBuffer(e)||(e=new n.Buffer(e,t));var r=new a(e);return r=r.toString(16),this.keys=this.curve.genKeyPair(),this.keys._importPrivate(r),this}},9739:function(e,t,r){"use strict";var n=r(3782),i=r(3533),a=r(3225),o=r(4371),s=r(1043);function l(e){s.call(this,"digest"),this._hash=e}n(l,s),l.prototype._update=function(e){this._hash.update(e)},l.prototype._final=function(){return this._hash.digest()},e.exports=function(e){return"md5"===(e=e.toLowerCase())?new i:"rmd160"===e||"ripemd160"===e?new a:new l(o(e))}},450:function(e,t,r){var n=r(3533);e.exports=function(e){return(new n).update(e).digest()}},4873:function(e,t,r){"use strict";var n=r(3782),i=r(8119),a=r(1043),o=r(6911).Buffer,s=r(450),l=r(3225),c=r(4371),f=o.alloc(128);function u(e,t){a.call(this,"digest"),"string"==typeof t&&(t=o.from(t));var r="sha512"===e||"sha384"===e?128:64;this._alg=e,this._key=t,t.length>r?t=("rmd160"===e?new l:c(e)).update(t).digest():t.length<r&&(t=o.concat([t,f],r));for(var n=this._ipad=o.allocUnsafe(r),i=this._opad=o.allocUnsafe(r),s=0;s<r;s++)n[s]=54^t[s],i[s]=92^t[s];this._hash="rmd160"===e?new l:c(e),this._hash.update(n)}n(u,a),u.prototype._update=function(e){this._hash.update(e)},u.prototype._final=function(){var e=this._hash.digest();return("rmd160"===this._alg?new l:c(this._alg)).update(this._opad).update(e).digest()},e.exports=function(e,t){return"rmd160"===(e=e.toLowerCase())||"ripemd160"===e?new u("rmd160",t):"md5"===e?new i(s,t):new u(e,t)}},8119:function(e,t,r){"use strict";var n=r(3782),i=r(6911).Buffer,a=r(1043),o=i.alloc(128),s=64;function l(e,t){a.call(this,"digest"),"string"==typeof t&&(t=i.from(t)),this._alg=e,this._key=t,t.length>s?t=e(t):t.length<s&&(t=i.concat([t,o],s));for(var r=this._ipad=i.allocUnsafe(s),n=this._opad=i.allocUnsafe(s),l=0;l<s;l++)r[l]=54^t[l],n[l]=92^t[l];this._hash=[r]}n(l,a),l.prototype._update=function(e){this._hash.push(e)},l.prototype._final=function(){var e=this._alg(i.concat(this._hash));return this._alg(i.concat([this._opad,e]))},e.exports=l},9536:function(e,t,r){"use strict";t.utils=r(5334),t.Cipher=r(9876),t.DES=r(1016),t.CBC=r(8641),t.EDE=r(6159)},8641:function(e,t,r){"use strict";var n=r(3523),i=r(3782),a={};function o(e){n.equal(e.length,8,"Invalid IV length"),this.iv=Array(8);for(var t=0;t<this.iv.length;t++)this.iv[t]=e[t]}t.instantiate=function(e){function t(t){e.call(this,t),this._cbcInit()}i(t,e);for(var r=Object.keys(a),n=0;n<r.length;n++){var o=r[n];t.prototype[o]=a[o]}return t.create=function(e){return new t(e)},t},a._cbcInit=function(){var e=new o(this.options.iv);this._cbcState=e},a._update=function(e,t,r,n){var i=this._cbcState,a=this.constructor.super_.prototype,o=i.iv;if("encrypt"===this.type){for(var s=0;s<this.blockSize;s++)o[s]^=e[t+s];a._update.call(this,o,0,r,n);for(var s=0;s<this.blockSize;s++)o[s]=r[n+s]}else{a._update.call(this,e,t,r,n);for(var s=0;s<this.blockSize;s++)r[n+s]^=o[s];for(var s=0;s<this.blockSize;s++)o[s]=e[t+s]}}},9876:function(e,t,r){"use strict";var n=r(3523);function i(e){this.options=e,this.type=this.options.type,this.blockSize=8,this._init(),this.buffer=Array(this.blockSize),this.bufferOff=0}e.exports=i,i.prototype._init=function(){},i.prototype.update=function(e){return 0===e.length?[]:"decrypt"===this.type?this._updateDecrypt(e):this._updateEncrypt(e)},i.prototype._buffer=function(e,t){for(var r=Math.min(this.buffer.length-this.bufferOff,e.length-t),n=0;n<r;n++)this.buffer[this.bufferOff+n]=e[t+n];return this.bufferOff+=r,r},i.prototype._flushBuffer=function(e,t){return this._update(this.buffer,0,e,t),this.bufferOff=0,this.blockSize},i.prototype._updateEncrypt=function(e){var t=0,r=0,n=Array(((this.bufferOff+e.length)/this.blockSize|0)*this.blockSize);0!==this.bufferOff&&(t+=this._buffer(e,t),this.bufferOff===this.buffer.length&&(r+=this._flushBuffer(n,r)));for(var i=e.length-(e.length-t)%this.blockSize;t<i;t+=this.blockSize)this._update(e,t,n,r),r+=this.blockSize;for(;t<e.length;t++,this.bufferOff++)this.buffer[this.bufferOff]=e[t];return n},i.prototype._updateDecrypt=function(e){for(var t=0,r=0,n=Math.ceil((this.bufferOff+e.length)/this.blockSize)-1,i=Array(n*this.blockSize);n>0;n--)t+=this._buffer(e,t),r+=this._flushBuffer(i,r);return t+=this._buffer(e,t),i},i.prototype.final=function(e){var t,r;return(e&&(t=this.update(e)),r="encrypt"===this.type?this._finalEncrypt():this._finalDecrypt(),t)?t.concat(r):r},i.prototype._pad=function(e,t){if(0===t)return!1;for(;t<e.length;)e[t++]=0;return!0},i.prototype._finalEncrypt=function(){if(!this._pad(this.buffer,this.bufferOff))return[];var e=Array(this.blockSize);return this._update(this.buffer,0,e,0),e},i.prototype._unpad=function(e){return e},i.prototype._finalDecrypt=function(){n.equal(this.bufferOff,this.blockSize,"Not enough data to decrypt");var e=Array(this.blockSize);return this._flushBuffer(e,0),this._unpad(e)}},1016:function(e,t,r){"use strict";var n=r(3523),i=r(3782),a=r(5334),o=r(9876);function s(){this.tmp=[,,],this.keys=null}function l(e){o.call(this,e);var t=new s;this._desState=t,this.deriveKeys(t,e.key)}i(l,o),e.exports=l,l.create=function(e){return new l(e)};var c=[1,1,2,2,2,2,2,2,1,2,2,2,2,2,2,1];l.prototype.deriveKeys=function(e,t){e.keys=Array(32),n.equal(t.length,this.blockSize,"Invalid key length");var r=a.readUInt32BE(t,0),i=a.readUInt32BE(t,4);a.pc1(r,i,e.tmp,0),r=e.tmp[0],i=e.tmp[1];for(var o=0;o<e.keys.length;o+=2){var s=c[o>>>1];r=a.r28shl(r,s),i=a.r28shl(i,s),a.pc2(r,i,e.keys,o)}},l.prototype._update=function(e,t,r,n){var i=this._desState,o=a.readUInt32BE(e,t),s=a.readUInt32BE(e,t+4);a.ip(o,s,i.tmp,0),o=i.tmp[0],s=i.tmp[1],"encrypt"===this.type?this._encrypt(i,o,s,i.tmp,0):this._decrypt(i,o,s,i.tmp,0),o=i.tmp[0],s=i.tmp[1],a.writeUInt32BE(r,o,n),a.writeUInt32BE(r,s,n+4)},l.prototype._pad=function(e,t){for(var r=e.length-t,n=t;n<e.length;n++)e[n]=r;return!0},l.prototype._unpad=function(e){for(var t=e[e.length-1],r=e.length-t;r<e.length;r++)n.equal(e[r],t);return e.slice(0,e.length-t)},l.prototype._encrypt=function(e,t,r,n,i){for(var o=t,s=r,l=0;l<e.keys.length;l+=2){var c=e.keys[l],f=e.keys[l+1];a.expand(s,e.tmp,0),c^=e.tmp[0],f^=e.tmp[1];var u=a.substitute(c,f),d=a.permute(u),h=s;s=(o^d)>>>0,o=h}a.rip(s,o,n,i)},l.prototype._decrypt=function(e,t,r,n,i){for(var o=r,s=t,l=e.keys.length-2;l>=0;l-=2){var c=e.keys[l],f=e.keys[l+1];a.expand(o,e.tmp,0),c^=e.tmp[0],f^=e.tmp[1];var u=a.substitute(c,f),d=a.permute(u),h=o;o=(s^d)>>>0,s=h}a.rip(o,s,n,i)}},6159:function(e,t,r){"use strict";var n=r(3523),i=r(3782),a=r(9876),o=r(1016);function s(e,t){n.equal(t.length,24,"Invalid key length");var r=t.slice(0,8),i=t.slice(8,16),a=t.slice(16,24);"encrypt"===e?this.ciphers=[o.create({type:"encrypt",key:r}),o.create({type:"decrypt",key:i}),o.create({type:"encrypt",key:a})]:this.ciphers=[o.create({type:"decrypt",key:a}),o.create({type:"encrypt",key:i}),o.create({type:"decrypt",key:r})]}function l(e){a.call(this,e);var t=new s(this.type,this.options.key);this._edeState=t}i(l,a),e.exports=l,l.create=function(e){return new l(e)},l.prototype._update=function(e,t,r,n){var i=this._edeState;i.ciphers[0]._update(e,t,r,n),i.ciphers[1]._update(r,n,r,n),i.ciphers[2]._update(r,n,r,n)},l.prototype._pad=o.prototype._pad,l.prototype._unpad=o.prototype._unpad},5334:function(e,t){"use strict";t.readUInt32BE=function(e,t){return(e[0+t]<<24|e[1+t]<<16|e[2+t]<<8|e[3+t])>>>0},t.writeUInt32BE=function(e,t,r){e[0+r]=t>>>24,e[1+r]=t>>>16&255,e[2+r]=t>>>8&255,e[3+r]=255&t},t.ip=function(e,t,r,n){for(var i=0,a=0,o=6;o>=0;o-=2){for(var s=0;s<=24;s+=8)i<<=1,i|=t>>>s+o&1;for(var s=0;s<=24;s+=8)i<<=1,i|=e>>>s+o&1}for(var o=6;o>=0;o-=2){for(var s=1;s<=25;s+=8)a<<=1,a|=t>>>s+o&1;for(var s=1;s<=25;s+=8)a<<=1,a|=e>>>s+o&1}r[n+0]=i>>>0,r[n+1]=a>>>0},t.rip=function(e,t,r,n){for(var i=0,a=0,o=0;o<4;o++)for(var s=24;s>=0;s-=8)i<<=1,i|=t>>>s+o&1,i<<=1,i|=e>>>s+o&1;for(var o=4;o<8;o++)for(var s=24;s>=0;s-=8)a<<=1,a|=t>>>s+o&1,a<<=1,a|=e>>>s+o&1;r[n+0]=i>>>0,r[n+1]=a>>>0},t.pc1=function(e,t,r,n){for(var i=0,a=0,o=7;o>=5;o--){for(var s=0;s<=24;s+=8)i<<=1,i|=t>>s+o&1;for(var s=0;s<=24;s+=8)i<<=1,i|=e>>s+o&1}for(var s=0;s<=24;s+=8)i<<=1,i|=t>>s+o&1;for(var o=1;o<=3;o++){for(var s=0;s<=24;s+=8)a<<=1,a|=t>>s+o&1;for(var s=0;s<=24;s+=8)a<<=1,a|=e>>s+o&1}for(var s=0;s<=24;s+=8)a<<=1,a|=e>>s+o&1;r[n+0]=i>>>0,r[n+1]=a>>>0},t.r28shl=function(e,t){return e<<t&0xfffffff|e>>>28-t};var r=[14,11,17,4,27,23,25,0,13,22,7,18,5,9,16,24,2,20,12,21,1,8,15,26,15,4,25,19,9,1,26,16,5,11,23,8,12,7,17,0,22,3,10,14,6,20,27,24];t.pc2=function(e,t,n,i){for(var a=0,o=0,s=r.length>>>1,l=0;l<s;l++)a<<=1,a|=e>>>r[l]&1;for(var l=s;l<r.length;l++)o<<=1,o|=t>>>r[l]&1;n[i+0]=a>>>0,n[i+1]=o>>>0},t.expand=function(e,t,r){var n=0,i=0;n=(1&e)<<5|e>>>27;for(var a=23;a>=15;a-=4)n<<=6,n|=e>>>a&63;for(var a=11;a>=3;a-=4)i|=e>>>a&63,i<<=6;i|=(31&e)<<1|e>>>31,t[r+0]=n>>>0,t[r+1]=i>>>0};var n=[14,0,4,15,13,7,1,4,2,14,15,2,11,13,8,1,3,10,10,6,6,12,12,11,5,9,9,5,0,3,7,8,4,15,1,12,14,8,8,2,13,4,6,9,2,1,11,7,15,5,12,11,9,3,7,14,3,10,10,0,5,6,0,13,15,3,1,13,8,4,14,7,6,15,11,2,3,8,4,14,9,12,7,0,2,1,13,10,12,6,0,9,5,11,10,5,0,13,14,8,7,10,11,1,10,3,4,15,13,4,1,2,5,11,8,6,12,7,6,12,9,0,3,5,2,14,15,9,10,13,0,7,9,0,14,9,6,3,3,4,15,6,5,10,1,2,13,8,12,5,7,14,11,12,4,11,2,15,8,1,13,1,6,10,4,13,9,0,8,6,15,9,3,8,0,7,11,4,1,15,2,14,12,3,5,11,10,5,14,2,7,12,7,13,13,8,14,11,3,5,0,6,6,15,9,0,10,3,1,4,2,7,8,2,5,12,11,1,12,10,4,14,15,9,10,3,6,15,9,0,0,6,12,10,11,1,7,13,13,8,15,9,1,4,3,5,14,11,5,12,2,7,8,2,4,14,2,14,12,11,4,2,1,12,7,4,10,7,11,13,6,1,8,5,5,0,3,15,15,10,13,3,0,9,14,8,9,6,4,11,2,8,1,12,11,7,10,1,13,14,7,2,8,13,15,6,9,15,12,0,5,9,6,10,3,4,0,5,14,3,12,10,1,15,10,4,15,2,9,7,2,12,6,9,8,5,0,6,13,1,3,13,4,14,14,0,7,11,5,3,11,8,9,4,14,3,15,2,5,12,2,9,8,5,12,15,3,10,7,11,0,14,4,1,10,7,1,6,13,0,11,8,6,13,4,13,11,0,2,11,14,7,15,4,0,9,8,1,13,10,3,14,12,3,9,5,7,12,5,2,10,15,6,8,1,6,1,6,4,11,11,13,13,8,12,1,3,4,7,10,14,7,10,9,15,5,6,0,8,15,0,14,5,2,9,3,2,12,13,1,2,15,8,13,4,8,6,10,15,3,11,7,1,4,10,12,9,5,3,6,14,11,5,0,0,14,12,9,7,2,7,2,11,1,4,14,1,7,9,4,12,10,14,8,2,13,0,15,6,12,10,9,13,0,15,3,3,5,5,6,8,11];t.substitute=function(e,t){for(var r=0,i=0;i<4;i++){var a=e>>>18-6*i&63,o=n[64*i+a];r<<=4,r|=o}for(var i=0;i<4;i++){var a=t>>>18-6*i&63,o=n[256+64*i+a];r<<=4,r|=o}return r>>>0};var i=[16,25,12,11,3,20,4,15,31,17,9,6,27,14,1,22,30,24,8,18,0,5,29,23,13,19,2,26,10,21,28,7];t.permute=function(e){for(var t=0,r=0;r<i.length;r++)t<<=1,t|=e>>>i[r]&1;return t>>>0},t.padSplit=function(e,t,r){for(var n=e.toString(2);n.length<t;)n="0"+n;for(var i=[],a=0;a<t;a+=r)i.push(n.slice(a,a+r));return i.join(" ")}},6587:function(e,t,r){var i=r(296),a=r(7992),o=r(373),s={binary:!0,hex:!0,base64:!0};function l(e,t,r,a){return n.Buffer.isBuffer(t)||void 0===s[t]?l(e,"binary",t,r):(t=t||"binary",a=a||"binary",r=r||new n.Buffer([2]),n.Buffer.isBuffer(r)||(r=new n.Buffer(r,a)),"number"==typeof e)?new o(i(e,r),r,!0):(n.Buffer.isBuffer(e)||(e=new n.Buffer(e,t)),new o(e,r,!0))}t.DiffieHellmanGroup=t.createDiffieHellmanGroup=t.getDiffieHellman=function(e){return new o(new n.Buffer(a[e].prime,"hex"),new n.Buffer(a[e].gen,"hex"))},t.createDiffieHellman=t.DiffieHellman=l},373:function(e,t,r){var i=r(711),a=new(r(1354)),o=new i(24),s=new i(11),l=new i(10),c=new i(3),f=new i(7),u=r(296),d=r(7223);function h(e,t){return t=t||"utf8",n.Buffer.isBuffer(e)||(e=new n.Buffer(e,t)),this._pub=new i(e),this}function p(e,t){return t=t||"utf8",n.Buffer.isBuffer(e)||(e=new n.Buffer(e,t)),this._priv=new i(e),this}e.exports=g;var b={};function m(e,t){var r,n=t.toString("hex"),i=[n,e.toString(16)].join("_");if(i in b)return b[i];var d=0;if(e.isEven()||!u.simpleSieve||!u.fermatTest(e)||!a.test(e))return d+=1,"02"===n||"05"===n?d+=8:d+=4,b[i]=d,d;switch(!a.test(e.shrn(1))&&(d+=2),n){case"02":e.mod(o).cmp(s)&&(d+=8);break;case"05":(r=e.mod(l)).cmp(c)&&r.cmp(f)&&(d+=8);break;default:d+=4}return b[i]=d,d}function g(e,t,r){this.setGenerator(t),this.__prime=new i(e),this._prime=i.mont(this.__prime),this._primeLen=e.length,this._pub=void 0,this._priv=void 0,this._primeCode=void 0,r?(this.setPublicKey=h,this.setPrivateKey=p):this._primeCode=8}function y(e,t){var r=new n.Buffer(e.toArray());return t?r.toString(t):r}Object.defineProperty(g.prototype,"verifyError",{enumerable:!0,get:function(){return"number"!=typeof this._primeCode&&(this._primeCode=m(this.__prime,this.__gen)),this._primeCode}}),g.prototype.generateKeys=function(){return this._priv||(this._priv=new i(d(this._primeLen))),this._pub=this._gen.toRed(this._prime).redPow(this._priv).fromRed(),this.getPublicKey()},g.prototype.computeSecret=function(e){var t=(e=(e=new i(e)).toRed(this._prime)).redPow(this._priv).fromRed(),r=new n.Buffer(t.toArray()),a=this.getPrime();if(r.length<a.length){var o=new n.Buffer(a.length-r.length);o.fill(0),r=n.Buffer.concat([o,r])}return r},g.prototype.getPublicKey=function(e){return y(this._pub,e)},g.prototype.getPrivateKey=function(e){return y(this._priv,e)},g.prototype.getPrime=function(e){return y(this.__prime,e)},g.prototype.getGenerator=function(e){return y(this._gen,e)},g.prototype.setGenerator=function(e,t){return t=t||"utf8",n.Buffer.isBuffer(e)||(e=new n.Buffer(e,t)),this.__gen=e,this._gen=new i(e),this}},296:function(e,t,r){var n=r(7223);e.exports=y,y.simpleSieve=m,y.fermatTest=g;var i=r(711),a=new i(24),o=new(r(1354)),s=new i(1),l=new i(2),c=new i(5);new i(16),new i(8);var f=new i(10),u=new i(3);new i(7);var d=new i(11),h=new i(4);new i(12);var p=null;function b(){if(null!==p)return p;var e=1048576,t=[];t[0]=2;for(var r=1,n=3;n<e;n+=2){for(var i=Math.ceil(Math.sqrt(n)),a=0;a<r&&t[a]<=i&&n%t[a]!=0;a++);r!==a&&t[a]<=i||(t[r++]=n)}return p=t,t}function m(e){for(var t=b(),r=0;r<t.length;r++)if(0===e.modn(t[r]))if(0!==e.cmpn(t[r]))return!1;else break;return!0}function g(e){var t=i.mont(e);return 0===l.toRed(t).redPow(e.subn(1)).fromRed().cmpn(1)}function y(e,t){var r,p;if(e<16)if(2===t||5===t)return new i([140,123]);else return new i([140,39]);for(t=new i(t);;){for(r=new i(n(Math.ceil(e/8)));r.bitLength()>e;)r.ishrn(1);if(r.isEven()&&r.iadd(s),r.testn(1)||r.iadd(l),t.cmp(l)){if(!t.cmp(c))for(;r.mod(f).cmp(u);)r.iadd(h)}else for(;r.mod(a).cmp(d);)r.iadd(h);if(m(p=r.shrn(1))&&m(r)&&g(p)&&g(r)&&o.test(p)&&o.test(r))return r}}},949:function(e,t,r){"use strict";var n=t;n.version=r(2531).i8,n.utils=r(4401),n.rand=r(3500),n.curve=r(9359),n.curves=r(6226),n.ec=r(4088),n.eddsa=r(8511)},2727:function(e,t,r){"use strict";var n=r(711),i=r(4401),a=i.getNAF,o=i.getJSF,s=i.assert;function l(e,t){this.type=e,this.p=new n(t.p,16),this.red=t.prime?n.red(t.prime):n.mont(this.p),this.zero=new n(0).toRed(this.red),this.one=new n(1).toRed(this.red),this.two=new n(2).toRed(this.red),this.n=t.n&&new n(t.n,16),this.g=t.g&&this.pointFromJSON(t.g,t.gRed),this._wnafT1=[,,,,],this._wnafT2=[,,,,],this._wnafT3=[,,,,],this._wnafT4=[,,,,],this._bitLength=this.n?this.n.bitLength():0;var r=this.n&&this.p.div(this.n);!r||r.cmpn(100)>0?this.redN=null:(this._maxwellTrick=!0,this.redN=this.n.toRed(this.red))}function c(e,t){this.curve=e,this.type=t,this.precomputed=null}e.exports=l,l.prototype.point=function(){throw Error("Not implemented")},l.prototype.validate=function(){throw Error("Not implemented")},l.prototype._fixedNafMul=function(e,t){s(e.precomputed);var r=e._getDoubles(),n=a(t,1,this._bitLength),i=(1<<r.step+1)-(r.step%2==0?2:1);i/=3;for(var o=[],l=0;l<n.length;l+=r.step){for(var c=0,t=l+r.step-1;t>=l;t--)c=(c<<1)+n[t];o.push(c)}for(var f=this.jpoint(null,null,null),u=this.jpoint(null,null,null),d=i;d>0;d--){for(var l=0;l<o.length;l++){var c=o[l];c===d?u=u.mixedAdd(r.points[l]):c===-d&&(u=u.mixedAdd(r.points[l].neg()))}f=f.add(u)}return f.toP()},l.prototype._wnafMul=function(e,t){var r=4,n=e._getNAFPoints(r);r=n.wnd;for(var i=n.points,o=a(t,r,this._bitLength),l=this.jpoint(null,null,null),c=o.length-1;c>=0;c--){for(var t=0;c>=0&&0===o[c];c--)t++;if(c>=0&&t++,l=l.dblp(t),c<0)break;var f=o[c];s(0!==f),l="affine"===e.type?f>0?l.mixedAdd(i[f-1>>1]):l.mixedAdd(i[-f-1>>1].neg()):f>0?l.add(i[f-1>>1]):l.add(i[-f-1>>1].neg())}return"affine"===e.type?l.toP():l},l.prototype._wnafMulAdd=function(e,t,r,n,i){for(var s=this._wnafT1,l=this._wnafT2,c=this._wnafT3,f=0,u=0;u<n;u++){var d=t[u],h=d._getNAFPoints(e);s[u]=h.wnd,l[u]=h.points}for(var u=n-1;u>=1;u-=2){var p=u-1,b=u;if(1!==s[p]||1!==s[b]){c[p]=a(r[p],s[p],this._bitLength),c[b]=a(r[b],s[b],this._bitLength),f=Math.max(c[p].length,f),f=Math.max(c[b].length,f);continue}var m=[t[p],null,null,t[b]];0===t[p].y.cmp(t[b].y)?(m[1]=t[p].add(t[b]),m[2]=t[p].toJ().mixedAdd(t[b].neg())):0===t[p].y.cmp(t[b].y.redNeg())?(m[1]=t[p].toJ().mixedAdd(t[b]),m[2]=t[p].add(t[b].neg())):(m[1]=t[p].toJ().mixedAdd(t[b]),m[2]=t[p].toJ().mixedAdd(t[b].neg()));var g=[-3,-1,-5,-7,0,7,5,1,3],y=o(r[p],r[b]);f=Math.max(y[0].length,f),c[p]=Array(f),c[b]=Array(f);for(var v=0;v<f;v++){var x=0|y[0][v],w=0|y[1][v];c[p][v]=g[(x+1)*3+(w+1)],c[b][v]=0,l[p]=m}}for(var S=this.jpoint(null,null,null),k=this._wnafT4,u=f;u>=0;u--){for(var _=0;u>=0;){for(var E=!0,v=0;v<n;v++)k[v]=0|c[v][u],0!==k[v]&&(E=!1);if(!E)break;_++,u--}if(u>=0&&_++,S=S.dblp(_),u<0)break;for(var v=0;v<n;v++){var d,M=k[v];0!==M&&(M>0?d=l[v][M-1>>1]:M<0&&(d=l[v][-M-1>>1].neg()),S="affine"===d.type?S.mixedAdd(d):S.add(d))}}for(var u=0;u<n;u++)l[u]=null;return i?S:S.toP()},l.BasePoint=c,c.prototype.eq=function(){throw Error("Not implemented")},c.prototype.validate=function(){return this.curve.validate(this)},l.prototype.decodePoint=function(e,t){e=i.toArray(e,t);var r=this.p.byteLength();if((4===e[0]||6===e[0]||7===e[0])&&e.length-1==2*r)return 6===e[0]?s(e[e.length-1]%2==0):7===e[0]&&s(e[e.length-1]%2==1),this.point(e.slice(1,1+r),e.slice(1+r,1+2*r));if((2===e[0]||3===e[0])&&e.length-1===r)return this.pointFromX(e.slice(1,1+r),3===e[0]);throw Error("Unknown point format")},c.prototype.encodeCompressed=function(e){return this.encode(e,!0)},c.prototype._encode=function(e){var t=this.curve.p.byteLength(),r=this.getX().toArray("be",t);return e?[this.getY().isEven()?2:3].concat(r):[4].concat(r,this.getY().toArray("be",t))},c.prototype.encode=function(e,t){return i.encode(this._encode(t),e)},c.prototype.precompute=function(e){if(this.precomputed)return this;var t={doubles:null,naf:null,beta:null};return t.naf=this._getNAFPoints(8),t.doubles=this._getDoubles(4,e),t.beta=this._getBeta(),this.precomputed=t,this},c.prototype._hasDoubles=function(e){if(!this.precomputed)return!1;var t=this.precomputed.doubles;return!!t&&t.points.length>=Math.ceil((e.bitLength()+1)/t.step)},c.prototype._getDoubles=function(e,t){if(this.precomputed&&this.precomputed.doubles)return this.precomputed.doubles;for(var r=[this],n=this,i=0;i<t;i+=e){for(var a=0;a<e;a++)n=n.dbl();r.push(n)}return{step:e,points:r}},c.prototype._getNAFPoints=function(e){if(this.precomputed&&this.precomputed.naf)return this.precomputed.naf;for(var t=[this],r=(1<<e)-1,n=1===r?null:this.dbl(),i=1;i<r;i++)t[i]=t[i-1].add(n);return{wnd:e,points:t}},c.prototype._getBeta=function(){return null},c.prototype.dblp=function(e){for(var t=this,r=0;r<e;r++)t=t.dbl();return t}},2705:function(e,t,r){"use strict";var n=r(4401),i=r(711),a=r(3782),o=r(2727),s=n.assert;function l(e){this.twisted=(0|e.a)!=1,this.mOneA=this.twisted&&(0|e.a)==-1,this.extended=this.mOneA,o.call(this,"edwards",e),this.a=new i(e.a,16).umod(this.red.m),this.a=this.a.toRed(this.red),this.c=new i(e.c,16).toRed(this.red),this.c2=this.c.redSqr(),this.d=new i(e.d,16).toRed(this.red),this.dd=this.d.redAdd(this.d),s(!this.twisted||0===this.c.fromRed().cmpn(1)),this.oneC=(0|e.c)==1}function c(e,t,r,n,a){o.BasePoint.call(this,e,"projective"),null===t&&null===r&&null===n?(this.x=this.curve.zero,this.y=this.curve.one,this.z=this.curve.one,this.t=this.curve.zero,this.zOne=!0):(this.x=new i(t,16),this.y=new i(r,16),this.z=n?new i(n,16):this.curve.one,this.t=a&&new i(a,16),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.y.red||(this.y=this.y.toRed(this.curve.red)),this.z.red||(this.z=this.z.toRed(this.curve.red)),this.t&&!this.t.red&&(this.t=this.t.toRed(this.curve.red)),this.zOne=this.z===this.curve.one,this.curve.extended&&!this.t&&(this.t=this.x.redMul(this.y),this.zOne||(this.t=this.t.redMul(this.z.redInvm()))))}a(l,o),e.exports=l,l.prototype._mulA=function(e){return this.mOneA?e.redNeg():this.a.redMul(e)},l.prototype._mulC=function(e){return this.oneC?e:this.c.redMul(e)},l.prototype.jpoint=function(e,t,r,n){return this.point(e,t,r,n)},l.prototype.pointFromX=function(e,t){(e=new i(e,16)).red||(e=e.toRed(this.red));var r=e.redSqr(),n=this.c2.redSub(this.a.redMul(r)),a=this.one.redSub(this.c2.redMul(this.d).redMul(r)),o=n.redMul(a.redInvm()),s=o.redSqrt();if(0!==s.redSqr().redSub(o).cmp(this.zero))throw Error("invalid point");var l=s.fromRed().isOdd();return(t&&!l||!t&&l)&&(s=s.redNeg()),this.point(e,s)},l.prototype.pointFromY=function(e,t){(e=new i(e,16)).red||(e=e.toRed(this.red));var r=e.redSqr(),n=r.redSub(this.c2),a=r.redMul(this.d).redMul(this.c2).redSub(this.a),o=n.redMul(a.redInvm());if(0===o.cmp(this.zero))if(!t)return this.point(this.zero,e);else throw Error("invalid point");var s=o.redSqrt();if(0!==s.redSqr().redSub(o).cmp(this.zero))throw Error("invalid point");return s.fromRed().isOdd()!==t&&(s=s.redNeg()),this.point(s,e)},l.prototype.validate=function(e){if(e.isInfinity())return!0;e.normalize();var t=e.x.redSqr(),r=e.y.redSqr(),n=t.redMul(this.a).redAdd(r),i=this.c2.redMul(this.one.redAdd(this.d.redMul(t).redMul(r)));return 0===n.cmp(i)},a(c,o.BasePoint),l.prototype.pointFromJSON=function(e){return c.fromJSON(this,e)},l.prototype.point=function(e,t,r,n){return new c(this,e,t,r,n)},c.fromJSON=function(e,t){return new c(e,t[0],t[1],t[2])},c.prototype.inspect=function(){return this.isInfinity()?"<EC Point Infinity>":"<EC Point x: "+this.x.fromRed().toString(16,2)+" y: "+this.y.fromRed().toString(16,2)+" z: "+this.z.fromRed().toString(16,2)+">"},c.prototype.isInfinity=function(){return 0===this.x.cmpn(0)&&(0===this.y.cmp(this.z)||this.zOne&&0===this.y.cmp(this.curve.c))},c.prototype._extDbl=function(){var e=this.x.redSqr(),t=this.y.redSqr(),r=this.z.redSqr();r=r.redIAdd(r);var n=this.curve._mulA(e),i=this.x.redAdd(this.y).redSqr().redISub(e).redISub(t),a=n.redAdd(t),o=a.redSub(r),s=n.redSub(t),l=i.redMul(o),c=a.redMul(s),f=i.redMul(s),u=o.redMul(a);return this.curve.point(l,c,u,f)},c.prototype._projDbl=function(){var e,t,r,n=this.x.redAdd(this.y).redSqr(),i=this.x.redSqr(),a=this.y.redSqr();if(this.curve.twisted){var o=this.curve._mulA(i),s=o.redAdd(a);if(this.zOne)e=n.redSub(i).redSub(a).redMul(s.redSub(this.curve.two)),t=s.redMul(o.redSub(a)),r=s.redSqr().redSub(s).redSub(s);else{var l=this.z.redSqr(),c=s.redSub(l).redISub(l);e=n.redSub(i).redISub(a).redMul(c),t=s.redMul(o.redSub(a)),r=s.redMul(c)}}else{var o=i.redAdd(a),l=this.curve._mulC(this.z).redSqr(),c=o.redSub(l).redSub(l);e=this.curve._mulC(n.redISub(o)).redMul(c),t=this.curve._mulC(o).redMul(i.redISub(a)),r=o.redMul(c)}return this.curve.point(e,t,r)},c.prototype.dbl=function(){return this.isInfinity()?this:this.curve.extended?this._extDbl():this._projDbl()},c.prototype._extAdd=function(e){var t=this.y.redSub(this.x).redMul(e.y.redSub(e.x)),r=this.y.redAdd(this.x).redMul(e.y.redAdd(e.x)),n=this.t.redMul(this.curve.dd).redMul(e.t),i=this.z.redMul(e.z.redAdd(e.z)),a=r.redSub(t),o=i.redSub(n),s=i.redAdd(n),l=r.redAdd(t),c=a.redMul(o),f=s.redMul(l),u=a.redMul(l),d=o.redMul(s);return this.curve.point(c,f,d,u)},c.prototype._projAdd=function(e){var t,r,n=this.z.redMul(e.z),i=n.redSqr(),a=this.x.redMul(e.x),o=this.y.redMul(e.y),s=this.curve.d.redMul(a).redMul(o),l=i.redSub(s),c=i.redAdd(s),f=this.x.redAdd(this.y).redMul(e.x.redAdd(e.y)).redISub(a).redISub(o),u=n.redMul(l).redMul(f);return this.curve.twisted?(t=n.redMul(c).redMul(o.redSub(this.curve._mulA(a))),r=l.redMul(c)):(t=n.redMul(c).redMul(o.redSub(a)),r=this.curve._mulC(l).redMul(c)),this.curve.point(u,t,r)},c.prototype.add=function(e){return this.isInfinity()?e:e.isInfinity()?this:this.curve.extended?this._extAdd(e):this._projAdd(e)},c.prototype.mul=function(e){return this._hasDoubles(e)?this.curve._fixedNafMul(this,e):this.curve._wnafMul(this,e)},c.prototype.mulAdd=function(e,t,r){return this.curve._wnafMulAdd(1,[this,t],[e,r],2,!1)},c.prototype.jmulAdd=function(e,t,r){return this.curve._wnafMulAdd(1,[this,t],[e,r],2,!0)},c.prototype.normalize=function(){if(this.zOne)return this;var e=this.z.redInvm();return this.x=this.x.redMul(e),this.y=this.y.redMul(e),this.t&&(this.t=this.t.redMul(e)),this.z=this.curve.one,this.zOne=!0,this},c.prototype.neg=function(){return this.curve.point(this.x.redNeg(),this.y,this.z,this.t&&this.t.redNeg())},c.prototype.getX=function(){return this.normalize(),this.x.fromRed()},c.prototype.getY=function(){return this.normalize(),this.y.fromRed()},c.prototype.eq=function(e){return this===e||0===this.getX().cmp(e.getX())&&0===this.getY().cmp(e.getY())},c.prototype.eqXToP=function(e){var t=e.toRed(this.curve.red).redMul(this.z);if(0===this.x.cmp(t))return!0;for(var r=e.clone(),n=this.curve.redN.redMul(this.z);;){if(r.iadd(this.curve.n),r.cmp(this.curve.p)>=0)return!1;if(t.redIAdd(n),0===this.x.cmp(t))return!0}},c.prototype.toP=c.prototype.normalize,c.prototype.mixedAdd=c.prototype.add},9359:function(e,t,r){"use strict";var n=t;n.base=r(2727),n.short=r(4720),n.mont=r(6653),n.edwards=r(2705)},6653:function(e,t,r){"use strict";var n=r(711),i=r(3782),a=r(2727),o=r(4401);function s(e){a.call(this,"mont",e),this.a=new n(e.a,16).toRed(this.red),this.b=new n(e.b,16).toRed(this.red),this.i4=new n(4).toRed(this.red).redInvm(),this.two=new n(2).toRed(this.red),this.a24=this.i4.redMul(this.a.redAdd(this.two))}function l(e,t,r){a.BasePoint.call(this,e,"projective"),null===t&&null===r?(this.x=this.curve.one,this.z=this.curve.zero):(this.x=new n(t,16),this.z=new n(r,16),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.z.red||(this.z=this.z.toRed(this.curve.red)))}i(s,a),e.exports=s,s.prototype.validate=function(e){var t=e.normalize().x,r=t.redSqr(),n=r.redMul(t).redAdd(r.redMul(this.a)).redAdd(t);return 0===n.redSqrt().redSqr().cmp(n)},i(l,a.BasePoint),s.prototype.decodePoint=function(e,t){return this.point(o.toArray(e,t),1)},s.prototype.point=function(e,t){return new l(this,e,t)},s.prototype.pointFromJSON=function(e){return l.fromJSON(this,e)},l.prototype.precompute=function(){},l.prototype._encode=function(){return this.getX().toArray("be",this.curve.p.byteLength())},l.fromJSON=function(e,t){return new l(e,t[0],t[1]||e.one)},l.prototype.inspect=function(){return this.isInfinity()?"<EC Point Infinity>":"<EC Point x: "+this.x.fromRed().toString(16,2)+" z: "+this.z.fromRed().toString(16,2)+">"},l.prototype.isInfinity=function(){return 0===this.z.cmpn(0)},l.prototype.dbl=function(){var e=this.x.redAdd(this.z).redSqr(),t=this.x.redSub(this.z).redSqr(),r=e.redSub(t),n=e.redMul(t),i=r.redMul(t.redAdd(this.curve.a24.redMul(r)));return this.curve.point(n,i)},l.prototype.add=function(){throw Error("Not supported on Montgomery curve")},l.prototype.diffAdd=function(e,t){var r=this.x.redAdd(this.z),n=this.x.redSub(this.z),i=e.x.redAdd(e.z),a=e.x.redSub(e.z).redMul(r),o=i.redMul(n),s=t.z.redMul(a.redAdd(o).redSqr()),l=t.x.redMul(a.redISub(o).redSqr());return this.curve.point(s,l)},l.prototype.mul=function(e){for(var t=e.clone(),r=this,n=this.curve.point(null,null),i=this,a=[];0!==t.cmpn(0);t.iushrn(1))a.push(t.andln(1));for(var o=a.length-1;o>=0;o--)0===a[o]?(r=r.diffAdd(n,i),n=n.dbl()):(n=r.diffAdd(n,i),r=r.dbl());return n},l.prototype.mulAdd=function(){throw Error("Not supported on Montgomery curve")},l.prototype.jumlAdd=function(){throw Error("Not supported on Montgomery curve")},l.prototype.eq=function(e){return 0===this.getX().cmp(e.getX())},l.prototype.normalize=function(){return this.x=this.x.redMul(this.z.redInvm()),this.z=this.curve.one,this},l.prototype.getX=function(){return this.normalize(),this.x.fromRed()}},4720:function(e,t,r){"use strict";var n=r(4401),i=r(711),a=r(3782),o=r(2727),s=n.assert;function l(e){o.call(this,"short",e),this.a=new i(e.a,16).toRed(this.red),this.b=new i(e.b,16).toRed(this.red),this.tinv=this.two.redInvm(),this.zeroA=0===this.a.fromRed().cmpn(0),this.threeA=0===this.a.fromRed().sub(this.p).cmpn(-3),this.endo=this._getEndomorphism(e),this._endoWnafT1=[,,,,],this._endoWnafT2=[,,,,]}function c(e,t,r,n){o.BasePoint.call(this,e,"affine"),null===t&&null===r?(this.x=null,this.y=null,this.inf=!0):(this.x=new i(t,16),this.y=new i(r,16),n&&(this.x.forceRed(this.curve.red),this.y.forceRed(this.curve.red)),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.y.red||(this.y=this.y.toRed(this.curve.red)),this.inf=!1)}function f(e,t,r,n){o.BasePoint.call(this,e,"jacobian"),null===t&&null===r&&null===n?(this.x=this.curve.one,this.y=this.curve.one,this.z=new i(0)):(this.x=new i(t,16),this.y=new i(r,16),this.z=new i(n,16)),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.y.red||(this.y=this.y.toRed(this.curve.red)),this.z.red||(this.z=this.z.toRed(this.curve.red)),this.zOne=this.z===this.curve.one}a(l,o),e.exports=l,l.prototype._getEndomorphism=function(e){if(this.zeroA&&this.g&&this.n&&1===this.p.modn(3)){if(e.beta)t=new i(e.beta,16).toRed(this.red);else{var t,r,n,a=this._getEndoRoots(this.p);t=(t=0>a[0].cmp(a[1])?a[0]:a[1]).toRed(this.red)}if(e.lambda)r=new i(e.lambda,16);else{var o=this._getEndoRoots(this.n);0===this.g.mul(o[0]).x.cmp(this.g.x.redMul(t))?r=o[0]:(r=o[1],s(0===this.g.mul(r).x.cmp(this.g.x.redMul(t))))}return n=e.basis?e.basis.map(function(e){return{a:new i(e.a,16),b:new i(e.b,16)}}):this._getEndoBasis(r),{beta:t,lambda:r,basis:n}}},l.prototype._getEndoRoots=function(e){var t=e===this.p?this.red:i.mont(e),r=new i(2).toRed(t).redInvm(),n=r.redNeg(),a=new i(3).toRed(t).redNeg().redSqrt().redMul(r);return[n.redAdd(a).fromRed(),n.redSub(a).fromRed()]},l.prototype._getEndoBasis=function(e){for(var t,r,n,a,o,s,l,c,f,u=this.n.ushrn(Math.floor(this.n.bitLength()/2)),d=e,h=this.n.clone(),p=new i(1),b=new i(0),m=new i(0),g=new i(1),y=0;0!==d.cmpn(0);){var v=h.div(d);c=h.sub(v.mul(d)),f=m.sub(v.mul(p));var x=g.sub(v.mul(b));if(!n&&0>c.cmp(u))t=l.neg(),r=p,n=c.neg(),a=f;else if(n&&2==++y)break;l=c,h=d,d=c,m=p,p=f,g=b,b=x}o=c.neg(),s=f;var w=n.sqr().add(a.sqr());return o.sqr().add(s.sqr()).cmp(w)>=0&&(o=t,s=r),n.negative&&(n=n.neg(),a=a.neg()),o.negative&&(o=o.neg(),s=s.neg()),[{a:n,b:a},{a:o,b:s}]},l.prototype._endoSplit=function(e){var t=this.endo.basis,r=t[0],n=t[1],i=n.b.mul(e).divRound(this.n),a=r.b.neg().mul(e).divRound(this.n),o=i.mul(r.a),s=a.mul(n.a),l=i.mul(r.b),c=a.mul(n.b);return{k1:e.sub(o).sub(s),k2:l.add(c).neg()}},l.prototype.pointFromX=function(e,t){(e=new i(e,16)).red||(e=e.toRed(this.red));var r=e.redSqr().redMul(e).redIAdd(e.redMul(this.a)).redIAdd(this.b),n=r.redSqrt();if(0!==n.redSqr().redSub(r).cmp(this.zero))throw Error("invalid point");var a=n.fromRed().isOdd();return(t&&!a||!t&&a)&&(n=n.redNeg()),this.point(e,n)},l.prototype.validate=function(e){if(e.inf)return!0;var t=e.x,r=e.y,n=this.a.redMul(t),i=t.redSqr().redMul(t).redIAdd(n).redIAdd(this.b);return 0===r.redSqr().redISub(i).cmpn(0)},l.prototype._endoWnafMulAdd=function(e,t,r){for(var n=this._endoWnafT1,i=this._endoWnafT2,a=0;a<e.length;a++){var o=this._endoSplit(t[a]),s=e[a],l=s._getBeta();o.k1.negative&&(o.k1.ineg(),s=s.neg(!0)),o.k2.negative&&(o.k2.ineg(),l=l.neg(!0)),n[2*a]=s,n[2*a+1]=l,i[2*a]=o.k1,i[2*a+1]=o.k2}for(var c=this._wnafMulAdd(1,n,i,2*a,r),f=0;f<2*a;f++)n[f]=null,i[f]=null;return c},a(c,o.BasePoint),l.prototype.point=function(e,t,r){return new c(this,e,t,r)},l.prototype.pointFromJSON=function(e,t){return c.fromJSON(this,e,t)},c.prototype._getBeta=function(){if(this.curve.endo){var e=this.precomputed;if(e&&e.beta)return e.beta;var t=this.curve.point(this.x.redMul(this.curve.endo.beta),this.y);if(e){var r=this.curve,n=function(e){return r.point(e.x.redMul(r.endo.beta),e.y)};e.beta=t,t.precomputed={beta:null,naf:e.naf&&{wnd:e.naf.wnd,points:e.naf.points.map(n)},doubles:e.doubles&&{step:e.doubles.step,points:e.doubles.points.map(n)}}}return t}},c.prototype.toJSON=function(){return this.precomputed?[this.x,this.y,this.precomputed&&{doubles:this.precomputed.doubles&&{step:this.precomputed.doubles.step,points:this.precomputed.doubles.points.slice(1)},naf:this.precomputed.naf&&{wnd:this.precomputed.naf.wnd,points:this.precomputed.naf.points.slice(1)}}]:[this.x,this.y]},c.fromJSON=function(e,t,r){"string"==typeof t&&(t=JSON.parse(t));var n=e.point(t[0],t[1],r);if(!t[2])return n;function i(t){return e.point(t[0],t[1],r)}var a=t[2];return n.precomputed={beta:null,doubles:a.doubles&&{step:a.doubles.step,points:[n].concat(a.doubles.points.map(i))},naf:a.naf&&{wnd:a.naf.wnd,points:[n].concat(a.naf.points.map(i))}},n},c.prototype.inspect=function(){return this.isInfinity()?"<EC Point Infinity>":"<EC Point x: "+this.x.fromRed().toString(16,2)+" y: "+this.y.fromRed().toString(16,2)+">"},c.prototype.isInfinity=function(){return this.inf},c.prototype.add=function(e){if(this.inf)return e;if(e.inf)return this;if(this.eq(e))return this.dbl();if(this.neg().eq(e)||0===this.x.cmp(e.x))return this.curve.point(null,null);var t=this.y.redSub(e.y);0!==t.cmpn(0)&&(t=t.redMul(this.x.redSub(e.x).redInvm()));var r=t.redSqr().redISub(this.x).redISub(e.x),n=t.redMul(this.x.redSub(r)).redISub(this.y);return this.curve.point(r,n)},c.prototype.dbl=function(){if(this.inf)return this;var e=this.y.redAdd(this.y);if(0===e.cmpn(0))return this.curve.point(null,null);var t=this.curve.a,r=this.x.redSqr(),n=e.redInvm(),i=r.redAdd(r).redIAdd(r).redIAdd(t).redMul(n),a=i.redSqr().redISub(this.x.redAdd(this.x)),o=i.redMul(this.x.redSub(a)).redISub(this.y);return this.curve.point(a,o)},c.prototype.getX=function(){return this.x.fromRed()},c.prototype.getY=function(){return this.y.fromRed()},c.prototype.mul=function(e){return(e=new i(e,16),this.isInfinity())?this:this._hasDoubles(e)?this.curve._fixedNafMul(this,e):this.curve.endo?this.curve._endoWnafMulAdd([this],[e]):this.curve._wnafMul(this,e)},c.prototype.mulAdd=function(e,t,r){var n=[this,t],i=[e,r];return this.curve.endo?this.curve._endoWnafMulAdd(n,i):this.curve._wnafMulAdd(1,n,i,2)},c.prototype.jmulAdd=function(e,t,r){var n=[this,t],i=[e,r];return this.curve.endo?this.curve._endoWnafMulAdd(n,i,!0):this.curve._wnafMulAdd(1,n,i,2,!0)},c.prototype.eq=function(e){return this===e||this.inf===e.inf&&(this.inf||0===this.x.cmp(e.x)&&0===this.y.cmp(e.y))},c.prototype.neg=function(e){if(this.inf)return this;var t=this.curve.point(this.x,this.y.redNeg());if(e&&this.precomputed){var r=this.precomputed,n=function(e){return e.neg()};t.precomputed={naf:r.naf&&{wnd:r.naf.wnd,points:r.naf.points.map(n)},doubles:r.doubles&&{step:r.doubles.step,points:r.doubles.points.map(n)}}}return t},c.prototype.toJ=function(){return this.inf?this.curve.jpoint(null,null,null):this.curve.jpoint(this.x,this.y,this.curve.one)},a(f,o.BasePoint),l.prototype.jpoint=function(e,t,r){return new f(this,e,t,r)},f.prototype.toP=function(){if(this.isInfinity())return this.curve.point(null,null);var e=this.z.redInvm(),t=e.redSqr(),r=this.x.redMul(t),n=this.y.redMul(t).redMul(e);return this.curve.point(r,n)},f.prototype.neg=function(){return this.curve.jpoint(this.x,this.y.redNeg(),this.z)},f.prototype.add=function(e){if(this.isInfinity())return e;if(e.isInfinity())return this;var t=e.z.redSqr(),r=this.z.redSqr(),n=this.x.redMul(t),i=e.x.redMul(r),a=this.y.redMul(t.redMul(e.z)),o=e.y.redMul(r.redMul(this.z)),s=n.redSub(i),l=a.redSub(o);if(0===s.cmpn(0))if(0!==l.cmpn(0))return this.curve.jpoint(null,null,null);else return this.dbl();var c=s.redSqr(),f=c.redMul(s),u=n.redMul(c),d=l.redSqr().redIAdd(f).redISub(u).redISub(u),h=l.redMul(u.redISub(d)).redISub(a.redMul(f)),p=this.z.redMul(e.z).redMul(s);return this.curve.jpoint(d,h,p)},f.prototype.mixedAdd=function(e){if(this.isInfinity())return e.toJ();if(e.isInfinity())return this;var t=this.z.redSqr(),r=this.x,n=e.x.redMul(t),i=this.y,a=e.y.redMul(t).redMul(this.z),o=r.redSub(n),s=i.redSub(a);if(0===o.cmpn(0))if(0!==s.cmpn(0))return this.curve.jpoint(null,null,null);else return this.dbl();var l=o.redSqr(),c=l.redMul(o),f=r.redMul(l),u=s.redSqr().redIAdd(c).redISub(f).redISub(f),d=s.redMul(f.redISub(u)).redISub(i.redMul(c)),h=this.z.redMul(o);return this.curve.jpoint(u,d,h)},f.prototype.dblp=function(e){if(0===e||this.isInfinity())return this;if(!e)return this.dbl();if(this.curve.zeroA||this.curve.threeA){for(var t=this,r=0;r<e;r++)t=t.dbl();return t}for(var n=this.curve.a,i=this.curve.tinv,a=this.x,o=this.y,s=this.z,l=s.redSqr().redSqr(),c=o.redAdd(o),r=0;r<e;r++){var f=a.redSqr(),u=c.redSqr(),d=u.redSqr(),h=f.redAdd(f).redIAdd(f).redIAdd(n.redMul(l)),p=a.redMul(u),b=h.redSqr().redISub(p.redAdd(p)),m=p.redISub(b),g=h.redMul(m);g=g.redIAdd(g).redISub(d);var y=c.redMul(s);r+1<e&&(l=l.redMul(d)),a=b,s=y,c=g}return this.curve.jpoint(a,c.redMul(i),s)},f.prototype.dbl=function(){return this.isInfinity()?this:this.curve.zeroA?this._zeroDbl():this.curve.threeA?this._threeDbl():this._dbl()},f.prototype._zeroDbl=function(){if(this.zOne){var e,t,r,n=this.x.redSqr(),i=this.y.redSqr(),a=i.redSqr(),o=this.x.redAdd(i).redSqr().redISub(n).redISub(a);o=o.redIAdd(o);var s=n.redAdd(n).redIAdd(n),l=s.redSqr().redISub(o).redISub(o),c=a.redIAdd(a);c=(c=c.redIAdd(c)).redIAdd(c),e=l,t=s.redMul(o.redISub(l)).redISub(c),r=this.y.redAdd(this.y)}else{var f=this.x.redSqr(),u=this.y.redSqr(),d=u.redSqr(),h=this.x.redAdd(u).redSqr().redISub(f).redISub(d);h=h.redIAdd(h);var p=f.redAdd(f).redIAdd(f),b=p.redSqr(),m=d.redIAdd(d);m=(m=m.redIAdd(m)).redIAdd(m),e=b.redISub(h).redISub(h),t=p.redMul(h.redISub(e)).redISub(m),r=(r=this.y.redMul(this.z)).redIAdd(r)}return this.curve.jpoint(e,t,r)},f.prototype._threeDbl=function(){if(this.zOne){var e,t,r,n=this.x.redSqr(),i=this.y.redSqr(),a=i.redSqr(),o=this.x.redAdd(i).redSqr().redISub(n).redISub(a);o=o.redIAdd(o);var s=n.redAdd(n).redIAdd(n).redIAdd(this.curve.a),l=s.redSqr().redISub(o).redISub(o);e=l;var c=a.redIAdd(a);c=(c=c.redIAdd(c)).redIAdd(c),t=s.redMul(o.redISub(l)).redISub(c),r=this.y.redAdd(this.y)}else{var f=this.z.redSqr(),u=this.y.redSqr(),d=this.x.redMul(u),h=this.x.redSub(f).redMul(this.x.redAdd(f));h=h.redAdd(h).redIAdd(h);var p=d.redIAdd(d),b=(p=p.redIAdd(p)).redAdd(p);e=h.redSqr().redISub(b),r=this.y.redAdd(this.z).redSqr().redISub(u).redISub(f);var m=u.redSqr();m=(m=(m=m.redIAdd(m)).redIAdd(m)).redIAdd(m),t=h.redMul(p.redISub(e)).redISub(m)}return this.curve.jpoint(e,t,r)},f.prototype._dbl=function(){var e=this.curve.a,t=this.x,r=this.y,n=this.z,i=n.redSqr().redSqr(),a=t.redSqr(),o=r.redSqr(),s=a.redAdd(a).redIAdd(a).redIAdd(e.redMul(i)),l=t.redAdd(t),c=(l=l.redIAdd(l)).redMul(o),f=s.redSqr().redISub(c.redAdd(c)),u=c.redISub(f),d=o.redSqr();d=(d=(d=d.redIAdd(d)).redIAdd(d)).redIAdd(d);var h=s.redMul(u).redISub(d),p=r.redAdd(r).redMul(n);return this.curve.jpoint(f,h,p)},f.prototype.trpl=function(){if(!this.curve.zeroA)return this.dbl().add(this);var e=this.x.redSqr(),t=this.y.redSqr(),r=this.z.redSqr(),n=t.redSqr(),i=e.redAdd(e).redIAdd(e),a=i.redSqr(),o=this.x.redAdd(t).redSqr().redISub(e).redISub(n),s=(o=(o=(o=o.redIAdd(o)).redAdd(o).redIAdd(o)).redISub(a)).redSqr(),l=n.redIAdd(n);l=(l=(l=l.redIAdd(l)).redIAdd(l)).redIAdd(l);var c=i.redIAdd(o).redSqr().redISub(a).redISub(s).redISub(l),f=t.redMul(c);f=(f=f.redIAdd(f)).redIAdd(f);var u=this.x.redMul(s).redISub(f);u=(u=u.redIAdd(u)).redIAdd(u);var d=this.y.redMul(c.redMul(l.redISub(c)).redISub(o.redMul(s)));d=(d=(d=d.redIAdd(d)).redIAdd(d)).redIAdd(d);var h=this.z.redAdd(o).redSqr().redISub(r).redISub(s);return this.curve.jpoint(u,d,h)},f.prototype.mul=function(e,t){return e=new i(e,t),this.curve._wnafMul(this,e)},f.prototype.eq=function(e){if("affine"===e.type)return this.eq(e.toJ());if(this===e)return!0;var t=this.z.redSqr(),r=e.z.redSqr();if(0!==this.x.redMul(r).redISub(e.x.redMul(t)).cmpn(0))return!1;var n=t.redMul(this.z),i=r.redMul(e.z);return 0===this.y.redMul(i).redISub(e.y.redMul(n)).cmpn(0)},f.prototype.eqXToP=function(e){var t=this.z.redSqr(),r=e.toRed(this.curve.red).redMul(t);if(0===this.x.cmp(r))return!0;for(var n=e.clone(),i=this.curve.redN.redMul(t);;){if(n.iadd(this.curve.n),n.cmp(this.curve.p)>=0)return!1;if(r.redIAdd(i),0===this.x.cmp(r))return!0}},f.prototype.inspect=function(){return this.isInfinity()?"<EC JPoint Infinity>":"<EC JPoint x: "+this.x.toString(16,2)+" y: "+this.y.toString(16,2)+" z: "+this.z.toString(16,2)+">"},f.prototype.isInfinity=function(){return 0===this.z.cmpn(0)}},6226:function(e,t,r){"use strict";var n,i=t,a=r(7028),o=r(9359),s=r(4401).assert;function l(e){"short"===e.type?this.curve=new o.short(e):"edwards"===e.type?this.curve=new o.edwards(e):this.curve=new o.mont(e),this.g=this.curve.g,this.n=this.curve.n,this.hash=e.hash,s(this.g.validate(),"Invalid curve"),s(this.g.mul(this.n).isInfinity(),"Invalid curve, G*N != O")}function c(e,t){Object.defineProperty(i,e,{configurable:!0,enumerable:!0,get:function(){var r=new l(t);return Object.defineProperty(i,e,{configurable:!0,enumerable:!0,value:r}),r}})}i.PresetCurve=l,c("p192",{type:"short",prime:"p192",p:"ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff",a:"ffffffff ffffffff ffffffff fffffffe ffffffff fffffffc",b:"64210519 e59c80e7 0fa7e9ab 72243049 feb8deec c146b9b1",n:"ffffffff ffffffff ffffffff 99def836 146bc9b1 b4d22831",hash:a.sha256,gRed:!1,g:["188da80e b03090f6 7cbf20eb 43a18800 f4ff0afd 82ff1012","07192b95 ffc8da78 631011ed 6b24cdd5 73f977a1 1e794811"]}),c("p224",{type:"short",prime:"p224",p:"ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001",a:"ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff fffffffe",b:"b4050a85 0c04b3ab f5413256 5044b0b7 d7bfd8ba 270b3943 2355ffb4",n:"ffffffff ffffffff ffffffff ffff16a2 e0b8f03e 13dd2945 5c5c2a3d",hash:a.sha256,gRed:!1,g:["b70e0cbd 6bb4bf7f 321390b9 4a03c1d3 56c21122 343280d6 115c1d21","bd376388 b5f723fb 4c22dfe6 cd4375a0 5a074764 44d58199 85007e34"]}),c("p256",{type:"short",prime:null,p:"ffffffff 00000001 00000000 00000000 00000000 ffffffff ffffffff ffffffff",a:"ffffffff 00000001 00000000 00000000 00000000 ffffffff ffffffff fffffffc",b:"5ac635d8 aa3a93e7 b3ebbd55 769886bc 651d06b0 cc53b0f6 3bce3c3e 27d2604b",n:"ffffffff 00000000 ffffffff ffffffff bce6faad a7179e84 f3b9cac2 fc632551",hash:a.sha256,gRed:!1,g:["6b17d1f2 e12c4247 f8bce6e5 63a440f2 77037d81 2deb33a0 f4a13945 d898c296","4fe342e2 fe1a7f9b 8ee7eb4a 7c0f9e16 2bce3357 6b315ece cbb64068 37bf51f5"]}),c("p384",{type:"short",prime:null,p:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe ffffffff 00000000 00000000 ffffffff",a:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe ffffffff 00000000 00000000 fffffffc",b:"b3312fa7 e23ee7e4 988e056b e3f82d19 181d9c6e fe814112 0314088f 5013875a c656398d 8a2ed19d 2a85c8ed d3ec2aef",n:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff c7634d81 f4372ddf 581a0db2 48b0a77a ecec196a ccc52973",hash:a.sha384,gRed:!1,g:["aa87ca22 be8b0537 8eb1c71e f320ad74 6e1d3b62 8ba79b98 59f741e0 82542a38 5502f25d bf55296c 3a545e38 72760ab7","3617de4a 96262c6f 5d9e98bf 9292dc29 f8f41dbd 289a147c e9da3113 b5f0b8c0 0a60b1ce 1d7e819d 7a431d7c 90ea0e5f"]}),c("p521",{type:"short",prime:null,p:"000001ff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff",a:"000001ff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffc",b:"00000051 953eb961 8e1c9a1f 929a21a0 b68540ee a2da725b 99b315f3 b8b48991 8ef109e1 56193951 ec7e937b 1652c0bd 3bb1bf07 3573df88 3d2c34f1 ef451fd4 6b503f00",n:"000001ff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffa 51868783 bf2f966b 7fcc0148 f709a5d0 3bb5c9b8 899c47ae bb6fb71e 91386409",hash:a.sha512,gRed:!1,g:["000000c6 858e06b7 0404e9cd 9e3ecb66 2395b442 9c648139 053fb521 f828af60 6b4d3dba a14b5e77 efe75928 fe1dc127 a2ffa8de 3348b3c1 856a429b f97e7e31 c2e5bd66","00000118 39296a78 9a3bc004 5c8a5fb4 2c7d1bd9 98f54449 579b4468 17afbd17 273e662c 97ee7299 5ef42640 c550b901 3fad0761 353c7086 a272c240 88be9476 9fd16650"]}),c("curve25519",{type:"mont",prime:"p25519",p:"7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed",a:"76d06",b:"1",n:"1000000000000000 0000000000000000 14def9dea2f79cd6 5812631a5cf5d3ed",hash:a.sha256,gRed:!1,g:["9"]}),c("ed25519",{type:"edwards",prime:"p25519",p:"7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed",a:"-1",c:"1",d:"52036cee2b6ffe73 8cc740797779e898 00700a4d4141d8ab 75eb4dca135978a3",n:"1000000000000000 0000000000000000 14def9dea2f79cd6 5812631a5cf5d3ed",hash:a.sha256,gRed:!1,g:["216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a","6666666666666666666666666666666666666666666666666666666666666658"]});try{n=r(9702)}catch(e){n=void 0}c("secp256k1",{type:"short",prime:"k256",p:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f",a:"0",b:"7",n:"ffffffff ffffffff ffffffff fffffffe baaedce6 af48a03b bfd25e8c d0364141",h:"1",hash:a.sha256,beta:"7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee",lambda:"5363ad4cc05c30e0a5261c028812645a122e22ea20816678df02967c1b23bd72",basis:[{a:"3086d221a7d46bcde86c90e49284eb15",b:"-e4437ed6010e88286f547fa90abfe4c3"},{a:"114ca50f7a8e2f3f657c1108d9d44cfd8",b:"3086d221a7d46bcde86c90e49284eb15"}],gRed:!1,g:["79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798","483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8",n]})},4088:function(e,t,r){"use strict";var n=r(711),i=r(4910),a=r(4401),o=r(6226),s=r(3500),l=a.assert,c=r(4724),f=r(7526);function u(e){if(!(this instanceof u))return new u(e);"string"==typeof e&&(l(o.hasOwnProperty(e),"Unknown curve "+e),e=o[e]),e instanceof o.PresetCurve&&(e={curve:e}),this.curve=e.curve.curve,this.n=this.curve.n,this.nh=this.n.ushrn(1),this.g=this.curve.g,this.g=e.curve.g,this.g.precompute(e.curve.n.bitLength()+1),this.hash=e.hash||e.curve.hash}e.exports=u,u.prototype.keyPair=function(e){return new c(this,e)},u.prototype.keyFromPrivate=function(e,t){return c.fromPrivate(this,e,t)},u.prototype.keyFromPublic=function(e,t){return c.fromPublic(this,e,t)},u.prototype.genKeyPair=function(e){e||(e={});for(var t=new i({hash:this.hash,pers:e.pers,persEnc:e.persEnc||"utf8",entropy:e.entropy||s(this.hash.hmacStrength),entropyEnc:e.entropy&&e.entropyEnc||"utf8",nonce:this.n.toArray()}),r=this.n.byteLength(),a=this.n.sub(new n(2));;){var o=new n(t.generate(r));if(!(o.cmp(a)>0))return o.iaddn(1),this.keyFromPrivate(o)}},u.prototype._truncateToN=function(e,t){var r=8*e.byteLength()-this.n.bitLength();return(r>0&&(e=e.ushrn(r)),!t&&e.cmp(this.n)>=0)?e.sub(this.n):e},u.prototype.sign=function(e,t,r,a){"object"==typeof r&&(a=r,r=null),a||(a={}),t=this.keyFromPrivate(t,r),e=this._truncateToN(new n(e,16));for(var o=this.n.byteLength(),s=t.getPrivate().toArray("be",o),l=e.toArray("be",o),c=new i({hash:this.hash,entropy:s,nonce:l,pers:a.pers,persEnc:a.persEnc||"utf8"}),u=this.n.sub(new n(1)),d=0;;d++){var h=a.k?a.k(d):new n(c.generate(this.n.byteLength()));if(0>=(h=this._truncateToN(h,!0)).cmpn(1)||h.cmp(u)>=0)continue;var p=this.g.mul(h);if(!p.isInfinity()){var b=p.getX(),m=b.umod(this.n);if(0!==m.cmpn(0)){var g=h.invm(this.n).mul(m.mul(t.getPrivate()).iadd(e));if(0!==(g=g.umod(this.n)).cmpn(0)){var y=!!p.getY().isOdd()|2*(0!==b.cmp(m));return a.canonical&&g.cmp(this.nh)>0&&(g=this.n.sub(g),y^=1),new f({r:m,s:g,recoveryParam:y})}}}}},u.prototype.verify=function(e,t,r,i){e=this._truncateToN(new n(e,16)),r=this.keyFromPublic(r,i);var a=(t=new f(t,"hex")).r,o=t.s;if(0>a.cmpn(1)||a.cmp(this.n)>=0||0>o.cmpn(1)||o.cmp(this.n)>=0)return!1;var s=o.invm(this.n),l=s.mul(e).umod(this.n),c=s.mul(a).umod(this.n);if(!this.curve._maxwellTrick){var u=this.g.mulAdd(l,r.getPublic(),c);return!u.isInfinity()&&0===u.getX().umod(this.n).cmp(a)}var u=this.g.jmulAdd(l,r.getPublic(),c);return!u.isInfinity()&&u.eqXToP(a)},u.prototype.recoverPubKey=function(e,t,r,i){l((3&r)===r,"The recovery param is more than two bits"),t=new f(t,i);var a=this.n,o=new n(e),s=t.r,c=t.s,u=1&r,d=r>>1;if(s.cmp(this.curve.p.umod(this.curve.n))>=0&&d)throw Error("Unable to find sencond key candinate");s=d?this.curve.pointFromX(s.add(this.curve.n),u):this.curve.pointFromX(s,u);var h=t.r.invm(a),p=a.sub(o).mul(h).umod(a),b=c.mul(h).umod(a);return this.g.mulAdd(p,s,b)},u.prototype.getKeyRecoveryParam=function(e,t,r,n){if(null!==(t=new f(t,n)).recoveryParam)return t.recoveryParam;for(var i,a=0;a<4;a++){try{i=this.recoverPubKey(e,t,a)}catch(e){continue}if(i.eq(r))return a}throw Error("Unable to find valid recovery factor")}},4724:function(e,t,r){"use strict";var n=r(711),i=r(4401).assert;function a(e,t){this.ec=e,this.priv=null,this.pub=null,t.priv&&this._importPrivate(t.priv,t.privEnc),t.pub&&this._importPublic(t.pub,t.pubEnc)}e.exports=a,a.fromPublic=function(e,t,r){return t instanceof a?t:new a(e,{pub:t,pubEnc:r})},a.fromPrivate=function(e,t,r){return t instanceof a?t:new a(e,{priv:t,privEnc:r})},a.prototype.validate=function(){var e=this.getPublic();return e.isInfinity()?{result:!1,reason:"Invalid public key"}:e.validate()?e.mul(this.ec.curve.n).isInfinity()?{result:!0,reason:null}:{result:!1,reason:"Public key * N != O"}:{result:!1,reason:"Public key is not a point"}},a.prototype.getPublic=function(e,t){return("string"==typeof e&&(t=e,e=null),this.pub||(this.pub=this.ec.g.mul(this.priv)),t)?this.pub.encode(t,e):this.pub},a.prototype.getPrivate=function(e){return"hex"===e?this.priv.toString(16,2):this.priv},a.prototype._importPrivate=function(e,t){this.priv=new n(e,t||16),this.priv=this.priv.umod(this.ec.curve.n)},a.prototype._importPublic=function(e,t){if(e.x||e.y){"mont"===this.ec.curve.type?i(e.x,"Need x coordinate"):("short"===this.ec.curve.type||"edwards"===this.ec.curve.type)&&i(e.x&&e.y,"Need both x and y coordinate"),this.pub=this.ec.curve.point(e.x,e.y);return}this.pub=this.ec.curve.decodePoint(e,t)},a.prototype.derive=function(e){return e.mul(this.priv).getX()},a.prototype.sign=function(e,t,r){return this.ec.sign(e,this,t,r)},a.prototype.verify=function(e,t){return this.ec.verify(e,t,this)},a.prototype.inspect=function(){return"<Key priv: "+(this.priv&&this.priv.toString(16,2))+" pub: "+(this.pub&&this.pub.inspect())+" >"}},7526:function(e,t,r){"use strict";var n=r(711),i=r(4401),a=i.assert;function o(e,t){if(e instanceof o)return e;this._importDER(e,t)||(a(e.r&&e.s,"Signature without r or s"),this.r=new n(e.r,16),this.s=new n(e.s,16),void 0===e.recoveryParam?this.recoveryParam=null:this.recoveryParam=e.recoveryParam)}function s(){this.place=0}function l(e,t){var r=e[t.place++];if(!(128&r))return r;var n=15&r;if(0===n||n>4)return!1;for(var i=0,a=0,o=t.place;a<n;a++,o++)i<<=8,i|=e[o],i>>>=0;return!(i<=127)&&(t.place=o,i)}function c(e){for(var t=0,r=e.length-1;!e[t]&&!(128&e[t+1])&&t<r;)t++;return 0===t?e:e.slice(t)}function f(e,t){if(t<128)return void e.push(t);var r=1+(Math.log(t)/Math.LN2>>>3);for(e.push(128|r);--r;)e.push(t>>>(r<<3)&255);e.push(t)}e.exports=o,o.prototype._importDER=function(e,t){e=i.toArray(e,t);var r=new s;if(48!==e[r.place++])return!1;var a=l(e,r);if(!1===a||a+r.place!==e.length||2!==e[r.place++])return!1;var o=l(e,r);if(!1===o)return!1;var c=e.slice(r.place,o+r.place);if(r.place+=o,2!==e[r.place++])return!1;var f=l(e,r);if(!1===f||e.length!==f+r.place)return!1;var u=e.slice(r.place,f+r.place);if(0===c[0])if(!(128&c[1]))return!1;else c=c.slice(1);if(0===u[0])if(!(128&u[1]))return!1;else u=u.slice(1);return this.r=new n(c),this.s=new n(u),this.recoveryParam=null,!0},o.prototype.toDER=function(e){var t=this.r.toArray(),r=this.s.toArray();for(128&t[0]&&(t=[0].concat(t)),128&r[0]&&(r=[0].concat(r)),t=c(t),r=c(r);!r[0]&&!(128&r[1]);)r=r.slice(1);var n=[2];f(n,t.length),(n=n.concat(t)).push(2),f(n,r.length);var a=n.concat(r),o=[48];return f(o,a.length),o=o.concat(a),i.encode(o,e)}},8511:function(e,t,r){"use strict";var n=r(7028),i=r(6226),a=r(4401),o=a.assert,s=a.parseBytes,l=r(9917),c=r(9314);function f(e){if(o("ed25519"===e,"only tested with ed25519 so far"),!(this instanceof f))return new f(e);var e=i[e].curve;this.curve=e,this.g=e.g,this.g.precompute(e.n.bitLength()+1),this.pointClass=e.point().constructor,this.encodingLength=Math.ceil(e.n.bitLength()/8),this.hash=n.sha512}e.exports=f,f.prototype.sign=function(e,t){e=s(e);var r=this.keyFromSecret(t),n=this.hashInt(r.messagePrefix(),e),i=this.g.mul(n),a=this.encodePoint(i),o=this.hashInt(a,r.pubBytes(),e).mul(r.priv()),l=n.add(o).umod(this.curve.n);return this.makeSignature({R:i,S:l,Rencoded:a})},f.prototype.verify=function(e,t,r){e=s(e),t=this.makeSignature(t);var n=this.keyFromPublic(r),i=this.hashInt(t.Rencoded(),n.pubBytes(),e),a=this.g.mul(t.S());return t.R().add(n.pub().mul(i)).eq(a)},f.prototype.hashInt=function(){for(var e=this.hash(),t=0;t<arguments.length;t++)e.update(arguments[t]);return a.intFromLE(e.digest()).umod(this.curve.n)},f.prototype.keyFromPublic=function(e){return l.fromPublic(this,e)},f.prototype.keyFromSecret=function(e){return l.fromSecret(this,e)},f.prototype.makeSignature=function(e){return e instanceof c?e:new c(this,e)},f.prototype.encodePoint=function(e){var t=e.getY().toArray("le",this.encodingLength);return t[this.encodingLength-1]|=128*!!e.getX().isOdd(),t},f.prototype.decodePoint=function(e){var t=(e=a.parseBytes(e)).length-1,r=e.slice(0,t).concat(-129&e[t]),n=(128&e[t])!=0,i=a.intFromLE(r);return this.curve.pointFromY(i,n)},f.prototype.encodeInt=function(e){return e.toArray("le",this.encodingLength)},f.prototype.decodeInt=function(e){return a.intFromLE(e)},f.prototype.isPoint=function(e){return e instanceof this.pointClass}},9917:function(e,t,r){"use strict";var n=r(4401),i=n.assert,a=n.parseBytes,o=n.cachedProperty;function s(e,t){this.eddsa=e,this._secret=a(t.secret),e.isPoint(t.pub)?this._pub=t.pub:this._pubBytes=a(t.pub)}s.fromPublic=function(e,t){return t instanceof s?t:new s(e,{pub:t})},s.fromSecret=function(e,t){return t instanceof s?t:new s(e,{secret:t})},s.prototype.secret=function(){return this._secret},o(s,"pubBytes",function(){return this.eddsa.encodePoint(this.pub())}),o(s,"pub",function(){return this._pubBytes?this.eddsa.decodePoint(this._pubBytes):this.eddsa.g.mul(this.priv())}),o(s,"privBytes",function(){var e=this.eddsa,t=this.hash(),r=e.encodingLength-1,n=t.slice(0,e.encodingLength);return n[0]&=248,n[r]&=127,n[r]|=64,n}),o(s,"priv",function(){return this.eddsa.decodeInt(this.privBytes())}),o(s,"hash",function(){return this.eddsa.hash().update(this.secret()).digest()}),o(s,"messagePrefix",function(){return this.hash().slice(this.eddsa.encodingLength)}),s.prototype.sign=function(e){return i(this._secret,"KeyPair can only verify"),this.eddsa.sign(e,this)},s.prototype.verify=function(e,t){return this.eddsa.verify(e,t,this)},s.prototype.getSecret=function(e){return i(this._secret,"KeyPair is public only"),n.encode(this.secret(),e)},s.prototype.getPublic=function(e){return n.encode(this.pubBytes(),e)},e.exports=s},9314:function(e,t,r){"use strict";var n=r(711),i=r(4401),a=i.assert,o=i.cachedProperty,s=i.parseBytes;function l(e,t){this.eddsa=e,"object"!=typeof t&&(t=s(t)),Array.isArray(t)&&(t={R:t.slice(0,e.encodingLength),S:t.slice(e.encodingLength)}),a(t.R&&t.S,"Signature without R or S"),e.isPoint(t.R)&&(this._R=t.R),t.S instanceof n&&(this._S=t.S),this._Rencoded=Array.isArray(t.R)?t.R:t.Rencoded,this._Sencoded=Array.isArray(t.S)?t.S:t.Sencoded}o(l,"S",function(){return this.eddsa.decodeInt(this.Sencoded())}),o(l,"R",function(){return this.eddsa.decodePoint(this.Rencoded())}),o(l,"Rencoded",function(){return this.eddsa.encodePoint(this.R())}),o(l,"Sencoded",function(){return this.eddsa.encodeInt(this.S())}),l.prototype.toBytes=function(){return this.Rencoded().concat(this.Sencoded())},l.prototype.toHex=function(){return i.encode(this.toBytes(),"hex").toUpperCase()},e.exports=l},9702:function(e){e.exports={doubles:{step:4,points:[["e60fce93b59e9ec53011aabc21c23e97b2a31369b87a5ae9c44ee89e2a6dec0a","f7e3507399e595929db99f34f57937101296891e44d23f0be1f32cce69616821"],["8282263212c609d9ea2a6e3e172de238d8c39cabd5ac1ca10646e23fd5f51508","11f8a8098557dfe45e8256e830b60ace62d613ac2f7b17bed31b6eaff6e26caf"],["175e159f728b865a72f99cc6c6fc846de0b93833fd2222ed73fce5b551e5b739","d3506e0d9e3c79eba4ef97a51ff71f5eacb5955add24345c6efa6ffee9fed695"],["363d90d447b00c9c99ceac05b6262ee053441c7e55552ffe526bad8f83ff4640","4e273adfc732221953b445397f3363145b9a89008199ecb62003c7f3bee9de9"],["8b4b5f165df3c2be8c6244b5b745638843e4a781a15bcd1b69f79a55dffdf80c","4aad0a6f68d308b4b3fbd7813ab0da04f9e336546162ee56b3eff0c65fd4fd36"],["723cbaa6e5db996d6bf771c00bd548c7b700dbffa6c0e77bcb6115925232fcda","96e867b5595cc498a921137488824d6e2660a0653779494801dc069d9eb39f5f"],["eebfa4d493bebf98ba5feec812c2d3b50947961237a919839a533eca0e7dd7fa","5d9a8ca3970ef0f269ee7edaf178089d9ae4cdc3a711f712ddfd4fdae1de8999"],["100f44da696e71672791d0a09b7bde459f1215a29b3c03bfefd7835b39a48db0","cdd9e13192a00b772ec8f3300c090666b7ff4a18ff5195ac0fbd5cd62bc65a09"],["e1031be262c7ed1b1dc9227a4a04c017a77f8d4464f3b3852c8acde6e534fd2d","9d7061928940405e6bb6a4176597535af292dd419e1ced79a44f18f29456a00d"],["feea6cae46d55b530ac2839f143bd7ec5cf8b266a41d6af52d5e688d9094696d","e57c6b6c97dce1bab06e4e12bf3ecd5c981c8957cc41442d3155debf18090088"],["da67a91d91049cdcb367be4be6ffca3cfeed657d808583de33fa978bc1ec6cb1","9bacaa35481642bc41f463f7ec9780e5dec7adc508f740a17e9ea8e27a68be1d"],["53904faa0b334cdda6e000935ef22151ec08d0f7bb11069f57545ccc1a37b7c0","5bc087d0bc80106d88c9eccac20d3c1c13999981e14434699dcb096b022771c8"],["8e7bcd0bd35983a7719cca7764ca906779b53a043a9b8bcaeff959f43ad86047","10b7770b2a3da4b3940310420ca9514579e88e2e47fd68b3ea10047e8460372a"],["385eed34c1cdff21e6d0818689b81bde71a7f4f18397e6690a841e1599c43862","283bebc3e8ea23f56701de19e9ebf4576b304eec2086dc8cc0458fe5542e5453"],["6f9d9b803ecf191637c73a4413dfa180fddf84a5947fbc9c606ed86c3fac3a7","7c80c68e603059ba69b8e2a30e45c4d47ea4dd2f5c281002d86890603a842160"],["3322d401243c4e2582a2147c104d6ecbf774d163db0f5e5313b7e0e742d0e6bd","56e70797e9664ef5bfb019bc4ddaf9b72805f63ea2873af624f3a2e96c28b2a0"],["85672c7d2de0b7da2bd1770d89665868741b3f9af7643397721d74d28134ab83","7c481b9b5b43b2eb6374049bfa62c2e5e77f17fcc5298f44c8e3094f790313a6"],["948bf809b1988a46b06c9f1919413b10f9226c60f668832ffd959af60c82a0a","53a562856dcb6646dc6b74c5d1c3418c6d4dff08c97cd2bed4cb7f88d8c8e589"],["6260ce7f461801c34f067ce0f02873a8f1b0e44dfc69752accecd819f38fd8e8","bc2da82b6fa5b571a7f09049776a1ef7ecd292238051c198c1a84e95b2b4ae17"],["e5037de0afc1d8d43d8348414bbf4103043ec8f575bfdc432953cc8d2037fa2d","4571534baa94d3b5f9f98d09fb990bddbd5f5b03ec481f10e0e5dc841d755bda"],["e06372b0f4a207adf5ea905e8f1771b4e7e8dbd1c6a6c5b725866a0ae4fce725","7a908974bce18cfe12a27bb2ad5a488cd7484a7787104870b27034f94eee31dd"],["213c7a715cd5d45358d0bbf9dc0ce02204b10bdde2a3f58540ad6908d0559754","4b6dad0b5ae462507013ad06245ba190bb4850f5f36a7eeddff2c27534b458f2"],["4e7c272a7af4b34e8dbb9352a5419a87e2838c70adc62cddf0cc3a3b08fbd53c","17749c766c9d0b18e16fd09f6def681b530b9614bff7dd33e0b3941817dcaae6"],["fea74e3dbe778b1b10f238ad61686aa5c76e3db2be43057632427e2840fb27b6","6e0568db9b0b13297cf674deccb6af93126b596b973f7b77701d3db7f23cb96f"],["76e64113f677cf0e10a2570d599968d31544e179b760432952c02a4417bdde39","c90ddf8dee4e95cf577066d70681f0d35e2a33d2b56d2032b4b1752d1901ac01"],["c738c56b03b2abe1e8281baa743f8f9a8f7cc643df26cbee3ab150242bcbb891","893fb578951ad2537f718f2eacbfbbbb82314eef7880cfe917e735d9699a84c3"],["d895626548b65b81e264c7637c972877d1d72e5f3a925014372e9f6588f6c14b","febfaa38f2bc7eae728ec60818c340eb03428d632bb067e179363ed75d7d991f"],["b8da94032a957518eb0f6433571e8761ceffc73693e84edd49150a564f676e03","2804dfa44805a1e4d7c99cc9762808b092cc584d95ff3b511488e4e74efdf6e7"],["e80fea14441fb33a7d8adab9475d7fab2019effb5156a792f1a11778e3c0df5d","eed1de7f638e00771e89768ca3ca94472d155e80af322ea9fcb4291b6ac9ec78"],["a301697bdfcd704313ba48e51d567543f2a182031efd6915ddc07bbcc4e16070","7370f91cfb67e4f5081809fa25d40f9b1735dbf7c0a11a130c0d1a041e177ea1"],["90ad85b389d6b936463f9d0512678de208cc330b11307fffab7ac63e3fb04ed4","e507a3620a38261affdcbd9427222b839aefabe1582894d991d4d48cb6ef150"],["8f68b9d2f63b5f339239c1ad981f162ee88c5678723ea3351b7b444c9ec4c0da","662a9f2dba063986de1d90c2b6be215dbbea2cfe95510bfdf23cbf79501fff82"],["e4f3fb0176af85d65ff99ff9198c36091f48e86503681e3e6686fd5053231e11","1e63633ad0ef4f1c1661a6d0ea02b7286cc7e74ec951d1c9822c38576feb73bc"],["8c00fa9b18ebf331eb961537a45a4266c7034f2f0d4e1d0716fb6eae20eae29e","efa47267fea521a1a9dc343a3736c974c2fadafa81e36c54e7d2a4c66702414b"],["e7a26ce69dd4829f3e10cec0a9e98ed3143d084f308b92c0997fddfc60cb3e41","2a758e300fa7984b471b006a1aafbb18d0a6b2c0420e83e20e8a9421cf2cfd51"],["b6459e0ee3662ec8d23540c223bcbdc571cbcb967d79424f3cf29eb3de6b80ef","67c876d06f3e06de1dadf16e5661db3c4b3ae6d48e35b2ff30bf0b61a71ba45"],["d68a80c8280bb840793234aa118f06231d6f1fc67e73c5a5deda0f5b496943e8","db8ba9fff4b586d00c4b1f9177b0e28b5b0e7b8f7845295a294c84266b133120"],["324aed7df65c804252dc0270907a30b09612aeb973449cea4095980fc28d3d5d","648a365774b61f2ff130c0c35aec1f4f19213b0c7e332843967224af96ab7c84"],["4df9c14919cde61f6d51dfdbe5fee5dceec4143ba8d1ca888e8bd373fd054c96","35ec51092d8728050974c23a1d85d4b5d506cdc288490192ebac06cad10d5d"],["9c3919a84a474870faed8a9c1cc66021523489054d7f0308cbfc99c8ac1f98cd","ddb84f0f4a4ddd57584f044bf260e641905326f76c64c8e6be7e5e03d4fc599d"],["6057170b1dd12fdf8de05f281d8e06bb91e1493a8b91d4cc5a21382120a959e5","9a1af0b26a6a4807add9a2daf71df262465152bc3ee24c65e899be932385a2a8"],["a576df8e23a08411421439a4518da31880cef0fba7d4df12b1a6973eecb94266","40a6bf20e76640b2c92b97afe58cd82c432e10a7f514d9f3ee8be11ae1b28ec8"],["7778a78c28dec3e30a05fe9629de8c38bb30d1f5cf9a3a208f763889be58ad71","34626d9ab5a5b22ff7098e12f2ff580087b38411ff24ac563b513fc1fd9f43ac"],["928955ee637a84463729fd30e7afd2ed5f96274e5ad7e5cb09eda9c06d903ac","c25621003d3f42a827b78a13093a95eeac3d26efa8a8d83fc5180e935bcd091f"],["85d0fef3ec6db109399064f3a0e3b2855645b4a907ad354527aae75163d82751","1f03648413a38c0be29d496e582cf5663e8751e96877331582c237a24eb1f962"],["ff2b0dce97eece97c1c9b6041798b85dfdfb6d8882da20308f5404824526087e","493d13fef524ba188af4c4dc54d07936c7b7ed6fb90e2ceb2c951e01f0c29907"],["827fbbe4b1e880ea9ed2b2e6301b212b57f1ee148cd6dd28780e5e2cf856e241","c60f9c923c727b0b71bef2c67d1d12687ff7a63186903166d605b68baec293ec"],["eaa649f21f51bdbae7be4ae34ce6e5217a58fdce7f47f9aa7f3b58fa2120e2b3","be3279ed5bbbb03ac69a80f89879aa5a01a6b965f13f7e59d47a5305ba5ad93d"],["e4a42d43c5cf169d9391df6decf42ee541b6d8f0c9a137401e23632dda34d24f","4d9f92e716d1c73526fc99ccfb8ad34ce886eedfa8d8e4f13a7f7131deba9414"],["1ec80fef360cbdd954160fadab352b6b92b53576a88fea4947173b9d4300bf19","aeefe93756b5340d2f3a4958a7abbf5e0146e77f6295a07b671cdc1cc107cefd"],["146a778c04670c2f91b00af4680dfa8bce3490717d58ba889ddb5928366642be","b318e0ec3354028add669827f9d4b2870aaa971d2f7e5ed1d0b297483d83efd0"],["fa50c0f61d22e5f07e3acebb1aa07b128d0012209a28b9776d76a8793180eef9","6b84c6922397eba9b72cd2872281a68a5e683293a57a213b38cd8d7d3f4f2811"],["da1d61d0ca721a11b1a5bf6b7d88e8421a288ab5d5bba5220e53d32b5f067ec2","8157f55a7c99306c79c0766161c91e2966a73899d279b48a655fba0f1ad836f1"],["a8e282ff0c9706907215ff98e8fd416615311de0446f1e062a73b0610d064e13","7f97355b8db81c09abfb7f3c5b2515888b679a3e50dd6bd6cef7c73111f4cc0c"],["174a53b9c9a285872d39e56e6913cab15d59b1fa512508c022f382de8319497c","ccc9dc37abfc9c1657b4155f2c47f9e6646b3a1d8cb9854383da13ac079afa73"],["959396981943785c3d3e57edf5018cdbe039e730e4918b3d884fdff09475b7ba","2e7e552888c331dd8ba0386a4b9cd6849c653f64c8709385e9b8abf87524f2fd"],["d2a63a50ae401e56d645a1153b109a8fcca0a43d561fba2dbb51340c9d82b151","e82d86fb6443fcb7565aee58b2948220a70f750af484ca52d4142174dcf89405"],["64587e2335471eb890ee7896d7cfdc866bacbdbd3839317b3436f9b45617e073","d99fcdd5bf6902e2ae96dd6447c299a185b90a39133aeab358299e5e9faf6589"],["8481bde0e4e4d885b3a546d3e549de042f0aa6cea250e7fd358d6c86dd45e458","38ee7b8cba5404dd84a25bf39cecb2ca900a79c42b262e556d64b1b59779057e"],["13464a57a78102aa62b6979ae817f4637ffcfed3c4b1ce30bcd6303f6caf666b","69be159004614580ef7e433453ccb0ca48f300a81d0942e13f495a907f6ecc27"],["bc4a9df5b713fe2e9aef430bcc1dc97a0cd9ccede2f28588cada3a0d2d83f366","d3a81ca6e785c06383937adf4b798caa6e8a9fbfa547b16d758d666581f33c1"],["8c28a97bf8298bc0d23d8c749452a32e694b65e30a9472a3954ab30fe5324caa","40a30463a3305193378fedf31f7cc0eb7ae784f0451cb9459e71dc73cbef9482"],["8ea9666139527a8c1dd94ce4f071fd23c8b350c5a4bb33748c4ba111faccae0","620efabbc8ee2782e24e7c0cfb95c5d735b783be9cf0f8e955af34a30e62b945"],["dd3625faef5ba06074669716bbd3788d89bdde815959968092f76cc4eb9a9787","7a188fa3520e30d461da2501045731ca941461982883395937f68d00c644a573"],["f710d79d9eb962297e4f6232b40e8f7feb2bc63814614d692c12de752408221e","ea98e67232d3b3295d3b535532115ccac8612c721851617526ae47a9c77bfc82"]]},naf:{wnd:7,points:[["f9308a019258c31049344f85f89d5229b531c845836f99b08601f113bce036f9","388f7b0f632de8140fe337e62a37f3566500a99934c2231b6cb9fd7584b8e672"],["2f8bde4d1a07209355b4a7250a5c5128e88b84bddc619ab7cba8d569b240efe4","d8ac222636e5e3d6d4dba9dda6c9c426f788271bab0d6840dca87d3aa6ac62d6"],["5cbdf0646e5db4eaa398f365f2ea7a0e3d419b7e0330e39ce92bddedcac4f9bc","6aebca40ba255960a3178d6d861a54dba813d0b813fde7b5a5082628087264da"],["acd484e2f0c7f65309ad178a9f559abde09796974c57e714c35f110dfc27ccbe","cc338921b0a7d9fd64380971763b61e9add888a4375f8e0f05cc262ac64f9c37"],["774ae7f858a9411e5ef4246b70c65aac5649980be5c17891bbec17895da008cb","d984a032eb6b5e190243dd56d7b7b365372db1e2dff9d6a8301d74c9c953c61b"],["f28773c2d975288bc7d1d205c3748651b075fbc6610e58cddeeddf8f19405aa8","ab0902e8d880a89758212eb65cdaf473a1a06da521fa91f29b5cb52db03ed81"],["d7924d4f7d43ea965a465ae3095ff41131e5946f3c85f79e44adbcf8e27e080e","581e2872a86c72a683842ec228cc6defea40af2bd896d3a5c504dc9ff6a26b58"],["defdea4cdb677750a420fee807eacf21eb9898ae79b9768766e4faa04a2d4a34","4211ab0694635168e997b0ead2a93daeced1f4a04a95c0f6cfb199f69e56eb77"],["2b4ea0a797a443d293ef5cff444f4979f06acfebd7e86d277475656138385b6c","85e89bc037945d93b343083b5a1c86131a01f60c50269763b570c854e5c09b7a"],["352bbf4a4cdd12564f93fa332ce333301d9ad40271f8107181340aef25be59d5","321eb4075348f534d59c18259dda3e1f4a1b3b2e71b1039c67bd3d8bcf81998c"],["2fa2104d6b38d11b0230010559879124e42ab8dfeff5ff29dc9cdadd4ecacc3f","2de1068295dd865b64569335bd5dd80181d70ecfc882648423ba76b532b7d67"],["9248279b09b4d68dab21a9b066edda83263c3d84e09572e269ca0cd7f5453714","73016f7bf234aade5d1aa71bdea2b1ff3fc0de2a887912ffe54a32ce97cb3402"],["daed4f2be3a8bf278e70132fb0beb7522f570e144bf615c07e996d443dee8729","a69dce4a7d6c98e8d4a1aca87ef8d7003f83c230f3afa726ab40e52290be1c55"],["c44d12c7065d812e8acf28d7cbb19f9011ecd9e9fdf281b0e6a3b5e87d22e7db","2119a460ce326cdc76c45926c982fdac0e106e861edf61c5a039063f0e0e6482"],["6a245bf6dc698504c89a20cfded60853152b695336c28063b61c65cbd269e6b4","e022cf42c2bd4a708b3f5126f16a24ad8b33ba48d0423b6efd5e6348100d8a82"],["1697ffa6fd9de627c077e3d2fe541084ce13300b0bec1146f95ae57f0d0bd6a5","b9c398f186806f5d27561506e4557433a2cf15009e498ae7adee9d63d01b2396"],["605bdb019981718b986d0f07e834cb0d9deb8360ffb7f61df982345ef27a7479","2972d2de4f8d20681a78d93ec96fe23c26bfae84fb14db43b01e1e9056b8c49"],["62d14dab4150bf497402fdc45a215e10dcb01c354959b10cfe31c7e9d87ff33d","80fc06bd8cc5b01098088a1950eed0db01aa132967ab472235f5642483b25eaf"],["80c60ad0040f27dade5b4b06c408e56b2c50e9f56b9b8b425e555c2f86308b6f","1c38303f1cc5c30f26e66bad7fe72f70a65eed4cbe7024eb1aa01f56430bd57a"],["7a9375ad6167ad54aa74c6348cc54d344cc5dc9487d847049d5eabb0fa03c8fb","d0e3fa9eca8726909559e0d79269046bdc59ea10c70ce2b02d499ec224dc7f7"],["d528ecd9b696b54c907a9ed045447a79bb408ec39b68df504bb51f459bc3ffc9","eecf41253136e5f99966f21881fd656ebc4345405c520dbc063465b521409933"],["49370a4b5f43412ea25f514e8ecdad05266115e4a7ecb1387231808f8b45963","758f3f41afd6ed428b3081b0512fd62a54c3f3afbb5b6764b653052a12949c9a"],["77f230936ee88cbbd73df930d64702ef881d811e0e1498e2f1c13eb1fc345d74","958ef42a7886b6400a08266e9ba1b37896c95330d97077cbbe8eb3c7671c60d6"],["f2dac991cc4ce4b9ea44887e5c7c0bce58c80074ab9d4dbaeb28531b7739f530","e0dedc9b3b2f8dad4da1f32dec2531df9eb5fbeb0598e4fd1a117dba703a3c37"],["463b3d9f662621fb1b4be8fbbe2520125a216cdfc9dae3debcba4850c690d45b","5ed430d78c296c3543114306dd8622d7c622e27c970a1de31cb377b01af7307e"],["f16f804244e46e2a09232d4aff3b59976b98fac14328a2d1a32496b49998f247","cedabd9b82203f7e13d206fcdf4e33d92a6c53c26e5cce26d6579962c4e31df6"],["caf754272dc84563b0352b7a14311af55d245315ace27c65369e15f7151d41d1","cb474660ef35f5f2a41b643fa5e460575f4fa9b7962232a5c32f908318a04476"],["2600ca4b282cb986f85d0f1709979d8b44a09c07cb86d7c124497bc86f082120","4119b88753c15bd6a693b03fcddbb45d5ac6be74ab5f0ef44b0be9475a7e4b40"],["7635ca72d7e8432c338ec53cd12220bc01c48685e24f7dc8c602a7746998e435","91b649609489d613d1d5e590f78e6d74ecfc061d57048bad9e76f302c5b9c61"],["754e3239f325570cdbbf4a87deee8a66b7f2b33479d468fbc1a50743bf56cc18","673fb86e5bda30fb3cd0ed304ea49a023ee33d0197a695d0c5d98093c536683"],["e3e6bd1071a1e96aff57859c82d570f0330800661d1c952f9fe2694691d9b9e8","59c9e0bba394e76f40c0aa58379a3cb6a5a2283993e90c4167002af4920e37f5"],["186b483d056a033826ae73d88f732985c4ccb1f32ba35f4b4cc47fdcf04aa6eb","3b952d32c67cf77e2e17446e204180ab21fb8090895138b4a4a797f86e80888b"],["df9d70a6b9876ce544c98561f4be4f725442e6d2b737d9c91a8321724ce0963f","55eb2dafd84d6ccd5f862b785dc39d4ab157222720ef9da217b8c45cf2ba2417"],["5edd5cc23c51e87a497ca815d5dce0f8ab52554f849ed8995de64c5f34ce7143","efae9c8dbc14130661e8cec030c89ad0c13c66c0d17a2905cdc706ab7399a868"],["290798c2b6476830da12fe02287e9e777aa3fba1c355b17a722d362f84614fba","e38da76dcd440621988d00bcf79af25d5b29c094db2a23146d003afd41943e7a"],["af3c423a95d9f5b3054754efa150ac39cd29552fe360257362dfdecef4053b45","f98a3fd831eb2b749a93b0e6f35cfb40c8cd5aa667a15581bc2feded498fd9c6"],["766dbb24d134e745cccaa28c99bf274906bb66b26dcf98df8d2fed50d884249a","744b1152eacbe5e38dcc887980da38b897584a65fa06cedd2c924f97cbac5996"],["59dbf46f8c94759ba21277c33784f41645f7b44f6c596a58ce92e666191abe3e","c534ad44175fbc300f4ea6ce648309a042ce739a7919798cd85e216c4a307f6e"],["f13ada95103c4537305e691e74e9a4a8dd647e711a95e73cb62dc6018cfd87b8","e13817b44ee14de663bf4bc808341f326949e21a6a75c2570778419bdaf5733d"],["7754b4fa0e8aced06d4167a2c59cca4cda1869c06ebadfb6488550015a88522c","30e93e864e669d82224b967c3020b8fa8d1e4e350b6cbcc537a48b57841163a2"],["948dcadf5990e048aa3874d46abef9d701858f95de8041d2a6828c99e2262519","e491a42537f6e597d5d28a3224b1bc25df9154efbd2ef1d2cbba2cae5347d57e"],["7962414450c76c1689c7b48f8202ec37fb224cf5ac0bfa1570328a8a3d7c77ab","100b610ec4ffb4760d5c1fc133ef6f6b12507a051f04ac5760afa5b29db83437"],["3514087834964b54b15b160644d915485a16977225b8847bb0dd085137ec47ca","ef0afbb2056205448e1652c48e8127fc6039e77c15c2378b7e7d15a0de293311"],["d3cc30ad6b483e4bc79ce2c9dd8bc54993e947eb8df787b442943d3f7b527eaf","8b378a22d827278d89c5e9be8f9508ae3c2ad46290358630afb34db04eede0a4"],["1624d84780732860ce1c78fcbfefe08b2b29823db913f6493975ba0ff4847610","68651cf9b6da903e0914448c6cd9d4ca896878f5282be4c8cc06e2a404078575"],["733ce80da955a8a26902c95633e62a985192474b5af207da6df7b4fd5fc61cd4","f5435a2bd2badf7d485a4d8b8db9fcce3e1ef8e0201e4578c54673bc1dc5ea1d"],["15d9441254945064cf1a1c33bbd3b49f8966c5092171e699ef258dfab81c045c","d56eb30b69463e7234f5137b73b84177434800bacebfc685fc37bbe9efe4070d"],["a1d0fcf2ec9de675b612136e5ce70d271c21417c9d2b8aaaac138599d0717940","edd77f50bcb5a3cab2e90737309667f2641462a54070f3d519212d39c197a629"],["e22fbe15c0af8ccc5780c0735f84dbe9a790badee8245c06c7ca37331cb36980","a855babad5cd60c88b430a69f53a1a7a38289154964799be43d06d77d31da06"],["311091dd9860e8e20ee13473c1155f5f69635e394704eaa74009452246cfa9b3","66db656f87d1f04fffd1f04788c06830871ec5a64feee685bd80f0b1286d8374"],["34c1fd04d301be89b31c0442d3e6ac24883928b45a9340781867d4232ec2dbdf","9414685e97b1b5954bd46f730174136d57f1ceeb487443dc5321857ba73abee"],["f219ea5d6b54701c1c14de5b557eb42a8d13f3abbcd08affcc2a5e6b049b8d63","4cb95957e83d40b0f73af4544cccf6b1f4b08d3c07b27fb8d8c2962a400766d1"],["d7b8740f74a8fbaab1f683db8f45de26543a5490bca627087236912469a0b448","fa77968128d9c92ee1010f337ad4717eff15db5ed3c049b3411e0315eaa4593b"],["32d31c222f8f6f0ef86f7c98d3a3335ead5bcd32abdd94289fe4d3091aa824bf","5f3032f5892156e39ccd3d7915b9e1da2e6dac9e6f26e961118d14b8462e1661"],["7461f371914ab32671045a155d9831ea8793d77cd59592c4340f86cbc18347b5","8ec0ba238b96bec0cbdddcae0aa442542eee1ff50c986ea6b39847b3cc092ff6"],["ee079adb1df1860074356a25aa38206a6d716b2c3e67453d287698bad7b2b2d6","8dc2412aafe3be5c4c5f37e0ecc5f9f6a446989af04c4e25ebaac479ec1c8c1e"],["16ec93e447ec83f0467b18302ee620f7e65de331874c9dc72bfd8616ba9da6b5","5e4631150e62fb40d0e8c2a7ca5804a39d58186a50e497139626778e25b0674d"],["eaa5f980c245f6f038978290afa70b6bd8855897f98b6aa485b96065d537bd99","f65f5d3e292c2e0819a528391c994624d784869d7e6ea67fb18041024edc07dc"],["78c9407544ac132692ee1910a02439958ae04877151342ea96c4b6b35a49f51","f3e0319169eb9b85d5404795539a5e68fa1fbd583c064d2462b675f194a3ddb4"],["494f4be219a1a77016dcd838431aea0001cdc8ae7a6fc688726578d9702857a5","42242a969283a5f339ba7f075e36ba2af925ce30d767ed6e55f4b031880d562c"],["a598a8030da6d86c6bc7f2f5144ea549d28211ea58faa70ebf4c1e665c1fe9b5","204b5d6f84822c307e4b4a7140737aec23fc63b65b35f86a10026dbd2d864e6b"],["c41916365abb2b5d09192f5f2dbeafec208f020f12570a184dbadc3e58595997","4f14351d0087efa49d245b328984989d5caf9450f34bfc0ed16e96b58fa9913"],["841d6063a586fa475a724604da03bc5b92a2e0d2e0a36acfe4c73a5514742881","73867f59c0659e81904f9a1c7543698e62562d6744c169ce7a36de01a8d6154"],["5e95bb399a6971d376026947f89bde2f282b33810928be4ded112ac4d70e20d5","39f23f366809085beebfc71181313775a99c9aed7d8ba38b161384c746012865"],["36e4641a53948fd476c39f8a99fd974e5ec07564b5315d8bf99471bca0ef2f66","d2424b1b1abe4eb8164227b085c9aa9456ea13493fd563e06fd51cf5694c78fc"],["336581ea7bfbbb290c191a2f507a41cf5643842170e914faeab27c2c579f726","ead12168595fe1be99252129b6e56b3391f7ab1410cd1e0ef3dcdcabd2fda224"],["8ab89816dadfd6b6a1f2634fcf00ec8403781025ed6890c4849742706bd43ede","6fdcef09f2f6d0a044e654aef624136f503d459c3e89845858a47a9129cdd24e"],["1e33f1a746c9c5778133344d9299fcaa20b0938e8acff2544bb40284b8c5fb94","60660257dd11b3aa9c8ed618d24edff2306d320f1d03010e33a7d2057f3b3b6"],["85b7c1dcb3cec1b7ee7f30ded79dd20a0ed1f4cc18cbcfcfa410361fd8f08f31","3d98a9cdd026dd43f39048f25a8847f4fcafad1895d7a633c6fed3c35e999511"],["29df9fbd8d9e46509275f4b125d6d45d7fbe9a3b878a7af872a2800661ac5f51","b4c4fe99c775a606e2d8862179139ffda61dc861c019e55cd2876eb2a27d84b"],["a0b1cae06b0a847a3fea6e671aaf8adfdfe58ca2f768105c8082b2e449fce252","ae434102edde0958ec4b19d917a6a28e6b72da1834aff0e650f049503a296cf2"],["4e8ceafb9b3e9a136dc7ff67e840295b499dfb3b2133e4ba113f2e4c0e121e5","cf2174118c8b6d7a4b48f6d534ce5c79422c086a63460502b827ce62a326683c"],["d24a44e047e19b6f5afb81c7ca2f69080a5076689a010919f42725c2b789a33b","6fb8d5591b466f8fc63db50f1c0f1c69013f996887b8244d2cdec417afea8fa3"],["ea01606a7a6c9cdd249fdfcfacb99584001edd28abbab77b5104e98e8e3b35d4","322af4908c7312b0cfbfe369f7a7b3cdb7d4494bc2823700cfd652188a3ea98d"],["af8addbf2b661c8a6c6328655eb96651252007d8c5ea31be4ad196de8ce2131f","6749e67c029b85f52a034eafd096836b2520818680e26ac8f3dfbcdb71749700"],["e3ae1974566ca06cc516d47e0fb165a674a3dabcfca15e722f0e3450f45889","2aeabe7e4531510116217f07bf4d07300de97e4874f81f533420a72eeb0bd6a4"],["591ee355313d99721cf6993ffed1e3e301993ff3ed258802075ea8ced397e246","b0ea558a113c30bea60fc4775460c7901ff0b053d25ca2bdeee98f1a4be5d196"],["11396d55fda54c49f19aa97318d8da61fa8584e47b084945077cf03255b52984","998c74a8cd45ac01289d5833a7beb4744ff536b01b257be4c5767bea93ea57a4"],["3c5d2a1ba39c5a1790000738c9e0c40b8dcdfd5468754b6405540157e017aa7a","b2284279995a34e2f9d4de7396fc18b80f9b8b9fdd270f6661f79ca4c81bd257"],["cc8704b8a60a0defa3a99a7299f2e9c3fbc395afb04ac078425ef8a1793cc030","bdd46039feed17881d1e0862db347f8cf395b74fc4bcdc4e940b74e3ac1f1b13"],["c533e4f7ea8555aacd9777ac5cad29b97dd4defccc53ee7ea204119b2889b197","6f0a256bc5efdf429a2fb6242f1a43a2d9b925bb4a4b3a26bb8e0f45eb596096"],["c14f8f2ccb27d6f109f6d08d03cc96a69ba8c34eec07bbcf566d48e33da6593","c359d6923bb398f7fd4473e16fe1c28475b740dd098075e6c0e8649113dc3a38"],["a6cbc3046bc6a450bac24789fa17115a4c9739ed75f8f21ce441f72e0b90e6ef","21ae7f4680e889bb130619e2c0f95a360ceb573c70603139862afd617fa9b9f"],["347d6d9a02c48927ebfb86c1359b1caf130a3c0267d11ce6344b39f99d43cc38","60ea7f61a353524d1c987f6ecec92f086d565ab687870cb12689ff1e31c74448"],["da6545d2181db8d983f7dcb375ef5866d47c67b1bf31c8cf855ef7437b72656a","49b96715ab6878a79e78f07ce5680c5d6673051b4935bd897fea824b77dc208a"],["c40747cc9d012cb1a13b8148309c6de7ec25d6945d657146b9d5994b8feb1111","5ca560753be2a12fc6de6caf2cb489565db936156b9514e1bb5e83037e0fa2d4"],["4e42c8ec82c99798ccf3a610be870e78338c7f713348bd34c8203ef4037f3502","7571d74ee5e0fb92a7a8b33a07783341a5492144cc54bcc40a94473693606437"],["3775ab7089bc6af823aba2e1af70b236d251cadb0c86743287522a1b3b0dedea","be52d107bcfa09d8bcb9736a828cfa7fac8db17bf7a76a2c42ad961409018cf7"],["cee31cbf7e34ec379d94fb814d3d775ad954595d1314ba8846959e3e82f74e26","8fd64a14c06b589c26b947ae2bcf6bfa0149ef0be14ed4d80f448a01c43b1c6d"],["b4f9eaea09b6917619f6ea6a4eb5464efddb58fd45b1ebefcdc1a01d08b47986","39e5c9925b5a54b07433a4f18c61726f8bb131c012ca542eb24a8ac07200682a"],["d4263dfc3d2df923a0179a48966d30ce84e2515afc3dccc1b77907792ebcc60e","62dfaf07a0f78feb30e30d6295853ce189e127760ad6cf7fae164e122a208d54"],["48457524820fa65a4f8d35eb6930857c0032acc0a4a2de422233eeda897612c4","25a748ab367979d98733c38a1fa1c2e7dc6cc07db2d60a9ae7a76aaa49bd0f77"],["dfeeef1881101f2cb11644f3a2afdfc2045e19919152923f367a1767c11cceda","ecfb7056cf1de042f9420bab396793c0c390bde74b4bbdff16a83ae09a9a7517"],["6d7ef6b17543f8373c573f44e1f389835d89bcbc6062ced36c82df83b8fae859","cd450ec335438986dfefa10c57fea9bcc521a0959b2d80bbf74b190dca712d10"],["e75605d59102a5a2684500d3b991f2e3f3c88b93225547035af25af66e04541f","f5c54754a8f71ee540b9b48728473e314f729ac5308b06938360990e2bfad125"],["eb98660f4c4dfaa06a2be453d5020bc99a0c2e60abe388457dd43fefb1ed620c","6cb9a8876d9cb8520609af3add26cd20a0a7cd8a9411131ce85f44100099223e"],["13e87b027d8514d35939f2e6892b19922154596941888336dc3563e3b8dba942","fef5a3c68059a6dec5d624114bf1e91aac2b9da568d6abeb2570d55646b8adf1"],["ee163026e9fd6fe017c38f06a5be6fc125424b371ce2708e7bf4491691e5764a","1acb250f255dd61c43d94ccc670d0f58f49ae3fa15b96623e5430da0ad6c62b2"],["b268f5ef9ad51e4d78de3a750c2dc89b1e626d43505867999932e5db33af3d80","5f310d4b3c99b9ebb19f77d41c1dee018cf0d34fd4191614003e945a1216e423"],["ff07f3118a9df035e9fad85eb6c7bfe42b02f01ca99ceea3bf7ffdba93c4750d","438136d603e858a3a5c440c38eccbaddc1d2942114e2eddd4740d098ced1f0d8"],["8d8b9855c7c052a34146fd20ffb658bea4b9f69e0d825ebec16e8c3ce2b526a1","cdb559eedc2d79f926baf44fb84ea4d44bcf50fee51d7ceb30e2e7f463036758"],["52db0b5384dfbf05bfa9d472d7ae26dfe4b851ceca91b1eba54263180da32b63","c3b997d050ee5d423ebaf66a6db9f57b3180c902875679de924b69d84a7b375"],["e62f9490d3d51da6395efd24e80919cc7d0f29c3f3fa48c6fff543becbd43352","6d89ad7ba4876b0b22c2ca280c682862f342c8591f1daf5170e07bfd9ccafa7d"],["7f30ea2476b399b4957509c88f77d0191afa2ff5cb7b14fd6d8e7d65aaab1193","ca5ef7d4b231c94c3b15389a5f6311e9daff7bb67b103e9880ef4bff637acaec"],["5098ff1e1d9f14fb46a210fada6c903fef0fb7b4a1dd1d9ac60a0361800b7a00","9731141d81fc8f8084d37c6e7542006b3ee1b40d60dfe5362a5b132fd17ddc0"],["32b78c7de9ee512a72895be6b9cbefa6e2f3c4ccce445c96b9f2c81e2778ad58","ee1849f513df71e32efc3896ee28260c73bb80547ae2275ba497237794c8753c"],["e2cb74fddc8e9fbcd076eef2a7c72b0ce37d50f08269dfc074b581550547a4f7","d3aa2ed71c9dd2247a62df062736eb0baddea9e36122d2be8641abcb005cc4a4"],["8438447566d4d7bedadc299496ab357426009a35f235cb141be0d99cd10ae3a8","c4e1020916980a4da5d01ac5e6ad330734ef0d7906631c4f2390426b2edd791f"],["4162d488b89402039b584c6fc6c308870587d9c46f660b878ab65c82c711d67e","67163e903236289f776f22c25fb8a3afc1732f2b84b4e95dbda47ae5a0852649"],["3fad3fa84caf0f34f0f89bfd2dcf54fc175d767aec3e50684f3ba4a4bf5f683d","cd1bc7cb6cc407bb2f0ca647c718a730cf71872e7d0d2a53fa20efcdfe61826"],["674f2600a3007a00568c1a7ce05d0816c1fb84bf1370798f1c69532faeb1a86b","299d21f9413f33b3edf43b257004580b70db57da0b182259e09eecc69e0d38a5"],["d32f4da54ade74abb81b815ad1fb3b263d82d6c692714bcff87d29bd5ee9f08f","f9429e738b8e53b968e99016c059707782e14f4535359d582fc416910b3eea87"],["30e4e670435385556e593657135845d36fbb6931f72b08cb1ed954f1e3ce3ff6","462f9bce619898638499350113bbc9b10a878d35da70740dc695a559eb88db7b"],["be2062003c51cc3004682904330e4dee7f3dcd10b01e580bf1971b04d4cad297","62188bc49d61e5428573d48a74e1c655b1c61090905682a0d5558ed72dccb9bc"],["93144423ace3451ed29e0fb9ac2af211cb6e84a601df5993c419859fff5df04a","7c10dfb164c3425f5c71a3f9d7992038f1065224f72bb9d1d902a6d13037b47c"],["b015f8044f5fcbdcf21ca26d6c34fb8197829205c7b7d2a7cb66418c157b112c","ab8c1e086d04e813744a655b2df8d5f83b3cdc6faa3088c1d3aea1454e3a1d5f"],["d5e9e1da649d97d89e4868117a465a3a4f8a18de57a140d36b3f2af341a21b52","4cb04437f391ed73111a13cc1d4dd0db1693465c2240480d8955e8592f27447a"],["d3ae41047dd7ca065dbf8ed77b992439983005cd72e16d6f996a5316d36966bb","bd1aeb21ad22ebb22a10f0303417c6d964f8cdd7df0aca614b10dc14d125ac46"],["463e2763d885f958fc66cdd22800f0a487197d0a82e377b49f80af87c897b065","bfefacdb0e5d0fd7df3a311a94de062b26b80c61fbc97508b79992671ef7ca7f"],["7985fdfd127c0567c6f53ec1bb63ec3158e597c40bfe747c83cddfc910641917","603c12daf3d9862ef2b25fe1de289aed24ed291e0ec6708703a5bd567f32ed03"],["74a1ad6b5f76e39db2dd249410eac7f99e74c59cb83d2d0ed5ff1543da7703e9","cc6157ef18c9c63cd6193d83631bbea0093e0968942e8c33d5737fd790e0db08"],["30682a50703375f602d416664ba19b7fc9bab42c72747463a71d0896b22f6da3","553e04f6b018b4fa6c8f39e7f311d3176290d0e0f19ca73f17714d9977a22ff8"],["9e2158f0d7c0d5f26c3791efefa79597654e7a2b2464f52b1ee6c1347769ef57","712fcdd1b9053f09003a3481fa7762e9ffd7c8ef35a38509e2fbf2629008373"],["176e26989a43c9cfeba4029c202538c28172e566e3c4fce7322857f3be327d66","ed8cc9d04b29eb877d270b4878dc43c19aefd31f4eee09ee7b47834c1fa4b1c3"],["75d46efea3771e6e68abb89a13ad747ecf1892393dfc4f1b7004788c50374da8","9852390a99507679fd0b86fd2b39a868d7efc22151346e1a3ca4726586a6bed8"],["809a20c67d64900ffb698c4c825f6d5f2310fb0451c869345b7319f645605721","9e994980d9917e22b76b061927fa04143d096ccc54963e6a5ebfa5f3f8e286c1"],["1b38903a43f7f114ed4500b4eac7083fdefece1cf29c63528d563446f972c180","4036edc931a60ae889353f77fd53de4a2708b26b6f5da72ad3394119daf408f9"]]}}},4401:function(e,t,r){"use strict";var n=t,i=r(711),a=r(3523),o=r(6545);function s(e){return"string"==typeof e?n.toArray(e,"hex"):e}n.assert=a,n.toArray=o.toArray,n.zero2=o.zero2,n.toHex=o.toHex,n.encode=o.encode,n.getNAF=function(e,t,r){var n=Array(Math.max(e.bitLength(),r)+1);n.fill(0);for(var i=1<<t+1,a=e.clone(),o=0;o<n.length;o++){var s,l=a.andln(i-1);a.isOdd()?(s=l>(i>>1)-1?(i>>1)-l:l,a.isubn(s)):s=0,n[o]=s,a.iushrn(1)}return n},n.getJSF=function(e,t){var r=[[],[]];e=e.clone(),t=t.clone();for(var n=0,i=0;e.cmpn(-n)>0||t.cmpn(-i)>0;){var a,o,s=e.andln(3)+n&3,l=t.andln(3)+i&3;if(3===s&&(s=-1),3===l&&(l=-1),(1&s)==0)a=0;else{var c=e.andln(7)+n&7;a=(3===c||5===c)&&2===l?-s:s}if(r[0].push(a),(1&l)==0)o=0;else{var c=t.andln(7)+i&7;o=(3===c||5===c)&&2===s?-l:l}r[1].push(o),2*n===a+1&&(n=1-n),2*i===o+1&&(i=1-i),e.iushrn(1),t.iushrn(1)}return r},n.cachedProperty=function(e,t,r){var n="_"+t;e.prototype[t]=function(){return void 0!==this[n]?this[n]:this[n]=r.call(this)}},n.parseBytes=s,n.intFromLE=function(e){return new i(e,"hex","le")}},8368:function(e,t,r){var n=r(6911).Buffer,i=r(3533);e.exports=function(e,t,r,a){if(n.isBuffer(e)||(e=n.from(e,"binary")),t&&(n.isBuffer(t)||(t=n.from(t,"binary")),8!==t.length))throw RangeError("salt should be Buffer with 8 byte length");for(var o=r/8,s=n.alloc(o),l=n.alloc(a||0),c=n.alloc(0);o>0||a>0;){var f=new i;f.update(c),f.update(e),t&&f.update(t),c=f.digest();var u=0;if(o>0){var d=s.length-o;u=Math.min(o,c.length),c.copy(s,d,0,u),o-=u}if(u<c.length&&a>0){var h=l.length-a,p=Math.min(a,c.length-u);c.copy(l,h,u,u+p),a-=p}}return c.fill(0),{key:s,iv:l}}},9029:function(e,t,r){"use strict";var n=r(6911).Buffer,i=r(3726).Transform;function a(e,t){if(!n.isBuffer(e)&&"string"!=typeof e)throw TypeError(t+" must be a string or a buffer")}function o(e){i.call(this),this._block=n.allocUnsafe(e),this._blockSize=e,this._blockOffset=0,this._length=[0,0,0,0],this._finalized=!1}r(3782)(o,i),o.prototype._transform=function(e,t,r){var n=null;try{this.update(e,t)}catch(e){n=e}r(n)},o.prototype._flush=function(e){var t=null;try{this.push(this.digest())}catch(e){t=e}e(t)},o.prototype.update=function(e,t){if(a(e,"Data"),this._finalized)throw Error("Digest already called");n.isBuffer(e)||(e=n.from(e,t));for(var r=this._block,i=0;this._blockOffset+e.length-i>=this._blockSize;){for(var o=this._blockOffset;o<this._blockSize;)r[o++]=e[i++];this._update(),this._blockOffset=0}for(;i<e.length;)r[this._blockOffset++]=e[i++];for(var s=0,l=8*e.length;l>0;++s)this._length[s]+=l,(l=this._length[s]/0x100000000|0)>0&&(this._length[s]-=0x100000000*l);return this},o.prototype._update=function(){throw Error("_update is not implemented")},o.prototype.digest=function(e){if(this._finalized)throw Error("Digest already called");this._finalized=!0;var t=this._digest();void 0!==e&&(t=t.toString(e)),this._block.fill(0),this._blockOffset=0;for(var r=0;r<4;++r)this._length[r]=0;return t},o.prototype._digest=function(){throw Error("_digest is not implemented")},e.exports=o},7028:function(e,t,r){var n=t;n.utils=r(263),n.common=r(1330),n.sha=r(301),n.ripemd=r(3079),n.hmac=r(3092),n.sha1=n.sha.sha1,n.sha256=n.sha.sha256,n.sha224=n.sha.sha224,n.sha384=n.sha.sha384,n.sha512=n.sha.sha512,n.ripemd160=n.ripemd.ripemd160},1330:function(e,t,r){"use strict";var n=r(263),i=r(3523);function a(){this.pending=null,this.pendingTotal=0,this.blockSize=this.constructor.blockSize,this.outSize=this.constructor.outSize,this.hmacStrength=this.constructor.hmacStrength,this.padLength=this.constructor.padLength/8,this.endian="big",this._delta8=this.blockSize/8,this._delta32=this.blockSize/32}t.BlockHash=a,a.prototype.update=function(e,t){if(e=n.toArray(e,t),this.pending?this.pending=this.pending.concat(e):this.pending=e,this.pendingTotal+=e.length,this.pending.length>=this._delta8){var r=(e=this.pending).length%this._delta8;this.pending=e.slice(e.length-r,e.length),0===this.pending.length&&(this.pending=null),e=n.join32(e,0,e.length-r,this.endian);for(var i=0;i<e.length;i+=this._delta32)this._update(e,i,i+this._delta32)}return this},a.prototype.digest=function(e){return this.update(this._pad()),i(null===this.pending),this._digest(e)},a.prototype._pad=function(){var e=this.pendingTotal,t=this._delta8,r=t-(e+this.padLength)%t,n=Array(r+this.padLength);n[0]=128;for(var i=1;i<r;i++)n[i]=0;if(e<<=3,"big"===this.endian){for(var a=8;a<this.padLength;a++)n[i++]=0;n[i++]=0,n[i++]=0,n[i++]=0,n[i++]=0,n[i++]=e>>>24&255,n[i++]=e>>>16&255,n[i++]=e>>>8&255,n[i++]=255&e}else for(a=8,n[i++]=255&e,n[i++]=e>>>8&255,n[i++]=e>>>16&255,n[i++]=e>>>24&255,n[i++]=0,n[i++]=0,n[i++]=0,n[i++]=0;a<this.padLength;a++)n[i++]=0;return n}},3092:function(e,t,r){"use strict";var n=r(263),i=r(3523);function a(e,t,r){if(!(this instanceof a))return new a(e,t,r);this.Hash=e,this.blockSize=e.blockSize/8,this.outSize=e.outSize/8,this.inner=null,this.outer=null,this._init(n.toArray(t,r))}e.exports=a,a.prototype._init=function(e){e.length>this.blockSize&&(e=(new this.Hash).update(e).digest()),i(e.length<=this.blockSize);for(var t=e.length;t<this.blockSize;t++)e.push(0);for(t=0;t<e.length;t++)e[t]^=54;for(t=0,this.inner=(new this.Hash).update(e);t<e.length;t++)e[t]^=106;this.outer=(new this.Hash).update(e)},a.prototype.update=function(e,t){return this.inner.update(e,t),this},a.prototype.digest=function(e){return this.outer.update(this.inner.digest()),this.outer.digest(e)}},3079:function(e,t,r){"use strict";var n=r(263),i=r(1330),a=n.rotl32,o=n.sum32,s=n.sum32_3,l=n.sum32_4,c=i.BlockHash;function f(){if(!(this instanceof f))return new f;c.call(this),this.h=[0x67452301,0xefcdab89,0x98badcfe,0x10325476,0xc3d2e1f0],this.endian="little"}function u(e,t,r,n){return e<=15?t^r^n:e<=31?t&r|~t&n:e<=47?(t|~r)^n:e<=63?t&n|r&~n:t^(r|~n)}function d(e){return e<=15?0:e<=31?0x5a827999:e<=47?0x6ed9eba1:e<=63?0x8f1bbcdc:0xa953fd4e}function h(e){return e<=15?0x50a28be6:e<=31?0x5c4dd124:e<=47?0x6d703ef3:0x7a6d76e9*!!(e<=63)}n.inherits(f,c),t.ripemd160=f,f.blockSize=512,f.outSize=160,f.hmacStrength=192,f.padLength=64,f.prototype._update=function(e,t){for(var r=this.h[0],n=this.h[1],i=this.h[2],c=this.h[3],f=this.h[4],y=r,v=n,x=i,w=c,S=f,k=0;k<80;k++){var _=o(a(l(r,u(k,n,i,c),e[p[k]+t],d(k)),m[k]),f);r=f,f=c,c=a(i,10),i=n,n=_,_=o(a(l(y,u(79-k,v,x,w),e[b[k]+t],h(k)),g[k]),S),y=S,S=w,w=a(x,10),x=v,v=_}_=s(this.h[1],i,w),this.h[1]=s(this.h[2],c,S),this.h[2]=s(this.h[3],f,y),this.h[3]=s(this.h[4],r,v),this.h[4]=s(this.h[0],n,x),this.h[0]=_},f.prototype._digest=function(e){return"hex"===e?n.toHex32(this.h,"little"):n.split32(this.h,"little")};var p=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13],b=[5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11],m=[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6],g=[8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]},301:function(e,t,r){"use strict";t.sha1=r(2742),t.sha224=r(7105),t.sha256=r(1525),t.sha384=r(9948),t.sha512=r(1319)},2742:function(e,t,r){"use strict";var n=r(263),i=r(1330),a=r(2975),o=n.rotl32,s=n.sum32,l=n.sum32_5,c=a.ft_1,f=i.BlockHash,u=[0x5a827999,0x6ed9eba1,0x8f1bbcdc,0xca62c1d6];function d(){if(!(this instanceof d))return new d;f.call(this),this.h=[0x67452301,0xefcdab89,0x98badcfe,0x10325476,0xc3d2e1f0],this.W=Array(80)}n.inherits(d,f),e.exports=d,d.blockSize=512,d.outSize=160,d.hmacStrength=80,d.padLength=64,d.prototype._update=function(e,t){for(var r=this.W,n=0;n<16;n++)r[n]=e[t+n];for(;n<r.length;n++)r[n]=o(r[n-3]^r[n-8]^r[n-14]^r[n-16],1);var i=this.h[0],a=this.h[1],f=this.h[2],d=this.h[3],h=this.h[4];for(n=0;n<r.length;n++){var p=~~(n/20),b=l(o(i,5),c(p,a,f,d),h,r[n],u[p]);h=d,d=f,f=o(a,30),a=i,i=b}this.h[0]=s(this.h[0],i),this.h[1]=s(this.h[1],a),this.h[2]=s(this.h[2],f),this.h[3]=s(this.h[3],d),this.h[4]=s(this.h[4],h)},d.prototype._digest=function(e){return"hex"===e?n.toHex32(this.h,"big"):n.split32(this.h,"big")}},7105:function(e,t,r){"use strict";var n=r(263),i=r(1525);function a(){if(!(this instanceof a))return new a;i.call(this),this.h=[0xc1059ed8,0x367cd507,0x3070dd17,0xf70e5939,0xffc00b31,0x68581511,0x64f98fa7,0xbefa4fa4]}n.inherits(a,i),e.exports=a,a.blockSize=512,a.outSize=224,a.hmacStrength=192,a.padLength=64,a.prototype._digest=function(e){return"hex"===e?n.toHex32(this.h.slice(0,7),"big"):n.split32(this.h.slice(0,7),"big")}},1525:function(e,t,r){"use strict";var n=r(263),i=r(1330),a=r(2975),o=r(3523),s=n.sum32,l=n.sum32_4,c=n.sum32_5,f=a.ch32,u=a.maj32,d=a.s0_256,h=a.s1_256,p=a.g0_256,b=a.g1_256,m=i.BlockHash,g=[0x428a2f98,0x71374491,0xb5c0fbcf,0xe9b5dba5,0x3956c25b,0x59f111f1,0x923f82a4,0xab1c5ed5,0xd807aa98,0x12835b01,0x243185be,0x550c7dc3,0x72be5d74,0x80deb1fe,0x9bdc06a7,0xc19bf174,0xe49b69c1,0xefbe4786,0xfc19dc6,0x240ca1cc,0x2de92c6f,0x4a7484aa,0x5cb0a9dc,0x76f988da,0x983e5152,0xa831c66d,0xb00327c8,0xbf597fc7,0xc6e00bf3,0xd5a79147,0x6ca6351,0x14292967,0x27b70a85,0x2e1b2138,0x4d2c6dfc,0x53380d13,0x650a7354,0x766a0abb,0x81c2c92e,0x92722c85,0xa2bfe8a1,0xa81a664b,0xc24b8b70,0xc76c51a3,0xd192e819,0xd6990624,0xf40e3585,0x106aa070,0x19a4c116,0x1e376c08,0x2748774c,0x34b0bcb5,0x391c0cb3,0x4ed8aa4a,0x5b9cca4f,0x682e6ff3,0x748f82ee,0x78a5636f,0x84c87814,0x8cc70208,0x90befffa,0xa4506ceb,0xbef9a3f7,0xc67178f2];function y(){if(!(this instanceof y))return new y;m.call(this),this.h=[0x6a09e667,0xbb67ae85,0x3c6ef372,0xa54ff53a,0x510e527f,0x9b05688c,0x1f83d9ab,0x5be0cd19],this.k=g,this.W=Array(64)}n.inherits(y,m),e.exports=y,y.blockSize=512,y.outSize=256,y.hmacStrength=192,y.padLength=64,y.prototype._update=function(e,t){for(var r=this.W,n=0;n<16;n++)r[n]=e[t+n];for(;n<r.length;n++)r[n]=l(b(r[n-2]),r[n-7],p(r[n-15]),r[n-16]);var i=this.h[0],a=this.h[1],m=this.h[2],g=this.h[3],y=this.h[4],v=this.h[5],x=this.h[6],w=this.h[7];for(o(this.k.length===r.length),n=0;n<r.length;n++){var S=c(w,h(y),f(y,v,x),this.k[n],r[n]),k=s(d(i),u(i,a,m));w=x,x=v,v=y,y=s(g,S),g=m,m=a,a=i,i=s(S,k)}this.h[0]=s(this.h[0],i),this.h[1]=s(this.h[1],a),this.h[2]=s(this.h[2],m),this.h[3]=s(this.h[3],g),this.h[4]=s(this.h[4],y),this.h[5]=s(this.h[5],v),this.h[6]=s(this.h[6],x),this.h[7]=s(this.h[7],w)},y.prototype._digest=function(e){return"hex"===e?n.toHex32(this.h,"big"):n.split32(this.h,"big")}},9948:function(e,t,r){"use strict";var n=r(263),i=r(1319);function a(){if(!(this instanceof a))return new a;i.call(this),this.h=[0xcbbb9d5d,0xc1059ed8,0x629a292a,0x367cd507,0x9159015a,0x3070dd17,0x152fecd8,0xf70e5939,0x67332667,0xffc00b31,0x8eb44a87,0x68581511,0xdb0c2e0d,0x64f98fa7,0x47b5481d,0xbefa4fa4]}n.inherits(a,i),e.exports=a,a.blockSize=1024,a.outSize=384,a.hmacStrength=192,a.padLength=128,a.prototype._digest=function(e){return"hex"===e?n.toHex32(this.h.slice(0,12),"big"):n.split32(this.h.slice(0,12),"big")}},1319:function(e,t,r){"use strict";var n=r(263),i=r(1330),a=r(3523),o=n.rotr64_hi,s=n.rotr64_lo,l=n.shr64_hi,c=n.shr64_lo,f=n.sum64,u=n.sum64_hi,d=n.sum64_lo,h=n.sum64_4_hi,p=n.sum64_4_lo,b=n.sum64_5_hi,m=n.sum64_5_lo,g=i.BlockHash,y=[0x428a2f98,0xd728ae22,0x71374491,0x23ef65cd,0xb5c0fbcf,0xec4d3b2f,0xe9b5dba5,0x8189dbbc,0x3956c25b,0xf348b538,0x59f111f1,0xb605d019,0x923f82a4,0xaf194f9b,0xab1c5ed5,0xda6d8118,0xd807aa98,0xa3030242,0x12835b01,0x45706fbe,0x243185be,0x4ee4b28c,0x550c7dc3,0xd5ffb4e2,0x72be5d74,0xf27b896f,0x80deb1fe,0x3b1696b1,0x9bdc06a7,0x25c71235,0xc19bf174,0xcf692694,0xe49b69c1,0x9ef14ad2,0xefbe4786,0x384f25e3,0xfc19dc6,0x8b8cd5b5,0x240ca1cc,0x77ac9c65,0x2de92c6f,0x592b0275,0x4a7484aa,0x6ea6e483,0x5cb0a9dc,0xbd41fbd4,0x76f988da,0x831153b5,0x983e5152,0xee66dfab,0xa831c66d,0x2db43210,0xb00327c8,0x98fb213f,0xbf597fc7,0xbeef0ee4,0xc6e00bf3,0x3da88fc2,0xd5a79147,0x930aa725,0x6ca6351,0xe003826f,0x14292967,0xa0e6e70,0x27b70a85,0x46d22ffc,0x2e1b2138,0x5c26c926,0x4d2c6dfc,0x5ac42aed,0x53380d13,0x9d95b3df,0x650a7354,0x8baf63de,0x766a0abb,0x3c77b2a8,0x81c2c92e,0x47edaee6,0x92722c85,0x1482353b,0xa2bfe8a1,0x4cf10364,0xa81a664b,0xbc423001,0xc24b8b70,0xd0f89791,0xc76c51a3,0x654be30,0xd192e819,0xd6ef5218,0xd6990624,0x5565a910,0xf40e3585,0x5771202a,0x106aa070,0x32bbd1b8,0x19a4c116,0xb8d2d0c8,0x1e376c08,0x5141ab53,0x2748774c,0xdf8eeb99,0x34b0bcb5,0xe19b48a8,0x391c0cb3,0xc5c95a63,0x4ed8aa4a,0xe3418acb,0x5b9cca4f,0x7763e373,0x682e6ff3,0xd6b2b8a3,0x748f82ee,0x5defb2fc,0x78a5636f,0x43172f60,0x84c87814,0xa1f0ab72,0x8cc70208,0x1a6439ec,0x90befffa,0x23631e28,0xa4506ceb,0xde82bde9,0xbef9a3f7,0xb2c67915,0xc67178f2,0xe372532b,0xca273ece,0xea26619c,0xd186b8c7,0x21c0c207,0xeada7dd6,0xcde0eb1e,0xf57d4f7f,0xee6ed178,0x6f067aa,0x72176fba,0xa637dc5,0xa2c898a6,0x113f9804,0xbef90dae,0x1b710b35,0x131c471b,0x28db77f5,0x23047d84,0x32caab7b,0x40c72493,0x3c9ebe0a,0x15c9bebc,0x431d67c4,0x9c100d4c,0x4cc5d4be,0xcb3e42b6,0x597f299c,0xfc657e2a,0x5fcb6fab,0x3ad6faec,0x6c44198c,0x4a475817];function v(){if(!(this instanceof v))return new v;g.call(this),this.h=[0x6a09e667,0xf3bcc908,0xbb67ae85,0x84caa73b,0x3c6ef372,0xfe94f82b,0xa54ff53a,0x5f1d36f1,0x510e527f,0xade682d1,0x9b05688c,0x2b3e6c1f,0x1f83d9ab,0xfb41bd6b,0x5be0cd19,0x137e2179],this.k=y,this.W=Array(160)}function x(e,t,r,n,i){var a=e&r^~e&i;return a<0&&(a+=0x100000000),a}function w(e,t,r,n,i,a){var o=t&n^~t&a;return o<0&&(o+=0x100000000),o}function S(e,t,r,n,i){var a=e&r^e&i^r&i;return a<0&&(a+=0x100000000),a}function k(e,t,r,n,i,a){var o=t&n^t&a^n&a;return o<0&&(o+=0x100000000),o}function _(e,t){var r=o(e,t,28)^o(t,e,2)^o(t,e,7);return r<0&&(r+=0x100000000),r}function E(e,t){var r=s(e,t,28)^s(t,e,2)^s(t,e,7);return r<0&&(r+=0x100000000),r}function M(e,t){var r=o(e,t,14)^o(e,t,18)^o(t,e,9);return r<0&&(r+=0x100000000),r}function N(e,t){var r=s(e,t,14)^s(e,t,18)^s(t,e,9);return r<0&&(r+=0x100000000),r}function A(e,t){var r=o(e,t,1)^o(e,t,8)^l(e,t,7);return r<0&&(r+=0x100000000),r}function T(e,t){var r=s(e,t,1)^s(e,t,8)^c(e,t,7);return r<0&&(r+=0x100000000),r}function R(e,t){var r=o(e,t,19)^o(t,e,29)^l(e,t,6);return r<0&&(r+=0x100000000),r}function C(e,t){var r=s(e,t,19)^s(t,e,29)^c(e,t,6);return r<0&&(r+=0x100000000),r}n.inherits(v,g),e.exports=v,v.blockSize=1024,v.outSize=512,v.hmacStrength=192,v.padLength=128,v.prototype._prepareBlock=function(e,t){for(var r=this.W,n=0;n<32;n++)r[n]=e[t+n];for(;n<r.length;n+=2){var i=R(r[n-4],r[n-3]),a=C(r[n-4],r[n-3]),o=r[n-14],s=r[n-13],l=A(r[n-30],r[n-29]),c=T(r[n-30],r[n-29]),f=r[n-32],u=r[n-31];r[n]=h(i,a,o,s,l,c,f,u),r[n+1]=p(i,a,o,s,l,c,f,u)}},v.prototype._update=function(e,t){this._prepareBlock(e,t);var r=this.W,n=this.h[0],i=this.h[1],o=this.h[2],s=this.h[3],l=this.h[4],c=this.h[5],h=this.h[6],p=this.h[7],g=this.h[8],y=this.h[9],v=this.h[10],A=this.h[11],T=this.h[12],R=this.h[13],C=this.h[14],j=this.h[15];a(this.k.length===r.length);for(var I=0;I<r.length;I+=2){var L=C,P=j,B=M(g,y),O=N(g,y),D=x(g,y,v,A,T,R),z=w(g,y,v,A,T,R),F=this.k[I],U=this.k[I+1],$=r[I],H=r[I+1],q=b(L,P,B,O,D,z,F,U,$,H),V=m(L,P,B,O,D,z,F,U,$,H);L=_(n,i),P=E(n,i);var W=u(L,P,B=S(n,i,o,s,l,c),O=k(n,i,o,s,l,c)),K=d(L,P,B,O);C=T,j=R,T=v,R=A,v=g,A=y,g=u(h,p,q,V),y=d(p,p,q,V),h=l,p=c,l=o,c=s,o=n,s=i,n=u(q,V,W,K),i=d(q,V,W,K)}f(this.h,0,n,i),f(this.h,2,o,s),f(this.h,4,l,c),f(this.h,6,h,p),f(this.h,8,g,y),f(this.h,10,v,A),f(this.h,12,T,R),f(this.h,14,C,j)},v.prototype._digest=function(e){return"hex"===e?n.toHex32(this.h,"big"):n.split32(this.h,"big")}},2975:function(e,t,r){"use strict";var n=r(263).rotr32;function i(e,t,r){return e&t^~e&r}function a(e,t,r){return e&t^e&r^t&r}function o(e,t,r){return e^t^r}t.ft_1=function(e,t,r,n){return 0===e?i(t,r,n):1===e||3===e?o(t,r,n):2===e?a(t,r,n):void 0},t.ch32=i,t.maj32=a,t.p32=o,t.s0_256=function(e){return n(e,2)^n(e,13)^n(e,22)},t.s1_256=function(e){return n(e,6)^n(e,11)^n(e,25)},t.g0_256=function(e){return n(e,7)^n(e,18)^e>>>3},t.g1_256=function(e){return n(e,17)^n(e,19)^e>>>10}},263:function(e,t,r){"use strict";var n=r(3523);function i(e,t){return(64512&e.charCodeAt(t))==55296&&!(t<0)&&!(t+1>=e.length)&&(64512&e.charCodeAt(t+1))==56320}function a(e){return(e>>>24|e>>>8&65280|e<<8&0xff0000|(255&e)<<24)>>>0}function o(e){return 1===e.length?"0"+e:e}function s(e){if(7===e.length)return"0"+e;if(6===e.length)return"00"+e;if(5===e.length)return"000"+e;if(4===e.length)return"0000"+e;if(3===e.length)return"00000"+e;else if(2===e.length)return"000000"+e;else if(1===e.length)return"0000000"+e;else return e}t.inherits=r(3782),t.toArray=function(e,t){if(Array.isArray(e))return e.slice();if(!e)return[];var r=[];if("string"==typeof e)if(t){if("hex"===t)for((e=e.replace(/[^a-z0-9]+/gi,"")).length%2!=0&&(e="0"+e),a=0;a<e.length;a+=2)r.push(parseInt(e[a]+e[a+1],16))}else for(var n=0,a=0;a<e.length;a++){var o=e.charCodeAt(a);o<128?r[n++]=o:(o<2048?r[n++]=o>>6|192:(i(e,a)?(o=65536+((1023&o)<<10)+(1023&e.charCodeAt(++a)),r[n++]=o>>18|240,r[n++]=o>>12&63|128):r[n++]=o>>12|224,r[n++]=o>>6&63|128),r[n++]=63&o|128)}else for(a=0;a<e.length;a++)r[a]=0|e[a];return r},t.toHex=function(e){for(var t="",r=0;r<e.length;r++)t+=o(e[r].toString(16));return t},t.htonl=a,t.toHex32=function(e,t){for(var r="",n=0;n<e.length;n++){var i=e[n];"little"===t&&(i=a(i)),r+=s(i.toString(16))}return r},t.zero2=o,t.zero8=s,t.join32=function(e,t,r,i){var a,o=r-t;n(o%4==0);for(var s=Array(o/4),l=0,c=t;l<s.length;l++,c+=4)a="big"===i?e[c]<<24|e[c+1]<<16|e[c+2]<<8|e[c+3]:e[c+3]<<24|e[c+2]<<16|e[c+1]<<8|e[c],s[l]=a>>>0;return s},t.split32=function(e,t){for(var r=Array(4*e.length),n=0,i=0;n<e.length;n++,i+=4){var a=e[n];"big"===t?(r[i]=a>>>24,r[i+1]=a>>>16&255,r[i+2]=a>>>8&255,r[i+3]=255&a):(r[i+3]=a>>>24,r[i+2]=a>>>16&255,r[i+1]=a>>>8&255,r[i]=255&a)}return r},t.rotr32=function(e,t){return e>>>t|e<<32-t},t.rotl32=function(e,t){return e<<t|e>>>32-t},t.sum32=function(e,t){return e+t>>>0},t.sum32_3=function(e,t,r){return e+t+r>>>0},t.sum32_4=function(e,t,r,n){return e+t+r+n>>>0},t.sum32_5=function(e,t,r,n,i){return e+t+r+n+i>>>0},t.sum64=function(e,t,r,n){var i=e[t],a=n+e[t+1]>>>0,o=+(a<n)+r+i;e[t]=o>>>0,e[t+1]=a},t.sum64_hi=function(e,t,r,n){return+(t+n>>>0<t)+e+r>>>0},t.sum64_lo=function(e,t,r,n){return t+n>>>0},t.sum64_4_hi=function(e,t,r,n,i,a,o,s){var l,c=t;return e+r+i+o+(l=0+ +((c=c+n>>>0)<t)+ +((c=c+a>>>0)<a)+ +((c=c+s>>>0)<s))>>>0},t.sum64_4_lo=function(e,t,r,n,i,a,o,s){return t+n+a+s>>>0},t.sum64_5_hi=function(e,t,r,n,i,a,o,s,l,c){var f,u=t;return e+r+i+o+l+(f=0+ +((u=u+n>>>0)<t)+ +((u=u+a>>>0)<a)+ +((u=u+s>>>0)<s)+ +((u=u+c>>>0)<c))>>>0},t.sum64_5_lo=function(e,t,r,n,i,a,o,s,l,c){return t+n+a+s+c>>>0},t.rotr64_hi=function(e,t,r){return(t<<32-r|e>>>r)>>>0},t.rotr64_lo=function(e,t,r){return(e<<32-r|t>>>r)>>>0},t.shr64_hi=function(e,t,r){return e>>>r},t.shr64_lo=function(e,t,r){return(e<<32-r|t>>>r)>>>0}},4910:function(e,t,r){"use strict";var n=r(7028),i=r(6545),a=r(3523);function o(e){if(!(this instanceof o))return new o(e);this.hash=e.hash,this.predResist=!!e.predResist,this.outLen=this.hash.outSize,this.minEntropy=e.minEntropy||this.hash.hmacStrength,this._reseed=null,this.reseedInterval=null,this.K=null,this.V=null;var t=i.toArray(e.entropy,e.entropyEnc||"hex"),r=i.toArray(e.nonce,e.nonceEnc||"hex"),n=i.toArray(e.pers,e.persEnc||"hex");a(t.length>=this.minEntropy/8,"Not enough entropy. Minimum is: "+this.minEntropy+" bits"),this._init(t,r,n)}e.exports=o,o.prototype._init=function(e,t,r){var n=e.concat(t).concat(r);this.K=Array(this.outLen/8),this.V=Array(this.outLen/8);for(var i=0;i<this.V.length;i++)this.K[i]=0,this.V[i]=1;this._update(n),this._reseed=1,this.reseedInterval=0x1000000000000},o.prototype._hmac=function(){return new n.hmac(this.hash,this.K)},o.prototype._update=function(e){var t=this._hmac().update(this.V).update([0]);e&&(t=t.update(e)),this.K=t.digest(),this.V=this._hmac().update(this.V).digest(),e&&(this.K=this._hmac().update(this.V).update([1]).update(e).digest(),this.V=this._hmac().update(this.V).digest())},o.prototype.reseed=function(e,t,r,n){"string"!=typeof t&&(n=r,r=t,t=null),e=i.toArray(e,t),r=i.toArray(r,n),a(e.length>=this.minEntropy/8,"Not enough entropy. Minimum is: "+this.minEntropy+" bits"),this._update(e.concat(r||[])),this._reseed=1},o.prototype.generate=function(e,t,r,n){if(this._reseed>this.reseedInterval)throw Error("Reseed is required");"string"!=typeof t&&(n=r,r=t,t=null),r&&(r=i.toArray(r,n||"hex"),this._update(r));for(var a=[];a.length<e;)this.V=this._hmac().update(this.V).digest(),a=a.concat(this.V);var o=a.slice(0,e);return this._update(r),this._reseed++,i.encode(o,t)}},3782:function(e){"function"==typeof Object.create?e.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:e.exports=function(e,t){if(t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}}},3533:function(e,t,r){"use strict";var n=r(3782),i=r(9029),a=r(6911).Buffer,o=Array(16);function s(){i.call(this,64),this._a=0x67452301,this._b=0xefcdab89,this._c=0x98badcfe,this._d=0x10325476}function l(e,t){return e<<t|e>>>32-t}function c(e,t,r,n,i,a,o){return l(e+(t&r|~t&n)+i+a|0,o)+t|0}function f(e,t,r,n,i,a,o){return l(e+(t&n|r&~n)+i+a|0,o)+t|0}function u(e,t,r,n,i,a,o){return l(e+(t^r^n)+i+a|0,o)+t|0}function d(e,t,r,n,i,a,o){return l(e+(r^(t|~n))+i+a|0,o)+t|0}n(s,i),s.prototype._update=function(){for(var e=o,t=0;t<16;++t)e[t]=this._block.readInt32LE(4*t);var r=this._a,n=this._b,i=this._c,a=this._d;r=c(r,n,i,a,e[0],0xd76aa478,7),a=c(a,r,n,i,e[1],0xe8c7b756,12),i=c(i,a,r,n,e[2],0x242070db,17),n=c(n,i,a,r,e[3],0xc1bdceee,22),r=c(r,n,i,a,e[4],0xf57c0faf,7),a=c(a,r,n,i,e[5],0x4787c62a,12),i=c(i,a,r,n,e[6],0xa8304613,17),n=c(n,i,a,r,e[7],0xfd469501,22),r=c(r,n,i,a,e[8],0x698098d8,7),a=c(a,r,n,i,e[9],0x8b44f7af,12),i=c(i,a,r,n,e[10],0xffff5bb1,17),n=c(n,i,a,r,e[11],0x895cd7be,22),r=c(r,n,i,a,e[12],0x6b901122,7),a=c(a,r,n,i,e[13],0xfd987193,12),i=c(i,a,r,n,e[14],0xa679438e,17),n=c(n,i,a,r,e[15],0x49b40821,22),r=f(r,n,i,a,e[1],0xf61e2562,5),a=f(a,r,n,i,e[6],0xc040b340,9),i=f(i,a,r,n,e[11],0x265e5a51,14),n=f(n,i,a,r,e[0],0xe9b6c7aa,20),r=f(r,n,i,a,e[5],0xd62f105d,5),a=f(a,r,n,i,e[10],0x2441453,9),i=f(i,a,r,n,e[15],0xd8a1e681,14),n=f(n,i,a,r,e[4],0xe7d3fbc8,20),r=f(r,n,i,a,e[9],0x21e1cde6,5),a=f(a,r,n,i,e[14],0xc33707d6,9),i=f(i,a,r,n,e[3],0xf4d50d87,14),n=f(n,i,a,r,e[8],0x455a14ed,20),r=f(r,n,i,a,e[13],0xa9e3e905,5),a=f(a,r,n,i,e[2],0xfcefa3f8,9),i=f(i,a,r,n,e[7],0x676f02d9,14),n=f(n,i,a,r,e[12],0x8d2a4c8a,20),r=u(r,n,i,a,e[5],0xfffa3942,4),a=u(a,r,n,i,e[8],0x8771f681,11),i=u(i,a,r,n,e[11],0x6d9d6122,16),n=u(n,i,a,r,e[14],0xfde5380c,23),r=u(r,n,i,a,e[1],0xa4beea44,4),a=u(a,r,n,i,e[4],0x4bdecfa9,11),i=u(i,a,r,n,e[7],0xf6bb4b60,16),n=u(n,i,a,r,e[10],0xbebfbc70,23),r=u(r,n,i,a,e[13],0x289b7ec6,4),a=u(a,r,n,i,e[0],0xeaa127fa,11),i=u(i,a,r,n,e[3],0xd4ef3085,16),n=u(n,i,a,r,e[6],0x4881d05,23),r=u(r,n,i,a,e[9],0xd9d4d039,4),a=u(a,r,n,i,e[12],0xe6db99e5,11),i=u(i,a,r,n,e[15],0x1fa27cf8,16),n=u(n,i,a,r,e[2],0xc4ac5665,23),r=d(r,n,i,a,e[0],0xf4292244,6),a=d(a,r,n,i,e[7],0x432aff97,10),i=d(i,a,r,n,e[14],0xab9423a7,15),n=d(n,i,a,r,e[5],0xfc93a039,21),r=d(r,n,i,a,e[12],0x655b59c3,6),a=d(a,r,n,i,e[3],0x8f0ccc92,10),i=d(i,a,r,n,e[10],0xffeff47d,15),n=d(n,i,a,r,e[1],0x85845dd1,21),r=d(r,n,i,a,e[8],0x6fa87e4f,6),a=d(a,r,n,i,e[15],0xfe2ce6e0,10),i=d(i,a,r,n,e[6],0xa3014314,15),n=d(n,i,a,r,e[13],0x4e0811a1,21),r=d(r,n,i,a,e[4],0xf7537e82,6),a=d(a,r,n,i,e[11],0xbd3af235,10),i=d(i,a,r,n,e[2],0x2ad7d2bb,15),n=d(n,i,a,r,e[9],0xeb86d391,21),this._a=this._a+r|0,this._b=this._b+n|0,this._c=this._c+i|0,this._d=this._d+a|0},s.prototype._digest=function(){this._block[this._blockOffset++]=128,this._blockOffset>56&&(this._block.fill(0,this._blockOffset,64),this._update(),this._blockOffset=0),this._block.fill(0,this._blockOffset,56),this._block.writeUInt32LE(this._length[0],56),this._block.writeUInt32LE(this._length[1],60),this._update();var e=a.allocUnsafe(16);return e.writeInt32LE(this._a,0),e.writeInt32LE(this._b,4),e.writeInt32LE(this._c,8),e.writeInt32LE(this._d,12),e},e.exports=s},1354:function(e,t,r){var n=r(711),i=r(3500);function a(e){this.rand=e||new i.Rand}e.exports=a,a.create=function(e){return new a(e)},a.prototype._randbelow=function(e){var t=Math.ceil(e.bitLength()/8);do var r=new n(this.rand.generate(t));while(r.cmp(e)>=0)return r},a.prototype._randrange=function(e,t){var r=t.sub(e);return e.add(this._randbelow(r))},a.prototype.test=function(e,t,r){var i=e.bitLength(),a=n.mont(e),o=new n(1).toRed(a);t||(t=Math.max(1,i/48|0));for(var s=e.subn(1),l=0;!s.testn(l);l++);for(var c=e.shrn(l),f=s.toRed(a),u=!0;t>0;t--){var d=this._randrange(new n(2),s);r&&r(d);var h=d.toRed(a).redPow(c);if(0!==h.cmp(o)&&0!==h.cmp(f)){for(var p=1;p<l;p++){if(0===(h=h.redSqr()).cmp(o))return!1;if(0===h.cmp(f))break}if(p===l)return!1}}return u},a.prototype.getDivisor=function(e,t){var r=e.bitLength(),i=n.mont(e),a=new n(1).toRed(i);t||(t=Math.max(1,r/48|0));for(var o=e.subn(1),s=0;!o.testn(s);s++);for(var l=e.shrn(s),c=o.toRed(i);t>0;t--){var f=this._randrange(new n(2),o),u=e.gcd(f);if(0!==u.cmpn(1))return u;var d=f.toRed(i).redPow(l);if(0!==d.cmp(a)&&0!==d.cmp(c)){for(var h=1;h<s;h++){if(0===(d=d.redSqr()).cmp(a))return d.fromRed().subn(1).gcd(e);if(0===d.cmp(c))break}if(h===s)return(d=d.redSqr()).fromRed().subn(1).gcd(e)}}return!1}},3523:function(e){function t(e,t){if(!e)throw Error(t||"Assertion failed")}e.exports=t,t.equal=function(e,t,r){if(e!=t)throw Error(r||"Assertion failed: "+e+" != "+t)}},6545:function(e,t){"use strict";var r=t;function n(e){return 1===e.length?"0"+e:e}function i(e){for(var t="",r=0;r<e.length;r++)t+=n(e[r].toString(16));return t}r.toArray=function(e,t){if(Array.isArray(e))return e.slice();if(!e)return[];var r=[];if("string"!=typeof e){for(var n=0;n<e.length;n++)r[n]=0|e[n];return r}if("hex"===t){(e=e.replace(/[^a-z0-9]+/gi,"")).length%2!=0&&(e="0"+e);for(var n=0;n<e.length;n+=2)r.push(parseInt(e[n]+e[n+1],16))}else for(var n=0;n<e.length;n++){var i=e.charCodeAt(n),a=i>>8,o=255&i;a?r.push(a,o):r.push(o)}return r},r.zero2=n,r.toHex=i,r.encode=function(e,t){return"hex"===t?i(e):e}},8687:function(e,t,r){"use strict";var n=r(7160);t.certificate=r(8782),t.RSAPrivateKey=n.define("RSAPrivateKey",function(){this.seq().obj(this.key("version").int(),this.key("modulus").int(),this.key("publicExponent").int(),this.key("privateExponent").int(),this.key("prime1").int(),this.key("prime2").int(),this.key("exponent1").int(),this.key("exponent2").int(),this.key("coefficient").int())}),t.RSAPublicKey=n.define("RSAPublicKey",function(){this.seq().obj(this.key("modulus").int(),this.key("publicExponent").int())}),t.PublicKey=n.define("SubjectPublicKeyInfo",function(){this.seq().obj(this.key("algorithm").use(i),this.key("subjectPublicKey").bitstr())});var i=n.define("AlgorithmIdentifier",function(){this.seq().obj(this.key("algorithm").objid(),this.key("none").null_().optional(),this.key("curve").objid().optional(),this.key("params").seq().obj(this.key("p").int(),this.key("q").int(),this.key("g").int()).optional())});t.PrivateKey=n.define("PrivateKeyInfo",function(){this.seq().obj(this.key("version").int(),this.key("algorithm").use(i),this.key("subjectPrivateKey").octstr())}),t.EncryptedPrivateKey=n.define("EncryptedPrivateKeyInfo",function(){this.seq().obj(this.key("algorithm").seq().obj(this.key("id").objid(),this.key("decrypt").seq().obj(this.key("kde").seq().obj(this.key("id").objid(),this.key("kdeparams").seq().obj(this.key("salt").octstr(),this.key("iters").int())),this.key("cipher").seq().obj(this.key("algo").objid(),this.key("iv").octstr()))),this.key("subjectPrivateKey").octstr())}),t.DSAPrivateKey=n.define("DSAPrivateKey",function(){this.seq().obj(this.key("version").int(),this.key("p").int(),this.key("q").int(),this.key("g").int(),this.key("pub_key").int(),this.key("priv_key").int())}),t.DSAparam=n.define("DSAparam",function(){this.int()}),t.ECPrivateKey=n.define("ECPrivateKey",function(){this.seq().obj(this.key("version").int(),this.key("privateKey").octstr(),this.key("parameters").optional().explicit(0).use(a),this.key("publicKey").optional().explicit(1).bitstr())});var a=n.define("ECParameters",function(){this.choice({namedCurve:this.objid()})});t.signature=n.define("signature",function(){this.seq().obj(this.key("r").int(),this.key("s").int())})},8782:function(e,t,r){"use strict";var n=r(7160),i=n.define("Time",function(){this.choice({utcTime:this.utctime(),generalTime:this.gentime()})}),a=n.define("AttributeTypeValue",function(){this.seq().obj(this.key("type").objid(),this.key("value").any())}),o=n.define("AlgorithmIdentifier",function(){this.seq().obj(this.key("algorithm").objid(),this.key("parameters").optional(),this.key("curve").objid().optional())}),s=n.define("SubjectPublicKeyInfo",function(){this.seq().obj(this.key("algorithm").use(o),this.key("subjectPublicKey").bitstr())}),l=n.define("RelativeDistinguishedName",function(){this.setof(a)}),c=n.define("RDNSequence",function(){this.seqof(l)}),f=n.define("Name",function(){this.choice({rdnSequence:this.use(c)})}),u=n.define("Validity",function(){this.seq().obj(this.key("notBefore").use(i),this.key("notAfter").use(i))}),d=n.define("Extension",function(){this.seq().obj(this.key("extnID").objid(),this.key("critical").bool().def(!1),this.key("extnValue").octstr())}),h=n.define("TBSCertificate",function(){this.seq().obj(this.key("version").explicit(0).int().optional(),this.key("serialNumber").int(),this.key("signature").use(o),this.key("issuer").use(f),this.key("validity").use(u),this.key("subject").use(f),this.key("subjectPublicKeyInfo").use(s),this.key("issuerUniqueID").implicit(1).bitstr().optional(),this.key("subjectUniqueID").implicit(2).bitstr().optional(),this.key("extensions").explicit(3).seqof(d).optional())});e.exports=n.define("X509Certificate",function(){this.seq().obj(this.key("tbsCertificate").use(h),this.key("signatureAlgorithm").use(o),this.key("signatureValue").bitstr())})},6501:function(e,t,r){var n=/Proc-Type: 4,ENCRYPTED[\n\r]+DEK-Info: AES-((?:128)|(?:192)|(?:256))-CBC,([0-9A-H]+)[\n\r]+([0-9A-z\n\r\+\/\=]+)[\n\r]+/m,i=/^-----BEGIN ((?:.*? KEY)|CERTIFICATE)-----/m,a=/^-----BEGIN ((?:.*? KEY)|CERTIFICATE)-----([0-9A-z\n\r\+\/\=]+)-----END \1-----$/m,o=r(8368),s=r(6594),l=r(6911).Buffer;e.exports=function(e,t){var r,c=e.toString(),f=c.match(n);if(f){var u="aes"+f[1],d=l.from(f[2],"hex"),h=l.from(f[3].replace(/[\r\n]/g,""),"base64"),p=o(t,d.slice(0,8),parseInt(f[1],10)).key,b=[],m=s.createDecipheriv(u,p,d);b.push(m.update(h)),b.push(m.final()),r=l.concat(b)}else r=new l(c.match(a)[2].replace(/[\r\n]/g,""),"base64");return{tag:c.match(i)[1],data:r}}},9902:function(e,t,r){var n=r(8687),i=r(2510),a=r(6501),o=r(6594),s=r(4978),l=r(6911).Buffer;function c(e){"object"!=typeof e||l.isBuffer(e)||(t=e.passphrase,e=e.key),"string"==typeof e&&(e=l.from(e));var t,r,i,o=a(e,t),s=o.tag,c=o.data;switch(s){case"CERTIFICATE":i=n.certificate.decode(c,"der").tbsCertificate.subjectPublicKeyInfo;case"PUBLIC KEY":switch(!i&&(i=n.PublicKey.decode(c,"der")),r=i.algorithm.algorithm.join(".")){case"1.2.840.113549.1.1.1":return n.RSAPublicKey.decode(i.subjectPublicKey.data,"der");case"1.2.840.10045.2.1":return i.subjectPrivateKey=i.subjectPublicKey,{type:"ec",data:i};case"1.2.840.10040.4.1":return i.algorithm.params.pub_key=n.DSAparam.decode(i.subjectPublicKey.data,"der"),{type:"dsa",data:i.algorithm.params};default:throw Error("unknown key id "+r)}case"ENCRYPTED PRIVATE KEY":c=f(c=n.EncryptedPrivateKey.decode(c,"der"),t);case"PRIVATE KEY":switch(r=(i=n.PrivateKey.decode(c,"der")).algorithm.algorithm.join(".")){case"1.2.840.113549.1.1.1":return n.RSAPrivateKey.decode(i.subjectPrivateKey,"der");case"1.2.840.10045.2.1":return{curve:i.algorithm.curve,privateKey:n.ECPrivateKey.decode(i.subjectPrivateKey,"der").privateKey};case"1.2.840.10040.4.1":return i.algorithm.params.priv_key=n.DSAparam.decode(i.subjectPrivateKey,"der"),{type:"dsa",params:i.algorithm.params};default:throw Error("unknown key id "+r)}case"RSA PUBLIC KEY":return n.RSAPublicKey.decode(c,"der");case"RSA PRIVATE KEY":return n.RSAPrivateKey.decode(c,"der");case"DSA PRIVATE KEY":return{type:"dsa",params:n.DSAPrivateKey.decode(c,"der")};case"EC PRIVATE KEY":return{curve:(c=n.ECPrivateKey.decode(c,"der")).parameters.value,privateKey:c.privateKey};default:throw Error("unknown key type "+s)}}function f(e,t){var r=e.algorithm.decrypt.kde.kdeparams.salt,n=parseInt(e.algorithm.decrypt.kde.kdeparams.iters.toString(),10),a=i[e.algorithm.decrypt.cipher.algo.join(".")],c=e.algorithm.decrypt.cipher.iv,f=e.subjectPrivateKey,u=parseInt(a.split("-")[1],10)/8,d=s.pbkdf2Sync(t,r,n,u,"sha1"),h=o.createDecipheriv(a,d,c),p=[];return p.push(h.update(f)),p.push(h.final()),l.concat(p)}e.exports=c,c.signature=n.signature},4978:function(e,t,r){var n=r(6113),i=r(5349),a=r(7007),o=r(5407);function s(e,t,r,s,l,c){if(i(r,s),e=o(e,a,"Password"),t=o(t,a,"Salt"),"function"==typeof l&&(c=l,l="sha1"),"function"!=typeof c)throw Error("No callback provided to pbkdf2");return n.pbkdf2(e,t,r,s,l,c)}function l(e,t,r,s,l){return i(r,s),e=o(e,a,"Password"),t=o(t,a,"Salt"),l=l||"sha1",n.pbkdf2Sync(e,t,r,s,l)}n.pbkdf2Sync&&-1!==n.pbkdf2Sync.toString().indexOf("keylen, digest")?(t.pbkdf2Sync=l,t.pbkdf2=s):(t.pbkdf2Sync=r(2127),t.pbkdf2=r(9601))},9601:function(t,r,n){var a,o=n(6911).Buffer,s=n(5349),l=n(7007),c=n(2127),f=n(5407),u=e.g.crypto&&e.g.crypto.subtle,d={sha:"SHA-1","sha-1":"SHA-1",sha1:"SHA-1",sha256:"SHA-256","sha-256":"SHA-256",sha384:"SHA-384","sha-384":"SHA-384","sha-512":"SHA-512",sha512:"SHA-512"},h=[];function p(t){if(e.g.process&&!e.g.process.browser||!u||!u.importKey||!u.deriveBits)return Promise.resolve(!1);if(void 0!==h[t])return h[t];var r=b(a=a||o.alloc(8),a,10,128,t).then(function(){return!0}).catch(function(){return!1});return h[t]=r,r}function b(e,t,r,n,i){return u.importKey("raw",e,{name:"PBKDF2"},!1,["deriveBits"]).then(function(e){return u.deriveBits({name:"PBKDF2",salt:t,iterations:r,hash:{name:i}},e,n<<3)}).then(function(e){return o.from(e)})}function m(e,t){e.then(function(e){i.default.nextTick(function(){t(null,e)})},function(e){i.default.nextTick(function(){t(e)})})}t.exports=function(t,r,n,a,o,u){"function"==typeof o&&(u=o,o=void 0);var h=d[(o=o||"sha1").toLowerCase()];if(!h||"function"!=typeof e.g.Promise)return i.default.nextTick(function(){var e;try{e=c(t,r,n,a,o)}catch(e){return u(e)}u(null,e)});if(s(n,a),t=f(t,l,"Password"),r=f(r,l,"Salt"),"function"!=typeof u)throw Error("No callback provided to pbkdf2");m(p(h).then(function(e){return e?b(t,r,n,a,h):c(t,r,n,a,o)}),u)}},7007:function(e){e.exports="utf-8"},5349:function(e){var t=0x3fffffff;e.exports=function(e,r){if("number"!=typeof e)throw TypeError("Iterations not a number");if(e<0)throw TypeError("Bad iterations");if("number"!=typeof r)throw TypeError("Key length not a number");if(r<0||r>t||r!=r)throw TypeError("Bad key length")}},2127:function(e,t,r){var n={md5:16,sha1:20,sha224:28,sha256:32,sha384:48,sha512:64,rmd160:20,ripemd160:20},i=r(4873),a=r(6911).Buffer,o=r(5349),s=r(7007),l=r(5407);e.exports=function(e,t,r,c,f){o(r,c),e=l(e,s,"Password"),t=l(t,s,"Salt"),f=f||"sha1";var u=a.allocUnsafe(c),d=a.allocUnsafe(t.length+4);t.copy(d,0,0,t.length);for(var h=0,p=n[f],b=Math.ceil(c/p),m=1;m<=b;m++){d.writeUInt32BE(m,t.length);for(var g=i(f,e).update(d).digest(),y=g,v=1;v<r;v++){y=i(f,e).update(y).digest();for(var x=0;x<p;x++)g[x]^=y[x]}g.copy(u,h),h+=p}return u}},5407:function(e,t,r){var n=r(6911).Buffer;e.exports=function(e,t,r){if(n.isBuffer(e))return e;if("string"==typeof e)return n.from(e,t);if(ArrayBuffer.isView(e))return n.from(e.buffer);throw TypeError(r+" must be a string, a Buffer, a typed array or a DataView")}},9783:function(e,t,r){t.publicEncrypt=r(3995),t.privateDecrypt=r(4366),t.privateEncrypt=function(e,r){return t.publicEncrypt(e,r,!0)},t.publicDecrypt=function(e,r){return t.privateDecrypt(e,r,!0)}},5520:function(e,t,r){var n=r(9739),i=r(6911).Buffer;function a(e){var t=i.allocUnsafe(4);return t.writeUInt32BE(e,0),t}e.exports=function(e,t){for(var r,o=i.alloc(0),s=0;o.length<t;)r=a(s++),o=i.concat([o,n("sha1").update(e).update(r).digest()]);return o.slice(0,t)}},4366:function(e,t,r){var n=r(9902),i=r(5520),a=r(6386),o=r(711),s=r(7166),l=r(9739),c=r(1607),f=r(6911).Buffer;function u(e,t){var r=e.modulus.byteLength(),n=l("sha1").update(f.alloc(0)).digest(),o=n.length;if(0!==t[0])throw Error("decryption error");var s=t.slice(1,o+1),c=t.slice(o+1),u=a(s,i(c,o)),d=a(c,i(u,r-o-1));if(h(n,d.slice(0,o)))throw Error("decryption error");for(var p=o;0===d[p];)p++;if(1!==d[p++])throw Error("decryption error");return d.slice(p)}function d(e,t,r){for(var n=t.slice(0,2),i=2,a=0;0!==t[i++];)if(i>=t.length){a++;break}var o=t.slice(2,i-1);if(("0002"!==n.toString("hex")&&!r||"0001"!==n.toString("hex")&&r)&&a++,o.length<8&&a++,a)throw Error("decryption error");return t.slice(i)}function h(e,t){e=f.from(e),t=f.from(t);var r=0,n=e.length;e.length!==t.length&&(r++,n=Math.min(e.length,t.length));for(var i=-1;++i<n;)r+=e[i]^t[i];return r}e.exports=function(e,t,r){var i,a=e.padding?e.padding:r?1:4,l=n(e),h=l.modulus.byteLength();if(t.length>h||new o(t).cmp(l.modulus)>=0)throw Error("decryption error");i=r?c(new o(t),l):s(t,l);var p=f.alloc(h-i.length);if(i=f.concat([p,i],h),4===a)return u(l,i);if(1===a)return d(l,i,r);if(3===a)return i;throw Error("unknown padding")}},3995:function(e,t,r){var n=r(9902),i=r(7223),a=r(9739),o=r(5520),s=r(6386),l=r(711),c=r(1607),f=r(7166),u=r(6911).Buffer;function d(e,t){var r=e.modulus.byteLength(),n=t.length,c=a("sha1").update(u.alloc(0)).digest(),f=c.length,d=2*f;if(n>r-d-2)throw Error("message too long");var h=u.alloc(r-n-d-2),p=r-f-1,b=i(f),m=s(u.concat([c,h,u.alloc(1,1),t],p),o(b,p)),g=s(b,o(m,f));return new l(u.concat([u.alloc(1),g,m],r))}function h(e,t,r){var n,i=t.length,a=e.modulus.byteLength();if(i>a-11)throw Error("message too long");return n=r?u.alloc(a-i-3,255):p(a-i-3),new l(u.concat([u.from([0,r?1:2]),n,u.alloc(1),t],a))}function p(e){for(var t,r=u.allocUnsafe(e),n=0,a=i(2*e),o=0;n<e;)o===a.length&&(a=i(2*e),o=0),(t=a[o++])&&(r[n++]=t);return r}e.exports=function(e,t,r){var i,a=e.padding?e.padding:r?1:4,o=n(e);if(4===a)i=d(o,t);else if(1===a)i=h(o,t,r);else if(3===a){if((i=new l(t)).cmp(o.modulus)>=0)throw Error("data too long for modulus")}else throw Error("unknown padding");return r?f(i,o):c(i,o)}},1607:function(e,t,r){var n=r(711),i=r(6911).Buffer;e.exports=function(e,t){return i.from(e.toRed(n.mont(t.modulus)).redPow(new n(t.publicExponent)).fromRed().toArray())}},6386:function(e){e.exports=function(e,t){for(var r=e.length,n=-1;++n<r;)e[n]^=t[n];return e}},7223:function(t,r,n){"use strict";var a=65536,o=0xffffffff;function s(){throw Error("Secure random number generation is not supported by this browser.\nUse Chrome, Firefox or Internet Explorer 11")}var l=n(6911).Buffer,c=e.g.crypto||e.g.msCrypto;function f(e,t){if(e>o)throw RangeError("requested too many random bytes");var r=l.allocUnsafe(e);if(e>0)if(e>a)for(var n=0;n<e;n+=a)c.getRandomValues(r.slice(n,n+a));else c.getRandomValues(r);return"function"==typeof t?i.default.nextTick(function(){t(null,r)}):r}c&&c.getRandomValues?t.exports=f:t.exports=s},6445:function(t,r,n){"use strict";function a(){throw Error("secure random number generation not supported by this browser\nuse chrome, FireFox or Internet Explorer 11")}var o=n(6911);n(7223);var s=o.Buffer,l=o.kMaxLength,c=e.g.crypto||e.g.msCrypto,f=0xffffffff;function u(e,t){if("number"!=typeof e||e!=e)throw TypeError("offset must be a number");if(e>f||e<0)throw TypeError("offset must be a uint32");if(e>l||e>t)throw RangeError("offset out of range")}function d(e,t,r){if("number"!=typeof e||e!=e)throw TypeError("size must be a number");if(e>f||e<0)throw TypeError("size must be a uint32");if(e+t>r||e>l)throw RangeError("buffer too small")}function h(t,r,n,i){if(!s.isBuffer(t)&&!(t instanceof e.g.Uint8Array))throw TypeError('"buf" argument must be a Buffer or Uint8Array');if("function"==typeof r)i=r,r=0,n=t.length;else if("function"==typeof n)i=n,n=t.length-r;else if("function"!=typeof i)throw TypeError('"cb" argument must be a function');return u(r,t.length),d(n,r,t.length),p(t,r,n,i)}function p(e,t,r,n){var a=new Uint8Array(e.buffer,t,r);return(c.getRandomValues(a),n)?void i.default.nextTick(function(){n(null,e)}):e}function b(t,r,n){if(void 0===r&&(r=0),!s.isBuffer(t)&&!(t instanceof e.g.Uint8Array))throw TypeError('"buf" argument must be a Buffer or Uint8Array');return u(r,t.length),void 0===n&&(n=t.length-r),d(n,r,t.length),p(t,r,n)}c&&c.getRandomValues?(r.randomFill=h,r.randomFillSync=b):(r.randomFill=a,r.randomFillSync=a)},4646:function(e){"use strict";let t={};function r(e,r,n){function i(e,t,n){return"string"==typeof r?r:r(e,t,n)}n||(n=Error);class a extends n{constructor(e,t,r){super(i(e,t,r))}}a.prototype.name=n.name,a.prototype.code=e,t[e]=a}function n(e,t){if(!Array.isArray(e))return`of ${t} ${String(e)}`;{let r=e.length;return(e=e.map(e=>String(e)),r>2)?`one of ${t} ${e.slice(0,r-1).join(", ")}, or `+e[r-1]:2===r?`one of ${t} ${e[0]} or ${e[1]}`:`of ${t} ${e[0]}`}}function i(e,t,r){return e.substr(!r||r<0?0:+r,t.length)===t}function a(e,t,r){return(void 0===r||r>e.length)&&(r=e.length),e.substring(r-t.length,r)===t}function o(e,t,r){return"number"!=typeof r&&(r=0),!(r+t.length>e.length)&&-1!==e.indexOf(t,r)}r("ERR_INVALID_OPT_VALUE",function(e,t){return'The value "'+t+'" is invalid for option "'+e+'"'},TypeError),r("ERR_INVALID_ARG_TYPE",function(e,t,r){let s,l;if("string"==typeof t&&i(t,"not ")?(s="must not be",t=t.replace(/^not /,"")):s="must be",a(e," argument"))l=`The ${e} ${s} ${n(t,"type")}`;else{let r=o(e,".")?"property":"argument";l=`The "${e}" ${r} ${s} ${n(t,"type")}`}return l+`. Received type ${typeof r}`},TypeError),r("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF"),r("ERR_METHOD_NOT_IMPLEMENTED",function(e){return"The "+e+" method is not implemented"}),r("ERR_STREAM_PREMATURE_CLOSE","Premature close"),r("ERR_STREAM_DESTROYED",function(e){return"Cannot call "+e+" after a stream was destroyed"}),r("ERR_MULTIPLE_CALLBACK","Callback called multiple times"),r("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable"),r("ERR_STREAM_WRITE_AFTER_END","write after end"),r("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),r("ERR_UNKNOWN_ENCODING",function(e){return"Unknown encoding: "+e},TypeError),r("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event"),e.exports.q=t},2403:function(e,t,r){"use strict";var n=Object.keys||function(e){var t=[];for(var r in e)t.push(r);return t};e.exports=f;var a=r(1709),o=r(7337);r(3782)(f,a);for(var s=n(o.prototype),l=0;l<s.length;l++){var c=s[l];f.prototype[c]||(f.prototype[c]=o.prototype[c])}function f(e){if(!(this instanceof f))return new f(e);a.call(this,e),o.call(this,e),this.allowHalfOpen=!0,e&&(!1===e.readable&&(this.readable=!1),!1===e.writable&&(this.writable=!1),!1===e.allowHalfOpen&&(this.allowHalfOpen=!1,this.once("end",u)))}function u(){this._writableState.ended||i.default.nextTick(d,this)}function d(e){e.end()}Object.defineProperty(f.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(f.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(f.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(f.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&this._readableState.destroyed&&this._writableState.destroyed},set:function(e){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=e,this._writableState.destroyed=e)}})},7889:function(e,t,r){"use strict";e.exports=i;var n=r(1170);function i(e){if(!(this instanceof i))return new i(e);n.call(this,e)}r(3782)(i,n),i.prototype._transform=function(e,t,r){r(null,e)}},1709:function(t,r,n){"use strict";t.exports=T,T.ReadableState=A,n(2361).EventEmitter;var a,o,s,l,c,f=function(e,t){return e.listeners(t).length},u=n(4678),d=n(4300).Buffer,h=e.g.Uint8Array||function(){};function p(e){return d.from(e)}function b(e){return d.isBuffer(e)||e instanceof h}var m=n(3837);o=m&&m.debuglog?m.debuglog("stream"):function(){};var g=n(4379),y=n(7025),v=n(6776).getHighWaterMark,x=n(4646).q,w=x.ERR_INVALID_ARG_TYPE,S=x.ERR_STREAM_PUSH_AFTER_EOF,k=x.ERR_METHOD_NOT_IMPLEMENTED,_=x.ERR_STREAM_UNSHIFT_AFTER_END_EVENT;n(3782)(T,u);var E=y.errorOrDestroy,M=["error","close","destroy","pause","resume"];function N(e,t,r){if("function"==typeof e.prependListener)return e.prependListener(t,r);e._events&&e._events[t]?Array.isArray(e._events[t])?e._events[t].unshift(r):e._events[t]=[r,e._events[t]]:e.on(t,r)}function A(e,t,r){a=a||n(2403),e=e||{},"boolean"!=typeof r&&(r=t instanceof a),this.objectMode=!!e.objectMode,r&&(this.objectMode=this.objectMode||!!e.readableObjectMode),this.highWaterMark=v(this,e,"readableHighWaterMark",r),this.buffer=new g,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=!1!==e.emitClose,this.autoDestroy=!!e.autoDestroy,this.destroyed=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(s||(s=n(3704).s),this.decoder=new s(e.encoding),this.encoding=e.encoding)}function T(e){if(a=a||n(2403),!(this instanceof T))return new T(e);var t=this instanceof a;this._readableState=new A(e,this,t),this.readable=!0,e&&("function"==typeof e.read&&(this._read=e.read),"function"==typeof e.destroy&&(this._destroy=e.destroy)),u.call(this)}function R(e,t,r,n,i){o("readableAddChunk",t);var a,s=e._readableState;if(null===t)s.reading=!1,B(e,s);else if(i||(a=j(s,t)),a)E(e,a);else if(s.objectMode||t&&t.length>0)if("string"==typeof t||s.objectMode||Object.getPrototypeOf(t)===d.prototype||(t=p(t)),n)s.endEmitted?E(e,new _):C(e,s,t,!0);else if(s.ended)E(e,new S);else{if(s.destroyed)return!1;s.reading=!1,s.decoder&&!r?(t=s.decoder.write(t),s.objectMode||0!==t.length?C(e,s,t,!1):z(e,s)):C(e,s,t,!1)}else n||(s.reading=!1,z(e,s));return!s.ended&&(s.length<s.highWaterMark||0===s.length)}function C(e,t,r,n){t.flowing&&0===t.length&&!t.sync?(t.awaitDrain=0,e.emit("data",r)):(t.length+=t.objectMode?1:r.length,n?t.buffer.unshift(r):t.buffer.push(r),t.needReadable&&O(e)),z(e,t)}function j(e,t){var r;return b(t)||"string"==typeof t||void 0===t||e.objectMode||(r=new w("chunk",["string","Buffer","Uint8Array"],t)),r}Object.defineProperty(T.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),T.prototype.destroy=y.destroy,T.prototype._undestroy=y.undestroy,T.prototype._destroy=function(e,t){t(e)},T.prototype.push=function(e,t){var r,n=this._readableState;return n.objectMode?r=!0:"string"==typeof e&&((t=t||n.defaultEncoding)!==n.encoding&&(e=d.from(e,t),t=""),r=!0),R(this,e,t,!1,r)},T.prototype.unshift=function(e){return R(this,e,null,!0,!1)},T.prototype.isPaused=function(){return!1===this._readableState.flowing},T.prototype.setEncoding=function(e){s||(s=n(3704).s);var t=new s(e);this._readableState.decoder=t,this._readableState.encoding=this._readableState.decoder.encoding;for(var r=this._readableState.buffer.head,i="";null!==r;)i+=t.write(r.data),r=r.next;return this._readableState.buffer.clear(),""!==i&&this._readableState.buffer.push(i),this._readableState.length=i.length,this};var I=0x40000000;function L(e){return e>=I?e=I:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}function P(e,t){if(e<=0||0===t.length&&t.ended)return 0;if(t.objectMode)return 1;if(e!=e)if(t.flowing&&t.length)return t.buffer.head.data.length;else return t.length;return(e>t.highWaterMark&&(t.highWaterMark=L(e)),e<=t.length)?e:t.ended?t.length:(t.needReadable=!0,0)}function B(e,t){if(o("onEofChunk"),!t.ended){if(t.decoder){var r=t.decoder.end();r&&r.length&&(t.buffer.push(r),t.length+=t.objectMode?1:r.length)}t.ended=!0,t.sync?O(e):(t.needReadable=!1,t.emittedReadable||(t.emittedReadable=!0,D(e)))}}function O(e){var t=e._readableState;o("emitReadable",t.needReadable,t.emittedReadable),t.needReadable=!1,t.emittedReadable||(o("emitReadable",t.flowing),t.emittedReadable=!0,i.default.nextTick(D,e))}function D(e){var t=e._readableState;o("emitReadable_",t.destroyed,t.length,t.ended),!t.destroyed&&(t.length||t.ended)&&(e.emit("readable"),t.emittedReadable=!1),t.needReadable=!t.flowing&&!t.ended&&t.length<=t.highWaterMark,W(e)}function z(e,t){t.readingMore||(t.readingMore=!0,i.default.nextTick(F,e,t))}function F(e,t){for(;!t.reading&&!t.ended&&(t.length<t.highWaterMark||t.flowing&&0===t.length);){var r=t.length;if(o("maybeReadMore read 0"),e.read(0),r===t.length)break}t.readingMore=!1}function U(e){return function(){var t=e._readableState;o("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&f(e,"data")&&(t.flowing=!0,W(e))}}function $(e){var t=e._readableState;t.readableListening=e.listenerCount("readable")>0,t.resumeScheduled&&!t.paused?t.flowing=!0:e.listenerCount("data")>0&&e.resume()}function H(e){o("readable nexttick read 0"),e.read(0)}function q(e,t){t.resumeScheduled||(t.resumeScheduled=!0,i.default.nextTick(V,e,t))}function V(e,t){o("resume",t.reading),t.reading||e.read(0),t.resumeScheduled=!1,e.emit("resume"),W(e),t.flowing&&!t.reading&&e.read(0)}function W(e){var t=e._readableState;for(o("flow",t.flowing);t.flowing&&null!==e.read(););}function K(e,t){var r;return 0===t.length?null:(t.objectMode?r=t.buffer.shift():!e||e>=t.length?(r=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.first():t.buffer.concat(t.length),t.buffer.clear()):r=t.buffer.consume(e,t.decoder),r)}function G(e){var t=e._readableState;o("endReadable",t.endEmitted),t.endEmitted||(t.ended=!0,i.default.nextTick(X,t,e))}function X(e,t){if(o("endReadableNT",e.endEmitted,e.length),!e.endEmitted&&0===e.length&&(e.endEmitted=!0,t.readable=!1,t.emit("end"),e.autoDestroy)){var r=t._writableState;(!r||r.autoDestroy&&r.finished)&&t.destroy()}}function Y(e,t){for(var r=0,n=e.length;r<n;r++)if(e[r]===t)return r;return -1}T.prototype.read=function(e){o("read",e),e=parseInt(e,10);var t,r=this._readableState,n=e;if(0!==e&&(r.emittedReadable=!1),0===e&&r.needReadable&&((0!==r.highWaterMark?r.length>=r.highWaterMark:r.length>0)||r.ended))return o("read: emitReadable",r.length,r.ended),0===r.length&&r.ended?G(this):O(this),null;if(0===(e=P(e,r))&&r.ended)return 0===r.length&&G(this),null;var i=r.needReadable;return o("need readable",i),(0===r.length||r.length-e<r.highWaterMark)&&o("length less than watermark",i=!0),r.ended||r.reading?o("reading or ended",i=!1):i&&(o("do read"),r.reading=!0,r.sync=!0,0===r.length&&(r.needReadable=!0),this._read(r.highWaterMark),r.sync=!1,r.reading||(e=P(n,r))),null===(t=e>0?K(e,r):null)?(r.needReadable=r.length<=r.highWaterMark,e=0):(r.length-=e,r.awaitDrain=0),0===r.length&&(r.ended||(r.needReadable=!0),n!==e&&r.ended&&G(this)),null!==t&&this.emit("data",t),t},T.prototype._read=function(e){E(this,new k("_read()"))},T.prototype.pipe=function(e,t){var r=this,n=this._readableState;switch(n.pipesCount){case 0:n.pipes=e;break;case 1:n.pipes=[n.pipes,e];break;default:n.pipes.push(e)}n.pipesCount+=1,o("pipe count=%d opts=%j",n.pipesCount,t);var a=t&&!1===t.end||e===i.default.stdout||e===i.default.stderr?g:l;function s(e,t){o("onunpipe"),e===r&&t&&!1===t.hasUnpiped&&(t.hasUnpiped=!0,d())}function l(){o("onend"),e.end()}n.endEmitted?i.default.nextTick(a):r.once("end",a),e.on("unpipe",s);var c=U(r);e.on("drain",c);var u=!1;function d(){o("cleanup"),e.removeListener("close",b),e.removeListener("finish",m),e.removeListener("drain",c),e.removeListener("error",p),e.removeListener("unpipe",s),r.removeListener("end",l),r.removeListener("end",g),r.removeListener("data",h),u=!0,n.awaitDrain&&(!e._writableState||e._writableState.needDrain)&&c()}function h(t){o("ondata");var i=e.write(t);o("dest.write",i),!1===i&&((1===n.pipesCount&&n.pipes===e||n.pipesCount>1&&-1!==Y(n.pipes,e))&&!u&&(o("false write response, pause",n.awaitDrain),n.awaitDrain++),r.pause())}function p(t){o("onerror",t),g(),e.removeListener("error",p),0===f(e,"error")&&E(e,t)}function b(){e.removeListener("finish",m),g()}function m(){o("onfinish"),e.removeListener("close",b),g()}function g(){o("unpipe"),r.unpipe(e)}return r.on("data",h),N(e,"error",p),e.once("close",b),e.once("finish",m),e.emit("pipe",r),n.flowing||(o("pipe resume"),r.resume()),e},T.prototype.unpipe=function(e){var t=this._readableState,r={hasUnpiped:!1};if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes||(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,r)),this;if(!e){var n=t.pipes,i=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var a=0;a<i;a++)n[a].emit("unpipe",this,{hasUnpiped:!1});return this}var o=Y(t.pipes,e);return -1===o||(t.pipes.splice(o,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,r)),this},T.prototype.on=function(e,t){var r=u.prototype.on.call(this,e,t),n=this._readableState;return"data"===e?(n.readableListening=this.listenerCount("readable")>0,!1!==n.flowing&&this.resume()):"readable"!==e||n.endEmitted||n.readableListening||(n.readableListening=n.needReadable=!0,n.flowing=!1,n.emittedReadable=!1,o("on readable",n.length,n.reading),n.length?O(this):n.reading||i.default.nextTick(H,this)),r},T.prototype.addListener=T.prototype.on,T.prototype.removeListener=function(e,t){var r=u.prototype.removeListener.call(this,e,t);return"readable"===e&&i.default.nextTick($,this),r},T.prototype.removeAllListeners=function(e){var t=u.prototype.removeAllListeners.apply(this,arguments);return("readable"===e||void 0===e)&&i.default.nextTick($,this),t},T.prototype.resume=function(){var e=this._readableState;return e.flowing||(o("resume"),e.flowing=!e.readableListening,q(this,e)),e.paused=!1,this},T.prototype.pause=function(){return o("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(o("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this},T.prototype.wrap=function(e){var t=this,r=this._readableState,n=!1;for(var i in e.on("end",function(){if(o("wrapped end"),r.decoder&&!r.ended){var e=r.decoder.end();e&&e.length&&t.push(e)}t.push(null)}),e.on("data",function(i){o("wrapped data"),r.decoder&&(i=r.decoder.write(i)),r.objectMode&&null==i||(r.objectMode||i&&i.length)&&(t.push(i)||(n=!0,e.pause()))}),e)void 0===this[i]&&"function"==typeof e[i]&&(this[i]=function(t){return function(){return e[t].apply(e,arguments)}}(i));for(var a=0;a<M.length;a++)e.on(M[a],this.emit.bind(this,M[a]));return this._read=function(t){o("wrapped _read",t),n&&(n=!1,e.resume())},this},"function"==typeof Symbol&&(T.prototype[Symbol.asyncIterator]=function(){return void 0===l&&(l=n(6871)),l(this)}),Object.defineProperty(T.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(T.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(T.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(e){this._readableState&&(this._readableState.flowing=e)}}),T._fromList=K,Object.defineProperty(T.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}}),"function"==typeof Symbol&&(T.from=function(e,t){return void 0===c&&(c=n(9727)),c(T,e,t)})},1170:function(e,t,r){"use strict";e.exports=f;var n=r(4646).q,i=n.ERR_METHOD_NOT_IMPLEMENTED,a=n.ERR_MULTIPLE_CALLBACK,o=n.ERR_TRANSFORM_ALREADY_TRANSFORMING,s=n.ERR_TRANSFORM_WITH_LENGTH_0,l=r(2403);function c(e,t){var r=this._transformState;r.transforming=!1;var n=r.writecb;if(null===n)return this.emit("error",new a);r.writechunk=null,r.writecb=null,null!=t&&this.push(t),n(e);var i=this._readableState;i.reading=!1,(i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}function f(e){if(!(this instanceof f))return new f(e);l.call(this,e),this._transformState={afterTransform:c.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.on("prefinish",u)}function u(){var e=this;"function"!=typeof this._flush||this._readableState.destroyed?d(this,null,null):this._flush(function(t,r){d(e,t,r)})}function d(e,t,r){if(t)return e.emit("error",t);if(null!=r&&e.push(r),e._writableState.length)throw new s;if(e._transformState.transforming)throw new o;return e.push(null)}r(3782)(f,l),f.prototype.push=function(e,t){return this._transformState.needTransform=!1,l.prototype.push.call(this,e,t)},f.prototype._transform=function(e,t,r){r(new i("_transform()"))},f.prototype._write=function(e,t,r){var n=this._transformState;if(n.writecb=r,n.writechunk=e,n.writeencoding=t,!n.transforming){var i=this._readableState;(n.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},f.prototype._read=function(e){var t=this._transformState;null===t.writechunk||t.transforming?t.needTransform=!0:(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform))},f.prototype._destroy=function(e,t){l.prototype._destroy.call(this,e,function(e){t(e)})}},7337:function(t,r,n){"use strict";function a(e){var t=this;this.next=null,this.entry=null,this.finish=function(){V(t,e)}}t.exports=A,A.WritableState=N;var o,s,l={deprecate:n(6769)},c=n(4678),f=n(4300).Buffer,u=e.g.Uint8Array||function(){};function d(e){return f.from(e)}function h(e){return f.isBuffer(e)||e instanceof u}var p=n(7025),b=n(6776).getHighWaterMark,m=n(4646).q,g=m.ERR_INVALID_ARG_TYPE,y=m.ERR_METHOD_NOT_IMPLEMENTED,v=m.ERR_MULTIPLE_CALLBACK,x=m.ERR_STREAM_CANNOT_PIPE,w=m.ERR_STREAM_DESTROYED,S=m.ERR_STREAM_NULL_VALUES,k=m.ERR_STREAM_WRITE_AFTER_END,_=m.ERR_UNKNOWN_ENCODING,E=p.errorOrDestroy;function M(){}function N(e,t,r){o=o||n(2403),e=e||{},"boolean"!=typeof r&&(r=t instanceof o),this.objectMode=!!e.objectMode,r&&(this.objectMode=this.objectMode||!!e.writableObjectMode),this.highWaterMark=b(this,e,"writableHighWaterMark",r),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var i=!1===e.decodeStrings;this.decodeStrings=!i,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){B(t,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=!1!==e.emitClose,this.autoDestroy=!!e.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new a(this)}function A(e){var t=this instanceof(o=o||n(2403));if(!t&&!s.call(A,this))return new A(e);this._writableState=new N(e,this,t),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev),"function"==typeof e.destroy&&(this._destroy=e.destroy),"function"==typeof e.final&&(this._final=e.final)),c.call(this)}function T(e,t){var r=new k;E(e,r),i.default.nextTick(t,r)}function R(e,t,r,n){var a;return null===r?a=new S:"string"==typeof r||t.objectMode||(a=new g("chunk",["string","Buffer"],r)),!a||(E(e,a),i.default.nextTick(n,a),!1)}function C(e,t,r){return e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=f.from(t,r)),t}function j(e,t,r,n,i,a){if(!r){var o=C(t,n,i);n!==o&&(r=!0,i="buffer",n=o)}var s=t.objectMode?1:n.length;t.length+=s;var l=t.length<t.highWaterMark;if(l||(t.needDrain=!0),t.writing||t.corked){var c=t.lastBufferedRequest;t.lastBufferedRequest={chunk:n,encoding:i,isBuf:r,callback:a,next:null},c?c.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else I(e,t,!1,s,n,i,a);return l}function I(e,t,r,n,i,a,o){t.writelen=n,t.writecb=o,t.writing=!0,t.sync=!0,t.destroyed?t.onwrite(new w("write")):r?e._writev(i,t.onwrite):e._write(i,a,t.onwrite),t.sync=!1}function L(e,t,r,n,a){--t.pendingcb,r?(i.default.nextTick(a,n),i.default.nextTick(H,e,t),e._writableState.errorEmitted=!0,E(e,n)):(a(n),e._writableState.errorEmitted=!0,E(e,n),H(e,t))}function P(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}function B(e,t){var r=e._writableState,n=r.sync,a=r.writecb;if("function"!=typeof a)throw new v;if(P(r),t)L(e,r,n,t,a);else{var o=F(r)||e.destroyed;o||r.corked||r.bufferProcessing||!r.bufferedRequest||z(e,r),n?i.default.nextTick(O,e,r,o,a):O(e,r,o,a)}}function O(e,t,r,n){r||D(e,t),t.pendingcb--,n(),H(e,t)}function D(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}function z(e,t){t.bufferProcessing=!0;var r=t.bufferedRequest;if(e._writev&&r&&r.next){var n=Array(t.bufferedRequestCount),i=t.corkedRequestsFree;i.entry=r;for(var o=0,s=!0;r;)n[o]=r,r.isBuf||(s=!1),r=r.next,o+=1;n.allBuffers=s,I(e,t,!0,t.length,n,"",i.finish),t.pendingcb++,t.lastBufferedRequest=null,i.next?(t.corkedRequestsFree=i.next,i.next=null):t.corkedRequestsFree=new a(t),t.bufferedRequestCount=0}else{for(;r;){var l=r.chunk,c=r.encoding,f=r.callback,u=t.objectMode?1:l.length;if(I(e,t,!1,u,l,c,f),r=r.next,t.bufferedRequestCount--,t.writing)break}null===r&&(t.lastBufferedRequest=null)}t.bufferedRequest=r,t.bufferProcessing=!1}function F(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function U(e,t){e._final(function(r){t.pendingcb--,r&&E(e,r),t.prefinished=!0,e.emit("prefinish"),H(e,t)})}function $(e,t){t.prefinished||t.finalCalled||("function"!=typeof e._final||t.destroyed?(t.prefinished=!0,e.emit("prefinish")):(t.pendingcb++,t.finalCalled=!0,i.default.nextTick(U,e,t)))}function H(e,t){var r=F(t);if(r&&($(e,t),0===t.pendingcb)&&(t.finished=!0,e.emit("finish"),t.autoDestroy)){var n=e._readableState;(!n||n.autoDestroy&&n.endEmitted)&&e.destroy()}return r}function q(e,t,r){t.ending=!0,H(e,t),r&&(t.finished?i.default.nextTick(r):e.once("finish",r)),t.ended=!0,e.writable=!1}function V(e,t,r){var n=e.entry;for(e.entry=null;n;){var i=n.callback;t.pendingcb--,i(r),n=n.next}t.corkedRequestsFree.next=e}n(3782)(A,c),N.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(N.prototype,"buffer",{get:l.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(e){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(s=Function.prototype[Symbol.hasInstance],Object.defineProperty(A,Symbol.hasInstance,{value:function(e){return!!s.call(this,e)||this===A&&e&&e._writableState instanceof N}})):s=function(e){return e instanceof this},A.prototype.pipe=function(){E(this,new x)},A.prototype.write=function(e,t,r){var n=this._writableState,i=!1,a=!n.objectMode&&h(e);return a&&!f.isBuffer(e)&&(e=d(e)),"function"==typeof t&&(r=t,t=null),a?t="buffer":t||(t=n.defaultEncoding),"function"!=typeof r&&(r=M),n.ending?T(this,r):(a||R(this,n,e,r))&&(n.pendingcb++,i=j(this,n,a,e,t,r)),i},A.prototype.cork=function(){this._writableState.corked++},A.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.bufferProcessing||!e.bufferedRequest||z(this,e))},A.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new _(e);return this._writableState.defaultEncoding=e,this},Object.defineProperty(A.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(A.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),A.prototype._write=function(e,t,r){r(new y("_write()"))},A.prototype._writev=null,A.prototype.end=function(e,t,r){var n=this._writableState;return"function"==typeof e?(r=e,e=null,t=null):"function"==typeof t&&(r=t,t=null),null!=e&&this.write(e,t),n.corked&&(n.corked=1,this.uncork()),n.ending||q(this,n,r),this},Object.defineProperty(A.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(A.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}}),A.prototype.destroy=p.destroy,A.prototype._undestroy=p.undestroy,A.prototype._destroy=function(e,t){t(e)}},6871:function(e,t,r){"use strict";function n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var a,o=r(9698),s=Symbol("lastResolve"),l=Symbol("lastReject"),c=Symbol("error"),f=Symbol("ended"),u=Symbol("lastPromise"),d=Symbol("handlePromise"),h=Symbol("stream");function p(e,t){return{value:e,done:t}}function b(e){var t=e[s];if(null!==t){var r=e[h].read();null!==r&&(e[u]=null,e[s]=null,e[l]=null,t(p(r,!1)))}}function m(e){i.default.nextTick(b,e)}function g(e,t){return function(r,n){e.then(function(){t[f]?r(p(void 0,!0)):t[d](r,n)},n)}}var y=Object.getPrototypeOf(function(){}),v=Object.setPrototypeOf((n(a={get stream(){return this[h]},next:function(){var e,t=this,r=this[c];if(null!==r)return Promise.reject(r);if(this[f])return Promise.resolve(p(void 0,!0));if(this[h].destroyed)return new Promise(function(e,r){i.default.nextTick(function(){t[c]?r(t[c]):e(p(void 0,!0))})});var n=this[u];if(n)e=new Promise(g(n,this));else{var a=this[h].read();if(null!==a)return Promise.resolve(p(a,!1));e=new Promise(this[d])}return this[u]=e,e}},Symbol.asyncIterator,function(){return this}),n(a,"return",function(){var e=this;return new Promise(function(t,r){e[h].destroy(null,function(e){e?r(e):t(p(void 0,!0))})})}),a),y);e.exports=function(e){var t,r=Object.create(v,(n(t={},h,{value:e,writable:!0}),n(t,s,{value:null,writable:!0}),n(t,l,{value:null,writable:!0}),n(t,c,{value:null,writable:!0}),n(t,f,{value:e._readableState.endEmitted,writable:!0}),n(t,d,{value:function(e,t){var n=r[h].read();n?(r[u]=null,r[s]=null,r[l]=null,e(p(n,!1))):(r[s]=e,r[l]=t)},writable:!0}),t));return r[u]=null,o(e,function(e){if(e&&"ERR_STREAM_PREMATURE_CLOSE"!==e.code){var t=r[l];null!==t&&(r[u]=null,r[s]=null,r[l]=null,t(e)),r[c]=e;return}var n=r[s];null!==n&&(r[u]=null,r[s]=null,r[l]=null,n(p(void 0,!0))),r[f]=!0}),e.on("readable",m.bind(null,r)),r}},4379:function(e,t,r){"use strict";function n(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?n(Object(r),!0).forEach(function(t){a(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):n(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}function s(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function l(e,t,r){return t&&s(e.prototype,t),r&&s(e,r),e}var c=r(4300).Buffer,f=r(3837).inspect,u=f&&f.custom||"inspect";function d(e,t,r){c.prototype.copy.call(e,t,r)}e.exports=function(){function e(){o(this,e),this.head=null,this.tail=null,this.length=0}return l(e,[{key:"push",value:function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length}},{key:"unshift",value:function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length}},{key:"shift",value:function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(e){if(0===this.length)return"";for(var t=this.head,r=""+t.data;t=t.next;)r+=e+t.data;return r}},{key:"concat",value:function(e){if(0===this.length)return c.alloc(0);for(var t=c.allocUnsafe(e>>>0),r=this.head,n=0;r;)d(r.data,t,n),n+=r.data.length,r=r.next;return t}},{key:"consume",value:function(e,t){var r;return e<this.head.data.length?(r=this.head.data.slice(0,e),this.head.data=this.head.data.slice(e)):r=e===this.head.data.length?this.shift():t?this._getString(e):this._getBuffer(e),r}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(e){var t=this.head,r=1,n=t.data;for(e-=n.length;t=t.next;){var i=t.data,a=e>i.length?i.length:e;if(a===i.length?n+=i:n+=i.slice(0,e),0==(e-=a)){a===i.length?(++r,t.next?this.head=t.next:this.head=this.tail=null):(this.head=t,t.data=i.slice(a));break}++r}return this.length-=r,n}},{key:"_getBuffer",value:function(e){var t=c.allocUnsafe(e),r=this.head,n=1;for(r.data.copy(t),e-=r.data.length;r=r.next;){var i=r.data,a=e>i.length?i.length:e;if(i.copy(t,t.length-e,0,a),0==(e-=a)){a===i.length?(++n,r.next?this.head=r.next:this.head=this.tail=null):(this.head=r,r.data=i.slice(a));break}++n}return this.length-=n,t}},{key:u,value:function(e,t){return f(this,i({},t,{depth:0,customInspect:!1}))}}]),e}()},7025:function(e){"use strict";function t(e,t){n(e,t),r(e)}function r(e){e._writableState&&!e._writableState.emitClose||(!e._readableState||e._readableState.emitClose)&&e.emit("close")}function n(e,t){e.emit("error",t)}e.exports={destroy:function(e,a){var o=this,s=this._readableState&&this._readableState.destroyed,l=this._writableState&&this._writableState.destroyed;return s||l?a?a(e):e&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,i.default.nextTick(n,this,e)):i.default.nextTick(n,this,e)):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(e||null,function(e){!a&&e?o._writableState?o._writableState.errorEmitted?i.default.nextTick(r,o):(o._writableState.errorEmitted=!0,i.default.nextTick(t,o,e)):i.default.nextTick(t,o,e):a?(i.default.nextTick(r,o),a(e)):i.default.nextTick(r,o)})),this},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)},errorOrDestroy:function(e,t){var r=e._readableState,n=e._writableState;r&&r.autoDestroy||n&&n.autoDestroy?e.destroy(t):e.emit("error",t)}}},9698:function(e,t,r){"use strict";var n=r(4646).q.ERR_STREAM_PREMATURE_CLOSE;function i(e){var t=!1;return function(){if(!t){t=!0;for(var r=arguments.length,n=Array(r),i=0;i<r;i++)n[i]=arguments[i];e.apply(this,n)}}}function a(){}function o(e){return e.setHeader&&"function"==typeof e.abort}function s(e,t,r){if("function"==typeof t)return s(e,null,t);t||(t={}),r=i(r||a);var l=t.readable||!1!==t.readable&&e.readable,c=t.writable||!1!==t.writable&&e.writable,f=function(){e.writable||d()},u=e._writableState&&e._writableState.finished,d=function(){c=!1,u=!0,l||r.call(e)},h=e._readableState&&e._readableState.endEmitted,p=function(){l=!1,h=!0,c||r.call(e)},b=function(t){r.call(e,t)},m=function(){var t;return l&&!h?(e._readableState&&e._readableState.ended||(t=new n),r.call(e,t)):c&&!u?(e._writableState&&e._writableState.ended||(t=new n),r.call(e,t)):void 0},g=function(){e.req.on("finish",d)};return o(e)?(e.on("complete",d),e.on("abort",m),e.req?g():e.on("request",g)):c&&!e._writableState&&(e.on("end",f),e.on("close",f)),e.on("end",p),e.on("finish",d),!1!==t.error&&e.on("error",b),e.on("close",m),function(){e.removeListener("complete",d),e.removeListener("abort",m),e.removeListener("request",g),e.req&&e.req.removeListener("finish",d),e.removeListener("end",f),e.removeListener("close",f),e.removeListener("finish",d),e.removeListener("end",p),e.removeListener("error",b),e.removeListener("close",m)}}e.exports=s},9727:function(e,t,r){"use strict";function n(e,t,r,n,i,a,o){try{var s=e[a](o),l=s.value}catch(e){r(e);return}s.done?t(l):Promise.resolve(l).then(n,i)}function i(e){return function(){var t=this,r=arguments;return new Promise(function(i,a){var o=e.apply(t,r);function s(e){n(o,i,a,s,l,"next",e)}function l(e){n(o,i,a,s,l,"throw",e)}s(void 0)})}}function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function o(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),!0).forEach(function(t){s(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function s(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var l=r(4646).q.ERR_INVALID_ARG_TYPE;e.exports=function(e,t,r){if(t&&"function"==typeof t.next)n=t;else if(t&&t[Symbol.asyncIterator])n=t[Symbol.asyncIterator]();else if(t&&t[Symbol.iterator])n=t[Symbol.iterator]();else throw new l("iterable",["Iterable"],t);var n,a=new e(o({objectMode:!0},r)),s=!1;function c(){return f.apply(this,arguments)}function f(){return(f=i(function*(){try{var e=yield n.next(),t=e.value;e.done?a.push(null):a.push((yield t))?c():s=!1}catch(e){a.destroy(e)}})).apply(this,arguments)}return a._read=function(){s||(s=!0,c())},a}},8442:function(e,t,r){"use strict";function n(e){var t=!1;return function(){t||(t=!0,e.apply(void 0,arguments))}}var i,a=r(4646).q,o=a.ERR_MISSING_ARGS,s=a.ERR_STREAM_DESTROYED;function l(e){if(e)throw e}function c(e){return e.setHeader&&"function"==typeof e.abort}function f(e,t,a,o){o=n(o);var l=!1;e.on("close",function(){l=!0}),void 0===i&&(i=r(9698)),i(e,{readable:t,writable:a},function(e){if(e)return o(e);l=!0,o()});var f=!1;return function(t){if(!l&&!f){if(f=!0,c(e))return e.abort();if("function"==typeof e.destroy)return e.destroy();o(t||new s("pipe"))}}}function u(e){e()}function d(e,t){return e.pipe(t)}function h(e){return e.length&&"function"==typeof e[e.length-1]?e.pop():l}e.exports=function(){for(var e,t=arguments.length,r=Array(t),n=0;n<t;n++)r[n]=arguments[n];var i=h(r);if(Array.isArray(r[0])&&(r=r[0]),r.length<2)throw new o("streams");var a=r.map(function(t,n){var o=n<r.length-1;return f(t,o,n>0,function(t){e||(e=t),t&&a.forEach(u),o||(a.forEach(u),i(e))})});return r.reduce(d)}},6776:function(e,t,r){"use strict";var n=r(4646).q.ERR_INVALID_OPT_VALUE;function i(e,t,r){return null!=e.highWaterMark?e.highWaterMark:t?e[r]:null}e.exports={getHighWaterMark:function(e,t,r,a){var o=i(t,a,r);if(null!=o){if(!(isFinite(o)&&Math.floor(o)===o)||o<0)throw new n(a?r:"highWaterMark",o);return Math.floor(o)}return e.objectMode?16:16384}}},4678:function(e,t,r){e.exports=r(2781)},3726:function(e,t,r){var n=r(2781);"disable"===i.default.env.READABLE_STREAM&&n?(e.exports=n.Readable,Object.assign(e.exports,n),e.exports.Stream=n):((t=e.exports=r(1709)).Stream=n||t,t.Readable=t,t.Writable=r(7337),t.Duplex=r(2403),t.Transform=r(1170),t.PassThrough=r(7889),t.finished=r(9698),t.pipeline=r(8442))},3225:function(e,t,r){"use strict";var n=r(4300).Buffer,i=r(3782),a=r(9029),o=Array(16),s=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13],l=[5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11],c=[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6],f=[8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11],u=[0,0x5a827999,0x6ed9eba1,0x8f1bbcdc,0xa953fd4e],d=[0x50a28be6,0x5c4dd124,0x6d703ef3,0x7a6d76e9,0];function h(){a.call(this,64),this._a=0x67452301,this._b=0xefcdab89,this._c=0x98badcfe,this._d=0x10325476,this._e=0xc3d2e1f0}function p(e,t){return e<<t|e>>>32-t}function b(e,t,r,n,i,a,o,s){return p(e+(t^r^n)+a+o|0,s)+i|0}function m(e,t,r,n,i,a,o,s){return p(e+(t&r|~t&n)+a+o|0,s)+i|0}function g(e,t,r,n,i,a,o,s){return p(e+((t|~r)^n)+a+o|0,s)+i|0}function y(e,t,r,n,i,a,o,s){return p(e+(t&n|r&~n)+a+o|0,s)+i|0}function v(e,t,r,n,i,a,o,s){return p(e+(t^(r|~n))+a+o|0,s)+i|0}i(h,a),h.prototype._update=function(){for(var e,t,r=o,n=0;n<16;++n)r[n]=this._block.readInt32LE(4*n);for(var i=0|this._a,a=0|this._b,h=0|this._c,x=0|this._d,w=0|this._e,S=0|this._a,k=0|this._b,_=0|this._c,E=0|this._d,M=0|this._e,N=0;N<80;N+=1)N<16?(e=b(i,a,h,x,w,r[s[N]],u[0],c[N]),t=v(S,k,_,E,M,r[l[N]],d[0],f[N])):N<32?(e=m(i,a,h,x,w,r[s[N]],u[1],c[N]),t=y(S,k,_,E,M,r[l[N]],d[1],f[N])):N<48?(e=g(i,a,h,x,w,r[s[N]],u[2],c[N]),t=g(S,k,_,E,M,r[l[N]],d[2],f[N])):N<64?(e=y(i,a,h,x,w,r[s[N]],u[3],c[N]),t=m(S,k,_,E,M,r[l[N]],d[3],f[N])):(e=v(i,a,h,x,w,r[s[N]],u[4],c[N]),t=b(S,k,_,E,M,r[l[N]],d[4],f[N])),i=w,w=x,x=p(h,10),h=a,a=e,S=M,M=E,E=p(_,10),_=k,k=t;var A=this._b+h+E|0;this._b=this._c+x+M|0,this._c=this._d+w+S|0,this._d=this._e+i+k|0,this._e=this._a+a+_|0,this._a=A},h.prototype._digest=function(){this._block[this._blockOffset++]=128,this._blockOffset>56&&(this._block.fill(0,this._blockOffset,64),this._update(),this._blockOffset=0),this._block.fill(0,this._blockOffset,56),this._block.writeUInt32LE(this._length[0],56),this._block.writeUInt32LE(this._length[1],60),this._update();var e=n.alloc?n.alloc(20):new n(20);return e.writeInt32LE(this._a,0),e.writeInt32LE(this._b,4),e.writeInt32LE(this._c,8),e.writeInt32LE(this._d,12),e.writeInt32LE(this._e,16),e},e.exports=h},5055:function(e,t,r){var n=r(4300),i=n.Buffer;function a(e,t){for(var r in e)t[r]=e[r]}function o(e,t,r){return i(e,t,r)}i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?e.exports=n:(a(n,t),t.Buffer=o),o.prototype=Object.create(i.prototype),a(i,o),o.from=function(e,t,r){if("number"==typeof e)throw TypeError("Argument must not be a number");return i(e,t,r)},o.alloc=function(e,t,r){if("number"!=typeof e)throw TypeError("Argument must be a number");var n=i(e);return void 0!==t?"string"==typeof r?n.fill(t,r):n.fill(t):n.fill(0),n},o.allocUnsafe=function(e){if("number"!=typeof e)throw TypeError("Argument must be a number");return i(e)},o.allocUnsafeSlow=function(e){if("number"!=typeof e)throw TypeError("Argument must be a number");return n.SlowBuffer(e)}},6911:function(e,t,r){var n=r(4300),i=n.Buffer;function a(e,t){for(var r in e)t[r]=e[r]}function o(e,t,r){return i(e,t,r)}i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?e.exports=n:(a(n,t),t.Buffer=o),o.prototype=Object.create(i.prototype),a(i,o),o.from=function(e,t,r){if("number"==typeof e)throw TypeError("Argument must not be a number");return i(e,t,r)},o.alloc=function(e,t,r){if("number"!=typeof e)throw TypeError("Argument must be a number");var n=i(e);return void 0!==t?"string"==typeof r?n.fill(t,r):n.fill(t):n.fill(0),n},o.allocUnsafe=function(e){if("number"!=typeof e)throw TypeError("Argument must be a number");return i(e)},o.allocUnsafeSlow=function(e){if("number"!=typeof e)throw TypeError("Argument must be a number");return n.SlowBuffer(e)}},2858:function(e,t,r){var n=r(6911).Buffer;function i(e,t){this._block=n.alloc(e),this._finalSize=t,this._blockSize=e,this._len=0}i.prototype.update=function(e,t){"string"==typeof e&&(t=t||"utf8",e=n.from(e,t));for(var r=this._block,i=this._blockSize,a=e.length,o=this._len,s=0;s<a;){for(var l=o%i,c=Math.min(a-s,i-l),f=0;f<c;f++)r[l+f]=e[s+f];o+=c,s+=c,o%i==0&&this._update(r)}return this._len+=a,this},i.prototype.digest=function(e){var t=this._len%this._blockSize;this._block[t]=128,this._block.fill(0,t+1),t>=this._finalSize&&(this._update(this._block),this._block.fill(0));var r=8*this._len;if(r<=0xffffffff)this._block.writeUInt32BE(r,this._blockSize-4);else{var n=r>>>0,i=(r-n)/0x100000000;this._block.writeUInt32BE(i,this._blockSize-8),this._block.writeUInt32BE(n,this._blockSize-4)}this._update(this._block);var a=this._hash();return e?a.toString(e):a},i.prototype._update=function(){throw Error("_update must be implemented by subclass")},e.exports=i},4371:function(e,t,r){var n=e.exports=function(e){var t=n[e=e.toLowerCase()];if(!t)throw Error(e+" is not supported (we accept pull requests)");return new t};n.sha=r(4018),n.sha1=r(4179),n.sha224=r(532),n.sha256=r(1843),n.sha384=r(7455),n.sha512=r(9934)},4018:function(e,t,r){var n=r(3782),i=r(2858),a=r(6911).Buffer,o=[0x5a827999,0x6ed9eba1,-0x70e44324,-0x359d3e2a],s=Array(80);function l(){this.init(),this._w=s,i.call(this,64,56)}function c(e){return e<<5|e>>>27}function f(e){return e<<30|e>>>2}function u(e,t,r,n){return 0===e?t&r|~t&n:2===e?t&r|t&n|r&n:t^r^n}n(l,i),l.prototype.init=function(){return this._a=0x67452301,this._b=0xefcdab89,this._c=0x98badcfe,this._d=0x10325476,this._e=0xc3d2e1f0,this},l.prototype._update=function(e){for(var t=this._w,r=0|this._a,n=0|this._b,i=0|this._c,a=0|this._d,s=0|this._e,l=0;l<16;++l)t[l]=e.readInt32BE(4*l);for(;l<80;++l)t[l]=t[l-3]^t[l-8]^t[l-14]^t[l-16];for(var d=0;d<80;++d){var h=~~(d/20),p=c(r)+u(h,n,i,a)+s+t[d]+o[h]|0;s=a,a=i,i=f(n),n=r,r=p}this._a=r+this._a|0,this._b=n+this._b|0,this._c=i+this._c|0,this._d=a+this._d|0,this._e=s+this._e|0},l.prototype._hash=function(){var e=a.allocUnsafe(20);return e.writeInt32BE(0|this._a,0),e.writeInt32BE(0|this._b,4),e.writeInt32BE(0|this._c,8),e.writeInt32BE(0|this._d,12),e.writeInt32BE(0|this._e,16),e},e.exports=l},4179:function(e,t,r){var n=r(3782),i=r(2858),a=r(6911).Buffer,o=[0x5a827999,0x6ed9eba1,-0x70e44324,-0x359d3e2a],s=Array(80);function l(){this.init(),this._w=s,i.call(this,64,56)}function c(e){return e<<1|e>>>31}function f(e){return e<<5|e>>>27}function u(e){return e<<30|e>>>2}function d(e,t,r,n){return 0===e?t&r|~t&n:2===e?t&r|t&n|r&n:t^r^n}n(l,i),l.prototype.init=function(){return this._a=0x67452301,this._b=0xefcdab89,this._c=0x98badcfe,this._d=0x10325476,this._e=0xc3d2e1f0,this},l.prototype._update=function(e){for(var t=this._w,r=0|this._a,n=0|this._b,i=0|this._c,a=0|this._d,s=0|this._e,l=0;l<16;++l)t[l]=e.readInt32BE(4*l);for(;l<80;++l)t[l]=c(t[l-3]^t[l-8]^t[l-14]^t[l-16]);for(var h=0;h<80;++h){var p=~~(h/20),b=f(r)+d(p,n,i,a)+s+t[h]+o[p]|0;s=a,a=i,i=u(n),n=r,r=b}this._a=r+this._a|0,this._b=n+this._b|0,this._c=i+this._c|0,this._d=a+this._d|0,this._e=s+this._e|0},l.prototype._hash=function(){var e=a.allocUnsafe(20);return e.writeInt32BE(0|this._a,0),e.writeInt32BE(0|this._b,4),e.writeInt32BE(0|this._c,8),e.writeInt32BE(0|this._d,12),e.writeInt32BE(0|this._e,16),e},e.exports=l},532:function(e,t,r){var n=r(3782),i=r(1843),a=r(2858),o=r(6911).Buffer,s=Array(64);function l(){this.init(),this._w=s,a.call(this,64,56)}n(l,i),l.prototype.init=function(){return this._a=0xc1059ed8,this._b=0x367cd507,this._c=0x3070dd17,this._d=0xf70e5939,this._e=0xffc00b31,this._f=0x68581511,this._g=0x64f98fa7,this._h=0xbefa4fa4,this},l.prototype._hash=function(){var e=o.allocUnsafe(28);return e.writeInt32BE(this._a,0),e.writeInt32BE(this._b,4),e.writeInt32BE(this._c,8),e.writeInt32BE(this._d,12),e.writeInt32BE(this._e,16),e.writeInt32BE(this._f,20),e.writeInt32BE(this._g,24),e},e.exports=l},1843:function(e,t,r){var n=r(3782),i=r(2858),a=r(6911).Buffer,o=[0x428a2f98,0x71374491,0xb5c0fbcf,0xe9b5dba5,0x3956c25b,0x59f111f1,0x923f82a4,0xab1c5ed5,0xd807aa98,0x12835b01,0x243185be,0x550c7dc3,0x72be5d74,0x80deb1fe,0x9bdc06a7,0xc19bf174,0xe49b69c1,0xefbe4786,0xfc19dc6,0x240ca1cc,0x2de92c6f,0x4a7484aa,0x5cb0a9dc,0x76f988da,0x983e5152,0xa831c66d,0xb00327c8,0xbf597fc7,0xc6e00bf3,0xd5a79147,0x6ca6351,0x14292967,0x27b70a85,0x2e1b2138,0x4d2c6dfc,0x53380d13,0x650a7354,0x766a0abb,0x81c2c92e,0x92722c85,0xa2bfe8a1,0xa81a664b,0xc24b8b70,0xc76c51a3,0xd192e819,0xd6990624,0xf40e3585,0x106aa070,0x19a4c116,0x1e376c08,0x2748774c,0x34b0bcb5,0x391c0cb3,0x4ed8aa4a,0x5b9cca4f,0x682e6ff3,0x748f82ee,0x78a5636f,0x84c87814,0x8cc70208,0x90befffa,0xa4506ceb,0xbef9a3f7,0xc67178f2],s=Array(64);function l(){this.init(),this._w=s,i.call(this,64,56)}function c(e,t,r){return r^e&(t^r)}function f(e,t,r){return e&t|r&(e|t)}function u(e){return(e>>>2|e<<30)^(e>>>13|e<<19)^(e>>>22|e<<10)}function d(e){return(e>>>6|e<<26)^(e>>>11|e<<21)^(e>>>25|e<<7)}function h(e){return(e>>>7|e<<25)^(e>>>18|e<<14)^e>>>3}function p(e){return(e>>>17|e<<15)^(e>>>19|e<<13)^e>>>10}n(l,i),l.prototype.init=function(){return this._a=0x6a09e667,this._b=0xbb67ae85,this._c=0x3c6ef372,this._d=0xa54ff53a,this._e=0x510e527f,this._f=0x9b05688c,this._g=0x1f83d9ab,this._h=0x5be0cd19,this},l.prototype._update=function(e){for(var t=this._w,r=0|this._a,n=0|this._b,i=0|this._c,a=0|this._d,s=0|this._e,l=0|this._f,b=0|this._g,m=0|this._h,g=0;g<16;++g)t[g]=e.readInt32BE(4*g);for(;g<64;++g)t[g]=p(t[g-2])+t[g-7]+h(t[g-15])+t[g-16]|0;for(var y=0;y<64;++y){var v=m+d(s)+c(s,l,b)+o[y]+t[y]|0,x=u(r)+f(r,n,i)|0;m=b,b=l,l=s,s=a+v|0,a=i,i=n,n=r,r=v+x|0}this._a=r+this._a|0,this._b=n+this._b|0,this._c=i+this._c|0,this._d=a+this._d|0,this._e=s+this._e|0,this._f=l+this._f|0,this._g=b+this._g|0,this._h=m+this._h|0},l.prototype._hash=function(){var e=a.allocUnsafe(32);return e.writeInt32BE(this._a,0),e.writeInt32BE(this._b,4),e.writeInt32BE(this._c,8),e.writeInt32BE(this._d,12),e.writeInt32BE(this._e,16),e.writeInt32BE(this._f,20),e.writeInt32BE(this._g,24),e.writeInt32BE(this._h,28),e},e.exports=l},7455:function(e,t,r){var n=r(3782),i=r(9934),a=r(2858),o=r(6911).Buffer,s=Array(160);function l(){this.init(),this._w=s,a.call(this,128,112)}n(l,i),l.prototype.init=function(){return this._ah=0xcbbb9d5d,this._bh=0x629a292a,this._ch=0x9159015a,this._dh=0x152fecd8,this._eh=0x67332667,this._fh=0x8eb44a87,this._gh=0xdb0c2e0d,this._hh=0x47b5481d,this._al=0xc1059ed8,this._bl=0x367cd507,this._cl=0x3070dd17,this._dl=0xf70e5939,this._el=0xffc00b31,this._fl=0x68581511,this._gl=0x64f98fa7,this._hl=0xbefa4fa4,this},l.prototype._hash=function(){var e=o.allocUnsafe(48);function t(t,r,n){e.writeInt32BE(t,n),e.writeInt32BE(r,n+4)}return t(this._ah,this._al,0),t(this._bh,this._bl,8),t(this._ch,this._cl,16),t(this._dh,this._dl,24),t(this._eh,this._el,32),t(this._fh,this._fl,40),e},e.exports=l},9934:function(e,t,r){var n=r(3782),i=r(2858),a=r(6911).Buffer,o=[0x428a2f98,0xd728ae22,0x71374491,0x23ef65cd,0xb5c0fbcf,0xec4d3b2f,0xe9b5dba5,0x8189dbbc,0x3956c25b,0xf348b538,0x59f111f1,0xb605d019,0x923f82a4,0xaf194f9b,0xab1c5ed5,0xda6d8118,0xd807aa98,0xa3030242,0x12835b01,0x45706fbe,0x243185be,0x4ee4b28c,0x550c7dc3,0xd5ffb4e2,0x72be5d74,0xf27b896f,0x80deb1fe,0x3b1696b1,0x9bdc06a7,0x25c71235,0xc19bf174,0xcf692694,0xe49b69c1,0x9ef14ad2,0xefbe4786,0x384f25e3,0xfc19dc6,0x8b8cd5b5,0x240ca1cc,0x77ac9c65,0x2de92c6f,0x592b0275,0x4a7484aa,0x6ea6e483,0x5cb0a9dc,0xbd41fbd4,0x76f988da,0x831153b5,0x983e5152,0xee66dfab,0xa831c66d,0x2db43210,0xb00327c8,0x98fb213f,0xbf597fc7,0xbeef0ee4,0xc6e00bf3,0x3da88fc2,0xd5a79147,0x930aa725,0x6ca6351,0xe003826f,0x14292967,0xa0e6e70,0x27b70a85,0x46d22ffc,0x2e1b2138,0x5c26c926,0x4d2c6dfc,0x5ac42aed,0x53380d13,0x9d95b3df,0x650a7354,0x8baf63de,0x766a0abb,0x3c77b2a8,0x81c2c92e,0x47edaee6,0x92722c85,0x1482353b,0xa2bfe8a1,0x4cf10364,0xa81a664b,0xbc423001,0xc24b8b70,0xd0f89791,0xc76c51a3,0x654be30,0xd192e819,0xd6ef5218,0xd6990624,0x5565a910,0xf40e3585,0x5771202a,0x106aa070,0x32bbd1b8,0x19a4c116,0xb8d2d0c8,0x1e376c08,0x5141ab53,0x2748774c,0xdf8eeb99,0x34b0bcb5,0xe19b48a8,0x391c0cb3,0xc5c95a63,0x4ed8aa4a,0xe3418acb,0x5b9cca4f,0x7763e373,0x682e6ff3,0xd6b2b8a3,0x748f82ee,0x5defb2fc,0x78a5636f,0x43172f60,0x84c87814,0xa1f0ab72,0x8cc70208,0x1a6439ec,0x90befffa,0x23631e28,0xa4506ceb,0xde82bde9,0xbef9a3f7,0xb2c67915,0xc67178f2,0xe372532b,0xca273ece,0xea26619c,0xd186b8c7,0x21c0c207,0xeada7dd6,0xcde0eb1e,0xf57d4f7f,0xee6ed178,0x6f067aa,0x72176fba,0xa637dc5,0xa2c898a6,0x113f9804,0xbef90dae,0x1b710b35,0x131c471b,0x28db77f5,0x23047d84,0x32caab7b,0x40c72493,0x3c9ebe0a,0x15c9bebc,0x431d67c4,0x9c100d4c,0x4cc5d4be,0xcb3e42b6,0x597f299c,0xfc657e2a,0x5fcb6fab,0x3ad6faec,0x6c44198c,0x4a475817],s=Array(160);function l(){this.init(),this._w=s,i.call(this,128,112)}function c(e,t,r){return r^e&(t^r)}function f(e,t,r){return e&t|r&(e|t)}function u(e,t){return(e>>>28|t<<4)^(t>>>2|e<<30)^(t>>>7|e<<25)}function d(e,t){return(e>>>14|t<<18)^(e>>>18|t<<14)^(t>>>9|e<<23)}function h(e,t){return(e>>>1|t<<31)^(e>>>8|t<<24)^e>>>7}function p(e,t){return(e>>>1|t<<31)^(e>>>8|t<<24)^(e>>>7|t<<25)}function b(e,t){return(e>>>19|t<<13)^(t>>>29|e<<3)^e>>>6}function m(e,t){return(e>>>19|t<<13)^(t>>>29|e<<3)^(e>>>6|t<<26)}function g(e,t){return+(e>>>0<t>>>0)}n(l,i),l.prototype.init=function(){return this._ah=0x6a09e667,this._bh=0xbb67ae85,this._ch=0x3c6ef372,this._dh=0xa54ff53a,this._eh=0x510e527f,this._fh=0x9b05688c,this._gh=0x1f83d9ab,this._hh=0x5be0cd19,this._al=0xf3bcc908,this._bl=0x84caa73b,this._cl=0xfe94f82b,this._dl=0x5f1d36f1,this._el=0xade682d1,this._fl=0x2b3e6c1f,this._gl=0xfb41bd6b,this._hl=0x137e2179,this},l.prototype._update=function(e){for(var t=this._w,r=0|this._ah,n=0|this._bh,i=0|this._ch,a=0|this._dh,s=0|this._eh,l=0|this._fh,y=0|this._gh,v=0|this._hh,x=0|this._al,w=0|this._bl,S=0|this._cl,k=0|this._dl,_=0|this._el,E=0|this._fl,M=0|this._gl,N=0|this._hl,A=0;A<32;A+=2)t[A]=e.readInt32BE(4*A),t[A+1]=e.readInt32BE(4*A+4);for(;A<160;A+=2){var T=t[A-30],R=t[A-30+1],C=h(T,R),j=p(R,T),I=b(T=t[A-4],R=t[A-4+1]),L=m(R,T),P=t[A-14],B=t[A-14+1],O=t[A-32],D=t[A-32+1],z=j+B|0,F=C+P+g(z,j)|0;F=(F=F+I+g(z=z+L|0,L)|0)+O+g(z=z+D|0,D)|0,t[A]=F,t[A+1]=z}for(var U=0;U<160;U+=2){F=t[U],z=t[U+1];var $=f(r,n,i),H=f(x,w,S),q=u(r,x),V=u(x,r),W=d(s,_),K=d(_,s),G=o[U],X=o[U+1],Y=c(s,l,y),Z=c(_,E,M),J=N+K|0,Q=v+W+g(J,N)|0;Q=(Q=(Q=Q+Y+g(J=J+Z|0,Z)|0)+G+g(J=J+X|0,X)|0)+F+g(J=J+z|0,z)|0;var ee=V+H|0,et=q+$+g(ee,V)|0;v=y,N=M,y=l,M=E,l=s,E=_,s=a+Q+g(_=k+J|0,k)|0,a=i,k=S,i=n,S=w,n=r,w=x,r=Q+et+g(x=J+ee|0,J)|0}this._al=this._al+x|0,this._bl=this._bl+w|0,this._cl=this._cl+S|0,this._dl=this._dl+k|0,this._el=this._el+_|0,this._fl=this._fl+E|0,this._gl=this._gl+M|0,this._hl=this._hl+N|0,this._ah=this._ah+r+g(this._al,x)|0,this._bh=this._bh+n+g(this._bl,w)|0,this._ch=this._ch+i+g(this._cl,S)|0,this._dh=this._dh+a+g(this._dl,k)|0,this._eh=this._eh+s+g(this._el,_)|0,this._fh=this._fh+l+g(this._fl,E)|0,this._gh=this._gh+y+g(this._gl,M)|0,this._hh=this._hh+v+g(this._hl,N)|0},l.prototype._hash=function(){var e=a.allocUnsafe(64);function t(t,r,n){e.writeInt32BE(t,n),e.writeInt32BE(r,n+4)}return t(this._ah,this._al,0),t(this._bh,this._bl,8),t(this._ch,this._cl,16),t(this._dh,this._dl,24),t(this._eh,this._el,32),t(this._fh,this._fl,40),t(this._gh,this._gl,48),t(this._hh,this._hl,56),e},e.exports=l},3704:function(e,t,r){"use strict";var n=r(5055).Buffer,i=n.isEncoding||function(e){switch((e=""+e)&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function a(e){var t;if(!e)return"utf8";for(;;)switch(e){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:if(t)return;e=(""+e).toLowerCase(),t=!0}}function o(e){var t=a(e);if("string"!=typeof t&&(n.isEncoding===i||!i(e)))throw Error("Unknown encoding: "+e);return t||e}function s(e){var t;switch(this.encoding=o(e),this.encoding){case"utf16le":this.text=p,this.end=b,t=4;break;case"utf8":this.fillLast=u,t=4;break;case"base64":this.text=m,this.end=g,t=3;break;default:this.write=y,this.end=v;return}this.lastNeed=0,this.lastTotal=0,this.lastChar=n.allocUnsafe(t)}function l(e){return e<=127?0:e>>5==6?2:e>>4==14?3:e>>3==30?4:e>>6==2?-1:-2}function c(e,t,r){var n=t.length-1;if(n<r)return 0;var i=l(t[n]);return i>=0?(i>0&&(e.lastNeed=i-1),i):--n<r||-2===i?0:(i=l(t[n]))>=0?(i>0&&(e.lastNeed=i-2),i):--n<r||-2===i?0:(i=l(t[n]))>=0?(i>0&&(2===i?i=0:e.lastNeed=i-3),i):0}function f(e,t,r){if((192&t[0])!=128)return e.lastNeed=0,"";if(e.lastNeed>1&&t.length>1){if((192&t[1])!=128)return e.lastNeed=1,"";if(e.lastNeed>2&&t.length>2&&(192&t[2])!=128)return e.lastNeed=2,""}}function u(e){var t=this.lastTotal-this.lastNeed,r=f(this,e,t);return void 0!==r?r:this.lastNeed<=e.length?(e.copy(this.lastChar,t,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):void(e.copy(this.lastChar,t,0,e.length),this.lastNeed-=e.length)}function d(e,t){var r=c(this,e,t);if(!this.lastNeed)return e.toString("utf8",t);this.lastTotal=r;var n=e.length-(r-this.lastNeed);return e.copy(this.lastChar,0,n),e.toString("utf8",t,n)}function h(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+"":t}function p(e,t){if((e.length-t)%2==0){var r=e.toString("utf16le",t);if(r){var n=r.charCodeAt(r.length-1);if(n>=55296&&n<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],r.slice(0,-1)}return r}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],e.toString("utf16le",t,e.length-1)}function b(e){var t=e&&e.length?this.write(e):"";if(this.lastNeed){var r=this.lastTotal-this.lastNeed;return t+this.lastChar.toString("utf16le",0,r)}return t}function m(e,t){var r=(e.length-t)%3;return 0===r?e.toString("base64",t):(this.lastNeed=3-r,this.lastTotal=3,1===r?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString("base64",t,e.length-r))}function g(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+this.lastChar.toString("base64",0,3-this.lastNeed):t}function y(e){return e.toString(this.encoding)}function v(e){return e&&e.length?this.write(e):""}t.s=s,s.prototype.write=function(e){var t,r;if(0===e.length)return"";if(this.lastNeed){if(void 0===(t=this.fillLast(e)))return"";r=this.lastNeed,this.lastNeed=0}else r=0;return r<e.length?t?t+this.text(e,r):this.text(e,r):t||""},s.prototype.end=h,s.prototype.text=d,s.prototype.fillLast=function(e){if(this.lastNeed<=e.length)return e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length}},6769:function(t){function r(t){try{if(!e.g.localStorage)return!1}catch(e){return!1}var r=e.g.localStorage[t];return null!=r&&"true"===String(r).toLowerCase()}t.exports=function e(e,t){if(r("noDeprecation"))return e;var n=!1;return function(){if(!n){if(r("throwDeprecation"))throw Error(t);r("traceDeprecation")?console.trace(t):console.warn(t),n=!0}return e.apply(this,arguments)}}},4300:function(t){"use strict";t.exports=e.r(259390)},6113:function(t){"use strict";t.exports=e.r(906124)},2361:function(t){"use strict";t.exports=e.r(679877)},2781:function(t){"use strict";t.exports=e.r(873795)},1576:function(t){"use strict";t.exports=e.r(924753)},3837:function(t){"use strict";t.exports=e.r(561125)},6144:function(t){"use strict";t.exports=e.r(331023)},5866:function(e){"use strict";e.exports=JSON.parse('{"aes-128-ecb":{"cipher":"AES","key":128,"iv":0,"mode":"ECB","type":"block"},"aes-192-ecb":{"cipher":"AES","key":192,"iv":0,"mode":"ECB","type":"block"},"aes-256-ecb":{"cipher":"AES","key":256,"iv":0,"mode":"ECB","type":"block"},"aes-128-cbc":{"cipher":"AES","key":128,"iv":16,"mode":"CBC","type":"block"},"aes-192-cbc":{"cipher":"AES","key":192,"iv":16,"mode":"CBC","type":"block"},"aes-256-cbc":{"cipher":"AES","key":256,"iv":16,"mode":"CBC","type":"block"},"aes128":{"cipher":"AES","key":128,"iv":16,"mode":"CBC","type":"block"},"aes192":{"cipher":"AES","key":192,"iv":16,"mode":"CBC","type":"block"},"aes256":{"cipher":"AES","key":256,"iv":16,"mode":"CBC","type":"block"},"aes-128-cfb":{"cipher":"AES","key":128,"iv":16,"mode":"CFB","type":"stream"},"aes-192-cfb":{"cipher":"AES","key":192,"iv":16,"mode":"CFB","type":"stream"},"aes-256-cfb":{"cipher":"AES","key":256,"iv":16,"mode":"CFB","type":"stream"},"aes-128-cfb8":{"cipher":"AES","key":128,"iv":16,"mode":"CFB8","type":"stream"},"aes-192-cfb8":{"cipher":"AES","key":192,"iv":16,"mode":"CFB8","type":"stream"},"aes-256-cfb8":{"cipher":"AES","key":256,"iv":16,"mode":"CFB8","type":"stream"},"aes-128-cfb1":{"cipher":"AES","key":128,"iv":16,"mode":"CFB1","type":"stream"},"aes-192-cfb1":{"cipher":"AES","key":192,"iv":16,"mode":"CFB1","type":"stream"},"aes-256-cfb1":{"cipher":"AES","key":256,"iv":16,"mode":"CFB1","type":"stream"},"aes-128-ofb":{"cipher":"AES","key":128,"iv":16,"mode":"OFB","type":"stream"},"aes-192-ofb":{"cipher":"AES","key":192,"iv":16,"mode":"OFB","type":"stream"},"aes-256-ofb":{"cipher":"AES","key":256,"iv":16,"mode":"OFB","type":"stream"},"aes-128-ctr":{"cipher":"AES","key":128,"iv":16,"mode":"CTR","type":"stream"},"aes-192-ctr":{"cipher":"AES","key":192,"iv":16,"mode":"CTR","type":"stream"},"aes-256-ctr":{"cipher":"AES","key":256,"iv":16,"mode":"CTR","type":"stream"},"aes-128-gcm":{"cipher":"AES","key":128,"iv":12,"mode":"GCM","type":"auth"},"aes-192-gcm":{"cipher":"AES","key":192,"iv":12,"mode":"GCM","type":"auth"},"aes-256-gcm":{"cipher":"AES","key":256,"iv":12,"mode":"GCM","type":"auth"}}')},2908:function(e){"use strict";e.exports=JSON.parse('{"sha224WithRSAEncryption":{"sign":"rsa","hash":"sha224","id":"302d300d06096086480165030402040500041c"},"RSA-SHA224":{"sign":"ecdsa/rsa","hash":"sha224","id":"302d300d06096086480165030402040500041c"},"sha256WithRSAEncryption":{"sign":"rsa","hash":"sha256","id":"3031300d060960864801650304020105000420"},"RSA-SHA256":{"sign":"ecdsa/rsa","hash":"sha256","id":"3031300d060960864801650304020105000420"},"sha384WithRSAEncryption":{"sign":"rsa","hash":"sha384","id":"3041300d060960864801650304020205000430"},"RSA-SHA384":{"sign":"ecdsa/rsa","hash":"sha384","id":"3041300d060960864801650304020205000430"},"sha512WithRSAEncryption":{"sign":"rsa","hash":"sha512","id":"3051300d060960864801650304020305000440"},"RSA-SHA512":{"sign":"ecdsa/rsa","hash":"sha512","id":"3051300d060960864801650304020305000440"},"RSA-SHA1":{"sign":"rsa","hash":"sha1","id":"3021300906052b0e03021a05000414"},"ecdsa-with-SHA1":{"sign":"ecdsa","hash":"sha1","id":""},"sha256":{"sign":"ecdsa","hash":"sha256","id":""},"sha224":{"sign":"ecdsa","hash":"sha224","id":""},"sha384":{"sign":"ecdsa","hash":"sha384","id":""},"sha512":{"sign":"ecdsa","hash":"sha512","id":""},"DSA-SHA":{"sign":"dsa","hash":"sha1","id":""},"DSA-SHA1":{"sign":"dsa","hash":"sha1","id":""},"DSA":{"sign":"dsa","hash":"sha1","id":""},"DSA-WITH-SHA224":{"sign":"dsa","hash":"sha224","id":""},"DSA-SHA224":{"sign":"dsa","hash":"sha224","id":""},"DSA-WITH-SHA256":{"sign":"dsa","hash":"sha256","id":""},"DSA-SHA256":{"sign":"dsa","hash":"sha256","id":""},"DSA-WITH-SHA384":{"sign":"dsa","hash":"sha384","id":""},"DSA-SHA384":{"sign":"dsa","hash":"sha384","id":""},"DSA-WITH-SHA512":{"sign":"dsa","hash":"sha512","id":""},"DSA-SHA512":{"sign":"dsa","hash":"sha512","id":""},"DSA-RIPEMD160":{"sign":"dsa","hash":"rmd160","id":""},"ripemd160WithRSA":{"sign":"rsa","hash":"rmd160","id":"3021300906052b2403020105000414"},"RSA-RIPEMD160":{"sign":"rsa","hash":"rmd160","id":"3021300906052b2403020105000414"},"md5WithRSAEncryption":{"sign":"rsa","hash":"md5","id":"3020300c06082a864886f70d020505000410"},"RSA-MD5":{"sign":"rsa","hash":"md5","id":"3020300c06082a864886f70d020505000410"}}')},9267:function(e){"use strict";e.exports=JSON.parse('{"1.3.132.0.10":"secp256k1","1.3.132.0.33":"p224","1.2.840.10045.3.1.1":"p192","1.2.840.10045.3.1.7":"p256","1.3.132.0.34":"p384","1.3.132.0.35":"p521"}')},7992:function(e){"use strict";e.exports=JSON.parse('{"modp1":{"gen":"02","prime":"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a63a3620ffffffffffffffff"},"modp2":{"gen":"02","prime":"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece65381ffffffffffffffff"},"modp5":{"gen":"02","prime":"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca237327ffffffffffffffff"},"modp14":{"gen":"02","prime":"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aacaa68ffffffffffffffff"},"modp15":{"gen":"02","prime":"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aaac42dad33170d04507a33a85521abdf1cba64ecfb850458dbef0a8aea71575d060c7db3970f85a6e1e4c7abf5ae8cdb0933d71e8c94e04a25619dcee3d2261ad2ee6bf12ffa06d98a0864d87602733ec86a64521f2b18177b200cbbe117577a615d6c770988c0bad946e208e24fa074e5ab3143db5bfce0fd108e4b82d120a93ad2caffffffffffffffff"},"modp16":{"gen":"02","prime":"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aaac42dad33170d04507a33a85521abdf1cba64ecfb850458dbef0a8aea71575d060c7db3970f85a6e1e4c7abf5ae8cdb0933d71e8c94e04a25619dcee3d2261ad2ee6bf12ffa06d98a0864d87602733ec86a64521f2b18177b200cbbe117577a615d6c770988c0bad946e208e24fa074e5ab3143db5bfce0fd108e4b82d120a92108011a723c12a787e6d788719a10bdba5b2699c327186af4e23c1a946834b6150bda2583e9ca2ad44ce8dbbbc2db04de8ef92e8efc141fbecaa6287c59474e6bc05d99b2964fa090c3a2233ba186515be7ed1f612970cee2d7afb81bdd762170481cd0069127d5b05aa993b4ea988d8fddc186ffb7dc90a6c08f4df435c934063199ffffffffffffffff"},"modp17":{"gen":"02","prime":"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aaac42dad33170d04507a33a85521abdf1cba64ecfb850458dbef0a8aea71575d060c7db3970f85a6e1e4c7abf5ae8cdb0933d71e8c94e04a25619dcee3d2261ad2ee6bf12ffa06d98a0864d87602733ec86a64521f2b18177b200cbbe117577a615d6c770988c0bad946e208e24fa074e5ab3143db5bfce0fd108e4b82d120a92108011a723c12a787e6d788719a10bdba5b2699c327186af4e23c1a946834b6150bda2583e9ca2ad44ce8dbbbc2db04de8ef92e8efc141fbecaa6287c59474e6bc05d99b2964fa090c3a2233ba186515be7ed1f612970cee2d7afb81bdd762170481cd0069127d5b05aa993b4ea988d8fddc186ffb7dc90a6c08f4df435c93402849236c3fab4d27c7026c1d4dcb2602646dec9751e763dba37bdf8ff9406ad9e530ee5db382f413001aeb06a53ed9027d831179727b0865a8918da3edbebcf9b14ed44ce6cbaced4bb1bdb7f1447e6cc254b332051512bd7af426fb8f401378cd2bf5983ca01c64b92ecf032ea15d1721d03f482d7ce6e74fef6d55e702f46980c82b5a84031900b1c9e59e7c97fbec7e8f323a97a7e36cc88be0f1d45b7ff585ac54bd407b22b4154aacc8f6d7ebf48e1d814cc5ed20f8037e0a79715eef29be32806a1d58bb7c5da76f550aa3d8a1fbff0eb19ccb1a313d55cda56c9ec2ef29632387fe8d76e3c0468043e8f663f4860ee12bf2d5b0b7474d6e694f91e6dcc4024ffffffffffffffff"},"modp18":{"gen":"02","prime":"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aaac42dad33170d04507a33a85521abdf1cba64ecfb850458dbef0a8aea71575d060c7db3970f85a6e1e4c7abf5ae8cdb0933d71e8c94e04a25619dcee3d2261ad2ee6bf12ffa06d98a0864d87602733ec86a64521f2b18177b200cbbe117577a615d6c770988c0bad946e208e24fa074e5ab3143db5bfce0fd108e4b82d120a92108011a723c12a787e6d788719a10bdba5b2699c327186af4e23c1a946834b6150bda2583e9ca2ad44ce8dbbbc2db04de8ef92e8efc141fbecaa6287c59474e6bc05d99b2964fa090c3a2233ba186515be7ed1f612970cee2d7afb81bdd762170481cd0069127d5b05aa993b4ea988d8fddc186ffb7dc90a6c08f4df435c93402849236c3fab4d27c7026c1d4dcb2602646dec9751e763dba37bdf8ff9406ad9e530ee5db382f413001aeb06a53ed9027d831179727b0865a8918da3edbebcf9b14ed44ce6cbaced4bb1bdb7f1447e6cc254b332051512bd7af426fb8f401378cd2bf5983ca01c64b92ecf032ea15d1721d03f482d7ce6e74fef6d55e702f46980c82b5a84031900b1c9e59e7c97fbec7e8f323a97a7e36cc88be0f1d45b7ff585ac54bd407b22b4154aacc8f6d7ebf48e1d814cc5ed20f8037e0a79715eef29be32806a1d58bb7c5da76f550aa3d8a1fbff0eb19ccb1a313d55cda56c9ec2ef29632387fe8d76e3c0468043e8f663f4860ee12bf2d5b0b7474d6e694f91e6dbe115974a3926f12fee5e438777cb6a932df8cd8bec4d073b931ba3bc832b68d9dd300741fa7bf8afc47ed2576f6936ba424663aab639c5ae4f5683423b4742bf1c978238f16cbe39d652de3fdb8befc848ad922222e04a4037c0713eb57a81a23f0c73473fc646cea306b4bcbc8862f8385ddfa9d4b7fa2c087e879683303ed5bdd3a062b3cf5b3a278a66d2a13f83f44f82ddf310ee074ab6a364597e899a0255dc164f31cc50846851df9ab48195ded7ea1b1d510bd7ee74d73faf36bc31ecfa268359046f4eb879f924009438b481c6cd7889a002ed5ee382bc9190da6fc026e479558e4475677e9aa9e3050e2765694dfc81f56e880b96e7160c980dd98edd3dfffffffffffffffff"}}')},2531:function(e){"use strict";e.exports={i8:"6.5.3"}},2510:function(e){"use strict";e.exports=JSON.parse('{"2.16.840.1.101.3.4.1.1":"aes-128-ecb","2.16.840.1.101.3.4.1.2":"aes-128-cbc","2.16.840.1.101.3.4.1.3":"aes-128-ofb","2.16.840.1.101.3.4.1.4":"aes-128-cfb","2.16.840.1.101.3.4.1.21":"aes-192-ecb","2.16.840.1.101.3.4.1.22":"aes-192-cbc","2.16.840.1.101.3.4.1.23":"aes-192-ofb","2.16.840.1.101.3.4.1.24":"aes-192-cfb","2.16.840.1.101.3.4.1.41":"aes-256-ecb","2.16.840.1.101.3.4.1.42":"aes-256-cbc","2.16.840.1.101.3.4.1.43":"aes-256-ofb","2.16.840.1.101.3.4.1.44":"aes-256-cfb"}')}},a={};function o(e){var t=a[e];if(void 0!==t)return t.exports;var n=a[e]={id:e,loaded:!1,exports:{}},i=!0;try{r[e].call(n.exports,n,n.exports,o),i=!1}finally{i&&delete a[e]}return n.loaded=!0,n.exports}!function(){o.nmd=function(e){return e.paths=[],e.children||(e.children=[]),e}}(),o.ab="/ROOT/node_modules/.pnpm/next@16.0.10_@babel+core@7.28.0_react-dom@19.2.0_react@19.2.0__react@19.2.0/node_modules/next/dist/compiled/crypto-browserify/";var s={};!function(){"use strict";var e=s;e.randomBytes=e.rng=e.pseudoRandomBytes=e.prng=o(7223),e.createHash=e.Hash=o(9739),e.createHmac=e.Hmac=o(4873);var t=["sha1","sha224","sha256","sha384","sha512","md5","rmd160"].concat(Object.keys(o(9276)));e.getHashes=function(){return t};var r=o(4978);e.pbkdf2=r.pbkdf2,e.pbkdf2Sync=r.pbkdf2Sync;var n=o(8996);e.Cipher=n.Cipher,e.createCipher=n.createCipher,e.Cipheriv=n.Cipheriv,e.createCipheriv=n.createCipheriv,e.Decipher=n.Decipher,e.createDecipher=n.createDecipher,e.Decipheriv=n.Decipheriv,e.createDecipheriv=n.createDecipheriv,e.getCiphers=n.getCiphers,e.listCiphers=n.listCiphers;var i=o(6587);e.DiffieHellmanGroup=i.DiffieHellmanGroup,e.createDiffieHellmanGroup=i.createDiffieHellmanGroup,e.getDiffieHellman=i.getDiffieHellman,e.createDiffieHellman=i.createDiffieHellman,e.DiffieHellman=i.DiffieHellman;var a=o(4078);e.createSign=a.createSign,e.Sign=a.Sign,e.createVerify=a.createVerify,e.Verify=a.Verify,e.createECDH=o(9942);var l=o(9783);e.publicEncrypt=l.publicEncrypt,e.privateEncrypt=l.privateEncrypt,e.publicDecrypt=l.publicDecrypt,e.privateDecrypt=l.privateDecrypt;var c=o(6445);e.randomFill=c.randomFill,e.randomFillSync=c.randomFillSync,e.createCredentials=function(){throw Error("sorry, createCredentials is not implemented yet\nwe accept pull requests\nhttps://github.com/crypto-browserify/crypto-browserify")},e.constants={DH_CHECK_P_NOT_SAFE_PRIME:2,DH_CHECK_P_NOT_PRIME:1,DH_UNABLE_TO_CHECK_GENERATOR:4,DH_NOT_SUITABLE_GENERATOR:8,NPN_ENABLED:1,ALPN_ENABLED:1,RSA_PKCS1_PADDING:1,RSA_SSLV23_PADDING:2,RSA_NO_PADDING:3,RSA_PKCS1_OAEP_PADDING:4,RSA_X931_PADDING:5,RSA_PKCS1_PSS_PADDING:6,POINT_CONVERSION_COMPRESSED:2,POINT_CONVERSION_UNCOMPRESSED:4,POINT_CONVERSION_HYBRID:6}}(),t.exports=s}()},784735,e=>{"use strict";var t=e.i(374517),r=e.i(917409),n=e.i(96508),i=e.i(604111),a=e.i(501747),o=e.i(424439),s=e.i(265107),l=t,c=e.i(7284),f=r,u=e.i(553438),d=n,h=e.i(29755),p=e.i(778218),b=e.i(981441),m=e.i(850695),g=e.i(128818);let y={searchTerm:"",searchResults:null,searchResultIndex:0,searchProgress:1},v={activeBooknoteType:null,booknoteResults:null,booknoteIndex:0},x=(0,g.create)((e,t)=>({sideBarBookKey:null,sideBarWidth:"",isSideBarVisible:!1,isSideBarPinned:!1,searchNavStates:{},booknotesNavStates:{},searchStatuses:{},getIsSideBarVisible:()=>t().isSideBarVisible,getSideBarWidth:()=>t().sideBarWidth,setSideBarBookKey:t=>e({sideBarBookKey:t}),setSideBarWidth:t=>e({sideBarWidth:t}),toggleSideBar:()=>e(e=>({isSideBarVisible:!e.isSideBarVisible})),toggleSideBarPin:()=>e(e=>({isSideBarPinned:!e.isSideBarPinned})),setSideBarVisible:t=>e({isSideBarVisible:t}),setSideBarPin:t=>e({isSideBarPinned:t}),getSearchStatus:e=>t().searchStatuses[e]||null,getSearchNavState:e=>t().searchNavStates[e]||y,setSearchTerm:(t,r)=>e(e=>({searchNavStates:{...e.searchNavStates,[t]:{...e.searchNavStates[t]||y,searchTerm:r}}})),setSearchResults:(t,r)=>e(e=>({searchNavStates:{...e.searchNavStates,[t]:{...e.searchNavStates[t]||y,searchResults:r}}})),setSearchResultIndex:(t,r)=>e(e=>({searchNavStates:{...e.searchNavStates,[t]:{...e.searchNavStates[t]||y,searchResultIndex:r}}})),setSearchProgress:(t,r)=>e(e=>({searchNavStates:{...e.searchNavStates,[t]:{...e.searchNavStates[t]||y,searchProgress:r}}})),clearSearch:t=>e(e=>({searchNavStates:{...e.searchNavStates,[t]:{...y}},searchStatuses:{...e.searchStatuses,[t]:"terminated"}})),setSearchStatus:(t,r)=>e(e=>({searchStatuses:{...e.searchStatuses,[t]:r}})),getBooknotesNavState:e=>t().booknotesNavStates[e]||v,setActiveBooknoteType:(t,r)=>e(e=>({booknotesNavStates:{...e.booknotesNavStates,[t]:{...e.booknotesNavStates[t]||v,activeBooknoteType:r}}})),setBooknoteResults:(t,r)=>e(e=>({booknotesNavStates:{...e.booknotesNavStates,[t]:{...e.booknotesNavStates[t]||v,booknoteResults:r}}})),setBooknoteIndex:(t,r)=>e(e=>({booknotesNavStates:{...e.booknotesNavStates,[t]:{...e.booknotesNavStates[t]||v,booknoteIndex:r}}})),clearBooknotesNav:t=>e(e=>({booknotesNavStates:{...e.booknotesNavStates,[t]:{...v}}}))})),w=(0,g.create)((e,t)=>({notebookWidth:"",isNotebookVisible:!1,isNotebookPinned:!1,notebookNewAnnotation:null,notebookEditAnnotation:null,notebookAnnotationDrafts:{},getIsNotebookVisible:()=>t().isNotebookVisible,getNotebookWidth:()=>t().notebookWidth,setNotebookWidth:t=>e({notebookWidth:t}),toggleNotebook:()=>e(e=>({isNotebookVisible:!e.isNotebookVisible})),toggleNotebookPin:()=>e(e=>({isNotebookPinned:!e.isNotebookPinned})),setNotebookVisible:t=>e({isNotebookVisible:t}),setNotebookPin:t=>e({isNotebookPinned:t}),setNotebookNewAnnotation:t=>e({notebookNewAnnotation:t}),setNotebookEditAnnotation:t=>e({notebookEditAnnotation:t}),saveNotebookAnnotationDraft:(t,r)=>e(e=>({notebookAnnotationDrafts:{...e.notebookAnnotationDrafts,[t]:r}})),getNotebookAnnotationDraft:e=>t().notebookAnnotationDrafts[e]}));var S=o,k=e.i(650244),_=e.i(852955),E=e.i(943583),M=e.i(305133),N=e.i(699475),A=e.i(141886);let T=()=>{let e=window.open;globalThis.open=function(t,r,n){return(0,A.isTauriAppPlatform)()?((0,N.openUrl)(t?.toString()||""),null):e(t,r,n)}};var R=e.i(234721),C=A,j=e.i(341537),I=e.i(353642),L=e.i(653184),P=t,B=c,O=r,D=e.i(805143),z=e.i(897755),F=n,U=i,$=o,H=M,q=D,V=e.i(931955),W=e.i(619316),K=A;class G{config;isLanServer;constructor(e){this.config=e,this.config.serverUrl=e.serverUrl.replace(/\/$/,""),this.isLanServer=(0,W.isLanAddress)(this.config.serverUrl)}async request(e,t={}){let{method:r="GET",body:n,headers:i,useAuth:a=!0}=t,o=new Headers(i||{});return(a&&(o.set("X-Auth-User",this.config.username),o.set("X-Auth-Key",this.config.userkey)),this.isLanServer||(0,K.isTauriAppPlatform)())?((0,K.isTauriAppPlatform)()?V.fetch:window.fetch)(`${this.config.serverUrl}${e}`,{method:r,headers:{accept:"application/vnd.koreader.v1+json",..."GET"===r?{}:{"Content-Type":"application/json"},...Object.fromEntries(o.entries())},body:n,danger:{acceptInvalidCerts:!0,acceptInvalidHostnames:!0}}):fetch(`${(0,K.getAPIBaseUrl)()}/kosync`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({serverUrl:this.config.serverUrl,endpoint:e,method:r,headers:Object.fromEntries(o.entries()),body:n?JSON.parse(n):void 0})})}async connect(e,t){let r=(0,q.md5)(t);try{let t=await this.request("/users/auth",{method:"GET",headers:{"X-Auth-User":e,"X-Auth-Key":r}});if(t.ok)return{success:!0,message:"Login successful."};if(401===t.status){let t=await this.request("/users/create",{method:"POST",useAuth:!1,body:JSON.stringify({username:e,password:r})});if(t.ok)return{success:!0,message:"Registration successful."};let n=await t.json().catch(()=>({}));if(402===t.status)return{success:!1,message:"Invalid credentials."};return{success:!1,message:n.message||"Registration failed."}}let n=await t.json().catch(()=>({}));return{success:!1,message:n.message||`Authorization failed with status: ${t.status}`}}catch(e){return console.error("KOSync connection failed",e),{success:!1,message:e.message||"Connection error."}}}async getProgress(e){if(!this.config.userkey)return null;let t=this.getDocumentDigest(e);if(!t)return null;try{let r=await this.request(`/syncs/progress/${t}`);if(!r.ok)return console.error(`KOSync: Failed to get progress for ${e.title}. Status: ${r.status}`),null;let n=await r.json();return n.document?n:null}catch(e){return console.error("KOSync getProgress failed",e),null}}async updateProgress(e,t,r){if(!this.config.userkey)return!1;let n=this.getDocumentDigest(e);if(!n)return!1;let i={document:n,progress:t,percentage:r,device:this.config.deviceName,device_id:this.config.deviceId};try{let t=await this.request("/syncs/progress",{method:"PUT",body:JSON.stringify(i)});if(!t.ok)return console.error(`KOSync: Failed to update progress for ${e.title}. Status: ${t.status}`),!1;return!0}catch(e){return console.error("KOSync updateProgress failed",e),!1}}getDocumentDigest(e){return"filename"===this.config.checksumMethod&&console.warn("This is not possible anymore, using md5 instead."),e.hash}}var X=e.i(302814),Y=e.i(62725),Z=e.i(260805);let J=({value:e,onChange:t,options:r,className:n,disabled:i=!1})=>(0,P.jsx)("select",{value:e,onChange:t,className:(0,B.default)("select select-bordered h-12 w-full text-sm focus:outline-none focus:ring-0",n),disabled:i,children:r.map(({value:e,label:t,disabled:r=!1})=>(0,P.jsx)("option",{value:e,disabled:r,children:t},e))}),Q=e=>{let t=document.getElementById("kosync_settings_window");if(t){let r=new CustomEvent("setKOSyncSettingsVisibility",{detail:{visible:e}});t.dispatchEvent(r)}},ee=()=>{let e=(0,U.useTranslation)(),{settings:t,setSettings:r,saveSettings:n}=(0,$.useSettingsStore)(),{envConfig:i,appService:a}=(0,F.useEnv)(),[o,s]=(0,O.useState)(!1),[l,c]=(0,O.useState)(t.kosync.serverUrl||""),[f,u]=(0,O.useState)(t.kosync.username||""),[d,h]=(0,O.useState)(""),[p,b]=(0,O.useState)(!1),[m,g]=(0,O.useState)(""),[y,v]=(0,O.useState)(""),[x,w]=(0,O.useState)("");(0,O.useEffect)(()=>{let e=e=>e?"macos"===e.toLowerCase()?"macOS":"ios"===e.toLowerCase()?"iOS":e.charAt(0).toUpperCase()+e.slice(1):"";(async()=>{let t="";if(a?.appPlatform==="tauri")t=await (0,z.type)();else{let e=(0,Y.getOSPlatform)();"unknown"!==e&&(t=e)}w(e(t))})()},[a]),(0,O.useEffect)(()=>{let e=x?`Readest (${x})`:"Readest";v(t.kosync.deviceName||e)},[t.kosync.deviceName,x]);let S=(0,O.useMemo)(()=>!!t.kosync.userkey,[t.kosync.userkey]),k=(0,O.useCallback)((0,X.debounce)(e=>{let a={...t,koreaderSyncDeviceName:e};r(a),n(i,a)},500),[t,r,n,i]),_=e=>{let t=e.target.value;v(t),k(t)};(0,O.useEffect)(()=>{let e=e=>{s(e.detail.visible),e.detail.visible&&(c(t.kosync.serverUrl||""),u(t.kosync.username||""),h(""),g(""))},r=document.getElementById("kosync_settings_window");return r?.addEventListener("setKOSyncSettingsVisibility",e),()=>{r?.removeEventListener("setKOSyncSettingsVisibility",e)}},[t.kosync.serverUrl,t.kosync.username]);let E=async()=>{b(!0);let a={...t.kosync,serverUrl:l,username:f,userkey:(0,D.md5)(d),deviceName:y,enabled:!0},o=new G(a),s=await o.connect(f,d);if(s.success){let e={...t,kosync:a};r(e),await n(i,e)}else g(""),H.eventDispatcher.dispatch("toast",{message:`${e("Failed to connect")}: ${e(s.message||"Connection error")}`,type:"error"});b(!1),h("")},M=async()=>{let a={...t.kosync,userkey:"",enabled:!1},o={...t,kosync:a};r(o),await n(i,o),u(""),H.eventDispatcher.dispatch("toast",{message:e("Disconnected"),type:"info"})},N=async e=>{let a={...t.kosync,strategy:e.target.value},o={...t,kosync:a};r(o),await n(i,o)},A=async e=>{let a={...t.kosync,checksumMethod:e.target.value},o={...t,kosync:a};r(o),await n(i,o)};return(0,P.jsx)(Z.default,{id:"kosync_settings_window",isOpen:o,onClose:()=>s(!1),title:e("KOReader Sync Settings"),boxClassName:"sm:!min-w-[520px] sm:h-auto",children:o&&(0,P.jsx)("div",{className:"mb-4 mt-0 flex flex-col gap-4 p-2 sm:p-4",children:S?(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)("div",{className:"text-center",children:(0,P.jsx)("p",{className:"text-base-content/80 text-sm",children:e("Sync as {{userDisplayName}}",{userDisplayName:t.kosync.username})})}),(0,P.jsxs)("div",{className:"flex h-14 items-center justify-between",children:[(0,P.jsx)("span",{className:"text-base-content/80",children:e("Sync Server Connected")}),(0,P.jsx)("input",{type:"checkbox",className:"toggle",checked:t.kosync.enabled,onChange:()=>M()})]}),(0,P.jsxs)("div",{className:"form-control w-full",children:[(0,P.jsx)("label",{className:"label py-1",children:(0,P.jsx)("span",{className:"label-text font-medium",children:e("Sync Strategy")})}),(0,P.jsx)(J,{value:t.kosync.strategy,onChange:N,options:[{value:"prompt",label:e("Ask on conflict")},{value:"silent",label:e("Always use latest")},{value:"send",label:e("Send changes only")},{value:"receive",label:e("Receive changes only")}]})]}),(0,P.jsxs)("div",{className:"form-control w-full",children:[(0,P.jsx)("label",{className:"label py-1",children:(0,P.jsx)("span",{className:"label-text font-medium",children:e("Checksum Method")})}),(0,P.jsx)(J,{value:t.kosync.checksumMethod,onChange:A,options:[{value:"binary",label:e("File Content (recommended)")},{value:"filename",label:e("File Name"),disabled:!0}]})]}),(0,P.jsxs)("div",{className:"form-control w-full",children:[(0,P.jsx)("label",{className:"label py-1",children:(0,P.jsx)("span",{className:"label-text font-medium",children:e("Device Name")})}),(0,P.jsx)("input",{type:"text",placeholder:x?`Readest (${x})`:"Readest",className:"input input-bordered h-12 w-full focus:outline-none focus:ring-0",value:y,onChange:_})]})]}):(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)("p",{className:"text-base-content/70 text-center text-sm",children:e("Connect to your KOReader Sync server.")}),(0,P.jsxs)("div",{className:"form-control w-full",children:[(0,P.jsx)("label",{className:"label py-1",children:(0,P.jsx)("span",{className:"label-text font-medium",children:e("Server URL")})}),(0,P.jsx)("input",{type:"text",placeholder:"https://koreader.sync.server",className:"input input-bordered h-12 w-full focus:outline-none focus:ring-0",spellCheck:"false",value:l,onChange:e=>c(e.target.value)})]}),(0,P.jsxs)("form",{className:"flex flex-col gap-4",children:[(0,P.jsxs)("div",{className:"form-control w-full",children:[(0,P.jsx)("label",{className:"label py-1",children:(0,P.jsx)("span",{className:"label-text font-medium",children:e("Username")})}),(0,P.jsx)("input",{type:"text",placeholder:e("Your Username"),className:"input input-bordered h-12 w-full focus:outline-none focus:ring-0",spellCheck:"false",value:f,onChange:e=>u(e.target.value),autoComplete:"username"})]}),(0,P.jsxs)("div",{className:"form-control w-full",children:[(0,P.jsx)("label",{className:"label py-1",children:(0,P.jsx)("span",{className:"label-text font-medium",children:e("Password")})}),(0,P.jsx)("input",{type:"password",placeholder:e("Your Password"),className:"input input-bordered h-12 w-full focus:outline-none focus:ring-0",value:d,onChange:e=>h(e.target.value),autoComplete:"current-password"})]})]}),(0,P.jsx)("button",{className:"btn btn-primary mt-2 h-12 min-h-12 w-full",onClick:E,disabled:p||!l||!f||!d,children:p?(0,P.jsx)("span",{className:"loading loading-spinner"}):e("Connect")}),m&&(0,P.jsx)("div",{className:"text-error h-4 text-center text-sm",children:m})]})})})};var et=t,er=c,en=r,ei=e.i(917742),ea=n,eo=i,es=o,el=m,ec=e.i(885449),ef=m,eu=o,ed=ec,eh=Y;function ep(e){return{id:(0,eh.uniqueId)(),scope:e.scope,pattern:e.pattern,replacement:e.replacement,cfi:e.cfi,sectionHref:e.sectionHref,isRegex:e.isRegex??!1,enabled:e.enabled??!0,caseSensitive:e.caseSensitive??!0,order:e.order??1e3,wholeWord:e.wholeWord??!0,onlyForTTS:e.onlyForTTS??!1}}function eb(e,t){let r=new Map;return(e??[]).forEach(e=>r.set(e.id,e)),(t??[]).forEach(e=>r.set(e.id,e)),[...r.values()].sort((e,t)=>(e.order??0)-(t.order??0))}let em=(0,g.create)(()=>({getBookRules:e=>{let{getViewSettings:t}=ef.useReaderStore.getState(),r=t(e);return r?.proofreadRules||[]},getGlobalRules:()=>{let{settings:e}=eu.useSettingsStore.getState();return e.globalViewSettings.proofreadRules||[]},getMergedRules:e=>{let{settings:t}=eu.useSettingsStore.getState(),{getViewSettings:r}=ef.useReaderStore.getState(),n=r(e);return eb(t.globalViewSettings.proofreadRules,n?.proofreadRules)},addRule:async(e,t,r)=>{let n=ep(r);return"library"===r.scope?await ew(e,n):await eg(e,t,n,r.scope),n},updateRule:async(e,t,r,n)=>{"library"===n.scope?await eS(e,r,n):await ey(e,t,r,n)},removeRule:async(e,t,r,n)=>{"library"===n?await ek(e,r):await ev(e,t,r)},toggleRule:async(e,t,r)=>{let{getMergedRules:n}=em.getState(),i=n(t).find(e=>e.id===r);if(!i)throw Error(`Rule not found: ${r}`);let{updateRule:a}=em.getState();await a(e,t,r,{enabled:!i.enabled})}}));async function eg(e,t,r,n){let{getViewSettings:i}=ef.useReaderStore.getState(),a=i(t);if(!a)return;let o=a.proofreadRules||[];if("selection"===n)o.push(r);else{let e=o.find(e=>e.pattern===r.pattern&&e.isRegex===r.isRegex&&"selection"!==e.scope);e?Object.assign(e,{replacement:r.replacement,enabled:r.enabled,order:r.order}):o.push(r)}await ex(e,t,o)}async function ey(e,t,r,n){let{getViewSettings:i}=ef.useReaderStore.getState(),a=i(t);if(!a)throw Error(`No viewSettings found for book: ${t}`);let o=(a.proofreadRules||[]).map(e=>e.id===r?{...e,...n}:e);await ex(e,t,o)}async function ev(e,t,r){let{getViewSettings:n}=ef.useReaderStore.getState(),i=n(t);if(!i)throw Error(`No viewSettings found for book: ${t}`);let a=(i.proofreadRules||[]).filter(e=>e.id!==r);await ex(e,t,a)}async function ex(e,t,r){let{getViewSettings:n,setViewSettings:i}=ef.useReaderStore.getState(),{getConfig:a,saveConfig:o}=ed.useBookDataStore.getState(),{settings:s}=eu.useSettingsStore.getState(),l=n(t);if(!l)throw Error(`No viewSettings found for book: ${t}`);let c={...l,proofreadRules:r};i(t,c);let f=a(t);f&&await o(e,t,{...f,viewSettings:c,updatedAt:Date.now()},s)}async function ew(e,t){let{settings:r}=eu.useSettingsStore.getState();if(!r||!r.globalViewSettings)return;let n=r.globalViewSettings.proofreadRules||[],i=n.find(e=>e.pattern===t.pattern&&e.isRegex===t.isRegex);i?(Object.assign(i,{replacement:t.replacement,enabled:t.enabled,order:t.order}),await e_(e,n)):await e_(e,[...n,t])}async function eS(e,t,r){let{settings:n}=eu.useSettingsStore.getState(),i=(n.globalViewSettings.proofreadRules||[]).map(e=>e.id===t?{...e,...r}:e);await e_(e,i)}async function ek(e,t){let{settings:r}=eu.useSettingsStore.getState(),n=(r.globalViewSettings.proofreadRules||[]).filter(e=>e.id!==t);await e_(e,n)}async function e_(e,t){let{settings:r,setSettings:n,saveSettings:i}=eu.useSettingsStore.getState(),a={...r,globalViewSettings:{...r.globalViewSettings,proofreadRules:t}};n(a),await i(e,a)}var eE=M,eM=Z;let eN="proofread_rules_window",eA=e=>{let t=document.getElementById(eN);t&&t.dispatchEvent(new CustomEvent("setProofreadRulesVisibility",{detail:{visible:e}}))},eT=({rule:e,scope:t,isEditing:r,editingData:n,onEdit:i,onDelete:a,onSave:o,onCancel:s,onEditChange:l})=>{let c=(0,eo.useTranslation)(),{sideBarBookKey:f}=x(),{getView:u}=(0,el.useReaderStore)(),d=()=>{f&&e.cfi&&(eE.eventDispatcher.dispatch("navigate",{bookKey:f,cfi:e.cfi}),u(f)?.goTo(e.cfi))};return r?(0,et.jsxs)("div",{className:"flex flex-col gap-3 p-3",children:[(0,et.jsxs)("div",{className:"flex flex-col gap-1.5",children:[(0,et.jsx)("label",{className:"text-base-content/70 text-xs font-medium",children:c("Selected text:")}),(0,et.jsx)("input",{className:"input input-sm bg-base-200 text-sm opacity-60",value:n.pattern,disabled:!0})]}),(0,et.jsxs)("div",{className:"flex flex-col gap-1.5",children:[(0,et.jsx)("label",{className:"text-base-content/70 text-xs font-medium",children:c("Replace with:")}),(0,et.jsx)("input",{className:"input input-sm text-sm",value:n.replacement,onChange:e=>l("replacement",e.target.value)})]}),(0,et.jsxs)("div",{className:"mt-1 flex gap-2",children:[(0,et.jsx)("button",{className:"btn btn-primary btn-sm flex-1",onClick:o,children:c("Save")}),(0,et.jsx)("button",{className:"btn btn-sm flex-1",onClick:s,children:c("Cancel")})]})]}):(0,et.jsxs)("div",{className:"relative flex items-start justify-between gap-3 p-3",children:[(0,et.jsxs)("div",{className:"flex min-w-0 flex-1 flex-col gap-1.5",children:[(0,et.jsx)("div",{className:"break-words pe-20 text-base font-medium leading-snug",children:e.pattern}),(0,et.jsxs)("div",{className:"text-base-content/70 break-words text-sm",children:[(0,et.jsx)("span",{className:"text-base-content/80 mr-1.5 text-xs font-medium",children:c("Replace with:")}),(0,et.jsx)("span",{className:"text-base-content/90 text-xs",children:"'"+e.replacement+"'"})]}),(0,et.jsxs)("div",{className:"text-base-content/60 flex flex-wrap items-center gap-x-2 gap-y-1 text-xs",children:[(0,et.jsxs)("span",{className:"inline-flex items-center gap-1",children:[(0,et.jsx)("span",{className:"text-base-content/50",children:c("Scope:")}),(0,et.jsx)("span",{role:"none",className:(0,er.default)("text-base-content/70 font-medium","selection"===t&&"cursor-pointer text-blue-400 hover:text-blue-500"),onClick:"selection"===t?d:void 0,children:c("selection"===t?"Selection":"book"===t?"Book":"Library")})]}),(0,et.jsx)("span",{className:"text-base-content/30",children:""}),(0,et.jsxs)("span",{className:"inline-flex items-center gap-1",children:[(0,et.jsx)("span",{className:"text-base-content/50",children:c("Case sensitive:")}),(0,et.jsx)("span",{className:"text-base-content/70 font-medium",children:c(!1!==e.caseSensitive?"Yes":"No")})]}),(0,et.jsx)("span",{className:"text-base-content/30",children:""}),(0,et.jsxs)("span",{className:"inline-flex items-center gap-1",children:[(0,et.jsx)("span",{className:"text-base-content/50",children:c("Only for TTS:")}),(0,et.jsx)("span",{className:"text-base-content/70 font-medium",children:c(!0===e.onlyForTTS?"Yes":"No")})]})]})]}),(0,et.jsxs)("div",{className:"absolute right-2 top-2 flex items-center gap-1",children:[(0,et.jsx)("button",{className:"btn btn-ghost btn-sm h-8 w-8 p-0",onClick:i,"aria-label":c("Edit"),children:(0,et.jsx)(ei.RiEditLine,{className:"h-4 w-4"})}),(0,et.jsx)("button",{className:"btn btn-ghost btn-sm h-8 w-8 p-0",onClick:a,"aria-label":c("Delete"),children:(0,et.jsx)(ei.RiDeleteBin7Line,{className:"h-4 w-4"})})]})]})},eR=e=>{let{settings:t}=(0,es.useSettingsStore)(),{getViewSettings:r}=(0,el.useReaderStore)(),{getConfig:n}=(0,ec.useBookDataStore)(),i=e?r(e):null,a=i?.proofreadRules||[],o=e?n(e):null,s=o?.viewSettings?.proofreadRules||[],l=s.length?s:a,c=l.filter(e=>"selection"===e.scope),f=l.filter(e=>"book"===e.scope),u=t?.globalViewSettings?.proofreadRules||[],d=new Set(u.map(e=>e.id)),h=f.filter(e=>!1!==e.enabled||d.has(e.id));return{singleRules:c,bookRules:h.concat(u.filter(e=>!h.find(t=>t.id===e.id)))}},eC=()=>{let e=(0,eo.useTranslation)(),{envConfig:t}=(0,ea.useEnv)(),{recreateViewer:r}=(0,el.useReaderStore)(),{sideBarBookKey:n}=x(),{updateRule:i,removeRule:a}=em(),[o,s]=(0,en.useState)(!1),[l,c]=(0,en.useState)({id:null,scope:null,pattern:"",replacement:"",enabled:!0,onlyForTTS:!1}),{singleRules:f,bookRules:u}=eR(n);(0,en.useEffect)(()=>{let e=e=>s(!!e.detail?.visible),t=document.getElementById(eN);return t?.addEventListener("setProofreadRulesVisibility",e),()=>t?.removeEventListener("setProofreadRulesVisibility",e)},[]);let d=e=>{c({id:e.id,scope:e.scope,pattern:e.pattern,replacement:e.replacement,enabled:!!e.enabled,onlyForTTS:!!e.onlyForTTS})},h=()=>{c({id:null,scope:null,pattern:"",replacement:"",enabled:!0,onlyForTTS:!1})},p=async()=>{l.id&&l.scope&&n&&(await i(t,n,l.id,{scope:l.scope,pattern:l.pattern,replacement:l.replacement,enabled:l.enabled,onlyForTTS:l.onlyForTTS}),h(),l.onlyForTTS||r(t,n))},b=async e=>{n&&(await a(t,n,e.id,e.scope),e.onlyForTTS||r(t,n))},m=(e,t,r,n)=>(0,et.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,et.jsx)("h3",{className:"text-base-content/90 text-sm font-semibold",children:r}),0===e.length?(0,et.jsx)("div",{className:"border-base-content/10 bg-base-200/30 rounded-lg border border-dashed p-6 text-center",children:(0,et.jsx)("p",{className:"text-base-content/50 text-sm",children:n})}):(0,et.jsx)("ul",{className:"flex flex-col gap-2",children:e.map(e=>(0,et.jsx)("li",{className:"border-base-content/10 bg-base-100 hover:border-base-content/20 rounded-lg border transition-colors",children:(0,et.jsx)(eT,{rule:e,scope:"selection"===t?"selection":e.scope,isEditing:l.id===e.id&&l.scope===("selection"===t?"selection":e.scope),editingData:l,onEdit:()=>d(e),onDelete:()=>b(e),onSave:p,onCancel:h,onEditChange:(e,t)=>c({...l,replacement:t})})},e.id))})]});return(0,et.jsx)(eM.default,{id:eN,isOpen:o,onClose:()=>s(!1),title:e("Proofread Replacement Rules"),boxClassName:"sm:!min-w-[560px] sm:!max-w-[640px] sm:h-auto",children:o&&(0,et.jsxs)("div",{className:"flex max-h-[70vh] flex-col gap-6 p-4 sm:p-6",children:[m(f,"selection",e("Selected Text Rules"),e("No selected text replacement rules")),m(u,"book",e("Book Specific Rules"),e("No book-level replacement rules")),(0,et.jsx)("div",{className:"p-1"})]})})};var ej=e.i(168375),eI=Y,eL=e.i(911446),eP=t,eB=r,eO=u,eD=n,ez=o,eF=ec,eU=m,e$=i,eH=e.i(47816),eq=e.i(503523),eV=e.i(345598),eW=A,eK=Y,eG=e.i(137432),eX=M,eY=e.i(647735),eZ=e.i(871611),eJ=e.i(955066);async function eQ(e,t){let r=512,n=224,i=182,a=10;try{let o=await fetch(e),s=await o.blob(),l=new Image;l.crossOrigin="anonymous";let c=await fetch(t),f=await c.blob(),u=new Image;return u.crossOrigin="anonymous",new Promise((e,t)=>{let o=!1,c=!1,d=()=>{if(o&&c)try{let o,s,c,f,d=document.createElement("canvas"),h=d.getContext("2d");if(!h)return void t(Error("Failed to get canvas context"));d.width=r,d.height=r;let p=l.width/l.height;p>1?(o=r,s=r/p,c=0,f=(r-s)/2):(s=r,o=r*p,c=(r-o)/2,f=0),h.imageSmoothingEnabled=!0,h.imageSmoothingQuality="high",h.drawImage(l,c,f,o,s),h.drawImage(u,r-n-a,r-i-a,n,i),d.toBlob(r=>{r?e(r):t(Error("Failed to create blob"))},"image/jpeg",.9)}catch(e){t(Error(`Failed to process cover: ${e}`))}};l.onload=()=>{o=!0,d()},u.onload=()=>{c=!0,d()},l.onerror=()=>t(Error("Failed to load cover image")),u.onerror=()=>t(Error("Failed to load icon image"));let h=URL.createObjectURL(s),p=URL.createObjectURL(f);l.src=h,u.src=p,l.onload=function(){URL.revokeObjectURL(h),o=!0,d()},u.onload=function(){URL.revokeObjectURL(p),c=!0,d()}})}catch(e){throw console.error("Error processing Discord cover:",e),e}}async function e0(e,t={}){let{targetWidth:r=256,format:n="image/jpeg",quality:i=.85}=t;try{let t=await fetch(e);if(!t.ok)throw Error(`Failed to fetch image: ${t.status} ${t.statusText}`);let a=await t.blob(),o=new Image;return o.crossOrigin="anonymous",new Promise((e,t)=>{o.onload=()=>{try{let a=o.height/o.width,s=r,l=Math.round(s*a),c=document.createElement("canvas"),f=c.getContext("2d");if(!f)return void t(Error("Failed to get canvas context"));c.width=s,c.height=l,f.imageSmoothingEnabled=!0,f.imageSmoothingQuality="high",f.drawImage(o,0,0,s,l);let u=c.toDataURL(n,i);e(u)}catch(e){t(Error(`Failed to scale image: ${e}`))}},o.onerror=()=>t(Error("Failed to load image for scaling"));let s=URL.createObjectURL(a);o.src=s;let l=()=>URL.revokeObjectURL(s),c=o.onload,f=o.onerror;o.onload=function(e){l(),c&&c.call(this,e)},o.onerror=function(e){l(),f&&f.call(this,e)}})}catch(e){throw console.error("Error fetching and encoding image:",e),e}}let e1=new Map,e2=36e5,e3=async(e,t)=>{let r=e1.get(e.hash);if(r){if(!(Date.now()-r.timestamp>e2))return r.url??void 0;r.url||e1.delete(e.hash)}try{let r=(0,eJ.getCoverFilename)(e);if(!await t.exists(r,"Books"))return void e1.set(e.hash,{url:null,timestamp:Date.now()});let n=await t.resolveFilePath(r,"Books"),i=await t.getImageURL(n),a="/icon-tiny.png";await eQ(i,a),console.log("Processed Discord cover for book:",e.title),e1.set(e.hash,{url:null,timestamp:Date.now()});return}catch(t){console.warn("Failed to process cover for Discord:",t),e1.set(e.hash,{url:null,timestamp:Date.now()});return}},e6=async(e,t,r)=>{if(r?.isDesktopApp)try{let n=await e3(e,r),i={bookHash:e.hash,title:e.title,author:e.author||null,coverUrl:n||null,sessionStart:t};await (0,eZ.invoke)("update_book_presence",{presence:i})}catch(e){console.warn("Failed to update Discord presence:",e)}},e4=async e=>{if(e?.isDesktopApp)try{await (0,eZ.invoke)("clear_book_presence")}catch(e){console.warn("Failed to clear Discord presence:",e)}};var e8=e.i(262504);e.i(86987);var e5=e.i(675510),e9=r,e7=u,te=n,tt=m,tr=Y;let tn=(0,g.create)((e,t)=>({parallelViews:[],setParallel:t=>{e(e=>{let r,n=[...new Set(t.filter(e=>""!==e.trim()))];if(n.length<2)return e;let i=[...e.parallelViews],a=i.filter(e=>n.some(t=>e.has(t)));return 0===a.length?(r=new Set(n),i.push(r)):1===a.length?(r=a[0],n.forEach(e=>r.add(e))):(r=a[0],a.slice(1).forEach(e=>{e.forEach(e=>r.add(e));let t=i.indexOf(e);t>-1&&i.splice(t,1)}),n.forEach(e=>r.add(e))),console.log("Set parallel groups:",i),{parallelViews:i}})},unsetParallel:t=>{e(e=>{let r=[...new Set(t.filter(e=>""!==e.trim()))];if(0===r.length)return e;let n=[...e.parallelViews];return n.filter(e=>r.some(t=>e.has(t))).forEach(e=>{if(r.forEach(t=>e.delete(t)),e.size<=1){let t=n.indexOf(e);t>-1&&n.splice(t,1)}}),console.log("Unset parallel groups:",n),{parallelViews:n}})},areParallels(e,r){let{parallelViews:n}=t();return n.some(t=>t.has(e)&&t.has(r))},getParallels(e){let{parallelViews:r}=t();return r.find(t=>t.has(e))||null}}));var ti=eY;let ta=()=>{let e=(0,e7.useRouter)(),t=(0,e7.useSearchParams)(),{envConfig:r}=(0,te.useEnv)(),{bookKeys:n}=(0,tt.useReaderStore)(),{setBookKeys:i,initViewState:a}=(0,tt.useReaderStore)(),{sideBarBookKey:o,setSideBarBookKey:s}=x(),[l,c]=(0,e9.useState)(!1),{setParallel:f}=tn();(0,e9.useEffect)(()=>{if(l){let r=n.map(e=>e.split("-")[0]);r&&(0,ti.navigateToReader)(e,r,t?.toString()||"",{scroll:!1}),c(!1)}},[n,l]);let u=(e,t,l)=>{let u=`${e}-${(0,tr.uniqueId)()}`;a(r,e,u,t),n.includes(u)||i([...n,u]),l&&f([o,u]),s(u),c(!0)},d=e=>{i(n.filter(t=>t!==e)),c(!0)},h=e=>{let t=(n.findIndex(t=>t===e)+1)%n.length;return n[t]},p=e=>{u(e,o?.split("-")[0]!=e,!0)};return{bookKeys:n,appendBook:u,dismissBook:d,getNextBookKey:h,openParallelView:p}};var to=r,ts=m,tl=A,tc=o,tf=ec,tu=e.i(180718),td=eV,th=M,tp=e8,tb=r,tm=n,tg=m,ty=ec,tv=k,tx=M,tw=A,tS=eV;let tk=e=>"left"===e?"right":"right"===e?"left":e,t_=(e,t)=>!!e&&!!t&&e.book.rendition?.layout==="pre-paginated"&&(t.zoomLevel>100||"fit-page"!==t.zoomMode),tE=(e,t)=>!!e&&!!t&&t_(e,t)&&e.isOverflowX(),tM=(e,t)=>!!e&&!!t&&t_(e,t)&&e.isOverflowY(),tN=(e,t,r,n="page",i=50)=>{if(!e||!t)return;let a=e.renderer;if("rtl"===e.book.dir&&(r=tk(r)),a.scrolled){let{size:i}=a,o=t.showHeader&&t.showBarsOnScroll,s=t.showFooter&&t.showBarsOnScroll,l=i-t.scrollingOverlap-44*!!o-44*!!s;return"section"!==n?"left"===r||"up"===r?e.prev(l):e.next(l):"left"===r||"up"===r?e.renderer.prevSection?.():e.renderer.nextSection?.()}if("pan"===n&&t_(e,t))if(tE(e,t)&&("left"===r||"right"===r))return e.pan("left"===r?-i:i,0);else if(tM(e,t)&&("up"===r||"down"===r))return e.pan(0,"up"===r?-i:i);else return"left"===r||"up"===r?e.prev():e.next();return"section"!==n?"left"===r||"up"===r?e.prev():e.next():"left"===r||"up"===r?e.renderer.prevSection?.():e.renderer.nextSection?.()},tA=(e,t,r)=>{let{appService:n}=(0,tm.useEnv)(),{getBookData:i}=(0,ty.useBookDataStore)(),{getViewSettings:a,getViewState:o}=(0,tg.useReaderStore)(),{hoveredBookKey:s,setHoveredBookKey:l}=(0,tg.useReaderStore)(),{acquireVolumeKeyInterception:c,releaseVolumeKeyInterception:f}=(0,tv.useDeviceControlStore)(),u=async c=>{let f=o(e),u=i(e);if(f?.inited&&u){if(c instanceof MessageEvent){if(c.data&&c.data.bookKey===e){let i=a(e);if("iframe-single-click"===c.data.type){let a=r.current;if(a){let r,{screenX:o}=c.data,f=a.getBoundingClientRect(),u=(r=(0,tw.isTauriAppPlatform)()?n?.isMobile?0:(await (0,tS.tauriGetWindowLogicalPosition)()).x:window.screenX)+f.left,d=u+f.width/2;if(!tx.eventDispatcher.dispatchSync("iframe-single-click")){let r=u+.375*f.width,n=u+.625*f.width;if(i.disableClick||o>=r&&o<=n)l(s?null:e);else{if(s)return void l(null);!i.disableClick&&o>=d?i.fullscreenClickArea?tN(t.current,i,"down"):i.swapClickArea?tN(t.current,i,"left"):tN(t.current,i,"right"):!i.disableClick&&o<d&&(i.fullscreenClickArea?tN(t.current,i,"down"):i.swapClickArea?tN(t.current,i,"right"):tN(t.current,i,"left"))}}}}else if("iframe-wheel"!==c.data.type||i.scrolled||t_(t.current,i))"iframe-mouseup"===c.data.type&&(3===c.data.button?t.current?.history.back():4===c.data.button&&t.current?.history.forward());else{let{deltaY:e}=c.data;e>0?t.current?.next(1):e<0&&t.current?.prev(1)}}}else if(c instanceof CustomEvent){let r=a(e);if("native-key-down"===c.type&&r?.volumeKeysToFlip){let{keyName:e}=c.detail;l(""),"VolumeUp"===e?tN(t.current,r,"up"):"VolumeDown"===e&&tN(t.current,r,"down")}else if("touch-swipe"===c.type&&u.isFixedLayout&&!t_(t.current,r)){let{deltaX:e,deltaY:n,deltaT:i}=c.detail,a=Math.abs(e/i);Math.abs(e)>Math.abs(n)&&Math.abs(e)>30&&a>.2&&(e>0?tN(t.current,r,"left"):tN(t.current,r,"right"))}}else if("click"===c.type){let{clientX:r}=c,n=window.innerWidth,i=.5*n,o=.5*n,s=a(e);r<i?tN(t.current,s,"left"):r>o&&tN(t.current,s,"right")}}},d=(r,n,o)=>{let s=t.current?.renderer,l=a(e),c=i(e);if(c.bookDoc?.rendition?.layout!=="pre-paginated"&&s&&l.scrolled&&l.continuousScroll){let e=()=>{s.start<=n&&n>o?setTimeout(()=>{t.current?.prev(s.start+1)},100):Math.ceil(s.end)-n>=s.viewSize&&n<-o&&setTimeout(()=>{t.current?.next(s.viewSize-Math.floor(s.end)+1)},100)};"mouse"===r?e():"touch"===r&&(s.size>=s.viewSize?e():s.addEventListener("relocate",()=>e(),{once:!0}))}};return(0,tb.useEffect)(()=>{if(!n?.isMobileApp)return;let t=a(e);return t?.volumeKeysToFlip?c():f(),tx.eventDispatcher.on("native-key-down",u),()=>{f(),tx.eventDispatcher.off("native-key-down",u)}},[]),{handlePageFlip:u,handleContinuousScroll:d}};var tT=e.i(452612);let tR=({sideBarBookKey:e,bookKeys:t})=>{let{getView:r,getViewState:n,getViewSettings:i,setViewSettings:a}=(0,ts.useReaderStore)(),{toggleSideBar:o,setSideBarBookKey:s}=x(),{setSettingsDialogOpen:l}=(0,tc.useSettingsStore)(),{getBookData:c}=(0,tf.useBookDataStore)(),{toggleNotebook:f}=w(),{getNextBookKey:u}=ta(),d=i(e??""),h=(d?.defaultFontSize??16)*(d?.lineHeight??1.6)*3,p=()=>{let t=i(e??"");if(t&&e){t.scrolled=!t.scrolled,a(e,t);let n=t.scrolled?"scrolled":"paginated";r(e)?.renderer.setAttribute("flow",n)}},b=()=>{e&&s(u(e))},m=()=>{let t=i(e??"");tN(r(e),t,"left","pan",h)},g=()=>{let t=i(e??"");tN(r(e),t,"right","pan",h)},y=t=>{let n=r(e),a=i(e??"");n?.renderer.scrolled&&t instanceof MessageEvent||tN(n,a,"up","pan",h)},v=t=>{let n=r(e),a=i(e??"");n?.renderer.scrolled&&t instanceof MessageEvent||tN(n,a,"down","pan",h)},S=()=>{let t=i(e??"");tN(r(e),t,"up","section")},k=()=>{let t=i(e??"");tN(r(e),t,"down","section")},_=()=>{let t=i(e??"");tN(r(e),t,"left","section")},E=()=>{let t=i(e??"");tN(r(e),t,"right","section")},M=()=>{r(e)?.prev(h)},N=()=>{r(e)?.next(h)},A=()=>{r(e)?.history.back()},T=()=>{let t=r(e),n=i(e??"");t&&n&&n.scrolled&&t.next(t.renderer.size/2)},R=()=>{let t=r(e),n=i(e??"");t&&n&&n.scrolled&&t.prev(t.renderer.size/2)},C=()=>{r(e)?.history.forward()},j=()=>{window.location.reload()},I=async()=>{(0,tl.isTauriAppPlatform)()&&await (0,td.tauriHandleToggleFullScreen)()},L=async()=>{(0,tl.isTauriAppPlatform)()&&await (0,td.tauriHandleClose)()},P=async()=>{(0,tl.isTauriAppPlatform)()&&await (0,td.tauriQuitApp)()},B=()=>{setTimeout(()=>{th.eventDispatcher.dispatch("search-term",{term:null,bookKey:e})},100)},O=t=>{if(!e)return;let n=r(e),o=c(e),s=i(e);s.zoomLevel=t,a(e,s),n?.renderer.setStyles?.((0,tu.getStyles)(s)),o?.bookDoc?.rendition?.layout==="pre-paginated"&&n?.renderer.setAttribute("scale-factor",t)},D=(t=1)=>{e&&O(Math.min(i(e).zoomLevel+tp.ZOOM_STEP*t,tp.MAX_ZOOM_LEVEL))},z=(t=1)=>{e&&O(Math.max(i(e).zoomLevel-tp.ZOOM_STEP*t,tp.MIN_ZOOM_LEVEL))},F=()=>{D()},U=()=>{z()},$=e=>{D(e.detail?.factor||1)},H=e=>{z(e.detail?.factor||1)},q=()=>{e&&O(100)},V=()=>{if(!e)return;let t=e,r=n(t);th.eventDispatcher.dispatch(r?.ttsEnabled?"tts-stop":"tts-speak",{bookKey:t})},W=()=>{e&&th.eventDispatcher.dispatch("toggle-bookmark",{bookKey:e})};(0,to.useEffect)(()=>(th.eventDispatcher.on("zoom-in",$),th.eventDispatcher.on("zoom-out",H),th.eventDispatcher.on("reset-zoom",q),()=>{th.eventDispatcher.off("zoom-in",$),th.eventDispatcher.off("zoom-out",H),th.eventDispatcher.off("reset-zoom",q)}),[e]),(0,tT.default)({onSwitchSideBar:b,onToggleSideBar:o,onToggleNotebook:f,onToggleScrollMode:p,onToggleBookmark:W,onOpenFontLayoutSettings:()=>l(!0),onShowSearchBar:B,onToggleFullscreen:I,onToggleTTS:V,onReloadPage:j,onCloseWindow:L,onQuitApp:P,onGoLeft:m,onGoRight:g,onGoUp:y,onGoDown:v,onGoPrev:M,onGoNext:N,onGoHalfPageDown:T,onGoHalfPageUp:R,onGoPrevSection:S,onGoNextSection:k,onGoLeftSection:_,onGoRightSection:E,onGoBack:A,onGoForward:C,onZoomIn:F,onZoomOut:U,onResetZoom:q},[e,t])};var tC=e.i(409383),tj=t,tI=e.i(150773),tL=c,tP=r,tB=e.i(837122),tO=o,tD=ec,tz=m,tF=i,tU=M,t$=eJ,tH=n,tq=e.i(647110),tV=b,tW=e.i(727309),tK=tT,tG=t,tX=c,tY=e.i(943897);function tZ(e){return(0,tY.GenIcon)({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M169 57v430h78V57h-78zM25 105v190h46V105H25zm158 23h18v320h-18V128zm128.725 7.69l-45.276 8.124 61.825 344.497 45.276-8.124-61.825-344.497zM89 153v270h62V153H89zm281.502 28.68l-27.594 11.773 5.494 12.877 27.594-11.773-5.494-12.877zm12.56 29.433l-27.597 11.772 5.494 12.877 27.593-11.772-5.492-12.877zm12.555 29.434l-27.594 11.77 99.674 233.628 27.594-11.773-99.673-233.625zM25 313v30h46v-30H25zm190 7h18v128h-18V320zM25 361v126h46V361H25zm64 80v46h62v-46H89z"},child:[]}]})(e)}var tJ=e.i(534094),tQ=e.i(875245),t0=i,t1=e.i(698353),t2=e.i(34970),t3=e.i(209051),t6=t,t4=c,t8=r,t5=e.i(542748),t9=tQ,t7=u,re=n,rt=e.i(57290),rr=m,rn=e.i(559147),ri=i,ra=o,ro=A,rs=M,rl=e.i(27357),rc=e8,rf=eY,ru=e.i(132810),rd=I,rh=e.i(887442),rp=e.i(549651);let rb=({menuClassName:e,setIsDropdownOpen:t})=>{let r=(0,ri.useTranslation)(),n=(0,t7.useRouter)(),{envConfig:i,appService:a}=(0,re.useEnv)(),{user:o}=(0,rt.useAuth)(),{settings:s}=(0,ra.useSettingsStore)(),{bookKeys:l,recreateViewer:c,getViewSettings:f,setViewSettings:u}=(0,rr.useReaderStore)(),{getVisibleLibrary:d}=(0,rn.useLibraryStore)(),{openParallelView:h}=ta(),{sideBarBookKey:p}=x(),{parallelViews:b,setParallel:m,unsetParallel:g}=tn(),y=f(p),[v,w]=t8.default.useState(y?.sortedTOC||!1),S=e=>{h(e),t?.(!1)},k=()=>{window.location.reload(),t?.(!1)},_=()=>{(0,rd.setAboutDialogVisible)(!0),t?.(!1)},E=()=>{window.open(rc.DOWNLOAD_READEST_URL,"_blank"),t?.(!1)},M=()=>{rs.eventDispatcher.dispatch("export-annotations",{bookKey:p}),t?.(!1)},N=()=>{if(w(e=>!e),t?.(!1),p){let e=f(p);e.sortedTOC=!v,u(p,e),c(i,p)}},A=()=>{m(l),t?.(!1)},T=()=>{g(l),t?.(!1)},R=()=>{Q(!0),t?.(!1)},C=()=>{eA(!0),t?.(!1)},j=()=>{rs.eventDispatcher.dispatch("pull-kosync",{bookKey:p}),t?.(!1)},I=()=>{rs.eventDispatcher.dispatch("push-kosync",{bookKey:p}),t?.(!1)},L=()=>{let e=!s.discordRichPresenceEnabled;(0,ru.saveSysSettings)(i,"discordRichPresenceEnabled",e),t?.(!1),e&&!o&&(0,rf.navigateToLogin)(n)};return(0,t6.jsxs)(rp.default,{className:(0,t4.default)("book-menu dropdown-content z-20 shadow-2xl",e),onCancel:()=>t?.(!1),children:[(0,t6.jsx)(rh.default,{label:r("Parallel Read"),buttonClass:l.length>1?"lg:tooltip lg:tooltip-bottom":"",tooltip:b.length>0?r("Disable"):l.length>1?r("Enable"):"",Icon:b.length>0&&l.length>1?t9.MdCheck:void 0,onClick:b.length>0?T:l.length>1?A:void 0,children:(0,t6.jsx)("ul",{className:"max-h-60 overflow-y-auto",children:d().filter(e=>!rl.FIXED_LAYOUT_FORMATS.has(e.format)).filter(e=>!!e.downloadedAt).slice(0,20).map(e=>(0,t6.jsx)(rh.default,{Icon:(0,t6.jsx)(t5.default,{src:e.coverImageUrl,alt:e.title,width:56,height:80,className:"aspect-auto max-h-8 max-w-4 rounded-sm shadow-md",onError:e=>{e.target.style.display="none"}}),label:e.title,labelClass:"max-w-36",onClick:()=>S(e.hash)},e.hash))})}),l.length>1&&(b.length>0?(0,t6.jsx)(rh.default,{label:r("Exit Parallel Read"),onClick:T}):(0,t6.jsx)(rh.default,{label:r("Enter Parallel Read"),onClick:A})),(0,t6.jsx)("hr",{className:"border-base-200 my-1"}),(0,t6.jsx)(rh.default,{label:r("KOReader Sync"),onClick:R}),s.kosync.enabled&&(0,t6.jsxs)(t6.Fragment,{children:[(0,t6.jsx)(rh.default,{label:r("Push Progress"),onClick:I}),(0,t6.jsx)(rh.default,{label:r("Pull Progress"),onClick:j})]}),a?.isDesktopApp&&(0,t6.jsxs)(t6.Fragment,{children:[(0,t6.jsx)("hr",{className:"border-base-200 my-1"}),(0,t6.jsx)(rh.default,{label:r("Show on Discord"),tooltip:r("Display what I'm reading on Discord"),toggled:s.discordRichPresenceEnabled,onClick:L})]}),(0,t6.jsx)("hr",{className:"border-base-200 my-1"}),(0,t6.jsx)(rh.default,{label:r("Proofread"),onClick:C}),(0,t6.jsx)("hr",{className:"border-base-200 my-1"}),(0,t6.jsx)(rh.default,{label:r("Export Annotations"),onClick:M}),(0,t6.jsx)(rh.default,{label:r("Sort TOC by Page"),Icon:v?t9.MdCheck:void 0,onClick:N}),(0,t6.jsx)(rh.default,{label:r("Reload Page"),shortcut:"Shift+R",onClick:k}),(0,t6.jsx)("hr",{className:"border-base-200 my-1"}),(0,ro.isWebAppPlatform)()&&(0,t6.jsx)(rh.default,{label:r("Download Readest"),onClick:E}),(0,t6.jsx)(rh.default,{label:r("About Readest"),onClick:_})]})},rm=({isPinned:e,isSearchBarVisible:t,onGoToLibrary:r,onClose:n,onTogglePin:i,onToggleSearchBar:a})=>{let o=(0,t0.useTranslation)(),{isTrafficLightVisible:s}=(0,t1.useTrafficLight)(),l=(0,t2.useResponsiveSize)(14),c=(0,t2.useResponsiveSize)(18),f=(0,t2.useResponsiveSize)(22);return(0,tG.jsxs)("div",{className:(0,tX.default)("sidebar-header flex h-11 items-center justify-between pe-2",s?"ps-1.5 sm:ps-20":"ps-1.5"),dir:"ltr",children:[(0,tG.jsxs)("div",{className:"flex items-center gap-x-8",children:[(0,tG.jsx)("button",{title:o("Close"),onClick:n,className:"btn btn-ghost btn-circle flex h-6 min-h-6 w-6 hover:bg-transparent sm:hidden",children:(0,tG.jsx)(tQ.MdArrowBackIosNew,{size:f})}),(0,tG.jsx)("button",{title:o("Go to Library"),className:"btn btn-ghost hidden h-8 min-h-8 w-8 p-0 sm:flex",onClick:r,children:(0,tG.jsx)(tZ,{className:"fill-base-content"})})]}),(0,tG.jsxs)("div",{className:"flex min-w-24 max-w-32 items-center justify-between sm:size-[70%]",children:[(0,tG.jsx)("button",{title:o(t?"Hide Search Bar":"Show Search Bar"),onClick:a,className:(0,tX.default)("btn btn-ghost left-0 h-8 min-h-8 w-8 p-0",t?"bg-base-300":""),children:(0,tG.jsx)(tJ.FiSearch,{size:c,className:"text-base-content"})}),(0,tG.jsx)(t3.default,{label:o("Book Menu"),className:(0,tX.default)(window.innerWidth<640&&"dropdown-end","dropdown-bottom flex justify-center"),menuClassName:window.innerWidth<640?"no-triangle mt-1":"dropdown-center mt-1",buttonClassName:"btn btn-ghost h-8 min-h-8 w-8 p-0",toggleButton:(0,tG.jsx)(tQ.MdOutlineMenu,{className:"fill-base-content"}),children:(0,tG.jsx)(rb,{})}),(0,tG.jsx)("div",{className:"right-0 hidden h-8 w-8 items-center justify-center sm:flex",children:(0,tG.jsx)("button",{title:o(e?"Unpin Sidebar":"Pin Sidebar"),onClick:i,className:(0,tX.default)("sidebar-pin-btn btn btn-ghost btn-circle hidden h-6 min-h-6 w-6 sm:flex",e?"bg-base-300":"bg-base-300/65"),children:e?(0,tG.jsx)(tQ.MdPushPin,{size:l}):(0,tG.jsx)(tQ.MdOutlinePushPin,{size:l})})})]})]})};var rg=t,ry=c,rv=r,rx=b,rw=m,rS=ec,rk=e.i(267813),r_=t,rE=r,rM=e.i(569807),rN=rk,rA=n,rT=m,rR=e.i(947181),rC=M,rj=Y,rI=r,rL=m,rP=e.i(477737);let rB=(e,t=[])=>{let r=[],n=(e,i=0)=>{if(!(i>15))for(let a of(e instanceof HTMLElement&&e.shadowRoot&&n(e.shadowRoot,i+1),"children"in e?Array.from(e.children):[])){if("STYLE"===a.tagName||"LINK"===a.tagName||t.includes(a.tagName.toLowerCase()))continue;if(a.shadowRoot&&n(a.shadowRoot,i+1),"IFRAME"===a.tagName){let e=a,t=e.contentDocument||e.contentWindow?.document;t&&t.body&&n(t.body,i+1)}let e=a.childNodes&&Array.from(a.childNodes).some(e=>!!(e.nodeType===Node.TEXT_NODE&&e.textContent?.trim()||e.nodeType===Node.ELEMENT_NODE&&"SPAN"===e.tagName&&e.textContent?.trim()));0===a.children.length&&a.textContent?.trim()||e?r.push(a):a.children.length>0&&n(a,i+1)}};return n(e),r};var rO=X,rD=Y;function rz(e,t,r=!1,n="translation-target-block"){let{getViewSettings:i,getProgress:a}=(0,rL.useReaderStore)(),o=i(e),s=a(e),l=(0,rI.useRef)(o?.translationEnabled),[c,f]=(0,rI.useState)(o?.translationProvider),[u,d]=(0,rI.useState)(o?.translateTargetLang),h=(0,rI.useRef)(o?.showTranslateSource),{translate:p}=(0,rP.useTranslator)({provider:c,targetLang:u||(0,rD.getLocale)()}),b=(0,rI.useRef)(p),m=(0,rI.useRef)(null),g=(0,rI.useRef)([]),y=(0,rI.useRef)([]),v=e=>{g.current.forEach(t=>{t.querySelectorAll(".translation-target").forEach(t=>{e?t.classList.remove("hidden"):t.classList.add("hidden")})})};(0,rI.useEffect)(()=>{b.current=p},[p]);let x=()=>{if(!t||!l.current)return;let e=S();m.current=e;let r=rB(t,["pre","code","math"]);console.log("Observing text nodes for translation:",r.length),y.current=r,r.forEach(t=>e.observe(t))},w=()=>{g.current.forEach(e=>{e.querySelectorAll(".translation-target").forEach(e=>e.remove())}),g.current=[],o?.translationEnabled&&t&&_()},S=()=>new IntersectionObserver(e=>{let t=null,r=null;for(let n of e){if(!n.isIntersecting){r||(t=n.target);continue}let e=n.target;E(e),r=e}t&&E(t),r&&k(r,2)},{rootMargin:"1280px",threshold:0}),k=(e,t)=>{if(!y.current||t<=0)return;let r=y.current.indexOf(e);-1===r||y.current.slice(r+1,r+1+t).forEach((e,t)=>{setTimeout(()=>{E(e)},500*t)})},_=()=>{let e=S();m.current?.disconnect(),m.current=e,y.current.forEach(t=>e.observe(t))},E=async e=>{if(!l.current)return;let t=e.textContent?.replaceAll("\n","").trim();if(!t||e.classList.contains("translation-target"))return;let i=e=>{if(Array.from(e.childNodes).some(e=>e.nodeType===Node.TEXT_NODE&&e.textContent?.trim()!=="")){e.classList.add("translation-source");let t=Array.from(e.childNodes).filter(e=>e.nodeType===Node.TEXT_NODE&&e.textContent?.trim()!=="");e.hasAttribute("original-text-stored")||(e.setAttribute("original-text-nodes",JSON.stringify(t.map(e=>e.textContent))),e.setAttribute("original-text-stored","true"))}if(e.classList.contains("translation-source")){let t=Array.from(e.childNodes).filter(e=>e.nodeType===Node.TEXT_NODE);if(h.current){let r=JSON.parse(e.getAttribute("original-text-nodes")||"[]");t.forEach((e,t)=>{void 0!==r[t]&&(e.textContent=r[t])})}else t.forEach(e=>{e.textContent=""})}for(let t of Array.from(e.childNodes)){if(t.nodeType!==Node.ELEMENT_NODE)continue;let e=t;e.classList.contains("translation-target")||i(e)}};i(e);try{let i=(await b.current([t]))[0];if(!i||t===i)return;let a=document.createElement("font");a.className=`translation-target ${!l.current?"hidden":""}`,a.setAttribute("translation-element-mark","1"),a.setAttribute("lang",u||(0,rD.getLocale)()),r&&a.appendChild(document.createElement("br"));let o=document.createElement("font");o.className=`translation-target ${n}`;let s=document.createElement("font");if(s.className="translation-target target-inner target-inner-theme-none",s.textContent=i,o.appendChild(s),a.appendChild(o),e.querySelector(".translation-target"))return;e.appendChild(a),g.current.push(e)}catch(e){console.warn("Translation failed:",e)}},M=(e,t)=>{let r=e.startContainer,n=e.endContainer,i=-1,a=-1;for(let e=0;e<t.length;e++){let o=t[e];(o===r||o.contains(r))&&-1===i&&(i=e),(o===n||o.contains(n))&&(a=e)}return -1!==i&&-1===a&&(a=i),{startIndex:i,endIndex:a}},N=(0,rI.useCallback)((0,rO.debounce)(e=>{let t=y.current;if(0===t.length)return void console.warn("No text nodes available for translation.");let{startIndex:r,endIndex:n}=M(e,t);if(-1===r)return void console.log("Range not found in text nodes");let i=5,a=Math.max(0,r-2),o=Math.min(t.length-1,n+i);for(let e=a;e<=o;e++){let r=t[e];r&&E(r)}},500),[E]);(0,rI.useEffect)(()=>{if(l.current&&s){let{range:e}=s;N(e)}},[s]),(0,rI.useEffect)(()=>{if(!o)return;let e=l.current!==o.translationEnabled,t=c!==o.translationProvider,r=u!==o.translateTargetLang,n=h.current!==o.showTranslateSource;e&&(l.current=o.translationEnabled),t&&f(o.translationProvider),r&&d(o.translateTargetLang),n&&(h.current=o.showTranslateSource),e?(v(o.translationEnabled),l.current&&x()):(t||r||n)&&w()},[e,o,c,u]),(0,rI.useEffect)(()=>{if(t&&l.current)return"renderer"in t?t.addEventListener("load",x):x(),()=>{"renderer"in t&&t.removeEventListener("load",x),m.current?.disconnect(),g.current=[]}},[t])}var rF=t,rU=c,r$=r,rH=Y;let rq=e=>(0,rF.jsx)("svg",{viewBox:"0 0 8 10",width:"8",height:"10",className:(0,rU.default)("text-base-content transform transition-transform",e?"rotate-90":"rotate-0"),style:{transformOrigin:"center"},fill:"currentColor",children:(0,rF.jsx)("polygon",{points:"0 0, 8 5, 0 10"})}),rV=r$.default.memo(({flatItem:e,itemSize:t,isActive:r,onToggleExpand:n,onItemClick:i})=>{let{item:a,depth:o}=e,s=(0,r$.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),n(a)},[a,n]),l=(0,r$.useCallback)(e=>{e.preventDefault(),i(a)},[a,i]);return(0,rF.jsxs)("div",{tabIndex:0,role:"treeitem",onClick:a.href?l:void 0,onKeyDown:a.href?e=>"Enter"===e.key&&l(e):void 0,"aria-expanded":e.isExpanded?"true":"false","aria-selected":r?"true":"false","data-href":a.href?(0,rH.getContentMd5)(a.href):void 0,className:(0,rU.default)("flex w-full cursor-pointer items-center rounded-md py-4 sm:py-2",r?"text-bold-in-eink sm:bg-base-300/65 sm:hover:bg-base-300/75 sm:text-base-content text-blue-500":"sm:hover:bg-base-300/75"),style:{height:t?`${t}px`:"auto",paddingInlineStart:`${(o+1)*12}px`},children:[a.subitems&&(0,rF.jsx)("button",{onClick:s,onKeyDown:e=>{e.stopPropagation()},className:"inline-block cursor-pointer",style:{padding:"12px",margin:"-12px"},children:rq(e.isExpanded||!1)}),(0,rF.jsx)("div",{className:"ms-2 truncate text-ellipsis",style:{maxWidth:"calc(100% - 24px)",whiteSpace:"nowrap",textOverflow:"ellipsis"},children:a.label}),a.location&&(0,rF.jsx)("div",{className:"text-base-content/50 ms-auto ps-1 text-xs sm:pe-1",children:a.location.current+1})]})});rV.displayName="TOCItemView";let rW=({bookKey:e,flatItem:t,itemSize:r,activeHref:n,onToggleExpand:i,onItemClick:a})=>{let o=n===t.item.href;return(0,rF.jsx)("div",{className:(0,rU.default)("border-base-300 w-full border-b sm:border-none","pe-4 ps-2 pt-[1px] sm:pe-2"),title:t.item.label||"",children:(0,rF.jsx)(rV,{bookKey:e,flatItem:t,itemSize:r,isActive:o,onToggleExpand:i,onItemClick:a})})},rK=({index:e,style:t,data:r})=>{let{flatItems:n,bookKey:i,activeHref:a,itemSize:o,onToggleExpand:s,onItemClick:l}=r,c=n[e];return(0,rF.jsx)("div",{style:t,title:c.item.label||"",children:(0,rF.jsx)(rW,{bookKey:i,flatItem:c,itemSize:o-1,activeHref:a,onToggleExpand:s,onItemClick:l})})},rG=e=>{let t=e.href||"";return`toc-item-${e.id}-${t}`},rX=(e,t)=>(0,rE.useMemo)(()=>{let r=(e,n=0)=>{let i=[];return e.forEach((e,a)=>{let o=t.has(rG(e));i.push({item:e,depth:n,index:a,isExpanded:o}),e.subitems&&o&&i.push(...r(e.subitems,n+1))}),i};return r(e)},[e,t]),rY=({bookKey:e,toc:t,sections:r})=>{let{appService:n}=(0,rA.useEnv)(),{getView:i,getProgress:a,getViewSettings:o}=(0,rT.useReaderStore)(),{sideBarBookKey:s,isSideBarVisible:l}=x(),c=o(e),f=a(e),[u,d]=(0,rE.useState)(new Set),[h,p]=(0,rE.useState)(400),b=(0,rE.useRef)(!1),m=(0,rE.useRef)(0),g=1e4,y=(0,rE.useRef)(null),v=(0,rE.useRef)(null),w=(0,rE.useRef)(null),S=(0,rE.useRef)(null),[k]=(0,rN.useOverlayScrollbars)({defer:!0,options:{scrollbars:{autoHide:"scroll"},showNativeOverlaidScrollbars:!1},events:{initialized(e){let{viewport:t}=e.elements();t.style.overflowX="var(--os-viewport-overflow-x)",t.style.overflowY="var(--os-viewport-overflow-y)"}}}),_=(0,rE.useCallback)(()=>!!b.current&&(!(Date.now()-m.current>=g)||(b.current=!1,!1)),[]),E=(0,rE.useCallback)(()=>{setTimeout(()=>{b.current=!0,m.current=Date.now()},500)},[]);(0,rE.useEffect)(()=>{let{current:e}=y,{current:t}=v;if(e&&t)return k({target:e,elements:{viewport:t}}),t.addEventListener("scroll",E),()=>{t.removeEventListener("scroll",E)}},[k,E]),rz(e,y.current||S.current,!1,"translation-target-toc"),(0,rE.useEffect)(()=>{let e=()=>{if(y.current){let e=y.current.getBoundingClientRect(),t=y.current.closest(".scroll-container");if(t){let r=t.getBoundingClientRect();p(Math.max(400,r.height-(e.top-r.top)))}}};e(),window.addEventListener("resize",e);let t=null;if(y.current){let r=y.current.closest(".scroll-container");r&&(t=new ResizeObserver(e)).observe(r)}let r=S.current,n=null;return r&&(n=r.parentElement)&&n.addEventListener("scroll",E),()=>{window.removeEventListener("resize",e),t&&t.disconnect(),n&&n.removeEventListener("scroll",E)}},[u,E]);let M=(0,rE.useMemo)(()=>f?.sectionHref||null,[f?.sectionHref]),N=rX(t,u),A=(0,rE.useMemo)(()=>N.findIndex(e=>e.item.href===M),[N,M]),T=(0,rE.useCallback)(e=>{let t=rG(e);E(),d(e=>{let r=new Set(e);return r.has(t)?r.delete(t):r.add(t),r})},[E]),R=(0,rE.useCallback)(t=>{rC.eventDispatcher.dispatch("navigate",{bookKey:e,href:t.href}),t.href&&i(e)?.goTo(t.href)},[e,i]),C=(0,rE.useCallback)((e,t)=>{d(new Set((0,rR.findParentPath)(e,t).map(e=>rG(e)).filter(Boolean)))},[]),j=(0,rE.useCallback)(()=>{if(M){if(w.current){let e=N.findIndex(e=>e.item.href===M);-1!==e&&w.current.scrollToItem(e,"center")}if(S.current){let e=M?(0,rj.getContentMd5)(M):"",t=S.current?.querySelector(`[data-href="${e}"]`);if(t){let e=S.current.parentElement.getBoundingClientRect(),r=t.getBoundingClientRect();r.top>=e.top&&r.bottom<=e.bottom||t.scrollIntoView({behavior:"instant",block:"center"}),t.setAttribute("aria-current","page")}}}},[N,M]),I=(0,rE.useMemo)(()=>window.innerWidth>=640&&!c?.translationEnabled?37:57,[c?.translationEnabled]),L=(0,rE.useMemo)(()=>({flatItems:N,itemSize:I,bookKey:e,activeHref:M,onToggleExpand:T,onItemClick:R}),[N,I,e,M,T,R]);return(0,rE.useEffect)(()=>{if(!f||!l||s!==e||_())return;let{sectionHref:r}=f;r&&C(t,r)},[t,f,s,l,e,C,_]),(0,rE.useEffect)(()=>{!_()&&N.length>0&&setTimeout(j,n?.isAndroidApp?300:100)},[f,j,_]),r&&r.length>256?(0,r_.jsx)("div",{className:"virtual-list mt-2 rounded","data-overlayscrollbars-initialize":"",ref:y,children:(0,r_.jsx)(rM.FixedSizeList,{ref:w,outerRef:v,width:"100%",height:h,itemCount:N.length,itemSize:I,itemData:L,overscanCount:20,initialScrollOffset:n?.isAndroidApp&&A>=0?Math.max(0,A*I-h/2):void 0,children:rK})}):(0,r_.jsx)("div",{className:"static-list mt-2 rounded",ref:S,children:N.map((t,r)=>(0,r_.jsx)(rW,{bookKey:e,flatItem:t,activeHref:M,onToggleExpand:T,onItemClick:R},`static-row-${r}`))})};var rZ=t,rJ=e.i(399458),rQ=ec,r0=rR,r1=t,r2=c,r3=e.i(586295),r6=r;function r4(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}var r8=r4();function r5(e){r8=e}var r9={exec:()=>null};function r7(e,t=""){let r="string"==typeof e?e:e.source,n={replace:(e,t)=>{let i="string"==typeof t?t:t.source;return i=i.replace(ne.caret,"$1"),r=r.replace(e,i),n},getRegex:()=>new RegExp(r,t)};return n}var ne={codeRemoveIndent:/^(?: {1,4}| {0,3}\t)/gm,outputLinkReplace:/\\([\[\]])/g,indentCodeCompensation:/^(\s+)(?:```)/,beginningSpace:/^\s+/,endingHash:/#$/,startingSpaceChar:/^ /,endingSpaceChar:/ $/,nonSpaceChar:/[^ ]/,newLineCharGlobal:/\n/g,tabCharGlobal:/\t/g,multipleSpaceGlobal:/\s+/g,blankLine:/^[ \t]*$/,doubleBlankLine:/\n[ \t]*\n[ \t]*$/,blockquoteStart:/^ {0,3}>/,blockquoteSetextReplace:/\n {0,3}((?:=+|-+) *)(?=\n|$)/g,blockquoteSetextReplace2:/^ {0,3}>[ \t]?/gm,listReplaceTabs:/^\t+/,listReplaceNesting:/^ {1,4}(?=( {4})*[^ ])/g,listIsTask:/^\[[ xX]\] /,listReplaceTask:/^\[[ xX]\] +/,anyLine:/\n.*\n/,hrefBrackets:/^<(.*)>$/,tableDelimiter:/[:|]/,tableAlignChars:/^\||\| *$/g,tableRowBlankLine:/\n[ \t]*$/,tableAlignRight:/^ *-+: *$/,tableAlignCenter:/^ *:-+: *$/,tableAlignLeft:/^ *:-+ *$/,startATag:/^<a /i,endATag:/^<\/a>/i,startPreScriptTag:/^<(pre|code|kbd|script)(\s|>)/i,endPreScriptTag:/^<\/(pre|code|kbd|script)(\s|>)/i,startAngleBracket:/^</,endAngleBracket:/>$/,pedanticHrefTitle:/^([^'"]*[^\s])\s+(['"])(.*)\2/,unicodeAlphaNumeric:/[\p{L}\p{N}]/u,escapeTest:/[&<>"']/,escapeReplace:/[&<>"']/g,escapeTestNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,escapeReplaceNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/g,unescapeTest:/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig,caret:/(^|[^\[])\^/g,percentDecode:/%25/g,findPipe:/\|/g,splitPipe:/ \|/,slashPipe:/\\\|/g,carriageReturn:/\r\n|\r/g,spaceLine:/^ +$/gm,notSpaceStart:/^\S*/,endingNewline:/\n$/,listItemRegex:e=>RegExp(`^( {0,3}${e})((?:[	 ][^\\n]*)?(?:\\n|$))`),nextBulletRegex:e=>RegExp(`^ {0,${Math.min(3,e-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),hrRegex:e=>RegExp(`^ {0,${Math.min(3,e-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),fencesBeginRegex:e=>RegExp(`^ {0,${Math.min(3,e-1)}}(?:\`\`\`|~~~)`),headingBeginRegex:e=>RegExp(`^ {0,${Math.min(3,e-1)}}#`),htmlBeginRegex:e=>RegExp(`^ {0,${Math.min(3,e-1)}}<(?:[a-z].*>|!--)`,"i")},nt=/^(?:[ \t]*(?:\n|$))+/,nr=/^((?: {4}| {0,3}\t)[^\n]+(?:\n(?:[ \t]*(?:\n|$))*)?)+/,nn=/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,ni=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,na=/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,no=/(?:[*+-]|\d{1,9}[.)])/,ns=/^(?!bull |blockCode|fences|blockquote|heading|html|table)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html|table))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,nl=r7(ns).replace(/bull/g,no).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/\|table/g,"").getRegex(),nc=r7(ns).replace(/bull/g,no).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/table/g,/ {0,3}\|?(?:[:\- ]*\|)+[\:\- ]*\n/).getRegex(),nf=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,nu=/^[^\n]+/,nd=/(?!\s*\])(?:\\.|[^\[\]\\])+/,nh=r7(/^ {0,3}\[(label)\]: *(?:\n[ \t]*)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n[ \t]*)?| *\n[ \t]*)(title))? *(?:\n+|$)/).replace("label",nd).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),np=r7(/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,no).getRegex(),nb="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",nm=/<!--(?:-?>|[\s\S]*?(?:-->|$))/,ng=r7("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$))","i").replace("comment",nm).replace("tag",nb).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),ny=r7(nf).replace("hr",ni).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",nb).getRegex(),nv={blockquote:r7(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",ny).getRegex(),code:nr,def:nh,fences:nn,heading:na,hr:ni,html:ng,lheading:nl,list:np,newline:nt,paragraph:ny,table:r9,text:nu},nx=r7("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",ni).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code","(?: {4}| {0,3}	)[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",nb).getRegex(),nw={...nv,lheading:nc,table:nx,paragraph:r7(nf).replace("hr",ni).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",nx).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",nb).getRegex()},nS={...nv,html:r7(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",nm).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:r9,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:r7(nf).replace("hr",ni).replace("heading"," *#{1,6} *[^\n]").replace("lheading",nl).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()},nk=/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,n_=/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,nE=/^( {2,}|\\)\n(?!\s*$)/,nM=/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,nN=/[\p{P}\p{S}]/u,nA=/[\s\p{P}\p{S}]/u,nT=/[^\s\p{P}\p{S}]/u,nR=r7(/^((?![*_])punctSpace)/,"u").replace(/punctSpace/g,nA).getRegex(),nC=/(?!~)[\p{P}\p{S}]/u,nj=/(?!~)[\s\p{P}\p{S}]/u,nI=/(?:[^\s\p{P}\p{S}]|~)/u,nL=/\[[^[\]]*?\]\((?:\\.|[^\\\(\)]|\((?:\\.|[^\\\(\)])*\))*\)|`[^`]*?`|<[^<>]*?>/g,nP=/^(?:\*+(?:((?!\*)punct)|[^\s*]))|^_+(?:((?!_)punct)|([^\s_]))/,nB=r7(nP,"u").replace(/punct/g,nN).getRegex(),nO=r7(nP,"u").replace(/punct/g,nC).getRegex(),nD="^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)punct(\\*+)(?=[\\s]|$)|notPunctSpace(\\*+)(?!\\*)(?=punctSpace|$)|(?!\\*)punctSpace(\\*+)(?=notPunctSpace)|[\\s](\\*+)(?!\\*)(?=punct)|(?!\\*)punct(\\*+)(?!\\*)(?=punct)|notPunctSpace(\\*+)(?=notPunctSpace)",nz=r7(nD,"gu").replace(/notPunctSpace/g,nT).replace(/punctSpace/g,nA).replace(/punct/g,nN).getRegex(),nF=r7(nD,"gu").replace(/notPunctSpace/g,nI).replace(/punctSpace/g,nj).replace(/punct/g,nC).getRegex(),nU=r7("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)punct(_+)(?=[\\s]|$)|notPunctSpace(_+)(?!_)(?=punctSpace|$)|(?!_)punctSpace(_+)(?=notPunctSpace)|[\\s](_+)(?!_)(?=punct)|(?!_)punct(_+)(?!_)(?=punct)","gu").replace(/notPunctSpace/g,nT).replace(/punctSpace/g,nA).replace(/punct/g,nN).getRegex(),n$=r7(/\\(punct)/,"gu").replace(/punct/g,nN).getRegex(),nH=r7(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),nq=r7(nm).replace("(?:-->|$)","-->").getRegex(),nV=r7("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",nq).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),nW=/(?:\[(?:\\.|[^\[\]\\])*\]|\\.|`[^`]*`|[^\[\]\\`])*?/,nK=r7(/^!?\[(label)\]\(\s*(href)(?:(?:[ \t]*(?:\n[ \t]*)?)(title))?\s*\)/).replace("label",nW).replace("href",/<(?:\\.|[^\n<>\\])+>|[^ \t\n\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),nG=r7(/^!?\[(label)\]\[(ref)\]/).replace("label",nW).replace("ref",nd).getRegex(),nX=r7(/^!?\[(ref)\](?:\[\])?/).replace("ref",nd).getRegex(),nY=r7("reflink|nolink(?!\\()","g").replace("reflink",nG).replace("nolink",nX).getRegex(),nZ={_backpedal:r9,anyPunctuation:n$,autolink:nH,blockSkip:nL,br:nE,code:n_,del:r9,emStrongLDelim:nB,emStrongRDelimAst:nz,emStrongRDelimUnd:nU,escape:nk,link:nK,nolink:nX,punctuation:nR,reflink:nG,reflinkSearch:nY,tag:nV,text:nM,url:r9},nJ={...nZ,link:r7(/^!?\[(label)\]\((.*?)\)/).replace("label",nW).getRegex(),reflink:r7(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",nW).getRegex()},nQ={...nZ,emStrongRDelimAst:nF,emStrongLDelim:nO,url:r7(/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,"i").replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])((?:\\.|[^\\])*?(?:\\.|[^\s~\\]))\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/},n0={...nQ,br:r7(nE).replace("{2,}","*").getRegex(),text:r7(nQ.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()},n1={normal:nv,gfm:nw,pedantic:nS},n2={normal:nZ,gfm:nQ,breaks:n0,pedantic:nJ},n3={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},n6=e=>n3[e];function n4(e,t){if(t){if(ne.escapeTest.test(e))return e.replace(ne.escapeReplace,n6)}else if(ne.escapeTestNoEncode.test(e))return e.replace(ne.escapeReplaceNoEncode,n6);return e}function n8(e){try{e=encodeURI(e).replace(ne.percentDecode,"%")}catch{return null}return e}function n5(e,t){let r=e.replace(ne.findPipe,(e,t,r)=>{let n=!1,i=t;for(;--i>=0&&"\\"===r[i];)n=!n;return n?"|":" |"}).split(ne.splitPipe),n=0;if(r[0].trim()||r.shift(),r.length>0&&!r.at(-1)?.trim()&&r.pop(),t)if(r.length>t)r.splice(t);else for(;r.length<t;)r.push("");for(;n<r.length;n++)r[n]=r[n].trim().replace(ne.slashPipe,"|");return r}function n9(e,t,r){let n=e.length;if(0===n)return"";let i=0;for(;i<n;){let a=e.charAt(n-i-1);if(a!==t||r)if(a!==t&&r)i++;else break;else i++}return e.slice(0,n-i)}function n7(e,t){if(-1===e.indexOf(t[1]))return -1;let r=0;for(let n=0;n<e.length;n++)if("\\"===e[n])n++;else if(e[n]===t[0])r++;else if(e[n]===t[1]&&--r<0)return n;return r>0?-2:-1}function ie(e,t,r,n,i){let a=t.href,o=t.title||null,s=e[1].replace(i.other.outputLinkReplace,"$1");n.state.inLink=!0;let l={type:"!"===e[0].charAt(0)?"image":"link",raw:r,href:a,title:o,text:s,tokens:n.inlineTokens(s)};return n.state.inLink=!1,l}function it(e,t,r){let n=e.match(r.other.indentCodeCompensation);if(null===n)return t;let i=n[1];return t.split("\n").map(e=>{let t=e.match(r.other.beginningSpace);if(null===t)return e;let[n]=t;return n.length>=i.length?e.slice(i.length):e}).join("\n")}var ir=class{options;rules;lexer;constructor(e){this.options=e||r8}space(e){let t=this.rules.block.newline.exec(e);if(t&&t[0].length>0)return{type:"space",raw:t[0]}}code(e){let t=this.rules.block.code.exec(e);if(t){let e=t[0].replace(this.rules.other.codeRemoveIndent,"");return{type:"code",raw:t[0],codeBlockStyle:"indented",text:this.options.pedantic?e:n9(e,"\n")}}}fences(e){let t=this.rules.block.fences.exec(e);if(t){let e=t[0],r=it(e,t[3]||"",this.rules);return{type:"code",raw:e,lang:t[2]?t[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):t[2],text:r}}}heading(e){let t=this.rules.block.heading.exec(e);if(t){let e=t[2].trim();if(this.rules.other.endingHash.test(e)){let t=n9(e,"#");this.options.pedantic?e=t.trim():(!t||this.rules.other.endingSpaceChar.test(t))&&(e=t.trim())}return{type:"heading",raw:t[0],depth:t[1].length,text:e,tokens:this.lexer.inline(e)}}}hr(e){let t=this.rules.block.hr.exec(e);if(t)return{type:"hr",raw:n9(t[0],"\n")}}blockquote(e){let t=this.rules.block.blockquote.exec(e);if(t){let e=n9(t[0],"\n").split("\n"),r="",n="",i=[];for(;e.length>0;){let t,a=!1,o=[];for(t=0;t<e.length;t++)if(this.rules.other.blockquoteStart.test(e[t]))o.push(e[t]),a=!0;else if(a)break;else o.push(e[t]);e=e.slice(t);let s=o.join("\n"),l=s.replace(this.rules.other.blockquoteSetextReplace,"\n    $1").replace(this.rules.other.blockquoteSetextReplace2,"");r=r?`${r}
${s}`:s,n=n?`${n}
${l}`:l;let c=this.lexer.state.top;if(this.lexer.state.top=!0,this.lexer.blockTokens(l,i,!0),this.lexer.state.top=c,0===e.length)break;let f=i.at(-1);if(f?.type==="code")break;if(f?.type==="blockquote"){let t=f,a=t.raw+"\n"+e.join("\n"),o=this.blockquote(a);i[i.length-1]=o,r=r.substring(0,r.length-t.raw.length)+o.raw,n=n.substring(0,n.length-t.text.length)+o.text;break}if(f?.type==="list"){let t=f,a=t.raw+"\n"+e.join("\n"),o=this.list(a);i[i.length-1]=o,r=r.substring(0,r.length-f.raw.length)+o.raw,n=n.substring(0,n.length-t.raw.length)+o.raw,e=a.substring(i.at(-1).raw.length).split("\n");continue}}return{type:"blockquote",raw:r,tokens:i,text:n}}}list(e){let t=this.rules.block.list.exec(e);if(t){let r=t[1].trim(),n=r.length>1,i={type:"list",raw:"",ordered:n,start:n?+r.slice(0,-1):"",loose:!1,items:[]};r=n?`\\d{1,9}\\${r.slice(-1)}`:`\\${r}`,this.options.pedantic&&(r=n?r:"[*+-]");let a=this.rules.other.listItemRegex(r),o=!1;for(;e;){let r,n=!1,s="",l="";if(!(t=a.exec(e))||this.rules.block.hr.test(e))break;s=t[0],e=e.substring(s.length);let c=t[2].split("\n",1)[0].replace(this.rules.other.listReplaceTabs,e=>" ".repeat(3*e.length)),f=e.split("\n",1)[0],u=!c.trim(),d=0;if(this.options.pedantic?(d=2,l=c.trimStart()):u?d=t[1].length+1:(d=(d=t[2].search(this.rules.other.nonSpaceChar))>4?1:d,l=c.slice(d),d+=t[1].length),u&&this.rules.other.blankLine.test(f)&&(s+=f+"\n",e=e.substring(f.length+1),n=!0),!n){let t=this.rules.other.nextBulletRegex(d),r=this.rules.other.hrRegex(d),n=this.rules.other.fencesBeginRegex(d),i=this.rules.other.headingBeginRegex(d),a=this.rules.other.htmlBeginRegex(d);for(;e;){let o,h=e.split("\n",1)[0];if(f=h,o=this.options.pedantic?f=f.replace(this.rules.other.listReplaceNesting,"  "):f.replace(this.rules.other.tabCharGlobal,"    "),n.test(f)||i.test(f)||a.test(f)||t.test(f)||r.test(f))break;if(o.search(this.rules.other.nonSpaceChar)>=d||!f.trim())l+="\n"+o.slice(d);else{if(u||c.replace(this.rules.other.tabCharGlobal,"    ").search(this.rules.other.nonSpaceChar)>=4||n.test(c)||i.test(c)||r.test(c))break;l+="\n"+f}u||f.trim()||(u=!0),s+=h+"\n",e=e.substring(h.length+1),c=o.slice(d)}}!i.loose&&(o?i.loose=!0:this.rules.other.doubleBlankLine.test(s)&&(o=!0));let h=null;this.options.gfm&&(h=this.rules.other.listIsTask.exec(l))&&(r="[ ] "!==h[0],l=l.replace(this.rules.other.listReplaceTask,"")),i.items.push({type:"list_item",raw:s,task:!!h,checked:r,loose:!1,text:l,tokens:[]}),i.raw+=s}let s=i.items.at(-1);if(!s)return;s.raw=s.raw.trimEnd(),s.text=s.text.trimEnd(),i.raw=i.raw.trimEnd();for(let e=0;e<i.items.length;e++)if(this.lexer.state.top=!1,i.items[e].tokens=this.lexer.blockTokens(i.items[e].text,[]),!i.loose){let t=i.items[e].tokens.filter(e=>"space"===e.type);i.loose=t.length>0&&t.some(e=>this.rules.other.anyLine.test(e.raw))}if(i.loose)for(let e=0;e<i.items.length;e++)i.items[e].loose=!0;return i}}html(e){let t=this.rules.block.html.exec(e);if(t)return{type:"html",block:!0,raw:t[0],pre:"pre"===t[1]||"script"===t[1]||"style"===t[1],text:t[0]}}def(e){let t=this.rules.block.def.exec(e);if(t){let e=t[1].toLowerCase().replace(this.rules.other.multipleSpaceGlobal," "),r=t[2]?t[2].replace(this.rules.other.hrefBrackets,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",n=t[3]?t[3].substring(1,t[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):t[3];return{type:"def",tag:e,raw:t[0],href:r,title:n}}}table(e){let t=this.rules.block.table.exec(e);if(!t||!this.rules.other.tableDelimiter.test(t[2]))return;let r=n5(t[1]),n=t[2].replace(this.rules.other.tableAlignChars,"").split("|"),i=t[3]?.trim()?t[3].replace(this.rules.other.tableRowBlankLine,"").split("\n"):[],a={type:"table",raw:t[0],header:[],align:[],rows:[]};if(r.length===n.length){for(let e of n)this.rules.other.tableAlignRight.test(e)?a.align.push("right"):this.rules.other.tableAlignCenter.test(e)?a.align.push("center"):this.rules.other.tableAlignLeft.test(e)?a.align.push("left"):a.align.push(null);for(let e=0;e<r.length;e++)a.header.push({text:r[e],tokens:this.lexer.inline(r[e]),header:!0,align:a.align[e]});for(let e of i)a.rows.push(n5(e,a.header.length).map((e,t)=>({text:e,tokens:this.lexer.inline(e),header:!1,align:a.align[t]})));return a}}lheading(e){let t=this.rules.block.lheading.exec(e);if(t)return{type:"heading",raw:t[0],depth:"="===t[2].charAt(0)?1:2,text:t[1],tokens:this.lexer.inline(t[1])}}paragraph(e){let t=this.rules.block.paragraph.exec(e);if(t){let e="\n"===t[1].charAt(t[1].length-1)?t[1].slice(0,-1):t[1];return{type:"paragraph",raw:t[0],text:e,tokens:this.lexer.inline(e)}}}text(e){let t=this.rules.block.text.exec(e);if(t)return{type:"text",raw:t[0],text:t[0],tokens:this.lexer.inline(t[0])}}escape(e){let t=this.rules.inline.escape.exec(e);if(t)return{type:"escape",raw:t[0],text:t[1]}}tag(e){let t=this.rules.inline.tag.exec(e);if(t)return!this.lexer.state.inLink&&this.rules.other.startATag.test(t[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&this.rules.other.endATag.test(t[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&this.rules.other.startPreScriptTag.test(t[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&this.rules.other.endPreScriptTag.test(t[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:t[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:t[0]}}link(e){let t=this.rules.inline.link.exec(e);if(t){let e=t[2].trim();if(!this.options.pedantic&&this.rules.other.startAngleBracket.test(e)){if(!this.rules.other.endAngleBracket.test(e))return;let t=n9(e.slice(0,-1),"\\");if((e.length-t.length)%2==0)return}else{let e=n7(t[2],"()");if(-2===e)return;if(e>-1){let r=(0===t[0].indexOf("!")?5:4)+t[1].length+e;t[2]=t[2].substring(0,e),t[0]=t[0].substring(0,r).trim(),t[3]=""}}let r=t[2],n="";if(this.options.pedantic){let e=this.rules.other.pedanticHrefTitle.exec(r);e&&(r=e[1],n=e[3])}else n=t[3]?t[3].slice(1,-1):"";return r=r.trim(),this.rules.other.startAngleBracket.test(r)&&(r=this.options.pedantic&&!this.rules.other.endAngleBracket.test(e)?r.slice(1):r.slice(1,-1)),ie(t,{href:r?r.replace(this.rules.inline.anyPunctuation,"$1"):r,title:n?n.replace(this.rules.inline.anyPunctuation,"$1"):n},t[0],this.lexer,this.rules)}}reflink(e,t){let r;if((r=this.rules.inline.reflink.exec(e))||(r=this.rules.inline.nolink.exec(e))){let e=t[(r[2]||r[1]).replace(this.rules.other.multipleSpaceGlobal," ").toLowerCase()];if(!e){let e=r[0].charAt(0);return{type:"text",raw:e,text:e}}return ie(r,e,r[0],this.lexer,this.rules)}}emStrong(e,t,r=""){let n=this.rules.inline.emStrongLDelim.exec(e);if(!(!n||n[3]&&r.match(this.rules.other.unicodeAlphaNumeric))&&(!(n[1]||n[2])||!r||this.rules.inline.punctuation.exec(r))){let r=[...n[0]].length-1,i,a,o=r,s=0,l="*"===n[0][0]?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(l.lastIndex=0,t=t.slice(-1*e.length+r);null!=(n=l.exec(t));){if(!(i=n[1]||n[2]||n[3]||n[4]||n[5]||n[6]))continue;if(a=[...i].length,n[3]||n[4]){o+=a;continue}if((n[5]||n[6])&&r%3&&!((r+a)%3)){s+=a;continue}if((o-=a)>0)continue;a=Math.min(a,a+o+s);let t=[...n[0]][0].length,l=e.slice(0,r+n.index+t+a);if(Math.min(r,a)%2){let e=l.slice(1,-1);return{type:"em",raw:l,text:e,tokens:this.lexer.inlineTokens(e)}}let c=l.slice(2,-2);return{type:"strong",raw:l,text:c,tokens:this.lexer.inlineTokens(c)}}}}codespan(e){let t=this.rules.inline.code.exec(e);if(t){let e=t[2].replace(this.rules.other.newLineCharGlobal," "),r=this.rules.other.nonSpaceChar.test(e),n=this.rules.other.startingSpaceChar.test(e)&&this.rules.other.endingSpaceChar.test(e);return r&&n&&(e=e.substring(1,e.length-1)),{type:"codespan",raw:t[0],text:e}}}br(e){let t=this.rules.inline.br.exec(e);if(t)return{type:"br",raw:t[0]}}del(e){let t=this.rules.inline.del.exec(e);if(t)return{type:"del",raw:t[0],text:t[2],tokens:this.lexer.inlineTokens(t[2])}}autolink(e){let t=this.rules.inline.autolink.exec(e);if(t){let e,r;return r="@"===t[2]?"mailto:"+(e=t[1]):e=t[1],{type:"link",raw:t[0],text:e,href:r,tokens:[{type:"text",raw:e,text:e}]}}}url(e){let t;if(t=this.rules.inline.url.exec(e)){let e,r;if("@"===t[2])r="mailto:"+(e=t[0]);else{let n;do n=t[0],t[0]=this.rules.inline._backpedal.exec(t[0])?.[0]??"";while(n!==t[0])e=t[0],r="www."===t[1]?"http://"+t[0]:t[0]}return{type:"link",raw:t[0],text:e,href:r,tokens:[{type:"text",raw:e,text:e}]}}}inlineText(e){let t=this.rules.inline.text.exec(e);if(t){let e=this.lexer.state.inRawBlock;return{type:"text",raw:t[0],text:t[0],escaped:e}}}},ii=class e{tokens;options;state;tokenizer;inlineQueue;constructor(e){this.tokens=[],this.tokens.links=Object.create(null),this.options=e||r8,this.options.tokenizer=this.options.tokenizer||new ir,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};const t={other:ne,block:n1.normal,inline:n2.normal};this.options.pedantic?(t.block=n1.pedantic,t.inline=n2.pedantic):this.options.gfm&&(t.block=n1.gfm,this.options.breaks?t.inline=n2.breaks:t.inline=n2.gfm),this.tokenizer.rules=t}static get rules(){return{block:n1,inline:n2}}static lex(t,r){return new e(r).lex(t)}static lexInline(t,r){return new e(r).inlineTokens(t)}lex(e){e=e.replace(ne.carriageReturn,"\n"),this.blockTokens(e,this.tokens);for(let e=0;e<this.inlineQueue.length;e++){let t=this.inlineQueue[e];this.inlineTokens(t.src,t.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(e,t=[],r=!1){for(this.options.pedantic&&(e=e.replace(ne.tabCharGlobal,"    ").replace(ne.spaceLine,""));e;){let n;if(this.options.extensions?.block?.some(r=>!!(n=r.call({lexer:this},e,t))&&(e=e.substring(n.raw.length),t.push(n),!0)))continue;if(n=this.tokenizer.space(e)){e=e.substring(n.raw.length);let r=t.at(-1);1===n.raw.length&&void 0!==r?r.raw+="\n":t.push(n);continue}if(n=this.tokenizer.code(e)){e=e.substring(n.raw.length);let r=t.at(-1);r?.type==="paragraph"||r?.type==="text"?(r.raw+="\n"+n.raw,r.text+="\n"+n.text,this.inlineQueue.at(-1).src=r.text):t.push(n);continue}if((n=this.tokenizer.fences(e))||(n=this.tokenizer.heading(e))||(n=this.tokenizer.hr(e))||(n=this.tokenizer.blockquote(e))||(n=this.tokenizer.list(e))||(n=this.tokenizer.html(e))){e=e.substring(n.raw.length),t.push(n);continue}if(n=this.tokenizer.def(e)){e=e.substring(n.raw.length);let r=t.at(-1);r?.type==="paragraph"||r?.type==="text"?(r.raw+="\n"+n.raw,r.text+="\n"+n.raw,this.inlineQueue.at(-1).src=r.text):this.tokens.links[n.tag]||(this.tokens.links[n.tag]={href:n.href,title:n.title});continue}if((n=this.tokenizer.table(e))||(n=this.tokenizer.lheading(e))){e=e.substring(n.raw.length),t.push(n);continue}let i=e;if(this.options.extensions?.startBlock){let t,r=1/0,n=e.slice(1);this.options.extensions.startBlock.forEach(e=>{"number"==typeof(t=e.call({lexer:this},n))&&t>=0&&(r=Math.min(r,t))}),r<1/0&&r>=0&&(i=e.substring(0,r+1))}if(this.state.top&&(n=this.tokenizer.paragraph(i))){let a=t.at(-1);r&&a?.type==="paragraph"?(a.raw+="\n"+n.raw,a.text+="\n"+n.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=a.text):t.push(n),r=i.length!==e.length,e=e.substring(n.raw.length);continue}if(n=this.tokenizer.text(e)){e=e.substring(n.raw.length);let r=t.at(-1);r?.type==="text"?(r.raw+="\n"+n.raw,r.text+="\n"+n.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=r.text):t.push(n);continue}if(e){let t="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(t);break}throw Error(t)}}return this.state.top=!0,t}inline(e,t=[]){return this.inlineQueue.push({src:e,tokens:t}),t}inlineTokens(e,t=[]){let r=e,n=null;if(this.tokens.links){let e=Object.keys(this.tokens.links);if(e.length>0)for(;null!=(n=this.tokenizer.rules.inline.reflinkSearch.exec(r));)e.includes(n[0].slice(n[0].lastIndexOf("[")+1,-1))&&(r=r.slice(0,n.index)+"["+"a".repeat(n[0].length-2)+"]"+r.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;null!=(n=this.tokenizer.rules.inline.anyPunctuation.exec(r));)r=r.slice(0,n.index)+"++"+r.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);for(;null!=(n=this.tokenizer.rules.inline.blockSkip.exec(r));)r=r.slice(0,n.index)+"["+"a".repeat(n[0].length-2)+"]"+r.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);let i=!1,a="";for(;e;){let n;if(i||(a=""),i=!1,this.options.extensions?.inline?.some(r=>!!(n=r.call({lexer:this},e,t))&&(e=e.substring(n.raw.length),t.push(n),!0)))continue;if((n=this.tokenizer.escape(e))||(n=this.tokenizer.tag(e))||(n=this.tokenizer.link(e))){e=e.substring(n.raw.length),t.push(n);continue}if(n=this.tokenizer.reflink(e,this.tokens.links)){e=e.substring(n.raw.length);let r=t.at(-1);"text"===n.type&&r?.type==="text"?(r.raw+=n.raw,r.text+=n.text):t.push(n);continue}if((n=this.tokenizer.emStrong(e,r,a))||(n=this.tokenizer.codespan(e))||(n=this.tokenizer.br(e))||(n=this.tokenizer.del(e))||(n=this.tokenizer.autolink(e))||!this.state.inLink&&(n=this.tokenizer.url(e))){e=e.substring(n.raw.length),t.push(n);continue}let o=e;if(this.options.extensions?.startInline){let t,r=1/0,n=e.slice(1);this.options.extensions.startInline.forEach(e=>{"number"==typeof(t=e.call({lexer:this},n))&&t>=0&&(r=Math.min(r,t))}),r<1/0&&r>=0&&(o=e.substring(0,r+1))}if(n=this.tokenizer.inlineText(o)){e=e.substring(n.raw.length),"_"!==n.raw.slice(-1)&&(a=n.raw.slice(-1)),i=!0;let r=t.at(-1);r?.type==="text"?(r.raw+=n.raw,r.text+=n.text):t.push(n);continue}if(e){let t="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(t);break}throw Error(t)}}return t}},ia=class{options;parser;constructor(e){this.options=e||r8}space(e){return""}code({text:e,lang:t,escaped:r}){let n=(t||"").match(ne.notSpaceStart)?.[0],i=e.replace(ne.endingNewline,"")+"\n";return n?'<pre><code class="language-'+n4(n)+'">'+(r?i:n4(i,!0))+"</code></pre>\n":"<pre><code>"+(r?i:n4(i,!0))+"</code></pre>\n"}blockquote({tokens:e}){let t=this.parser.parse(e);return`<blockquote>
${t}</blockquote>
`}html({text:e}){return e}heading({tokens:e,depth:t}){return`<h${t}>${this.parser.parseInline(e)}</h${t}>
`}hr(e){return"<hr>\n"}list(e){let t=e.ordered,r=e.start,n="";for(let t=0;t<e.items.length;t++){let r=e.items[t];n+=this.listitem(r)}let i=t?"ol":"ul";return"<"+i+(t&&1!==r?' start="'+r+'"':"")+">\n"+n+"</"+i+">\n"}listitem(e){let t="";if(e.task){let r=this.checkbox({checked:!!e.checked});e.loose?e.tokens[0]?.type==="paragraph"?(e.tokens[0].text=r+" "+e.tokens[0].text,e.tokens[0].tokens&&e.tokens[0].tokens.length>0&&"text"===e.tokens[0].tokens[0].type&&(e.tokens[0].tokens[0].text=r+" "+n4(e.tokens[0].tokens[0].text),e.tokens[0].tokens[0].escaped=!0)):e.tokens.unshift({type:"text",raw:r+" ",text:r+" ",escaped:!0}):t+=r+" "}return t+=this.parser.parse(e.tokens,!!e.loose),`<li>${t}</li>
`}checkbox({checked:e}){return"<input "+(e?'checked="" ':"")+'disabled="" type="checkbox">'}paragraph({tokens:e}){return`<p>${this.parser.parseInline(e)}</p>
`}table(e){let t="",r="";for(let t=0;t<e.header.length;t++)r+=this.tablecell(e.header[t]);t+=this.tablerow({text:r});let n="";for(let t=0;t<e.rows.length;t++){let i=e.rows[t];r="";for(let e=0;e<i.length;e++)r+=this.tablecell(i[e]);n+=this.tablerow({text:r})}return n&&(n=`<tbody>${n}</tbody>`),"<table>\n<thead>\n"+t+"</thead>\n"+n+"</table>\n"}tablerow({text:e}){return`<tr>
${e}</tr>
`}tablecell(e){let t=this.parser.parseInline(e.tokens),r=e.header?"th":"td";return(e.align?`<${r} align="${e.align}">`:`<${r}>`)+t+`</${r}>
`}strong({tokens:e}){return`<strong>${this.parser.parseInline(e)}</strong>`}em({tokens:e}){return`<em>${this.parser.parseInline(e)}</em>`}codespan({text:e}){return`<code>${n4(e,!0)}</code>`}br(e){return"<br>"}del({tokens:e}){return`<del>${this.parser.parseInline(e)}</del>`}link({href:e,title:t,tokens:r}){let n=this.parser.parseInline(r),i=n8(e);if(null===i)return n;let a='<a href="'+(e=i)+'"';return t&&(a+=' title="'+n4(t)+'"'),a+=">"+n+"</a>"}image({href:e,title:t,text:r,tokens:n}){n&&(r=this.parser.parseInline(n,this.parser.textRenderer));let i=n8(e);if(null===i)return n4(r);e=i;let a=`<img src="${e}" alt="${r}"`;return t&&(a+=` title="${n4(t)}"`),a+=">"}text(e){return"tokens"in e&&e.tokens?this.parser.parseInline(e.tokens):"escaped"in e&&e.escaped?e.text:n4(e.text)}},io=class{strong({text:e}){return e}em({text:e}){return e}codespan({text:e}){return e}del({text:e}){return e}html({text:e}){return e}text({text:e}){return e}link({text:e}){return""+e}image({text:e}){return""+e}br(){return""}},is=class e{options;renderer;textRenderer;constructor(e){this.options=e||r8,this.options.renderer=this.options.renderer||new ia,this.renderer=this.options.renderer,this.renderer.options=this.options,this.renderer.parser=this,this.textRenderer=new io}static parse(t,r){return new e(r).parse(t)}static parseInline(t,r){return new e(r).parseInline(t)}parse(e,t=!0){let r="";for(let n=0;n<e.length;n++){let i=e[n];if(this.options.extensions?.renderers?.[i.type]){let e=i,t=this.options.extensions.renderers[e.type].call({parser:this},e);if(!1!==t||!["space","hr","heading","code","table","blockquote","list","html","paragraph","text"].includes(e.type)){r+=t||"";continue}}let a=i;switch(a.type){case"space":r+=this.renderer.space(a);continue;case"hr":r+=this.renderer.hr(a);continue;case"heading":r+=this.renderer.heading(a);continue;case"code":r+=this.renderer.code(a);continue;case"table":r+=this.renderer.table(a);continue;case"blockquote":r+=this.renderer.blockquote(a);continue;case"list":r+=this.renderer.list(a);continue;case"html":r+=this.renderer.html(a);continue;case"paragraph":r+=this.renderer.paragraph(a);continue;case"text":{let i=a,o=this.renderer.text(i);for(;n+1<e.length&&"text"===e[n+1].type;)i=e[++n],o+="\n"+this.renderer.text(i);t?r+=this.renderer.paragraph({type:"paragraph",raw:o,text:o,tokens:[{type:"text",raw:o,text:o,escaped:!0}]}):r+=o;continue}default:{let e='Token with "'+a.type+'" type was not found.';if(this.options.silent)return console.error(e),"";throw Error(e)}}}return r}parseInline(e,t=this.renderer){let r="";for(let n=0;n<e.length;n++){let i=e[n];if(this.options.extensions?.renderers?.[i.type]){let e=this.options.extensions.renderers[i.type].call({parser:this},i);if(!1!==e||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(i.type)){r+=e||"";continue}}let a=i;switch(a.type){case"escape":case"text":r+=t.text(a);break;case"html":r+=t.html(a);break;case"link":r+=t.link(a);break;case"image":r+=t.image(a);break;case"strong":r+=t.strong(a);break;case"em":r+=t.em(a);break;case"codespan":r+=t.codespan(a);break;case"br":r+=t.br(a);break;case"del":r+=t.del(a);break;default:{let e='Token with "'+a.type+'" type was not found.';if(this.options.silent)return console.error(e),"";throw Error(e)}}}return r}},il=class{options;block;constructor(e){this.options=e||r8}static passThroughHooks=new Set(["preprocess","postprocess","processAllTokens"]);preprocess(e){return e}postprocess(e){return e}processAllTokens(e){return e}provideLexer(){return this.block?ii.lex:ii.lexInline}provideParser(){return this.block?is.parse:is.parseInline}},ic=new class{defaults=r4();options=this.setOptions;parse=this.parseMarkdown(!0);parseInline=this.parseMarkdown(!1);Parser=is;Renderer=ia;TextRenderer=io;Lexer=ii;Tokenizer=ir;Hooks=il;constructor(...e){this.use(...e)}walkTokens(e,t){let r=[];for(let n of e)switch(r=r.concat(t.call(this,n)),n.type){case"table":{let e=n;for(let n of e.header)r=r.concat(this.walkTokens(n.tokens,t));for(let n of e.rows)for(let e of n)r=r.concat(this.walkTokens(e.tokens,t));break}case"list":{let e=n;r=r.concat(this.walkTokens(e.items,t));break}default:{let e=n;this.defaults.extensions?.childTokens?.[e.type]?this.defaults.extensions.childTokens[e.type].forEach(n=>{let i=e[n].flat(1/0);r=r.concat(this.walkTokens(i,t))}):e.tokens&&(r=r.concat(this.walkTokens(e.tokens,t)))}}return r}use(...e){let t=this.defaults.extensions||{renderers:{},childTokens:{}};return e.forEach(e=>{let r={...e};if(r.async=this.defaults.async||r.async||!1,e.extensions&&(e.extensions.forEach(e=>{if(!e.name)throw Error("extension name required");if("renderer"in e){let r=t.renderers[e.name];r?t.renderers[e.name]=function(...t){let n=e.renderer.apply(this,t);return!1===n&&(n=r.apply(this,t)),n}:t.renderers[e.name]=e.renderer}if("tokenizer"in e){if(!e.level||"block"!==e.level&&"inline"!==e.level)throw Error("extension level must be 'block' or 'inline'");let r=t[e.level];r?r.unshift(e.tokenizer):t[e.level]=[e.tokenizer],e.start&&("block"===e.level?t.startBlock?t.startBlock.push(e.start):t.startBlock=[e.start]:"inline"===e.level&&(t.startInline?t.startInline.push(e.start):t.startInline=[e.start]))}"childTokens"in e&&e.childTokens&&(t.childTokens[e.name]=e.childTokens)}),r.extensions=t),e.renderer){let t=this.defaults.renderer||new ia(this.defaults);for(let r in e.renderer){if(!(r in t))throw Error(`renderer '${r}' does not exist`);if(["options","parser"].includes(r))continue;let n=r,i=e.renderer[n],a=t[n];t[n]=(...e)=>{let r=i.apply(t,e);return!1===r&&(r=a.apply(t,e)),r||""}}r.renderer=t}if(e.tokenizer){let t=this.defaults.tokenizer||new ir(this.defaults);for(let r in e.tokenizer){if(!(r in t))throw Error(`tokenizer '${r}' does not exist`);if(["options","rules","lexer"].includes(r))continue;let n=r,i=e.tokenizer[n],a=t[n];t[n]=(...e)=>{let r=i.apply(t,e);return!1===r&&(r=a.apply(t,e)),r}}r.tokenizer=t}if(e.hooks){let t=this.defaults.hooks||new il;for(let r in e.hooks){if(!(r in t))throw Error(`hook '${r}' does not exist`);if(["options","block"].includes(r))continue;let n=r,i=e.hooks[n],a=t[n];il.passThroughHooks.has(r)?t[n]=e=>{if(this.defaults.async)return Promise.resolve(i.call(t,e)).then(e=>a.call(t,e));let r=i.call(t,e);return a.call(t,r)}:t[n]=(...e)=>{let r=i.apply(t,e);return!1===r&&(r=a.apply(t,e)),r}}r.hooks=t}if(e.walkTokens){let t=this.defaults.walkTokens,n=e.walkTokens;r.walkTokens=function(e){let r=[];return r.push(n.call(this,e)),t&&(r=r.concat(t.call(this,e))),r}}this.defaults={...this.defaults,...r}}),this}setOptions(e){return this.defaults={...this.defaults,...e},this}lexer(e,t){return ii.lex(e,t??this.defaults)}parser(e,t){return is.parse(e,t??this.defaults)}parseMarkdown(e){return(t,r)=>{let n={...r},i={...this.defaults,...n},a=this.onError(!!i.silent,!!i.async);if(!0===this.defaults.async&&!1===n.async)return a(Error("marked(): The async option was set to true by an extension. Remove async: false from the parse options object to return a Promise."));if(null==t)return a(Error("marked(): input parameter is undefined or null"));if("string"!=typeof t)return a(Error("marked(): input parameter is of type "+Object.prototype.toString.call(t)+", string expected"));i.hooks&&(i.hooks.options=i,i.hooks.block=e);let o=i.hooks?i.hooks.provideLexer():e?ii.lex:ii.lexInline,s=i.hooks?i.hooks.provideParser():e?is.parse:is.parseInline;if(i.async)return Promise.resolve(i.hooks?i.hooks.preprocess(t):t).then(e=>o(e,i)).then(e=>i.hooks?i.hooks.processAllTokens(e):e).then(e=>i.walkTokens?Promise.all(this.walkTokens(e,i.walkTokens)).then(()=>e):e).then(e=>s(e,i)).then(e=>i.hooks?i.hooks.postprocess(e):e).catch(a);try{i.hooks&&(t=i.hooks.preprocess(t));let e=o(t,i);i.hooks&&(e=i.hooks.processAllTokens(e)),i.walkTokens&&this.walkTokens(e,i.walkTokens);let r=s(e,i);return i.hooks&&(r=i.hooks.postprocess(r)),r}catch(e){return a(e)}}}onError(e,t){return r=>{if(r.message+="\nPlease report this to https://github.com/markedjs/marked.",e){let e="<p>An error occurred:</p><pre>"+n4(r.message+"",!0)+"</pre>";return t?Promise.resolve(e):e}if(t)return Promise.reject(r);throw r}}};function iu(e,t){return ic.parse(e,t)}iu.options=iu.setOptions=function(e){return ic.setOptions(e),iu.defaults=ic.defaults,r5(iu.defaults),iu},iu.getDefaults=r4,iu.defaults=r8,iu.use=function(...e){return ic.use(...e),iu.defaults=ic.defaults,r5(iu.defaults),iu},iu.walkTokens=function(e,t){return ic.walkTokens(e,t)},iu.parseInline=ic.parseInline,iu.Parser=is,iu.parser=is.parse,iu.Renderer=ia,iu.TextRenderer=io,iu.Lexer=ii,iu.lexer=ii.lex,iu.Tokenizer=ir,iu.Hooks=il,iu.parse=iu,iu.options,iu.setOptions,iu.use,iu.walkTokens,iu.parseInline,is.parse,ii.lex;var id=n,ih=o,ip=m,ib=ec,im=i,ig=t2,iy=M;let iv="foliate-note:",ix=e=>{let t=e.addAnnotation.bind(e);return e.addAnnotation=(e,r=!1)=>t({value:e.cfi,...e},r),e};var iw=r,iS=rJ;function ik(e,t){if(!t)return!1;let r=iS.collapse(t),n=iS.collapse(t,!0);return iS.compare(e,r)>=0&&0>=iS.compare(e,n)}let i_=(e,t)=>{let r=(0,iw.useRef)(null),n=(0,iw.useMemo)(()=>ik(e,t?.location),[e,t]);return(0,iw.useEffect)(()=>{if(!r.current||!n)return;let e=r.current,t=e.getBoundingClientRect();t.top>=0&&t.bottom<=window.innerHeight||e.scrollIntoView({behavior:"smooth",block:"center"}),e.setAttribute("aria-current","page")},[n]),{isCurrent:n,viewRef:r}};var iE=t,iM=c;let iN=({children:e,onClick:t,disabled:r=!1,className:n,variant:i="primary",size:a="sm",type:o="button"})=>{let s={primary:"text-blue-500 hover:text-blue-600",secondary:"text-gray-500 hover:text-gray-600",danger:"text-red-500 hover:text-red-600",success:"text-green-500 hover:text-green-600"},l={sm:"font-size-sm h-[1.3em] min-h-[1.3em]",md:"font-size-md h-[1.5em] min-h-[1.5em]",lg:"font-size-lg h-[1.8em] min-h-[1.8em]"};return(0,iE.jsx)("button",{type:o,className:(0,iM.default)("content settings-content btn btn-ghost hover:bg-transparent","flex items-end p-0",l[a],r?"btn-disabled !bg-opacity-0":"",n),onClick:t,disabled:r,children:(0,iE.jsx)("div",{className:(0,iM.default)("align-bottom",l[a].split(" ")[0],s[i]),children:e})})};var iA=t,iT=c,iR=r;let iC=(0,iR.forwardRef)(({value:e,onChange:t,onBlur:r,onSave:n,onEscape:i,placeholder:a,className:o,autoFocus:s=!1,spellCheck:l=!1,disabled:c=!1,maxRows:f,minRows:u=1},d)=>{let h=(0,iR.useRef)(null);(0,iR.useImperativeHandle)(d,()=>({focus:()=>{h.current?.focus()},blur:()=>{h.current?.blur()},getValue:()=>h.current?.value||"",setValue:e=>{h.current&&(h.current.value=e,p())},getElement:()=>h.current})),(0,iR.useEffect)(()=>{s&&h.current&&h.current.focus()},[s]),(0,iR.useEffect)(()=>{h.current&&(h.current.value=e,p())},[e]);let p=()=>{if(h.current){h.current.style.height="auto";let e=h.current.scrollHeight,t=1/0;f&&(t=parseInt(getComputedStyle(h.current).lineHeight)*f);let r=Math.min(Math.max(e,(parseInt(getComputedStyle(h.current).lineHeight)||20)*u),t);h.current.style.height=`${r}px`}},b=e=>{p(),t(e.target.value)},m=e=>{if("Escape"===e.key&&i)return void i();if("Enter"===e.key&&(e.metaKey||e.ctrlKey)&&n){e.preventDefault(),n();return}};return(0,iA.jsx)("textarea",{ref:h,className:(0,iT.default)("textarea textarea-ghost min-h-[1em] resize-none !outline-none","inset-0 w-full rounded-none border-0 bg-transparent p-0","content font-size-sm",o),dir:"auto",rows:u,spellCheck:l,disabled:c,onChange:b,onBlur:r,onKeyDown:m,placeholder:a||""})});iC.displayName="TextEditor";let ij=iC,iI=({bookKey:e,item:t,onClick:r})=>{let n=(0,im.useTranslation)(),{envConfig:i}=(0,id.useEnv)(),{settings:a}=(0,ih.useSettingsStore)(),{getConfig:o,saveConfig:s,updateBooknotes:l}=(0,ib.useBookDataStore)(),{getProgress:c,getView:f,getViewsById:u}=(0,ip.useReaderStore)(),{setNotebookEditAnnotation:d,setNotebookVisible:h}=w(),{text:p,cfi:b,note:m}=t,g=(0,r6.useRef)(null),[y,v]=(0,r6.useState)(p||""),[x,S]=(0,r6.useState)(!1),k=(0,ig.useResponsiveSize)(3),{isCurrent:_,viewRef:E}=i_(b,c(e)),M=t=>{t.preventDefault(),iy.eventDispatcher.dispatch("navigate",{bookKey:e,cfi:b}),r?.(),f(e)?.goTo(b),m&&h(!0)},N=t=>{if(!e)return;let r=o(e);if(!r)return;let{booknotes:n=[]}=r;n.forEach(r=>{r.id===t.id&&(r.deletedAt=Date.now(),u(e.split("-")[0]).forEach(e=>e?.addAnnotation({...r,value:`${iv}${r.cfi}`},!0)))});let c=l(e,n);c&&s(i,e,c,a)},A=e=>{h(!0),d(e)},T=()=>{v(p||""),S(!0)},R=()=>{S(!1);let r=o(e);if(!r||!y)return;let{booknotes:n=[]}=r,c=n.findIndex(e=>t.id===e.id);if(-1===c)return;n[c].updatedAt=Date.now(),n[c].text=y;let f=l(e,n);f&&s(i,e,f,a)};return x?(0,r1.jsxs)("div",{className:(0,r2.default)("border-base-300 content group relative my-2 cursor-pointer rounded-lg p-2",_?"bg-base-300/85 hover:bg-base-300":"hover:bg-base-300/55 bg-base-100","transition-all duration-300 ease-in-out"),children:[(0,r1.jsx)("div",{className:"flex w-full",children:(0,r1.jsx)(ij,{className:"!leading-normal",ref:g,value:y,onChange:v,onSave:R,onEscape:()=>S(!1),spellCheck:!1})}),(0,r1.jsxs)("div",{className:"flex justify-end space-x-3 p-2",dir:"ltr",children:[(0,r1.jsx)(iN,{onClick:()=>S(!1),children:n("Cancel")}),(0,r1.jsx)(iN,{onClick:R,disabled:!y,children:n("Save")})]})]}):(0,r1.jsxs)("li",{role:"button",ref:E,className:(0,r2.default)("booknote-item border-base-300 content group relative my-2 cursor-pointer rounded-lg p-2",_?"bg-base-300/85 hover:bg-base-300 focus:bg-base-300":"hover:bg-base-300/55 focus:bg-base-300/55 bg-base-100","transition-all duration-300 ease-in-out"),tabIndex:0,onClick:M,onKeyDown:e=>{"Enter"===e.key||" "===e.key?M(e):e.stopPropagation()},children:[(0,r1.jsxs)("div",{className:(0,r2.default)("min-h-4 p-0 transition-all duration-300 ease-in-out"),style:{"--top-override":"0.7rem","--end-override":"0.3rem"},children:[t.note&&(0,r1.jsx)("div",{className:"content prose prose-sm font-size-sm",dir:"auto",dangerouslySetInnerHTML:{__html:iu.parse(t.note)}}),(0,r1.jsxs)("div",{className:"flex items-start",children:[t.note&&(0,r1.jsx)("div",{className:"me-2 mt-2.5 min-h-full self-stretch rounded-xl bg-gray-300",style:{minWidth:`${k}px`}}),(0,r1.jsx)("div",{className:(0,r2.default)("content font-size-sm line-clamp-3",t.note&&"mt-2"),children:(0,r1.jsx)("span",{className:(0,r2.default)("booknote-text inline leading-normal",t.note&&"content font-size-xs text-gray-500",("underline"===t.style||"squiggly"===t.style)&&"underline decoration-2","highlight"===t.style&&`bg-${t.color}-500 bg-opacity-40`,"underline"===t.style&&`decoration-${t.color}-400`,"squiggly"===t.style&&`decoration-wavy decoration-${t.color}-400`),children:p||""})})]})]}),(0,r1.jsx)("div",{className:(0,r2.default)("max-h-0 overflow-hidden p-0","transition-[max-height] duration-300 ease-in-out","group-hover:max-h-8 group-hover:overflow-visible","group-focus-within:max-h-8 group-focus-within:overflow-visible"),style:{"--bottom-override":0},onClick:e=>e.stopPropagation(),children:(0,r1.jsxs)("div",{className:"flex cursor-default items-center justify-between",children:[(0,r1.jsx)("div",{className:"flex items-center",children:(0,r1.jsx)("span",{className:"text-sm text-gray-500 sm:text-xs",children:(0,r3.default)(t.createdAt).fromNow()})}),(0,r1.jsxs)("div",{className:"flex items-center justify-end space-x-3 p-2",dir:"ltr",children:[(t.note||"bookmark"===t.type)&&(0,r1.jsx)(iN,{onClick:"bookmark"===t.type?T:A.bind(null,t),variant:"primary",className:"opacity-0 transition duration-300 ease-in-out group-focus-within:opacity-100 group-hover:opacity-100",children:n("Edit")}),(0,r1.jsx)(iN,{onClick:N.bind(null,t),variant:"danger",className:"opacity-0 transition duration-300 ease-in-out group-focus-within:opacity-100 group-hover:opacity-100",children:n("Delete")})]})]})})]})},iL=({type:e,bookKey:t,toc:r})=>{let{getConfig:n}=(0,rQ.useBookDataStore)(),{setActiveBooknoteType:i,setBooknoteResults:a}=x(),{booknotes:o=[]}=n(t),s=o.filter(t=>t.type===e&&!t.deletedAt),l={};for(let e of s){let t=(0,r0.findTocItemBS)(r??[],e.cfi),n=t?.href||"",i=t?.label||"",a=t?.id||0;l[n]||(l[n]={id:a,href:n,label:i,booknotes:[]}),l[n].booknotes.push(e)}Object.values(l).forEach(e=>{e.booknotes.sort((e,t)=>rJ.compare(e.cfi,t.cfi))});let c=Object.values(l).sort((e,t)=>e.id-t.id),f=()=>{if(0===s.length)return;let r=[...s].sort((e,t)=>rJ.compare(e.cfi,t.cfi));i(t,e),a(t,r)};return(0,rZ.jsx)("div",{className:"rounded pt-2",children:(0,rZ.jsx)("ul",{role:"tree",className:"px-2",children:c.map(e=>(0,rZ.jsxs)("li",{className:"p-2",children:[(0,rZ.jsx)("h3",{className:"content font-size-base line-clamp-1 font-normal",children:e.label}),(0,rZ.jsx)("ul",{children:e.booknotes.map((e,r)=>(0,rZ.jsx)(iI,{bookKey:t,item:e,onClick:f},`${r}-${e.cfi}`))})]},e.href))})})};var iP=t,iB=c,iO=tQ,iD=e.i(360289),iz=e.i(270436),iF=n,iU=i;let i$=({activeTab:e,onTabChange:t})=>{let r=(0,iU.useTranslation)(),{appService:n}=(0,iF.useEnv)(),i=["toc","annotations","bookmarks"];return(0,iP.jsxs)("div",{className:(0,iB.default)("bottom-tab border-base-300/50 bg-base-200/20 relative flex w-full border-t",n?.hasRoundedWindow&&"rounded-window-bottom-left"),dir:"ltr",children:[(0,iP.jsx)("div",{className:(0,iB.default)("bg-base-300/85 absolute bottom-1.5 start-1 z-10 h-[calc(100%-12px)] w-[calc(33.3%-8px)] rounded-lg","transform transition-transform duration-300","toc"===e&&"translate-x-0","annotations"===e&&"translate-x-[calc(100%+8px)]","bookmarks"===e&&"translate-x-[calc(200%+16px)]")}),i.map(e=>(0,iP.jsx)("div",{tabIndex:0,role:"button",className:"z-[11] m-1.5 flex-1 cursor-pointer rounded-md p-2",onClick:()=>t(e),onKeyDown:r=>{("Enter"===r.key||" "===r.key)&&(r.preventDefault(),t(e))},title:"toc"===e?r("TOC"):"annotations"===e?r("Annotate"):r("Bookmark"),"aria-label":"toc"===e?r("TOC"):"annotations"===e?r("Annotate"):r("Bookmark"),children:(0,iP.jsx)("div",{className:(0,iB.default)("m-0 flex h-6 items-center p-0"),children:"toc"===e?(0,iP.jsx)(iD.IoIosList,{className:"mx-auto"}):"annotations"===e?(0,iP.jsx)(iz.PiNotePencil,{className:"mx-auto"}):(0,iP.jsx)(iO.MdBookmarkBorder,{className:"mx-auto"})})},e))]})},iH=({bookDoc:e,sideBarBookKey:t})=>{let{safeAreaInsets:r}=(0,rx.useThemeStore)(),{setHoveredBookKey:n}=(0,rw.useReaderStore)(),{setSideBarVisible:i}=x(),{getConfig:a,setConfig:o}=(0,rS.useBookDataStore)(),s=a(t),[l,c]=(0,rv.useState)(s?.viewSettings?.sideBarTab||"toc"),[f,u]=(0,rv.useState)(!1),[d,h]=(0,rv.useState)(l),p=window.innerWidth<640||window.innerHeight<640;(0,rv.useEffect)(()=>{t&&c(a(t).viewSettings.sideBarTab)},[t]);let b=e=>{u(!0);let r=setTimeout(()=>{if(l===e&&p){n(t),i(!1);return}h(e),u(!1),o(t,s),clearTimeout(r)},300);c(e);let s=a(t);s.viewSettings.sideBarTab=e};return(0,rg.jsxs)(rg.Fragment,{children:[(0,rg.jsx)("div",{className:(0,ry.default)("sidebar-content flex h-full min-h-0 flex-grow flex-col shadow-inner","font-sans text-base font-normal sm:text-sm"),children:(0,rg.jsx)(rk.OverlayScrollbarsComponent,{className:"min-h-0 flex-1",options:{scrollbars:{autoHide:"scroll",clickScroll:!0},showNativeOverlaidScrollbars:!1},defer:!0,children:(0,rg.jsxs)("div",{className:(0,ry.default)("scroll-container h-full transition-opacity duration-300 ease-in-out",{"opacity-0":f,"opacity-100":!f}),children:["toc"===d&&e.toc&&(0,rg.jsx)(rY,{toc:e.toc,sections:e.sections,bookKey:t}),"annotations"===d&&(0,rg.jsx)(iL,{type:"annotation",toc:e.toc??[],bookKey:t}),"bookmarks"===d&&(0,rg.jsx)(iL,{type:"bookmark",toc:e.toc??[],bookKey:t})]})})}),(0,rg.jsx)("div",{className:"flex-shrink-0",style:{paddingBottom:`${(r?.bottom||0)/2}px`},children:(0,rg.jsx)(i$,{activeTab:l,onTabChange:b})})]})};var iq=t,iV=c,iW=r,iK=tQ,iG=b,iX=i,iY=M,iZ=t2,iJ=eJ,iQ=e.i(534736);let i0=({book:e})=>{let{title:t,author:r}=e,n=(0,iX.useTranslation)(),{isDarkMode:i}=(0,iG.useThemeStore)(),a=(0,iZ.useResponsiveSize)(18),o=(0,iW.useRef)(null),s=()=>{iY.eventDispatcher.dispatchSync("show-book-details",e)};return(0,iq.jsxs)("div",{className:"flex h-20 w-full items-center",children:[(0,iq.jsx)("div",{ref:o,className:(0,iV.default)("me-4 aspect-[28/41] max-h-16 w-[15%] max-w-12 overflow-hidden rounded-sm shadow-md",i?"mix-blend-screen":"mix-blend-multiply"),children:(0,iq.jsx)(iQ.default,{book:e,mode:"list",coverFit:"crop",imageClassName:"rounded-sm",onImageError:()=>o.current.style.display="none"})}),(0,iq.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,iq.jsx)("h4",{className:"line-clamp-2 w-[90%] text-sm font-semibold",children:(0,iJ.formatTitle)(t).replace(/\u00A0/g," ")}),(0,iq.jsx)("p",{className:"truncate text-xs opacity-75",children:(0,iJ.formatAuthors)(r)})]}),(0,iq.jsx)("button",{className:"btn btn-ghost hover:bg-base-300 h-6 min-h-6 w-6 rounded-full p-0 transition-colors","aria-label":n("More Info"),onClick:s,children:(0,iq.jsx)(iK.MdInfoOutline,{size:a,className:"fill-base-content"})})]})};var i1=r,i2=n,i3=o,i6=ru;let i4=(e,t)=>{let{envConfig:r}=(0,i2.useEnv)(),{settings:n}=(0,i3.useSettingsStore)(),{sideBarWidth:i,isSideBarVisible:a,isSideBarPinned:o,getSideBarWidth:s,setSideBarWidth:l,setSideBarVisible:c,setSideBarPin:f,toggleSideBar:u,toggleSideBarPin:d}=x();(0,i1.useEffect)(()=>{l(e),f(t),c(t)},[]);let h=()=>{d(),o&&a&&c(!1);let e={...n.globalReadSettings,isSideBarPinned:!o};(0,i6.saveSysSettings)(r,"globalReadSettings",e)};return{sideBarWidth:i,isSideBarPinned:o,isSideBarVisible:a,getSideBarWidth:s,handleSideBarResize:e=>{l(e),n.globalReadSettings.sideBarWidth=e},handleSideBarTogglePin:h,setSideBarVisible:c,toggleSideBar:u}};var i8=t,i5=c,i9=r,i7=e.i(205560),ae=iD,at=tQ,ar=D,an=n,ai=o,aa=ec,ao=m,as=i,al=t2,ac=X,af=e.i(819045);let au=({tags:e=[],classes:t=[],attributes:r=[],contents:n=[]})=>i=>{if(i.nodeType===Node.ELEMENT_NODE){let a=i.tagName.toLowerCase();return"script"===a||"style"===a||e.includes(a)||t.some(e=>i.classList.contains(e))||r.some(e=>i.hasAttribute(e))||n.some(({tag:e,content:t})=>a===e&&t.test(i.textContent||""))?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_SKIP}return NodeFilter.FILTER_ACCEPT};var ad=t3,ah=t,ap=c,ab=tQ,am=i,ag=t2;let ay=({label:e,isActive:t,onClick:r})=>(0,ah.jsx)("button",{className:"hover:bg-base-300 flex w-full items-center justify-between rounded-md p-2",onClick:r,children:(0,ah.jsxs)("div",{className:"flex items-center",children:[(0,ah.jsx)("span",{style:{minWidth:`${(0,ag.useDefaultIconSize)()}px`},children:t&&(0,ah.jsx)(ab.MdCheck,{className:"text-base-content"})}),(0,ah.jsx)("span",{className:"ml-2",children:e})]})}),av=({isEink:e,searchConfig:t,menuClassName:r,onSearchConfigChanged:n,setIsDropdownOpen:i})=>{let a=(0,am.useTranslation)(),o=(e,r)=>{n({...t,[e]:r}),i?.(!1)};return(0,ah.jsxs)("div",{className:(0,ap.default)("search-options dropdown-content dropdown-center border-base-200 z-20 w-56 border shadow-2xl",e?"bordercolor-content border-base-content !bg-base-100 border":"",r),children:[(0,ah.jsx)(ay,{label:a("Book"),isActive:"book"===t.scope,onClick:()=>o("scope","book")}),(0,ah.jsx)(ay,{label:a("Chapter"),isActive:"section"===t.scope,onClick:()=>o("scope","section")}),(0,ah.jsx)("hr",{className:"border-base-200 my-1"}),(0,ah.jsx)(ay,{label:a("Match Case"),isActive:t.matchCase,onClick:()=>o("matchCase",!t.matchCase)}),(0,ah.jsx)(ay,{label:a("Match Whole Words"),isActive:t.matchWholeWords,onClick:()=>o("matchWholeWords",!t.matchWholeWords)}),(0,ah.jsx)(ay,{label:a("Match Diacritics"),isActive:t.matchDiacritics,onClick:()=>o("matchDiacritics",!t.matchDiacritics)})]})},ax=2,aw=1,aS="search-history",ak="search",a_=10,aE=({isVisible:e,bookKey:t,onHideSearchBar:r})=>{let n=(0,as.useTranslation)(),{envConfig:i,appService:a}=(0,an.useEnv)(),{settings:o}=(0,ai.useSettingsStore)(),{getBookData:s}=(0,aa.useBookDataStore)(),{getConfig:l,setConfig:c,saveConfig:f}=(0,aa.useBookDataStore)(),{getView:u,getProgress:d,getViewSettings:h}=(0,ao.useReaderStore)(),{setSearchTerm:p,setSearchResults:b,setSearchProgress:m}=x(),{getSearchNavState:g,getSearchStatus:y,setSearchStatus:v}=x(),w=h(t),{searchTerm:S}=g(t),k=(0,i9.useRef)(""),_=(0,i9.useRef)(null),E=(0,i9.useRef)(!1),M=(0,i9.useMemo)(()=>t.split("-")[0],[t]),N=(0,i9.useMemo)(()=>`${aS}-${M}`,[M]),[A,T]=(0,i9.useState)(()=>{{let e=localStorage.getItem(N);return e?JSON.parse(e):[]}});(0,i9.useEffect)(()=>{let e=localStorage.getItem(N);T(e?JSON.parse(e):[])},[N]);let R=(0,i9.useCallback)(e=>{let t=A.filter(t=>t!==e),r=[e,...t].slice(0,a_);localStorage.setItem(N,JSON.stringify(r)),T(r)},[N,A]),C=e=>{p(t,e),Y(e)},j=()=>{p(t,""),X(),_.current?.focus()},I=async()=>{T([]),localStorage.removeItem(N),await O()},L=(0,i9.useCallback)((e,t)=>{let r=JSON.stringify({scope:t.scope,matchCase:t.matchCase,matchWholeWords:t.matchWholeWords,matchDiacritics:t.matchDiacritics});return(0,ar.md5)(`${e}-${r}`)},[]),P=(0,i9.useCallback)(async(e,t)=>{let r=L(e,t),n=`${ak}/${M}/${r}.json`;try{if(await a?.exists(n,"Cache")){let e=await a?.readFile(n,"Cache","text");if(e)return JSON.parse(e)}}catch(e){console.error("Failed to read search cache:",e)}return null},[M,a,L]),B=(0,i9.useCallback)(async(e,t,r)=>{let n=L(e,t),i=`${ak}/${M}`,o=`${i}/${n}.json`;try{await a?.exists(i,"Cache")||await a?.createDir(i,"Cache",!0),await a?.writeFile(o,"Cache",JSON.stringify(r))}catch(e){console.error("Failed to save search cache:",e)}},[M,a,L]),O=(0,i9.useCallback)(async()=>{let e=`${ak}/${M}`;try{await a?.exists(e,"Cache")&&await a?.deleteDir(e,"Cache",!0)}catch(e){console.error("Failed to clear search cache:",e)}},[M,a]),D=u(t),z=l(t),F=s(t),U=d(t),$=F.book?.primaryLanguage||"en",H=(0,al.useResponsiveSize)(12),q=(0,al.useResponsiveSize)(16);(0,i9.useEffect)(()=>{Y(S)},[t,S]),(0,i9.useEffect)(()=>{e&&_.current&&(_.current.onblur=()=>{E.current=!1},_.current.onfocus=()=>{E.current=!0},a?.isMobile||_.current.focus()),e&&S&&Y(S)},[a,e]),(0,i9.useEffect)(()=>{let e=e=>{"Escape"===e.key&&(_.current&&E.current?_.current.blur():r())};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}},[r]);let V=e=>{let r=e.target.value;p(t,r),Y(r)},W=e=>{c(t,{searchConfig:{...e}}),f(i,t,z,o),Y(S)},K=e=>{let t=(0,af.isCJKStr)(e)?aw:ax;return e.length>=t},G=(0,i9.useCallback)(async e=>{console.log("searching for:",e);let r=z.searchConfig,n=await P(e,r);n&&(b(t,n),m(t,1),n.length>0&&R(e)),m(t,0),v(t,"searching");let{section:i}=U,a="section"===r.scope?i.current:void 0,o=await D.search({...r,index:a,query:e,acceptNode:au({tags:$.startsWith("ja")?["rt"]:[]}),results:n}),s=[],l=0;(async()=>{for await(let n of o){if("terminated"===y(t))return void console.log("search terminated");if("string"==typeof n)"done"===n&&(v(t,"completed"),b(t,[...s]),m(t,1),s.length>0&&(R(e),await B(e,r,s)),console.log("search done"));else if(n.progress){m(t,n.progress);let r=Date.now();if(r-l>=1e3&&(console.log("search progress:",n.progress),l=r),k.current!==e){console.log("search term changed, resetting search"),X();return}}else s.push(n),b(t,[...s]);await new Promise(e=>setTimeout(e,0))}})()},[U,z.searchConfig,b,m,R,P,B]),X=(0,i9.useCallback)(()=>{b(t,[]),D?.clearSearch()},[t,D,b]),Y=(0,i9.useCallback)((0,ac.debounce)(e=>{k.current=e,K(e)?G(e):X()},500),[G,X]);return(0,i8.jsxs)("div",{className:"relative flex flex-col gap-3 p-2",children:[(0,i8.jsxs)("div",{className:"bg-base-100 flex h-8 items-center rounded-lg",children:[(0,i8.jsx)("div",{className:"absolute ps-3",children:(0,i8.jsx)(i7.FaSearch,{size:q,className:"text-base-content/50"})}),(0,i8.jsx)("input",{ref:_,type:"text",value:S,spellCheck:!1,onChange:V,placeholder:n("Search..."),className:"search-input w-full bg-transparent p-2 pr-0 ps-10 font-sans text-sm font-light focus:outline-none"}),S&&(0,i8.jsx)("button",{onClick:j,className:"absolute end-8 flex h-8 w-8 items-center justify-center bg-transparent","aria-label":n("Clear search"),children:(0,i8.jsx)(ae.IoMdCloseCircle,{size:q,className:"text-base-content/75"})}),(0,i8.jsx)("div",{className:(0,i5.default)("absolute end-2 flex h-8 w-8 items-center rounded-r-lg",w?.isEink?"bg-transparent":"bg-base-300"),children:(0,i8.jsx)(ad.default,{label:n("Search Options"),className:(0,i5.default)(window.innerWidth<640&&"dropdown-end","dropdown-bottom flex justify-center"),menuClassName:window.innerWidth<640?"no-triangle mt-1":"dropdown-center mt-3.5",buttonClassName:(0,i5.default)("btn btn-ghost h-8 min-h-8 w-8 p-0 rounded-none rounded-r-lg",w?.isEink?"!bg-transparent hover:!bg-transparent":""),toggleButton:(0,i8.jsx)(i7.FaChevronDown,{size:H,className:"text-base-content/50"}),children:(0,i8.jsx)(av,{isEink:!!w?.isEink,searchConfig:z.searchConfig,onSearchConfigChanged:W})})})]}),A.length>0&&!S&&(0,i8.jsxs)("div",{className:"relative flex",children:[(0,i8.jsx)("div",{className:(0,i5.default)("from-base-200 pointer-events-none absolute left-0 top-0 h-full w-3 bg-gradient-to-r to-transparent",w?.isEink?"hidden":""),"aria-hidden":"true"}),(0,i8.jsx)("div",{className:"scrollbar-hidden flex flex-1 gap-1.5 overflow-x-auto",style:{scrollbarWidth:"none",msOverflowStyle:"none"},children:A.map((e,t)=>(0,i8.jsx)("button",{onClick:()=>C(e),className:"hover:bg-base-200/20 text-base-content/70 bg-base-100 max-w-[60%] flex-shrink-0 whitespace-nowrap rounded-full px-3 py-0.5 text-xs",children:(0,i8.jsx)("p",{className:"truncate",children:e})},t))}),(0,i8.jsx)("div",{className:(0,i5.default)("from-base-200 pointer-events-none absolute right-6 top-0 h-full w-6 bg-gradient-to-l to-transparent",w?.isEink?"hidden":""),"aria-hidden":"true"}),(0,i8.jsx)("button",{onClick:I,className:(0,i5.default)("text-base-content/50 hover:text-base-content/80 flex-shrink-0 items-center","flex h-6 min-h-6 w-8 min-w-8 items-center justify-center p-0"),title:n("Clear search history"),"aria-label":n("Clear search history"),children:(0,i8.jsx)(at.MdDeleteOutline,{size:q})})]})]})};var aM=t,aN=m,aA=c;let aT=({bookKey:e,cfi:t,excerpt:r,onSelectResult:n})=>{let{getProgress:i}=(0,aN.useReaderStore)(),{isCurrent:a,viewRef:o}=i_(t,i(e));return(0,aM.jsx)("li",{role:"button",ref:o,className:(0,aA.default)("my-2 cursor-pointer rounded-lg p-2 text-sm",a?"bg-base-300 hover:bg-gray-300/70":"hover:bg-base-300 bg-base-100"),tabIndex:0,onClick:()=>n(t),onKeyDown:e=>{"Enter"===e.key||" "===e.key?n(t):e.stopPropagation()},children:(0,aM.jsxs)("div",{className:"line-clamp-3",children:[(0,aM.jsx)("span",{className:"",children:r.pre}),(0,aM.jsx)("span",{className:"font-bold text-red-500",children:r.match}),(0,aM.jsx)("span",{className:"",children:r.post})]})})},aR=({bookKey:e,results:t,onSelectResult:r})=>(0,aM.jsx)("div",{className:"search-results overflow-y-auto p-2 font-sans text-sm font-light",children:(0,aM.jsx)("ul",{className:"px-2",children:t.map((t,n)=>"subitems"in t?(0,aM.jsxs)("ul",{children:[(0,aM.jsx)("h3",{className:"line-clamp-1 font-normal",children:t.label}),(0,aM.jsx)("ul",{children:t.subitems.map((t,n)=>(0,aM.jsx)(aT,{bookKey:e,cfi:t.cfi,excerpt:t.excerpt,onSelectResult:r},`${n}-${t.cfi}`))})]},`${n}-${t.label}`):(0,aM.jsx)(aT,{bookKey:e,cfi:t.cfi,excerpt:t.excerpt,onSelectResult:r},`${n}-${t.cfi}`))})}),aC=.05,aj=.45,aI=.5,aL=({onGoToLibrary:e})=>{let t=(0,tF.useTranslation)(),{appService:r}=(0,tH.useEnv)(),{updateAppTheme:n,safeAreaInsets:i}=(0,tV.useThemeStore)(),{settings:a}=(0,tO.useSettingsStore)(),{sideBarBookKey:o,setSideBarBookKey:s,getSearchNavState:l,setSearchTerm:c,clearSearch:f}=x(),{searchTerm:u="",searchResults:d=null}=(o?l(o):null)||{},{getBookData:h}=(0,tD.useBookDataStore)(),{getView:p,getViewSettings:b}=(0,tz.useReaderStore)(),[m,g]=(0,tP.useState)(!1),y=(0,tP.useRef)(u),v=(0,tP.useRef)(1),w=window.innerWidth<640,{sideBarWidth:S,isSideBarPinned:k,isSideBarVisible:_,getSideBarWidth:E,setSideBarVisible:M,handleSideBarResize:N,handleSideBarTogglePin:A}=i4(a.globalReadSettings.sideBarWidth,!w&&a.globalReadSettings.isSideBarPinned),T=async e=>{let{term:t,bookKey:r}=e.detail;M(!0),s(r),g(!0),null!=t&&c(r,t)},R=async()=>{let e=document.querySelector(".sidebar-pin-btn");e&&"none"!==window.getComputedStyle(e).display||M(!1)};(0,tP.useEffect)(()=>{_?n("base-200"):n("base-100")},[_]),(0,tP.useEffect)(()=>{y.current=u},[u]),(0,tP.useEffect)(()=>(tU.eventDispatcher.on("search-term",T),tU.eventDispatcher.on("navigate",R),()=>{tU.eventDispatcher.off("search-term",T),tU.eventDispatcher.off("navigate",R)}),[]);let C=e=>{if(!w)return;let t=e.clientY/window.innerHeight,r=Math.max(0,Math.min(1,t));v.current=r;let n=document.querySelector(".sidebar-container"),i=document.querySelector(".overlay");n&&i&&(n.style.top=`${100*r}%`,i.style.opacity=`${1-t}`)},j=e=>{let t=document.querySelector(".sidebar-container"),n=document.querySelector(".overlay");if(t&&n)if(e.velocity>aI||e.velocity>=0&&e.clientY>=.5*window.innerHeight){let i=.15/Math.max(e.velocity,.5);t.style.transition=`top ${i}s ease-out`,t.style.top="100%",n.style.transition=`opacity ${i}s ease-out`,n.style.opacity="0",setTimeout(()=>M(!1),300),r?.hasHaptics&&(0,tB.impactFeedback)("medium")}else t.style.transition="top 0.3s ease-out",t.style.top="0%",n.style.transition="opacity 0.3s ease-out",n.style.opacity="0.8",r?.hasHaptics&&(0,tB.impactFeedback)("medium")},I=e=>{let t=Math.max(aC,Math.min(aj,e.clientX/window.innerWidth));N(`${Math.round(1e4*t)/100}%`)},L=e=>{let t=parseFloat(E())/100,r=t;"ArrowLeft"===e.key?r=Math.max(aC,t-e.step):"ArrowRight"===e.key&&(r=Math.min(aj,t+e.step)),N(`${Math.round(1e4*r)/100}%`)},P=()=>{},{handleDragStart:B}=(0,tq.useDrag)(C,P,j),{handleDragStart:O,handleDragKeyDown:D}=(0,tq.useDrag)(I,L),z=()=>{M(!1)},F=()=>{g(e=>(e&&$(),!e))},U=(0,tP.useCallback)(()=>{setTimeout(()=>{M(!0),g(!0)},100)},[]),$=(0,tP.useCallback)(()=>{g(!1),setTimeout(()=>{o&&f(o)},100),p(o)?.clearSearch()},[o,f]),H=(0,tP.useCallback)(()=>{y.current?$():k||M(!1)},[o,k]);(0,tK.default)({onShowSearchBar:U,onEscape:H},[H]);let q=e=>{R(),p(o)?.goTo(e)};if(!o)return null;let V=b(o),W=h(o);if(!W||!W.book||!W.bookDoc)return null;let{book:K,bookDoc:G}=W,X=(0,t$.getBookDirFromLanguage)(G.metadata.language);return _?(0,tj.jsxs)(tj.Fragment,{children:[!k&&(0,tj.jsx)(tW.Overlay,{className:(0,tL.default)("z-[45]",V?.isEink?"":"bg-black/50 sm:bg-black/20"),onDismiss:z}),(0,tj.jsxs)("div",{role:"group","aria-label":t("Sidebar"),dir:V?.rtl&&"rtl"===X?"rtl":"ltr",style:{width:`${S}`,maxWidth:`${100*aj}%`,position:k?"relative":"absolute",paddingTop:`${i?.top||0}px`},className:"jsx-fbb074d65c8317d1 "+((0,tL.default)("sidebar-container flex min-w-60 select-none flex-col","full-height transition-[padding-top] duration-300",V?.isEink?"bg-base-100":"bg-base-200",r?.hasRoundedWindow&&"rounded-window-top-left rounded-window-bottom-left",k?"z-20":"z-[45] shadow-2xl",!k&&V?.isEink&&"border-base-content border-e")||""),children:[(0,tj.jsx)(tI.default,{id:"fbb074d65c8317d1",children:"@media (width<=640px){.sidebar-container.jsx-fbb074d65c8317d1{border-top-left-radius:16px;border-top-right-radius:16px;width:100%;min-width:100%}.sidebar-container.open.jsx-fbb074d65c8317d1{top:0%}.overlay.jsx-fbb074d65c8317d1{transition:opacity .3s ease-in-out}}"}),(0,tj.jsx)("div",{role:"slider",tabIndex:0,"aria-label":t("Resize Sidebar"),"aria-orientation":"horizontal","aria-valuenow":parseFloat(S),onMouseDown:O,onTouchStart:O,onKeyDown:D,className:"jsx-fbb074d65c8317d1 "+((0,tL.default)("drag-bar absolute -right-2 top-0 h-full w-0.5 cursor-col-resize bg-transparent p-1",w&&"hidden")||"")}),(0,tj.jsxs)("div",{className:"jsx-fbb074d65c8317d1 flex-shrink-0",children:[w&&(0,tj.jsx)("div",{role:"slider",tabIndex:0,"aria-label":t("Resize Sidebar"),"aria-orientation":"vertical","aria-valuenow":v.current,onMouseDown:B,onTouchStart:B,className:"jsx-fbb074d65c8317d1 drag-handle flex h-10 w-full cursor-row-resize items-center justify-center",children:(0,tj.jsx)("div",{className:"jsx-fbb074d65c8317d1 bg-base-content/50 h-1 w-10 rounded-full"})}),(0,tj.jsx)(rm,{isPinned:k,isSearchBarVisible:m,onGoToLibrary:e,onClose:()=>M(!1),onTogglePin:A,onToggleSearchBar:F}),(0,tj.jsx)("div",{className:"jsx-fbb074d65c8317d1 "+((0,tL.default)("search-bar",{"search-bar-visible":m})||""),children:(0,tj.jsx)(aE,{isVisible:m,bookKey:o,onHideSearchBar:$})}),(0,tj.jsx)("div",{className:"jsx-fbb074d65c8317d1 border-base-300/50 border-b px-3",children:(0,tj.jsx)(i0,{book:K})})]}),m&&d?(0,tj.jsx)(aR,{bookKey:o,results:d,onSelectResult:q}):(0,tj.jsx)(iH,{bookDoc:G,sideBarBookKey:o})]})]}):null};var aP=t,aB=tI,aO=c,aD=r,az=o,aF=ec,aU=m,a$=i,aH=b,aq=n,aV=tq,aW=Y,aK=M,aG=eJ,aX=tW,aY=ru,aZ=tT,aJ=t,aQ=c,a0=tJ,a1=e.i(163845),a2=tQ,a3=i,a6=t2;let a4=({isPinned:e,isSearchBarVisible:t,handleClose:r,handleTogglePin:n,handleToggleSearchBar:i})=>{let a=(0,a3.useTranslation)(),o=(0,a6.useResponsiveSize)(14),s=(0,a6.useResponsiveSize)(18);return(0,aJ.jsxs)("div",{className:"notebook-header relative flex h-11 items-center px-3",dir:"ltr",children:[(0,aJ.jsxs)("div",{className:"absolute inset-0 z-[-1] flex items-center justify-center space-x-2",children:[(0,aJ.jsx)(a1.LuNotebookPen,{size:s}),(0,aJ.jsx)("div",{className:"notebook-title hidden text-sm font-medium sm:flex",children:a("Notebook")})]}),(0,aJ.jsxs)("div",{className:"flex w-full items-center gap-x-4",children:[(0,aJ.jsx)("button",{title:a(e?"Unpin Notebook":"Pin Notebook"),onClick:n,className:(0,aQ.default)("btn btn-ghost btn-circle hidden h-6 min-h-6 w-6 sm:flex",e?"bg-base-300":"bg-base-300/65"),children:e?(0,aJ.jsx)(a2.MdPushPin,{size:o}):(0,aJ.jsx)(a2.MdOutlinePushPin,{size:o})}),(0,aJ.jsx)("button",{title:a("Close"),onClick:r,className:"btn btn-ghost btn-circle flex h-6 min-h-6 w-6 hover:bg-transparent sm:hidden",children:(0,aJ.jsx)(a2.MdArrowBackIosNew,{})})]}),(0,aJ.jsx)("div",{className:"flex items-center justify-end gap-x-4",children:(0,aJ.jsx)("button",{title:a(t?"Hide Search Bar":"Show Search Bar"),onClick:i,className:(0,aQ.default)("btn btn-ghost h-8 min-h-8 w-8 p-0",t&&"bg-base-300"),children:(0,aJ.jsx)(a0.FiSearch,{size:s})})})]})};var a8=t,a5=r,a9=i,a7=t2,oe=e.i(431263),ot=tT;let or=({onSave:e,onEdit:t})=>{let r=(0,a9.useTranslation)(),{notebookNewAnnotation:n,notebookEditAnnotation:i,setNotebookNewAnnotation:a,setNotebookEditAnnotation:o,saveNotebookAnnotationDraft:s,getNotebookAnnotationDraft:l}=w(),c=(0,a5.useRef)(null),[f,u]=(0,a5.useState)(""),d=(0,a7.useResponsiveSize)(3);(0,a5.useEffect)(()=>{if(i){let e=i.note;u(e),c.current?.setValue(e),c.current?.focus()}else if(n){let e=h();if(e){let t=l((0,oe.md5Fingerprint)(e))||"";u(t),c.current?.setValue(t),c.current?.focus()}}},[n,i]);let h=()=>i?.text||n?.text||"",p=e=>{u(e)},b=()=>{let e=c.current?.getValue();if(e){let t=h();t&&s((0,oe.md5Fingerprint)(t),e)}},m=()=>{let r=c.current?.getValue();r&&(n?e(n,r):i&&(i.note=r,t(i)))},g=()=>{n&&a(null),i&&o(null)};(0,ot.default)({onSaveNote:()=>{c.current?.getValue()&&m()},onEscape:g});let y=!!f.trim();return(0,a8.jsxs)("div",{className:"content booknote-item note-editor-container bg-base-100 mt-2 rounded-md p-2",children:[(0,a8.jsx)("div",{className:"flex w-full",children:(0,a8.jsx)(ij,{ref:c,value:f,onChange:p,onBlur:b,onSave:m,onEscape:g,placeholder:r("Add your notes here..."),spellCheck:!1})}),(0,a8.jsxs)("div",{className:"flex items-center pt-2",children:[(0,a8.jsx)("div",{className:"me-2 mt-0.5 min-h-full self-stretch rounded-xl bg-gray-300",style:{minWidth:`${d}px`}}),(0,a8.jsx)("div",{className:"content font-size-sm line-clamp-3",children:(0,a8.jsx)("span",{className:"content font-size-xs text-gray-500",children:h()})})]}),(0,a8.jsxs)("div",{className:"flex justify-end space-x-3 p-2",dir:"ltr",children:[(0,a8.jsx)(iN,{onClick:g,children:r("Cancel")}),(0,a8.jsx)(iN,{onClick:m,disabled:!y,children:r("Save")})]})]})};var on=t,oi=r,oa=i7,oo=ec,os=i,ol=t2;let oc=({isVisible:e,bookKey:t,searchTerm:r,onSearchResultChange:n})=>{let i=(0,os.useTranslation)(),{getConfig:a}=(0,oo.useBookDataStore)(),[o,s]=(0,oi.useState)(r),l=(0,oi.useRef)(null),c=(0,oi.useRef)(null),f=(0,ol.useResponsiveSize)(16),u=(0,ol.useResponsiveSize)(12);(0,oi.useEffect)(()=>{b(o)},[t]),(0,oi.useEffect)(()=>{s(r),b(r)},[r]),(0,oi.useEffect)(()=>{e&&l.current&&l.current.focus()},[e]),(0,oi.useEffect)(()=>{let e=e=>{"Escape"===e.key&&l.current&&l.current.blur()};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e),c.current&&clearTimeout(c.current)}},[]);let d=e=>{let t=e.target.value;s(t),c.current&&clearTimeout(c.current),c.current=setTimeout(()=>{b(t)},300)},h=()=>{s(""),b(""),l.current&&l.current.focus()},p=(e,t)=>{if(!t.trim())return[];let r=t.toLowerCase();return e.filter(e=>{let t=e.text?.toLowerCase().includes(r)||!1,n=e.note?.toLowerCase().includes(r)||!1;return t||n})},b=e=>{e.trim().length>=1?m(e):g()},m=e=>{let r=a(t);if(!r)return void g();let{booknotes:i=[]}=r;n(p(i.filter(e=>!e.deletedAt),e))},g=()=>{n(null)};return(0,on.jsx)("div",{className:"relative px-3 py-2",children:(0,on.jsxs)("div",{className:"bg-base-100 flex h-8 items-center rounded-lg",children:[(0,on.jsx)("div",{className:"pl-3",children:(0,on.jsx)(oa.FaSearch,{size:f,className:"text-base-content/50"})}),(0,on.jsx)("input",{ref:l,type:"text",value:o,spellCheck:!1,onChange:d,placeholder:i("Search notes and excerpts..."),className:"w-full bg-transparent p-2 font-sans text-sm font-light focus:outline-none"}),o&&(0,on.jsx)("div",{className:"bg-base-300 flex h-8 w-8 items-center rounded-r-lg",children:(0,on.jsx)("button",{onClick:h,className:"btn btn-ghost h-8 min-h-8 w-8 rounded-none rounded-r-lg p-0",children:(0,on.jsx)(oa.FaTimes,{size:u,className:"text-base-content/50"})})})]})})},of=.15,ou=.45,od=({})=>{let e=(0,a$.useTranslation)(),{updateAppTheme:t,safeAreaInsets:r}=(0,aH.useThemeStore)(),{envConfig:n,appService:i}=(0,aq.useEnv)(),{settings:a}=(0,az.useSettingsStore)(),{sideBarBookKey:o}=x(),{notebookWidth:s,isNotebookVisible:l,isNotebookPinned:c}=w(),{notebookNewAnnotation:f,notebookEditAnnotation:u,setNotebookPin:d}=w(),{getBookData:h,getConfig:p,saveConfig:b,updateBooknotes:m}=(0,aF.useBookDataStore)(),{getView:g,getViewSettings:y}=(0,aU.useReaderStore)(),{getNotebookWidth:v,setNotebookWidth:S,setNotebookVisible:k,toggleNotebookPin:_}=w(),{setNotebookNewAnnotation:E,setNotebookEditAnnotation:M}=w(),[N,A]=(0,aD.useState)(!1),[T,R]=(0,aD.useState)(null),[C,j]=(0,aD.useState)(""),I=async()=>{let e=document.querySelector(".sidebar-pin-btn");e&&"none"!==window.getComputedStyle(e).display||k(!1)},L=(0,aD.useCallback)(()=>{c||k(!1)},[c]);(0,aZ.default)({onEscape:L},[L]),(0,aD.useEffect)(()=>{l?t("base-200"):t("base-100")},[l]),(0,aD.useEffect)(()=>(S(a.globalReadSettings.notebookWidth),d(a.globalReadSettings.isNotebookPinned),k(a.globalReadSettings.isNotebookPinned),aK.eventDispatcher.on("navigate",I),()=>{aK.eventDispatcher.off("navigate",I)}),[]);let P=e=>{S(e),a.globalReadSettings.notebookWidth=e},B=()=>{_();let e={...a.globalReadSettings,isNotebookPinned:!c};(0,aY.saveSysSettings)(n,"globalReadSettings",e)},O=()=>{k(!1),E(null),M(null)},D=(e,t)=>{if(!o)return;let r=g(o),i=p(o),s=r?.getCFI(e.index,e.range);if(!s)return;let{booknotes:l=[]}=i,c={id:(0,aW.uniqueId)(),type:"annotation",cfi:s,note:t,text:e.text,createdAt:Date.now(),updatedAt:Date.now()};r?.addAnnotation({...c,value:`${iv}${c.cfi}`}),l.push(c);let f=m(o,l);f&&b(n,o,f,a),E(null)},z=(e,t)=>{if(!o)return;let r=g(o),{booknotes:i=[]}=p(o),s=i.findIndex(t=>t.id===e.id);if(-1===s)return;t?e.deletedAt=Date.now():e.updatedAt=Date.now(),i[s]=e,r?.addAnnotation({...e,value:`${iv}${e.cfi}`},!0);let l=m(o,i);l&&b(n,o,l,a),M(null)},F=e=>{let t=Math.max(of,Math.min(ou,1-e.clientX/window.innerWidth));P(`${Math.round(1e4*t)/100}%`)},U=e=>{let t=parseFloat(v())/100,r=t;"ArrowLeft"===e.key?r=Math.max(of,t+e.step):"ArrowRight"===e.key&&(r=Math.min(ou,t-e.step)),P(`${Math.round(1e4*r)/100}%`)},{handleDragStart:$,handleDragKeyDown:H}=(0,aV.useDrag)(F,U),{booknotes:q=[]}=p(o)||{},V=q.filter(e=>"annotation"===e.type&&e.note&&!e.deletedAt).sort((e,t)=>t.createdAt-e.createdAt),W=q.filter(e=>"excerpt"===e.type&&e.text&&!e.deletedAt).sort((e,t)=>e.createdAt-t.createdAt),K=()=>{A(e=>!e),N&&(R(null),j(""))},G=(0,aD.useMemo)(()=>N&&T?T.filter(e=>"annotation"===e.type&&e.note&&!e.deletedAt):V,[V,T,N]),X=(0,aD.useMemo)(()=>N&&T?T.filter(e=>"excerpt"===e.type&&e.text&&!e.deletedAt):W,[W,T,N]);if(!o)return null;let Y=h(o),Z=y(o);if(!Y||!Y.bookDoc)return null;let{bookDoc:J}=Y,Q=(0,aG.getBookDirFromLanguage)(J.metadata.language),ee=G.length>0||X.length>0,et=V.length>0||W.length>0;return l?(0,aP.jsxs)(aP.Fragment,{children:[!c&&(0,aP.jsx)(aX.Overlay,{className:(0,aO.default)("z-[45]",Z?.isEink?"":"bg-black/20"),onDismiss:O}),(0,aP.jsxs)("div",{role:"group","aria-label":e("Notebook"),dir:Z?.rtl&&"rtl"===Q?"rtl":"ltr",style:{width:`${s}`,maxWidth:`${100*ou}%`,position:c?"relative":"absolute",paddingTop:`${r?.top||0}px`},className:"jsx-790d1708c20552f7 "+((0,aO.default)("notebook-container right-0 flex min-w-60 select-none flex-col","full-height font-sans text-base font-normal sm:text-sm",Z?.isEink?"bg-base-100":"bg-base-200",i?.hasRoundedWindow&&"rounded-window-top-right rounded-window-bottom-right",c?"z-20":"z-[45] shadow-2xl",!c&&Z?.isEink&&"border-base-content border-s")||""),children:[(0,aP.jsx)(aB.default,{id:"790d1708c20552f7",children:"@media (width<=640px){.notebook-container.jsx-790d1708c20552f7{width:100%;min-width:100%}}"}),(0,aP.jsx)("div",{role:"slider",tabIndex:0,"aria-label":e("Resize Notebook"),"aria-orientation":"horizontal","aria-valuenow":parseFloat(s),onMouseDown:$,onTouchStart:$,onKeyDown:H,className:"jsx-790d1708c20552f7 "+((0,aO.default)("drag-bar absolute -left-2 top-0 h-full w-0.5 cursor-col-resize bg-transparent p-2")||"")}),(0,aP.jsxs)("div",{className:"jsx-790d1708c20552f7 flex-shrink-0",children:[(0,aP.jsx)(a4,{isPinned:c,isSearchBarVisible:N,handleClose:()=>k(!1),handleTogglePin:B,handleToggleSearchBar:K}),(0,aP.jsx)("div",{className:"jsx-790d1708c20552f7 "+((0,aO.default)("search-bar",{"search-bar-visible":N})||""),children:(0,aP.jsx)(oc,{isVisible:N,bookKey:o,searchTerm:C,onSearchResultChange:R})})]}),(0,aP.jsxs)("div",{className:"jsx-790d1708c20552f7 flex-grow overflow-y-auto px-3",children:[N&&T&&!ee&&et&&(0,aP.jsx)("div",{className:"jsx-790d1708c20552f7 flex h-32 items-center justify-center text-gray-500",children:(0,aP.jsx)("p",{className:"jsx-790d1708c20552f7 font-size-sm text-center",children:e("No notes match your search")})}),(0,aP.jsx)("div",{dir:"ltr",className:"jsx-790d1708c20552f7",children:X.length>0&&(0,aP.jsxs)("p",{className:"jsx-790d1708c20552f7 content font-size-base",children:[e("Excerpts"),N&&T&&(0,aP.jsxs)("span",{className:"jsx-790d1708c20552f7 font-size-xs ml-2 text-gray-500",children:["(",X.length,")"]})]})}),(0,aP.jsx)("ul",{className:"jsx-790d1708c20552f7 ",children:X.map((t,r)=>(0,aP.jsx)("li",{className:"jsx-790d1708c20552f7 my-2",children:(0,aP.jsxs)("div",{role:"button",tabIndex:0,onKeyDown:e=>{("Backspace"===e.key||"Delete"===e.key)&&z(t,!0)},className:"jsx-790d1708c20552f7 booknote-item collapse-arrow border-base-300 bg-base-100 collapse border",children:[(0,aP.jsx)("div",{style:{"--top-override":"1.25rem","--end-override":"0.7rem"},className:"jsx-790d1708c20552f7 "+((0,aO.default)("collapse-title pe-8 text-sm font-medium","h-[2.5rem] min-h-[2.5rem] p-[0.6rem]")||""),children:(0,aP.jsx)("p",{className:"jsx-790d1708c20552f7 line-clamp-1",children:t.text||`Excerpt ${r+1}`})}),(0,aP.jsxs)("div",{className:"jsx-790d1708c20552f7 collapse-content font-size-xs select-text px-3 pb-0",children:[(0,aP.jsx)("p",{className:"jsx-790d1708c20552f7 hyphens-auto text-justify",children:t.text}),(0,aP.jsx)("div",{dir:"ltr",className:"jsx-790d1708c20552f7 flex justify-end",children:(0,aP.jsx)("div",{onClick:z.bind(null,t,!0),"aria-label":e("Delete"),className:"jsx-790d1708c20552f7 font-size-xs cursor-pointer align-bottom text-red-500 hover:text-red-600",children:e("Delete")})})]})]})},`${r}-${t.id}`))}),(0,aP.jsx)("div",{dir:"ltr",className:"jsx-790d1708c20552f7",children:(f||G.length>0)&&(0,aP.jsxs)("p",{className:"jsx-790d1708c20552f7 content font-size-base",children:[e("Notes"),N&&T&&G.length>0&&(0,aP.jsxs)("span",{className:"jsx-790d1708c20552f7 font-size-xs ml-2 text-gray-500",children:["(",G.length,")"]})]})}),(f||u)&&!N&&(0,aP.jsx)(or,{onSave:D,onEdit:e=>z(e,!1)}),(0,aP.jsx)("ul",{className:"jsx-790d1708c20552f7",children:G.map((e,t)=>(0,aP.jsx)(iI,{bookKey:o,item:e},`${t}-${e.cfi}`))})]})]})]}):null};var oh=t,op=c,ob=r,om=n,og=b,oy=m,ov=ec,ox=i;let ow=(e,t)=>e<=1?{columns:"1fr",rows:"1fr"}:2===e?t<1?{columns:"1fr",rows:"1fr 1fr"}:{columns:"1fr 1fr",rows:"1fr"}:3===e||4===e?{columns:"1fr 1fr",rows:"1fr 1fr"}:{columns:"1fr 1fr 1fr",rows:"1fr 1fr 1fr"},oS=(e,t,r)=>{let n=ow(t,r),i=n.columns.split(" ").length,a=n.rows.split(" ").length,o=Math.floor(e/i),s=e%i;return{top:0===o,right:s===i-1,bottom:o===a-1,left:0===s}},ok=e=>{let t=e.showHeader,r=e.showFooter,n=e.vertical||e.writingMode.includes("vertical"),i=e.marginPx||e.marginTopPx,a=e.compactMarginPx||e.compactMarginTopPx,o=e.marginBottomPx,s=e.compactMarginBottomPx,l=e.marginLeftPx,c=e.marginRightPx,f=e.compactMarginLeftPx,u=e.compactMarginRightPx;return{top:t&&!n?i:a,right:t&&n?c:u,bottom:r&&!n?o:s,left:r&&n?l:f}};var o_=t,oE=i,oM=r,oN=m;function oA(e){let{getView:t,getProgress:r}=(0,oN.useReaderStore)(),{setSideBarVisible:n}=x(),{getSearchNavState:i,setSearchResultIndex:a,clearSearch:o}=x(),{searchTerm:s,searchResults:l,searchResultIndex:c,searchProgress:f}=i(e),u=r(e),d=(0,oM.useMemo)(()=>u?.location,[u]),h=(0,oM.useMemo)(()=>l?oz(l):[],[l]),p=h.length,b=l&&p>0,m=(0,oM.useMemo)(()=>!h.length||c>=h.length?"":h[c]?.sectionLabel||"",[h,c]),g=(0,oM.useMemo)(()=>{if(!h.length||!d)return{firstIndex:-1,lastIndex:-1};let t=-1,r=-1;for(let e=0;e<h.length;e++){let n=h[e];n&&ik(n.cfi,d)&&(-1===t&&(t=e),r=e)}return -1!==t&&setTimeout(()=>a(e,t),0),{firstIndex:t,lastIndex:r}},[h,d,e,a]),y=(0,oM.useCallback)(r=>{if(!h.length||r<0||r>=h.length)return;let n=h[r];n&&(a(e,r),t(e)?.goTo(n.cfi))},[e,h,a,t]),v=(0,oM.useCallback)(()=>{n(!0)},[n]),w=(0,oM.useCallback)(()=>{o(e),t(e)?.clearSearch()},[o,e,t]),S=(0,oM.useCallback)(()=>{let{firstIndex:e}=g;e>0?y(e-1):-1===e&&c>0&&y(c-1)},[g,c,y]),k=(0,oM.useCallback)(()=>{let{lastIndex:e}=g;e>=0&&e<p-1?y(e+1):-1===e&&c<p-1&&y(c+1)},[g,p,c,y]),_=g.firstIndex>0||-1===g.firstIndex&&c>0,E=g.lastIndex>=0&&g.lastIndex<p-1||-1===g.lastIndex&&c<p-1;return{searchTerm:s,searchProgress:f,currentSection:m,searchResultIndex:c,totalResults:p,showSearchNav:b,hasPreviousPage:_,hasNextPage:E,handleShowResults:v,handleCloseSearch:w,handlePreviousResult:S,handleNextResult:k}}var oT=t,oR=c,oC=iD,oj=e.i(996459),oI=n,oL=i,oP=t2,oB=m;let oO=({bookKey:e,gridInsets:t,title:r,section:n,progress:i,showListButton:a=!0,hasPrevious:o,hasNext:s,previousLabel:l,nextLabel:c,previousTitle:f,nextTitle:u,showResultsTitle:d,closeTitle:h,onShowResults:p,onClose:b,onPrevious:m,onNext:g})=>{let{appService:y}=(0,oI.useEnv)(),v=(0,oL.useTranslation)(),{getViewSettings:x}=(0,oB.useReaderStore)(),w=x(e),S=(0,oP.useResponsiveSize)(16),k=(0,oP.useResponsiveSize)(18),_=(0,oP.useResponsiveSize)(20),E=y?.isMobile||!w?.showHeader;return(0,oT.jsxs)("div",{className:"results-nav-bar pointer-events-none absolute inset-0 z-30 flex flex-col items-center justify-between px-4 py-1",style:{top:t.top,right:t.right,bottom:t.bottom/4,left:t.left},children:[(0,oT.jsxs)("div",{className:"bg-base-100 pointer-events-auto relative flex items-center justify-between overflow-hidden rounded-xl px-2 py-1 shadow-lg sm:gap-6",children:[void 0!==i&&i<1&&(0,oT.jsx)("div",{className:"bg-base-200 absolute inset-y-0 left-0 transition-all duration-300",style:{width:`${100*i}%`}}),1===i&&(0,oT.jsx)("div",{className:"bg-base-200 absolute inset-0"}),a&&p?(0,oT.jsx)("button",{title:d||v("Show Results"),onClick:p,className:"btn btn-ghost relative z-10 h-8 min-h-8 w-8 p-0 hover:bg-transparent",children:(0,oT.jsx)(oC.IoIosList,{size:_,className:"text-base-content"})}):(0,oT.jsx)("div",{className:"relative z-10 w-8"}),(0,oT.jsxs)("div",{className:"relative z-10 flex flex-1 flex-col items-center px-2",children:[(0,oT.jsx)("span",{className:"line-clamp-1 text-sm font-medium",children:r}),n&&E&&(0,oT.jsx)("span",{className:"text-base-content/70 line-clamp-1 text-xs",children:n})]}),(0,oT.jsx)("button",{title:h||v("Close"),onClick:b,className:"btn btn-ghost relative z-10 h-8 min-h-8 w-8 p-0 hover:bg-transparent",children:(0,oT.jsx)(oC.IoMdCloseCircle,{size:S})})]}),(0,oT.jsxs)("div",{className:"bg-base-200 pointer-events-auto flex items-center justify-between gap-6 rounded-xl px-4 py-0 shadow-lg",children:[(0,oT.jsxs)("button",{title:f||v("Previous"),onClick:m,disabled:!o,className:(0,oR.default)("btn btn-ghost flex h-auto min-h-0 flex-1 flex-col items-center gap-0 p-1 hover:bg-transparent",!o&&"opacity-40 disabled:bg-transparent"),children:[(0,oT.jsx)(oj.HiArrowLongLeft,{size:k,className:"text-base-content"}),(0,oT.jsx)("span",{className:"text-sm font-medium",children:l||v("Previous")})]}),(0,oT.jsxs)("button",{title:u||v("Next"),onClick:g,disabled:!s,className:(0,oR.default)("btn btn-ghost flex h-auto min-h-0 flex-1 flex-col items-center gap-0 p-1 hover:bg-transparent",!s&&"opacity-40 disabled:bg-transparent"),children:[(0,oT.jsx)(oj.HiArrowLongRight,{size:k,className:"text-base-content"}),(0,oT.jsx)("span",{className:"text-sm font-medium",children:c||v("Next")})]})]})]})},oD=({bookKey:e,gridInsets:t})=>{let{searchTerm:r,searchProgress:n,currentSection:i,showSearchNav:a,hasPreviousPage:o,hasNextPage:s,handleShowResults:l,handleCloseSearch:c,handlePreviousResult:f,handleNextResult:u}=oA(e),d=(0,oE.useTranslation)();return a?(0,o_.jsx)(oO,{bookKey:e,gridInsets:t,title:d("Search results for '{{term}}'",{term:r}),section:i,progress:n,hasPrevious:o,hasNext:s,previousTitle:d("Previous Result"),nextTitle:d("Next Result"),showResultsTitle:d("Show Search Results"),closeTitle:d("Close Search"),onShowResults:l,onClose:c,onPrevious:f,onNext:u}):null};function oz(e){let t=[];for(let r of e)if("subitems"in r)for(let e of r.subitems)t.push({cfi:e.cfi,sectionLabel:r.label});else t.push({cfi:r.cfi,sectionLabel:""});return t}var oF=t,oU=i,o$=r,oH=rJ,oq=m,oV=ec,oW=rR;function oK(e,t){let{getView:r,getProgress:n}=(0,oq.useReaderStore)(),{getConfig:i}=(0,oV.useBookDataStore)(),{setSideBarVisible:a,getBooknotesNavState:o,setActiveBooknoteType:s,setBooknoteResults:l,setBooknoteIndex:c,clearBooknotesNav:f}=x(),{activeBooknoteType:u,booknoteResults:d,booknoteIndex:h}=o(e),p=n(e),b=p?.location,m=(0,o$.useMemo)(()=>{let t=i(e);return t?.booknotes?.filter(e=>!e.deletedAt)||[]},[e,i]),g=(0,o$.useMemo)(()=>d?[...d].sort((e,t)=>oH.compare(e.cfi,t.cfi)):[],[d]),y=g.length,v=d&&y>0&&null!==u,w=(0,o$.useMemo)(()=>{if(!g.length||h>=g.length)return"";let e=g[h];if(!e)return"";let r=(0,oW.findTocItemBS)(t,e.cfi);return r?.label||""},[g,h,t]),S=(0,o$.useMemo)(()=>{if(!g.length||!b)return{firstIndex:-1,lastIndex:-1};let t=-1,r=-1;for(let e=0;e<g.length;e++){let n=g[e];n&&ik(n.cfi,b)&&(-1===t&&(t=e),r=e)}return -1!==t&&setTimeout(()=>c(e,t),0),{firstIndex:t,lastIndex:r}},[g,b,e,c]),k=(0,o$.useCallback)(t=>{if(!g.length||t<0||t>=g.length)return;let n=g[t];n&&(c(e,t),r(e)?.goTo(n.cfi))},[e,g,c,r]),_=(0,o$.useCallback)(t=>{let n=m.filter(e=>e.type===t);if(0===n.length)return;let i=[...n].sort((e,t)=>oH.compare(e.cfi,t.cfi));s(e,t),l(e,i),c(e,0),i.length>0&&r(e)?.goTo(i[0].cfi)},[m,e,s,l,c,r]),E=(0,o$.useCallback)(()=>{a(!0)},[a]),M=(0,o$.useCallback)(()=>{f(e)},[f,e]),N=(0,o$.useCallback)(()=>{let{firstIndex:e}=S;e>0?k(e-1):-1===e&&h>0&&k(h-1)},[S,h,k]),A=(0,o$.useCallback)(()=>{let{lastIndex:e}=S;e>=0&&e<y-1?k(e+1):-1===e&&h<y-1&&k(h+1)},[S,y,h,k]),T=S.firstIndex>0||-1===S.firstIndex&&h>0,R=S.lastIndex>=0&&S.lastIndex<y-1||-1===S.lastIndex&&h<y-1,C=(0,o$.useMemo)(()=>m.filter(e=>"bookmark"===e.type).length,[m]);return{activeBooknoteType:u,currentSection:w,booknoteIndex:h,totalResults:y,showBooknotesNav:v,hasPreviousPage:T,hasNextPage:R,bookmarkCount:C,annotationCount:(0,o$.useMemo)(()=>m.filter(e=>"annotation"===e.type).length,[m]),excerptCount:(0,o$.useMemo)(()=>m.filter(e=>"excerpt"===e.type).length,[m]),startNavigation:_,handleShowResults:E,handleClose:M,handlePrevious:N,handleNext:A}}let oG=({bookKey:e,gridInsets:t,toc:r})=>{let{activeBooknoteType:n,currentSection:i,showBooknotesNav:a,hasPreviousPage:o,hasNextPage:s,handleShowResults:l,handleClose:c,handlePrevious:f,handleNext:u}=oK(e,r),d=(0,oU.useTranslation)();if(!a)return null;let h=()=>{switch(n){case"bookmark":return d("Bookmarks");case"annotation":return d("Annotations");case"excerpt":return d("Excerpts");default:return""}};return(0,oF.jsx)(oO,{bookKey:e,gridInsets:t,title:h(),section:i,hasPrevious:o,hasNext:s,progress:1,previousTitle:d("Previous"),nextTitle:d("Next"),showResultsTitle:h(),closeTitle:d("Close"),onShowResults:l,onClose:c,onPrevious:f,onNext:u})};var oX=t,oY=r,oZ=e.i(835106),oJ=n,oQ=b,o0=m,o1=ec,o2=o,o3=e.i(275604),o6=r,o4=m,o8=ec,o5=X,o9=M;let o7=(e,t,r)=>{let{hoveredBookKey:n}=(0,o4.useReaderStore)(),i=(0,o5.debounce)(r,500),a=(0,o5.debounce)(t,100),o=r=>{r instanceof MessageEvent?r.data&&r.data.bookKey===e&&("iframe-wheel"===r.data.type&&i("mouse",-r.data.deltaY,0),"iframe-wheel"===r.data.type?r.data.ctrlKey?r.data.deltaY>0?o9.eventDispatcher.dispatch("zoom-out",{factor:Math.abs(r.data.deltaY)/100}):r.data.deltaY<0&&o9.eventDispatcher.dispatch("zoom-in",{factor:Math.abs(r.data.deltaY)/100}):a(r):t(r)):"wheel"===r.type?i("mouse",-r.deltaY,0):t(r)};return(0,o6.useEffect)(()=>(window.addEventListener("message",o),()=>{window.removeEventListener("message",o)}),[e,n]),{onClick:t,onWheel:o}},se=(e,t,r)=>{let{getBookData:n}=(0,o8.useBookDataStore)(),{hoveredBookKey:i,setHoveredBookKey:a,getViewSettings:o}=(0,o4.useReaderStore)(),s=(0,o6.useRef)(null),l=(0,o6.useRef)(null),c=(0,o6.useRef)(null),f=(0,o6.useRef)(null),u=e=>{let t=e.targetTouches[0];t&&(s.current=t,c.current="timeStamp"in e?e.timeStamp:Date.now())},d=t=>{if(!s.current)return;let r=t.targetTouches[0];r&&(l.current=r,f.current="timeStamp"in t?t.timeStamp:Date.now());let{current:n}=s,{current:c}=l;if(i&&c){let t=o(e),r=c.screenY-n.screenY,i=c.screenX-n.screenX;t.scrolled||t.vertical?a(null):Math.abs(i)>Math.abs(r)&&Math.abs(i)>10&&a(null)}},h=u=>{if(!s.current)return;let d=u.targetTouches[0];d&&(l.current=d,f.current="timeStamp"in u?u.timeStamp:Date.now());let h=window.innerWidth,{current:p}=s,{current:b}=l,{current:m}=c,{current:g}=f;if(b){let s=o(e),l=n(e),c=b.screenY-p.screenY,f=b.screenX-p.screenX,u=g&&m?g-m:0;c<-10&&Math.abs(c)>2*Math.abs(f)&&Math.abs(f)<.3*h?s.scrolled||s.vertical||l.isFixedLayout&&!(s.zoomLevel<=100)||a(i?null:e):i&&a(null),t(new CustomEvent("touch-swipe",{detail:{deltaX:f,deltaY:c,deltaT:u,startX:p.screenX,startY:p.screenY,endX:b.screenX,endY:b.screenY}})),r("touch",c,30)}s.current=null,l.current=null},p=t=>{t.data&&t.data.bookKey===e&&("iframe-touchstart"===t.data.type?u(t.data):"iframe-touchmove"===t.data.type?d(t.data):"iframe-touchend"===t.data.type&&h(t.data))};return(0,o6.useEffect)(()=>(window.addEventListener("message",p),()=>{window.removeEventListener("message",p)}),[i]),{onTouchStart:u,onTouchMove:d,onTouchEnd:h}};var st=r;let sr=(e,t)=>{let r=t?.onLoad,n=t?.onRelocate,i=t?.onLinkClick,a=t?.onRendererRelocate,o=t?.onDrawAnnotation,s=t?.onShowAnnotation;(0,st.useEffect)(()=>{if(e)return r&&e.addEventListener("load",r),n&&e.addEventListener("relocate",n),i&&e.addEventListener("link",i),a&&e.renderer.addEventListener("relocate",a),o&&e.addEventListener("draw-annotation",o),s&&e.addEventListener("show-annotation",s),()=>{r&&e.removeEventListener("load",r),n&&e.removeEventListener("relocate",n),i&&e.removeEventListener("link",i),a&&e.renderer.removeEventListener("relocate",a),o&&e.removeEventListener("draw-annotation",o),s&&e.removeEventListener("show-annotation",s)}},[e])};var sn=r,si=rt,sa=e.i(778912),so=rl,ss=ec,sl=m,sc=o,sf=i,su=e.i(421966),sd=oZ,sh=X,sp=M,sb=e8,sm=rJ;class sg{document;spineItemIndex;constructor(e,t=0){this.document=e,this.spineItemIndex=t}static extractSpineIndex(e){try{if(e.startsWith("epubcfi(")){let t=(0,sm.collapse)((0,sm.parse)(e)),r=t[0]?.[1]?.index;if(void 0===r)throw Error("Cannot extract spine index from CFI");return Math.floor((r-2)/2)}if(e.startsWith("/body/DocFragment[")){let t=e.match(/DocFragment\[(\d+)\]/);if(t)return parseInt(t[1],10)-1;throw Error("Cannot extract spine index from XPath")}throw Error("Unsupported format for spine index extraction")}catch(t){throw Error(`Cannot extract spine index from CFI/XPointer: ${e} - ${t}`)}}xPointerToCFI(e,t){try{if(t)return this.convertRangeXPointerToCFI(e,t);return this.convertPointXPointerToCFI(e)}catch(t){throw Error(`Failed to convert XPointer ${e}: ${t}`)}}cfiToXPointer(e){try{let t=(0,sm.parse)(e);if(t.parent){let e=sm.fake.toIndex(t.parent.shift());if(e!==this.spineItemIndex)throw Error(`CFI spine index ${e} does not match converter spine index ${this.spineItemIndex}`);let r=(0,sm.toRange)(this.document,t),n=this.rangePointToXPointer(r.startContainer,r.startOffset),i=this.rangePointToXPointer(r.endContainer,r.endOffset);return{xpointer:n,pos0:n,pos1:i}}let r=(0,sm.collapse)(t),n=sm.fake.toIndex(t.shift());if(n!==this.spineItemIndex)throw Error(`CFI spine index ${n} does not match converter spine index ${this.spineItemIndex}`);let i=(0,sm.toElement)(this.document,t[0]);if(!i)throw Error(`Element not found for CFI: ${e}`);let a=r[r.length-1]?.[r[r.length-1].length-1],o=a?.offset;return{xpointer:void 0!==o?this.handleTextOffset(i,o):this.buildXPointerPath(i)}}catch(t){throw Error(`Failed to convert CFI ${e}: ${t}`)}}validateCFI(e){try{return(0,sm.parse)(e),this.cfiToXPointer(e),!0}catch{return!1}}validateXPointer(e,t){try{return this.xPointerToCFI(e,t),!0}catch{return!1}}convertPointXPointerToCFI(e){let{element:t,textOffset:r}=this.parseXPointer(e),n=this.document.createRange();if(void 0!==r){let e=this.findTextNodeAtOffset(t,r);e?(n.setStart(e.node,e.offset),n.setEnd(e.node,e.offset)):(n.setStart(t,0),n.setEnd(t,0))}else n.setStart(t,0),n.setEnd(t,0);let i=(0,sm.fromRange)(n);return this.adjustSpineIndex(i)}convertRangeXPointerToCFI(e,t){let r=this.parseXPointer(e),n=this.parseXPointer(t),i=this.document.createRange();if(void 0!==r.textOffset){let e=this.findTextNodeAtOffset(r.element,r.textOffset);e?i.setStart(e.node,e.offset):i.setStart(r.element,0)}else i.setStart(r.element,0);if(void 0!==n.textOffset){let e=this.findTextNodeAtOffset(n.element,n.textOffset);e?i.setEnd(e.node,e.offset):i.setEnd(n.element,0)}else i.setEnd(n.element,0);let a=(0,sm.fromRange)(i);return this.adjustSpineIndex(a)}parseXPointer(e){let t=e.match(/\/text\(\)\.(\d+)$/),r=t?parseInt(t[1],10):void 0,n=void 0!==r?e.replace(/\/text\(\)\.\d+$/,""):e,i=this.resolveXPointerPath(n);if(!i)throw Error(`Cannot resolve XPointer path: ${n}`);return{element:i,textOffset:r}}resolveXPointerPath(e){let t=e.match(/^\/body\/DocFragment\[\d+\]\/body(.*)$/);if(!t)throw Error(`Invalid XPointer format: ${e}`);let r=t[1],n=this.document.body;if(!r||""===r)return n;for(let e of r.split("/").filter(Boolean)){let t,r,i=e.match(/^(\w+)\[(\d+)\]$/),a=e.match(/^(\w+)$/);if(i){let[,e,n]=i;t=e,r=Math.max(0,parseInt(n,10)-1)}else if(a){let[,e]=a;t=e,r=0}else throw Error(`Invalid XPointer segment: ${e}`);let o=Array.from(n.children).filter(e=>e.tagName.toLowerCase()===t?.toLowerCase());if(r>=o.length)throw Error(`Element index ${r} out of bounds for tag ${t}`);n=o[r]}return n}findTextNodeAtOffset(e,t){let r=[];this.collectTextNodes(e,r);let n=0;for(let e of r){let r=(e.textContent||"").length;if(n+r>=t)return{node:e,offset:t-n};n+=r}if(r.length>0){let e=r[r.length-1];return{node:e,offset:(e.textContent||"").length}}return null}adjustSpineIndex(e){let t=e.match(/^epubcfi\((.+)\)$/);if(!t)throw Error(`Invalid CFI format: ${e}`);let r=t[1],n=(this.spineItemIndex+1)*2;if(r.match(/^\/6\/\d+!/)){let e=r.replace(/^\/6\/\d+!/,`/6/${n}!`);return`epubcfi(${e})`}{let e=`/6/${n}!${r}`;return`epubcfi(${e})`}}rangePointToXPointer(e,t){if(e.nodeType===Node.TEXT_NODE){let r=e.parentElement||this.document.documentElement;return this.handleTextOffsetInElement(r,e,t)}if(e.nodeType!==Node.ELEMENT_NODE)return this.buildXPointerPath(this.document.documentElement);{let r=e;if(0===t)return r.childNodes.length>0&&r.childNodes[0].nodeType===Node.ELEMENT_NODE?this.buildXPointerPath(r.childNodes[0]):this.buildXPointerPath(r);{let e=Array.from(r.childNodes),n=e[t-1]||e[e.length-1];return n?.nodeType===Node.ELEMENT_NODE?this.buildXPointerPath(n):n?.nodeType===Node.TEXT_NODE?this.handleTextOffsetInElement(r,n,n.textContent?.length||0):this.buildXPointerPath(r)}}}buildXPointerPath(e){let t=[],r=e;for(;r&&r!==this.document.documentElement;){let e=r.parentElement;if(!e)break;let n=r.tagName.toLowerCase(),i=0,a=0;for(let t of Array.from(e.children))t.tagName.toLowerCase()===n&&(t===r&&(i=a),a++);1===a?t.unshift(n):t.unshift(`${n}[${i+1}]`),r=e}let n=`/body/DocFragment[${this.spineItemIndex+1}]`;return t.length>0&&t[0].startsWith("body")&&t.shift(),n+="/body",t.length>0&&(n+="/"+t.join("/")),n}handleTextOffset(e,t){let r=[];this.collectTextNodes(e,r);let n=0,i=null,a=0;for(let e of r){let r=(e.textContent||"").length;if(n+r>=t){i=e,a=t-n;break}n+=r}if(!i)return this.buildXPointerPath(e);let o=i.parentElement;for(;o&&!this.isSignificantElement(o);)o=o.parentElement;o||(o=e);let s=this.buildXPointerPath(o);return`${s}/text().${a}`}handleTextOffsetInElement(e,t,r){let n=[];this.collectTextNodes(e,n);let i=0;for(let e of n){if(e===t){i+=r;break}i+=(e.textContent||"").length}return this.handleTextOffset(e,i)}collectTextNodes(e,t){for(let r of Array.from(e.childNodes))r.nodeType===Node.TEXT_NODE?(r.textContent||"").length>0&&t.push(r):r.nodeType===Node.ELEMENT_NODE&&this.collectTextNodes(r,t)}isSignificantElement(e){let t=e.tagName.toLowerCase();return!new Set(["span","em","strong","i","b","u","small","mark","sup","sub"]).has(t)}}let sy=async(e,t,r,n)=>{let i,a=sg.extractSpineIndex(e);if(r===a&&t)i=new sg(t,r||0);else{let e=await n?.sections?.[a]?.createDocument();if(!e)throw Error("Failed to load document for XPointer conversion.");i=new sg(e,a||0)}return i.xPointerToCFI(e)},sv=async(e,t,r,n)=>{let i,a=sg.extractSpineIndex(e);if(r===a&&t)i=new sg(t,r||0);else{let e=await n?.sections?.[a]?.createDocument();if(!e)throw Error("Failed to load document for CFI conversion.");i=new sg(e,a||0)}return i.cfiToXPointer(e)},sx=e=>{let t=/\/text\(\).*$/;e.match(t)&&(e=e.replace(t,""));let r=/\.\d+$/;return e.match(r)&&(e=e.replace(r,"")),e},sw=e=>{let t=(0,sf.useTranslation)(),{getConfig:r,setConfig:n,getBookData:i}=(0,ss.useBookDataStore)(),{getView:a,getProgress:o,setHoveredBookKey:s}=(0,sl.useReaderStore)(),{settings:l}=(0,sc.useSettingsStore)(),{syncedConfigs:c,syncConfigs:f}=(0,sa.useSync)(e),{user:u}=(0,si.useAuth)(),d=o(e),h=(0,sn.useRef)(!1),p=(0,sn.useRef)(!1),b=async(e,t)=>{let r=i(e)?.book;if(!t||!r||!u)return;let n=e.split("-")[0],a=r.metaHash,o={...t,bookHash:n,metaHash:a},s=JSON.parse((0,su.serializeConfig)(o,l.globalViewSettings,sb.DEFAULT_BOOK_SEARCH_CONFIG));delete s.booknotes,await f([s],n,a,"push")},m=async e=>{let t=i(e)?.book;if(!u||!t)return;let r=e.split("-")[0],n=t.metaHash;await f([],r,n,"pull")},g=async()=>{if(h.current){let t=r(e),n=a(e),o=i(e)?.book;if(t&&n&&o&&t.progress&&t.progress[0]>0){try{let e=n.renderer.getContents()[0];if(e&&!so.FIXED_LAYOUT_FORMATS.has(o.format)){let{doc:r,index:n}=e,i=await sv(t.location,r,n||0);t.xpointer=sx(i.xpointer)}}catch(e){console.warn("Failed to convert CFI to XPointer",e)}b(e,t)}}else m(e)},y=async t=>{let{bookKey:r}=t.detail;r===e&&(h.current=!1,await m(e))};(0,sn.useEffect)(()=>(sp.eventDispatcher.on("sync-book-progress",y),()=>{sp.eventDispatcher.off("sync-book-progress",y)}),[e]);let v=(0,sn.useCallback)((0,sh.debounce)(()=>{g()},1e3*sb.SYNC_PROGRESS_INTERVAL_SEC),[]);(0,sn.useEffect)(()=>{d?.location&&u&&v()},[d?.location]),(0,sn.useEffect)(()=>{d&&!p.current&&(p.current=!0,m(e))},[d]);let x=async o=>{let l=r(e),c=i(e)?.book;if(!o||0===o.length||!l||!c)return;let f=e.split("-")[0],u=c.metaHash,d=o.filter(e=>e.bookHash===f||e.metaHash===u)[0];if(d){let r=l?.location,o=d.location,c=d.xpointer,f=i(e),u=a(e);if(c&&u&&f&&f.bookDoc){let e=u.renderer.getContents()[0],t=sx(c),r=await sy(t,e?.doc,e?.index,f.bookDoc);(!o||0>sd.CFI.compare(o,r))&&(o=r)}let h=Object.fromEntries(Object.entries(d).filter(([e,t])=>null!=t));d.updatedAt>=l.updatedAt?n(e,{...l,...h}):n(e,{...h,...l}),o&&r&&0>sd.CFI.compare(r,o)&&u&&(u.goTo(o),s(null),sp.eventDispatcher.dispatch("hint",{bookKey:e,message:t("Reading Progress Synced")}))}};(0,sn.useEffect)(()=>{!h.current&&c&&(h.current=!0,x(c).catch(e=>{console.error("Failed to apply remote progress",e)}))},[c])};var sS=r,sk=n,s_=ec,sE=m,sM=o,sN=eG;let sA=e=>{let{envConfig:t}=(0,sk.useEnv)(),{getConfig:r,saveConfig:n}=(0,s_.useBookDataStore)(),{getProgress:i}=(0,sE.useReaderStore)(),a=i(e),o=(0,sS.useCallback)((0,sN.throttle)(()=>{setTimeout(async()=>{let i=r(e),a=sM.useSettingsStore.getState().settings;await n(t,e,i,a)},5e3)},1e4),[]);(0,sS.useEffect)(()=>{o()},[a,e])};var sT=e.i(89272),sR=e.i(621081),sC=i,sj=e.i(190463),sI=r,sL=n,sP=o,sB=m,sO=ec,sD=i,sz=rl,sF=X,sU=M;let s$=e=>{let t=(0,sD.useTranslation)(),{appService:r}=(0,sL.useEnv)(),{settings:n}=(0,sP.useSettingsStore)(),{getProgress:i,getView:a}=(0,sB.useReaderStore)(),{getBookData:o}=(0,sO.useBookDataStore)(),[s,l]=(0,sI.useState)(null),[c,f]=(0,sI.useState)("idle"),[u,d]=(0,sI.useState)(null),[h]=(0,sI.useState)(null),p=(0,sI.useRef)(!1),b=i(e);(0,sI.useEffect)(()=>{n.kosync.username&&n.kosync.userkey?l(new G(n.kosync)):l(null)},[n]);let m=(0,sI.useCallback)(()=>{let t,r=i(e),n=o(e)?.book;if(!r||!n)return null;let s="";if(sz.FIXED_LAYOUT_FORMATS.has(n.format)){let e=r.section?.current??0,n=r.section?.total??0;s=e.toString(),t=n>0?(e+1)/n:0}else{let n=a(e),i=r.location;if(!n||!i)return null;try{let e=n.renderer.getContents()[0];if(e){let{doc:t,index:r}=e,n=new sg(t,r||0).cfiToXPointer(i);s=sx(n.xpointer)}}catch(e){console.error("Failed to convert CFI to XPointer",e)}let o=r.pageinfo?.current??0,l=r.pageinfo?.total??0;t=l>0?(o+1)/l:0}return{koProgress:s,percentage:t}},[e,i,o,a]),g=async(r,n,i)=>{let o=a(e);if(sz.FIXED_LAYOUT_FORMATS.has(r.format)){let e=parseInt(i.progress,10);if(isNaN(e))return;o?.select(e-1)}else{if(!i.progress?.startsWith("/body"))return;try{let e=o?.renderer.getContents()[0],t=sx(i.progress),r=await sy(t,e?.doc,e?.index,n);o?.goTo(r)}catch(e){console.error("Failed to convert XPointer to CFI",e);return}}sU.eventDispatcher.dispatch("toast",{message:t("Reading Progress Synced"),type:"info"})},y=async(e,r,n,i)=>{let a="",o="",s=i.percentage||0;if(sz.FIXED_LAYOUT_FORMATS.has(e.format)){let e=n.section,r=e&&e.total>0?Math.round((e.current+1)/e.total*100):0;a=e?t("Page {{page}} of {{total}} ({{percentage}}%)",{page:e.current+1,total:e.total,percentage:r}):t("Current position");let l=parseInt(i.progress,10);if(!isNaN(l)&&s>0){let r=e?.total??0,n=Math.round(l/s);o=1>=Math.abs(r-n)?t("Page {{page}} of {{total}} ({{percentage}}%)",{page:l,total:n,percentage:Math.round(100*s)}):t("Approximately page {{page}} of {{total}} ({{percentage}}%)",{page:l,total:n,percentage:Math.round(100*s)})}else o=t("Approximately {{percentage}}%",{percentage:Math.round(100*s)})}else{let e=n.pageinfo,r=e&&e.total>0?Math.round((e.current+1)/e.total*100):0;a=`${n.sectionLabel} (${r}%)`,o=t("Approximately {{percentage}}%",{percentage:Math.round(100*s)})}d({book:e,bookDoc:r,local:{cfi:n.location,preview:a},remote:{...i,preview:o}})},v=(0,sI.useMemo)(()=>(0,sF.debounce)(async()=>{if(!e||!r||!s||!p.current)return;let{settings:t}=sP.useSettingsStore.getState();if(["receive","disable"].includes(t.kosync.strategy))return;let n=o(e)?.book,i=m();n&&i&&i.koProgress&&await s.updateProgress(n,i.koProgress,i.percentage)},5e3),[e,r,s]),x=(0,sI.useCallback)(async()=>{if(!b?.location||!r||!s)return;let t=o(e),i=t?.book,a=t?.bookDoc;if(!i||!a)return;let{strategy:l,enabled:c}=n.kosync;if(!c)return;if(p.current=!0,"send"===l)return void f("synced");f("checking");let u=await s.getProgress(i);if(!u||!u.progress)return void f("synced");let d=t?.config?.updatedAt||i.updatedAt,h=(u.timestamp?1e3*u.timestamp:Date.now())>d;"receive"===l||"silent"===l&&h?(g(i,a,u),f("synced")):"prompt"===l?(y(i,a,b,u),f("conflict")):f("synced")},[e,r,s,n.kosync,b]);(0,sI.useEffect)(()=>{let t=t=>{t.detail.bookKey===e&&(v(),v.flush())},r=t=>{t.detail.bookKey===e&&v.flush()};return sU.eventDispatcher.on("push-kosync",t),sU.eventDispatcher.on("flush-kosync",r),()=>{sU.eventDispatcher.off("push-kosync",t),sU.eventDispatcher.off("flush-kosync",r),v.flush()}},[e,v]),(0,sI.useEffect)(()=>{let t=t=>{t.detail.bookKey===e&&x()};return sU.eventDispatcher.on("pull-kosync",t),()=>{sU.eventDispatcher.off("pull-kosync",t)}},[e,x]),(0,sI.useEffect)(()=>{r&&s&&b?.location&&(p.current||x())},[r,s,b?.location,v,x]),(0,sI.useEffect)(()=>{if("synced"===c&&b){let{strategy:e,enabled:t}=n.kosync;"receive"!==e&&t&&v()}},[b,c,n.kosync,v]);let w=()=>{v(),v.flush(),f("synced"),d(null)},S=async()=>{let t=a(e),r=u?.remote,n=u?.book,i=u?.bookDoc;n&&i&&r&&r.progress&&t&&(g(n,i,r),f("synced"),d(null))};return{syncState:c,conflictDetails:u,errorMessage:h,pushProgress:v,pullProgress:x,resolveWithLocal:w,resolveWithRemote:S}};var sH=tu,sq=R,sV=eJ,sW=e.i(426320),sK=e8,sG=M;let sX=0,sY=null,sZ={key:"",code:"",ctrlKey:!1,shiftKey:!1,altKey:!1,metaKey:!1},sJ=e=>e&&"ctrlKey"in e?{key:sZ.key,code:sZ.code,ctrlKey:e.ctrlKey,shiftKey:e.shiftKey,altKey:e.altKey,metaKey:e.metaKey}:{...sZ},sQ=(e,t)=>{sZ={key:t.key,code:t.code,ctrlKey:t.ctrlKey,shiftKey:t.shiftKey,altKey:t.altKey,metaKey:t.metaKey},["Backspace"].includes(t.key)&&t.preventDefault(),window.postMessage({type:"iframe-keydown",bookKey:e,key:t.key,code:t.code,ctrlKey:t.ctrlKey,shiftKey:t.shiftKey,altKey:t.altKey,metaKey:t.metaKey},"*")},s0=(e,t)=>{sZ={key:"",code:"",ctrlKey:t.ctrlKey,shiftKey:t.shiftKey,altKey:t.altKey,metaKey:t.metaKey},window.postMessage({type:"iframe-keyup",bookKey:e,key:t.key,code:t.code,ctrlKey:t.ctrlKey,shiftKey:t.shiftKey,altKey:t.altKey,metaKey:t.metaKey},"*")},s1=(e,t)=>{sY=setTimeout(()=>{sY=null},sK.LONG_HOLD_THRESHOLD),window.postMessage({type:"iframe-mousedown",bookKey:e,button:t.button,screenX:t.screenX,screenY:t.screenY,clientX:t.clientX,clientY:t.clientY,offsetX:t.offsetX,offsetY:t.offsetY,...sJ(t)},"*")},s2=(e,t)=>{[3,4].includes(t.button)&&t.preventDefault(),window.postMessage({type:"iframe-mouseup",bookKey:e,button:t.button,screenX:t.screenX,screenY:t.screenY,clientX:t.clientX,clientY:t.clientY,offsetX:t.offsetX,offsetY:t.offsetY,...sJ(t)},"*")},s3=(e,t)=>{window.postMessage({type:"iframe-wheel",bookKey:e,deltaMode:t.deltaMode,deltaX:t.deltaX,deltaY:t.deltaY,deltaZ:t.deltaZ,screenX:t.screenX,screenY:t.screenY,clientX:t.clientX,clientY:t.clientY,offsetX:t.offsetX,offsetY:t.offsetY,...sJ(t)},"*")},s6=(e,t,r)=>{let n=Date.now();if(!t.current&&n-sX<sK.DOUBLE_CLICK_INTERVAL_THRESHOLD_MS){sX=n,window.postMessage({type:"iframe-double-click",bookKey:e,screenX:r.screenX,screenY:r.screenY,clientX:r.clientX,clientY:r.clientY,offsetX:r.offsetX,offsetY:r.offsetY,...sJ(r)},"*");return}sX=n;let i=()=>{let t=r.target;if(t?.closest("sup, a, audio, video")&&!t?.closest("a.duokan-footnote:not([href])"))return;let n=t?.closest(".js_readerFooterNote, .zhangyue-footnote, .duokan-footnote");n?sG.eventDispatcher.dispatch("footnote-popup",{bookKey:e,element:n,footnote:n.getAttribute("data-wr-footernote")||n.getAttribute("zy-footnote")||n.getAttribute("alt")||t?.getAttribute("alt")||""}):sY&&window.postMessage({type:"iframe-single-click",bookKey:e,screenX:r.screenX,screenY:r.screenY,clientX:r.clientX,clientY:r.clientY,offsetX:r.offsetX,offsetY:r.offsetY,...sJ(r)},"*")};t.current?i():setTimeout(()=>{Date.now()-sX>=sK.DOUBLE_CLICK_INTERVAL_THRESHOLD_MS&&i()},sK.DOUBLE_CLICK_INTERVAL_THRESHOLD_MS)},s4=(e,t,r)=>{let n=t.targetTouches[0],i=[];n&&i.push({clientX:n.clientX,clientY:n.clientY,screenX:n.screenX,screenY:n.screenY}),window.postMessage({type:r,bookKey:e,timeStamp:Date.now(),targetTouches:i,...sJ(t)},"*")},s8=(e,t)=>{s4(e,t,"iframe-touchstart")},s5=(e,t)=>{s4(e,t,"iframe-touchmove")},s9=(e,t)=>{s4(e,t,"iframe-touchend")};var s7=e.i(314643),le=e.i(266765),lt=A;let lr={name:"footnote",transform:async e=>{let t=e.content;return t.replace(/<aside\s+epub:type\s*=\s*["'](footnote|endnote|note|rearnote)["']([^>]*)>/gi,'<aside class="epubtype-footnote" epub:type="$1"$2>')}};var ln=af;let li={name:"language",transform:async e=>{let t=e.primaryLanguage,r=e.content,n=r.match(/<html\b([^>]*)>/i);if(n){let e=n[1]||"",i=/ lang="([^"]*)"/i,a=/ xml:lang="([^"]*)"/i,o=e.match(a),s=e.match(i),l=s?.[1]||o?.[1];if(!(0,ln.isValidLang)(l)||!(0,ln.isSameLang)(l,t)){let l=r.replace(/<[^>]+>/g," "),c=(0,ln.isValidLang)(t)&&"en"!==t?t:(0,ln.detectLanguage)(l),f=(0,ln.getLanguageInfo)(c||""),u=` lang="${c}"`,d=` xml:lang="${c}"`,h=f?.direction==="rtl"?' dir="rtl"':"";e=s?e.replace(i,u):e+u+h,e=o?e.replace(a,d):e+d+h,r=r.replace(n[0],`<html${e}>`)}}else{let e=(0,ln.isValidLang)(t)&&"en"!==t?t:(0,ln.detectLanguage)(r.replace(/<[^>]+>/g," ")),n=(0,ln.getLanguageInfo)(e||""),i=n?.direction==="rtl"?' dir="rtl"':"",a=` lang="${e}" xml:lang="${e}" ${i}`;r=r.replace(/<html>/i,`<html${a}>`)}return r}},la={"":"","":"","":"","":"","":"","":"","":"","":""},lo={"":"","":"","":"","":"","":"","":"","":"","":""},ls={"":"","":"","":"","":"","":"","":"","":"","":""},ll={name:"punctuation",transform:async e=>{if(!e.viewSettings.replaceQuotationMarks)return e.content;let t=e.content,r=e.viewSettings.convertChineseVariant,n=e.reversePunctuationTransform||!1;if(r&&"none"!==r)for(let[e,i]of Object.entries(ls)){let[a,o]=n!==r.includes("2s")?[i,e]:[e,i];t=t.replace(RegExp(a,"g"),o)}if(e.viewSettings.vertical){let r=["zh-Hant","zh-TW","zh_TW"],n=la;for(let[i,a]of((r.includes(e.primaryLanguage||"")||r.includes(e.userLocale))&&(n=lo),Object.entries(n)))t=e.reversePunctuationTransform?t.replace(RegExp(a,"g"),i):t.replace(RegExp(i,"g"),a)}return t}},lc={name:"whitespace",transform:async e=>e.viewSettings.overrideLayout?e.content.replace(/(&amp;)?&nbsp;/g,(e,t)=>t?e:" ").replace(/\u00A0/g," ").replace(/ {2,}/g," "):e.content},{entries:lf,setPrototypeOf:lu,isFrozen:ld,getPrototypeOf:lh,getOwnPropertyDescriptor:lp}=Object,{freeze:lb,seal:lm,create:lg}=Object,{apply:ly,construct:lv}="undefined"!=typeof Reflect&&Reflect;lb||(lb=function(e){return e}),lm||(lm=function(e){return e}),ly||(ly=function(e,t){for(var r=arguments.length,n=Array(r>2?r-2:0),i=2;i<r;i++)n[i-2]=arguments[i];return e.apply(t,n)}),lv||(lv=function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return new e(...r)});let lx=lL(Array.prototype.forEach),lw=lL(Array.prototype.lastIndexOf),lS=lL(Array.prototype.pop),lk=lL(Array.prototype.push),l_=lL(Array.prototype.splice),lE=lL(String.prototype.toLowerCase),lM=lL(String.prototype.toString),lN=lL(String.prototype.match),lA=lL(String.prototype.replace),lT=lL(String.prototype.indexOf),lR=lL(String.prototype.trim),lC=lL(Object.prototype.hasOwnProperty),lj=lL(RegExp.prototype.test),lI=lP(TypeError);function lL(e){return function(t){t instanceof RegExp&&(t.lastIndex=0);for(var r=arguments.length,n=Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];return ly(e,t,n)}}function lP(e){return function(){for(var t=arguments.length,r=Array(t),n=0;n<t;n++)r[n]=arguments[n];return lv(e,r)}}function lB(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:lE;lu&&lu(e,null);let n=t.length;for(;n--;){let i=t[n];if("string"==typeof i){let e=r(i);e!==i&&(ld(t)||(t[n]=e),i=e)}e[i]=!0}return e}function lO(e){for(let t=0;t<e.length;t++)lC(e,t)||(e[t]=null);return e}function lD(e){let t=lg(null);for(let[r,n]of lf(e))lC(e,r)&&(Array.isArray(n)?t[r]=lO(n):n&&"object"==typeof n&&n.constructor===Object?t[r]=lD(n):t[r]=n);return t}function lz(e,t){for(;null!==e;){let r=lp(e,t);if(r){if(r.get)return lL(r.get);if("function"==typeof r.value)return lL(r.value)}e=lh(e)}return function(){return null}}let lF=lb(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","search","section","select","shadow","slot","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),lU=lb(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","enterkeyhint","exportparts","filter","font","g","glyph","glyphref","hkern","image","inputmode","line","lineargradient","marker","mask","metadata","mpath","part","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),l$=lb(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),lH=lb(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),lq=lb(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),lV=lb(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),lW=lb(["#text"]),lK=lb(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","exportparts","face","for","headers","height","hidden","high","href","hreflang","id","inert","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","part","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","slot","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),lG=lb(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","mask-type","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),lX=lb(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),lY=lb(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),lZ=lm(/\{\{[\w\W]*|[\w\W]*\}\}/gm),lJ=lm(/<%[\w\W]*|[\w\W]*%>/gm),lQ=lm(/\$\{[\w\W]*/gm),l0=lm(/^data-[\-\w.\u00B7-\uFFFF]+$/),l1=lm(/^aria-[\-\w]+$/),l2=lm(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp|matrix):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),l3=lm(/^(?:\w+script|data):/i),l6=lm(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),l4=lm(/^html$/i);var l8=Object.freeze({__proto__:null,ARIA_ATTR:l1,ATTR_WHITESPACE:l6,CUSTOM_ELEMENT:lm(/^[a-z][.\w]*(-[.\w]+)+$/i),DATA_ATTR:l0,DOCTYPE_NAME:l4,ERB_EXPR:lJ,IS_ALLOWED_URI:l2,IS_SCRIPT_OR_DATA:l3,MUSTACHE_EXPR:lZ,TMPLIT_EXPR:lQ});let l5=1,l9=3,l7=7,ce=8,ct=9,cr=function(){return"undefined"==typeof window?null:window},cn=function(e,t){if("object"!=typeof e||"function"!=typeof e.createPolicy)return null;let r=null,n="data-tt-policy-suffix";t&&t.hasAttribute(n)&&(r=t.getAttribute(n));let i="dompurify"+(r?"#"+r:"");try{return e.createPolicy(i,{createHTML:e=>e,createScriptURL:e=>e})}catch(e){return console.warn("TrustedTypes policy "+i+" could not be created."),null}},ci=function(){return{afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}};function ca(){let e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:cr(),r=e=>ca(e);if(r.version="3.3.0",r.removed=[],!t||!t.document||t.document.nodeType!==ct||!t.Element)return r.isSupported=!1,r;let{document:n}=t,i=n,a=i.currentScript,{DocumentFragment:o,HTMLTemplateElement:s,Node:l,Element:c,NodeFilter:f,NamedNodeMap:u=t.NamedNodeMap||t.MozNamedAttrMap,HTMLFormElement:d,DOMParser:h,trustedTypes:p}=t,b=c.prototype,m=lz(b,"cloneNode"),g=lz(b,"remove"),y=lz(b,"nextSibling"),v=lz(b,"childNodes"),x=lz(b,"parentNode");if("function"==typeof s){let e=n.createElement("template");e.content&&e.content.ownerDocument&&(n=e.content.ownerDocument)}let w="",{implementation:S,createNodeIterator:k,createDocumentFragment:_,getElementsByTagName:E}=n,{importNode:M}=i,N=ci();r.isSupported="function"==typeof lf&&"function"==typeof x&&S&&void 0!==S.createHTMLDocument;let{MUSTACHE_EXPR:A,ERB_EXPR:T,TMPLIT_EXPR:R,DATA_ATTR:C,ARIA_ATTR:j,IS_SCRIPT_OR_DATA:I,ATTR_WHITESPACE:L,CUSTOM_ELEMENT:P}=l8,{IS_ALLOWED_URI:B}=l8,O=null,D=lB({},[...lF,...lU,...l$,...lq,...lW]),z=null,F=lB({},[...lK,...lG,...lX,...lY]),U=Object.seal(lg(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),$=null,H=null,q=Object.seal(lg(null,{tagCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeCheck:{writable:!0,configurable:!1,enumerable:!0,value:null}})),V=!0,W=!0,K=!1,G=!0,X=!1,Y=!0,Z=!1,J=!1,Q=!1,ee=!1,et=!1,er=!1,en=!0,ei=!1,ea="user-content-",eo=!0,es=!1,el={},ec=null,ef=lB({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]),eu=null,ed=lB({},["audio","video","img","source","image","track"]),eh=null,ep=lB({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),eb="http://www.w3.org/1998/Math/MathML",em="http://www.w3.org/2000/svg",eg="http://www.w3.org/1999/xhtml",ey=eg,ev=!1,ex=null,ew=lB({},[eb,em,eg],lM),eS=lB({},["mi","mo","mn","ms","mtext"]),ek=lB({},["annotation-xml"]),e_=lB({},["title","style","font","a","script"]),eE=null,eM=["application/xhtml+xml","text/html"],eN="text/html",eA=null,eT=null,eR=n.createElement("form"),eC=function(e){return e instanceof RegExp||e instanceof Function},ej=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!eT||eT!==t){if(t&&"object"==typeof t||(t={}),t=lD(t),eE=-1===eM.indexOf(t.PARSER_MEDIA_TYPE)?eN:t.PARSER_MEDIA_TYPE,eA="application/xhtml+xml"===eE?lM:lE,O=lC(t,"ALLOWED_TAGS")?lB({},t.ALLOWED_TAGS,eA):D,z=lC(t,"ALLOWED_ATTR")?lB({},t.ALLOWED_ATTR,eA):F,ex=lC(t,"ALLOWED_NAMESPACES")?lB({},t.ALLOWED_NAMESPACES,lM):ew,eh=lC(t,"ADD_URI_SAFE_ATTR")?lB(lD(ep),t.ADD_URI_SAFE_ATTR,eA):ep,eu=lC(t,"ADD_DATA_URI_TAGS")?lB(lD(ed),t.ADD_DATA_URI_TAGS,eA):ed,ec=lC(t,"FORBID_CONTENTS")?lB({},t.FORBID_CONTENTS,eA):ef,$=lC(t,"FORBID_TAGS")?lB({},t.FORBID_TAGS,eA):lD({}),H=lC(t,"FORBID_ATTR")?lB({},t.FORBID_ATTR,eA):lD({}),el=!!lC(t,"USE_PROFILES")&&t.USE_PROFILES,V=!1!==t.ALLOW_ARIA_ATTR,W=!1!==t.ALLOW_DATA_ATTR,K=t.ALLOW_UNKNOWN_PROTOCOLS||!1,G=!1!==t.ALLOW_SELF_CLOSE_IN_ATTR,X=t.SAFE_FOR_TEMPLATES||!1,Y=!1!==t.SAFE_FOR_XML,Z=t.WHOLE_DOCUMENT||!1,ee=t.RETURN_DOM||!1,et=t.RETURN_DOM_FRAGMENT||!1,er=t.RETURN_TRUSTED_TYPE||!1,Q=t.FORCE_BODY||!1,en=!1!==t.SANITIZE_DOM,ei=t.SANITIZE_NAMED_PROPS||!1,eo=!1!==t.KEEP_CONTENT,es=t.IN_PLACE||!1,B=t.ALLOWED_URI_REGEXP||l2,ey=t.NAMESPACE||eg,eS=t.MATHML_TEXT_INTEGRATION_POINTS||eS,ek=t.HTML_INTEGRATION_POINTS||ek,U=t.CUSTOM_ELEMENT_HANDLING||{},t.CUSTOM_ELEMENT_HANDLING&&eC(t.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(U.tagNameCheck=t.CUSTOM_ELEMENT_HANDLING.tagNameCheck),t.CUSTOM_ELEMENT_HANDLING&&eC(t.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(U.attributeNameCheck=t.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),t.CUSTOM_ELEMENT_HANDLING&&"boolean"==typeof t.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements&&(U.allowCustomizedBuiltInElements=t.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),X&&(W=!1),et&&(ee=!0),el&&(O=lB({},lW),z=[],!0===el.html&&(lB(O,lF),lB(z,lK)),!0===el.svg&&(lB(O,lU),lB(z,lG),lB(z,lY)),!0===el.svgFilters&&(lB(O,l$),lB(z,lG),lB(z,lY)),!0===el.mathMl&&(lB(O,lq),lB(z,lX),lB(z,lY))),t.ADD_TAGS&&("function"==typeof t.ADD_TAGS?q.tagCheck=t.ADD_TAGS:(O===D&&(O=lD(O)),lB(O,t.ADD_TAGS,eA))),t.ADD_ATTR&&("function"==typeof t.ADD_ATTR?q.attributeCheck=t.ADD_ATTR:(z===F&&(z=lD(z)),lB(z,t.ADD_ATTR,eA))),t.ADD_URI_SAFE_ATTR&&lB(eh,t.ADD_URI_SAFE_ATTR,eA),t.FORBID_CONTENTS&&(ec===ef&&(ec=lD(ec)),lB(ec,t.FORBID_CONTENTS,eA)),eo&&(O["#text"]=!0),Z&&lB(O,["html","head","body"]),O.table&&(lB(O,["tbody"]),delete $.tbody),t.TRUSTED_TYPES_POLICY){if("function"!=typeof t.TRUSTED_TYPES_POLICY.createHTML)throw lI('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if("function"!=typeof t.TRUSTED_TYPES_POLICY.createScriptURL)throw lI('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');w=(e=t.TRUSTED_TYPES_POLICY).createHTML("")}else void 0===e&&(e=cn(p,a)),null!==e&&"string"==typeof w&&(w=e.createHTML(""));lb&&lb(t),eT=t}},eI=lB({},[...lU,...l$,...lH]),eL=lB({},[...lq,...lV]),eP=function(e){let t=x(e);t&&t.tagName||(t={namespaceURI:ey,tagName:"template"});let r=lE(e.tagName),n=lE(t.tagName);return!!ex[e.namespaceURI]&&(e.namespaceURI===em?t.namespaceURI===eg?"svg"===r:t.namespaceURI===eb?"svg"===r&&("annotation-xml"===n||eS[n]):!!eI[r]:e.namespaceURI===eb?t.namespaceURI===eg?"math"===r:t.namespaceURI===em?"math"===r&&ek[n]:!!eL[r]:e.namespaceURI===eg?(t.namespaceURI!==em||!!ek[n])&&(t.namespaceURI!==eb||!!eS[n])&&!eL[r]&&(e_[r]||!eI[r]):"application/xhtml+xml"===eE&&!!ex[e.namespaceURI])},eB=function(e){lk(r.removed,{element:e});try{x(e).removeChild(e)}catch(t){g(e)}},eO=function(e,t){try{lk(r.removed,{attribute:t.getAttributeNode(e),from:t})}catch(e){lk(r.removed,{attribute:null,from:t})}if(t.removeAttribute(e),"is"===e)if(ee||et)try{eB(t)}catch(e){}else try{t.setAttribute(e,"")}catch(e){}},eD=function(t){let r=null,i=null;if(Q)t="<remove></remove>"+t;else{let e=lN(t,/^[\r\n\t ]+/);i=e&&e[0]}"application/xhtml+xml"===eE&&ey===eg&&(t='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+t+"</body></html>");let a=e?e.createHTML(t):t;if(ey===eg)try{r=new h().parseFromString(a,eE)}catch(e){}if(!r||!r.documentElement){r=S.createDocument(ey,"template",null);try{r.documentElement.innerHTML=ev?w:a}catch(e){}}let o=r.body||r.documentElement;return(t&&i&&o.insertBefore(n.createTextNode(i),o.childNodes[0]||null),ey===eg)?E.call(r,Z?"html":"body")[0]:Z?r.documentElement:o},ez=function(e){return k.call(e.ownerDocument||e,e,f.SHOW_ELEMENT|f.SHOW_COMMENT|f.SHOW_TEXT|f.SHOW_PROCESSING_INSTRUCTION|f.SHOW_CDATA_SECTION,null)},eF=function(e){return e instanceof d&&("string"!=typeof e.nodeName||"string"!=typeof e.textContent||"function"!=typeof e.removeChild||!(e.attributes instanceof u)||"function"!=typeof e.removeAttribute||"function"!=typeof e.setAttribute||"string"!=typeof e.namespaceURI||"function"!=typeof e.insertBefore||"function"!=typeof e.hasChildNodes)},eU=function(e){return"function"==typeof l&&e instanceof l};function e$(e,t,n){lx(e,e=>{e.call(r,t,n,eT)})}let eH=function(e){let t=null;if(e$(N.beforeSanitizeElements,e,null),eF(e))return eB(e),!0;let n=eA(e.nodeName);if(e$(N.uponSanitizeElement,e,{tagName:n,allowedTags:O}),Y&&e.hasChildNodes()&&!eU(e.firstElementChild)&&lj(/<[/\w!]/g,e.innerHTML)&&lj(/<[/\w!]/g,e.textContent)||e.nodeType===l7||Y&&e.nodeType===ce&&lj(/<[/\w]/g,e.data))return eB(e),!0;if(!(q.tagCheck instanceof Function&&q.tagCheck(n))&&(!O[n]||$[n])){if(!$[n]&&eV(n)&&(U.tagNameCheck instanceof RegExp&&lj(U.tagNameCheck,n)||U.tagNameCheck instanceof Function&&U.tagNameCheck(n)))return!1;if(eo&&!ec[n]){let t=x(e)||e.parentNode,r=v(e)||e.childNodes;if(r&&t){let n=r.length;for(let i=n-1;i>=0;--i){let n=m(r[i],!0);n.__removalCount=(e.__removalCount||0)+1,t.insertBefore(n,y(e))}}}return eB(e),!0}return e instanceof c&&!eP(e)||("noscript"===n||"noembed"===n||"noframes"===n)&&lj(/<\/no(script|embed|frames)/i,e.innerHTML)?(eB(e),!0):(X&&e.nodeType===l9&&(t=e.textContent,lx([A,T,R],e=>{t=lA(t,e," ")}),e.textContent!==t&&(lk(r.removed,{element:e.cloneNode()}),e.textContent=t)),e$(N.afterSanitizeElements,e,null),!1)},eq=function(e,t,r){if(en&&("id"===t||"name"===t)&&(r in n||r in eR))return!1;if(W&&!H[t]&&lj(C,t));else if(V&&lj(j,t));else if(q.attributeCheck instanceof Function&&q.attributeCheck(t,e));else if(!z[t]||H[t]){if(!(eV(e)&&(U.tagNameCheck instanceof RegExp&&lj(U.tagNameCheck,e)||U.tagNameCheck instanceof Function&&U.tagNameCheck(e))&&(U.attributeNameCheck instanceof RegExp&&lj(U.attributeNameCheck,t)||U.attributeNameCheck instanceof Function&&U.attributeNameCheck(t,e))||"is"===t&&U.allowCustomizedBuiltInElements&&(U.tagNameCheck instanceof RegExp&&lj(U.tagNameCheck,r)||U.tagNameCheck instanceof Function&&U.tagNameCheck(r))))return!1}else if(eh[t]);else if(lj(B,lA(r,L,"")));else if(("src"===t||"xlink:href"===t||"href"===t)&&"script"!==e&&0===lT(r,"data:")&&eu[e]);else if(K&&!lj(I,lA(r,L,"")));else if(r)return!1;return!0},eV=function(e){return"annotation-xml"!==e&&lN(e,P)},eW=function(t){e$(N.beforeSanitizeAttributes,t,null);let{attributes:n}=t;if(!n||eF(t))return;let i={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:z,forceKeepAttr:void 0},a=n.length;for(;a--;){let{name:o,namespaceURI:s,value:l}=n[a],c=eA(o),f=l,u="value"===o?f:lR(f);if(i.attrName=c,i.attrValue=u,i.keepAttr=!0,i.forceKeepAttr=void 0,e$(N.uponSanitizeAttribute,t,i),u=i.attrValue,ei&&("id"===c||"name"===c)&&(eO(o,t),u=ea+u),Y&&lj(/((--!?|])>)|<\/(style|title|textarea)/i,u)||"attributename"===c&&lN(u,"href")){eO(o,t);continue}if(i.forceKeepAttr)continue;if(!i.keepAttr||!G&&lj(/\/>/i,u)){eO(o,t);continue}X&&lx([A,T,R],e=>{u=lA(u,e," ")});let d=eA(t.nodeName);if(!eq(d,c,u)){eO(o,t);continue}if(e&&"object"==typeof p&&"function"==typeof p.getAttributeType)if(s);else switch(p.getAttributeType(d,c)){case"TrustedHTML":u=e.createHTML(u);break;case"TrustedScriptURL":u=e.createScriptURL(u)}if(u!==f)try{s?t.setAttributeNS(s,o,u):t.setAttribute(o,u),eF(t)?eB(t):lS(r.removed)}catch(e){eO(o,t)}}e$(N.afterSanitizeAttributes,t,null)},eK=function e(t){let r=null,n=ez(t);for(e$(N.beforeSanitizeShadowDOM,t,null);r=n.nextNode();)e$(N.uponSanitizeShadowNode,r,null),eH(r),eW(r),r.content instanceof o&&e(r.content);e$(N.afterSanitizeShadowDOM,t,null)};return r.sanitize=function(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=null,s=null,c=null,f=null;if((ev=!t)&&(t="<!-->"),"string"!=typeof t&&!eU(t))if("function"==typeof t.toString){if("string"!=typeof(t=t.toString()))throw lI("dirty is not a string, aborting")}else throw lI("toString is not a function");if(!r.isSupported)return t;if(J||ej(n),r.removed=[],"string"==typeof t&&(es=!1),es){if(t.nodeName){let e=eA(t.nodeName);if(!O[e]||$[e])throw lI("root node is forbidden and cannot be sanitized in-place")}}else if(t instanceof l)(s=(a=eD("<!---->")).ownerDocument.importNode(t,!0)).nodeType===l5&&"BODY"===s.nodeName||"HTML"===s.nodeName?a=s:a.appendChild(s);else{if(!ee&&!X&&!Z&&-1===t.indexOf("<"))return e&&er?e.createHTML(t):t;if(!(a=eD(t)))return ee?null:er?w:""}a&&Q&&eB(a.firstChild);let u=ez(es?t:a);for(;c=u.nextNode();)eH(c),eW(c),c.content instanceof o&&eK(c.content);if(es)return t;if(ee){if(et)for(f=_.call(a.ownerDocument);a.firstChild;)f.appendChild(a.firstChild);else f=a;return(z.shadowroot||z.shadowrootmode)&&(f=M.call(i,f,!0)),f}let d=Z?a.outerHTML:a.innerHTML;return Z&&O["!doctype"]&&a.ownerDocument&&a.ownerDocument.doctype&&a.ownerDocument.doctype.name&&lj(l4,a.ownerDocument.doctype.name)&&(d="<!DOCTYPE "+a.ownerDocument.doctype.name+">\n"+d),X&&lx([A,T,R],e=>{d=lA(d,e," ")}),e&&er?e.createHTML(d):d},r.setConfig=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};ej(e),J=!0},r.clearConfig=function(){eT=null,J=!1},r.isValidAttribute=function(e,t,r){return eT||ej({}),eq(eA(e),eA(t),r)},r.addHook=function(e,t){"function"==typeof t&&lk(N[e],t)},r.removeHook=function(e,t){if(void 0!==t){let r=lw(N[e],t);return -1===r?void 0:l_(N[e],r,1)[0]}return lS(N[e])},r.removeHooks=function(e){N[e]=[]},r.removeAllHooks=function(){N=ci()},r}var co=ca();let cs={name:"sanitizer",transform:async e=>{if(e.viewSettings.allowScript)return e.content;let t=e.content.replaceAll("&nbsp;","&#160;"),r=co.sanitize(t,{WHOLE_DOCUMENT:!0,FORBID_TAGS:["script"],ALLOWED_URI_REGEXP:/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp|blob|data):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i,ADD_TAGS:["link","meta"],ADD_ATTR:e=>["xmlns","http-equiv","content","charset","link","vlink","imt-state","data-wr-footernote","zy-footnote"].includes(e)||e.startsWith("xml:")||e.startsWith("xmlns:")||e.startsWith("epub:"),RETURN_DOM:!0}),n=new XMLSerializer().serializeToString(r);return(n=(n='<?xml version="1.0" encoding="utf-8"?>'+(n=n.replaceAll("&#160;","&nbsp;").replaceAll("","&nbsp;"))).replace(/(<head[^>]*>)/i,"\n$1")).replace(/(<\/body>)(<\/html>)/i,"$1\n$2")}};var cl=e.i(293702),cc=tu,cf=rJ,cu=o;let cd=e=>/[\p{L}\p{N}_]/u.test(e||""),ch=e=>/[^\x00-\x7F]/.test(e),cp="------------",cb=e=>RegExp(`[${cp}]`).test(e||""),cm=e=>RegExp(`^[${cp}]+$`).test(e);function cg(e,t,r=!0){let n=ch(e),i=n?"ug":"g";if(r||(i+="i"),t)return{source:e.includes("\\b")||n?e:`\\b${e}\\b`,flags:i};let a=e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");if(n)return{source:a,flags:i};let o=/^[^\w\s]/.test(e),s=/[^\w\s]$/.test(e);if(o||s){let t=e.match(/[\w]+/);if(!t)return{source:a,flags:i};let r=t[0],n=e.indexOf(r),o=n+r.length,s=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),l=a.substring(0,n),c=a.substring(o);return{source:`${l}\\b${s}\\b${c}`,flags:i}}return{source:`\\b${a}\\b`,flags:i}}function cy(e,t,r){if(!r.isRegex&&!(!1!==r.caseSensitive?t[0]===r.pattern:t[0].toLowerCase()===r.pattern.toLowerCase()))return!1;if(ch(r.pattern)&&!cm(r.pattern)){let r=e[t.index-1]??"",n=e[t.index+t[0].length]??"";if(!cb(r)&&!cb(n)&&(cd(r)||cd(n)))return!1}return!0}function cv(e,t){let r;try{r=new RegExp(t.normalizedPattern.source,t.normalizedPattern.flags)}catch{return}for(let n of e){let e;if(!n.textContent)continue;let i=n.textContent,a=[];for(;null!==(e=r.exec(i));)cy(i,e,t)&&a.push({index:e.index,length:e[0].length});if(0!==a.length){for(let e=a.length-1;e>=0;e--){let r=a[e];i=i.slice(0,r.index)+t.replacement+i.slice(r.index+r.length)}n.textContent=i}}}function cx(e,t){let r;try{r=new RegExp(t.normalizedPattern.source,t.normalizedPattern.flags)}catch{return}let n=cf.parse(t.cfi);if(n.parent){n.parent.shift();let i=cf.toRange(e,n);if(i){let e=i.startContainer;if(e===i.endContainer&&e.nodeType===Node.TEXT_NODE){let n=e,a=n.textContent||"",o=i.startOffset,s=i.endOffset,l=32,c=Math.max(0,o-32),f=Math.min(a.length,s+l),u=a.slice(c,f),d=a.slice(o,s),h=r.exec(u);if(h&&cy(d,h,t)){let e=c+h.index,r=e+h[0].length;if(r>=o-l&&e<=s+l){n.textContent=a.slice(0,e)+t.replacement+a.slice(r);return}}}}}}function cw(e){let t,r=document.createTreeWalker(e.body||e.documentElement,NodeFilter.SHOW_TEXT,{acceptNode:e=>{let t=e.parentElement;return t?.tagName==="SCRIPT"||t?.tagName==="STYLE"?NodeFilter.FILTER_REJECT:e.textContent?.trim()?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT}}),n=[];for(;t=r.nextNode();)n.push(t);return n}let cS={name:"proofread",transform:async(e,t)=>{let{docType:r="text/html",onlyForTTS:n=!1}=t||{},i=[...cu.useSettingsStore.getState().settings?.globalViewSettings?.proofreadRules??[],...e.viewSettings.proofreadRules??[]].sort((e,t)=>(e.order??0)-(t.order??0));if(!i.length)return e.content;let a=i.filter(e=>e.enabled&&e.pattern.trim()).filter(e=>n?e.onlyForTTS:!e.onlyForTTS).map(e=>({...e,normalizedPattern:cg(e.pattern,e.isRegex,!1!==e.caseSensitive)}));if(!a.length)return e.content;let o=new DOMParser().parseFromString(e.content,r),s=cw(o),l={selection:a.filter(e=>"selection"===e.scope),book:a.filter(e=>"book"===e.scope),library:a.filter(e=>"library"===e.scope)};for(let t of[...l.selection,...l.book,...l.library]){if("selection"===t.scope){let r=t.sectionHref?.split("#")[0];if(e.sectionHref?.split("#")[0]!==r)continue}"selection"===t.scope?cx(o,t):cv(s,t)}return new XMLSerializer().serializeToString(o)}},ck=[ll,lr,li,{name:"style",transform:async e=>{let t=e.content;for(let r of[...t.matchAll(/<style[^>]*>([\s\S]*?)<\/style>/gi)]){let[n,i]=r,a=await (0,cc.transformStylesheet)(i,e.width||window.innerWidth,e.height||window.innerHeight,e.viewSettings.vertical);t=t.replace(n,`<style>${a}</style>`)}return t}},lc,cs,{name:"simplecc",transform:async e=>{let t,r=e.viewSettings.convertChineseVariant;if(!r||"none"===r)return e.content;await (0,cl.initSimpleCC)();let n=new DOMParser().parseFromString(e.content,"text/html"),i=document.createTreeWalker(n.body||n.documentElement,NodeFilter.SHOW_TEXT,{acceptNode:e=>{let t=e.parentElement;return t&&("SCRIPT"===t.tagName||"STYLE"===t.tagName)?NodeFilter.FILTER_REJECT:e.textContent?.trim()?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT}}),a=[];for(;t=i.nextNode();)a.push(t);for(let e of a)e.textContent&&(e.textContent=(0,cl.runSimpleCC)(e.textContent,r));return new XMLSerializer().serializeToString(n)}},cS],c_=async e=>{let t=e.content;for(let r of e.transformers.map(e=>ck.find(t=>t.name===e)).filter(e=>!!e))try{t=await r.transform({...e,content:t})}catch(e){console.warn(`Error in transformer ${r.name}:`,e)}return t};var cE=j,cM=r,cN=n,cA=i,cT=ec,cR=o,cC=eG,cj=eJ,cI=M;let cL=e=>{let t=(0,cA.useTranslation)(),{envConfig:r,appService:n}=(0,cN.useEnv)(),i=(0,cM.useCallback)((0,cC.throttle)(()=>{setTimeout(async()=>{let i=cR.useSettingsStore.getState().settings,a=cT.useBookDataStore.getState().getBookData(e),o=a?.book,s=i.savedBookCoverForLockScreen,l=i.savedBookCoverForLockScreenPath;if(n&&o&&s&&s!==o?.hash){let e=await n.resolveFilePath((0,cj.getCoverFilename)(o),"Books");try{let t="last-book-cover.png",a=await n.resolveFilePath("","Images");l&&l!==a?await n.copyFile(e,`${l}/${t}`,"None"):await n.copyFile(e,t,"Images"),i.savedBookCoverForLockScreen=o.hash,cR.useSettingsStore.getState().setSettings(i),cR.useSettingsStore.getState().saveSettings(r,i)}catch(e){cI.eventDispatcher.dispatch("toast",{type:"error",message:t("Failed to auto-save book cover for lock screen: {{error}}",{error:e instanceof Error?e.message:String(e)})})}}},5e3)},5e3,{emitLast:!1}),[]);(0,cM.useEffect)(()=>{i()},[])};var cP=r,cB=n;let cO=(e,t,r)=>{let{appService:n}=(0,cB.useEnv)(),i=(0,cP.useRef)(Date.now()),a=(0,cP.useRef)(null),o=(0,cP.useRef)(null),s=(0,cP.useRef)(!1);(0,cP.useEffect)(()=>{if(!t||!e||!n?.isDesktopApp)return;let l=()=>{a.current&&(clearInterval(a.current),a.current=null),s.current=!1};if(!r){l(),e4(n),o.current=null;return}o.current!==e.hash&&(i.current=Date.now(),o.current=e.hash);let c=async()=>{if(!s.current){s.current=!0;try{await e6(e,i.current,n)}catch(e){console.error("Discord presence update failed:",e)}finally{s.current=!1}}};return c(),a.current=setInterval(()=>{c()},15e3),()=>{l(),e4(n)}},[e?.hash,t,r,n])};var cD=e.i(107228);let cz=e=>{e.querySelectorAll("a").forEach(e=>{e.setAttribute("tabindex","-1")})};var cF=af,cU=Y,c$=tC,cH=t,cq=Z,cV=i;let cW=({details:e,onResolveWithLocal:t,onResolveWithRemote:r,onClose:n})=>{let i=(0,cV.useTranslation)();return e?(0,cH.jsxs)(cq.default,{isOpen:!0,onClose:n,title:i("Sync Conflict"),children:[(0,cH.jsx)("p",{className:"py-4 text-center",children:i('Sync reading progress from "{{deviceName}}"?',{deviceName:e.remote.device||i("another device")})}),(0,cH.jsxs)("div",{className:"mt-4 space-y-4",children:[(0,cH.jsxs)("button",{className:"btn h-auto w-full flex-col items-start py-2",onClick:t,children:[(0,cH.jsx)("span",{children:i("Local Progress")}),(0,cH.jsx)("span",{className:"text-base-content/50 text-xs font-normal normal-case",children:e.local.preview})]}),(0,cH.jsxs)("button",{className:"btn btn-primary h-auto w-full flex-col items-start py-2",onClick:r,children:[(0,cH.jsx)("span",{children:i("Remote Progress")}),(0,cH.jsx)("span",{className:"text-xs font-normal normal-case",children:e.remote.preview})]})]})]}):null},cK=({bookKey:t,bookDoc:r,config:n,gridInsets:i,contentInsets:a})=>{let o=(0,sC.useTranslation)(),{appService:s,envConfig:l}=(0,oJ.useEnv)(),{themeCode:c,isDarkMode:f}=(0,oQ.useThemeStore)(),{settings:u}=(0,o2.useSettingsStore)(),{loadCustomFonts:d,getLoadedFonts:h}=(0,o3.useCustomFontStore)(),{getView:p,setView:b,setViewInited:m,setProgress:g}=(0,o0.useReaderStore)(),{getViewState:y,getViewSettings:v,setViewSettings:x}=(0,o0.useReaderStore)(),{getParallels:w}=tn(),{getBookData:S}=(0,o1.useBookDataStore)(),{applyBackgroundTexture:k}=(0,sT.useBackgroundTexture)(),{applyEinkMode:_}=(0,sj.useEinkMode)(),E=S(t),M=y(t),N=v(t),A=(0,oY.useRef)(null),T=(0,oY.useRef)(null),R=(0,oY.useRef)(!1),C=(0,oY.useRef)(!!N?.disableDoubleClick),[j,I]=(0,oY.useState)(""),[L,P]=(0,oY.useState)(!1),B=(0,oY.useRef)(!1);(0,sR.useAutoFocus)({ref:T}),cO(E?.book||null,!!M?.isPrimary,u.discordRichPresenceEnabled),(0,oY.useEffect)(()=>{let e=setTimeout(()=>I(""),2e3);return()=>clearTimeout(e)},[j]),(0,sW.useUICSS)(t),sw(t),sA(t),cL(t);let{syncState:O,conflictDetails:D,resolveWithLocal:z,resolveWithRemote:F}=s$(t);rz(t,A.current);let U=e=>{let r=e.detail;g(t,r.cfi,r.tocItem,r.section,r.location,r.time,r.range)},$=({width:e,height:r})=>n=>{let{detail:i}=n;i.data=Promise.resolve(i.data).then(n=>{let a=v(t),o=S(t);if(a&&"text/css"===i.type)return(0,sH.transformStylesheet)(n,e,r,a.vertical);let s="application/xhtml+xml"===i.type||"text/html"===i.type;return a&&o&&s?Promise.resolve(c_({bookKey:t,viewSettings:a,width:e,height:r,primaryLanguage:o.book?.primaryLanguage,userLocale:(0,cU.getLocale)(),content:n,sectionHref:i.name,transformers:["style","punctuation","footnote","whitespace","language","sanitizer","simplecc","proofread"]})):n}).catch(e=>(console.error(Error(`Failed to load ${i.name}`,{cause:e})),""))},H=e=>{P(!1),B.current=!0;let i=e.detail;if(console.log("doc index loaded:",i.index),i.doc){let e=A.current?.renderer.setStyles&&(0,oZ.getDirection)(i.doc),a=v(t),o=S(t),s=e?.vertical||a.writingMode.includes("vertical")||!1,l=e?.rtl||"rtl"===(0,le.getDirFromUILanguage)()||a.writingMode.includes("rl")||!1;(a.vertical!==s||a.rtl!==l)&&(a.vertical=s,a.rtl=l,x(t,{...a})),o?.isFixedLayout||(0,sq.mountAdditionalFonts)(i.doc,(0,cF.isCJKLang)(o.book?.primaryLanguage)),h().forEach(e=>{(0,sq.mountCustomFont)(i.doc,e)}),r.rendition?.layout==="pre-paginated"&&(0,sH.applyFixedlayoutStyles)(i.doc,a),(0,sH.applyImageStyle)(i.doc),(0,sH.applyTableStyle)(i.doc),(0,sH.applyThemeModeClass)(i.doc,f),(0,sH.applyScrollModeClass)(i.doc,a.scrolled||!1),(0,sH.keepTextAlignment)(i.doc),cz(i.doc),a.allowScript&&(0,lt.isTauriAppPlatform)()&&q(i.doc),a.codeHighlighting&&(0,cD.manageSyntaxHighlighting)(i.doc,a),setTimeout(()=>{(n.booknotes||[]).filter(e=>!e.deletedAt&&"annotation"===e.type&&e.style).forEach(e=>A.current?.addAnnotation(e))},100),i.doc.isEventListenersAdded||(i.doc.isEventListenersAdded=!0,i.doc.addEventListener("keydown",sQ.bind(null,t)),i.doc.addEventListener("keyup",s0.bind(null,t)),i.doc.addEventListener("mousedown",s1.bind(null,t)),i.doc.addEventListener("mouseup",s2.bind(null,t)),i.doc.addEventListener("click",s6.bind(null,t,C)),i.doc.addEventListener("wheel",s3.bind(null,t)),i.doc.addEventListener("touchstart",s8.bind(null,t)),i.doc.addEventListener("touchmove",s5.bind(null,t)),i.doc.addEventListener("touchend",s9.bind(null,t)))}},q=e=>{if(e.defaultView&&e.defaultView.frameElement){let t=e.defaultView.frameElement;e.querySelectorAll("script:not([src])").forEach((e,r)=>{let n=e.textContent||e.innerHTML;try{console.warn("Evaluating inline scripts in iframe"),t.contentWindow?.eval(n)}catch(e){console.error(`Error executing iframe script ${r+1}:`,e)}})}},V=e=>{let r=e.detail;if("scroll"!==r.reason&&"page"!==r.reason)return;let n=w(t);n&&n.size>0&&n.forEach(e=>{if(e!==t){let t=p(e)?.renderer;t&&t.goTo?.({index:r.index,anchor:r.fraction})}})},{handlePageFlip:W,handleContinuousScroll:K}=tA(t,A,T),G=o7(t,W,K),X=se(t,W,K);sr(A.current,{onLoad:H,onRelocate:U,onRendererRelocate:V}),(0,oY.useEffect)(()=>{R.current||(R.current=!0,setTimeout(()=>P(!0),200),(async()=>{console.log("Opening book",t),await e.A(476099);let i=ix(document.createElement("foliate-view"));i.id=`foliate-view-${t}`,T.current?.appendChild(i);let a=v(t),o=a.writingMode;if(o){let e=(0,sV.getBookDirFromWritingMode)(o),t=(0,sV.getBookDirFromLanguage)(r.metadata.language);"auto"!==e?r.dir=e:"auto"!==t&&(r.dir=t)}if(r.rendition?.layout==="pre-paginated"&&r.sections){r.rendition.spread=a.spreadMode;let e="rtl"===r.dir?"right":"left";r.sections[0].pageSpread=a.keepCoverSpread?"":e}await i.open(r),A.current=i,b(t,i);let{book:l}=i;l.transformTarget?.addEventListener("load",e=>{let{detail:t}=e;t.isScript&&(t.allow=a.allowScript??!1)});let c=s?.isMobile?screen.width:window.innerWidth,f=s?.isMobile?screen.height:window.innerHeight,u=c,d=f;l.transformTarget?.addEventListener("data",$({width:u,height:d})),i.renderer.setStyles?.((0,sH.getStyles)(a)),(0,sH.applyTranslationStyle)(a),C.current=a.disableDoubleClick;let h=a.animated,p=a.isEink,g=a.maxColumnCount,y=(0,s7.getMaxInlineSize)(a),x=a.maxBlockSize,w=a.screenOrientation;s?.isMobileApp&&await (0,cE.lockScreenOrientation)({orientation:w}),h?i.renderer.setAttribute("animated",""):i.renderer.removeAttribute("animated"),s?.isAndroidApp&&(p?i.renderer.setAttribute("eink",""):i.renderer.removeAttribute("eink"),_(p)),r?.rendition?.layout==="pre-paginated"?(i.renderer.setAttribute("zoom",a.zoomMode),i.renderer.setAttribute("spread",a.spreadMode),i.renderer.setAttribute("scale-factor",a.zoomLevel)):(i.renderer.setAttribute("max-column-count",g),i.renderer.setAttribute("max-inline-size",`${y}px`),i.renderer.setAttribute("max-block-size",`${x}px`)),Y();let S=n.location;S?await i.init({lastLocation:S}):await i.goToFraction(0),m(t,!0)})())},[]);let Y=()=>{let e=v(t),r=y(t),n=ok(e),o=e.vertical&&e.doubleBorder,s=o&&e.showHeader,l=o&&e.showFooter,c=e.showHeader&&!e.vertical,f=e.showFooter&&!e.vertical,u=c?Math.max(0,44-a.top):0,d=r?.ttsEnabled&&e.showTTSBar?52+.33*i.bottom:0,h=f?Math.max(0,Math.max(d,44)-a.bottom):Math.max(0,d),p=32*!!s,b=32*!!l,m=(c?a.top:n.top)+u,g=a.right+p,x=(f?a.bottom:n.bottom)+h,w=a.left+b,S=e.showMarginsOnScroll&&e.scrolled;A.current?.renderer.setAttribute("margin-top",`${S?0:m}px`),A.current?.renderer.setAttribute("margin-right",`${g}px`),A.current?.renderer.setAttribute("margin-bottom",`${S?0:x}px`),A.current?.renderer.setAttribute("margin-left",`${w}px`),A.current?.renderer.setAttribute("gap",`${e.gapPercent}%`),e.scrolled&&A.current?.renderer.setAttribute("flow","scrolled")};(0,oY.useEffect)(()=>{if(A.current&&A.current.renderer){let e=v(t);A.current.renderer.setStyles?.((0,sH.getStyles)(e)),A.current.renderer.getContents().forEach(({doc:t})=>{r.rendition?.layout==="pre-paginated"&&(0,sH.applyFixedlayoutStyles)(t,e),(0,sH.applyThemeModeClass)(t,f),(0,sH.applyScrollModeClass)(t,e.scrolled||!1)})}},[c,f,N?.scrolled,N?.overrideColor,N?.invertImgColorInDark]),(0,oY.useEffect)(()=>{let e=async()=>{await d(l),h().forEach(e=>{(0,sq.mountCustomFont)(document,e);let t=A.current?.renderer.getContents();t?.forEach(({doc:t})=>(0,sq.mountCustomFont)(t,e))})};u.customFonts&&e()},[u.customFonts,l]),(0,oY.useEffect)(()=>{N&&k(l,N)},[N?.backgroundTextureId,N?.backgroundOpacity,N?.backgroundSize,k]),(0,oY.useEffect)(()=>{A.current&&A.current.renderer&&(C.current=!!N?.disableDoubleClick)},[N?.disableDoubleClick]),(0,oY.useEffect)(()=>{A.current&&A.current.renderer&&N&&Y()},[a.top,a.right,a.bottom,a.left,N?.doubleBorder,N?.showHeader,N?.showFooter,N?.showTTSBar,M?.ttsEnabled]);let Z=N?.showMarginsOnScroll&&N?.scrolled;return(0,oX.jsxs)(oX.Fragment,{children:[(0,oX.jsx)("div",{ref:T,tabIndex:-1,role:"document","aria-label":o("Book Content"),className:"foliate-viewer h-[100%] w-[100%] focus:outline-none",style:{paddingTop:Z?a.top:0,paddingBottom:Z?a.bottom:0},...G,...X}),!B.current&&L&&(0,oX.jsx)(c$.default,{loading:!0}),"conflict"===O&&D&&(0,oX.jsx)(cW,{details:D,onResolveWithLocal:z,onResolveWithRemote:F,onClose:z})]})};var cG=t,cX=c,cY=n,cZ=b,cJ=m,cQ=i;let c0=({bookKey:e,section:t,showDoubleBorder:r,isScrolled:n,isVertical:i,isEink:a,horizontalGap:o,contentInsets:s,gridInsets:l})=>{let c=(0,cQ.useTranslation)(),{appService:f}=(0,cY.useEnv)(),{hoveredBookKey:u,setHoveredBookKey:d}=(0,cJ.useReaderStore)(),{systemUIVisible:h,statusBarHeight:p}=(0,cZ.useThemeStore)(),b=Math.max(l.top,f?.isAndroidApp&&h?p/2:0);return(0,cG.jsxs)(cG.Fragment,{children:[(0,cG.jsx)("div",{className:(0,cX.default)("absolute left-0 right-0 top-0 z-10",n&&!i&&"bg-base-100"),style:{height:`${b}px`}}),(0,cG.jsx)("div",{className:(0,cX.default)("sectioninfo absolute flex items-center overflow-hidden font-sans",a?"text-sm font-normal":"text-neutral-content text-xs font-light",i?"writing-vertical-rl max-h-[85%]":"top-0 h-[44px]",n&&!i&&"bg-base-100"),role:"none",onClick:()=>d(e),style:i?{top:`${(s.top-l.top)*1.5}px`,right:r?`calc(${s.right}px)`:`calc(${Math.max(0,s.right-32)}px)`,width:r?"32px":`${s.right}px`,height:`calc(100% - ${s.top+s.bottom}px)`}:{top:`${b}px`,paddingInline:`calc(${o/2}% + ${s.left/2}px)`,width:"100%"},children:(0,cG.jsx)("span",{"aria-label":t?c("Section Title")+`: ${t}`:"",className:(0,cX.default)("text-center",i?"":"line-clamp-1",!i&&u==e&&"hidden"),children:t||""})})]})};var c1=t,c2=c,c3=r,c6=iz,c4=n,c8=b,c5=m,c9=i,c7=o,fe=e.i(20414),ft=t1,fr=t2,fn=e8;let fi=(e,t)=>{if(!t)return t;let r=e.globalReadSettings.customHighlightColors;return r?.[t]??fn.HIGHLIGHT_COLOR_HEX[t]};var fa=e.i(718221),fo=ru,fs=tY;function fl({tipColor:e="#FFD700",tipStyle:t={},...r}){return(0,fs.GenIcon)({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"none"},child:[{tag:"path",attr:{d:"M253.66,106.34a8,8,0,0,0-11.32,0L192,156.69,107.31,72l50.35-50.34a8,8,0,1,0-11.32-11.32L96,60.69A16,16,0,0,0,93.18,79.5L72,100.69a16,16,0,0,0,0,22.62L76.69,128,136,187.31l4.69,4.69a16,16,0,0,0,22.62,0l21.18-21.18A16,16,0,0,0,203.31,168l50.35-50.34A8,8,0,0,0,253.66,106.34ZM152,180.69,83.31,112,104,91.31,172.69,160Z",fill:"currentColor"},child:[]},{tag:"path",attr:{d:"M18.34,186.34c-4.209212,4.20621-2.516471,11.37196,3.13,13.25l72,24c0.815308,0.27382,1.669943,0.41232,2.53,0.41c2.12237,0.002,4.15842-0.84009,5.66-2.34L136,187.31c13.62143,13.61626-70.243446-70.24754-64-64l4.69,4.69z",fill:e,style:t},child:[]}]})(r)}var fc=t3,ff=e.i(675788),fu=t,fd=c,fh=i,fp=fa,fb=M,fm=rh,fg=rp;let fy=({selectedAction:e,onActionSelect:t,setIsDropdownOpen:r})=>{let n=(0,fh.useTranslation)(),i=i=>{t(i),e===i?fb.eventDispatcher.dispatch("toast",{type:"info",timeout:2e3,message:n("Quick action disabled")}):fb.eventDispatcher.dispatch("toast",{type:"info",timeout:2e3,message:n(fp.annotationToolQuickActions.find(e=>e.type===i)?.tooltip||"")}),r?.(!1)};return(0,fu.jsx)(fg.default,{className:(0,fd.default)("annotation-quick-action-menu dropdown-content z-20 mt-1 border","bgcolor-base-200 shadow-2xl"),style:{maxWidth:`${window.innerWidth-40}px`},onCancel:()=>r?.(!1),children:fp.annotationToolQuickActions.map(t=>(0,fu.jsx)(fm.default,{label:n(t.label),tooltip:n(t.tooltip),buttonClass:e===t.type?"bg-base-300/85":"",Icon:t.Icon,onClick:()=>i(t.type)},t.type))})};var fv=t,fx=e.i(806463),fw=m,fS=i,fk=t,f_=c,fE=n;let fM=({icon:e,onClick:t,disabled:r=!1,label:n,className:i})=>{let{appService:a}=(0,fE.useEnv)();return(0,fk.jsx)("button",{className:(0,f_.default)("btn btn-ghost h-8 min-h-8 w-8 p-0",a?.isMobileApp&&"hover:bg-transparent",r&&"cursor-default !bg-transparent opacity-50",i),title:n,"aria-label":n,onClick:r?void 0:t,children:e})},fN=({bookKey:e})=>{let t=(0,fS.useTranslation)(),{sideBarBookKey:r,isSideBarVisible:n,setSideBarBookKey:i,toggleSideBar:a}=x(),{setHoveredBookKey:o}=(0,fw.useReaderStore)(),s=()=>{r===e?a():(i(e),n||a()),o("")};return(0,fv.jsx)(fM,{icon:r===e&&n?(0,fv.jsx)(fx.TbLayoutSidebarFilled,{className:"text-base-content"}):(0,fv.jsx)(fx.TbLayoutSidebar,{className:"text-base-content"}),onClick:s,label:t("Toggle Sidebar")})};var fA=t,fT=r,fR=tQ,fC=o,fj=ec,fI=m,fL=i,fP=n,fB=Y,fO=eJ,fD=M;let fz=({bookKey:e})=>{let t=(0,fL.useTranslation)(),{envConfig:r}=(0,fP.useEnv)(),{settings:n}=(0,fC.useSettingsStore)(),{getConfig:i,saveConfig:a,getBookData:o,updateBooknotes:s}=(0,fj.useBookDataStore)(),{getProgress:l,getViewState:c,setBookmarkRibbonVisibility:f}=(0,fI.useReaderStore)(),[u,d]=(0,fT.useState)(!1),h=i(e),p=l(e),b=()=>{let t=o(e),f=i(e),u=l(e);if(!t||!f||!u)return;let{booknotes:h=[]}=f,{location:p,range:b}=u;if(p)if(c(e)?.ribbonVisible){d(!1),h.forEach(e=>{"bookmark"===e.type&&ik(e.cfi,p)&&(e.deletedAt=Date.now())});let t=s(e,h);t&&a(r,e,t,n)}else{d(!0);let i=b?.startContainer.textContent?.slice(0,128)||"",o=128===i.length?i+"...":i,l={id:(0,fB.uniqueId)(),type:"bookmark",cfi:p,text:o||`${(0,fO.getCurrentPage)(t.book,u)}`,note:"",createdAt:Date.now(),updatedAt:Date.now()},c=h.find(e=>"bookmark"===e.type&&e.cfi===p);c?(c.deletedAt=null,c.updatedAt=Date.now(),c.text=l.text):h.push(l);let f=s(e,h);f&&a(r,e,f,n)}};return(0,fT.useEffect)(()=>{let t=t=>{let{bookKey:r}=t.detail;r===e&&b()};return fD.eventDispatcher.on("toggle-bookmark",t),()=>{fD.eventDispatcher.off("toggle-bookmark",t)}},[e]),(0,fT.useEffect)(()=>{let{booknotes:t=[]}=h||{},{location:r}=p||{};if(!r)return;let n=t.filter(e=>"bookmark"===e.type&&!e.deletedAt).some(e=>ik(e.cfi,r));d(n),f(e,n)},[h,p]),(0,fA.jsx)(fM,{icon:u?(0,fA.jsx)(fR.MdOutlineBookmark,{className:"text-base-content"}):(0,fA.jsx)(fR.MdOutlineBookmarkAdd,{className:"text-base-content"}),onClick:b,label:t(u?"Remove Bookmark":"Add Bookmark")})};var fF=t,fU=a1,f$=n,fH=m,fq=i,fV=t2;let fW=({bookKey:e})=>{let t=(0,fq.useTranslation)(),{appService:r}=(0,f$.useEnv)(),{setHoveredBookKey:n}=(0,fH.useReaderStore)(),{sideBarBookKey:i,setSideBarBookKey:a}=x(),{isNotebookVisible:o,toggleNotebook:s}=w(),l=(0,fV.useResponsiveSize)(16),c=()=>{r?.isMobile&&n(""),i===e?s():(a(e),o||s())};return(0,fF.jsx)(fM,{icon:(0,fF.jsx)(fU.LuNotebookPen,{size:l,className:"text-base-content"}),onClick:c,label:t("Notebook")})};var fK=t,fG=ei,fX=m,fY=i,fZ=o;let fJ=({bookKey:e})=>{let t=(0,fY.useTranslation)(),{setHoveredBookKey:r}=(0,fX.useReaderStore)(),{isSettingsDialogOpen:n,setSettingsDialogOpen:i}=(0,fZ.useSettingsStore)(),{setSettingsDialogBookKey:a}=(0,fZ.useSettingsStore)(),o=()=>{r(""),a(e),i(!n)};return(0,fK.jsx)(fM,{icon:(0,fK.jsx)(fG.RiFontSize,{className:"text-base-content"}),onClick:o,label:t("Font & Layout")})};var fQ=t,f0=r,f1=ei,f2=n,f3=m,f6=i,f4=ec,f8=ru,f5=e.i(812414);let f9=({bookKey:e})=>{let t=(0,f6.useTranslation)(),{envConfig:r,appService:n}=(0,f2.useEnv)(),{getBookData:i}=(0,f4.useBookDataStore)(),{getViewSettings:a,setViewSettings:o,setHoveredBookKey:s}=(0,f3.useReaderStore)(),l=i(e),c=a(e),[f,u]=(0,f0.useState)(c.translationEnabled),[d,h]=(0,f0.useState)((0,f5.isTranslationAvailable)(l?.book,c.translateTargetLang));return(0,f0.useEffect)(()=>{f!==c.translationEnabled&&(n?.isMobile&&s(""),(0,f8.saveViewSettings)(r,e,"translationEnabled",f,!0,!1),c.translationEnabled=f,o(e,{...c}))},[f]),(0,f0.useEffect)(()=>{u(c.translationEnabled),h((0,f5.isTranslationAvailable)(l?.book,c.translateTargetLang))},[l,c.translationEnabled,c.translateTargetLang]),(0,fQ.jsx)(fM,{icon:(0,fQ.jsx)(f1.RiTranslateAi,{className:f?"text-blue-500":"text-base-content"}),"aria-label":t("Toggle Translation"),disabled:!d&&!f,onClick:()=>u(!f),label:t(d?f?"Disable Translation":"Enable Translation":"Translation Disabled")})};var f7=t,ue=c,ut=r,ur=u,un=e.i(326066),ui=fx,ua=tQ,uo=iD,us=e8,ul=n,uc=rt,uf=b,uu=m,ud=ec,uh=o,up=i,ub=tu,um=eY,ug=M,uy=s7,uv=ru,ux=eV,uw=rh,uS=rp;let uk=({bookKey:e,setIsDropdownOpen:t})=>{let r=(0,up.useTranslation)(),n=(0,ur.useRouter)(),{user:i}=(0,uc.useAuth)(),{envConfig:a,appService:o}=(0,ul.useEnv)(),{getConfig:s,getBookData:l}=(0,ud.useBookDataStore)(),{setSettingsDialogOpen:c,setSettingsDialogBookKey:f}=(0,uh.useSettingsStore)(),{getView:u,getViewSettings:d,getViewState:h,setViewSettings:p}=(0,uu.useReaderStore)(),b=s(e),m=l(e),g=d(e),y=h(e),{themeMode:v,isDarkMode:x,setThemeMode:w}=(0,uf.useThemeStore)(),[S,k]=(0,ut.useState)(g.scrolled),[_,E]=(0,ut.useState)(g.zoomLevel),[M,N]=(0,ut.useState)(g.zoomMode),[A,T]=(0,ut.useState)(g.spreadMode),[R,C]=(0,ut.useState)(g.keepCoverSpread),[j,I]=(0,ut.useState)(g.invertImgColorInDark),L=()=>E(e=>Math.min(e+us.ZOOM_STEP,us.MAX_ZOOM_LEVEL)),P=()=>E(e=>Math.max(e-us.ZOOM_STEP,us.MIN_ZOOM_LEVEL)),B=()=>E(100),O=()=>k(!S),D=()=>{t?.(!1),f(e),c(!0)},z=()=>{w("auto"===v?"light":"light"===v?"dark":"auto")},F=()=>{(0,ux.tauriHandleToggleFullScreen)(),t?.(!1)},U=()=>{i?ug.eventDispatcher.dispatch("sync-book-progress",{bookKey:e}):((0,um.navigateToLogin)(n),t?.(!1))};(0,ut.useEffect)(()=>{S!==g.scrolled&&(g.scrolled=S,u(e)?.renderer.setAttribute("flow",S?"scrolled":"paginated"),u(e)?.renderer.setAttribute("max-inline-size",`${(0,uy.getMaxInlineSize)(g)}px`),u(e)?.renderer.setStyles?.((0,ub.getStyles)(g)),p(e,g))},[S]),(0,ut.useEffect)(()=>{(0,uv.saveViewSettings)(a,e,"zoomLevel",_,!0,!0),m.bookDoc?.rendition?.layout==="pre-paginated"&&u(e)?.renderer.setAttribute("scale-factor",_)},[_]),(0,ut.useEffect)(()=>{j!==g.invertImgColorInDark&&(0,uv.saveViewSettings)(a,e,"invertImgColorInDark",j,!0,!0)},[j]),(0,ut.useEffect)(()=>{M!==g.zoomMode&&(g.zoomMode=M,u(e)?.renderer.setAttribute("zoom",M),p(e,g),(0,uv.saveViewSettings)(a,e,"zoomMode",M,!0,!1))},[M]),(0,ut.useEffect)(()=>{A!==g.spreadMode&&(g.spreadMode=A,u(e)?.renderer.setAttribute("spread",A),p(e,g),(0,uv.saveViewSettings)(a,e,"spreadMode",A,!0,!1))},[A]),(0,ut.useEffect)(()=>{if(R===g.keepCoverSpread||!m?.bookDoc?.sections?.length)return;g.keepCoverSpread=R;let t="rtl"===m.bookDoc.dir?"right":"left";m.bookDoc.sections[0].pageSpread=R?"":t,u(e)?.renderer.setAttribute("spread",A),p(e,g),(0,uv.saveViewSettings)(a,e,"keepCoverSpread",R,!0,!1)},[R]);let $=Math.max(b?.lastSyncedAtConfig||0,b?.lastSyncedAtNotes||0);return(0,f7.jsxs)(uS.default,{className:(0,ue.default)("view-menu dropdown-content dropdown-right no-triangle z-20 mt-1 border","bgcolor-base-200 shadow-2xl"),style:{maxWidth:`${window.innerWidth-40}px`,marginRight:window.innerWidth<640?"-36px":"0px"},onCancel:()=>t?.(!1),children:[m.bookDoc?.rendition?.layout==="pre-paginated"&&(0,f7.jsxs)(f7.Fragment,{children:[(0,f7.jsxs)("div",{title:r("Zoom Level"),className:(0,ue.default)("flex items-center justify-between rounded-md"),children:[(0,f7.jsx)("button",{title:r("Zoom Out"),onClick:P,className:(0,ue.default)("hover:bg-base-300 text-base-content rounded-full p-2",_<=us.MIN_ZOOM_LEVEL&&"btn-disabled text-gray-400"),children:(0,f7.jsx)(ua.MdZoomOut,{})}),(0,f7.jsxs)("button",{title:r("Reset Zoom"),className:(0,ue.default)("hover:bg-base-300 text-base-content h-8 min-h-8 w-[50%] rounded-md p-1 text-center"),onClick:B,children:[_,"%"]}),(0,f7.jsx)("button",{title:r("Zoom In"),onClick:L,className:(0,ue.default)("hover:bg-base-300 text-base-content rounded-full p-2",_>=us.MAX_ZOOM_LEVEL&&"btn-disabled text-gray-400"),children:(0,f7.jsx)(ua.MdZoomIn,{})})]}),(0,f7.jsxs)(f7.Fragment,{children:[(0,f7.jsxs)("div",{title:r("Zoom Mode"),className:(0,ue.default)("my-2 flex items-center justify-between rounded-md"),children:[(0,f7.jsx)("button",{title:r("Single Page"),onClick:T.bind(null,"none"),className:(0,ue.default)("hover:bg-base-300 text-base-content rounded-full p-2","none"===A&&"bg-base-300/75"),children:(0,f7.jsx)(ui.TbColumns1,{})}),(0,f7.jsx)("button",{title:r("Auto Spread"),onClick:T.bind(null,"auto"),className:(0,ue.default)("hover:bg-base-300 text-base-content rounded-full p-2","auto"===A&&"bg-base-300/75"),children:(0,f7.jsx)(ui.TbColumns2,{})}),(0,f7.jsx)("div",{className:"bg-base-300 mx-2 h-6 w-[1px]"}),(0,f7.jsx)("button",{title:r("Fit Page"),onClick:N.bind(null,"fit-page"),className:(0,ue.default)("hover:bg-base-300 text-base-content rounded-full p-2","fit-page"===M&&"bg-base-300/75"),children:(0,f7.jsx)(uo.IoMdExpand,{})}),(0,f7.jsx)("button",{title:r("Fit Width"),onClick:N.bind(null,"fit-width"),className:(0,ue.default)("hover:bg-base-300 text-base-content rounded-full p-2","fit-width"===M&&"bg-base-300/75"),children:(0,f7.jsx)(ui.TbArrowAutofitWidth,{})})]}),(0,f7.jsx)(uw.default,{label:r("Separate Cover Page"),Icon:R?ua.MdCheck:void 0,onClick:()=>C(!R),disabled:"none"===A})]}),(0,f7.jsx)("hr",{"aria-hidden":"true",className:"border-base-300 my-1"})]}),(0,f7.jsx)(uw.default,{label:r("Font & Layout"),shortcut:"Shift+F",onClick:D}),(0,f7.jsx)(uw.default,{label:r("Scrolled Mode"),shortcut:"Shift+J",Icon:S?ua.MdCheck:void 0,onClick:O,disabled:m.isFixedLayout}),(0,f7.jsx)("hr",{"aria-hidden":"true",className:"border-base-300 my-1"}),(0,f7.jsx)(uw.default,{label:i?$?r("Synced at {{time}}",{time:new Date($).toLocaleString()}):r("Never synced"):r("Sign in to Sync"),Icon:i?ua.MdSync:ua.MdSyncProblem,iconClassName:i&&y?.syncing?"animate-reverse-spin":"",onClick:U}),(0,f7.jsx)("hr",{"aria-hidden":"true",className:"border-base-300 my-1"}),o?.hasWindow&&(0,f7.jsx)(uw.default,{label:r("Fullscreen"),onClick:F}),(0,f7.jsx)(uw.default,{label:r("dark"===v?"Dark Mode":"light"===v?"Light Mode":"Auto Mode"),Icon:"dark"===v?un.BiMoon:"light"===v?un.BiSun:ui.TbSunMoon,onClick:z}),(0,f7.jsx)(uw.default,{label:r("Invert Image In Dark Mode"),disabled:!x,Icon:j?ua.MdCheck:void 0,onClick:()=>I(!j)})]})},u_=({bookKey:e,bookTitle:t,isTopLeft:r,isHoveredAnim:n,gridInsets:i,onCloseBook:a})=>{let o=(0,c9.useTranslation)(),{envConfig:s,appService:l}=(0,c4.useEnv)(),{settings:c}=(0,c7.useSettingsStore)(),{isTrafficLightVisible:f}=(0,ft.useTrafficLight)(),{trafficLightInFullscreen:u,setTrafficLightVisibility:d}=(0,fe.useTrafficLightStore)(),{bookKeys:h,hoveredBookKey:p}=(0,c5.useReaderStore)(),{isDarkMode:b,systemUIVisible:m,statusBarHeight:g}=(0,c8.useThemeStore)(),{isSideBarVisible:y}=x(),{getView:v,getViewSettings:w,setHoveredBookKey:S}=(0,c5.useReaderStore)(),k=w(e),[_,E]=(0,c3.useState)(!1),M=v(e),N=(0,fr.useResponsiveSize)(16),A=(0,c3.useRef)(null),T=l?.hasWindowBar&&!f,R=(M?.renderer.getContents()??[]).some(({doc:e})=>e?.body?.style.cursor==="pointer"),C=k?.enableAnnotationQuickActions,j=fa.annotationToolQuickActions.find(e=>e.type===k?.annotationQuickAction)||fa.annotationToolQuickActions[0],I=k?.annotationQuickAction,L=j.Icon,P=c.globalReadSettings.highlightStyle,B=c.globalReadSettings.highlightStyles[P],O=fi(c,B),D=e=>{E(e),e||S("")},z=t=>{k?.annotationQuickAction===t&&(t=null),(0,fo.saveViewSettings)(s,e,"annotationQuickAction",t,!1,!0)};(0,c3.useEffect)(()=>{l?.hasTrafficLight&&!y&&(p===e&&r?d(!0,{x:10,y:20}):p||d(!1))},[l,y,p]);let F=(0,c3.useCallback)((e,t)=>{if(!A.current)return!0;let r=A.current.getBoundingClientRect();return e<=r.left||e>=r.right||t<=r.top||t>=r.bottom},[]),U=p===e||_,$=l?.hasTrafficLight&&!u&&!y&&r;return(0,c1.jsxs)("div",{className:(0,c2.default)("bg-base-100 absolute top-0 w-full"),style:{paddingTop:l?.hasSafeAreaInset?`${i.top}px`:"0px"},children:[(0,c1.jsx)("div",{role:"none",className:(0,c2.default)("absolute top-0 z-10 h-11 w-full",R&&"pointer-events-none"),onClick:()=>S(e),onMouseEnter:()=>!l?.isMobile&&S(e),onTouchStart:()=>!l?.isMobile&&S(e)}),(0,c1.jsx)("div",{className:(0,c2.default)("bg-base-100 absolute left-0 right-0 top-0 z-10",l?.hasRoundedWindow&&"rounded-window-top-right",U?"visible":"hidden"),style:{height:m?`${Math.max(i.top,g)}px`:"0px"}}),(0,c1.jsxs)("div",{ref:A,role:"group","aria-label":o("Header Bar"),className:(0,c2.default)("header-bar bg-base-100 absolute top-0 z-10 flex h-11 w-full items-center pr-4","shadow-xs transition-[opacity,margin-top] duration-300",$?"pl-20":"pl-4",l?.hasRoundedWindow&&"rounded-window-top-right",!y&&l?.hasRoundedWindow&&"rounded-window-top-left",n&&"hover-bar-anim",U?"pointer-events-auto visible":"pointer-events-none opacity-0",_&&"header-bar-pinned"),style:{marginTop:m?`${Math.max(i.top,g)}px`:`${i.top}px`},onFocus:()=>!l?.isMobile&&S(e),onMouseLeave:e=>{!l?.isMobile&&F(e.clientX,e.clientY)&&S("")},children:[(0,c1.jsxs)("div",{className:"bg-base-100 sidebar-bookmark-toggler z-20 flex h-full items-center gap-x-4 pe-2",children:[(0,c1.jsx)("div",{className:"hidden sm:flex",children:(0,c1.jsx)(fN,{bookKey:e})}),(0,c1.jsx)(fz,{bookKey:e}),(0,c1.jsx)(f9,{bookKey:e}),C&&(0,c1.jsx)(fc.default,{label:o(I?"Disable Quick Action":"Enable Quick Action on Selection"),className:"exclude-title-bar-mousedown dropdown-bottom",buttonClassName:(0,c2.default)("btn btn-ghost h-8 min-h-8 w-8 p-0",k?.annotationQuickAction&&"bg-base-300/50"),toggleButton:"highlight"===I||null===I?(0,c1.jsx)(fl,{size:N,tipColor:null===I?"#8F8F8F":O,tipStyle:{opacity:null===I?.5:.8,mixBlendMode:b?"screen":"multiply"}}):(0,c1.jsx)(L,{size:N}),onToggle:D,children:(0,c1.jsx)(fy,{selectedAction:k.annotationQuickAction,onActionSelect:z})})]}),(0,c1.jsx)("div",{role:"contentinfo","aria-label":o("Title")+" - "+t,className:(0,c2.default)("header-title z-15 bg-base-100 pointer-events-none hidden flex-1 items-center justify-center sm:flex",!T&&"absolute inset-0"),children:(0,c1.jsx)("div",{"aria-hidden":"true",className:(0,c2.default)("line-clamp-1 text-center text-xs font-semibold",!T&&"max-w-[50%]"),children:t})}),(0,c1.jsxs)("div",{className:"bg-base-100 z-20 ml-auto flex h-full items-center space-x-4 ps-2",children:[(0,c1.jsx)(fJ,{bookKey:e}),(0,c1.jsx)(fW,{bookKey:e}),(0,c1.jsx)(fc.default,{label:o("View Options"),className:"exclude-title-bar-mousedown dropdown-bottom dropdown-end",buttonClassName:"btn btn-ghost h-8 min-h-8 w-8 p-0",toggleButton:(0,c1.jsx)(c6.PiDotsThreeVerticalBold,{size:N}),onToggle:D,children:(0,c1.jsx)(uk,{bookKey:e})}),(0,c1.jsx)(ff.default,{className:"window-buttons flex h-full items-center",headerRef:A,showMinimize:1==h.length&&T,showMaximize:1==h.length&&T,onClose:()=>{S(null),a(e)}})]})]})]})};var uE=t,uM=c,uN=r,uA=n,uT=m,uR=ec,uC=i,uj=k,uI=M,uL=X,uP=t,uB=t2,uO=t,uD=c,uz=r,uF=ei;let uU=(e,t,r)=>e?r:t,u$=(e,t,r)=>e?r:t,uH=(e,t,r)=>e?r:t;var uq=m,uV=i,uW=t,uK=r;let uG=({label:e,min:t=0,max:r=100,step:n=1,initialValue:i=50,heightPx:a=40,minLabel:o="",maxLabel:s="",minIcon:l,maxIcon:c,bubbleElement:f,bubbleLabel:u="",className:d="",minClassName:h="",maxClassName:p="",bubbleClassName:b="",onChange:m,valueToPosition:g,positionToValue:y})=>{let[v,x]=(0,uK.useState)(i),[w,S]=(0,uK.useState)(!1),k=(0,uK.useRef)(null),_=(e,t,r)=>(e-t)/(r-t)*100,E=(e,t,r)=>t+e/100*(r-t),M=g||_,N=y||E,A=e=>{let i=Math.round(N(parseInt(e.target.value,10),t,r)/n)*n;x(i),m&&m(i)};(0,uK.useEffect)(()=>{let e=k.current;for(;e;){if("rtl"===e.getAttribute("dir")){S(!0);break}e=e.parentElement}},[]),(0,uK.useEffect)(()=>{x(i)},[i]);let T=M(v,t,r),R=T/100*95;return(0,uW.jsx)("div",{ref:k,"aria-label":e,className:`slider bg-base-200 mx-auto w-full rounded-xl ${d}`,dir:w?"rtl":void 0,children:(0,uW.jsxs)("div",{className:"relative",style:{height:`${a}px`},children:[(0,uW.jsx)("div",{className:"bg-base-300/40 absolute h-full w-full rounded-full"}),(0,uW.jsx)("div",{className:"bg-base-300 absolute h-full rounded-full",style:{width:R>0?`max(calc(${R}% + ${a/2}px), ${a}px)`:"0px",[w?"right":"left"]:0}}),(0,uW.jsxs)("div",{className:"absolute inset-0 flex items-center justify-between px-4 text-sm",children:[l||(0,uW.jsx)("span",{className:`ml-2 ${h}`,children:o}),c||(0,uW.jsx)("span",{className:`mr-2 ${p}`,children:s})]}),(0,uW.jsx)("div",{className:"pointer-events-none absolute top-0 z-10",style:{[w?"right":"left"]:`max(${a/2}px, calc(${R}%))`,transform:w?"translateX(calc(50%))":"translateX(calc(-50%))",height:"100%"},children:(0,uW.jsx)("div",{className:`bg-base-200 flex h-full items-center justify-center rounded-full text-xs shadow-md ${b}`,style:{width:`${a}px`},children:f||u})}),(0,uW.jsx)("input",{type:"range",min:0,max:100,step:n,value:T,className:"absolute inset-0 h-full w-full cursor-pointer opacity-0",onChange:A,"aria-label":e,"aria-valuemin":t,"aria-valuemax":r,"aria-valuenow":v,"aria-valuetext":`${v}`,"aria-orientation":"horizontal"})]})})},uX=({bookKey:e,actionTab:t,progressFraction:r,progressValid:n,navigationHandlers:i,viewSettings:a,bottomOffset:o,sliderHeight:s})=>{let l=(0,uV.useTranslation)(),{getView:c}=(0,uq.useReaderStore)(),f=c(e),[u,d]=uz.default.useState(n?100*r:0);(0,uz.useEffect)(()=>{n&&d(100*r)},[n,r]);let h=(0,uz.useCallback)(e=>{d(e),i.onProgressChange(e)},[i]),p=(0,uD.default)("footerbar-progress-mobile bg-base-200 absolute flex w-full flex-col items-center gap-y-8 px-4 transition-all sm:hidden","progress"===t?"pointer-events-auto translate-y-0 pb-4 pt-8 ease-out":"pointer-events-none invisible translate-y-full overflow-hidden pb-0 pt-0 ease-in");return(0,uO.jsxs)("div",{className:p,style:{bottom:o},children:[(0,uO.jsx)("div",{className:"flex w-full items-center justify-between gap-x-6",children:(0,uO.jsx)(uG,{label:l("Reading Progress"),heightPx:s,bubbleLabel:`${Math.round(u)}%`,initialValue:u,onChange:h})}),(0,uO.jsxs)("div",{className:"flex w-full items-center justify-between gap-x-6",children:[(0,uO.jsx)(fM,{icon:uU(a?.rtl,(0,uO.jsx)(uF.RiArrowLeftDoubleLine,{}),(0,uO.jsx)(uF.RiArrowRightDoubleLine,{})),onClick:uH(a?.rtl,i.onPrevSection,i.onNextSection),label:u$(a?.rtl,l("Previous Section"),l("Next Section"))}),(0,uO.jsx)(fM,{icon:uU(a?.rtl,(0,uO.jsx)(uF.RiArrowLeftSLine,{}),(0,uO.jsx)(uF.RiArrowRightSLine,{})),onClick:uH(a?.rtl,i.onPrevPage,i.onNextPage),label:u$(a?.rtl,l("Previous Page"),l("Next Page"))}),(0,uO.jsx)(fM,{icon:uU(a?.rtl,(0,uO.jsx)(uF.RiArrowGoBackLine,{}),(0,uO.jsx)(uF.RiArrowGoForwardLine,{})),onClick:i.onGoBack,label:l("Go Back"),disabled:!f?.history.canGoBack}),(0,uO.jsx)(fM,{icon:uU(a?.rtl,(0,uO.jsx)(uF.RiArrowGoForwardLine,{}),(0,uO.jsx)(uF.RiArrowGoBackLine,{})),onClick:i.onGoForward,label:l("Go Forward"),disabled:!f?.history.canGoForward}),(0,uO.jsx)(fM,{icon:uU(a?.rtl,(0,uO.jsx)(uF.RiArrowRightSLine,{}),(0,uO.jsx)(uF.RiArrowLeftSLine,{})),onClick:uH(a?.rtl,i.onNextPage,i.onPrevPage),label:u$(a?.rtl,l("Next Page"),l("Previous Page"))}),(0,uO.jsx)(fM,{icon:uU(a?.rtl,(0,uO.jsx)(uF.RiArrowRightDoubleLine,{}),(0,uO.jsx)(uF.RiArrowLeftDoubleLine,{})),onClick:uH(a?.rtl,i.onNextSection,i.onPrevSection),label:u$(a?.rtl,l("Next Section"),l("Previous Section"))})]})]})};var uY=t,uZ=c,uJ=r,uQ=fx,u0=tY;function u1(e){return(0,u0.GenIcon)({tag:"svg",attr:{viewBox:"0 0 15 15",fill:"none"},child:[{tag:"path",attr:{fillRule:"evenodd",clipRule:"evenodd",d:"M3.78233 2.21713C3.70732 2.14212 3.60557 2.09998 3.49949 2.09998C3.3934 2.09998 3.29166 2.14212 3.21664 2.21713L1.21664 4.21713C1.06044 4.37334 1.06044 4.62661 1.21664 4.78282C1.37285 4.93903 1.62612 4.93903 1.78233 4.78282L3.09949 3.46566L3.09949 11.5343L1.78233 10.2171C1.62612 10.0609 1.37285 10.0609 1.21664 10.2171C1.06043 10.3733 1.06043 10.6266 1.21664 10.7828L3.21664 12.7828C3.29166 12.8578 3.3934 12.9 3.49949 12.9C3.60557 12.9 3.70731 12.8578 3.78233 12.7828L5.78233 10.7828C5.93854 10.6266 5.93854 10.3733 5.78233 10.2171C5.62612 10.0609 5.37285 10.0609 5.21664 10.2171L3.89949 11.5343L3.89949 3.46566L5.21664 4.78282C5.37285 4.93903 5.62612 4.93903 5.78233 4.78282C5.93854 4.62661 5.93854 4.37334 5.78233 4.21713L3.78233 2.21713ZM8.49998 3.99997C8.22383 3.99997 7.99998 4.22382 7.99998 4.49997C7.99998 4.77611 8.22383 4.99997 8.49998 4.99997H14.5C14.7761 4.99997 15 4.77611 15 4.49997C15 4.22382 14.7761 3.99997 14.5 3.99997H8.49998ZM7.99998 7.49997C7.99998 7.22382 8.22383 6.99997 8.49998 6.99997H14.5C14.7761 6.99997 15 7.22382 15 7.49997C15 7.77611 14.7761 7.99997 14.5 7.99997H8.49998C8.22383 7.99997 7.99998 7.77611 7.99998 7.49997ZM8.49998 9.99997C8.22383 9.99997 7.99998 10.2238 7.99998 10.5C7.99998 10.7761 8.22383 11 8.49998 11H14.5C14.7761 11 15 10.7761 15 10.5C15 10.2238 14.7761 9.99997 14.5 9.99997H8.49998Z",fill:"currentColor"},child:[]}]})(e)}function u2(e){return(0,u0.GenIcon)({tag:"svg",attr:{viewBox:"0 0 15 15",fill:"none"},child:[{tag:"path",attr:{fillRule:"evenodd",clipRule:"evenodd",d:"M10.3004 7.49991C10.3004 8.4943 9.49426 9.30041 8.49988 9.30041C7.50549 9.30041 6.69938 8.4943 6.69938 7.49991C6.69938 6.50553 7.50549 5.69942 8.49988 5.69942C9.49426 5.69942 10.3004 6.50553 10.3004 7.49991ZM11.205 8C10.9699 9.28029 9.84816 10.2504 8.49988 10.2504C7.1516 10.2504 6.0299 9.28029 5.79473 8H0.5C0.223858 8 0 7.77614 0 7.5C0 7.22386 0.223858 7 0.5 7H5.7947C6.0298 5.71962 7.15154 4.74942 8.49988 4.74942C9.84822 4.74942 10.97 5.71962 11.2051 7H14.5C14.7761 7 15 7.22386 15 7.5C15 7.77614 14.7761 8 14.5 8H11.205Z",fill:"currentColor"},child:[]}]})(e)}var u3=n,u6=m,u4=i,u8=ru;let u5=8,u9=30,u7=16,de=8,dt=24,dr=10,dn={MAX_MARGIN_PX:88,MAX_GAP_PERCENT:10,MARGIN_RATIO:50},di=({bookKey:e,actionTab:t,bottomOffset:r,marginIconSize:n})=>{let i=(0,u4.useTranslation)(),{envConfig:a}=(0,u3.useEnv)(),{getView:o,getViewSettings:s}=(0,u6.useReaderStore)(),l=s(e),c=o(e),f=(0,uJ.useCallback)(t=>{(0,u8.saveViewSettings)(a,e,"defaultFontSize",t)},[a,e]),u=(0,uJ.useCallback)(t=>{let r=s(e);if(!r)return;let{MAX_MARGIN_PX:n,MAX_GAP_PERCENT:i}=dn,o=Math.round(t/100*n),l=Math.round(t/100*i);r.marginTopPx=o,r.marginBottomPx=o/2,r.marginLeftPx=o/2,r.marginRightPx=o/2,(0,u8.saveViewSettings)(a,e,"gapPercent",l,!1,!1),c?.renderer.setAttribute("margin",`${o}px`),c?.renderer.setAttribute("gap",`${l}%`),r?.scrolled&&c?.renderer.setAttribute("flow","scrolled")},[a,e,c,s]),d=(0,uJ.useCallback)(t=>{(0,u8.saveViewSettings)(a,e,"lineHeight",t/dr)},[a,e]),h=(0,uJ.useCallback)((e,t)=>{let{MAX_MARGIN_PX:r,MAX_GAP_PERCENT:n,MARGIN_RATIO:i}=dn;return(e/r+t/n)*i},[]),p=(0,uZ.default)("footerbar-font-mobile bg-base-200 absolute flex w-full flex-col items-center gap-y-8 px-4 transition-all sm:hidden","font"===t?"pointer-events-auto translate-y-0 pb-4 pt-8 ease-out":"pointer-events-none invisible translate-y-full overflow-hidden pb-0 pt-0 ease-in");return(0,uY.jsxs)("div",{className:p,style:{bottom:r},children:[(0,uY.jsx)(uG,{label:i("Font Size"),initialValue:l?.defaultFontSize??u7,bubbleLabel:`${l?.defaultFontSize??u7}`,minLabel:"A",maxLabel:"A",minClassName:"text-xs",maxClassName:"text-base",onChange:f,min:u5,max:u9}),(0,uY.jsxs)("div",{className:"flex w-full items-center justify-between gap-x-6",children:[(0,uY.jsx)(uG,{label:i("Page Margin"),initialValue:h(l?.marginTopPx??44,l?.gapPercent??5),bubbleElement:(0,uY.jsx)(uQ.TbBoxMargin,{size:n}),minLabel:i("Small"),maxLabel:i("Large"),step:10,onChange:u}),(0,uY.jsx)(uG,{label:i("Line Spacing"),initialValue:(l?.lineHeight??1.6)*dr,bubbleElement:(0,uY.jsx)(u1,{size:n}),minLabel:i("Small"),maxLabel:i("Large"),min:de,max:dt,onChange:d})]})]})};var da=t,ds=c,dl=r,dc=iz,df=fx,du=n,dd=b,dh=i,dp=o,db=k,dm=ru,dg=e.i(415810),dy=X;let dv=0,dx=100,dw=50,dS=({actionTab:e,bottomOffset:t})=>{let r=(0,dh.useTranslation)(),{envConfig:n,appService:i}=(0,du.useEnv)(),{settings:a}=(0,dp.useSettingsStore)(),{getScreenBrightness:o,setScreenBrightness:s}=(0,db.useDeviceControlStore)(),{themeMode:l,themeColor:c,isDarkMode:f,setThemeMode:u,setThemeColor:d}=(0,dd.useThemeStore)(),[h,p]=(0,dl.useState)(a.screenBrightness>=0?a.screenBrightness:dw);(0,dl.useEffect)(()=>{i?.isMobileApp&&"color"===e&&o().then(e=>{e>=0&&e<=1&&p(Math.round(100*e))})},[e,i,o]);let b=(0,dl.useMemo)(()=>(0,dy.debounce)(async e=>{(0,dm.saveSysSettings)(n,"screenBrightness",e),(0,dm.saveSysSettings)(n,"autoScreenBrightness",!1),await s(e/100)},100),[n,s]),m=(0,dl.useCallback)(async e=>{i?.isMobileApp&&(p(e),b(e))},[i,b]),g=()=>{u("auto"===l?"light":"light"===l?"dark":"auto")},y=(0,ds.default)("footerbar-color-mobile bg-base-200 absolute flex w-full flex-col items-center gap-y-8 px-4 transition-all sm:hidden","color"===e?"pointer-events-auto translate-y-0 pb-4 pt-8 ease-out":"pointer-events-none invisible translate-y-full overflow-hidden pb-0 pt-0 ease-in");return(0,da.jsxs)("div",{className:y,style:{bottom:t},children:[i?.hasScreenBrightness&&(0,da.jsx)(uG,{label:r("Screen Brightness"),initialValue:h,bubbleLabel:`${h}`,minIcon:(0,da.jsx)(dc.PiSun,{size:16}),maxIcon:(0,da.jsx)(dc.PiSun,{size:24}),onChange:m,min:dv,max:dx,valueToPosition:(e,t,r)=>e<=t?0:e>=r?100:100*Math.pow(e/r,.5),positionToValue:(e,t,r)=>{if(e<=0)return t;if(e>=100)return r;let n=Math.pow(e/100,2)*r;return Math.max(t,Math.min(r,n))}}),(0,da.jsxs)("div",{className:"w-full",children:[(0,da.jsx)("div",{className:"flex items-center justify-between p-2",children:(0,da.jsx)("span",{className:"text-sm font-medium",children:r("Color")})}),(0,da.jsxs)("div",{className:"flex gap-3 overflow-x-auto p-2",style:{scrollbarWidth:"none",msOverflowStyle:"none"},children:[dg.themes.map(({name:e,label:t,colors:n})=>(0,da.jsx)("button",{onClick:()=>d(e),className:(0,ds.default)("flex flex-shrink-0 flex-col items-center justify-center rounded-lg p-3 transition-all","h-[40px] min-w-[80px]",c===e?"ring-primary ring-offset-base-200 ring-2 ring-offset-2":"hover:opacity-80"),style:{backgroundColor:f?n.dark["base-100"]:n.light["base-100"],color:f?n.dark["base-content"]:n.light["base-content"]},children:(0,da.jsx)("span",{className:"text-xs font-medium",children:r(t)})},e)),(0,da.jsx)("button",{onClick:()=>g(),className:(0,ds.default)("flex flex-shrink-0 flex-col items-center justify-center rounded-lg p-3 transition-all","h-[40px] min-w-[80px]","dark"===l?"ring-primary ring-offset-base-200 ring-2 ring-offset-2":"hover:opacity-80"),style:{backgroundColor:(dg.themes.find(e=>e.name===c)||dg.themes[0]).colors.dark["base-100"],color:(dg.themes.find(e=>e.name===c)||dg.themes[0]).colors.dark["base-content"]},children:"light"===l?(0,da.jsx)(dc.PiSun,{size:20}):"dark"===l?(0,da.jsx)(dc.PiMoon,{size:20}):(0,da.jsx)(df.TbSunMoon,{size:20})})]})]})]})};var dk=t,d_=c,dE=iD,dM=ei,dN=iz,dA=tQ,dT=m,dR=i,dC=t2;let dj=({bookKey:e,actionTab:t,navPadding:r,onSetActionTab:n})=>{let i=(0,dR.useTranslation)(),{getViewState:a}=(0,dT.useReaderStore)(),o=a(e),s=(0,dC.useResponsiveSize)(23),l=(0,dC.useResponsiveSize)(18);return(0,dk.jsxs)("div",{className:(0,d_.default)("bg-base-200 z-30 mt-auto flex w-full justify-between px-8 py-4 sm:hidden"),style:{paddingBottom:r},children:[(0,dk.jsx)(fM,{label:i("Table of Contents"),icon:(0,dk.jsx)(dE.IoIosList,{size:s}),onClick:()=>n("toc")}),(0,dk.jsx)(fM,{label:i("Color"),icon:(0,dk.jsx)(dN.PiSun,{className:(0,d_.default)("color"===t&&"text-blue-500")}),onClick:()=>n("color")}),(0,dk.jsx)(fM,{label:i("Reading Progress"),icon:(0,dk.jsx)(u2,{className:(0,d_.default)("progress"===t&&"text-blue-500")}),onClick:()=>n("progress")}),(0,dk.jsx)(fM,{label:i("Font & Layout"),icon:(0,dk.jsx)(dM.RiFontFamily,{size:l,className:(0,d_.default)("font"===t&&"text-blue-500")}),onClick:()=>n("font")}),(0,dk.jsx)(fM,{label:i("Speak"),icon:(0,dk.jsx)(dA.MdOutlineHeadphones,{className:o?.ttsEnabled?"text-blue-500":""}),onClick:()=>n("tts")})]})},dI=({bookKey:e,gridInsets:t,actionTab:r,progressValid:n,progressFraction:i,navigationHandlers:a,onSetActionTab:o})=>{let s=window.innerWidth<640||window.innerHeight<640,l=(0,uB.useResponsiveSize)(28),c=(0,uB.useResponsiveSize)(20),f=s?`${.33*t.bottom+64}px`:"64px",u=s?`${.33*t.bottom+16}px`:"0px";return(0,uP.jsxs)(uP.Fragment,{children:[(0,uP.jsx)(dS,{actionTab:r,bottomOffset:f}),(0,uP.jsx)(uX,{bookKey:e,actionTab:r,progressFraction:i,progressValid:n,navigationHandlers:a,bottomOffset:f,sliderHeight:l}),(0,uP.jsx)(di,{bookKey:e,actionTab:r,bottomOffset:f,marginIconSize:c}),(0,uP.jsx)(dj,{bookKey:e,actionTab:r,navPadding:u,onSetActionTab:o})]})};var dL=t,dP=r,dB=e.i(673156),dO=ei,dD=m,dz=i,dF=ec;let dU=(e,t,r=!1)=>{let n=t.toLowerCase();if(!n.startsWith("zh"))return e.toString();let i=n.includes("tw")||n.includes("hk"),a=r?"":"",o=(i?"":"").replace("",a),s=i?["","","","","",""]:["","","","","",""],l=String(e),c=l.length,f="";for(let e=0;e<c;e++){let t=Number(l[e]),r=c-e-1;0!==t?f+=o[t]+s[r%4]:!f.endsWith(a)&&e<c-1&&(f+=a),4===r&&(f+=s[4]),8===r&&(f+=s[5])}return f=f.replace(RegExp(`${a}+$`),"").replace(`${a}`,"").replace(`${a}`,"").replace(RegExp(`${a}+`,"g"),a),r||(f=i?f.replace(/^$/,"").replace(/(^|[^])([^]|$)/g,"$1$2"):f.replace(/^$/,"").replace(/(^|[^])([^]|$)/g,"$1$2")),f};function d$(e,t,r,n=!1,i="en",a=1){if(void 0===e||void 0===t||!(t>0)||!(e>=0))return"";{let o=n?dU(e+1,i,!0):String(e+1),s=n?dU(t,i,!0):String(t);return r.replace("{current}",o).replace("{total}",s).replace("{percent}",((e+1)/t*100).toFixed(a))}}function dH(e,t=!1,r="en"){return void 0===e||e<0?"":t?dU(e,r):String(e)}let dq=({bookKey:e,gridInsets:t,progressValid:r,progressFraction:n,navigationHandlers:i,onSpeakText:a})=>{let o=(0,dz.useTranslation)(),{hoveredBookKey:s,getView:l,getViewState:c,getProgress:f,getViewSettings:u}=(0,dD.useReaderStore)(),{getBookData:d}=(0,dF.useBookDataStore)(),h=l(e),p=d(e),b=f(e),m=c(e),g=u(e),y=g?.progressStyle||"percentage",[v,x]=dP.default.useState(r?100*n:0),{section:w,pageinfo:S}=b||{},k="fraction"===y?"{current} / {total}":"{percent}%",_=p?.isFixedLayout?w:S,E=d$(_?.current,_?.total,k,!1,"en",0),M=(0,dP.useRef)(null);(0,dP.useEffect)(()=>{s!==e&&M.current&&document.activeElement===M.current&&M.current.blur()},[s,e]),(0,dP.useEffect)(()=>{r&&x(100*n)},[r,n]);let N=(0,dP.useCallback)(e=>{x(e),i.onProgressChange(e)},[i]),A=window.innerWidth<640||window.innerHeight<640;return(0,dL.jsxs)("div",{className:"absolute hidden h-8 w-full items-center gap-x-4 px-4 sm:flex",style:{bottom:A?`${.33*t.bottom}px`:"0px"},children:[(0,dL.jsx)(fM,{icon:uU(g?.rtl,(0,dL.jsx)(dO.RiArrowLeftDoubleLine,{}),(0,dL.jsx)(dO.RiArrowRightDoubleLine,{})),onClick:uH(g?.rtl,i.onPrevSection,i.onNextSection),label:u$(g?.rtl,o("Previous Section"),o("Next Section"))}),(0,dL.jsx)(fM,{icon:uU(g?.rtl,(0,dL.jsx)(dO.RiArrowLeftSLine,{}),(0,dL.jsx)(dO.RiArrowRightSLine,{})),onClick:uH(g?.rtl,i.onPrevPage,i.onNextPage),label:u$(g?.rtl,o("Previous Page"),o("Next Page"))}),(0,dL.jsx)(fM,{icon:uU(g?.rtl,(0,dL.jsx)(dO.RiArrowGoBackLine,{}),(0,dL.jsx)(dO.RiArrowGoForwardLine,{})),onClick:i.onGoBack,label:o("Go Back"),disabled:!h?.history.canGoBack}),(0,dL.jsx)(fM,{icon:uU(g?.rtl,(0,dL.jsx)(dO.RiArrowGoForwardLine,{}),(0,dL.jsx)(dO.RiArrowGoBackLine,{})),onClick:i.onGoForward,label:o("Go Forward"),disabled:!h?.history.canGoForward}),r&&(0,dL.jsx)("span",{title:o("Reading Progress"),"aria-label":`${o("Reading Progress")}: ${Math.round(100*n)}%`,className:"mx-2 text-center text-sm",children:(0,dL.jsx)("span",{"aria-hidden":"true",children:E})}),(0,dL.jsx)("input",{ref:M,type:"range",className:"text-base-content mx-2 min-w-0 flex-1",min:0,max:100,"aria-label":o("Jump to Location"),value:v,onChange:e=>N(parseInt(e.target.value,10))}),(0,dL.jsx)(fM,{icon:(0,dL.jsx)(dB.FaHeadphones,{className:m?.ttsEnabled?"text-blue-500":""}),onClick:a,label:o("Speak")}),(0,dL.jsx)(fM,{icon:uU(g?.rtl,(0,dL.jsx)(dO.RiArrowRightSLine,{}),(0,dL.jsx)(dO.RiArrowLeftSLine,{})),onClick:uH(g?.rtl,i.onNextPage,i.onPrevPage),label:u$(g?.rtl,o("Next Page"),o("Previous Page"))}),(0,dL.jsx)(fM,{icon:uU(g?.rtl,(0,dL.jsx)(dO.RiArrowRightDoubleLine,{}),(0,dL.jsx)(dO.RiArrowLeftDoubleLine,{})),onClick:uH(g?.rtl,i.onNextSection,i.onPrevSection),label:u$(g?.rtl,o("Next Section"),o("Previous Section"))})]})};var dV=t,dW=c,dK=r,dG=n,dX=rt,dY=b,dZ=o,dJ=ec,dQ=m,d0=i,d1=t2,d2=Y,d3=af;let d6=e=>e.replace(/\r\n/g,"  ").replace(/\r/g," ").replace(/\n/g," ").trimStart(),d4=(e,t,r,n)=>{let i=t.replace(/^<break\b[^>]*>/i,"");return`
    <speak version="1.0" xml:lang="${e}">
      <voice name="${r}">
        <prosody rate="${n}" >
            ${i}
        </prosody>
      </voice>
    </speak>
  `},d8=(e,t)=>{let r="en",n=e.match(/xml:lang\s*=\s*"([^"]+)"/);if(n&&n[1]){let e=n[1].split("-");r=e.length>1?`${e[0].toLowerCase()}-${e[1].toUpperCase()}`:e[0].toLowerCase(),r=(0,d3.code6392to6391)(r)||r,(0,d3.isValidLang)(r)||(r="en")}t=(0,d3.code6392to6391)(t?.toLowerCase()||"")||t,"en"===r&&t&&!(0,d3.isSameLang)(r,t)&&(r=t.split("-")[0].toLowerCase());let i=e.replace(/<lang[^>]*>.*?<\/lang>/gs,"");return(0,d3.inferLangFromScript)(i,r)},d5=(e,t)=>{let r,n=d8(e,t)||"en";e=e.replace(/<speak[^>]*>/i,"").replace(/<\/speak>/i,"");let i="",a=[],o=null,s=n,l=[],c=/<(\/?)(\w+)([^>]*)>|([^<]+)/g;for(;null!==(r=c.exec(e));)if(r[4]){let e=r[4],t=d6(e);if(t&&o){let e=i.length;i+=t,a.push({offset:e,name:o,text:t,language:(0,d3.inferLangFromScript)(t,s)||s})}else i+=d6(e)}else{let e="/"===r[1],t=r[2],i=r[3];if("mark"!==t||e){if("lang"===t)if(e)s=l.pop()??n;else{l.push(s);let e=i?.match(/xml:lang="([^"]+)"/);e&&(s=e[1])}}else{let e=i?.match(/name="([^"]+)"/);e&&(o=e[1])}}return{plainText:i,marks:a}},d9=(e,t,r)=>{let n,i=d8(e,r),a=(0,d3.code6392to6391)(t.toLowerCase())||t.toLowerCase();if((0,d3.isSameLang)(a,i))return e.replace(/<lang\s+xml:lang="([^"]+)"[^>]*>.*?<\/lang>/gs,(e,t)=>{let r=(0,d3.code6392to6391)(t.toLowerCase())||t.toLowerCase();return(0,d3.isSameLang)(r,i)?e:""});let o=[],s=/<lang\s+xml:lang="([^"]+)"[^>]*>(.*?)<\/lang>/gs,l=new RegExp(s.source,s.flags);for(;null!==(n=l.exec(e));){let e=(0,d3.code6392to6391)(n[1].toLowerCase())||n[1].toLowerCase();(0,d3.isSameLang)(e,a)&&o.push({match:n[0],lang:n[1],content:n[2]})}if(o.length>0){let t=e.match(/<speak[^>]*>/i),r=e.match(/<\/speak>/i);if(!t||!r)return e;let n=o.map(e=>e.match).join("");return`${t[0]}${n}${r[0]}`}return e},d7="data:audio/mp3;base64,//MkxAAHiAICWABElBeKPL/RANb2w+yiT1g/gTok//lP/W/l3h8QO/OCdCqCW2Cw//MkxAQHkAIWUAhEmAQXWUOFW2dxPu//9mr60ElY5sseQ+xxesmHKtZr7bsqqX2L//MkxAgFwAYiQAhEAC2hq22d3///9FTV6tA36JdgBJoOGgc+7qvqej5Zu7/7uI9l//MkxBQHAAYi8AhEAO193vt9KGOq+6qcT7hhfN5FTInmwk8RkqKImTM55pRQHQSq//MkxBsGkgoIAABHhTACIJLf99nVI///yuW1uBqWfEu7CgNPWGpUadBmZ////4sL//MkxCMHMAH9iABEmAsKioqKigsLCwtVTEFNRTMuOTkuNVVVVVVVVVVVVVVVVVVV//MkxCkECAUYCAAAAFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV",he=["Albert","Bad News","Bahh","Bells","Boing","Bubbles","Cellos","Eddy","Flo","Fred","Good News","Grandma","Grandpa","Jester","Junior","Kathy","Organ","Ralph","Reed","Rocko","Sandy","Shelley","Superstar","Trinoids","Whisper","Wobble","Zarvox"];class ht{static LOCAL_STORAGE_KEY="ttsPreferredVoices";static PREFERRED_CLIENT_KEY="preferredClient";static normalizeLanguage(e){return e?e.toLowerCase().slice(0,2):"n/a"}static setPreferredClient(e){if(!e)return;let t=this.getPreferences();t[this.PREFERRED_CLIENT_KEY]=e,localStorage.setItem(this.LOCAL_STORAGE_KEY,JSON.stringify(t))}static setPreferredVoice(e,t,r){if(!e||!t||!r)return;let n=this.getPreferences(),i=this.normalizeLanguage(t);n[`${e}-${i}`]=r,localStorage.setItem(this.LOCAL_STORAGE_KEY,JSON.stringify(n))}static getPreferredClient(){return this.getPreferences()[this.PREFERRED_CLIENT_KEY]||null}static getPreferredVoice(e,t){let r=this.getPreferences(),n=this.normalizeLanguage(t);return r[`${e}-${n}`]||null}static getPreferences(){let e=localStorage.getItem(this.LOCAL_STORAGE_KEY);return e?JSON.parse(e):{}}static sortVoicesFunc(e,t){let r=e.lang.split("-")[1]||"",n=t.lang.split("-")[1]||"";return r===n?e.name<t.name?-1:+(e.name>t.name):"CN"===r?-1:"CN"===n?1:"TW"===r?-1:"TW"===n?1:"HK"===r?-1:"HK"===n?1:"US"===r?-1:"US"===n?1:"GB"===r?-1:"GB"===n?1:e.name<t.name?-1:+(e.name>t.name)}}async function*hr(e,t,r,n,i,a,o,s){let{marks:l}=d5(e,t),c=window.speechSynthesis,f=new SpeechSynthesisUtterance;for(let e of l){let{language:t}=e;s(e),f.text=e.text,f.rate=r(),f.pitch=n();let l=await i(t);l&&(f.voice=l,a(l.voiceURI)),t&&(f.lang=t,o(t)),yield{type:"boundary",speaking:!0,name:"sentence",mark:e.name};let u=await new Promise(e=>{f.onend=()=>e({type:"end",speaking:!1}),f.onerror=t=>e({type:"error",speaking:!1,error:t.error}),c.speak(f)});if(yield u,"error"===u.type)break}}class hn{name="web-speech";initialized=!1;controller;#e=[];#t="en";#r="";#n="";#i=1;#a=1;#o=window.speechSynthesis;constructor(e){this.controller=e}async init(){return this.#o?(await new Promise(e=>{let t=()=>{this.#e=this.#o.getVoices().map(e=>{let t=e;return t.id=e.voiceURI||e.name,t}),e()};this.#o.getVoices().length>0?t():void 0!==this.#o.onvoiceschanged?this.#o.onvoiceschanged=t:(console.warn("Voiceschanged event not supported."),e())}),this.initialized=!0):this.initialized=!1,this.initialized}getVoiceIdFromLang=async e=>{let t=ht.getPreferredVoice(this.name,e),r=this.#e.find(e=>e.id===t)||(await this.getVoices(e))[0]?.voices[0]||null;return r?.id||this.#n||""};getWebSpeechVoiceFromLang=async e=>{let t=await this.getVoiceIdFromLang(e);return this.#e.find(e=>e.id===t)||null};async *speak(e,t,r=!1){if(!r)for await(let r of hr(e,this.#t,()=>this.#i,()=>this.#a,this.getWebSpeechVoiceFromLang,e=>this.#n=e,e=>this.#r=e,e=>this.controller?.dispatchSpeakMark(e))){if(t.aborted){console.log("TTS aborted"),yield{code:"error",message:"Aborted"};return}"boundary"===r.type?yield{code:"boundary",mark:r.mark??"",message:`${r.name??"Unknown"} ${r.charIndex??0}/${r.charLength??0}`}:"error"===r.type?yield{code:"error",message:r.error??"Unknown error"}:"end"===r.type&&(yield{code:"end",message:"Speech finished"})}}async pause(){return this.#o.pause(),!0}async resume(){return this.#o.resume(),!0}async stop(){this.#o.cancel()}setPrimaryLang(e){this.#t=e}async setRate(e){this.#i=e}async setPitch(e){this.#a=e}async setVoice(e){let t=this.#e.find(t=>t.id===e);t&&(this.#n=t.id)}async getAllVoices(){return this.#e.map(e=>({id:e.id,name:e.name,lang:e.lang,disabled:!this.initialized}))}async getVoices(e){let t="en"===e&&(0,d2.getUserLocale)(e)||e,r=e=>!e.includes("com.apple")||e.includes("com.apple.voice.compact"),n=e=>!1===he.some(t=>e.name.includes(t)),i=this.#e.filter(r=>r.lang.startsWith(t)||"en"===e&&["en-US","en-GB"].includes(r.lang)).filter(e=>r(e.voiceURI||"")).filter(n),a=new Set,o=i.map(e=>({id:e.voiceURI,name:e.name,lang:e.lang})).filter(e=>!a.has(e.id)&&(a.add(e.id),!0));return o.forEach(e=>{e.disabled=!this.initialized}),[{id:"web-speech-api",name:"Web TTS",voices:o.sort(ht.sortVoicesFunc),disabled:!this.initialized||0===o.length}]}getGranularities(){return["sentence"]}getVoiceId(){return this.#n}getSpeakingLang(){return this.#r}async shutdown(){this.initialized=!1,this.#e=[],await this.stop()}}var hi=Y,ha=D,ho=null;let hs=ho="undefined"!=typeof WebSocket?WebSocket:"undefined"!=typeof MozWebSocket?MozWebSocket:e.g.WebSocket||e.g.MozWebSocket;var hl=e.i(906124),hc=Y;class hf{capacity;map;onEvict;constructor(e,t){if(e<=0)throw Error("LRUCache capacity must be greater than 0");this.capacity=e,this.map=new Map,this.onEvict=t}get(e){if(!this.map.has(e))return;let t=this.map.get(e);return this.map.delete(e),this.map.set(e,t),t}set(e,t){if(this.map.has(e)){let t=this.map.get(e);this.map.delete(e),this.onEvict&&this.onEvict(e,t)}else if(this.map.size===this.capacity){let e=this.map.keys().next().value;if(e){let t=this.map.get(e);this.map.delete(e),this.onEvict&&this.onEvict(e,t)}}this.map.set(e,t)}has(e){return this.map.has(e)}delete(e){if(this.map.has(e)){let t=this.map.get(e),r=this.map.delete(e);return r&&this.onEvict&&this.onEvict(e,t),r}return!1}clear(){if(this.onEvict)for(let[e,t]of this.map)this.onEvict(e,t);this.map.clear()}size(){return this.map.size}entries(){return Array.from(this.map).reverse()}}var hu=e.i(98249),hd=A;let hh="wss://speech.platform.bing.com/consumer/speech/synthesize/readaloud/edge/v1",hp="6A5AA1D4EAFF4E9FB37E23D68491D6F4",hb="143.0.3650.75",hm=hb.split(".")[0],hg={"af-ZA":["af-ZA-AdriNeural","af-ZA-WillemNeural"],"am-ET":["am-ET-AmehaNeural","am-ET-MekdesNeural"],"ar-AE":["ar-AE-FatimaNeural","ar-AE-HamdanNeural"],"ar-BH":["ar-BH-AliNeural","ar-BH-LailaNeural"],"ar-DZ":["ar-DZ-AminaNeural","ar-DZ-IsmaelNeural"],"ar-EG":["ar-EG-SalmaNeural","ar-EG-ShakirNeural"],"ar-IQ":["ar-IQ-BasselNeural","ar-IQ-RanaNeural"],"ar-JO":["ar-JO-SanaNeural","ar-JO-TaimNeural"],"ar-KW":["ar-KW-FahedNeural","ar-KW-NouraNeural"],"ar-LB":["ar-LB-LaylaNeural","ar-LB-RamiNeural"],"ar-LY":["ar-LY-ImanNeural","ar-LY-OmarNeural"],"ar-MA":["ar-MA-JamalNeural","ar-MA-MounaNeural"],"ar-OM":["ar-OM-AbdullahNeural","ar-OM-AyshaNeural"],"ar-QA":["ar-QA-AmalNeural","ar-QA-MoazNeural"],"ar-SA":["ar-SA-HamedNeural","ar-SA-ZariyahNeural"],"ar-SY":["ar-SY-AmanyNeural","ar-SY-LaithNeural"],"ar-TN":["ar-TN-HediNeural","ar-TN-ReemNeural"],"ar-YE":["ar-YE-MaryamNeural","ar-YE-SalehNeural"],"az-AZ":["az-AZ-BabekNeural","az-AZ-BanuNeural"],"bg-BG":["bg-BG-BorislavNeural","bg-BG-KalinaNeural"],"bn-BD":["bn-BD-NabanitaNeural","bn-BD-PradeepNeural"],"bn-IN":["bn-IN-BashkarNeural","bn-IN-TanishaaNeural"],"bs-BA":["bs-BA-GoranNeural","bs-BA-VesnaNeural"],"ca-ES":["ca-ES-EnricNeural","ca-ES-JoanaNeural"],"cs-CZ":["cs-CZ-AntoninNeural","cs-CZ-VlastaNeural"],"cy-GB":["cy-GB-AledNeural","cy-GB-NiaNeural"],"da-DK":["da-DK-ChristelNeural","da-DK-JeppeNeural"],"de-AT":["de-AT-IngridNeural","de-AT-JonasNeural"],"de-CH":["de-CH-JanNeural","de-CH-LeniNeural"],"de-DE":["de-DE-AmalaNeural","de-DE-ConradNeural","de-DE-FlorianMultilingualNeural","de-DE-KatjaNeural","de-DE-KillianNeural","de-DE-SeraphinaMultilingualNeural"],"el-GR":["el-GR-AthinaNeural","el-GR-NestorasNeural"],"en-AU":["en-AU-NatashaNeural","en-AU-WilliamNeural"],"en-CA":["en-CA-ClaraNeural","en-CA-LiamNeural"],"en-GB":["en-GB-LibbyNeural","en-GB-MaisieNeural","en-GB-RyanNeural","en-GB-SoniaNeural","en-GB-ThomasNeural"],"en-HK":["en-HK-SamNeural","en-HK-YanNeural"],"en-IE":["en-IE-ConnorNeural","en-IE-EmilyNeural"],"en-IN":["en-IN-NeerjaExpressiveNeural","en-IN-NeerjaNeural","en-IN-PrabhatNeural"],"en-KE":["en-KE-AsiliaNeural","en-KE-ChilembaNeural"],"en-NG":["en-NG-AbeoNeural","en-NG-EzinneNeural"],"en-NZ":["en-NZ-MitchellNeural","en-NZ-MollyNeural"],"en-PH":["en-PH-JamesNeural","en-PH-RosaNeural"],"en-SG":["en-SG-LunaNeural","en-SG-WayneNeural"],"en-TZ":["en-TZ-ElimuNeural","en-TZ-ImaniNeural"],"en-US":["en-US-AnaNeural","en-US-AndrewMultilingualNeural","en-US-AndrewNeural","en-US-AriaNeural","en-US-AvaMultilingualNeural","en-US-AvaNeural","en-US-BrianMultilingualNeural","en-US-BrianNeural","en-US-ChristopherNeural","en-US-EmmaMultilingualNeural","en-US-EmmaNeural","en-US-EricNeural","en-US-GuyNeural","en-US-JennyNeural","en-US-MichelleNeural","en-US-RogerNeural","en-US-SteffanNeural"],"es-AR":["es-AR-ElenaNeural","es-AR-TomasNeural"],"es-BO":["es-BO-MarceloNeural","es-BO-SofiaNeural"],"es-CL":["es-CL-CatalinaNeural","es-CL-LorenzoNeural"],"es-CO":["es-CO-GonzaloNeural","es-CO-SalomeNeural"],"es-CR":["es-CR-JuanNeural","es-CR-MariaNeural"],"es-CU":["es-CU-BelkysNeural","es-CU-ManuelNeural"],"es-DO":["es-DO-EmilioNeural","es-DO-RamonaNeural"],"es-EC":["es-EC-AndreaNeural","es-EC-LuisNeural"],"es-ES":["es-ES-AlvaroNeural","es-ES-ElviraNeural","es-ES-XimenaNeural"],"es-US":["es-US-AlonsoNeural","es-US-PalomaNeural"],"et-EE":["et-EE-AnuNeural","et-EE-KertNeural"],"fa-IR":["fa-IR-DilaraNeural","fa-IR-FaridNeural"],"fi-FI":["fi-FI-HarriNeural","fi-FI-NooraNeural"],"fil-PH":["fil-PH-AngeloNeural","fil-PH-BlessicaNeural"],"fr-BE":["fr-BE-CharlineNeural","fr-BE-GerardNeural"],"fr-CA":["fr-CA-AntoineNeural","fr-CA-JeanNeural","fr-CA-SylvieNeural","fr-CA-ThierryNeural"],"fr-CH":["fr-CH-ArianeNeural","fr-CH-FabriceNeural"],"fr-FR":["fr-FR-DeniseNeural","fr-FR-EloiseNeural","fr-FR-HenriNeural","fr-FR-RemyMultilingualNeural","fr-FR-VivienneMultilingualNeural"],"ga-IE":["ga-IE-ColmNeural","ga-IE-OrlaNeural"],"gl-ES":["gl-ES-RoiNeural","gl-ES-SabelaNeural"],"gu-IN":["gu-IN-DhwaniNeural","gu-IN-NiranjanNeural"],"he-IL":["he-IL-AvriNeural","he-IL-HilaNeural"],"hi-IN":["hi-IN-MadhurNeural","hi-IN-SwaraNeural"],"hr-HR":["hr-HR-GabrijelaNeural","hr-HR-SreckoNeural"],"hu-HU":["hu-HU-NoemiNeural","hu-HU-TamasNeural"],"id-ID":["id-ID-ArdiNeural","id-ID-GadisNeural"],"is-IS":["is-IS-GudrunNeural","is-IS-GunnarNeural"],"it-IT":["it-IT-DiegoNeural","it-IT-ElsaNeural","it-IT-GiuseppeMultilingualNeural","it-IT-IsabellaNeural"],"iu-Cans-CA":["iu-Cans-CA-SiqiniqNeural","iu-Cans-CA-TaqqiqNeural"],"iu-Latn-CA":["iu-Latn-CA-SiqiniqNeural","iu-Latn-CA-TaqqiqNeural"],"ja-JP":["ja-JP-KeitaNeural","ja-JP-NanamiNeural"],"jv-ID":["jv-ID-DimasNeural","jv-ID-SitiNeural"],"ka-GE":["ka-GE-EkaNeural","ka-GE-GiorgiNeural"],"kk-KZ":["kk-KZ-AigulNeural","kk-KZ-DauletNeural"],"km-KH":["km-KH-PisethNeural","km-KH-SreymomNeural"],"kn-IN":["kn-IN-GaganNeural","kn-IN-SapnaNeural"],"ko-KR":["ko-KR-HyunsuMultilingualNeural","ko-KR-InJoonNeural","ko-KR-SunHiNeural"],"lo-LA":["lo-LA-ChanthavongNeural","lo-LA-KeomanyNeural"],"lt-LT":["lt-LT-LeonasNeural","lt-LT-OnaNeural"],"lv-LV":["lv-LV-EveritaNeural","lv-LV-NilsNeural"],"mk-MK":["mk-MK-AleksandarNeural","mk-MK-MarijaNeural"],"ml-IN":["ml-IN-MidhunNeural","ml-IN-SobhanaNeural"],"mn-MN":["mn-MN-BataaNeural","mn-MN-YesuiNeural"],"mr-IN":["mr-IN-AarohiNeural","mr-IN-ManoharNeural"],"ms-MY":["ms-MY-OsmanNeural","ms-MY-YasminNeural"],"mt-MT":["mt-MT-GraceNeural","mt-MT-JosephNeural"],"my-MM":["my-MM-NilarNeural","my-MM-ThihaNeural"],"nb-NO":["nb-NO-FinnNeural","nb-NO-PernilleNeural"],"ne-NP":["ne-NP-HemkalaNeural","ne-NP-SagarNeural"],"nl-BE":["nl-BE-ArnaudNeural","nl-BE-DenaNeural"],"nl-NL":["nl-NL-ColetteNeural","nl-NL-FennaNeural","nl-NL-MaartenNeural"],"pl-PL":["pl-PL-MarekNeural","pl-PL-ZofiaNeural"],"ps-AF":["ps-AF-GulNawazNeural","ps-AF-LatifaNeural"],"pt-BR":["pt-BR-AntonioNeural","pt-BR-FranciscaNeural","pt-BR-ThalitaMultilingualNeural"],"pt-PT":["pt-PT-DuarteNeural","pt-PT-RaquelNeural"],"ro-RO":["ro-RO-AlinaNeural","ro-RO-EmilNeural"],"ru-RU":["ru-RU-DmitryNeural","ru-RU-SvetlanaNeural"],"si-LK":["si-LK-SameeraNeural","si-LK-ThiliniNeural"],"sk-SK":["sk-SK-LukasNeural","sk-SK-ViktoriaNeural"],"sl-SI":["sl-SI-PetraNeural","sl-SI-RokNeural"],"so-SO":["so-SO-MuuseNeural","so-SO-UbaxNeural"],"sq-AL":["sq-AL-AnilaNeural","sq-AL-IlirNeural"],"sr-RS":["sr-RS-NicholasNeural","sr-RS-SophieNeural"],"su-ID":["su-ID-JajangNeural","su-ID-TutiNeural"],"sv-SE":["sv-SE-MattiasNeural","sv-SE-SofieNeural"],"sw-KE":["sw-KE-RafikiNeural","sw-KE-ZuriNeural"],"sw-TZ":["sw-TZ-DaudiNeural","sw-TZ-RehemaNeural"],"ta-IN":["ta-IN-PallaviNeural","ta-IN-ValluvarNeural"],"ta-LK":["ta-LK-KumarNeural","ta-LK-SaranyaNeural"],"ta-MY":["ta-MY-KaniNeural","ta-MY-SuryaNeural"],"ta-SG":["ta-SG-AnbuNeural","ta-SG-VenbaNeural"],"te-IN":["te-IN-MohanNeural","te-IN-ShrutiNeural"],"th-TH":["th-TH-NiwatNeural","th-TH-PremwadeeNeural"],"tr-TR":["tr-TR-AhmetNeural","tr-TR-EmelNeural"],"uk-UA":["uk-UA-OstapNeural","uk-UA-PolinaNeural"],"ur-IN":["ur-IN-GulNeural","ur-IN-SalmanNeural"],"ur-PK":["ur-PK-AsadNeural","ur-PK-UzmaNeural"],"uz-UZ":["uz-UZ-MadinaNeural","uz-UZ-SardorNeural"],"vi-VN":["vi-VN-HoaiMyNeural","vi-VN-NamMinhNeural"],"zh-CN":["zh-CN-XiaoxiaoNeural","zh-CN-XiaoyiNeural","zh-CN-YunjianNeural","zh-CN-YunxiNeural","zh-CN-YunxiaNeural","zh-CN-YunyangNeural","zh-CN-liaoning-XiaobeiNeural","zh-CN-shaanxi-XiaoniNeural"],"zh-HK":["zh-HK-HiuGaaiNeural","zh-HK-HiuMaanNeural","zh-HK-WanLungNeural"],"zh-TW":["zh-TW-HsiaoChenNeural","zh-TW-HsiaoYuNeural","zh-TW-YunJheNeural"],"zu-ZA":["zu-ZA-ThandoNeural","zu-ZA-ThembaNeural"]},hy=0x2b6109100,hv=1e9,hx=()=>{let e=Math.floor(Date.now()/1e3);e+=hy,e-=e%300,e*=hv/100;let t=`${e.toFixed(0)}${hp}`;return(0,hl.createHash)("sha256").update(t,"ascii").digest("hex").toUpperCase()},hw=()=>{let e=new Uint8Array(16);return crypto.getRandomValues(e),Array.from(e).map(e=>e.toString(16).padStart(2,"0")).join("").toUpperCase()},hS=e=>Object.entries(e).flatMap(([e,t])=>t.map(t=>({name:t.replace(`${e}-`,"").replace("Neural",""),id:t,lang:e}))),hk=e=>{let t=JSON.stringify(e);return(0,ha.md5)(t)};class h_{static voices=hS(hg);static audioCache=new hf(200);static audioUrlCache=new hf(200,(e,t)=>{t.startsWith("blob:")&&URL.revokeObjectURL(t)});protocol="wss";constructor(e){e&&(this.protocol=e)}async #s({lang:e,text:t,voice:r,rate:n}){let i=(0,hd.getNodeAPIBaseUrl)()+"/tts/edge",a=await (0,hu.fetchWithAuth)(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({input:t,voice:r,rate:n,lang:e})});if(!a.ok)throw Error(`Edge TTS HTTP request failed: ${a.status} ${a.statusText}`);return a}async #l({lang:t,text:r,voice:n,rate:i}){let a=(0,hc.randomMd5)(),o=new URLSearchParams({ConnectionId:a,TrustedClientToken:hp,"Sec-MS-GEC":hx(),"Sec-MS-GEC-Version":`1-${hb}`}),s=`${hh}?${o.toString()}`,l=new Date().toString(),c={"User-Agent":`Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/${hm}.0.0.0 Safari/537.36 Edg/${hm}.0.0.0`,"Accept-Encoding":"gzip, deflate, br, zstd","Accept-Language":"en-US,en;q=0.9",Pragma:"no-cache","Cache-Control":"no-cache",Origin:"chrome-extension://jdiccldimpdaibmpdkjnbmckianbfold","Sec-WebSocket-Version":"13",Cookie:`muid=${hw()};`},f={"Content-Type":"application/json; charset=utf-8",Path:"speech.config","X-Timestamp":l},u={"Content-Type":"application/ssml+xml",Path:"ssml","X-RequestId":a,"X-Timestamp":l},d=JSON.stringify({context:{synthesis:{audio:{metadataoptions:{sentenceBoundaryEnabled:!1,wordBoundaryEnabled:!0},outputFormat:"audio-24khz-48kbitrate-mono-mp3"}}}}),h=(e,t)=>{let r="";for(let t of Object.keys(e))r+=`${t}: ${e[t]}\r
`;return`${r}\r
${t}`},p=e=>{let t=e.split("\n"),r={},n="",i=0;for(i=0;i<t.length;i++){let e=t[i].trim();if(!e)break;let n=e.indexOf(":");if(-1===n)continue;let a=e.slice(0,n).trim(),o=e.slice(n+1).trim();r[a]=o}for(i+=1;i<t.length;i++)n+=t[i]+"\n";return{headers:r,body:n}},b=h(u,d4(t,r,n,i)),m=h(f,d);return new Promise((0,hd.isTauriAppPlatform)()?async(t,r)=>{try{let n=(await e.A(804133)).default,i=await n.connect(s,{headers:c}),a=new ArrayBuffer(0),o=await i.addListener(e=>{if("Text"===e.type){let{headers:n}=p(e.data);if("turn.end"===n.Path){if(i.disconnect(),o(),!a.byteLength)return r(Error("No audio data received."));let e=new Response(a);t(e)}}else if("Binary"===e.type){let t;t=e.data instanceof Uint8Array?e.data.buffer:new Uint8Array(e.data).buffer;let r=new DataView(t).getInt16(0);if(t.byteLength>r+2){let e=t.slice(2+r),n=new Uint8Array(a.byteLength+e.byteLength);n.set(new Uint8Array(a),0),n.set(new Uint8Array(e),a.byteLength),a=n.buffer}}});await i.send(m),await i.send(b)}catch(e){r(Error(`WebSocket error occurred: ${e}`))}}:(e,t)=>{let r=new hs(s,{headers:c});r.binaryType="arraybuffer";let n=new ArrayBuffer(0);r.addEventListener("open",()=>{r.send(m),r.send(b)}),r.addEventListener("message",i=>{if("string"==typeof i.data){let{headers:a}=p(i.data);if("turn.end"===a.Path){if(r.close(),!n.byteLength)return t(Error("No audio data received."));e(new Response(n))}}else if(i.data instanceof ArrayBuffer){let e=new DataView(i.data).getInt16(0);if(i.data.byteLength>e+2){let t=i.data.slice(2+e),r=new Uint8Array(n.byteLength+t.byteLength);r.set(new Uint8Array(n),0),r.set(new Uint8Array(t),n.byteLength),n=r.buffer}}}),r.addEventListener("close",()=>{n.byteLength||t(Error("No audio data received."))}),r.addEventListener("error",()=>{t(Error("WebSocket error occurred."))})})}async create(e){return"https"===this.protocol?this.#s(e):this.#l(e)}async createAudioUrl(e){let t=hk(e);if(h_.audioUrlCache.has(t))return h_.audioUrlCache.get(t);try{let r=await this.create(e),n=await r.arrayBuffer(),i=new Blob([n],{type:"audio/mpeg"}),a=URL.createObjectURL(i);return h_.audioCache.set(t,i),h_.audioUrlCache.set(t,a),a}catch(e){throw e}}}class hE{name="edge-tts";initialized=!1;controller;#e=[];#t="en";#r="";#n="";#i=1;#a=1;#c=null;#f=null;#u=!1;#d=0;#h=0;#p=null;constructor(e){this.controller=e}async init(e="wss"){this.#c=new h_(e),this.#e=h_.voices;try{await this.#c.create({lang:"en",text:"test",voice:"en-US-AriaNeural",rate:1,pitch:1}),this.initialized=!0}catch{"wss"===e?this.controller?.isAuthenticated?await this.init("https"):this.controller?.dispatchEvent(new CustomEvent("tts-need-auth")):this.initialized=!1}return this.initialized}getPayload=(e,t,r)=>({lang:e,text:t,voice:r,rate:1,pitch:this.#a});getVoiceIdFromLang=async e=>{let t=ht.getPreferredVoice(this.name,e),r=this.#e.find(e=>e.id===t);if(r)return r.id;let n=((await this.getVoices(e))[0]?.voices||[])[0]||null;return n?.id==="en-US-AnaNeural"?"en-US-AriaNeural":n?.id||this.#n||"en-US-AriaNeural"};async *speak(e,t,r=!1){let{marks:n}=d5(e,this.#t);if(r){let e=2;for(let r=0;r<Math.min(e,n.length)&&!t.aborted;r++){let e=n[r],{language:t}=e,i=await this.getVoiceIdFromLang(t);this.#n=i,await this.#c?.createAudioUrl(this.getPayload(t,e.text,i)).catch(e=>{console.warn("Error preloading mark",r,e)})}n.length>e&&(async()=>{for(let r=e;r<n.length;r++){let e=n[r];try{if(t.aborted)break;let{language:r}=e,n=await this.getVoiceIdFromLang(r);await this.#c?.createAudioUrl(this.getPayload(r,e.text,n))}catch(e){console.warn("Error preloading mark (bg)",r,e)}}})(),yield{code:"end",message:"Preload finished"};return}await this.stopInternal(),this.#f||(this.#f=new Audio);let i=this.#f;for(let e of(i.setAttribute("x-webkit-airplay","deny"),i.preload="auto",n)){this.controller?.dispatchSpeakMark(e);let r=null;try{let{language:n}=e,a=await this.getVoiceIdFromLang(n);this.#r=n;let o=await this.#c?.createAudioUrl(this.getPayload(n,e.text,a));if(t.aborted){yield{code:"error",message:"Aborted"};break}yield{code:"boundary",message:`Start chunk: ${e.name}`,mark:e.name};let s=await new Promise(n=>{let a=()=>{i.onended=null,i.onerror=null,i.src=""};(r=()=>{a(),n({code:"error",message:"Aborted"})},t.aborted)?r():(t.addEventListener("abort",r),i.onended=()=>{a(),n({code:"end",message:`Chunk finished: ${e.name}`})},i.onerror=e=>{a(),console.warn("Audio playback error:",e),n({code:"error",message:"Audio playback error"})},this.#u=!0,i.src=o||"",i.play().then(()=>i.playbackRate=this.#i).catch(e=>{a(),console.error("Failed to play audio:",e),n({code:"error",message:"Playback failed: "+e.message})}))});yield s}catch(r){if(r instanceof Error&&"No audio data received."===r.message){console.warn("No audio data received for:",e.text),yield{code:"end",message:`Chunk finished: ${e.name}`};continue}let t=r instanceof Error?r.message:String(r);console.warn("TTS error for mark:",e.text,t),yield{code:"error",message:t};break}finally{r&&t.removeEventListener("abort",r)}}await this.stopInternal()}async pause(){return!this.#u||!this.#f||(this.#d=this.#f.currentTime-this.#h,await this.#f.pause(),this.#u=!1,!0)}#b(){if(null!==this.#p)return this.#p;let e=navigator.userAgent,t=/Safari/.test(e)&&!/Chrome/.test(e),r=/iPad|iPhone|iPod/.test(e);return t||r?this.#p=.2:this.#p=0,this.#p}async resume(){if(this.#u||!this.#f)return!0;let e=this.#b();return this.#f.currentTime=Math.max(0,this.#f.currentTime-e),await this.#f.play(),this.#u=!0,this.#h=this.#f.currentTime-this.#d,!0}async stop(){await this.stopInternal()}async stopInternal(){this.#u=!1,this.#d=0,this.#h=0,this.#f&&(this.#f.pause(),this.#f.currentTime=0,this.#f?.onended&&this.#f.onended(new Event("stopped")),this.#f.src="")}async setRate(e){this.#i=e}async setPitch(e){this.#a=e}async setVoice(e){let t=this.#e.find(t=>t.id===e);t&&(this.#n=t.id)}async getAllVoices(){return this.#e.forEach(e=>{e.disabled=!this.initialized}),this.#e}async getVoices(e){let t="en"===e&&(0,hi.getUserLocale)(e)||e,r=(await this.getAllVoices()).filter(r=>r.lang.startsWith(t)||"en"===e&&["en-US","en-GB"].includes(r.lang));return[{id:"edge-tts",name:"Edge TTS",voices:r.sort(ht.sortVoicesFunc),disabled:!this.initialized||0===r.length}]}setPrimaryLang(e){this.#t=e}getGranularities(){return["sentence"]}getVoiceId(){return this.#n}getSpeakingLang(){return this.#r}async shutdown(){this.initialized=!1,this.#f=null,this.#e=[]}}var hM=eZ,hN=Y;let hA={default:"System TTS",msctts:"Msc TTS",mstrans:"MSTrans TTS",microsoft:"Microsoft TTS",bytedance:"ByteDance TTS",peiyinya:"PeiYinYa TTS",huoshan:"HuoShan TTS",sougou:"Sougou TTS",xiaomi:"XiaoMi TTS",bdetts:"BDeTTS",bdotts:"BDoTTS",vcstts:"VcsTTS",isstts:"IssTTS",xfpeiyin:"XFPeiYin",azure:"Azure TTS",edgetts:"Edge TTS",google:"Google TTS",gemini:"Gemini TTS",weread:"WeRead TTS",aispeech:"Aispeech"};class hT{name="native-tts";initialized=!1;controller;#e=[];#t="en";#r="";#n="";#i=1;#a=1;#m=null;#g=new Map;constructor(e){this.controller=e}async setupEventListener(){try{if(this.#m)return;this.#m=await (0,hM.addPluginListener)("native-tts","tts_events",e=>{let{utteranceId:t,code:r,message:n,mark:i}=e,a=this.#g.get(t);if(!a)return;let o={code:r,message:n,mark:i};a.eventQueue.push(o),"end"===r||"error"===r?(a.finished=!0,a.resolver&&a.resolver({value:void 0,done:!0})):a.resolver&&(a.resolver({value:o,done:!1}),a.resolver=null)})}catch(e){console.error("Failed to setup TTS event listener:",e)}}async init(){let e=await (0,hM.invoke)("plugin:native-tts|init");return this.initialized=e.success,this.initialized&&this.setupEventListener(),this.initialized}async *speakMark(e,t,r){if(t)return void(yield{code:"end",message:"Dummy preload finished"});let{language:n}=e,i=await this.getVoiceIdFromLang(n);this.#n=i,this.#r=n,await this.setVoice(i);try{let n=(await (0,hM.invoke)("plugin:native-tts|speak",{payload:{text:e.text,preload:t}})).utteranceId;this.#g.set(n,{eventQueue:[],resolver:null,finished:!1});let i=()=>{let e=this.#g.get(n);if(e&&e.resolver){let t={code:"error",message:"Aborted"};e.resolver({value:t,done:!0}),e.resolver=null}this.stop()};r.addEventListener("abort",i);try{for(;;){let t=this.#g.get(n);if(!t)break;if(t.eventQueue.length>0){let r=t.eventQueue.shift();if(r.mark=e.name,yield r,"end"===r.code||"error"===r.code)break}else if(t.finished)break;else{let e=new Promise(e=>{let t=this.#g.get(n);if(!t)return e();t.resolver=t=>e(t.value?.code==="error"?t.value:void 0)}),t=new Promise(e=>setTimeout(()=>e(null),100)),r=await Promise.race([e,t]);r&&(yield r)}if(r.aborted)break}}finally{r.removeEventListener("abort",i),this.#g.delete(n)}}catch(e){throw console.error("Failed to speak:",e),e}}async *speak(e,t,r=!1){let{marks:n}=d5(e,this.#t);for(let e of n)for await(let n of(this.controller?.dispatchSpeakMark(e),this.speakMark(e,r,t))){if(t.aborted)return void(yield{code:"error",message:"Aborted"});yield n}}async getVoiceIdFromLang(e){let t=ht.getPreferredVoice(this.name,e),r=this.#e.find(e=>e.id===t)||(await this.getVoices(e))[0]?.voices[0]||null;return r?.id||""}async pause(){return await (0,hM.invoke)("plugin:native-tts|pause"),!1}async resume(){return await (0,hM.invoke)("plugin:native-tts|resume"),!1}async stop(){await (0,hM.invoke)("plugin:native-tts|stop"),this.#g.clear()}async setRate(e){this.#i=parseFloat(Math.pow(e,2.5).toFixed(2)),await (0,hM.invoke)("plugin:native-tts|set_rate",{payload:{rate:this.#i}})}async setPitch(e){this.#a=e,await (0,hM.invoke)("plugin:native-tts|set_pitch",{payload:{pitch:this.#a}})}async setVoice(e){this.#n=e,await (0,hM.invoke)("plugin:native-tts|set_voice",{payload:{voice:e}})}async getAllVoices(){if(this.#e.length>0)return this.#e;try{let e=await (0,hM.invoke)("plugin:native-tts|get_all_voices");return this.#e=e.voices,this.#e}catch(e){return console.error("Failed to get all voices:",e),[]}}async getVoices(e){let t="en"===e&&(0,hN.getUserLocale)(e)||e,r=(await this.getAllVoices()).filter(r=>r.lang.startsWith(t)||"en"===e&&["en-US","en-GB"].includes(r.lang)),n=new Map;return r.forEach(e=>{let{name:t,lang:r}=e,i=e.id.split("_")[0];i in hA?e.name=t.replace(`${i}_`,"").replace(`${r}-`,"").replace("Neural","").trim():i="default",e.name=e.name.replace("NOT_SET",(0,hN.stubTranslation)("Default")),n.has(i)||n.set(i,[]),n.get(i).push(e)}),Array.from(n.entries()).map(([e,t])=>({id:e,name:hA[e]||e,voices:t.sort(ht.sortVoicesFunc),disabled:!this.initialized||0===t.length})).sort((e,t)=>"default"===e.id?-1:"default"===t.id?1:e.id.localeCompare(t.id))}setPrimaryLang(e){this.#t=e}getGranularities(){return["sentence"]}getVoiceId(){return this.#n}getSpeakingLang(){return this.#r}async shutdown(){this.#m&&(this.#m.unregister(),this.#m=null),await this.stop()}}var hR=e.i(104945);let hC="tts-highlight";class hj extends EventTarget{appService=null;view;isAuthenticated=!1;preprocessCallback;#y=0;#v=null;#x=null;state="stopped";ttsLang="";ttsRate=1;ttsClient;ttsWebClient;ttsEdgeClient;ttsNativeClient=null;ttsWebVoices=[];ttsEdgeVoices=[];ttsNativeVoices=[];ttsTargetLang="";options={style:"highlight",color:"gray"};constructor(e,t,r=!1,n){super(),this.ttsWebClient=new hn(this),this.ttsEdgeClient=new hE(this),e?.isAndroidApp&&(this.ttsNativeClient=new hT(this)),this.ttsClient=this.ttsWebClient,this.appService=e,this.view=t,this.isAuthenticated=r,this.preprocessCallback=n}async init(){let e=[];await this.ttsEdgeClient.init()&&e.push(this.ttsEdgeClient),this.ttsNativeClient&&await this.ttsNativeClient.init()&&(e.push(this.ttsNativeClient),this.ttsNativeVoices=await this.ttsNativeClient.getAllVoices()),await this.ttsWebClient.init()&&e.push(this.ttsWebClient),this.ttsClient=e[0]||this.ttsWebClient;let t=ht.getPreferredClient();if(t){let r=e.find(e=>e.name===t);r&&(this.ttsClient=r)}this.ttsWebVoices=await this.ttsWebClient.getAllVoices(),this.ttsEdgeVoices=await this.ttsEdgeClient.getAllVoices()}#w(){return e=>{let{overlayer:t}=this.view.renderer.getContents()[0],{style:r,color:n}=this.options;t?.remove(hC),t?.add(hC,e,hR.Overlayer[r],{color:n})}}#S(){let{overlayer:e}=this.view.renderer.getContents()?.[0]||{};e?.remove(hC)}async initViewTTS(e){e&&(this.options.style=e.style,this.options.color=e.color);let t=this.view.language.isCJK?"sentence":"word",r=this.ttsClient.getGranularities();r.includes(t)||(t=r[0]),await this.view.initTTS(t,au({tags:["rt"],contents:[{tag:"a",content:/^[\[\(]?[\*\d]+[\)\]]?$/}]}),this.#w())}async preloadSSML(e,t){if(e)for await(let r of(await this.ttsClient.speak(e,t,!0)));}async preloadNextSSML(e=4){let t=this.view.tts;if(!t)return;let r=0;for(let n=0;n<e;n++){let e=await this.#k(t.next());this.preloadSSML(e,new AbortController().signal),e&&r++}for(let e=0;e<r;e++)t.prev()}async #k(e){if(e)return e=e.replace(/<emphasis[^>]*>([^<]+)<\/emphasis>/g,"$1").replace(/[]/g,",").replace("<break/>"," ").replace(/\.{3,}/g,"   ").replace(//g,"  ").replace(/\*/g," ").replace(//g," "),this.ttsTargetLang&&(e=d9(e,this.ttsTargetLang)),this.preprocessCallback&&(e=await this.preprocessCallback(e)),e}async #_(e,t=!1){await this.stop(),this.#v=new AbortController;let{signal:r}=this.#v;this.#x=new Promise(async(n,i)=>{try{let i;if(console.log("TTS speak"),this.state="playing",r.addEventListener("abort",()=>{n()}),e=await this.#k(await e))this.#y=0;else{this.#y++,this.#y<10&&"playing"===this.state&&!t&&(n(),await this.view.next(),await this.forward()),console.log("no SSML, skipping for",this.#y);return}let{plainText:a,marks:o}=d5(e);if((!a||0===o.length)&&!t)return n(),await this.forward();for await(let{code:t}of(this.dispatchSpeakMark(o[0]),await this.preloadSSML(e,r),await this.ttsClient.speak(e,r))){if(r.aborted)return void n();i=t}"end"!==i||"playing"!==this.state||t||(n(),await this.forward()),n()}catch(e){r.aborted?n():i(e)}finally{this.#v&&(this.#v.abort(),this.#v=null)}}),await this.#x.catch(e=>this.error(e))}async speak(e,t=!1){await this.initViewTTS(),this.#_(e,t).catch(e=>this.error(e)),this.preloadNextSSML(),this.dispatchSpeakMark()}play(){"playing"!==this.state?this.start():this.pause()}async start(){await this.initViewTTS();let e=this.state.includes("paused")?this.view.tts?.resume():this.view.tts?.start();this.state.includes("paused")&&this.resume(),this.#_(e),this.preloadNextSSML()}async pause(){this.state="paused",await this.ttsClient.pause().catch(e=>this.error(e))||(await this.stop(),this.state="stop-paused")}async resume(){this.state="playing",await this.ttsClient.resume().catch(e=>this.error(e))}async stop(){if(this.#v&&this.#v.abort(),await this.ttsClient.stop().catch(e=>this.error(e)),this.#x){let e=new Promise((e,t)=>setTimeout(()=>t(Error("Stop operation timed out")),3e3));await Promise.race([this.#x.catch(e=>this.error(e)),e]).catch(e=>this.error(e)),this.#x=null}this.state="stopped"}async backward(e=!1){await this.initViewTTS(),"playing"===this.state?(await this.stop(),e?this.#_(this.view.tts?.prevMark()):this.#_(this.view.tts?.prev())):(await this.stop(),this.state="backward-paused",e?this.view.tts?.prevMark(!0):this.view.tts?.prev(!0))}async forward(e=!1){await this.initViewTTS(),"playing"===this.state?(await this.stop(),e?this.#_(this.view.tts?.nextMark()):(this.#_(this.view.tts?.next()),this.preloadNextSSML())):(await this.stop(),this.state="forward-paused",e?this.view.tts?.nextMark(!0):this.view.tts?.next(!0))}async setLang(e){this.ttsLang=e,this.setPrimaryLang(e)}async setPrimaryLang(e){this.ttsEdgeClient.initialized&&this.ttsEdgeClient.setPrimaryLang(e),this.ttsWebClient.initialized&&this.ttsWebClient.setPrimaryLang(e),this.ttsNativeClient?.initialized&&this.ttsNativeClient?.setPrimaryLang(e)}async setRate(e){this.state="setrate-paused",this.ttsRate=e,await this.ttsClient.setRate(this.ttsRate)}async getVoices(e){let t=await this.ttsWebClient.getVoices(e),r=await this.ttsEdgeClient.getVoices(e);return[...await this.ttsNativeClient?.getVoices(e)??[],...r,...t]}async setVoice(e,t){this.state="setvoice-paused";let r=!!this.ttsEdgeVoices.find(t=>(""===e||t.id===e)&&!t.disabled),n=!!this.ttsNativeVoices.find(t=>(""===e||t.id===e)&&!t.disabled);if(r)this.ttsClient=this.ttsEdgeClient,await this.ttsClient.setRate(this.ttsRate);else if(n){if(!this.ttsNativeClient)throw Error("Native TTS client is not available");this.ttsClient=this.ttsNativeClient,await this.ttsClient.setRate(this.ttsRate)}else this.ttsClient=this.ttsWebClient,await this.ttsClient.setRate(this.ttsRate);ht.setPreferredClient(this.ttsClient.name),ht.setPreferredVoice(this.ttsClient.name,t,e),await this.ttsClient.setVoice(e)}getVoiceId(){return this.ttsClient.getVoiceId()}getSpeakingLang(){return this.ttsClient.getSpeakingLang()}setTargetLang(e){this.ttsTargetLang=e}dispatchSpeakMark(e){if(this.dispatchEvent(new CustomEvent("tts-speak-mark",{detail:e||{text:""}})),e){let t=this.view.tts?.setMark(e.name);this.dispatchEvent(new CustomEvent("tts-highlight-mark",{detail:t}))}}error(e){console.error(e),this.state="stopped"}async shutdown(){await this.stop(),this.#S(),this.ttsWebClient.initialized&&await this.ttsWebClient.shutdown(),this.ttsEdgeClient.initialized&&await this.ttsEdgeClient.shutdown(),this.ttsNativeClient?.initialized&&await this.ttsNativeClient.shutdown()}}var hI=A,hL=Y,hP=eZ;class hB{handlers={};eventListenerInited=!1;eventListeners=[];async requestPostNotificationPermission(){(await (0,hP.invoke)("plugin:native-tts|checkPermissions")).postNotification.startsWith("prompt")&&await (0,hP.invoke)("plugin:native-tts|requestPermissions",{permissions:["postNotification"]})}async initializeListeners(){if(this.eventListenerInited)return;this.eventListenerInited=!0;let e=await (0,hP.addPluginListener)("native-tts","media-session-play",()=>{this.handlers.play&&this.handlers.play()});this.eventListeners.push(e);let t=await (0,hP.addPluginListener)("native-tts","media-session-pause",()=>{this.handlers.pause&&this.handlers.pause()});this.eventListeners.push(t);let r=await (0,hP.addPluginListener)("native-tts","media-session-next",()=>{this.handlers.nexttrack&&this.handlers.nexttrack()});this.eventListeners.push(r);let n=await (0,hP.addPluginListener)("native-tts","media-session-previous",()=>{this.handlers.previoustrack&&this.handlers.previoustrack()});this.eventListeners.push(n);let i=await (0,hP.addPluginListener)("native-tts","media-session-seek",e=>{let t=e.payload.position;this.handlers.seekto&&this.handlers.seekto(t)});this.eventListeners.push(i)}async cleanupListeners(){for(let e of this.eventListeners)await e.unregister();this.eventListeners=[],this.eventListenerInited=!1}async updateMetadata(e){try{await (0,hP.invoke)("plugin:native-tts|update_media_session_metadata",{payload:e})}catch(e){console.error("Failed to update media metadata:",e)}}async updatePlaybackState(e){try{await (0,hP.invoke)("plugin:native-tts|update_media_session_state",{payload:e})}catch(e){console.error("Failed to update playback state:",e)}}async setActive(e){try{e.active?(e.keepAppInForeground&&await this.requestPostNotificationPermission(),await this.initializeListeners()):await this.cleanupListeners(),await (0,hP.invoke)("plugin:native-tts|set_media_session_active",{payload:e})}catch(e){console.error("Failed to set media session active state:",e)}}setActionHandler(e,t){t?this.handlers[e]=t:delete this.handlers[e]}}function hO(){return"mediaSession"in navigator?navigator.mediaSession:"android"===(0,hL.getOSPlatform)()&&(0,hI.isTauriAppPlatform)()?new hB:null}let hD=(e,t,r=1,n=1)=>{if(!t)return{left:0,right:0,top:0,bottom:0};let i=r*t.left+e.left,a=r*t.right+e.left;return{left:i,right:a,top:n*t.top+e.top,bottom:n*t.bottom+e.top}},hz=({x:e,y:t})=>e>0&&t>0&&e<window.innerWidth&&t<window.innerHeight,hF=e=>{let t;for(t=e&&"object"==typeof e&&("tagName"in e)?e:e&&"object"==typeof e&&("collapse"in e)?e.commonAncestorContainer:e;t;){if(t.nodeType===Node.DOCUMENT_NODE){let e=t;if(e.defaultView&&e.defaultView.frameElement)return e.defaultView.frameElement}t=t.parentNode}return null},hU=(e,t,r)=>({x:Math.max(r,Math.min(e.x,t.right-t.left-r)),y:Math.max(r,Math.min(e.y,t.bottom-t.top-r))}),h$=(e,t)=>{if(0===e.rangeCount)return!1;let r=e.getRangeAt(0).getClientRects(),n=80;for(let e=0;e<r.length;e++){let i=r[e];if(t.clientX>=i.left-n&&t.clientX<=i.right+n&&t.clientY>=i.top-n&&t.clientY<=i.bottom+n)return!0}return!1},hH=(e,t,r,n=!1)=>{let{range:i,rect:a}=e&&"range"in e?e:{range:e,rect:void 0},o=hF(i),s=(o?getComputedStyle(o).transform:"").match(/matrix\((.+)\)/),[l,,,c]=s?.[1]?.split(/\s*,\s*/)?.map(e=>parseFloat(e))??[],f=o?.getBoundingClientRect()??{top:0,left:0},u={top:0,right:0,bottom:0,left:0};if("nodeType"in i&&1===i.nodeType){let e=window.getComputedStyle(i);u={top:parseInt(e.paddingTop,10)||0,right:parseInt(e.paddingRight,10)||0,bottom:parseInt(e.paddingBottom,10)||0,left:parseInt(e.paddingLeft,10)||0}}let d=Array.from(i.getClientRects()).map(e=>({top:e.top+u.top,right:e.right-u.right,bottom:e.bottom-u.bottom,left:e.left+u.left})),h=a?hD(f,a,l,c):hD(f,d[0],l,c),p=a?hD(f,a,l,c):hD(f,d.at(-1),l,c);if(n){let e=h.left-t.left>t.right-h.right?"left":"right",n={point:hU({x:"left"===e?h.left-t.left-6:h.right-t.left+6,y:(h.top+h.bottom)/2-t.top},t,r),dir:e};return hz(n.point)?n:{point:{x:0,y:0},dir:e}}let b={point:hU({x:(h.left+h.right)/2-t.left,y:h.top-t.top-12},t,r),dir:"up"},m={point:hU({x:(p.left+p.right)/2-t.left,y:p.bottom-t.top+6},t,r),dir:"down"},g=hz(b.point),y=hz(m.point);return g||y?g?y?b.point.y>window.innerHeight-m.point.y?b:m:b:m:{point:{x:0,y:0}}},hq=(e,t,r,n,i)=>{let a={x:0,y:0};return"up"===e.dir?(a.x=e.point.x-r/2,a.y=e.point.y-n):"down"===e.dir?(a.x=e.point.x-r/2,a.y=e.point.y+6):"left"===e.dir?(a.x=e.point.x-r,a.y=e.point.y-n/2):"right"===e.dir&&(a.x=e.point.x+6,a.y=e.point.y-n/2),a.x<i&&(a.x=i),a.y<i&&(a.y=i),a.x+r>t.right-t.left-i&&(a.x=t.right-t.left-i-r),a.y+n>t.bottom-t.top-i&&(a.y=t.bottom-t.top-i-n),{point:a,dir:e.dir}},hV=(e,t=[])=>{let r,n=e.cloneRange().cloneContents(),i=document.createTreeWalker(n,NodeFilter.SHOW_TEXT,{acceptNode:e=>{let r=e.parentElement;return t.includes(r?.tagName.toLowerCase()||"")?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT}}),a="";for(;r=i.nextNode();)a+=r.nodeValue??"";return a};var hW=M,hK=eG,hG=tW,hX=j,hY=Y,hZ=t,hJ=c,hQ=r,h0=t2,h1=e.i(722913);let h2=(e,t,r)=>{if(!e)return{left:"-999px",top:"-999px"};let{dir:n,point:i}=e,a=0,o=0;switch(n){case"up":a=r;break;case"down":a=-r;break;case"left":o=r;break;case"right":o=-r}return{left:`${i.x+o}px`,top:`${i.y+a}px`,borderLeft:"right"===n?"none":"left"===n?`${t}px solid`:`${t}px solid transparent`,borderRight:"left"===n?"none":"right"===n?`${t}px solid`:`${t}px solid transparent`,borderTop:"down"===n?"none":"up"===n?`${t}px solid`:`${t}px solid transparent`,borderBottom:"up"===n?"none":"down"===n?`${t}px solid`:`${t}px solid transparent`,transform:"left"===n||"right"===n?"translateY(-50%)":"translateX(-50%)"}},h3=({width:e,height:t,minHeight:r,maxHeight:n,position:i,trianglePosition:a,children:o,className:s="",triangleClassName:l="",additionalStyle:c={},isOpen:f=!0,onDismiss:u})=>{let d=(0,hQ.useRef)(null),[h,p]=(0,hQ.useState)(i),[b,m]=(0,hQ.useState)(t||r||0);(0,h1.useKeyDownActions)({onCancel:u,elementRef:d,enabled:f});let g=(0,h0.useResponsiveSize)(10),y=window.innerHeight-2*g;a?.dir==="up"?y=a.point.y-g:a?.dir==="down"&&(y=window.innerHeight-a.point.y-g),n=Math.min(n||y,y),(0,hQ.useEffect)(()=>{if(!d.current)return;let e=new ResizeObserver(e=>{for(let t of e){let e=t.contentRect.height;if(e!==b)return void m(e)}});return e.observe(d.current),()=>{e.disconnect()}},[]),(0,hQ.useEffect)(()=>{if(!d.current)return;if(!i||!a||"up"!==i.dir)return void p(i);let e=b||d.current.offsetHeight;p({...i,point:{...i.point,y:Math.max(g,a.point.y-e)}})},[i,a,g,b]);let v=h2(a,7,0),x=h2(a,7,-1);return(0,hZ.jsxs)("div",{children:[(0,hZ.jsx)("div",{className:(0,hJ.default)("popup-triangle-outer text-base-300 absolute z-50",l),style:v}),(0,hZ.jsx)("div",{id:"popup-container",ref:d,className:(0,hJ.default)("popup-container bg-base-300 absolute z-50 rounded-lg font-sans","eink:border eink:border-base-content",a?.dir!=="up"&&"not-eink:shadow-xl",s),style:{width:`${e}px`,height:t?`${t}px`:"auto",minHeight:r?`${r}px`:"none",maxHeight:n?`${n}px`:"none",left:`${h?h.point.x:-999}px`,top:`${h?h.point.y:-999}px`,...c},children:o}),(0,hZ.jsx)("div",{className:(0,hJ.default)("popup-triangle-inner text-base-300 absolute z-50",l),style:x})]})};var h6=t,h4=c,h8=r,h5=tQ,h9=fx,h7=ei,pe=n,pt=m,pr=i,pn=o,pi=t2,pa=af;let po=e=>[{label:e("No Timeout"),value:0},{label:e("{{value}} minute",{value:1}),value:60},{label:e("{{value}} minutes",{value:3}),value:180},{label:e("{{value}} minutes",{value:5}),value:300},{label:e("{{value}} minutes",{value:10}),value:600},{label:e("{{value}} minutes",{value:20}),value:1200},{label:e("{{value}} minutes",{value:30}),value:1800},{label:e("{{value}} minutes",{value:45}),value:2700},{label:e("{{value}} hour",{value:1}),value:3600},{label:e("{{value}} hours",{value:2}),value:7200},{label:e("{{value}} hours",{value:3}),value:10800},{label:e("{{value}} hours",{value:4}),value:14400},{label:e("{{value}} hours",{value:6}),value:21600},{label:e("{{value}} hours",{value:8}),value:28800}],ps=e=>{let t=Date.now();if(e>t){let r=Math.floor((e-t)/1e3),n=60*Math.floor(r/3600)+Math.floor(r%3600/60),i=r%60;return`${n}:${i<10?"0":""}${i}`}return""},pl=({bookKey:e,ttsLang:t,isPlaying:r,timeoutOption:n,timeoutTimestamp:i,onTogglePlay:a,onBackward:o,onForward:s,onSetRate:l,onGetVoices:c,onSetVoice:f,onGetVoiceId:u,onSelectTimeout:d,onToogleTTSBar:h})=>{let p=(0,pr.useTranslation)(),{envConfig:b}=(0,pe.useEnv)(),{getViewSettings:m,setViewSettings:g}=(0,pt.useReaderStore)(),{settings:y,setSettings:v,saveSettings:x}=(0,pn.useSettingsStore)(),w=m(e),[S,k]=(0,h8.useState)([]),[_,E]=(0,h8.useState)(w?.ttsRate??1),[M,N]=(0,h8.useState)(w?.ttsVoice??""),[A,T]=(0,h8.useState)(()=>ps(i)),R=(0,pi.useDefaultIconSize)(),C=(0,pi.useResponsiveSize)(32),j=(0,pi.useResponsiveSize)(48),I=t=>{let r=parseFloat(t.target.value);E(r=Math.max(.2,Math.min(3,r))),l(r);let n=m(e);n.ttsRate=r,y.globalViewSettings.ttsRate=r,g(e,n),v(y),x(b,y)},L=(t,r)=>{f(t,r),N(t);let n=m(e);n.ttsVoice=t,g(e,n)},P=t=>{let r=Date.now();t>0&&t<r?(d(e,0),T("")):t>0&&T(ps(t))};(0,h8.useEffect)(()=>{setTimeout(()=>{P(i)},1e3)},[i,A]),(0,h8.useEffect)(()=>{N(u())},[]),(0,h8.useEffect)(()=>{(async()=>{let e=await c(t),r=e.reduce((e,t)=>e+t.voices.length,0);e&&0!==r?k(e):(console.warn("No voices found for TTSPanel"),k([{id:"no-voices",name:p("Voices for {{lang}}",{lang:(0,pa.getLanguageName)(t)}),voices:[]}]))})()},[t]);let B=po(p);return(0,h6.jsxs)("div",{className:"flex w-full flex-col items-center justify-center gap-2 rounded-2xl px-4 pt-4 sm:gap-1",children:[(0,h6.jsxs)("div",{className:"flex w-full flex-col items-center gap-0.5",children:[(0,h6.jsx)("input",{className:"range",type:"range",min:0,max:3,step:"0.1",value:_,onChange:I}),(0,h6.jsxs)("div",{className:"grid w-full grid-cols-7 text-xs",children:[(0,h6.jsx)("span",{className:"text-center",children:"|"}),(0,h6.jsx)("span",{className:"text-center",children:"|"}),(0,h6.jsx)("span",{className:"text-center",children:"|"}),(0,h6.jsx)("span",{className:"text-center",children:"|"}),(0,h6.jsx)("span",{className:"text-center",children:"|"}),(0,h6.jsx)("span",{className:"text-center",children:"|"}),(0,h6.jsx)("span",{className:"text-center",children:"|"})]}),(0,h6.jsxs)("div",{className:"grid w-full grid-cols-7 text-xs",children:[(0,h6.jsx)("span",{className:"text-center",children:p("Slow")}),(0,h6.jsx)("span",{className:"text-center"}),(0,h6.jsx)("span",{className:"text-center",children:"1.0"}),(0,h6.jsx)("span",{className:"text-center",children:"1.5"}),(0,h6.jsx)("span",{className:"text-center",children:"2.0"}),(0,h6.jsx)("span",{className:"text-center"}),(0,h6.jsx)("span",{className:"text-center",children:p("Fast")})]})]}),(0,h6.jsxs)("div",{className:"flex items-center justify-between space-x-2",children:[(0,h6.jsx)("button",{onClick:()=>o(),className:"rounded-full p-1 transition-transform duration-200 hover:scale-105",title:p("Previous Paragraph"),"aria-label":p("Previous Paragraph"),children:(0,h6.jsx)(h5.MdFastRewind,{size:C})}),(0,h6.jsx)("button",{onClick:a,className:"rounded-full p-1 transition-transform duration-200 hover:scale-105",title:r?p("Pause"):p("Play"),"aria-label":r?p("Pause"):p("Play"),children:r?(0,h6.jsx)(h5.MdPauseCircle,{size:j,className:"fill-primary"}):(0,h6.jsx)(h5.MdPlayCircle,{size:j,className:"fill-primary"})}),(0,h6.jsx)("button",{onClick:()=>s(),className:"rounded-full p-1 transition-transform duration-200 hover:scale-105",title:p("Next Paragraph"),"aria-label":p("Next Paragraph"),children:(0,h6.jsx)(h5.MdFastForward,{size:C})}),(0,h6.jsxs)("div",{className:"dropdown dropdown-top",children:[(0,h6.jsxs)("button",{tabIndex:0,className:"flex flex-col items-center justify-center rounded-full p-1 transition-transform duration-200 hover:scale-105",onClick:e=>e.currentTarget.focus(),title:p("Set Timeout"),"aria-label":p("Set Timeout"),children:[(0,h6.jsx)(h5.MdAlarm,{size:C}),A&&(0,h6.jsx)("span",{className:(0,h4.default)("absolute bottom-0 left-1/2 w-12 translate-x-[-50%] translate-y-[80%] px-1","bg-primary/80 text-base-100 rounded-full text-center text-xs"),children:A})]}),(0,h6.jsx)("ul",{tabIndex:0,className:(0,h4.default)("dropdown-content bgcolor-base-200 no-triangle menu menu-vertical rounded-box absolute right-0 z-[1] shadow","mt-4 inline max-h-96 w-[200px] overflow-y-scroll"),children:B.map((t,r)=>(0,h6.jsx)("li",{onClick:()=>d(e,t.value),children:(0,h6.jsxs)("div",{className:"flex items-center px-2",children:[(0,h6.jsx)("span",{style:{width:`${R}px`,height:`${R}px`},children:n===t.value&&(0,h6.jsx)(h5.MdCheck,{className:"text-base-content"})}),(0,h6.jsx)("span",{className:(0,h4.default)("text-base sm:text-sm"),children:t.label})]})},`${r}-${t.value}`))})]}),(0,h6.jsxs)("div",{className:"dropdown dropdown-top",children:[(0,h6.jsx)("button",{tabIndex:0,className:"rounded-full p-1 transition-transform duration-200 hover:scale-105",onClick:e=>e.currentTarget.focus(),children:(0,h6.jsx)(h7.RiVoiceAiFill,{size:C})}),(0,h6.jsx)("ul",{tabIndex:0,className:(0,h4.default)("dropdown-content bgcolor-base-200 no-triangle menu menu-vertical rounded-box absolute right-0 z-[1] shadow","mt-4 inline max-h-96 w-[250px] overflow-y-scroll"),title:p("Select Voice"),"aria-label":p("Select Voice"),children:S.map((e,t)=>(0,h6.jsxs)("div",{className:"",children:[(0,h6.jsxs)("div",{className:"flex items-center gap-2 px-2 py-1",children:[(0,h6.jsx)("span",{style:{width:`${R}px`,height:`${R}px`}}),(0,h6.jsx)("span",{className:"text-sm text-gray-400 sm:text-xs",children:p("{{engine}}: {{count}} voices",{engine:p(e.name),count:e.voices.length})})]}),e.voices.map((r,n)=>(0,h6.jsx)("li",{onClick:()=>!r.disabled&&L(r.id,r.lang),children:(0,h6.jsxs)("div",{className:"flex items-center px-2",children:[(0,h6.jsx)("span",{style:{width:`${R}px`,height:`${R}px`},children:M===r.id&&(0,h6.jsx)(h5.MdCheck,{className:"text-base-content"})}),(0,h6.jsx)("span",{className:(0,h4.default)("max-w-[180px] overflow-hidden text-ellipsis text-base sm:text-sm",r.disabled&&"text-gray-400"),children:p(r.name)})]})},`${t}-${e.id}-${n}`))]},e.id))})]})]}),(0,h6.jsx)("div",{className:"flex h-4 items-center justify-center opacity-60 transition-transform duration-200 hover:scale-105 hover:opacity-100",children:(0,h6.jsx)("button",{onClick:h,className:"p-0",title:p("Toggle Sticky Bottom TTS Bar"),"aria-label":p("Toggle Sticky Bottom TTS Bar"),children:w?.showTTSBar?(0,h6.jsx)(h9.TbChevronCompactUp,{size:j,style:{transform:"scaleY(0.85)"}}):(0,h6.jsx)(h9.TbChevronCompactDown,{size:j,style:{transform:"scaleY(0.85)"}})})})]})};var pc=t,pf=c;let pu=({isPlaying:e,ttsInited:t,onClick:r})=>{let n=[1,2,3,4];return(0,pc.jsxs)("button",{className:(0,pf.default)("relative h-full w-full rounded-full",t?"cursor-pointer":"cursor-not-allowed"),style:{maskImage:"radial-gradient(circle, white 100%, transparent 100%)",WebkitMaskImage:"radial-gradient(circle, white 100%, transparent 100%)"},onClick:r,children:[(0,pc.jsx)("div",{className:"absolute inset-0 overflow-hidden rounded-full bg-gradient-to-r from-blue-500 via-emerald-500 to-violet-500",children:(0,pc.jsx)("div",{className:"absolute -inset-full rounded-full bg-gradient-to-r from-blue-500 via-emerald-500 to-violet-500",style:{animation:e&&t?"moveGradient 2s alternate infinite":"none"}})}),(0,pc.jsxs)("div",{className:"absolute inset-0 flex items-center justify-center",children:[(0,pc.jsx)("style",{children:`
          @keyframes moveGradient {
            0% { transform: translate(0, 0); }
            100% { transform: translate(25%, 25%); }
          }
          @keyframes bounce {
            0%, 100% { transform: scaleY(1); }
            50% { transform: scaleY(0.6); }
          }
        `}),(0,pc.jsx)("div",{className:"flex items-end space-x-1",children:n.map(t=>(0,pc.jsx)("div",{className:"w-1 rounded-t bg-white",style:{height:"16px",animationName:e?"bounce":"none",animationDuration:e?`${1+.1*t}s`:"0s",animationTimingFunction:"ease-in-out",animationIterationCount:"infinite",animationDelay:`${.1*t}s`}},t))})]})]})};var pd=t,ph=c,pp=tQ,pb=n,pm=m,pg=t2,py=i;let pv=({bookKey:e,isPlaying:t,onTogglePlay:r,onBackward:n,onForward:i,gridInsets:a})=>{let o=(0,py.useTranslation)(),{appService:s}=(0,pb.useEnv)(),{hoveredBookKey:l,setHoveredBookKey:c}=(0,pm.useReaderStore)(),f=(0,pg.useResponsiveSize)(30),u=(0,pg.useResponsiveSize)(36),d=l!==e;return(0,pd.jsx)("div",{className:(0,ph.default)("bg-base-100 absolute bottom-0 z-40","inset-x-0 mx-auto flex w-full justify-center sm:w-fit","transition-opacity duration-300",d?"pointer-events-auto opacity-100":"pointer-events-none opacity-0"),style:{paddingBottom:s?.hasSafeAreaInset?`${.33*a.bottom}px`:0},onMouseEnter:()=>!s?.isMobile&&c(""),onTouchStart:()=>!s?.isMobile&&c(""),children:(0,pd.jsxs)("div",{className:"text-base-content flex h-[52px] items-center space-x-2 px-2",children:[(0,pd.jsx)("button",{onClick:n.bind(null,!1),className:"rounded-full p-1 transition-transform duration-200 hover:scale-105",title:o("Previous Paragraph"),"aria-label":o("Previous Paragraph"),children:(0,pd.jsx)(pp.MdFastRewind,{size:f})}),(0,pd.jsx)("button",{onClick:n.bind(null,!0),className:"rounded-full p-1 transition-transform duration-200 hover:scale-105",title:o("Previous Sentence"),"aria-label":o("Previous Sentence"),children:(0,pd.jsx)(pp.MdSkipPrevious,{size:f})}),(0,pd.jsx)("button",{onClick:r,className:"rounded-full p-1 transition-transform duration-200 hover:scale-105",title:o(t?"Pause":"Play"),"aria-label":o(t?"Pause":"Play"),children:t?(0,pd.jsx)(pp.MdOutlinePause,{size:u}):(0,pd.jsx)(pp.MdPlayArrow,{size:u})}),(0,pd.jsx)("button",{onClick:i.bind(null,!0),className:"rounded-full p-1 transition-transform duration-200 hover:scale-105",title:o("Next Sentence"),"aria-label":o("Next Sentence"),children:(0,pd.jsx)(pp.MdSkipNext,{size:f})}),(0,pd.jsx)("button",{onClick:i.bind(null,!1),className:"rounded-full p-1 transition-transform duration-200 hover:scale-105",title:o("Next Paragraph"),"aria-label":o("Next Paragraph"),children:(0,pd.jsx)(pp.MdFastForward,{size:f})})]})})},px=282,pw=160,pS=10,pk=({bookKey:e,gridInsets:t})=>{let r=(0,d0.useTranslation)(),{appService:n}=(0,dG.useEnv)(),{user:i}=(0,dX.useAuth)(),{safeAreaInsets:a,isDarkMode:o}=(0,dY.useThemeStore)(),{settings:s}=(0,dZ.useSettingsStore)(),{getBookData:l}=(0,dJ.useBookDataStore)(),{hoveredBookKey:c,getView:f,getProgress:u,getViewSettings:d}=(0,dQ.useReaderStore)(),{setViewSettings:h,setTTSEnabled:p}=(0,dQ.useReaderStore)(),{getMergedRules:b}=em(),m=d(e),[g,y]=(0,dK.useState)("en"),[v,x]=(0,dK.useState)(!1),[w,S]=(0,dK.useState)(!1),[k,_]=(0,dK.useState)(!1),[E,M]=(0,dK.useState)(!1),[N,A]=(0,dK.useState)(()=>!!m?.showTTSBar),[T,R]=(0,dK.useState)(),[C,j]=(0,dK.useState)(),[I,L]=(0,dK.useState)(0),[P,B]=(0,dK.useState)(0),[O,D]=(0,dK.useState)(null),z=(0,dK.useRef)(null),[F,U]=(0,dK.useState)(!0),$=(0,d1.useResponsiveSize)(pS),H=Math.min(window.innerWidth-2*$,(0,d1.useResponsiveSize)(px)),q=(0,d1.useResponsiveSize)(pw),V=(0,dK.useRef)(null),W=(0,dK.useRef)(null),K=(0,dK.useRef)(null),G=(0,dK.useRef)(null),[X,Y]=(0,dK.useState)(null),[Z,J]=(0,dK.useState)(!1),Q=()=>{W.current||(W.current=document.createElement("audio"),W.current.setAttribute("x-webkit-airplay","deny"),W.current.addEventListener("play",()=>{"mediaSession"in navigator&&(navigator.mediaSession.metadata=null)}),W.current.preload="auto",W.current.loop=!0,W.current.src=d7,W.current.play())},ee=()=>{if(W.current)try{W.current.pause(),W.current.currentTime=0,W.current.removeAttribute("src"),W.current.src="",W.current.load(),W.current=null,console.log("Unblock audio released")}catch(e){console.warn("Error releasing unblock audio:",e)}},et=async()=>{let t=hO();if(t&&(G.current=t,t instanceof hB)){let n=l(e),i=u(e);if(!n||!n.book)return;let{title:a,author:o,coverImageUrl:c}=n.book,{sectionLabel:f}=i||{},d="/icon.png";try{d=await e0(c||"/icon.png")}catch{d=await e0("/icon.png")}await t.setActive({active:!0,keepAppInForeground:s.alwaysInForeground,notificationTitle:r("Read Aloud"),notificationText:r("Ready to read aloud"),foregroundServiceTitle:r("Read Aloud"),foregroundServiceText:r("Ready to read aloud")}),t.updateMetadata({title:a,artist:f||a,album:o,artwork:d})}},er=async()=>{G.current&&G.current instanceof hB&&await G.current.setActive({active:!1,keepAppInForeground:s.alwaysInForeground}),G.current=null};(0,dK.useEffect)(()=>()=>{K.current&&(K.current.shutdown(),K.current=null)},[]),(0,dK.useEffect)(()=>(hW.eventDispatcher.on("tts-speak",es),hW.eventDispatcher.on("tts-stop",el),()=>{hW.eventDispatcher.off("tts-speak",es),hW.eventDispatcher.off("tts-stop",el)}),[]),(0,dK.useEffect)(()=>{if(!X||!e)return;let t=l(e);if(!t||!t.book)return;let{title:n,author:i,coverImageUrl:a}=t.book,o=()=>{hW.eventDispatcher.dispatch("toast",{message:r("Please log in to use advanced TTS features"),type:"error",timeout:5e3})},s=t=>{let{sectionLabel:r}=u(e)||{},o=t.detail;if(G.current){let e=G.current;e instanceof hB?e.updateMetadata({title:o?.text||"",artist:r||n,album:i,artwork:""}):e.metadata=new MediaMetadata({title:o?.text||"",artist:r||n,album:i,artwork:[{src:a||"/icon.png",sizes:"512x512",type:"image/png"}]})}},c=t=>{let r=t.detail,n=f(e),i=u(e),a=d(e);if(!r||!n||!i||!a)return;let{location:o}=i,{index:s}=n.resolveCFI(o),l=n?.getCFI(s,r);if(l&&(a.ttsLocation=l||"",h(e,a)),!n.renderer.getContents().some(({doc:e})=>(e.getSelection()?.toString().length??0)>0))if(n.renderer.scrolled){let e=r.getBoundingClientRect(),{start:t,size:i,viewSize:o,sideProp:s}=n.renderer,l=e["height"===s?"y":"x"]+a.marginTopPx,c=e["height"===s?"height":"width"]+l,f="rtl"===n.book.dir?o-l:l,u="rtl"===n.book.dir?o-c:c,d=a.showHeader,h=a.showFooter,p=a.showBarsOnScroll,b=d&&p?44:0,m=h&&p?44:0,g=a.scrollingOverlap,y=u>t+i-m-g,v=f<t+b+g;if(y||v){let e=f-b-g;n.renderer.scrollToAnchor(e/o)}}else n.renderer.scrollToAnchor(r)};return X.addEventListener("tts-need-auth",o),X.addEventListener("tts-speak-mark",s),X.addEventListener("tts-highlight-mark",c),()=>{X.removeEventListener("tts-need-auth",o),X.removeEventListener("tts-speak-mark",s),X.removeEventListener("tts-highlight-mark",c)}},[X,e]);let en=(0,dK.useCallback)(()=>{let t=m?.ttsReadAloudText;if(m?.translationEnabled&&"translated"===t)return m?.translateTargetLang||(0,hY.getLocale)();if(m?.translationEnabled&&"source"===t){let t=l(e);return t?.book?.primaryLanguage||""}return null},[e,l,m?.translationEnabled,m?.ttsReadAloudText,m?.translateTargetLang]);(0,dK.useEffect)(()=>{K.current?.setTargetLang(en()||"")},[en]);let ei=(0,dK.useMemo)(()=>({bookKey:e,viewSettings:d(e),userLocale:(0,hY.getLocale)(),content:"",transformers:[],reversePunctuationTransform:!0}),[]),ea=(0,dK.useCallback)(async t=>{let r=b(e),n=d(e);return 0===r.filter(e=>e.enabled&&e.onlyForTTS&&("book"===e.scope||"library"===e.scope)).length?t:(ei.content=t,ei.viewSettings=n,t=await cS.transform(ei,{docType:"text/xml",onlyForTTS:!0}))},[e,b,d,ei]),eo=(0,dK.useCallback)((e,t)=>{let r=o?"#000000":"#ffffff",n=t?r:e.color;return{...e,color:n}},[o]);(0,dK.useEffect)(()=>{let e=m?.ttsHighlightOptions;K.current&&e&&K.current.initViewTTS(eo(e,m.isEink))},[m?.ttsHighlightOptions,m?.isEink,eo]);let es=async t=>{let{bookKey:a,range:o,oneTime:s=!1}=t.detail;if(e!==a)return;let c=f(e),h=u(e),b=d(e),m=l(e);if(!c||!h||!b||!m||!m.book)return;if(m.book?.format==="PDF")return void hW.eventDispatcher.dispatch("toast",{message:r("TTS not supported for PDF"),type:"warning"});let g=o;if(!g&&b.ttsLocation){let{location:e}=h,t=b.ttsLocation;if(ik(t,e)){let{index:e,anchor:r}=c.resolveCFI(t),{doc:n}=c.renderer.getContents().find(t=>t.index===e)||{};n&&(g=r(n))}}g||(g=h.range);let v=m.book.primaryLanguage;K.current&&(K.current.stop(),K.current=null);try{n?.isIOSApp&&await (0,hX.invokeUseBackgroundAudio)({enabled:!0}),n?.isMobile&&Q(),await et(),J(!1),s||_(!0);let t=new hj(n,c,!!i?.id,ea);K.current=t,Y(t),await t.init(),await t.initViewTTS(eo(b.ttsHighlightOptions,b.isEink));let r=c.tts?.from(g);if(r){let e=d8(r,v)||"en";x(!0),y(e),t.setLang(e),t.setRate(b.ttsRate),t.speak(r,s),t.setTargetLang(en()||"")}J(!0),p(e,!0)}catch(e){hW.eventDispatcher.dispatch("toast",{message:r("TTS not supported for this document"),type:"error"}),console.error(e)}},el=async t=>{let{bookKey:r}=t.detail;K.current&&e===r&&eh(e)},ec=(0,dK.useCallback)(async()=>{let e=K.current;if(e&&(v?(x(!1),S(!0),await e.pause()):w&&(x(!0),S(!1),"paused"===e.state?await e.resume():await e.start()),G.current)){let e=G.current;e instanceof hB?await e.updatePlaybackState({playing:!v}):e.playbackState=v?"paused":"playing"}},[v,w]),ef=(0,dK.useCallback)(async(e=!1)=>{let t=K.current;t&&await t.backward(e)},[]),eu=(0,dK.useCallback)(async(e=!1)=>{let t=K.current;t&&await t.forward(e)},[]),ed=(0,dK.useCallback)(async()=>{let e=K.current;e&&(x(!1),S(!0),await e.pause())},[]),eh=(0,dK.useCallback)(async e=>{let t=K.current;t&&(await t.shutdown(),K.current=null,Y(null),f(e)?.deselect(),x(!1),M(!1),_(!1)),n?.isIOSApp&&await (0,hX.invokeUseBackgroundAudio)({enabled:!1}),n?.isMobile&&ee(),await er(),p(e,!1)},[n]),ep=(0,dK.useCallback)((0,hK.throttle)(async e=>{let t=K.current;t&&("playing"===t.state?(await t.stop(),await t.setRate(e),await t.start()):await t.setRate(e))},3e3),[]),eb=(0,dK.useCallback)((0,hK.throttle)(async(e,t)=>{let r=K.current;r&&("playing"===r.state?(await r.stop(),await r.setVoice(e,t),await r.start()):await r.setVoice(e,t))},3e3),[]),eg=async e=>{let t=K.current;return t?t.getVoices(e):[]},ey=()=>{let e=K.current;return e?e.getVoiceId():""},ev=(e,t)=>{L(t),O&&clearTimeout(O),t>0?(D(setTimeout(()=>{eh(e)},1e3*t)),B(Date.now()+1e3*t)):B(0)},ex=()=>{let t=d(e);t.showTTSBar=!t.showTTSBar,A(t.showTTSBar),t.showTTSBar&&M(!1),h(e,t)},ew=()=>{if(V.current){let e=V.current.getBoundingClientRect(),t=V.current.parentElement?.getBoundingClientRect()||document.documentElement.getBoundingClientRect(),r={dir:"up",point:{x:e.left+e.width/2-t.left,y:e.top-12}};R(hq(r,t,H,q,$)),j(r)}},eS=()=>{ew(),!E&&K.current&&y(K.current.getSpeakingLang()||g),M(e=>!e)},ek=()=>{M(!1)};return(0,dK.useEffect)(()=>{let{current:e}=G;e&&(e.setActionHandler("play",()=>{ec()}),e.setActionHandler("pause",()=>{ec()}),e.setActionHandler("stop",()=>{ed()}),e.setActionHandler("seekforward",()=>{eu(!0)}),e.setActionHandler("seekbackward",()=>{ef(!0)}),e.setActionHandler("nexttrack",()=>{eu()}),e.setActionHandler("previoustrack",()=>{ef()}))},[ec,ed,eu,ef]),(0,dK.useEffect)(()=>{if(!V.current||!E)return;let e=V.current.parentElement;if(!e)return;let t=new ResizeObserver(()=>{ew()});return t.observe(e),()=>{t.disconnect()}},[E]),(0,dK.useEffect)(()=>(c?(z.current&&(clearTimeout(z.current),z.current=null),z.current=setTimeout(()=>{U(!0)},100)):(z.current&&(clearTimeout(z.current),z.current=null),z.current=setTimeout(()=>{U(!1)},5e3)),()=>{z.current&&clearTimeout(z.current)}),[c]),(0,dV.jsxs)(dV.Fragment,{children:[E&&(0,dV.jsx)(hG.Overlay,{onDismiss:ek}),(E||k&&F)&&(0,dV.jsx)("div",{ref:V,className:(0,dW.default)("absolute h-12 w-12","transition-transform duration-300",m?.rtl?"left-8":"right-6",!n?.hasSafeAreaInset&&"bottom-[70px] sm:bottom-14"),style:{bottom:n?.hasSafeAreaInset?`${.33*(a?.bottom||0)+(c?70:52)}px`:void 0},children:(0,dV.jsx)(pu,{isPlaying:v,ttsInited:Z,onClick:eS})}),E&&T&&C&&Z&&(0,dV.jsx)(h3,{width:H,height:q,position:T,trianglePosition:C,className:"bg-base-200 flex shadow-lg",onDismiss:ek,children:(0,dV.jsx)(pl,{bookKey:e,ttsLang:g,isPlaying:v,timeoutOption:I,timeoutTimestamp:P,onTogglePlay:ec,onBackward:ef,onForward:eu,onSetRate:ep,onGetVoices:eg,onSetVoice:eb,onGetVoiceId:ey,onSelectTimeout:ev,onToogleTTSBar:ex})}),k&&N&&Z&&(0,dV.jsx)(pv,{bookKey:e,isPlaying:v,onBackward:ef,onTogglePlay:ec,onForward:eu,gridInsets:t})]})},p_=({bookKey:e,bookFormat:t,section:r,pageinfo:n,isHoveredAnim:i,gridInsets:a})=>{let o=(0,uC.useTranslation)(),{appService:s}=(0,uA.useEnv)(),{getConfig:l,setConfig:c,getBookData:f}=(0,uR.useBookDataStore)(),{hoveredBookKey:u,setHoveredBookKey:d}=(0,uT.useReaderStore)(),{getView:h,getViewState:p,getProgress:b,getViewSettings:m}=(0,uT.useReaderStore)(),{isSideBarVisible:g,setSideBarVisible:y}=x(),{acquireBackKeyInterception:v,releaseBackKeyInterception:w}=(0,uj.useDeviceControlStore)(),S=h(e),k=l(e),_=f(e),E=p(e),M=b(e),N=m(e),[A,T]=(0,uN.useState)(""),R=u===e?A:"",C=u===e,j=(S?.renderer.getContents()??[]).some(({doc:e})=>e?.body?.style.cursor==="pointer"),I=(0,uN.useMemo)(()=>"PDF"===t?r:n,[t,r,n]),L=!!I&&I.total>0&&I.current>=0,P=(0,uN.useMemo)(()=>L&&I.total>0&&I.current>=0?(I.current+1)/I.total:0,[L,I]),B=(0,uN.useMemo)(()=>(0,uL.debounce)(e=>{S?.goToFraction(e/100)},100),[S]),O=(0,uN.useCallback)(()=>{tN(S,N,"left","page")},[S,N]),D=(0,uN.useCallback)(()=>{tN(S,N,"right","page")},[S,N]),z=(0,uN.useCallback)(()=>{S?.renderer.prevSection?.()},[S]),F=(0,uN.useCallback)(()=>{S?.renderer.nextSection?.()},[S]),U=(0,uN.useCallback)(()=>{S?.history.back()},[S]),$=(0,uN.useCallback)(()=>{S?.history.forward()},[S]),H=(0,uN.useCallback)(async()=>{if(!S||!M||!E)return;let t=E.ttsEnabled?"tts-stop":"tts-speak";uI.eventDispatcher.dispatch(t,{bookKey:e})},[S,M,E,e]),q=(0,uN.useCallback)(t=>{T(e=>e===t?"":t),"tts"===t?(E?.ttsEnabled&&d(""),H()):"toc"===t?(d(""),k?.viewSettings&&c(e,{viewSettings:{...k.viewSettings,sideBarTab:"toc"}}),y(!0)):"note"===t&&(d(""),y(!0),k?.viewSettings&&c(e,{viewSettings:{...k.viewSettings,sideBarTab:"annotations"}}))},[k,e,E?.ttsEnabled,c,y,d,H]),V=(0,uN.useMemo)(()=>({onPrevPage:O,onNextPage:D,onPrevSection:z,onNextSection:F,onGoBack:U,onGoForward:$,onProgressChange:B}),[O,D,z,F,U,$,B]),W=(0,uN.useCallback)(e=>{if(e instanceof CustomEvent){if("Back"===e.detail.keyName)return d(""),!0}else"Escape"===e.key&&d(""),e.stopPropagation();return!1},[d]);(0,uN.useEffect)(()=>{if(s?.isAndroidApp)return u&&(v(),uI.eventDispatcher.onSync("native-key-down",W)),()=>{u&&(w(),uI.eventDispatcher.offSync("native-key-down",W))}},[u]);let K={bookKey:e,gridInsets:a,actionTab:R,progressValid:L,progressFraction:P,navigationHandlers:V,onSetActionTab:q,onSpeakText:H},G=N?.vertical&&N?.scrolled||_?.isFixedLayout&&N?.zoomLevel&&N.zoomLevel>100,X=(0,uM.default)("footer-bar shadow-xs bottom-0 z-10 flex w-full flex-col","sm:h-[52px] sm:justify-center","sm:bg-base-100 border-base-300/50 border-t sm:border-none","transition-[opacity,transform] duration-300",window.innerWidth<640?"fixed":"absolute",s?.hasRoundedWindow&&"rounded-window-bottom-right",!g&&s?.hasRoundedWindow&&"rounded-window-bottom-left",i&&"hover-bar-anim",G&&"sm:!bottom-3 sm:!h-10 sm:justify-end",C?"pointer-events-auto translate-y-0 opacity-100":"pointer-events-none translate-y-full opacity-0 sm:translate-y-0"),Y=s?.isMobile||window.innerWidth<640;return(0,uE.jsxs)(uE.Fragment,{children:[(0,uE.jsx)("div",{role:"none",className:(0,uM.default)("absolute bottom-0 left-0 z-10 flex h-[52px] w-full",G&&"sm:!bottom-3 sm:!h-7",Y||j?"pointer-events-none":""),onMouseEnter:()=>!Y&&d(e),onTouchStart:()=>!Y&&d(e)}),(0,uE.jsxs)("div",{role:"group","aria-label":o("Footer Bar"),className:X,dir:N?.rtl?"rtl":"ltr",onFocus:()=>!s?.isMobile&&d(e),onMouseLeave:()=>window.innerWidth>=640&&d(""),children:[(0,uE.jsx)(dI,{...K}),(0,uE.jsx)(dq,{...K})]}),C&&G&&(0,uE.jsx)("div",{className:"bg-base-100 pointer-events-none absolute bottom-0 left-0 hidden h-3 w-full sm:block"}),(0,uE.jsx)(pk,{bookKey:e,gridInsets:a})]})};var pE=t,pM=c,pN=r,pA=n,pT=m,pR=i,pC=ec,pj=ru;let pI=({bookKey:e,section:t,pageinfo:r,timeinfo:n,horizontalGap:i,contentInsets:a,gridInsets:o})=>{let s=(0,pR.useTranslation)(),{envConfig:l,appService:c}=(0,pA.useEnv)(),{getBookData:f}=(0,pC.useBookDataStore)(),{getView:u,getViewSettings:d}=(0,pT.useReaderStore)(),h=u(e),p=f(e),b=d(e),m=b.vertical&&b.doubleBorder,g=b.scrolled,y=b.vertical,v=b.isEink,{progressStyle:x}=b,w="fraction"===x?y?"{current}  {total}":"{current} / {total}":"{percent}%",S=localStorage?.getItem("i18nextLng")||"",k=y&&S.toLowerCase().startsWith("zh"),_=p?.isFixedLayout?t:r,E=d$(_?.current,_?.total,w,k,S),M=n?s("{{time}} min left in chapter",{time:dH(Math.round(n.section),k,S)}):"",{page:N=0,pages:A=0}=h?.renderer||{},T=A-1>N?k?s("{{number}} pages left in chapter",{number:dH(A-N-1,k,S)}):s("{{count}} pages left in chapter",{count:A-N-1}):"",[R,C]=(0,pN.useState)(b.progressInfoMode),j=()=>{if(!b.tapToToggleFooter)return;let e=b.showRemainingTime||b.showRemainingPages,t=b.showProgressInfo,r=["all","remaining","progress","none"],n=r.indexOf(R);for(let i=1;i<=r.length;i++){let a=(n+i)%r.length,o=r[a],s={remaining:("all"===R||"remaining"===R)&&e,progress:("all"===R||"progress"===R)&&t},l={remaining:("all"===o||"remaining"===o)&&e,progress:("all"===o||"progress"===o)&&t};if(s.remaining!==l.remaining||s.progress!==l.progress)return void C(o)}let i=(n+1)%r.length;C(r[i])};(0,pN.useEffect)(()=>{(0,pj.saveViewSettings)(l,e,"progressInfoMode",R)},[R]);let I=c?.isMobile||window.innerWidth<640;return(0,pE.jsx)("div",{role:"presentation",className:(0,pM.default)("progressinfo absolute bottom-0 flex items-center justify-between font-sans",v?"text-sm font-normal":"text-neutral-content text-xs font-extralight",y?"writing-vertical-rl":"w-full",g&&!y&&"bg-base-100",I?"pointer-events-auto":"pointer-events-none"),onClick:()=>j(),"aria-label":[_?s("On {{current}} of {{total}} page",{current:_.current+1,total:_.total}):"",M,T].filter(Boolean).join(", "),style:y?{bottom:`${(a.bottom-o.bottom)*1.5}px`,left:m?`calc(${a.left}px)`:`calc(${Math.max(0,a.left-32)}px)`,width:m?"32px":`${a.left}px`,height:`calc(100% - ${(a.top+a.bottom)/2*3}px)`}:{paddingInlineStart:`calc(${i/2}% + ${a.left/2}px)`,paddingInlineEnd:`calc(${i/2}% + ${a.right/2}px)`,paddingBottom:c?.hasSafeAreaInset?`${.33*o.bottom}px`:0},children:(0,pE.jsxs)("div",{"aria-hidden":"true",className:(0,pM.default)("flex items-center justify-between",y?"h-full":"h-[52px] w-full"),children:[("all"===R||"remaining"===R)&&(0,pE.jsx)(pE.Fragment,{children:b.showRemainingTime?(0,pE.jsx)("span",{className:"text-start",children:M}):b.showRemainingPages?(0,pE.jsx)("span",{className:"text-start",children:T}):null}),("all"===R||"progress"===R)&&(0,pE.jsx)(pE.Fragment,{children:b.showProgressInfo&&(0,pE.jsx)("span",{className:(0,pM.default)("text-end",y?"mt-auto":"ms-auto"),children:E})})]})})};var pL=t,pP=c,pB=b;let pO=({})=>{let{safeAreaInsets:e}=(0,pB.useThemeStore)();return(0,pL.jsx)("div",{className:(0,pP.default)("ribbon absolute inset-0 z-10 flex w-8 justify-center sm:w-6"),style:{height:`${(e?.top||0)+44}px`},children:(0,pL.jsx)("svg",{width:"100%",height:"100%",preserveAspectRatio:"none",viewBox:"0 0 100 100",xmlns:"http://www.w3.org/2000/svg",shapeRendering:"geometricPrecision",imageRendering:"optimizeQuality",children:(0,pL.jsx)("polygon",{fill:"#F44336",points:"100 100, 50 78, 0 100, 0 0, 100 0"})})})};var pD=t,pz=r,pF=ei,pU=rJ,p$=hR,pH=n,pq=Y,pV=b,pW=ec,pK=o,pG=m,pX=i,pY=t2,pZ=k,pJ=r,pQ=rt,p0=sa,p1=ec,p2=e8,p3=eG;let p6=e=>{let{user:t}=(0,pQ.useAuth)(),{syncedNotes:r,syncNotes:n,lastSyncedAtNotes:i}=(0,p0.useSync)(e),{getConfig:a,setConfig:o,getBookData:s}=(0,p1.useBookDataStore)(),l=a(e),c=(0,pJ.useCallback)(()=>{let r=a(e),n=s(e)?.book;if(!r?.location||!n||!t)return{};let o=(r.booknotes??[]).filter(e=>i<e.updatedAt||i<(e.deletedAt??0));return o.forEach(e=>{e.bookHash=n.hash,e.metaHash=n.metaHash}),{notes:o,lastSyncedAt:i}},[t,e,i,a,s]),f=(0,pJ.useCallback)((0,p3.throttle)(()=>{let t=s(e)?.book;n(c().notes,t?.hash,t?.metaHash,"both")},1e3*p2.SYNC_NOTES_INTERVAL_SEC,{emitLast:!1}),[n]);(0,pJ.useEffect)(()=>{l?.location&&t&&f()},[l?.booknotes,f]),(0,pJ.useEffect)(()=>{let t=t=>{let r=a(e),n=(r?.booknotes??[]).find(e=>e.id===t.id);if(n)if(n.updatedAt<t.updatedAt||(n.deletedAt??0)<(t.deletedAt??0))return{...n,...t};else return{...t,...n};return t};if(r?.length&&l){let n=s(e)?.book,i=r.filter(e=>e.bookHash===n?.hash||e.metaHash===n?.metaHash);if(!i.length)return;o(e,{booknotes:[...(l.booknotes??[]).filter(e=>!i.some(t=>t.id===e.id)),...i.map(t)]})}},[r])};var p4=r,p8=n,p5=m,p9=Y,p7=M,be=r,bt=n,br=o,bn=ec,bi=m,ba=Y;let bo=({bookKey:e,getAnnotationText:t})=>{let{envConfig:r}=(0,bt.useEnv)(),{settings:n}=(0,br.useSettingsStore)(),{getConfig:i,saveConfig:a,updateBooknotes:o}=(0,bn.useBookDataStore)(),{getView:s,getViewsById:l,getViewSettings:c}=(0,bi.useReaderStore)(),f=(0,be.useRef)(null),u=(0,be.useRef)(null),d=(0,be.useRef)(0),h=(0,be.useRef)(null),p=(0,be.useRef)((0,ba.uniqueId)()),b=(0,be.useCallback)(()=>{let t=c(e);return t?.enableAnnotationQuickActions&&t?.annotationQuickAction==="highlight"},[e,c]),m=(0,be.useCallback)(()=>{h.current&&(l(e.split("-")[0]).forEach(e=>e?.addAnnotation(h.current,!0)),h.current=null)},[e,l]),g=(0,be.useCallback)((e,t,r)=>{if(e.caretPositionFromPoint){let n=e.caretPositionFromPoint(t,r);if(n)return{node:n.offsetNode,offset:n.offset}}if(e.caretRangeFromPoint){let n=e.caretRangeFromPoint(t,r);if(n)return{node:n.startContainer,offset:n.startOffset}}return null},[]),y=(0,be.useCallback)((e,t,r)=>{let n=g(e,t,r);if(!n||n.node.nodeType!==Node.TEXT_NODE)return!1;let i=n.node,a=i.length;if(0===a)return!1;let o=e.createRange();try{let e=Math.min(n.offset,a-1),s=Math.min(n.offset+1,a);for(let n of(o.setStart(i,e),o.setEnd(i,s),o.getClientRects())){let e=20;if(t>=n.left-e&&t<=n.right+e&&r>=n.top-e&&r<=n.bottom+e)return!0}}catch{}return!1},[g]),v=(0,be.useCallback)((e,t,r)=>{let n=g(e,t.x,t.y),i=g(e,r.x,r.y);if(!n||!i)return null;let a=e.createRange();try{if(n.node.compareDocumentPosition(i.node)&Node.DOCUMENT_POSITION_PRECEDING||n.node===i.node&&n.offset>i.offset?(a.setStart(i.node,i.offset),a.setEnd(n.node,n.offset)):(a.setStart(n.node,n.offset),a.setEnd(i.node,i.offset)),a.collapsed)return null;return a}catch(e){return console.warn("Failed to create range:",e),null}},[g]),x=(0,be.useCallback)((e,t)=>{let r=n.globalReadSettings.highlightStyle,i=n.globalReadSettings.highlightStyles[r];return{id:p.current,type:"annotation",cfi:e,style:r,color:i,text:t??"",note:"",createdAt:Date.now(),updatedAt:Date.now()}},[]),w=(0,be.useCallback)((e,t,r)=>!!b()&&0===r.button&&!!y(e,r.clientX,r.clientY)&&(f.current={x:r.clientX,y:r.clientY},u.current=e,d.current=t,h.current=null,p.current=(0,ba.uniqueId)(),!0),[b,y]),S=(0,be.useCallback)((t,r,n)=>{if(!b())return!1;let i=s(e);if(!f.current||!u.current||!i)return!1;let a={x:n.clientX,y:n.clientY},o=f.current,c=Math.abs(a.x-o.x),d=Math.abs(a.y-o.y),p=Math.sqrt(Math.pow(c,2)+Math.pow(d,2));if(p<20||c/d<5&&d/c<5&&p<30)return!1;let g=v(t,o,a);if(!g)return!1;let y=i.getCFI(r,g);if(!y)return!1;m();let w=x(y);return l(e.split("-")[0]).forEach(e=>e?.addAnnotation(w)),h.current=w,!0},[b,v]),k=(0,be.useCallback)(()=>!!b()&&(f.current=null,u.current=null,m(),!0),[b,m]),_=(0,be.useCallback)(async(c,d,h)=>{if(!b())return!1;let p=s(e);if(!f.current||!p)return f.current=null,u.current=null,m(),!1;let g={x:h.clientX,y:h.clientY},y=f.current;if(f.current=null,u.current=null,10>Math.sqrt(Math.pow(g.x-y.x,2)+Math.pow(g.y-y.y,2)))return m(),!1;let w=v(c,y,g);if(!w)return m(),!1;let S=await t(w),k=p.getCFI(d,w);if(!S||!k||0===S.trim().length)return m(),!1;m();let _=x(k,S);l(e.split("-")[0]).forEach(e=>e?.addAnnotation(_));let{booknotes:E=[]}=i(e),M=E.findIndex(e=>e.cfi===k&&"annotation"===e.type&&e.style&&!e.deletedAt);-1!==M?E[M]={...E[M],..._,id:E[M].id}:E.push(_);let N=o(e,E);return N&&a(r,e,N,n),!0},[b,v,t,m]);return{isInstantAnnotationEnabled:b,handleInstantAnnotationPointerDown:w,handleInstantAnnotationPointerMove:S,handleInstantAnnotationPointerCancel:k,handleInstantAnnotationPointerUp:_,cancelInstantAnnotation:(0,be.useCallback)(()=>{f.current=null,u.current=null,m()},[m])}},bs=(e,t,r,n)=>{let{appService:i}=(0,p8.useEnv)(),{getView:a,getViewSettings:o}=(0,p5.useReaderStore)(),s=a(e),l=(0,p9.getOSPlatform)(),c=(0,p4.useRef)(!1),f=(0,p4.useRef)(!1),u=(0,p4.useRef)(!1),d=(0,p4.useRef)(!1),h=(0,p4.useRef)(null),p=(0,p4.useRef)("mouse"),b=(0,p4.useRef)(!1),m=(0,p4.useRef)(!1),{isInstantAnnotationEnabled:g,handleInstantAnnotationPointerDown:y,handleInstantAnnotationPointerMove:v,handleInstantAnnotationPointerCancel:x,handleInstantAnnotationPointerUp:w}=bo({bookKey:e,getAnnotationText:r,setSelection:t}),S=e=>e&&e.toString().trim().length>0&&e.rangeCount>0,k=async(n,i,a=!1)=>{u.current=!0;let o=n.getRangeAt(0);a&&(n.removeAllRanges(),n.addRange(o)),t({key:e,text:await r(o),cfi:s?.getCFI(i,o),range:o,index:i})},_=async(n,i)=>{u.current=!0;let a=n.getRangeAt(0);setTimeout(()=>{n.removeAllRanges(),setTimeout(async()=>{u.current&&(n.addRange(a),t({key:e,text:await r(a),cfi:s?.getCFI(i,a),range:a,index:i}))},30)},30)},E=e=>{b.current=!0,m.current=!1,s&&(s.renderer.scrollLocked=!0),e.target.style.userSelect="none"},M=e=>{b.current=!1,m.current=!1,s&&(s.renderer.scrollLocked=!1),e.target.style.userSelect=""},N=(e,t,r)=>{p.current=r.pointerType,g()&&y(e,t,r)&&(r.preventDefault(),E(r))},A=(e,t,r)=>{b.current&&(r.preventDefault(),m.current=v(e,t,r))},T=(e,t,r)=>{b.current&&(M(r),x())},R=async(e,t,r)=>{if(b.current&&r){if(M(r),await w(e,t,r)){u.current=!0;return}r.target?.dispatchEvent(new MouseEvent("mousedown",{...r,bubbles:!0,cancelable:!0}))}let n=e.getSelection();if(S(n)){let e=r&&h$(n,r),a="ios"===l||i?.isIOSApp;e&&a?_(n,t):e&&(f.current=!0,k(n,t,!0))}},C=()=>{d.current=!0},j=e=>{b.current&&m.current&&e.preventDefault()},I=()=>{d.current=!1},L=(e,t)=>{if("android"!==l||!i?.isAndroidApp)return;let r=e.getSelection();S(r)?(h.current||(h.current=s?.renderer?.start||null),k(r,t,!1)):h.current=null},P=()=>{if("android"!==l||!i?.isAndroidApp)return;let t=o(e);!t?.scrolled&&u.current&&s?.renderer?.containerPosition&&h.current&&(console.warn("Keep container position",h.current),s.renderer.containerPosition=h.current)},B=e=>{setTimeout(()=>{e&&!c.current&&(f.current=!1),c.current=e},500)},O=()=>{f.current=!0},D=e=>i?.isMobile||"touch"===p.current||"pen"===p.current?(e.preventDefault(),e.stopPropagation(),!1):void 0;return(0,p4.useEffect)(()=>{let e=()=>f.current?(f.current=!1,!0):u.current?(n(),u.current=!1,s?.deselect(),!0):!!c.current&&(n(),!0);return p7.eventDispatcher.onSync("iframe-single-click",e),()=>{p7.eventDispatcher.offSync("iframe-single-click",e)}},[]),{isTextSelected:u,handleScroll:P,handleTouchStart:C,handleTouchMove:j,handleTouchEnd:I,handlePointerDown:N,handlePointerMove:A,handlePointerCancel:T,handlePointerUp:R,handleSelectionchange:L,handleShowPopup:B,handleUpToPopup:O,handleContextmenu:D}};var bl=M,bc=rR,bf=eG,bu=cl;let bd=(e,t)=>{try{let r=t.trim();if(!r)return!1;let n=/[\p{L}\p{N}\p{M}_]/u,i=/[\p{Script=Han}\p{Script=Hiragana}\p{Script=Katakana}\p{Script=Hangul}]/u;if(!n.test(r))return!1;if(i.test(r)||/[\s\p{P}\p{S}]/u.test(r))return!0;let{charBefore:a,charAfter:o}=bp(e),s=e=>n.test(e);return(!a||!s(a))&&(!o||!s(o))}catch(e){return console.warn("Failed to check whole word:",e),/[\p{L}\p{N}\p{M}_]/u.test(t)}},bh=e=>/^[\p{P}\p{S}\s]+$/u.test(e),bp=e=>{let t="",r="";try{let n=e.startContainer;if(n.nodeType===Node.TEXT_NODE){let r=n;if(e.startOffset>0)t=r.textContent?.charAt(e.startOffset-1)||"";else{let e=n.previousSibling;for(;e&&e.nodeType!==Node.TEXT_NODE;)e=e.previousSibling;if(e?.nodeType===Node.TEXT_NODE){let r=e.textContent||"";t=r.charAt(r.length-1)}}}let i=e.endContainer;if(i.nodeType===Node.TEXT_NODE){let t=i,n=t.textContent||"";if(e.endOffset<n.length)r=n.charAt(e.endOffset);else{let e=t.nextSibling;for(;e&&e.nodeType!==Node.TEXT_NODE;)e=e.nextSibling;e?.nodeType===Node.TEXT_NODE&&(r=(e.textContent||"").charAt(0))}}}catch(e){console.warn("[getBoundaryChars] Error:",e)}return{charBefore:t,charAfter:r}},bb=e=>e?e.trim().split(/\s+/).filter(Boolean).length:0;var bm=fa,bg=t,by=c,bv=r,bx=b,bw=o,bS=t2,bk=r,b_=n,bE=m,bM=o,bN=ec;let bA=({bookKey:e,annotation:t,getAnnotationText:r,setSelection:n})=>{let{envConfig:i}=(0,b_.useEnv)(),{settings:a}=(0,bM.useSettingsStore)(),{getConfig:o,saveConfig:s,updateBooknotes:l}=(0,bN.useBookDataStore)(),{getView:c,getViewsById:f}=(0,bE.useReaderStore)(),u=c(e),d=(0,bk.useRef)(t),[h,p]=(0,bk.useState)(null),b=(0,bk.useCallback)((t,r)=>{if(!document.querySelector(`#gridcell-${e}`))return null;let n=Array.from(t.getClientRects());if(0===n.length)return null;let i=n[0],a=n[n.length-1],o=t.commonAncestorContainer.ownerDocument?.defaultView?.frameElement,s=o?.getBoundingClientRect()??{top:0,left:0};return{start:{x:s.left+(r?i.right:i.left),y:s.top+i.top},end:{x:s.left+(r?a.left:a.right),y:s.top+a.bottom}}},[e]),m=(0,bk.useCallback)(async(t,c,h,m)=>{if(!d.current||!u)return;let g=u.renderer.getContents();if(!g||0===g.length)return;let y=(e,t,r)=>{let n=e.defaultView?.frameElement,i=n?.getBoundingClientRect()??{top:0,left:0},a=t-i.left,o=r-i.top;if(e.caretPositionFromPoint){let t=e.caretPositionFromPoint(a,o);if(t)return{node:t.offsetNode,offset:t.offset}}if(e.caretRangeFromPoint){let t=e.caretRangeFromPoint(a,o);if(t)return{node:t.startContainer,offset:t.startOffset}}return null},v=null,x=null,w=null,S=0;for(let e of g){let{doc:r,index:n}=e;if(!r)continue;let i=y(r,t.x,t.y),a=y(r,c.x,c.y);if(i&&a){v=i,x=a,w=r,S=n??0;break}}if(!v||!x||!w)return;let k=w.createRange();try{if(v.node.compareDocumentPosition(x.node)&Node.DOCUMENT_POSITION_PRECEDING||v.node===x.node&&v.offset>x.offset?(k.setStart(x.node,x.offset),k.setEnd(v.node,v.offset)):(k.setStart(v.node,v.offset),k.setEnd(x.node,x.offset)),k.collapsed)return void console.warn("Range is collapsed")}catch(e){console.warn("Failed to create range:",e);return}let _=b(k,h);_&&p(_);let E=u.getCFI(S,k),M=await r(k);if(E&&M){let{booknotes:t=[]}=o(e),r=t.findIndex(e=>e.id===d.current.id&&!e.deletedAt);if(-1!==r){let o={...t[r],cfi:E,text:M,updatedAt:Date.now()},c=f(e.split("-")[0]);if(c.forEach(e=>e?.addAnnotation(d.current,!0)),c.forEach(e=>e?.addAnnotation(o)),d.current=o,!m){t[r]=o;let c=l(e,t);c&&s(i,e,c,a),n({key:e,annotated:!0,text:M,cfi:E,range:k,index:S})}}}},[e,b,r,n]);return{handlePositions:h,setHandlePositions:p,getHandlePositionsFromRange:b,handleAnnotationRangeChange:m}},bT=({position:e,isVertical:t,type:r,color:n,onDragStart:i,onDrag:a,onDragEnd:o})=>{let s=(0,bv.useRef)(!1),l=(0,bS.useResponsiveSize)(24),c=(0,bS.useResponsiveSize)(8),f=(0,bS.useResponsiveSize)(12),u=(0,bv.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),s.current=!0,i(),e.target.setPointerCapture(e.pointerId)},[i]),d=(0,bv.useCallback)(e=>{s.current&&(e.preventDefault(),e.stopPropagation(),a({x:e.clientX,y:e.clientY}))},[a]),h=(0,bv.useCallback)(e=>{s.current&&(e.preventDefault(),e.stopPropagation(),s.current=!1,e.target.releasePointerCapture(e.pointerId),o())},[o]);return(0,bg.jsx)("div",{className:"pointer-events-auto absolute z-50 cursor-grab touch-none active:cursor-grabbing",style:{left:t&&"start"===r?e.x-l/2+f/4:e.x-l/2,top:t?"start"===r?e.y-l+f/2:e.y-l/2-f/2:"start"===r?e.y-l:e.y-l/2-f/8,width:l,height:l+f},onPointerDown:u,onPointerMove:d,onPointerUp:h,onPointerCancel:h,children:(0,bg.jsxs)("svg",{width:l,height:l+f,viewBox:`0 0 ${l} ${l+f}`,className:(0,by.default)("start"===r&&"rotate-180"),style:{transform:t?"start"===r?"rotate(270deg)":"rotate(90deg)":"start"===r?"rotate(180deg)":void 0},children:[(0,bg.jsx)("line",{x1:l/2,y1:0,x2:l/2,y2:f,stroke:n,strokeWidth:2,strokeLinecap:"round"}),(0,bg.jsx)("circle",{cx:l/2,cy:f+c,r:c,fill:n})]})})},bR=({bookKey:e,isVertical:t,annotation:r,selection:n,handleColor:i,getAnnotationText:a,setSelection:o,onStartEdit:s})=>{let{settings:l}=(0,bw.useSettingsStore)(),{isDarkMode:c}=(0,bx.useThemeStore)(),f=l.globalViewSettings.isEink,u=c?"#ffffff":"#000000",{handlePositions:d,getHandlePositionsFromRange:h,handleAnnotationRangeChange:p}=bA({bookKey:e,annotation:r,getAnnotationText:a,setSelection:o}),b=(0,bv.useRef)(!1),m=fi(l,i)??"#FFFF00",g=(0,bv.useRef)(null),y=(0,bv.useRef)({x:0,y:0}),v=(0,bv.useRef)({x:0,y:0}),[x,w]=(0,bv.useState)({x:0,y:0}),[S,k]=(0,bv.useState)({x:0,y:0});(0,bv.useEffect)(()=>{if(b.current)return;b.current=!0;let e=h(n.range,t);e&&(setTimeout(()=>{w(e.start),k(e.end)},0),y.current=e.start,v.current=e.end)},[r,n,t,h]),(0,bv.useEffect)(()=>{d&&!g.current&&(setTimeout(()=>{w(d.start),k(d.end)},0),y.current=d.start,v.current=d.end)},[d]);let _=(0,bv.useCallback)(()=>{g.current="start",s()},[s]),E=(0,bv.useCallback)(()=>{g.current="end",s()},[s]),M=(0,bv.useCallback)(e=>{w(e),y.current=e,p(e,v.current,t,!0)},[t,p]),N=(0,bv.useCallback)(e=>{k(e),v.current=e,p(y.current,e,t,!0)},[t,p]),A=(0,bv.useCallback)(()=>{g.current=null,p(y.current,v.current,t,!1)},[t,p]);return 0===x.x&&0===x.y?null:(0,bg.jsxs)("div",{className:"pointer-events-none fixed inset-0 z-50",children:[(0,bg.jsx)(bT,{position:x,isVertical:t,type:"start",color:f?u:m,onDragStart:_,onDrag:M,onDragEnd:A}),(0,bg.jsx)(bT,{position:S,isVertical:t,type:"end",color:f?u:m,onDragStart:E,onDrag:N,onDragEnd:A})]})};var bC=t,bj=c,bI=t,bL=c,bP=r;let bB=({showTooltip:e,tooltipText:t,disabled:r,Icon:n,onClick:i})=>{let[a,o]=(0,bP.useState)(!1),s=()=>{o(!0),i()};return(0,bI.jsx)("div",{className:"lg:tooltip lg:tooltip-bottom",title:!a&&e?t:void 0,children:(0,bI.jsx)("button",{onClick:s,className:(0,bL.default)("flex h-8 min-h-8 w-8 items-center justify-center p-0",r?"cursor-not-allowed opacity-50":"not-eink:hover:bg-gray-500 eink:hover:border rounded-md"),disabled:r,children:(0,bI.jsx)(n,{})})})};var bO=t,bD=c,bz=r3,bF=r,bU=n,b$=ec,bH=m,bq=t2;let bV=({bookKey:e,isVertical:t,notes:r,toolsVisible:n,triangleDir:i,popupWidth:a,popupHeight:o,onDismiss:s})=>{let{appService:l}=(0,bU.useEnv)(),{getConfig:c,setConfig:f}=(0,b$.useBookDataStore)(),{setHoveredBookKey:u}=(0,bH.useReaderStore)(),{setSideBarVisible:d}=x(),h=c(e),p=(0,bq.useResponsiveSize)(250),b=(0,bF.useMemo)(()=>[...r].sort((e,t)=>t.updatedAt-e.updatedAt),[r]),m=t=>{t.id&&(l?.isMobile&&s(),u(""),d(!0),h?.viewSettings&&f(e,{viewSettings:{...h.viewSettings,sideBarTab:"annotations"}}))};return(0,bO.jsx)("div",{className:(0,bD.default)("annotation-notes absolute flex rounded-lg text-white"),style:{...t?{right:"left"===i?`${n?a+16:0}px`:void 0,left:"right"===i?`${n?a+16:0}px`:void 0,height:`${o}px`,maxWidth:`${p}px`,overflowX:"auto"}:{top:"down"===i?`${n?o+16:0}px`:void 0,bottom:"up"===i?`${n?o+16:0}px`:void 0,width:`${a}px`,maxHeight:`${p}px`,overflowY:"auto"},scrollbarWidth:"thin"},children:(0,bO.jsx)("div",{className:(0,bD.default)("flex gap-4",t?"h-full flex-row":"w-full flex-col"),style:t?{display:"grid",gridAutoFlow:"column",gridAutoColumns:"max-content",minWidth:"min-content",height:`${o}px`,maxHeight:`${o}px`}:{},children:b.map((e,r)=>(0,bO.jsx)("div",{role:"none",onClick:()=>m?.(e),className:(0,bD.default)("popup-container cursor-pointer rounded-lg bg-gray-600 shadow-lg transition-colors"),style:t?{minWidth:"max-content",height:`${o}px`,maxHeight:`${o}px`}:{},children:e.note&&(0,bO.jsx)("div",{dir:"auto",className:(0,bD.default)("m-4 hyphens-auto text-justify font-sans text-sm","not-eink:text-white eink:text-base-content",t&&"writing-vertical-rl"),style:t?{fontFeatureSettings:"'vrt2' 1, 'vert' 1",minWidth:"max-content"}:{},children:(0,bO.jsxs)("div",{className:(0,bD.default)("flex flex-col justify-between gap-2"),children:[e.note,(0,bO.jsx)("span",{className:"not-eink:text-white/50 eink:text-base-content/50 text-sm sm:text-xs",children:(0,bz.default)(e.createdAt).fromNow()})]})})},e.id||r))})})};var bW=t,bK=c,bG=r,bX=i7,bY=n,bZ=b,bJ=o,bQ=t2,b0=ru;let b1=["highlight","underline","squiggly"],b2=["red","violet","blue","green","yellow"],b3=28,b6=16,b4=({isVertical:e,popupWidth:t,popupHeight:r,triangleDir:n,selectedStyle:i,selectedColor:a,onHandleHighlight:o})=>{let{envConfig:s}=(0,bY.useEnv)(),{settings:l}=(0,bJ.useSettingsStore)(),{isDarkMode:c}=(0,bZ.useThemeStore)(),f=l.globalReadSettings,u=l.globalViewSettings.isEink,d=c?"#000000":"#ffffff",h=c?"#ffffff":"#000000",p=f.customHighlightColors,[b,m]=(0,bG.useState)(i),[g,y]=(0,bG.useState)(a),v=(0,bQ.useResponsiveSize)(16),x=(0,bQ.useResponsiveSize)(28),w=(0,bQ.useResponsiveSize)(b3),S=(0,bQ.useResponsiveSize)(b6),k=e=>{let t={...f,highlightStyle:e};(0,b0.saveSysSettings)(s,"globalReadSettings",t),m(e),y(f.highlightStyles[e]),o(!0)},_=e=>{let t={...f,highlightStyle:b,highlightStyles:{...f.highlightStyles,[b]:e}};(0,b0.saveSysSettings)(s,"globalReadSettings",t),y(e),o(!0)};return(0,bW.jsxs)("div",{className:(0,bK.default)("highlight-options absolute flex items-center justify-between",e?"flex-col":"flex-row"),style:{width:`${t}px`,height:`${r}px`,...e?{left:`${(w+S)*("left"===n?-1:1)}px`}:{top:`${(w+S)*("up"===n?-1:1)}px`}},children:[(0,bW.jsx)("div",{className:(0,bK.default)("flex gap-2",e?"flex-col":"flex-row"),style:e?{width:x}:{height:x},children:b1.map(e=>(0,bW.jsx)("button",{onClick:()=>k(e),className:"not-eink:bg-gray-700 eink-bordered flex items-center justify-center rounded-full p-0",style:{width:x,height:x,minHeight:x},children:(0,bW.jsx)("div",{style:{width:v,height:v,..."highlight"===e&&"highlight"===b&&{backgroundColor:u?h:p[g],color:u?d:"#d1d5db",paddingTop:"2px"},..."highlight"===e&&"highlight"!==b&&{backgroundColor:"#d1d5db",paddingTop:"2px"},...("underline"===e||"squiggly"===e)&&{color:u?h:"#d1d5db",textDecoration:"underline",textDecorationThickness:"2px",textDecorationColor:b===e?u?h:p[g]:"#d1d5db",..."squiggly"===e&&{textDecorationStyle:"wavy"}}},className:"w-4 p-0 text-center leading-none",children:"A"})},e))}),(0,bW.jsx)("div",{className:(0,bK.default)("not-eink:bg-gray-700 eink-bordered flex items-center justify-center gap-2 rounded-3xl",e?"flex-col py-2":"flex-row px-2"),style:e?{width:x}:{height:x},children:b2.filter(e=>!u||g===e).map(e=>(0,bW.jsx)("button",{onClick:()=>_(e),style:{width:v,height:v,backgroundColor:g!==e?p[e]:"transparent"},className:"rounded-full p-0",children:g===e&&(0,bW.jsx)(bX.FaCheckCircle,{size:v,style:{fill:u?h:p[e]}})},e))})]})},b8=({bookKey:e,dir:t,isVertical:r,buttons:n,notes:i,position:a,trianglePosition:o,highlightOptionsVisible:s,selectedStyle:l,selectedColor:c,popupWidth:f,popupHeight:u,onHighlight:d,onDismiss:h})=>(0,bC.jsx)("div",{dir:t,children:(0,bC.jsx)(h3,{width:r?u:f,height:r?f:u,minHeight:r?f:u,position:a,trianglePosition:o,className:(0,bj.default)("selection-popup bg-gray-600 text-white",i.length>0&&"bg-transparent"),triangleClassName:"text-gray-600",onDismiss:h,children:(0,bC.jsxs)("div",{className:(0,bj.default)("flex h-full gap-4",r?"flex-row":"flex-col"),children:[(0,bC.jsx)("div",{className:(0,bj.default)("selection-buttons flex h-full w-full items-center justify-between p-2",r?"flex-col overflow-y-auto":"flex-row overflow-x-auto",i.length>0&&"hidden"),style:{scrollbarWidth:"none",msOverflowStyle:"none"},children:n.map((e,t)=>!1===e.visible?null:(0,bC.jsx)(bB,{showTooltip:!s,tooltipText:e.tooltipText,Icon:e.Icon,onClick:e.onClick,disabled:e.disabled},t))}),i.length>0?(0,bC.jsx)(bV,{bookKey:e,isVertical:r,notes:i,toolsVisible:!1,triangleDir:o.dir,popupWidth:r?u:f,popupHeight:r?f:u,onDismiss:h}):s&&(0,bC.jsx)(b4,{isVertical:r,triangleDir:o.dir,popupWidth:r?u:f,popupHeight:r?f:u,selectedStyle:l,selectedColor:c,onHandleHighlight:d})]})})});var b5=t,b9=r,b7=i;let me=({word:e,lang:t,position:r,trianglePosition:n,popupWidth:i,popupHeight:a,onDismiss:o})=>{let s=(0,b7.useTranslation)(),[l,c]=(0,b9.useState)(e),f=(0,b9.useRef)(!1),u=e=>{let t=document.createElement("div");return t.innerHTML=e,t.querySelectorAll('a[rel="mw:WikiLink"]').forEach(e=>{let t=e.getAttribute("title");t&&(e.addEventListener("click",e=>{e.preventDefault(),c(t),f.current=!1}),e.className="text-primary underline cursor-pointer")}),Array.from(t.childNodes)};return(0,b9.useEffect)(()=>{if(f.current)return;f.current=!0;let e=document.querySelector("main"),r=document.querySelector("footer");(async(t,n)=>{e.innerHTML="",r.dataset.state="loading";try{let i=await fetch(`https://en.wiktionary.org/api/rest_v1/page/definition/${t}`);if(!i.ok)throw Error("Failed to fetch definitions");let a=await i.json(),o=n?a[n]||a.en:a[Object.keys(a)[0]];if(!o||0===o.length)throw Error("No results found");let s=document.createElement("hgroup"),l=document.createElement("h1");l.innerText=t,l.className="text-lg font-bold";let c=document.createElement("p");c.innerText=o[0].language,c.className="text-sm italic opacity-75",s.append(l,c),e.append(s),o.forEach(({partOfSpeech:t,definitions:r})=>{let n=document.createElement("h2");n.innerText=t,n.className="text-base font-semibold mt-4";let i=document.createElement("ol");i.className="pl-8 list-decimal",r.forEach(({definition:e,examples:t})=>{if(!e)return;let r=document.createElement("li"),n=u(e);if(r.append(...n),t){let e=document.createElement("ul");e.className="pl-8 list-disc text-sm italic opacity-75",t.forEach(t=>{let r=document.createElement("li");r.innerHTML=t,e.appendChild(r)}),r.appendChild(e)}i.appendChild(r)}),e.appendChild(n),e.appendChild(i)}),r.dataset.state="loaded"}catch(o){console.error(o),r.dataset.state="error";let n=document.createElement("div");n.className="flex flex-col items-center justify-center w-full h-full text-center absolute inset-0";let i=document.createElement("h1");i.innerText=s("Error"),i.className="text-lg font-bold";let a=document.createElement("p");a.innerHTML=s("Unable to load the word. Try searching directly on {{link}}.",{link:`<a href="https://en.wiktionary.org/w/index.php?search=${encodeURIComponent(t)}" target="_blank" rel="noopener noreferrer" class="text-primary underline">Wiktionary</a>`}),n.append(i,a),e.append(n)}})(l,"string"==typeof t?t:t?.[0])},[s,l,t]),(0,b5.jsx)("div",{children:(0,b5.jsx)(h3,{trianglePosition:n,width:i,height:a,position:r,className:"select-text",onDismiss:o,children:(0,b5.jsxs)("div",{className:"flex h-full flex-col",children:[(0,b5.jsx)("main",{className:"flex-grow overflow-y-auto p-4 font-sans"}),(0,b5.jsx)("footer",{className:"mt-auto hidden data-[state=loaded]:block data-[state=error]:hidden data-[state=loading]:hidden",children:(0,b5.jsx)("div",{className:"flex items-center px-4 py-2 text-sm opacity-60",children:"Source: Wiktionary (CC BY-SA)"})})]})})})};var mt=t,mr=r,mn=i;let mi=({text:e,lang:t,position:r,trianglePosition:n,popupWidth:i,popupHeight:a,onDismiss:o})=>{let s=(0,mn.useTranslation)(),l=(0,mr.useRef)(!1);return(0,mr.useEffect)(()=>{if(l.current)return;l.current=!0;let r=document.querySelector("main"),n=document.querySelector("footer"),i=async(e,t)=>{r.innerHTML="",n.dataset.state="loading";try{let i=await fetch(`https://${t}.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(e)}`);if(!i.ok)throw Error("Failed to fetch Wikipedia summary");let a=await i.json(),o=document.createElement("hgroup");o.style.color="white",o.style.backgroundPosition="center center",o.style.backgroundSize="cover",o.style.backgroundColor="rgba(0, 0, 0, .4)",o.style.backgroundBlendMode="darken",o.style.borderRadius="6px",o.style.padding="12px",o.style.marginBottom="12px",o.style.minHeight="100px";let s=document.createElement("h1");if(s.innerHTML=a.titles.display,s.className="text-lg font-bold",o.append(s),a.description){let e=document.createElement("p");e.innerText=a.description,o.appendChild(e)}a.thumbnail&&(o.style.backgroundImage=`url("${a.thumbnail.source}")`);let l=document.createElement("div");l.innerHTML=a.extract_html,l.className="p-2 text-sm",l.dir=a.dir,r.append(o,l),n.dataset.state="loaded"}catch(l){console.error(l);let i=document.createElement("div"),a=document.createElement("h1");a.innerText=s("Error");let o=document.createElement("p");o.innerHTML=s("Unable to load the article. Try searching directly on {{link}}.",{link:`<a href="https://${t}.wikipedia.org/w/index.php?search=${encodeURIComponent(e)}" target="_blank" rel="noopener noreferrer" class="text-primary underline">Wikipedia</a>`}),i.append(a,o),r.appendChild(i),n.dataset.state="error"}},a="string"==typeof t?t:t?.[0];i(e,a?a.split("-")[0]:"en")},[s,e,t]),(0,mt.jsx)("div",{children:(0,mt.jsx)(h3,{width:i,height:a,position:r,trianglePosition:n,className:"select-text",onDismiss:o,children:(0,mt.jsxs)("div",{className:"text-base-content flex h-full flex-col pt-2",children:[(0,mt.jsx)("main",{className:"flex-grow overflow-y-auto px-2 font-sans"}),(0,mt.jsx)("footer",{className:"mt-auto hidden data-[state=loaded]:block data-[state=error]:hidden data-[state=loading]:hidden",children:(0,mt.jsx)("div",{className:"flex items-center px-4 py-2 text-sm opacity-60",children:"Source: Wikipedia (CC BY-SA)"})})]})})})};var ma=t,mo=r,ms=rt,ml=o,mc=i,mf=rP,mu=e8;e.i(523912);var md=e.i(152890),mh=e.i(556488);let mp=[""],mb=Object.fromEntries(Object.entries(mu.TRANSLATOR_LANGS).filter(([e])=>!mp.includes(e))),mm=({text:e,position:t,trianglePosition:r,popupWidth:n,popupHeight:i,onDismiss:a})=>{let o=(0,mc.useTranslation)(),{token:s}=(0,ms.useAuth)(),{settings:l,setSettings:c}=(0,ml.useSettingsStore)(),[f,u]=(0,mo.useState)([]),[d,h]=(0,mo.useState)("AUTO"),[p,b]=(0,mo.useState)(l.globalReadSettings.translateTargetLang),[m,g]=(0,mo.useState)(l.globalReadSettings.translationProvider),[y,v]=(0,mo.useState)(null),[x,w]=(0,mo.useState)(null),[S,k]=(0,mo.useState)(!1),[_,E]=(0,mo.useState)(null),{translate:M,translators:N}=(0,mf.useTranslator)({provider:m,sourceLang:d,targetLang:p}),A=e=>{h(e.target.value)},T=e=>{l.globalReadSettings.translateTargetLang=e.target.value,c(l),b(e.target.value)},R=e=>{let t=e.target.value,r=(0,md.getTranslators)().filter(e=>(!e.authRequired||!!s)&&!e.quotaExceeded),n=r.find(e=>e.name===t)||r[0];n&&(l.globalReadSettings.translationProvider=n.name,c(l),g(n.name))};return(0,mo.useEffect)(()=>{u(N.map(e=>{let t=e.label;return e.authRequired&&!s?t=`${t} (${o("Login Required")})`:e.quotaExceeded&&(t=`${t} (${o("Quota Exceeded")})`),{name:e.name,label:t}}))},[N]),(0,mo.useEffect)(()=>{k(!0),(async()=>{E(null),v(null);try{let t=e.replaceAll("\n","").trim(),r=(await M([t]))[0];if(!r)throw Error("No translation found");v(r)}catch(e){console.error(e),s?E(o("Unable to fetch the translation. Try again later.")):E(o("Unable to fetch the translation. Please log in first and try again."))}finally{k(!1)}})()},[e,s,d,p,m,M]),(0,ma.jsx)("div",{children:(0,ma.jsxs)(h3,{trianglePosition:r,width:n,minHeight:i,maxHeight:720,position:t,className:"not-eink:text-white grid h-full select-text grid-rows-[1fr,auto,1fr] bg-gray-600",triangleClassName:"text-gray-600",onDismiss:a,children:[(0,ma.jsxs)("div",{className:"overflow-y-auto p-4 font-sans",children:[(0,ma.jsxs)("div",{className:"mb-2 flex items-center justify-between",children:[(0,ma.jsx)("h1",{className:"text-sm font-normal",children:o("Original Text")}),(0,ma.jsx)(mh.default,{className:"not-eink:bg-gray-600 not-eink:text-white eink:bg-base-100",value:d,onChange:A,options:[{value:"AUTO",label:o("Auto Detect")},...Object.entries(mb).sort((e,t)=>e[1].localeCompare(t[1])).map(([e,t])=>{let r=x&&"AUTO"===d&&"AUTO"===e?`${mb[x]||x} `+o("(detected)"):t;return{value:e,label:r}})]})]}),(0,ma.jsx)("p",{className:"not-eink:text-white/90 text-base",children:e})]}),(0,ma.jsx)("div",{className:"mx-4 flex-shrink-0 border-t border-gray-500/30"}),(0,ma.jsxs)("div",{className:"overflow-y-auto px-4 pb-8 pt-4 font-sans",children:[(0,ma.jsxs)("div",{className:"mb-2 flex items-center justify-between",children:[(0,ma.jsx)("h2",{className:"text-sm font-normal",children:o("Translated Text")}),(0,ma.jsx)(mh.default,{className:"not-eink:bg-gray-600 not-eink:text-white eink:bg-base-100",value:p,onChange:T,options:[{value:"",label:o("System Language")},...Object.entries(mb).sort((e,t)=>e[1].localeCompare(t[1])).map(([e,t])=>({value:e,label:t}))]})]}),S?(0,ma.jsx)("p",{className:"text-base italic text-gray-500",children:o("Loading...")}):(0,ma.jsx)("div",{children:_?(0,ma.jsx)("p",{className:"text-base text-red-600",children:_}):(0,ma.jsx)("p",{className:"not-eink:text-white/90 text-base",children:y||o("No translation available.")})})]}),(0,ma.jsxs)("div",{className:"absolute bottom-0 flex h-8 w-full items-center justify-between px-4",children:[(0,ma.jsx)("div",{className:"line-clamp-1 text-xs opacity-60",children:m&&!S&&!_&&o("Translated by {{provider}}.",{provider:f.find(e=>e.name===m)?.label})}),(0,ma.jsx)(mh.default,{className:"not-eink:bg-gray-600 not-eink:text-white eink:bg-base-100",value:m,onChange:R,options:f.map(({name:e,label:t})=>({value:e,label:t}))})]})]})})};var mg=tT,my=t,mv=c,mx=r,mw=n,mS=m,mk=i,m_=sR,mE=M,mM=mh;let mN=({bookKey:e,selection:t,position:r,trianglePosition:n,popupWidth:i,popupHeight:a,onConfirm:o,onDismiss:s})=>{let l=(0,mk.useTranslation)(),{envConfig:c}=(0,mw.useEnv)(),{getProgress:f,getView:u,recreateViewer:d}=(0,mS.useReaderStore)(),{addRule:h}=em(),p=f(e),[b,m]=(0,mx.useState)(""),[g,y]=(0,mx.useState)(!0),[v,x]=(0,mx.useState)(!bh(t?.text||"")),[w,S]=(0,mx.useState)("selection"),[k,_]=(0,mx.useState)(!1),E=(0,mx.useRef)(null);(0,m_.useAutoFocus)({ref:E});let M=e=>{m(e.target.value)},N=e=>{S(e.target.value)},A=async()=>{if(!t)return;let r=t?.range;if(r){let n=bd(r,t?.text||"");if(v&&!n)return void mE.eventDispatcher.dispatch("toast",{type:"warning",message:'Please select a whole word or uncheck the "Whole word" option.',timeout:5e3});if("selection"===w){r.deleteContents();let e=document.createTextNode(b);r.insertNode(e)}let i={scope:w,pattern:t.text,replacement:b.trim(),cfi:t.cfi,sectionHref:p?.sectionHref,isRegex:!1,enabled:!0,caseSensitive:g,wholeWord:v,onlyForTTS:"selection"!==w?k:void 0};o?.(i),await h(c,e,i),s(),"selection"!==w&&!k&&u(e)&&d(c,e)}},T=[{value:"selection",label:l("Current selection")},{value:"book",label:l("All occurrences in this book")},{value:"library",label:l("All occurrences in your library")}];return(0,my.jsx)("div",{children:(0,my.jsxs)(h3,{trianglePosition:n,width:i,minHeight:a,position:r,className:"not-eink:text-gray-400 flex flex-col justify-between rounded-lg bg-gray-700",triangleClassName:"text-gray-700",onDismiss:s,children:[(0,my.jsxs)("div",{className:"flex flex-col gap-6 p-4",children:[(0,my.jsxs)("div",{className:"not-eink:text-gray-400 flex gap-1 text-xs",children:[(0,my.jsx)("span",{className:"text-nowrap",children:l("Selected text:")}),(0,my.jsxs)("span",{className:"not-eink:text-yellow-300 line-clamp-1 select-text break-words font-medium",children:['"',t?.text||"",'"']})]}),(0,my.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,my.jsx)("label",{htmlFor:"replacement-input",className:"text-xs",children:l("Replace with:")}),(0,my.jsx)("input",{ref:E,type:"text",value:b,onChange:M,onKeyDown:e=>{"Enter"===e.key&&b&&A()},placeholder:l("Enter text..."),className:(0,mv.default)("w-full flex-1 rounded-md p-2 text-sm placeholder-gray-400 focus:outline-none focus:ring-0","not-eink:bg-gray-600 not-eink:text-white eink:border eink:border-base-content")}),(0,my.jsx)("button",{onClick:A,disabled:!b,className:(0,mv.default)("btn btn-sm btn-ghost btn-primary disabled:text-base-content/75 text-blue-600 disabled:opacity-75","bg-transparent hover:bg-transparent disabled:bg-transparent"),children:l("Apply")})]})]}),(0,my.jsxs)("div",{className:"flex flex-wrap items-center gap-4 p-4",children:[(0,my.jsxs)("label",{className:"flex cursor-pointer items-center gap-2",children:[(0,my.jsx)("span",{className:"line-clamp-1 text-xs",title:l("Case sensitive:"),children:l("Case sensitive:")}),(0,my.jsx)("input",{type:"checkbox",className:"toggle toggle-sm bg-gray-500 checked:bg-black hover:bg-gray-500 hover:checked:bg-black",style:{"--tglbg":"#4B5563"},checked:g,onChange:e=>y(e.target.checked)})]}),(0,my.jsxs)("label",{className:"flex cursor-pointer items-center gap-2",children:[(0,my.jsx)("span",{className:"line-clamp-1 text-xs",title:l("Whole word:"),children:l("Whole word:")}),(0,my.jsx)("input",{type:"checkbox",className:"toggle toggle-sm bg-gray-500 checked:bg-black hover:bg-gray-500 hover:checked:bg-black",style:{"--tglbg":"#4B5563"},checked:v,onChange:e=>x(e.target.checked)})]}),(0,my.jsxs)("label",{className:"flex cursor-pointer items-center gap-2",children:[(0,my.jsx)("span",{className:"line-clamp-1 text-xs",title:l("Only for TTS:"),children:l("Only for TTS:")}),(0,my.jsx)("input",{type:"checkbox",disabled:"selection"===w,className:"toggle toggle-sm bg-gray-500 checked:bg-black hover:bg-gray-500 hover:checked:bg-black",style:{"--tglbg":"#4B5563"},checked:k,onChange:e=>_(e.target.checked)})]})]}),(0,my.jsxs)("div",{className:"flex flex-1 items-center justify-between gap-2 p-4",children:[(0,my.jsx)("label",{htmlFor:"scope-select",className:"line-clamp-1 text-xs",title:l("Scope:"),children:l("Scope:")}),(0,my.jsx)(mM.default,{className:"not-eink:bg-gray-600 eink:bg-base-100 not-eink:text-white max-w-[85%]",value:w,onChange:N,options:T})]})]})})};var mA=t,mT=c,mR=r,mC=i,mj=Z,mI=m,mL=e8,mP=ru,mB=n;let mO=(e,t)=>{let r=(e,t,r)=>{if("date"===t&&"number"==typeof e){let t=new Date(e);return r?r.replace("%Y",t.getFullYear().toString()).replace("%m",String(t.getMonth()+1).padStart(2,"0")).replace("%d",String(t.getDate()).padStart(2,"0")).replace("%H",String(t.getHours()).padStart(2,"0")).replace("%M",String(t.getMinutes()).padStart(2,"0")).replace("%S",String(t.getSeconds()).padStart(2,"0")):t.toLocaleString()}return e},n=(e,t)=>{let r=e.trim().split("."),n=t;for(let e of r)n=n?.[e];return n},i=e,a=i.match(/\{%\s*for\s+(\w+)\s+in\s+(\w+(?:\.\w+)*)\s*%\}/);if(a){let e=a[1],r=a[2],o=0,s=-1,l=a.index+a[0].length;for(let e=l;e<i.length;e++){let t=i.slice(e);if(t.startsWith("{% for "))o++,e+=6;else if(t.startsWith("{% endfor %}")){if(0===o){s=e;break}o--,e+=11}}if(-1!==s){let o=i.slice(0,a.index),c=i.slice(l,s),f=i.slice(s+13),u=n(r,t);return Array.isArray(u)?(i=o+u.map(r=>mO(c,{...t,[e]:r})).join("")+f,mO(i,t)):mO(i=o+f,t)}}return(i=i.replace(/\{%\s*if\s+([^%]+?)\s*%\}([\s\S]*?)\{%\s*endif\s*%\}/g,(e,r,i)=>n(r,t)?mO(i,t):"")).replace(/\{\{\s*([^}|]+?)(?:\s*\|\s*(\w+)(?:\s*\((['"]?)([^)'"]*)\3\))?)?\s*\}\}/g,(e,i,a,o,s)=>{let l=n(i,t);return null==l?"":a?r(l,a,s):String(l)})},mD=({bookKey:e,isOpen:t,bookTitle:r,bookAuthor:n,booknotes:i,booknoteGroups:a,onCancel:o,onExport:s})=>{let l=(0,mC.useTranslation)(),{envConfig:c}=(0,mB.useEnv)(),{getViewSettings:f}=(0,mI.useReaderStore)(),u=f(e),d=`## {{ title }}
**${l("Author")}**: {{ author }}

**${l("Exported from Readest")}**: {{ exportDate }}

---

### ${l("Highlights & Annotations")}

{% for chapter in chapters %}
#### {{ chapter.title }}
{% for annotation in chapter.annotations %}
> {{ annotation.text }}
{% if annotation.note %}
**${l("Note:")}** {{ annotation.note }}
{% endif %}
*${l("Time:")} {{ annotation.timestamp | date('%Y-%m-%d %H:%M') }}*
{% endfor %}

---
{% endfor %}`,[h,p]=(0,mR.useState)(()=>{let e=u?.noteExportConfig||mL.DEFAULT_NOTE_EXPORT_CONFIG;return e.customTemplate?e:{...e,customTemplate:d}}),[b,m]=(0,mR.useState)(!1),[g,y]=(0,mR.useState)(!1);(0,mR.useEffect)(()=>{let t=h.customTemplate,r={...h,customTemplate:t===d?"":t};(0,mP.saveViewSettings)(c,e,"noteExportConfig",r,!1,!1)},[h,c,e]);let v=(0,mR.useMemo)(()=>{if(h.useCustomTemplate){let e=Object.values(a).sort((e,t)=>e.id-t.id),t={title:r,author:n,exportDate:new Date().toISOString().slice(0,10),chapters:e.map(e=>({title:e.label||l("Untitled"),annotations:e.booknotes.map(e=>({text:e.text||"",note:e.note||"",style:e.style,color:e.color,timestamp:e.updatedAt}))}))};return mO(h.customTemplate,t)}let e=Object.values(a).sort((e,t)=>e.id-t.id),t=[];for(let i of(h.includeTitle&&t.push(`# ${r}`),h.includeAuthor&&n&&(t.push(`**${l("Author")}**: ${n}`),t.push("")),h.includeDate&&(t.push(`**${l("Exported from Readest")}**: ${new Date().toISOString().slice(0,10)}`),t.push("")),(h.includeTitle||h.includeAuthor||h.includeDate)&&(t.push("---"),t.push("")),t.push(`## ${l("Highlights & Annotations")}`),t.push(""),e)){if(h.includeChapterTitles){let e=i.label||l("Untitled");t.push(`### ${e}`)}for(let e of i.booknotes){if(h.includeQuotes&&e.text&&t.push(`> ${e.text}`),h.includeNotes&&e.note&&(t.push(""),t.push(`**${l("Note")}**:: ${e.note}`)),h.includeTimestamp&&e.updatedAt){let r=new Date(e.updatedAt).toLocaleString();t.push(""),t.push(`*${l("Time:")} ${r}*`)}t.push(h.noteSeparator)}h.includeChapterSeparator&&(t.push("---"),t.push(""))}return t.join("\n")},[h,a,r,n,l]),x=(0,mR.useMemo)(()=>v?iu.parse(v):"",[v]),w=e=>{p(t=>({...t,[e]:!t[e]}))},S=()=>{s(v)};return(0,mA.jsx)(mj.default,{isOpen:t,title:l("Export Annotations"),onClose:o,boxClassName:"sm:!w-[75%] sm:h-auto sm:!max-h-[90vh] sm:!max-w-5xl",contentClassName:"sm:!px-8 sm:!py-2",children:(0,mA.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,mA.jsxs)("div",{className:"space-y-3",children:[(0,mA.jsx)("h3",{className:"font-bold",children:l("Format Options")}),(0,mA.jsxs)("div",{className:(0,mT.default)("grid grid-cols-2 gap-x-6 gap-y-3 sm:grid-cols-3",h.useCustomTemplate&&"pointer-events-none opacity-50"),children:[(0,mA.jsxs)("label",{className:"flex cursor-pointer items-center gap-2",children:[(0,mA.jsx)("input",{type:"checkbox",checked:h.includeTitle,onChange:()=>w("includeTitle"),className:"checkbox checkbox-sm",disabled:h.useCustomTemplate}),(0,mA.jsx)("span",{className:"text-sm",children:l("Title")})]}),(0,mA.jsxs)("label",{className:"flex cursor-pointer items-center gap-2",children:[(0,mA.jsx)("input",{type:"checkbox",checked:h.includeAuthor,onChange:()=>w("includeAuthor"),className:"checkbox checkbox-sm",disabled:h.useCustomTemplate}),(0,mA.jsx)("span",{className:"text-sm",children:l("Author")})]}),(0,mA.jsxs)("label",{className:"flex cursor-pointer items-center gap-2",children:[(0,mA.jsx)("input",{type:"checkbox",checked:h.includeDate,onChange:()=>w("includeDate"),className:"checkbox checkbox-sm",disabled:h.useCustomTemplate}),(0,mA.jsx)("span",{className:"text-sm",children:l("Export Date")})]}),(0,mA.jsxs)("label",{className:"flex cursor-pointer items-center gap-2",children:[(0,mA.jsx)("input",{type:"checkbox",checked:h.includeChapterTitles,onChange:()=>w("includeChapterTitles"),className:"checkbox checkbox-sm",disabled:h.useCustomTemplate}),(0,mA.jsx)("span",{className:"text-sm",children:l("Chapter Titles")})]}),(0,mA.jsxs)("label",{className:"flex cursor-pointer items-center gap-2",children:[(0,mA.jsx)("input",{type:"checkbox",checked:h.includeChapterSeparator,onChange:()=>w("includeChapterSeparator"),className:"checkbox checkbox-sm",disabled:h.useCustomTemplate}),(0,mA.jsx)("span",{className:"text-sm",children:l("Chapter Separator")})]}),(0,mA.jsxs)("label",{className:"flex cursor-pointer items-center gap-2",children:[(0,mA.jsx)("input",{type:"checkbox",checked:h.includeQuotes,onChange:()=>w("includeQuotes"),className:"checkbox checkbox-sm",disabled:h.useCustomTemplate}),(0,mA.jsx)("span",{className:"text-sm",children:l("Highlights")})]}),(0,mA.jsxs)("label",{className:"flex cursor-pointer items-center gap-2",children:[(0,mA.jsx)("input",{type:"checkbox",checked:h.includeNotes,onChange:()=>w("includeNotes"),className:"checkbox checkbox-sm",disabled:h.useCustomTemplate}),(0,mA.jsx)("span",{className:"text-sm",children:l("Notes")})]}),(0,mA.jsxs)("label",{className:"flex cursor-pointer items-center gap-2",children:[(0,mA.jsx)("input",{type:"checkbox",checked:h.includeTimestamp,onChange:()=>w("includeTimestamp"),className:"checkbox checkbox-sm",disabled:h.useCustomTemplate}),(0,mA.jsx)("span",{className:"text-sm",children:l("Note Date")})]})]})]}),(0,mA.jsxs)("div",{className:"space-y-3",children:[(0,mA.jsxs)("div",{className:"flex items-center justify-between",children:[(0,mA.jsx)("h3",{className:"font-bold",children:l("Advanced")}),(0,mA.jsx)("button",{onClick:()=>y(!g),className:"text-sm text-blue-500 hover:underline",children:g?l("Hide"):l("Show")})]}),g&&(0,mA.jsxs)("div",{className:"space-y-3",children:[(0,mA.jsxs)("label",{className:"flex cursor-pointer items-center gap-2",children:[(0,mA.jsx)("input",{type:"checkbox",checked:h.useCustomTemplate,onChange:()=>w("useCustomTemplate"),className:"checkbox checkbox-sm"}),(0,mA.jsx)("span",{className:"text-sm font-medium",children:l("Use Custom Template")})]}),h.useCustomTemplate&&(0,mA.jsxs)(mA.Fragment,{children:[(0,mA.jsxs)("div",{className:"space-y-2",children:[(0,mA.jsx)("label",{className:"text-sm font-medium",children:l("Export Template")}),(0,mA.jsx)("textarea",{value:h.customTemplate,onChange:e=>p({...h,customTemplate:e.target.value}),className:"textarea textarea-bordered w-full font-mono text-xs",rows:12,placeholder:d})]}),(0,mA.jsxs)("div",{className:"bg-base-200 space-y-3 rounded-lg p-3 text-xs",children:[(0,mA.jsxs)("div",{children:[(0,mA.jsx)("p",{className:"mb-2 font-bold",children:l("Template Syntax:")}),(0,mA.jsxs)("ul",{className:"space-y-1 font-mono",children:[(0,mA.jsxs)("li",{children:[(0,mA.jsx)("code",{className:"bg-base-300 rounded px-1",children:"{{ variable }}"})," -"," ",l("Insert value")]}),(0,mA.jsxs)("li",{children:[(0,mA.jsx)("code",{className:"bg-base-300 rounded px-1",children:"{{ variable | date }}"})," ","- ",l("Format date (locale)")]}),(0,mA.jsxs)("li",{children:[(0,mA.jsx)("code",{className:"bg-base-300 rounded px-1",children:"{{ variable | date('%Y-%m-%d') }}"})," ","- ",l("Format date (custom)")]}),(0,mA.jsxs)("li",{children:[(0,mA.jsx)("code",{className:"bg-base-300 rounded px-1",children:"{% if variable %}...{% endif %}"})," ","- ",l("Conditional")]}),(0,mA.jsxs)("li",{children:[(0,mA.jsx)("code",{className:"bg-base-300 rounded px-1",children:"{% for item in list %}...{% endfor %}"})," ","- ",l("Loop")]})]})]}),(0,mA.jsxs)("div",{children:[(0,mA.jsx)("p",{className:"mb-2 font-bold",children:l("Available Variables:")}),(0,mA.jsxs)("ul",{className:"space-y-1",children:[(0,mA.jsxs)("li",{children:[(0,mA.jsx)("code",{className:"bg-base-300 rounded px-1",children:"title"})," -"," ",l("Book title")]}),(0,mA.jsxs)("li",{children:[(0,mA.jsx)("code",{className:"bg-base-300 rounded px-1",children:"author"})," -"," ",l("Book author")]}),(0,mA.jsxs)("li",{children:[(0,mA.jsx)("code",{className:"bg-base-300 rounded px-1",children:"exportDate"})," -"," ",l("Export date")]}),(0,mA.jsxs)("li",{children:[(0,mA.jsx)("code",{className:"bg-base-300 rounded px-1",children:"chapters"})," -"," ",l("Array of chapters")]}),(0,mA.jsxs)("li",{className:"ml-4",children:[(0,mA.jsx)("code",{className:"bg-base-300 rounded px-1",children:"chapter.title"})," -"," ",l("Chapter title")]}),(0,mA.jsxs)("li",{className:"ml-4",children:[(0,mA.jsx)("code",{className:"bg-base-300 rounded px-1",children:"chapter.annotations"})," -"," ",l("Array of annotations")]}),(0,mA.jsxs)("li",{className:"ml-8",children:[(0,mA.jsx)("code",{className:"bg-base-300 rounded px-1",children:"annotation.text"})," -"," ",l("Highlighted text")]}),(0,mA.jsxs)("li",{className:"ml-8",children:[(0,mA.jsx)("code",{className:"bg-base-300 rounded px-1",children:"annotation.note"})," -"," ",l("Annotation note")]}),(0,mA.jsxs)("li",{className:"ml-8",children:[(0,mA.jsx)("code",{className:"bg-base-300 rounded px-1",children:"annotation.timestamp"})," -"," ",l("Update time")]})]})]}),(0,mA.jsxs)("div",{children:[(0,mA.jsx)("p",{className:"mb-2 font-bold",children:l("Date Format Tokens:")}),(0,mA.jsxs)("ul",{className:"space-y-1 font-mono",children:[(0,mA.jsxs)("li",{children:[(0,mA.jsx)("code",{className:"bg-base-300 rounded px-1",children:"%Y"})," -"," ",l("Year (4 digits)")]}),(0,mA.jsxs)("li",{children:[(0,mA.jsx)("code",{className:"bg-base-300 rounded px-1",children:"%m"})," -"," ",l("Month (01-12)")]}),(0,mA.jsxs)("li",{children:[(0,mA.jsx)("code",{className:"bg-base-300 rounded px-1",children:"%d"})," - ",l("Day (01-31)")]}),(0,mA.jsxs)("li",{children:[(0,mA.jsx)("code",{className:"bg-base-300 rounded px-1",children:"%H"})," - ",l("Hour (00-23)")]}),(0,mA.jsxs)("li",{children:[(0,mA.jsx)("code",{className:"bg-base-300 rounded px-1",children:"%M"})," -"," ",l("Minute (00-59)")]}),(0,mA.jsxs)("li",{children:[(0,mA.jsx)("code",{className:"bg-base-300 rounded px-1",children:"%S"})," -"," ",l("Second (00-59)")]})]})]})]})]})]})]}),(0,mA.jsxs)("div",{className:"space-y-2",children:[(0,mA.jsxs)("div",{className:"flex items-center justify-between",children:[(0,mA.jsx)("h3",{className:"font-bold",children:l("Preview")}),(0,mA.jsxs)("label",{className:"flex cursor-pointer items-center gap-2",children:[(0,mA.jsx)("input",{type:"checkbox",checked:b,onChange:()=>m(!b),className:"checkbox checkbox-sm"}),(0,mA.jsx)("span",{className:"text-sm",children:l("Show Source")})]})]}),b?(0,mA.jsx)("div",{className:(0,mT.default)("bg-base-200 max-h-[40vh] overflow-y-auto rounded-lg p-4 font-mono text-xs","select-text whitespace-pre-wrap break-words"),children:v||l("No content to preview")}):(0,mA.jsx)("div",{className:(0,mT.default)("bg-base-200 prose prose-sm max-w-none overflow-y-auto rounded-lg p-4","max-h-[40vh] select-text break-words"),dangerouslySetInnerHTML:{__html:x||`<p class="text-base-content/50">${l("No content to preview")}</p>`}})]}),(0,mA.jsxs)("div",{className:"mt-4 flex justify-end gap-4",children:[(0,mA.jsx)("button",{onClick:o,className:"btn btn-ghost btn-sm",children:l("Cancel")}),(0,mA.jsx)("button",{onClick:S,className:"btn btn-primary btn-sm",disabled:0===i.length,children:l("Export")})]})]})})},mz=({bookKey:e})=>{let t=(0,pX.useTranslation)(),{envConfig:r,appService:n}=(0,pH.useEnv)(),{settings:i}=(0,pK.useSettingsStore)(),{isDarkMode:a}=(0,pV.useThemeStore)(),{getConfig:o,saveConfig:s,getBookData:l,updateBooknotes:c}=(0,pW.useBookDataStore)(),{getProgress:f,getView:u,getViewsById:d,getViewSettings:h}=(0,pG.useReaderStore)(),{setNotebookVisible:p,setNotebookNewAnnotation:b}=w(),{listenToNativeTouchEvents:m}=(0,pZ.useDeviceControlStore)();p6(e);let g=(0,pq.getOSPlatform)(),y=o(e),v=f(e),x=l(e),S=u(e),k=h(e),_=x.book?.primaryLanguage||"en",E=pz.default.useRef(null),[M,N]=(0,pz.useState)(null),[A,T]=(0,pz.useState)(!1),[R,C]=(0,pz.useState)(!1),[j,I]=(0,pz.useState)(!1),[L,P]=(0,pz.useState)(!1),[B,O]=(0,pz.useState)(!1),[D,z]=(0,pz.useState)(),[F,U]=(0,pz.useState)(),[$,H]=(0,pz.useState)(),[q,V]=(0,pz.useState)(),[W,K]=(0,pz.useState)(),[G,X]=(0,pz.useState)(!1),[Y,Z]=(0,pz.useState)(!1),[J,Q]=(0,pz.useState)([]),[ee,et]=(0,pz.useState)(null),[er,en]=(0,pz.useState)(!1),[ei,ea]=(0,pz.useState)(null),[eo,es]=(0,pz.useState)(i.globalReadSettings.highlightStyle),[el,ec]=(0,pz.useState)(i.globalReadSettings.highlightStyles[eo]),ef=A||R||j||L||B,eu=(0,pY.useResponsiveSize)(10),ed=2*eu+6,eh=window.innerWidth-2*eu,ep=window.innerHeight-2*eu,eb=Math.min(480,eh),em=Math.min(300,ep),eg=Math.min(480,eh),ey=Math.min(265,ep),ev=Math.min(440,eh),ex=Math.min(200,ep),ew=Math.min((0,pY.useResponsiveSize)(300),eh),eS=(0,pY.useResponsiveSize)(44),ek=0,e_=(0,pz.useCallback)(()=>{if(!M||!M.text)return;let t=document.querySelector(`#gridcell-${e}`);if(!t)return;let r=t.getBoundingClientRect(),n=hH(M,r,ed,k.vertical),i=hq(n,r,k.vertical?eS:ew,k.vertical?ew:eS,eu);"down"===i.dir&&"android"===g&&(n.point.y+=ek,i.point.y+=ek);let a=hq(n,r,eb,em,eu),o=hq(n,r,eg,ey,eu),s=hq(n,r,ev,ex,eu);0!=n.point.x&&0!=n.point.y&&(U(i),H(a),V(o),K(s),z(n))},[M,e,k.vertical]);(0,pz.useEffect)(()=>{es(i.globalReadSettings.highlightStyle)},[i.globalReadSettings.highlightStyle]),(0,pz.useEffect)(()=>{ec(i.globalReadSettings.highlightStyles[eo])},[i.globalReadSettings.highlightStyles,eo]);let eE=(0,pz.useMemo)(()=>({bookKey:e,viewSettings:h(e),userLocale:(0,pq.getLocale)(),content:"",transformers:["punctuation"],reversePunctuationTransform:!0}),[]),eM=(0,pz.useCallback)(async e=>(eE.content=hV(e,_.startsWith("ja")?["rt"]:[]),await c_(eE)),[_,eE]),eN=(0,pz.useCallback)((0,bf.throttle)(()=>{N(null),T(!1),C(!1),I(!1),P(!1),O(!1),et(null)},500),[]),{isTextSelected:eA,handleScroll:eT,handleTouchStart:eR,handleTouchMove:eC,handleTouchEnd:ej,handlePointerDown:eI,handlePointerMove:eL,handlePointerCancel:eP,handlePointerUp:eB,handleSelectionchange:eO,handleShowPopup:eD,handleUpToPopup:ez,handleContextmenu:eF}=bs(e,N,eM,eN),eU=()=>{eN(),S?.deselect(),eA.current=!1},e$=t=>{let r=t.detail,{doc:i,index:a}=r,o=e=>{T(!1),et(null),eC(e)},s=e=>{let t=e.detail;"touchstart"===t.type?eR():"touchend"===t.type&&(ej(),eB(i,a))};n?.isAndroidApp&&(m(),bl.eventDispatcher.on("native-touch",s)),S?.renderer?.addEventListener("scroll",eT),S?.renderer?.addEventListener("scroll",()=>{e_()});let l={passive:!1};r.doc?.addEventListener("touchstart",eR,l),r.doc?.addEventListener("touchmove",o,l),r.doc?.addEventListener("touchend",ej),r.doc?.addEventListener("pointerdown",eI.bind(null,i,a),l),r.doc?.addEventListener("pointermove",eL.bind(null,i,a),l),r.doc?.addEventListener("pointercancel",eP.bind(null,i,a)),r.doc?.addEventListener("pointerup",eB.bind(null,i,a)),r.doc?.addEventListener("selectionchange",eO.bind(null,i,a)),x.book?.format==="PDF"&&r.doc?.addEventListener("contextmenu",t=>{try{let t=i.getSelection?.();if(t&&!t.isCollapsed){let r=t.getRangeAt(0),n=t.toString();n.trim()&&(N({key:e,text:n,range:r,index:a,cfi:S?.getCFI(a,r)}),T(!1),P(!0),C(!1),I(!1))}}catch(e){console.warn("PDF context menu translation failed:",e)}return t.preventDefault(),t.stopPropagation(),!1}),r.doc?.addEventListener("contextmenu",eF)};sr(S,{onLoad:e$,onDrawAnnotation:t=>{let r=h(e),o=r.isEink,{draw:s,annotation:l,doc:c,range:f}=t.detail,{style:u,color:d}=l,p=fi(i,d),b=a?"#000000":"#ffffff",m=a?"#ffffff":"#000000";if(l.note){let{defaultView:e}=c,t=f.startContainer,r=1===t.nodeType?t:t.parentElement,{writingMode:n}=e.getComputedStyle(r);s(p$.Overlayer.bubble,{writingMode:n})}else if("highlight"===u)s(p$.Overlayer.highlight,{color:o?b:p});else if(["underline","squiggly"].includes(u)){let{defaultView:e}=c,t=f.startContainer,i=1===t.nodeType?t:t.parentElement,{writingMode:a,lineHeight:l,fontSize:d}=e.getComputedStyle(i),h=parseFloat(d)||r.defaultFontSize,b=parseFloat(l)||r.lineHeight*h,g=2,y=n?.isMobile?0:-1,v=n?.isMobile?-1:0,x=r.vertical?(b-h)/2-g+y:(b-h)/2-g+v;s(p$.Overlayer[u],{writingMode:a,color:o?m:p,padding:x})}},onShowAnnotation:t=>{let r=t.detail,{value:n,index:i,range:a}=r,{booknotes:s=[]}=o(e),l=n.startsWith(iv),c=l?n.replace(iv,""):n,f=s.filter(e=>"annotation"===e.type&&!e.deletedAt&&e.cfi===c).find(e=>!l&&e.style||l&&e.note);if(!f)return;let{style:u,color:d,text:h,note:p}=f,b={key:e,annotated:!0,text:h??"",note:p??"",rect:l?r.rect:void 0,cfi:c,range:a,index:i};l?(Z(!0),X(!1),et(null)):(Z(!1),Q([]),u&&d&&(es(u),ec(d)),u&&a&&et(f)),N(b),ez()}}),(0,pz.useEffect)(()=>{eD(ef)},[ef]),(0,pz.useEffect)(()=>{let t=u(e);if(!t?.renderer)return;let r=()=>{ef&&e_()};return t.renderer.addEventListener("scroll",r),()=>{t.renderer.removeEventListener("scroll",r)}},[e,ef,e_]),(0,pz.useEffect)(()=>(bl.eventDispatcher.on("export-annotations",e1),()=>{bl.eventDispatcher.off("export-annotations",e1)}),[]);let eH=()=>{switch(k.annotationQuickAction){case"copy":eV(!1),eU();break;case"highlight":eU();break;case"search":eG();break;case"dictionary":eX();break;case"wikipedia":eY();break;case"translate":eZ();break;case"tts":eJ(!0)}};(0,pz.useEffect)(()=>{if(X(!!(M&&M.annotated)),M&&M.text.trim().length>0){let t=document.querySelector(`#gridcell-${e}`);if(!t)return;let r=t.getBoundingClientRect(),n=hH(M,r,ed,k.vertical),i=hq(n,r,k.vertical?eS:ew,k.vertical?ew:eS,eu);"down"===i.dir&&"android"===g&&(n.point.y+=ek,i.point.y+=ek);let a=hq(n,r,eb,em,eu),o=hq(n,r,eg,ey,eu),s=hq(n,r,ev,ex,eu);if(0==n.point.x||0==n.point.y)return;U(i),H(a),V(o),K(s),z(n);let{enableAnnotationQuickActions:l,annotationQuickAction:c}=k;l&&c&&eA.current?eH():eq()}},[M,e]),(0,pz.useEffect)(()=>{if(!v)return;let{location:e}=v,{booknotes:t=[]}=y,r=t.filter(t=>!t.deletedAt&&"annotation"===t.type&&t.style&&ik(t.cfi,e)),n=t.filter(t=>!t.deletedAt&&"annotation"===t.type&&t.note&&t.note.trim().length>0&&ik(t.cfi,e));try{Promise.all(r.map(e=>S?.addAnnotation(e))),Promise.all(n.map(e=>S?.addAnnotation({...e,value:`${iv}${e.cfi}`})))}catch(e){console.warn(e)}},[v]),(0,pz.useEffect)(()=>{y.booknotes&&M?.cfi&&Y&&Q(y.booknotes.filter(e=>"annotation"===e.type&&!e.deletedAt&&e.cfi===M.cfi).filter(e=>e.note&&e.note.trim().length>0))},[M?.cfi,Y,y.booknotes]);let eq=()=>{n?.isMobile||E.current?.focus(),T(!0),P(!1),C(!1),I(!1)},eV=(a=!0)=>{if(!M||!M.text||(setTimeout(()=>{navigator.clipboard?.writeText(M.text)},100),a&&eU(),!k?.copyToNotebook))return;bl.eventDispatcher.dispatch("toast",{type:"info",message:t("Copied to notebook"),className:"whitespace-nowrap",timeout:2e3});let{booknotes:o=[]}=y,l=S?.getCFI(M.index,M.range);if(!l)return;let f={id:(0,pq.uniqueId)(),type:"excerpt",cfi:l,text:M.text,note:"",createdAt:Date.now(),updatedAt:Date.now()},u=o.findIndex(e=>e.cfi===l&&"excerpt"===e.type&&!e.deletedAt);-1!==u?o[u]=f:o.push(f);let d=c(e,o);d&&s(r,e,d,i),n?.isMobile||p(!0)},eW=(t=!1,n)=>{if(!M||!M.text)return;X(!0);let{booknotes:a=[]}=y,o=S?.getCFI(M.index,M.range);if(!o)return;let l=n||i.globalReadSettings.highlightStyle,f=i.globalReadSettings.highlightStyles[l],u={id:(0,pq.uniqueId)(),type:"annotation",cfi:o,style:l,color:f,text:M.text,note:"",createdAt:Date.now(),updatedAt:Date.now()},h=a.findIndex(e=>e.cfi===o&&"annotation"===e.type&&e.style&&!e.deletedAt),p=d(e.split("-")[0]);-1!==h?(p.forEach(e=>e?.addAnnotation(u,!0)),t?(u.id=a[h].id,a[h]=u,p.forEach(e=>e?.addAnnotation(u))):(a[h].deletedAt=Date.now(),eN())):(a.push(u),p.forEach(e=>e?.addAnnotation(u)),N({...M,cfi:o,annotated:!0}));let b=c(e,a);b&&s(r,e,b,i)},eK=()=>{if(!M||!M.text)return;let{sectionHref:e}=v;M.href=e,eW(!0),p(!0),b(M),eN()},eG=()=>{if(!M||!M.text)return;eU();let t=M.text,r=k.convertChineseVariant;r&&"none"!==r&&(t=(0,bu.runSimpleCC)(t,r,!0)),bl.eventDispatcher.dispatch("search-term",{term:t,bookKey:e})},eX=()=>{M&&M.text&&(T(!1),C(!0))},eY=()=>{M&&M.text&&(T(!1),I(!0))},eZ=()=>{M&&M.text&&(T(!1),P(!0))},eJ=async(t=!1)=>{M&&M.text&&(T(!1),bl.eventDispatcher.dispatch("tts-speak",{bookKey:e,range:M.range,oneTime:t}))},eQ=()=>{if(M&&M.text&&(T(!1),O(!0),bb(M.text)>30))return void bl.eventDispatcher.dispatch("toast",{type:"warning",message:t("Word limit of 30 words exceeded."),timeout:3e3})},e0=(0,pz.useCallback)(()=>{T(!1)},[]);(0,mg.default)({onHighlightSelection:()=>{eW(!1,"highlight")},onUnderlineSelection:()=>{eW(!1,"underline")},onAnnotateSelection:()=>{eK()},onSearchSelection:()=>{eG()},onCopySelection:()=>{eV(!1)},onTranslateSelection:()=>{eZ()},onDictionarySelection:()=>{eX()},onWikipediaSelection:()=>{eY()},onReadAloudSelection:()=>{eJ()},onProofreadSelection:()=>{eQ()}},[M?.text]);let e1=async r=>{let{bookKey:n}=r.detail;if(e!==n)return;let{bookDoc:i,book:a}=x;if(!i||!a||!i.toc)return;let{booknotes:s=[]}=o(e),l=s.filter(e=>!e.deletedAt);if(0===l.length)return void bl.eventDispatcher.dispatch("toast",{type:"info",message:t("No annotations to export"),className:"whitespace-nowrap",timeout:2e3});let c={};for(let e of l){let t=(0,bc.findTocItemBS)(i.toc??[],e.cfi),r=t?.href||"",n=t?.label||"",a=t?.id||0;c[r]||(c[r]={id:a,href:r,label:n,booknotes:[]}),c[r].booknotes.push(e)}Object.values(c).forEach(e=>{e.booknotes.sort((e,t)=>pU.compare(e.cfi,t.cfi))}),ea({booknotes:l,booknoteGroups:c}),en(!0)},e2=async e=>{let{book:r}=x;if(!r)return;setTimeout(()=>{navigator.clipboard?.writeText(e)},100);let i=`${(0,pq.makeSafeFilename)(r.title)}.md`,a=await n?.saveFile(i,e,"text/markdown");bl.eventDispatcher.dispatch("toast",{type:"info",message:a?t("Exported successfully"):t("Copied to clipboard"),timeout:2e3}),en(!1),ea(null)},e3=()=>{en(!1),ea(null)},e6=M?.annotated,e4=bm.annotationToolButtons.map(({type:e,label:r,Icon:n})=>{switch(e){case"copy":return{tooltipText:t(r),Icon:n,onClick:eV};case"highlight":return{tooltipText:e6?t("Delete Highlight"):t(r),Icon:e6?pF.RiDeleteBinLine:n,onClick:eW,disabled:x.book?.format==="PDF"};case"annotate":return{tooltipText:t(r),Icon:n,onClick:eK,disabled:x.book?.format==="PDF"};case"search":return{tooltipText:t(r),Icon:n,onClick:eG,disabled:x.book?.format==="PDF"};case"dictionary":return{tooltipText:t(r),Icon:n,onClick:eX};case"wikipedia":return{tooltipText:t(r),Icon:n,onClick:eY};case"translate":return{tooltipText:t(r),Icon:n,onClick:eZ};case"tts":return{tooltipText:t(r),Icon:n,onClick:eJ,disabled:x.book?.format==="PDF"};case"proofread":return{tooltipText:t(r),Icon:n,onClick:eQ,disabled:x.book?.format!=="EPUB"};default:return{tooltipText:"",Icon:n,onClick:()=>{}}}});return(0,pD.jsxs)("div",{ref:E,role:"toolbar",tabIndex:-1,children:[R&&D&&$&&(0,pD.jsx)(me,{word:M?.text,lang:x.bookDoc?.metadata.language,position:$,trianglePosition:D,popupWidth:eb,popupHeight:em,onDismiss:eU}),j&&D&&$&&(0,pD.jsx)(mi,{text:M?.text,lang:x.bookDoc?.metadata.language,position:$,trianglePosition:D,popupWidth:eb,popupHeight:em,onDismiss:eU}),L&&D&&q&&(0,pD.jsx)(mm,{text:M?.text,position:q,trianglePosition:D,popupWidth:eg,popupHeight:ey,onDismiss:eU}),A&&D&&F&&(0,pD.jsx)(b8,{bookKey:e,dir:k.rtl?"rtl":"ltr",isVertical:k.vertical,buttons:e4,notes:J,position:F,trianglePosition:D,highlightOptionsVisible:G,selectedStyle:eo,selectedColor:el,popupWidth:ew,popupHeight:eS,onHighlight:eW,onDismiss:eU}),B&&D&&W&&M&&(0,pD.jsx)(mN,{bookKey:e,selection:M,position:W,trianglePosition:D,popupWidth:ev,popupHeight:ex,onDismiss:eU}),ee&&ee.color&&M&&(0,pD.jsx)(bR,{bookKey:e,isVertical:k.vertical,annotation:ee,selection:M,handleColor:el,getAnnotationText:eM,setSelection:N,onStartEdit:e0}),er&&ei&&x.book&&(0,pD.jsx)(mD,{bookKey:e,isOpen:er,bookTitle:x.book.title,bookAuthor:x.book.author||"",booknotes:ei.booknotes,booknoteGroups:ei.booknoteGroups,onCancel:e3,onExport:e2})]})};var mF=t,mU=r,m$=m,mH=ec,mq=o3,mV=tu;let mW=e=>new Set([...e?.getAttributeNS?.("http://www.idpf.org/2007/ops","type")?.split(" ")??[],...e?.attributes?.getNamedItem?.("epub:type")?.value?.split(" ")??[]]),mK=e=>new Set(e?.getAttribute?.("role")?.split(" ")),mG=e=>{if(e.matches("sup"))return!0;let{verticalAlign:t}=getComputedStyle(e);return"super"===t||"top"===t||"text-top"===t||/^\d/.test(t)},mX=["biblioref","glossref","noteref"],mY=["doc-biblioref","doc-glossref","doc-noteref"],mZ=e=>{let t=mW(e),r=mK(e);return{yes:mY.some(e=>r.has(e))||mX.some(e=>t.has(e)),maybe:()=>!t.has("backlink")&&!r.has("doc-backlink")&&(mG(e)||1===e.children.length&&mG(e.children[0])||mG(e.parentElement))}},mJ=e=>{let t=mW(e),r=mK(e);return r.has("doc-biblioentry")||t.has("biblioentry")?"biblioentry":r.has("definition")||t.has("glossdef")?"definition":r.has("doc-endnote")||t.has("endnote")||t.has("rearnote")?"endnote":r.has("doc-footnote")||t.has("footnote")?"footnote":r.has("note")||t.has("note")?"note":null},mQ="a, span, sup, sub, em, strong, i, b, small, big",m0=(e,t)=>{let r=t(e),n=r;for(;r.matches(mQ);){let e=r.parentElement;if(!e)break;r=e}if(r===e.body){let e=n.nextElementSibling;if(e&&!e.matches(mQ))return e;throw Error("Failed to extract footnote")}return r};class m1 extends EventTarget{detectFootnotes=!0;#E(e,{index:t,anchor:r},n){let i=document.createElement("foliate-view");return new Promise((a,o)=>{i.addEventListener("load",e=>{try{let{doc:t}=e.detail,o=r(t),s=mJ(o),l=o?.matches?.("aside")&&"footnote"===s;if(o){let e;if(o.startContainer)e=o;else if(o.matches("li, aside"))(e=t.createRange()).selectNodeContents(o);else if(o.matches("dt")){(e=t.createRange()).setStartBefore(o);let r=o.nextElementSibling,n=null;for(;r&&r.matches("dd");)n=r,r=r.nextElementSibling;e.setEndAfter(n||o)}else if(o.closest("li"))(e=t.createRange()).selectNodeContents(o.closest("li"));else if(o.closest(".note"))(e=t.createRange()).selectNodeContents(o.closest(".note"));else if(o.querySelector("a")){(e=t.createRange()).setStartBefore(o);let r=o.nextElementSibling;for(;r&&!r.querySelector("a");)r=r.nextElementSibling;r?e.setEndBefore(r):e.setEndAfter(o.parentNode.lastChild)}else e=t.createRange(),!(o.textContent?.trim()||o.children.length>0)&&o.parentElement?e.selectNodeContents(o.parentElement):e.selectNode(o);let r=e.extractContents();t.body.replaceChildren(),t.body.appendChild(r)}let c={view:i,href:n,type:s,hidden:l,target:o};this.dispatchEvent(new CustomEvent("render",{detail:c})),a()}catch(e){o(e)}}),i.open(e).then(()=>this.dispatchEvent(new CustomEvent("before-render",{detail:{view:i}}))).then(()=>i.goTo(t)).catch(o)})}handle(e,t){let{a:r,href:n,follow:i}=t.detail,{yes:a,maybe:o}=mZ(r);return a||i?(t.preventDefault(),Promise.resolve(e.resolveHref(n)).then(t=>this.#E(e,t,n))):this.detectFootnotes&&o()?(t.preventDefault(),Promise.resolve(e.resolveHref(n)).then(({index:t,anchor:r})=>{let i={index:t,anchor:e=>m0(e,r)};return this.#E(e,i,n)})):void 0}}var m2=R,m3=M,m6=af,m4=tW;let m8=360,m5=88,m9=10,m7=({bookKey:e,bookDoc:t})=>{let r=(0,mU.useRef)(null),n=(0,mU.useRef)(null),[i,a]=(0,mU.useState)(),[o,s]=(0,mU.useState)(),[l,c]=(0,mU.useState)(!1),{getBookData:f}=(0,mH.useBookDataStore)(),{getView:u,getViewSettings:d}=(0,m$.useReaderStore)(),{getLoadedFonts:h}=(0,mq.useCustomFontStore)(),p=u(e),b=d(e),m=new m1,g=(0,mU.useRef)(null),[y,v]=(0,mU.useState)(null),[x,w]=(0,mU.useState)(m8),[S,k]=(0,mU.useState)(m5),_=(e,t)=>Math.min(e,(t?window.innerWidth/2:window.innerHeight/2)-m9-12),E=e=>Math.min(e,window.innerWidth-m9-12),M=e=>Math.min(e,window.innerHeight-m9-12);(0,mU.useEffect)(()=>{let i=i=>{let{view:a}=i.detail;a.addEventListener("link",r=>{r.preventDefault();let{detail:n}=r;n.follow=!0,m.handle(t,r)?.catch(t=>{console.warn(t),u(e)?.goTo(n.href)})}),a.addEventListener("load",t=>{let{doc:r}=t.detail,n=f(e);(0,m2.mountAdditionalFonts)(r,(0,m6.isCJKLang)(n.book?.primaryLanguage)),h().forEach(e=>{(0,m2.mountCustomFont)(r,e)})}),n.current=a,r.current?.replaceChildren(a);let{renderer:o}=a;o.setAttribute("flow","scrolled"),o.setAttribute("margin-top","0px"),o.setAttribute("margin-right","0px"),o.setAttribute("margin-bottom","0px"),o.setAttribute("margin-left","0px"),o.setAttribute("gap","0%");let s=d(e),l={...(0,mV.getThemeCode)()},c=document.getElementById("popup-container");c&&(l.bg=getComputedStyle(c).backgroundColor);let p=(0,mV.getStyles)(s,l),b=(0,mV.getFootnoteStyles)();o.setStyles?.(`${p}
${b}`)},a=t=>{let{view:r}=t.detail;r.addEventListener("relocate",()=>{let{renderer:t}=r;d(e).vertical?w(E(_(t.viewSize,!0))):k(M(_(t.viewSize,!1))),c(!0)})};return m.addEventListener("before-render",i),m.addEventListener("render",a),()=>{m.removeEventListener("before-render",i),m.removeEventListener("render",a)}},[p]),(0,mU.useEffect)(()=>{l&&g.current?.focus()},[l]),(0,mU.useEffect)(()=>{b.vertical?(w(E(m5)),k(M(Math.max(m8,window.innerHeight/4)))):(w(E(Math.max(m8,window.innerWidth/4))),k(M(m5)))},[b]),(0,mU.useEffect)(()=>{i&&y&&s(hq(i,y,x,S,m9))},[i,y,x,S]);let N=async r=>{let n=r.detail,i=document.querySelector(`#gridcell-${e}`);if(!i)return;let o=i.getBoundingClientRect(),s=d(e),l=hH(n.a,o,m9,s.vertical);v(o),a(l);let{a:c}=n;["duokan-footnote","footnote-link","footnote"].some(e=>c.classList.contains(e))&&(n.follow=!0),m.handle(t,r)?.catch(e=>{console.warn(e);let t=r.detail;p?.goTo(t.href)})},A=()=>{let e=r.current?.querySelector("foliate-view");e?.close(),e?.remove()},T=()=>{A(),v(null),s(null),a(null),c(!1)},R=t=>{let{element:n,footnote:i}=t.detail,o=document.querySelector(`#gridcell-${e}`);if(!o)return;let s=o.getBoundingClientRect(),l=d(e),f=hH(n,s,m9,l.vertical);if(r.current){let e=document.createElement("p");e.textContent=i,e.setAttribute("style","padding: 1em; hanging-punctuation: allow-end last;"),e.style.visibility="hidden",l.vertical?e.style.height=`${S}px`:e.style.width=`${x}px`,document.body.appendChild(e);let t=e.getBoundingClientRect();l.vertical?w(_(t.width,!0)):k(_(t.height,!1)),document.body.removeChild(e),e.style.visibility="visible",r.current.replaceChildren(e),v(s),a(f),c(!0)}};return sr(p,{onLinkClick:N}),(0,mU.useEffect)(()=>(window.addEventListener("resize",T),m3.eventDispatcher.on("footnote-popup",R),()=>{window.removeEventListener("resize",T),m3.eventDispatcher.off("footnote-popup",R)}),[]),(0,mU.useEffect)(()=>{n.current&&r.current?.replaceChildren(n.current)},[r]),(0,mF.jsxs)("div",{ref:g,role:"toolbar",tabIndex:-1,children:[l&&(0,mF.jsx)(m4.Overlay,{onDismiss:T}),(0,mF.jsx)(h3,{isOpen:l,width:x,height:S,position:l?o:void 0,trianglePosition:l?i:void 0,className:"select-text overflow-y-auto",onDismiss:T,children:(0,mF.jsx)("div",{className:"footnote-content",ref:r,style:{width:`${x}px`,height:`${S}px`}})})]})};var ge=t,gt=c,gr=r,gn=n,gi=b,ga=M;let go=({bookKey:e,showDoubleBorder:t,isScrolled:r,isVertical:n,isEink:i,horizontalGap:a,contentInsets:o,gridInsets:s})=>{let{appService:l}=(0,gn.useEnv)(),{systemUIVisible:c,statusBarHeight:f}=(0,gi.useThemeStore)(),u=Math.max(s.top,l?.isAndroidApp&&c?f/2:0),[d,h]=gr.default.useState(null),p=(0,gr.useRef)(2e3),b=(0,gr.useRef)(null),m=t=>{let{message:r,bookKey:n,timeout:i=2e3}=t.detail;n===e&&(h(r),p.current=i)};return((0,gr.useEffect)(()=>(ga.eventDispatcher.on("hint",m),()=>{ga.eventDispatcher.off("hint",m)}),[]),(0,gr.useEffect)(()=>(b.current&&clearTimeout(b.current),b.current=setTimeout(()=>h(""),p.current),()=>{b.current&&clearTimeout(b.current)}),[d]),d)?(0,ge.jsxs)(ge.Fragment,{children:[(0,ge.jsx)("div",{className:(0,gt.default)("absolute left-0 right-0 top-0 z-10",d?"":"bg-transparent"),style:{height:`${u}px`}}),(0,ge.jsx)("div",{className:(0,gt.default)("hintinfo absolute flex items-center justify-end overflow-hidden ps-2",d?"":"bg-transparent",n?"writing-vertical-rl":"top-0 h-[44px]",r?n?"h-full":"w-full":n?"max-h-[50%]":"max-w-[50%]"),style:n?{bottom:`${(o.bottom-s.bottom)*1.5}px`,right:t?`calc(${o.right}px)`:`calc(${Math.max(0,o.right-32)}px)`,width:t?"30px":`${o.right}px`}:{top:`${u}px`,insetInlineEnd:`calc(${a/2}% + ${o.right/2}px)`},children:(0,ge.jsx)("h2",{className:(0,gt.default)("text-center font-sans",i?"text-sm font-normal":"text-neutral-content text-xs font-light"),children:d||""})})]}):null};var gs=t;let gl=10,gc=({borderColor:e,showHeader:t,showFooter:r,insets:n})=>(0,gs.jsxs)("div",{children:[(0,gs.jsx)("div",{className:"borderframe pointer-events-none absolute",style:{border:`4px solid ${e}`,height:`calc(100% - ${n.top+n.bottom}px + ${2*gl}px)`,top:`calc(${n.top}px - ${gl}px)`,left:`calc(${n.left}px - ${gl}px)`,right:`calc(${n.right}px - ${gl}px)`}}),(0,gs.jsx)("div",{className:"borderframe pointer-events-none absolute",style:{border:`1px solid ${e}`,height:`calc(100% - ${n.top+n.bottom}px)`,top:`${n.top}px`,left:`calc(${n.left+32*!!r}px`,right:`calc(${n.right+32*!!t}px`}}),r&&(0,gs.jsx)("div",{className:"borderframe pointer-events-none absolute",style:{borderTop:`1px solid ${e}`,borderBottom:`1px solid ${e}`,borderLeft:`1px solid ${e}`,width:"32px",height:`calc(100% - ${n.top+n.bottom}px)`,top:`${n.top}px`,left:`calc(${n.left}px)`}}),t&&(0,gs.jsx)("div",{className:"borderframe pointer-events-none absolute",style:{borderTop:`1px solid ${e}`,borderBottom:`1px solid ${e}`,borderRight:`1px solid ${e}`,width:"32px",height:`calc(100% - ${n.top+n.bottom}px)`,top:`${n.top}px`,left:`calc(100% - ${n.right}px - 32px)`}})]}),gf=({bookKeys:e,onCloseBook:t})=>{let r=(0,ox.useTranslation)(),{appService:n}=(0,om.useEnv)(),{getConfig:i,getBookData:a}=(0,ov.useBookDataStore)(),{getProgress:o,getViewState:s,getViewSettings:l}=(0,oy.useReaderStore)(),{setGridInsets:c,hoveredBookKey:f}=(0,oy.useReaderStore)(),{sideBarBookKey:u}=x(),{safeAreaInsets:d}=(0,og.useThemeStore)(),h=window.innerWidth/window.innerHeight,p=ow(e.length,h);(0,ob.useEffect)(()=>{if(!u)return;let e=a(u);e&&e.book&&(document.title=e.book.title)},[u]);let b=(e,t)=>{if(!d)return{top:0,right:0,bottom:0,left:0};let{top:r,right:n,bottom:i,left:a}=oS(e,t,h);return{top:r?d.top:0,right:n?d.right:0,bottom:i?d.bottom:0,left:a?d.left:0}};return((0,ob.useEffect)(()=>{d&&e.forEach((t,r)=>{c(t,b(r,e.length))})},[e,d]),d)?(0,oh.jsx)("div",{className:(0,op.default)("books-grid bg-base-100 relative grid h-full flex-grow"),style:{gridTemplateColumns:p.columns,gridTemplateRows:p.rows},role:"main","aria-label":r("Books Content"),children:e.map((r,c)=>{let u=a(r),d=i(r),h=o(r),p=l(r),m=s(r),g=b(c,e.length),{book:y,bookDoc:v}=u||{};if(!y||!d||!v||!p||!m)return null;let{section:x,pageinfo:w,timeinfo:S,sectionLabel:k}=h||{},_=m.ribbonVisible,E=m.viewerKey,M=p.gapPercent,N=ok(p),A={top:g.top+N.top,right:g.right+N.right,bottom:g.bottom+N.bottom,left:g.left+N.left},T=p.scrolled,R=p.showBarsOnScroll,C=p.showHeader&&(!T||R),j=p.showFooter&&(!T||R);return(0,oh.jsxs)("div",{id:`gridcell-${r}`,className:(0,op.default)("relative h-full w-full overflow-hidden",n?.hasRoundedWindow&&"rounded-window"),children:[_&&!f&&(0,oh.jsx)(pO,{width:`${M}%`}),(0,oh.jsx)(u_,{bookKey:r,bookTitle:y.title,isTopLeft:0===c,isHoveredAnim:e.length>2,onCloseBook:t,gridInsets:g}),(0,oh.jsx)(cK,{bookKey:r,bookDoc:v,config:d,gridInsets:g,contentInsets:A},E),p.vertical&&p.scrolled&&(0,oh.jsxs)(oh.Fragment,{children:[(j||p.doubleBorder)&&(0,oh.jsx)("div",{className:"bg-base-100 absolute left-0 top-0 h-full",style:{width:`calc(${A.left+32*!!j}px)`,height:"calc(100%)"}}),(C||p.doubleBorder)&&(0,oh.jsx)("div",{className:"bg-base-100 absolute right-0 top-0 h-full",style:{width:`calc(${A.right+32*!!C}px)`,height:"calc(100%)"}})]}),p.vertical&&p.doubleBorder&&(0,oh.jsx)(gc,{showHeader:C,showFooter:j,borderColor:p.borderColor,horizontalGap:M,insets:N}),C&&(0,oh.jsx)(c0,{bookKey:r,section:k,showDoubleBorder:p.vertical&&p.doubleBorder,isScrolled:p.scrolled,isVertical:p.vertical,isEink:p.isEink,horizontalGap:M,contentInsets:A,gridInsets:g}),(0,oh.jsx)(go,{bookKey:r,showDoubleBorder:p.vertical&&p.doubleBorder,isScrolled:p.scrolled,isVertical:p.vertical,isEink:p.isEink,horizontalGap:M,contentInsets:A,gridInsets:g}),j&&(0,oh.jsx)(pI,{bookKey:r,section:x,pageinfo:w,timeinfo:S,horizontalGap:M,contentInsets:A,gridInsets:g}),(0,oh.jsx)(mz,{bookKey:r}),(0,oh.jsx)(oD,{bookKey:r,gridInsets:g}),(0,oh.jsx)(oG,{bookKey:r,gridInsets:g,toc:v.toc||[]}),(0,oh.jsx)(m7,{bookKey:r,bookDoc:v}),(0,oh.jsx)(p_,{bookKey:r,bookFormat:y.format,section:x,pageinfo:w,isHoveredAnim:!1,gridInsets:g})]},r)})}):null};var gu=e.i(798525);let gd=({ids:e,settings:t})=>{let r=(0,e$.useTranslation)(),n=(0,eO.useRouter)(),i=(0,eO.useSearchParams)(),{envConfig:a,appService:o}=(0,eD.useEnv)(),{bookKeys:s,dismissBook:l,getNextBookKey:c}=ta(),{sideBarBookKey:f,setSideBarBookKey:u}=x(),{saveSettings:d}=(0,ez.useSettingsStore)(),{getConfig:h,getBookData:p,saveConfig:b}=(0,eF.useBookDataStore)(),{getView:m,setBookKeys:g,getViewSettings:y}=(0,eU.useReaderStore)(),{initViewState:v,getViewState:w,clearViewState:S}=(0,eU.useReaderStore)(),{isSettingsDialogOpen:k,settingsDialogBookKey:_}=(0,ez.useSettingsStore)(),[E,M]=(0,eB.useState)(null),N=(0,eB.useRef)(!1),[A,T]=(0,eB.useState)(!1),[R,C]=(0,eB.useState)(!1);tR({sideBarBookKey:f,bookKeys:s}),(0,eB.useEffect)(()=>{if(N.current)return;N.current=!0;let t=window.location.pathname,n=(e||i?.get("ids")||t.split("/reader/")[1]||"").split(e8.BOOK_IDS_SEPARATOR).filter(Boolean).map(e=>`${e}-${(0,eK.uniqueId)()}`);g(n);let o=new Set;console.log("Initialize books",n),n.forEach((e,t)=>{let n=e.split("-")[0],i=!o.has(n);o.add(n),w(e)||(v(a,n,e,i).catch(t=>{console.log("Error initializing book",e,t),C(!0),eX.eventDispatcher.dispatch("toast",{message:r("Unable to open book"),callback:()=>L(),timeout:2e3,type:"error"})}),0===t&&u(e))})},[]),(0,eB.useEffect)(()=>{let e=e=>(M(e.detail),!0);return eX.eventDispatcher.onSync("show-book-details",e),()=>{eX.eventDispatcher.offSync("show-book-details",e)}},[]),(0,eB.useEffect)(()=>{let e;if(s&&s.length>0){let e=ez.useSettingsStore.getState().settings,t=s.map(e=>e.split("-")[0]);e.lastOpenBooks?.toString()!==t.toString()&&(e.lastOpenBooks=t,d(a,e))}return(0,eW.isTauriAppPlatform)()&&(e=(0,eV.tauriHandleOnCloseWindow)(B)),window.addEventListener("beforeunload",B),eX.eventDispatcher.on("beforereload",B),eX.eventDispatcher.on("close-reader",B),eX.eventDispatcher.on("quit-app",B),()=>{window.removeEventListener("beforeunload",B),eX.eventDispatcher.off("beforereload",B),eX.eventDispatcher.off("close-reader",B),eX.eventDispatcher.off("quit-app",B),e?.then(e=>e())}},[s]);let j=async e=>{let t=h(e),{book:r}=p(e)||{},{isPrimary:n}=w(e)||{};if(n&&r&&t){let r=ez.useSettingsStore.getState().settings;eX.eventDispatcher.dispatch("sync-book-progress",{bookKey:e}),eX.eventDispatcher.dispatch("flush-kosync",{bookKey:e}),await b(a,e,t,r)}},I=async e=>{console.log("Closing book",e);let t=w(e);t?.isPrimary&&o?.isDesktopApp&&await e4(o);try{m(e)?.close(),m(e)?.remove()}catch{console.info("Error closing book",e)}eX.eventDispatcher.dispatch("tts-stop",{bookKey:e}),await j(e),S(e)},L=()=>{(0,eY.navigateToLibrary)(n,"",void 0,!0)},P=()=>{d(a,t),L()},B=(0,eG.throttle)(async()=>{let e=ez.useSettingsStore.getState().settings;await Promise.all(s.map(async e=>await I(e))),await d(a,e)},200),O=()=>{if(B(),(0,eW.isTauriAppPlatform)()){let e=(0,eq.getCurrentWindow)();"main"===e.label?L():e.close()}else L()},D=async e=>{if(I(e),f===e&&u(c(f)),l(e),0==s.filter(t=>t!==e).length){let e=await (0,eH.parseOpenWithFiles)(o)||[];if(o?.hasWindow){if(e.length>0)return(0,eV.tauriHandleOnCloseWindow)(B),await (0,eV.tauriHandleClose)();let t=(0,eq.getCurrentWindow)();if(t.label.startsWith("reader"))return await t.close()}P()}};if(!s||0===s.length)return null;let z=p(s[0]),F=y(s[0]);return z&&z.book&&z.bookDoc&&F?(0,eP.jsxs)("div",{className:"reader-content full-height flex",children:[(0,eP.jsx)(aL,{onGoToLibrary:O}),(0,eP.jsx)(gf,{bookKeys:s,onCloseBook:D}),k&&(0,eP.jsx)(gu.default,{bookKey:_}),(0,eP.jsx)(od,{}),E&&(0,eP.jsx)(e5.BookDetailModal,{isOpen:!!E,book:E,onClose:()=>M(null)})]}):(setTimeout(()=>T(!0),200),A&&!R&&(0,eP.jsx)("div",{className:"hero hero-content full-height",children:(0,eP.jsx)(tC.default,{loading:!0})}))},gh=({ids:e})=>{let t=(0,u.useRouter)(),{appService:r}=(0,d.useEnv)(),{settings:n}=(0,S.useSettingsStore)(),{libraryLoaded:i}=(0,p.useLibrary)(),{sideBarBookKey:a}=x(),{hoveredBookKey:o}=(0,m.useReaderStore)(),{showSystemUI:s,dismissSystemUI:g}=(0,b.useThemeStore)(),{getScreenBrightness:y,setScreenBrightness:v}=(0,k.useDeviceControlStore)(),{acquireBackKeyInterception:N,releaseBackKeyInterception:A}=(0,k.useDeviceControlStore)(),{isSideBarVisible:P,isSideBarPinned:B}=x(),{getIsSideBarVisible:O,setSideBarVisible:D}=x(),{isNotebookVisible:z,isNotebookPinned:F}=w(),{getIsNotebookVisible:U,setNotebookVisible:$}=w(),{isDarkMode:H,systemUIAlwaysHidden:q,isRoundedWindow:V}=(0,b.useThemeStore)();(0,h.useTheme)({systemUIVisible:n.alwaysShowStatusBar,appThemeColor:"base-100"}),(0,_.useScreenWakeLock)(n.screenWakeLock),(0,E.useTransferQueue)(i,5e3),(0,f.useEffect)(()=>{(0,R.mountAdditionalFonts)(document),T(),(0,C.isTauriAppPlatform)()&&setTimeout(j.getSysFontsList,3e3),(0,eL.initDayjs)((0,eI.getLocale)())},[]),(0,f.useEffect)(()=>{let e=n.screenBrightness,t=n.autoScreenBrightness;r?.hasScreenBrightness&&!t&&e>=0&&v(e/100);let i=-1;return r?.isIOSApp&&y().then(e=>{i=e}),()=>{r?.hasScreenBrightness&&!t&&v(i)}},[r]);let W=e=>"Back"===e.detail.keyName&&(O()&&!B?D(!1):U()&&!F?$(!1):(M.eventDispatcher.dispatch("close-reader"),t.back()),!0);return(0,f.useEffect)(()=>{if(r?.isAndroidApp)return N(),()=>{A()}},[r?.isAndroidApp]),(0,f.useEffect)(()=>(r?.isAndroidApp&&M.eventDispatcher.onSync("native-key-down",W),()=>{r?.isAndroidApp&&M.eventDispatcher.offSync("native-key-down",W)}),[r?.isAndroidApp,a,B,P,F,z]),(0,f.useEffect)(()=>{if(!r?.isMobileApp)return;let e=!!((o||n.alwaysShowStatusBar)&&!q);(0,j.setSystemUIVisibility)({visible:e,darkMode:H}),e?s():g()},[o]),i&&n.globalReadSettings?(0,l.jsx)("div",{className:(0,c.default)("reader-page bg-base-100 text-base-content full-height select-none overflow-hidden",r?.hasRoundedWindow&&V&&"window-border rounded-window"),children:(0,l.jsxs)(f.Suspense,{fallback:(0,l.jsx)("div",{className:"full-height"}),children:[(0,l.jsx)(gd,{ids:e,settings:n}),(0,l.jsx)(I.AboutWindow,{}),(0,l.jsx)(L.UpdaterWindow,{}),(0,l.jsx)(ee,{}),(0,l.jsx)(eC,{}),(0,l.jsx)(ej.Toast,{})]})}):(0,l.jsx)("div",{className:(0,c.default)("full-height",!r?.isLinuxApp&&"bg-base-100")})};function gp(){let e=(0,i.useTranslation)(),{appService:l}=(0,n.useEnv)(),{settings:c}=(0,o.useSettingsStore)();return(0,a.useOpenWithBooks)(),(0,r.useEffect)(()=>{(async()=>{l?.hasUpdater&&c.autoCheckUpdates?await (0,s.checkForAppUpdates)(e):l?.hasUpdater===!1&&(0,s.checkAppReleaseNotes)()})()},[l?.hasUpdater,c.autoCheckUpdates]),(0,t.jsx)(gh,{})}e.s(["default",()=>gp],784735)}]);