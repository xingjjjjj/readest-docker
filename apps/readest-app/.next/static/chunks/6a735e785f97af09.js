(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,705888,(e,t,r)=>{"use strict";t.exports={MAX_LENGTH:256,MAX_SAFE_COMPONENT_LENGTH:16,MAX_SAFE_BUILD_LENGTH:250,MAX_SAFE_INTEGER:Number.MAX_SAFE_INTEGER||0x1fffffffffffff,RELEASE_TYPES:["major","premajor","minor","preminor","patch","prepatch","prerelease"],SEMVER_SPEC_VERSION:"2.0.0",FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2}},954377,(e,t,r)=>{"use strict";var s=e.i(307178);t.exports="object"==typeof s.default&&s.default.env&&s.default.env.NODE_DEBUG&&/\bsemver\b/i.test(s.default.env.NODE_DEBUG)?(...e)=>console.error("SEMVER",...e):()=>{}},529087,(e,t,r)=>{"use strict";let{MAX_SAFE_COMPONENT_LENGTH:s,MAX_SAFE_BUILD_LENGTH:n,MAX_LENGTH:a}=e.r(705888),i=e.r(954377),o=(r=t.exports={}).re=[],l=r.safeRe=[],c=r.src=[],u=r.safeSrc=[],h=r.t={},d=0,p="[a-zA-Z0-9-]",m=[["\\s",1],["\\d",a],[p,n]],f=(e,t,r)=>{let s=(e=>{for(let[t,r]of m)e=e.split(`${t}*`).join(`${t}{0,${r}}`).split(`${t}+`).join(`${t}{1,${r}}`);return e})(t),n=d++;i(e,n,t),h[e]=n,c[n]=t,u[n]=s,o[n]=new RegExp(t,r?"g":void 0),l[n]=new RegExp(s,r?"g":void 0)};f("NUMERICIDENTIFIER","0|[1-9]\\d*"),f("NUMERICIDENTIFIERLOOSE","\\d+"),f("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${p}*`),f("MAINVERSION",`(${c[h.NUMERICIDENTIFIER]})\\.(${c[h.NUMERICIDENTIFIER]})\\.(${c[h.NUMERICIDENTIFIER]})`),f("MAINVERSIONLOOSE",`(${c[h.NUMERICIDENTIFIERLOOSE]})\\.(${c[h.NUMERICIDENTIFIERLOOSE]})\\.(${c[h.NUMERICIDENTIFIERLOOSE]})`),f("PRERELEASEIDENTIFIER",`(?:${c[h.NONNUMERICIDENTIFIER]}|${c[h.NUMERICIDENTIFIER]})`),f("PRERELEASEIDENTIFIERLOOSE",`(?:${c[h.NONNUMERICIDENTIFIER]}|${c[h.NUMERICIDENTIFIERLOOSE]})`),f("PRERELEASE",`(?:-(${c[h.PRERELEASEIDENTIFIER]}(?:\\.${c[h.PRERELEASEIDENTIFIER]})*))`),f("PRERELEASELOOSE",`(?:-?(${c[h.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${c[h.PRERELEASEIDENTIFIERLOOSE]})*))`),f("BUILDIDENTIFIER",`${p}+`),f("BUILD",`(?:\\+(${c[h.BUILDIDENTIFIER]}(?:\\.${c[h.BUILDIDENTIFIER]})*))`),f("FULLPLAIN",`v?${c[h.MAINVERSION]}${c[h.PRERELEASE]}?${c[h.BUILD]}?`),f("FULL",`^${c[h.FULLPLAIN]}$`),f("LOOSEPLAIN",`[v=\\s]*${c[h.MAINVERSIONLOOSE]}${c[h.PRERELEASELOOSE]}?${c[h.BUILD]}?`),f("LOOSE",`^${c[h.LOOSEPLAIN]}$`),f("GTLT","((?:<|>)?=?)"),f("XRANGEIDENTIFIERLOOSE",`${c[h.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),f("XRANGEIDENTIFIER",`${c[h.NUMERICIDENTIFIER]}|x|X|\\*`),f("XRANGEPLAIN",`[v=\\s]*(${c[h.XRANGEIDENTIFIER]})(?:\\.(${c[h.XRANGEIDENTIFIER]})(?:\\.(${c[h.XRANGEIDENTIFIER]})(?:${c[h.PRERELEASE]})?${c[h.BUILD]}?)?)?`),f("XRANGEPLAINLOOSE",`[v=\\s]*(${c[h.XRANGEIDENTIFIERLOOSE]})(?:\\.(${c[h.XRANGEIDENTIFIERLOOSE]})(?:\\.(${c[h.XRANGEIDENTIFIERLOOSE]})(?:${c[h.PRERELEASELOOSE]})?${c[h.BUILD]}?)?)?`),f("XRANGE",`^${c[h.GTLT]}\\s*${c[h.XRANGEPLAIN]}$`),f("XRANGELOOSE",`^${c[h.GTLT]}\\s*${c[h.XRANGEPLAINLOOSE]}$`),f("COERCEPLAIN",`(^|[^\\d])(\\d{1,${s}})(?:\\.(\\d{1,${s}}))?(?:\\.(\\d{1,${s}}))?`),f("COERCE",`${c[h.COERCEPLAIN]}(?:$|[^\\d])`),f("COERCEFULL",c[h.COERCEPLAIN]+`(?:${c[h.PRERELEASE]})?`+`(?:${c[h.BUILD]})?`+"(?:$|[^\\d])"),f("COERCERTL",c[h.COERCE],!0),f("COERCERTLFULL",c[h.COERCEFULL],!0),f("LONETILDE","(?:~>?)"),f("TILDETRIM",`(\\s*)${c[h.LONETILDE]}\\s+`,!0),r.tildeTrimReplace="$1~",f("TILDE",`^${c[h.LONETILDE]}${c[h.XRANGEPLAIN]}$`),f("TILDELOOSE",`^${c[h.LONETILDE]}${c[h.XRANGEPLAINLOOSE]}$`),f("LONECARET","(?:\\^)"),f("CARETTRIM",`(\\s*)${c[h.LONECARET]}\\s+`,!0),r.caretTrimReplace="$1^",f("CARET",`^${c[h.LONECARET]}${c[h.XRANGEPLAIN]}$`),f("CARETLOOSE",`^${c[h.LONECARET]}${c[h.XRANGEPLAINLOOSE]}$`),f("COMPARATORLOOSE",`^${c[h.GTLT]}\\s*(${c[h.LOOSEPLAIN]})$|^$`),f("COMPARATOR",`^${c[h.GTLT]}\\s*(${c[h.FULLPLAIN]})$|^$`),f("COMPARATORTRIM",`(\\s*)${c[h.GTLT]}\\s*(${c[h.LOOSEPLAIN]}|${c[h.XRANGEPLAIN]})`,!0),r.comparatorTrimReplace="$1$2$3",f("HYPHENRANGE",`^\\s*(${c[h.XRANGEPLAIN]})\\s+-\\s+(${c[h.XRANGEPLAIN]})\\s*$`),f("HYPHENRANGELOOSE",`^\\s*(${c[h.XRANGEPLAINLOOSE]})\\s+-\\s+(${c[h.XRANGEPLAINLOOSE]})\\s*$`),f("STAR","(<|>)?=?\\s*\\*"),f("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),f("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")},486913,(e,t,r)=>{"use strict";let s=Object.freeze({loose:!0}),n=Object.freeze({});t.exports=e=>e?"object"!=typeof e?s:e:n},248188,(e,t,r)=>{"use strict";let s=/^[0-9]+$/,n=(e,t)=>{let r=s.test(e),n=s.test(t);return r&&n&&(e*=1,t*=1),e===t?0:r&&!n?-1:n&&!r?1:e<t?-1:1};t.exports={compareIdentifiers:n,rcompareIdentifiers:(e,t)=>n(t,e)}},989266,(e,t,r)=>{"use strict";let s=e.r(954377),{MAX_LENGTH:n,MAX_SAFE_INTEGER:a}=e.r(705888),{safeRe:i,t:o}=e.r(529087),l=e.r(486913),{compareIdentifiers:c}=e.r(248188);class u{constructor(e,t){if(t=l(t),e instanceof u)if(!!t.loose===e.loose&&!!t.includePrerelease===e.includePrerelease)return e;else e=e.version;else if("string"!=typeof e)throw TypeError(`Invalid version. Must be a string. Got type "${typeof e}".`);if(e.length>n)throw TypeError(`version is longer than ${n} characters`);s("SemVer",e,t),this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease;const r=e.trim().match(t.loose?i[o.LOOSE]:i[o.FULL]);if(!r)throw TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+r[1],this.minor=+r[2],this.patch=+r[3],this.major>a||this.major<0)throw TypeError("Invalid major version");if(this.minor>a||this.minor<0)throw TypeError("Invalid minor version");if(this.patch>a||this.patch<0)throw TypeError("Invalid patch version");r[4]?this.prerelease=r[4].split(".").map(e=>{if(/^[0-9]+$/.test(e)){let t=+e;if(t>=0&&t<a)return t}return e}):this.prerelease=[],this.build=r[5]?r[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(s("SemVer.compare",this.version,this.options,e),!(e instanceof u)){if("string"==typeof e&&e===this.version)return 0;e=new u(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof u||(e=new u(e,this.options)),c(this.major,e.major)||c(this.minor,e.minor)||c(this.patch,e.patch)}comparePre(e){if(e instanceof u||(e=new u(e,this.options)),this.prerelease.length&&!e.prerelease.length)return -1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let t=0;do{let r=this.prerelease[t],n=e.prerelease[t];if(s("prerelease compare",t,r,n),void 0===r&&void 0===n)return 0;if(void 0===n)return 1;if(void 0===r)return -1;else if(r===n)continue;else return c(r,n)}while(++t)}compareBuild(e){e instanceof u||(e=new u(e,this.options));let t=0;do{let r=this.build[t],n=e.build[t];if(s("build compare",t,r,n),void 0===r&&void 0===n)return 0;if(void 0===n)return 1;if(void 0===r)return -1;else if(r===n)continue;else return c(r,n)}while(++t)}inc(e,t,r){if(e.startsWith("pre")){if(!t&&!1===r)throw Error("invalid increment argument: identifier is empty");if(t){let e=`-${t}`.match(this.options.loose?i[o.PRERELEASELOOSE]:i[o.PRERELEASE]);if(!e||e[1]!==t)throw Error(`invalid identifier: ${t}`)}}switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t,r);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t,r);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t,r),this.inc("pre",t,r);break;case"prerelease":0===this.prerelease.length&&this.inc("patch",t,r),this.inc("pre",t,r);break;case"release":if(0===this.prerelease.length)throw Error(`version ${this.raw} is not a prerelease`);this.prerelease.length=0;break;case"major":(0!==this.minor||0!==this.patch||0===this.prerelease.length)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(0!==this.patch||0===this.prerelease.length)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":0===this.prerelease.length&&this.patch++,this.prerelease=[];break;case"pre":{let e=+!!Number(r);if(0===this.prerelease.length)this.prerelease=[e];else{let s=this.prerelease.length;for(;--s>=0;)"number"==typeof this.prerelease[s]&&(this.prerelease[s]++,s=-2);if(-1===s){if(t===this.prerelease.join(".")&&!1===r)throw Error("invalid increment argument: identifier already exists");this.prerelease.push(e)}}if(t){let s=[t,e];!1===r&&(s=[t]),0===c(this.prerelease[0],t)?isNaN(this.prerelease[1])&&(this.prerelease=s):this.prerelease=s}break}default:throw Error(`invalid increment argument: ${e}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}}t.exports=u},290096,(e,t,r)=>{"use strict";let s=e.r(989266);t.exports=(e,t,r=!1)=>{if(e instanceof s)return e;try{return new s(e,t)}catch(e){if(!r)return null;throw e}}},119916,(e,t,r)=>{"use strict";let s=e.r(290096);t.exports=(e,t)=>{let r=s(e,t);return r?r.version:null}},726358,(e,t,r)=>{"use strict";let s=e.r(290096);t.exports=(e,t)=>{let r=s(e.trim().replace(/^[=v]+/,""),t);return r?r.version:null}},378714,(e,t,r)=>{"use strict";let s=e.r(989266);t.exports=(e,t,r,n,a)=>{"string"==typeof r&&(a=n,n=r,r=void 0);try{return new s(e instanceof s?e.version:e,r).inc(t,n,a).version}catch(e){return null}}},754233,(e,t,r)=>{"use strict";let s=e.r(290096);t.exports=(e,t)=>{let r=s(e,null,!0),n=s(t,null,!0),a=r.compare(n);if(0===a)return null;let i=a>0,o=i?r:n,l=i?n:r,c=!!o.prerelease.length;if(l.prerelease.length&&!c){if(!l.patch&&!l.minor)return"major";if(0===l.compareMain(o))return l.minor&&!l.patch?"minor":"patch"}let u=c?"pre":"";return r.major!==n.major?u+"major":r.minor!==n.minor?u+"minor":r.patch!==n.patch?u+"patch":"prerelease"}},163855,(e,t,r)=>{"use strict";let s=e.r(989266);t.exports=(e,t)=>new s(e,t).major},781964,(e,t,r)=>{"use strict";let s=e.r(989266);t.exports=(e,t)=>new s(e,t).minor},266688,(e,t,r)=>{"use strict";let s=e.r(989266);t.exports=(e,t)=>new s(e,t).patch},903100,(e,t,r)=>{"use strict";let s=e.r(290096);t.exports=(e,t)=>{let r=s(e,t);return r&&r.prerelease.length?r.prerelease:null}},521563,(e,t,r)=>{"use strict";let s=e.r(989266);t.exports=(e,t,r)=>new s(e,r).compare(new s(t,r))},188106,(e,t,r)=>{"use strict";let s=e.r(521563);t.exports=(e,t,r)=>s(t,e,r)},315416,(e,t,r)=>{"use strict";let s=e.r(521563);t.exports=(e,t)=>s(e,t,!0)},433883,(e,t,r)=>{"use strict";let s=e.r(989266);t.exports=(e,t,r)=>{let n=new s(e,r),a=new s(t,r);return n.compare(a)||n.compareBuild(a)}},518633,(e,t,r)=>{"use strict";let s=e.r(433883);t.exports=(e,t)=>e.sort((e,r)=>s(e,r,t))},458358,(e,t,r)=>{"use strict";let s=e.r(433883);t.exports=(e,t)=>e.sort((e,r)=>s(r,e,t))},843662,(e,t,r)=>{"use strict";let s=e.r(521563);t.exports=(e,t,r)=>s(e,t,r)>0},876115,(e,t,r)=>{"use strict";let s=e.r(521563);t.exports=(e,t,r)=>0>s(e,t,r)},347052,(e,t,r)=>{"use strict";let s=e.r(521563);t.exports=(e,t,r)=>0===s(e,t,r)},503495,(e,t,r)=>{"use strict";let s=e.r(521563);t.exports=(e,t,r)=>0!==s(e,t,r)},772880,(e,t,r)=>{"use strict";let s=e.r(521563);t.exports=(e,t,r)=>s(e,t,r)>=0},220040,(e,t,r)=>{"use strict";let s=e.r(521563);t.exports=(e,t,r)=>0>=s(e,t,r)},207830,(e,t,r)=>{"use strict";let s=e.r(347052),n=e.r(503495),a=e.r(843662),i=e.r(772880),o=e.r(876115),l=e.r(220040);t.exports=(e,t,r,c)=>{switch(t){case"===":return"object"==typeof e&&(e=e.version),"object"==typeof r&&(r=r.version),e===r;case"!==":return"object"==typeof e&&(e=e.version),"object"==typeof r&&(r=r.version),e!==r;case"":case"=":case"==":return s(e,r,c);case"!=":return n(e,r,c);case">":return a(e,r,c);case">=":return i(e,r,c);case"<":return o(e,r,c);case"<=":return l(e,r,c);default:throw TypeError(`Invalid operator: ${t}`)}}},493042,(e,t,r)=>{"use strict";let s=e.r(989266),n=e.r(290096),{safeRe:a,t:i}=e.r(529087);t.exports=(e,t)=>{if(e instanceof s)return e;if("number"==typeof e&&(e=String(e)),"string"!=typeof e)return null;let r=null;if((t=t||{}).rtl){let s,n=t.includePrerelease?a[i.COERCERTLFULL]:a[i.COERCERTL];for(;(s=n.exec(e))&&(!r||r.index+r[0].length!==e.length);)r&&s.index+s[0].length===r.index+r[0].length||(r=s),n.lastIndex=s.index+s[1].length+s[2].length;n.lastIndex=-1}else r=e.match(t.includePrerelease?a[i.COERCEFULL]:a[i.COERCE]);if(null===r)return null;let o=r[2],l=r[3]||"0",c=r[4]||"0",u=t.includePrerelease&&r[5]?`-${r[5]}`:"",h=t.includePrerelease&&r[6]?`+${r[6]}`:"";return n(`${o}.${l}.${c}${u}${h}`,t)}},904960,(e,t,r)=>{"use strict";t.exports=class{constructor(){this.max=1e3,this.map=new Map}get(e){let t=this.map.get(e);if(void 0!==t)return this.map.delete(e),this.map.set(e,t),t}delete(e){return this.map.delete(e)}set(e,t){if(!this.delete(e)&&void 0!==t){if(this.map.size>=this.max){let e=this.map.keys().next().value;this.delete(e)}this.map.set(e,t)}return this}}},527767,(e,t,r)=>{"use strict";let s=/\s+/g;class n{constructor(e,t){if(t=i(t),e instanceof n)if(!!t.loose===e.loose&&!!t.includePrerelease===e.includePrerelease)return e;else return new n(e.raw,t);if(e instanceof o)return this.raw=e.value,this.set=[[e]],this.formatted=void 0,this;if(this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease,this.raw=e.trim().replace(s," "),this.set=this.raw.split("||").map(e=>this.parseRange(e.trim())).filter(e=>e.length),!this.set.length)throw TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){const e=this.set[0];if(this.set=this.set.filter(e=>!w(e[0])),0===this.set.length)this.set=[e];else if(this.set.length>1){for(const e of this.set)if(1===e.length&&g(e[0])){this.set=[e];break}}}this.formatted=void 0}get range(){if(void 0===this.formatted){this.formatted="";for(let e=0;e<this.set.length;e++){e>0&&(this.formatted+="||");let t=this.set[e];for(let e=0;e<t.length;e++)e>0&&(this.formatted+=" "),this.formatted+=t[e].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(e){let t=((this.options.includePrerelease&&f)|(this.options.loose&&E))+":"+e,r=a.get(t);if(r)return r;let s=this.options.loose,n=s?u[h.HYPHENRANGELOOSE]:u[h.HYPHENRANGE];l("hyphen replace",e=e.replace(n,T(this.options.includePrerelease))),l("comparator trim",e=e.replace(u[h.COMPARATORTRIM],d)),l("tilde trim",e=e.replace(u[h.TILDETRIM],p)),l("caret trim",e=e.replace(u[h.CARETTRIM],m));let i=e.split(" ").map(e=>y(e,this.options)).join(" ").split(/\s+/).map(e=>S(e,this.options));s&&(i=i.filter(e=>(l("loose invalid filter",e,this.options),!!e.match(u[h.COMPARATORLOOSE])))),l("range list",i);let c=new Map;for(let e of i.map(e=>new o(e,this.options))){if(w(e))return[e];c.set(e.value,e)}c.size>1&&c.has("")&&c.delete("");let g=[...c.values()];return a.set(t,g),g}intersects(e,t){if(!(e instanceof n))throw TypeError("a Range is required");return this.set.some(r=>v(r,t)&&e.set.some(e=>v(e,t)&&r.every(r=>e.every(e=>r.intersects(e,t)))))}test(e){if(!e)return!1;if("string"==typeof e)try{e=new c(e,this.options)}catch(e){return!1}for(let t=0;t<this.set.length;t++)if(O(this.set[t],e,this.options))return!0;return!1}}t.exports=n;let a=new(e.r(904960)),i=e.r(486913),o=e.r(315639),l=e.r(954377),c=e.r(989266),{safeRe:u,t:h,comparatorTrimReplace:d,tildeTrimReplace:p,caretTrimReplace:m}=e.r(529087),{FLAG_INCLUDE_PRERELEASE:f,FLAG_LOOSE:E}=e.r(705888),w=e=>"<0.0.0-0"===e.value,g=e=>""===e.value,v=(e,t)=>{let r=!0,s=e.slice(),n=s.pop();for(;r&&s.length;)r=s.every(e=>n.intersects(e,t)),n=s.pop();return r},y=(e,t)=>(l("comp",e,t),l("caret",e=I(e,t)),l("tildes",e=$(e,t)),l("xrange",e=N(e,t)),l("stars",e=b(e,t)),e),L=e=>!e||"x"===e.toLowerCase()||"*"===e,$=(e,t)=>e.trim().split(/\s+/).map(e=>x(e,t)).join(" "),x=(e,t)=>{let r=t.loose?u[h.TILDELOOSE]:u[h.TILDE];return e.replace(r,(t,r,s,n,a)=>{let i;return l("tilde",e,t,r,s,n,a),L(r)?i="":L(s)?i=`>=${r}.0.0 <${+r+1}.0.0-0`:L(n)?i=`>=${r}.${s}.0 <${r}.${+s+1}.0-0`:a?(l("replaceTilde pr",a),i=`>=${r}.${s}.${n}-${a} <${r}.${+s+1}.0-0`):i=`>=${r}.${s}.${n} <${r}.${+s+1}.0-0`,l("tilde return",i),i})},I=(e,t)=>e.trim().split(/\s+/).map(e=>R(e,t)).join(" "),R=(e,t)=>{l("caret",e,t);let r=t.loose?u[h.CARETLOOSE]:u[h.CARET],s=t.includePrerelease?"-0":"";return e.replace(r,(t,r,n,a,i)=>{let o;return l("caret",e,t,r,n,a,i),L(r)?o="":L(n)?o=`>=${r}.0.0${s} <${+r+1}.0.0-0`:L(a)?o="0"===r?`>=${r}.${n}.0${s} <${r}.${+n+1}.0-0`:`>=${r}.${n}.0${s} <${+r+1}.0.0-0`:i?(l("replaceCaret pr",i),o="0"===r?"0"===n?`>=${r}.${n}.${a}-${i} <${r}.${n}.${+a+1}-0`:`>=${r}.${n}.${a}-${i} <${r}.${+n+1}.0-0`:`>=${r}.${n}.${a}-${i} <${+r+1}.0.0-0`):(l("no pr"),o="0"===r?"0"===n?`>=${r}.${n}.${a}${s} <${r}.${n}.${+a+1}-0`:`>=${r}.${n}.${a}${s} <${r}.${+n+1}.0-0`:`>=${r}.${n}.${a} <${+r+1}.0.0-0`),l("caret return",o),o})},N=(e,t)=>(l("replaceXRanges",e,t),e.split(/\s+/).map(e=>A(e,t)).join(" ")),A=(e,t)=>{e=e.trim();let r=t.loose?u[h.XRANGELOOSE]:u[h.XRANGE];return e.replace(r,(r,s,n,a,i,o)=>{l("xRange",e,r,s,n,a,i,o);let c=L(n),u=c||L(a),h=u||L(i);return"="===s&&h&&(s=""),o=t.includePrerelease?"-0":"",c?r=">"===s||"<"===s?"<0.0.0-0":"*":s&&h?(u&&(a=0),i=0,">"===s?(s=">=",u?(n=+n+1,a=0):a=+a+1,i=0):"<="===s&&(s="<",u?n=+n+1:a=+a+1),"<"===s&&(o="-0"),r=`${s+n}.${a}.${i}${o}`):u?r=`>=${n}.0.0${o} <${+n+1}.0.0-0`:h&&(r=`>=${n}.${a}.0${o} <${n}.${+a+1}.0-0`),l("xRange return",r),r})},b=(e,t)=>(l("replaceStars",e,t),e.trim().replace(u[h.STAR],"")),S=(e,t)=>(l("replaceGTE0",e,t),e.trim().replace(u[t.includePrerelease?h.GTE0PRE:h.GTE0],"")),T=e=>(t,r,s,n,a,i,o,l,c,u,h,d)=>(r=L(s)?"":L(n)?`>=${s}.0.0${e?"-0":""}`:L(a)?`>=${s}.${n}.0${e?"-0":""}`:i?`>=${r}`:`>=${r}${e?"-0":""}`,l=L(c)?"":L(u)?`<${+c+1}.0.0-0`:L(h)?`<${c}.${+u+1}.0-0`:d?`<=${c}.${u}.${h}-${d}`:e?`<${c}.${u}.${+h+1}-0`:`<=${l}`,`${r} ${l}`.trim()),O=(e,t,r)=>{for(let r=0;r<e.length;r++)if(!e[r].test(t))return!1;if(t.prerelease.length&&!r.includePrerelease){for(let r=0;r<e.length;r++)if(l(e[r].semver),e[r].semver!==o.ANY&&e[r].semver.prerelease.length>0){let s=e[r].semver;if(s.major===t.major&&s.minor===t.minor&&s.patch===t.patch)return!0}return!1}return!0}},315639,(e,t,r)=>{"use strict";let s=Symbol("SemVer ANY");class n{static get ANY(){return s}constructor(e,t){if(t=a(t),e instanceof n)if(!!t.loose===e.loose)return e;else e=e.value;c("comparator",e=e.trim().split(/\s+/).join(" "),t),this.options=t,this.loose=!!t.loose,this.parse(e),this.semver===s?this.value="":this.value=this.operator+this.semver.version,c("comp",this)}parse(e){let t=this.options.loose?i[o.COMPARATORLOOSE]:i[o.COMPARATOR],r=e.match(t);if(!r)throw TypeError(`Invalid comparator: ${e}`);this.operator=void 0!==r[1]?r[1]:"","="===this.operator&&(this.operator=""),r[2]?this.semver=new u(r[2],this.options.loose):this.semver=s}toString(){return this.value}test(e){if(c("Comparator.test",e,this.options.loose),this.semver===s||e===s)return!0;if("string"==typeof e)try{e=new u(e,this.options)}catch(e){return!1}return l(e,this.operator,this.semver,this.options)}intersects(e,t){if(!(e instanceof n))throw TypeError("a Comparator is required");return""===this.operator?""===this.value||new h(e.value,t).test(this.value):""===e.operator?""===e.value||new h(this.value,t).test(e.semver):!((t=a(t)).includePrerelease&&("<0.0.0-0"===this.value||"<0.0.0-0"===e.value)||!t.includePrerelease&&(this.value.startsWith("<0.0.0")||e.value.startsWith("<0.0.0")))&&!!(this.operator.startsWith(">")&&e.operator.startsWith(">")||this.operator.startsWith("<")&&e.operator.startsWith("<")||this.semver.version===e.semver.version&&this.operator.includes("=")&&e.operator.includes("=")||l(this.semver,"<",e.semver,t)&&this.operator.startsWith(">")&&e.operator.startsWith("<")||l(this.semver,">",e.semver,t)&&this.operator.startsWith("<")&&e.operator.startsWith(">"))}}t.exports=n;let a=e.r(486913),{safeRe:i,t:o}=e.r(529087),l=e.r(207830),c=e.r(954377),u=e.r(989266),h=e.r(527767)},923527,(e,t,r)=>{"use strict";let s=e.r(527767);t.exports=(e,t,r)=>{try{t=new s(t,r)}catch(e){return!1}return t.test(e)}},456088,(e,t,r)=>{"use strict";let s=e.r(527767);t.exports=(e,t)=>new s(e,t).set.map(e=>e.map(e=>e.value).join(" ").trim().split(" "))},845940,(e,t,r)=>{"use strict";let s=e.r(989266),n=e.r(527767);t.exports=(e,t,r)=>{let a=null,i=null,o=null;try{o=new n(t,r)}catch(e){return null}return e.forEach(e=>{o.test(e)&&(!a||-1===i.compare(e))&&(i=new s(a=e,r))}),a}},431439,(e,t,r)=>{"use strict";let s=e.r(989266),n=e.r(527767);t.exports=(e,t,r)=>{let a=null,i=null,o=null;try{o=new n(t,r)}catch(e){return null}return e.forEach(e=>{o.test(e)&&(!a||1===i.compare(e))&&(i=new s(a=e,r))}),a}},389606,(e,t,r)=>{"use strict";let s=e.r(989266),n=e.r(527767),a=e.r(843662);t.exports=(e,t)=>{e=new n(e,t);let r=new s("0.0.0");if(e.test(r)||(r=new s("0.0.0-0"),e.test(r)))return r;r=null;for(let t=0;t<e.set.length;++t){let n=e.set[t],i=null;n.forEach(e=>{let t=new s(e.semver.version);switch(e.operator){case">":0===t.prerelease.length?t.patch++:t.prerelease.push(0),t.raw=t.format();case"":case">=":(!i||a(t,i))&&(i=t);break;case"<":case"<=":break;default:throw Error(`Unexpected operation: ${e.operator}`)}}),i&&(!r||a(r,i))&&(r=i)}return r&&e.test(r)?r:null}},790109,(e,t,r)=>{"use strict";let s=e.r(527767);t.exports=(e,t)=>{try{return new s(e,t).range||"*"}catch(e){return null}}},7612,(e,t,r)=>{"use strict";let s=e.r(989266),n=e.r(315639),{ANY:a}=n,i=e.r(527767),o=e.r(923527),l=e.r(843662),c=e.r(876115),u=e.r(220040),h=e.r(772880);t.exports=(e,t,r,d)=>{let p,m,f,E,w;switch(e=new s(e,d),t=new i(t,d),r){case">":p=l,m=u,f=c,E=">",w=">=";break;case"<":p=c,m=h,f=l,E="<",w="<=";break;default:throw TypeError('Must provide a hilo val of "<" or ">"')}if(o(e,t,d))return!1;for(let r=0;r<t.set.length;++r){let s=t.set[r],i=null,o=null;if(s.forEach(e=>{e.semver===a&&(e=new n(">=0.0.0")),i=i||e,o=o||e,p(e.semver,i.semver,d)?i=e:f(e.semver,o.semver,d)&&(o=e)}),i.operator===E||i.operator===w||(!o.operator||o.operator===E)&&m(e,o.semver)||o.operator===w&&f(e,o.semver))return!1}return!0}},691080,(e,t,r)=>{"use strict";let s=e.r(7612);t.exports=(e,t,r)=>s(e,t,">",r)},556732,(e,t,r)=>{"use strict";let s=e.r(7612);t.exports=(e,t,r)=>s(e,t,"<",r)},959256,(e,t,r)=>{"use strict";let s=e.r(527767);t.exports=(e,t,r)=>(e=new s(e,r),t=new s(t,r),e.intersects(t,r))},810905,(e,t,r)=>{"use strict";let s=e.r(923527),n=e.r(521563);t.exports=(e,t,r)=>{let a=[],i=null,o=null,l=e.sort((e,t)=>n(e,t,r));for(let e of l)s(e,t,r)?(o=e,i||(i=e)):(o&&a.push([i,o]),o=null,i=null);i&&a.push([i,null]);let c=[];for(let[e,t]of a)e===t?c.push(e):t||e!==l[0]?t?e===l[0]?c.push(`<=${t}`):c.push(`${e} - ${t}`):c.push(`>=${e}`):c.push("*");let u=c.join(" || "),h="string"==typeof t.raw?t.raw:String(t);return u.length<h.length?u:t}},16694,(e,t,r)=>{"use strict";let s=e.r(527767),n=e.r(315639),{ANY:a}=n,i=e.r(923527),o=e.r(521563),l=[new n(">=0.0.0-0")],c=[new n(">=0.0.0")],u=(e,t,r)=>{let s,n,u,p,m,f,E;if(e===t)return!0;if(1===e.length&&e[0].semver===a)if(1===t.length&&t[0].semver===a)return!0;else e=r.includePrerelease?l:c;if(1===t.length&&t[0].semver===a)if(r.includePrerelease)return!0;else t=c;let w=new Set;for(let t of e)">"===t.operator||">="===t.operator?s=h(s,t,r):"<"===t.operator||"<="===t.operator?n=d(n,t,r):w.add(t.semver);if(w.size>1)return null;if(s&&n&&((u=o(s.semver,n.semver,r))>0||0===u&&(">="!==s.operator||"<="!==n.operator)))return null;for(let e of w){if(s&&!i(e,String(s),r)||n&&!i(e,String(n),r))return null;for(let s of t)if(!i(e,String(s),r))return!1;return!0}let g=!!n&&!r.includePrerelease&&!!n.semver.prerelease.length&&n.semver,v=!!s&&!r.includePrerelease&&!!s.semver.prerelease.length&&s.semver;for(let e of(g&&1===g.prerelease.length&&"<"===n.operator&&0===g.prerelease[0]&&(g=!1),t)){if(E=E||">"===e.operator||">="===e.operator,f=f||"<"===e.operator||"<="===e.operator,s){if(v&&e.semver.prerelease&&e.semver.prerelease.length&&e.semver.major===v.major&&e.semver.minor===v.minor&&e.semver.patch===v.patch&&(v=!1),">"===e.operator||">="===e.operator){if((p=h(s,e,r))===e&&p!==s)return!1}else if(">="===s.operator&&!i(s.semver,String(e),r))return!1}if(n){if(g&&e.semver.prerelease&&e.semver.prerelease.length&&e.semver.major===g.major&&e.semver.minor===g.minor&&e.semver.patch===g.patch&&(g=!1),"<"===e.operator||"<="===e.operator){if((m=d(n,e,r))===e&&m!==n)return!1}else if("<="===n.operator&&!i(n.semver,String(e),r))return!1}if(!e.operator&&(n||s)&&0!==u)return!1}return(!s||!f||!!n||0===u)&&(!n||!E||!!s||0===u)&&!v&&!g&&!0},h=(e,t,r)=>{if(!e)return t;let s=o(e.semver,t.semver,r);return s>0?e:s<0||">"===t.operator&&">="===e.operator?t:e},d=(e,t,r)=>{if(!e)return t;let s=o(e.semver,t.semver,r);return s<0?e:s>0||"<"===t.operator&&"<="===e.operator?t:e};t.exports=(e,t,r={})=>{if(e===t)return!0;e=new s(e,r),t=new s(t,r);let n=!1;e:for(let s of e.set){for(let e of t.set){let t=u(s,e,r);if(n=n||null!==t,t)continue e}if(n)return!1}return!0}},168982,(e,t,r)=>{"use strict";let s=e.r(529087),n=e.r(705888),a=e.r(989266),i=e.r(248188),o=e.r(290096),l=e.r(119916),c=e.r(726358),u=e.r(378714),h=e.r(754233),d=e.r(163855),p=e.r(781964),m=e.r(266688),f=e.r(903100),E=e.r(521563),w=e.r(188106),g=e.r(315416),v=e.r(433883),y=e.r(518633),L=e.r(458358),$=e.r(843662),x=e.r(876115),I=e.r(347052),R=e.r(503495),N=e.r(772880),A=e.r(220040),b=e.r(207830),S=e.r(493042),T=e.r(315639),O=e.r(527767),P=e.r(923527),j=e.r(456088),k=e.r(845940),C=e.r(431439),D=e.r(389606),U=e.r(790109),F=e.r(7612),_=e.r(691080),M=e.r(556732),G=e.r(959256);t.exports={parse:o,valid:l,clean:c,inc:u,diff:h,major:d,minor:p,patch:m,prerelease:f,compare:E,rcompare:w,compareLoose:g,compareBuild:v,sort:y,rsort:L,gt:$,lt:x,eq:I,neq:R,gte:N,lte:A,cmp:b,coerce:S,Comparator:T,Range:O,satisfies:P,toComparators:j,maxSatisfying:k,minSatisfying:C,minVersion:D,validRange:U,outside:F,gtr:_,ltr:M,intersects:G,simplifyRange:e.r(810905),subset:e.r(16694),SemVer:a,re:s.re,src:s.src,tokens:s.t,SEMVER_SPEC_VERSION:n.SEMVER_SPEC_VERSION,RELEASE_TYPES:n.RELEASE_TYPES,compareIdentifiers:i.compareIdentifiers,rcompareIdentifiers:i.rcompareIdentifiers}},559245,26608,152890,523912,477737,e=>{"use strict";var t=e.i(871611);class r extends t.Resource{constructor(e){super(e.rid),this.available=!0,this.currentVersion=e.currentVersion,this.version=e.version,this.date=e.date,this.body=e.body,this.rawJson=e.rawJson}async download(e,r){n(r);let s=new t.Channel;e&&(s.onmessage=e);let a=await (0,t.invoke)("plugin:updater|download",{onEvent:s,rid:this.rid,...r});this.downloadedBytes=new t.Resource(a)}async install(){if(!this.downloadedBytes)throw Error("Update.install called before Update.download");await (0,t.invoke)("plugin:updater|install",{updateRid:this.rid,bytesRid:this.downloadedBytes.rid}),this.downloadedBytes=void 0}async downloadAndInstall(e,r){n(r);let s=new t.Channel;e&&(s.onmessage=e),await (0,t.invoke)("plugin:updater|download_and_install",{onEvent:s,rid:this.rid,...r})}async close(){await this.downloadedBytes?.close(),await super.close()}}async function s(e){n(e);let s=await (0,t.invoke)("plugin:updater|check",{...e});return s?new r(s):null}function n(e){e?.headers&&(e.headers=Array.from(new Headers(e.headers).entries()))}e.s(["check",()=>s],559245);class a{constructor(){this.eventListeners=Object.create(null)}addListener(e,t){return this.on(e,t)}removeListener(e,t){return this.off(e,t)}on(e,t){return e in this.eventListeners?this.eventListeners[e].push(t):this.eventListeners[e]=[t],this}once(e,t){let r=s=>{this.removeListener(e,r),t(s)};return this.addListener(e,r)}off(e,t){return e in this.eventListeners&&(this.eventListeners[e]=this.eventListeners[e].filter(e=>e!==t)),this}removeAllListeners(e){return e?delete this.eventListeners[e]:this.eventListeners=Object.create(null),this}emit(e,t){if(e in this.eventListeners){for(let r of this.eventListeners[e])r(t);return!0}return!1}listenerCount(e){return e in this.eventListeners?this.eventListeners[e].length:0}prependListener(e,t){return e in this.eventListeners?this.eventListeners[e].unshift(t):this.eventListeners[e]=[t],this}prependOnceListener(e,t){let r=s=>{this.removeListener(e,r),t(s)};return this.prependListener(e,r)}}class i{constructor(e){this.pid=e}async write(e){await (0,t.invoke)("plugin:shell|stdin_write",{pid:this.pid,buffer:e})}async kill(){await (0,t.invoke)("plugin:shell|kill",{cmd:"killChild",pid:this.pid})}}class o extends a{constructor(e,t=[],r){super(),this.stdout=new a,this.stderr=new a,this.program=e,this.args="string"==typeof t?[t]:t,this.options=r??{}}static create(e,t=[],r){return new o(e,t,r)}static sidecar(e,t=[],r){let s=new o(e,t,r);return s.options.sidecar=!0,s}async spawn(){let e=this.program,r=this.args,s=this.options;"object"==typeof r&&Object.freeze(r);let n=new t.Channel;return n.onmessage=e=>{switch(e.event){case"Error":this.emit("error",e.payload);break;case"Terminated":this.emit("close",e.payload);break;case"Stdout":this.stdout.emit("data",e.payload);break;case"Stderr":this.stderr.emit("data",e.payload)}},await (0,t.invoke)("plugin:shell|spawn",{program:e,args:r,options:s,onEvent:n}).then(e=>new i(e))}async execute(){let e=this.program,r=this.args,s=this.options;return"object"==typeof r&&Object.freeze(r),await (0,t.invoke)("plugin:shell|execute",{program:e,args:r,options:s})}}e.s(["Command",()=>o],26608);var l=e.i(917409),c=e.i(57290);let u="Daily Quota Exceeded",h="translations",d={},p={},m=()=>new Promise((e,t)=>{if(!window.indexedDB){console.warn("IndexedDB not supported. Using in-memory cache only."),t(Error("IndexedDB not supported"));return}let r=indexedDB.open("TranslationCache",1);r.onerror=e=>{console.error("IndexedDB error:",e),t(Error("Could not open IndexedDB"))},r.onsuccess=t=>{e(t.target.result)},r.onupgradeneeded=e=>{let t=e.target.result;if(!t.objectStoreNames.contains(h)){let e=t.createObjectStore(h,{keyPath:"key"});e.createIndex("provider","provider",{unique:!1}),e.createIndex("timestamp","timestamp",{unique:!1})}}}),f=async(e={})=>{try{let t,r=await m(),s=r.transaction(h,"readonly"),n=s.objectStore(h);if(e.onlyLoadProviders&&e.onlyLoadProviders.length>0){let t=e.onlyLoadProviders.map(e=>new Promise(t=>{let r=n.index("provider").getAll(e);r.onsuccess=()=>{t(r.result)},r.onerror=()=>{t([])}})),r=(await Promise.all(t)).flat();E(r,e)}else(t=n.getAll()).onsuccess=()=>{let r=t.result;E(r,e)},t.onerror=e=>{console.error("Error loading cache from IndexedDB:",e)};s.oncomplete=()=>{r.close()}}catch(e){console.error("Failed to load cache from IndexedDB:",e)}},E=(e,t)=>{let r=e;if(t.maxAge){let e=Date.now()-t.maxAge;r=r.filter(t=>t.timestamp>=e)}t.onlyLoadLanguages&&(t.onlyLoadLanguages.source&&t.onlyLoadLanguages.source.length>0&&(r=r.filter(e=>t.onlyLoadLanguages.source.includes(e.sourceLang))),t.onlyLoadLanguages.target&&t.onlyLoadLanguages.target.length>0&&(r=r.filter(e=>t.onlyLoadLanguages.target.includes(e.targetLang)))),t.maxEntries&&r.length>t.maxEntries&&(r.sort((e,t)=>t.timestamp-e.timestamp),r=r.slice(0,t.maxEntries)),r.forEach(e=>{d[e.key]=e.translation,p[e.key]=e.timestamp})},w=(e,t,r,s)=>`${s}:${t}:${r}:${e}`,g=async(e,t,r,s)=>{if(!e?.trim())return null;let n=w(e,t,r,s);if(d[n])return d[n];try{let e=await m(),t=e.transaction(h,"readonly"),r=t.objectStore(h).get(n);return new Promise(s=>{r.onsuccess=()=>{let e=r.result;e?(d[n]=e.translation,p[n]=e.timestamp,s(e.translation)):s(null)},r.onerror=()=>{s(null)},t.oncomplete=()=>{e.close()}})}catch(e){return console.error("Error accessing IndexedDB:",e),null}},v=async(e,t,r,s,n)=>{if(!e?.trim()||!t)return;let a=w(e,r,s,n),i=Date.now();d[a]=t,p[a]=i;try{let o=await m(),l=o.transaction(h,"readwrite");return l.objectStore(h).put({key:a,translation:t,timestamp:i,provider:n,sourceLang:r,targetLang:s,originalText:e}),new Promise((e,t)=>{l.oncomplete=()=>{o.close(),e()},l.onerror=e=>{console.error("Error storing in IndexedDB:",e),t(Error("Failed to store in IndexedDB"))}})}catch(e){console.error("Error accessing IndexedDB:",e)}},y=async(e={})=>{let{maxAge:t,maxEntries:r,maxSizeInBytes:s,dryRun:n=!1}=e;if(!t&&!r&&!s)return 0;try{let e=await m(),a=e.transaction(h,n?"readonly":"readwrite"),i=a.objectStore(h),o=i.getAll();return new Promise(l=>{o.onsuccess=()=>{let e=o.result,a=[];if(t){let r=Date.now()-t,s=e.filter(e=>e.timestamp<r);a.push(...s)}if(r&&e.length>r){let t=[...e].sort((e,t)=>e.timestamp-t.timestamp).slice(0,e.length-r),s=new Set(a.map(e=>e.key));t.forEach(e=>{s.has(e.key)||a.push(e)})}if(s){let t=0;if(e.forEach(e=>{let r=JSON.stringify(e);t+=r.length}),t>s){let r=e.filter(e=>!a.some(t=>t.key===e.key)).sort((e,t)=>e.timestamp-t.timestamp),n=t-s,i=new Set(a.map(e=>e.key));for(let e of r){if(n<=0)break;if(!i.has(e.key)){let t=JSON.stringify(e),r=2*t.length;a.push(e),i.add(e.key),n-=r}}}}let c=a.length;!n&&c>0&&a.forEach(e=>{i.delete(e.key),delete d[e.key],delete p[e.key]}),l(c)},o.onerror=()=>{l(0)},a.oncomplete=()=>{e.close()}})}catch(e){return console.error("Error pruning cache:",e),0}},L=null;(async(e={})=>{let{preload:t=!0,preloadOptions:r={maxAge:2592e6,maxEntries:1e4},autoPrune:s=!0,pruneInterval:n=36e5,pruneOptions:a={maxAge:7776e6,maxEntries:1e5,maxSizeInBytes:0xa00000}}=e;t&&await f(r);let i=null;return s&&(await y(a),i=window.setInterval(async()=>{await y(a)},n)),()=>{null!==i&&clearInterval(i)}})().then(e=>{L=e}),window.addEventListener("beforeunload",()=>{L&&L()});let $={zh:e=>e.replace(/--/g,"⸺").replace(/\s+([。、！？])/g,"$1").replace(/([。、！？])\s+/g,"$1"),es:e=>e.replace(/\?([A-ZÁÉÍÓÚÑÜ])/g,"? $1").replace(/\!([A-ZÁÉÍÓÚÑÜ])/g,"! $1"),fr:e=>e.replace(/\s+([!?:;])/g," $1").replace(/([!?:;])\s+/g,"$1 "),ja:e=>e.replace(/\s+([。、！？])/g,"$1").replace(/([。、！？])\s+/g,"$1")},x=e=>e.replace(/\s+/g," ").replace(/\s+([.,!?;:])/g,"$1").trim();function I(e,t){let r,s=(r=$[t.split("-")[0].toLowerCase()])?e=>r(x(e)):x;return e.map(s)}let R={Cover:"The Cover",Dedication:"Dedication Page",Acknowledgements:"The Acknowledgements"};var N=e.i(141886),A=e.i(62725),b=e.i(624098),S=e.i(819045),T=e.i(262504),O=e.i(812414);let P=(0,N.getAPIBaseUrl)()+"/deepl/translate",j={name:"deepl",label:(0,A.stubTranslation)("DeepL"),authRequired:!0,quotaExceeded:!1,translate:async(e,t,r,s,n=!1)=>{let a=j.authRequired,i={"Content-Type":"application/json"},o="free";if(s&&(o=(0,b.getSubscriptionPlan)(s),i.Authorization=`Bearer ${s}`),a&&!s)throw Error("Authentication token is required for DeepL translation");let l=JSON.stringify({text:e,source_lang:(0,S.normalizeToShortLang)(t).toUpperCase(),target_lang:(0,S.normalizeToShortLang)(r).toUpperCase(),use_cache:n}),c=T.DEFAULT_DAILY_TRANSLATION_QUOTA[o];try{let t=await fetch(P,{method:"POST",headers:i,body:l});if(!t.ok){let e=await t.json();if(e&&e.error&&e.error===u)throw(0,O.saveDailyUsage)(c),j.quotaExceeded=!0,Error(u);throw Error(`Translation failed with status ${t.status}`)}let r=await t.json();if(!r||!r.translations)throw Error("Invalid response from translation service");return e.map((e,t)=>{if(!e?.trim().length)return e;let s=r.translations?.[t];return s?.daily_usage&&((0,O.saveDailyUsage)(s.daily_usage),j.quotaExceeded=r.daily_usage>=c),s?.text||e})}catch(e){throw e}}};var k=e.i(931955);let C=null,D=async()=>{let e=Date.now();if(C&&C.expiresAt>e)return C.token;try{let t=(0,N.isTauriAppPlatform)()?k.fetch:window.fetch,r=await t("https://edge.microsoft.com/translate/auth",{method:"GET",headers:{"User-Agent":"Mozilla/5.0"}});if(!r.ok)throw Error(`Failed to get auth token: ${r.status}`);let s=await r.text();return C={token:s,expiresAt:e+48e4},s}catch(e){throw console.error("Error getting Microsoft translation auth token:",e),e}},U={name:"azure",label:(0,A.stubTranslation)("Azure Translator"),translate:async(e,t,r)=>{if(!e.length)return[];let s=[],n=t?(0,S.normalizeToFullLang)(t):"",a=(0,S.normalizeToFullLang)(r),i=e.map(async(e,t)=>{if(!e?.trim().length){s[t]=e;return}let r=new URLSearchParams({to:a,"api-version":"3.0"});n&&"auto"!==n.toLowerCase()&&r.append("from",n);let i=await D(),o=(0,N.isTauriAppPlatform)()?k.fetch:window.fetch,l=await o(`https://api-edge.cognitive.microsofttranslator.com/translate?${r.toString()}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i}`},body:JSON.stringify([{Text:e}])});if(!l.ok)throw Error(`Translation failed with status ${l.status}`);let c=await l.json();Array.isArray(c)&&c.length>0&&c[0].translations?s[t]=c[0].translations[0].text||e:s[t]=e});return await Promise.all(i),s}},F={name:"google",label:(0,A.stubTranslation)("Google Translate"),translate:async(e,t,r)=>{if(!e.length)return[];let s=[],n=e.map(async(e,n)=>{if(!e?.trim().length){s[n]=e;return}let a=new URL("https://translate.googleapis.com/translate_a/single");a.searchParams.append("client","gtx"),a.searchParams.append("dt","t"),a.searchParams.append("sl",(0,S.normalizeToShortLang)(t).toLowerCase()||"auto"),a.searchParams.append("tl",(0,S.normalizeToShortLang)(r).toLowerCase()),a.searchParams.append("q",e);let i=(0,N.isTauriAppPlatform)()?k.fetch:window.fetch,o=await i(a.toString());if(!o.ok)throw Error(`Translation failed with status ${o.status}`);let l=await o.json();if(Array.isArray(l)&&Array.isArray(l[0])){let t=l[0].filter(e=>Array.isArray(e)&&e[0]).map(e=>e[0]).join("");s[n]=t||e}else s[n]=e});return await Promise.all(n),s}};async function _(e,t,r){let s=(0,N.isTauriAppPlatform)()?k.fetch:window.fetch,n={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({lang:t,service:r,text:e})},a=await s("https://translate.toil.cc/v2/translate/",n);if(!a.ok){let t=JSON.stringify(await a.json());throw Error(`${r} failed with status ${a.status}
${e.length}
${JSON.stringify(n)}
${t}`)}let i=await a.json();return i&&Array.isArray(i.translations)?i.translations:[e]}let M={name:"yandex",label:(0,A.stubTranslation)("Yandex Translate"),authRequired:!1,translate:async(e,t,r)=>{if(!e.length)return[];let s="AUTO"==t?"en":(0,S.normalizeToShortLang)(t).toLowerCase(),n=(0,S.normalizeToShortLang)(r).toLowerCase(),a=`${s}-${n}`;return(await Promise.all(e.map(async e=>await _(e,a,"yandexgpt")))).flat()}};function G(e,t){if(e!==t.name)throw Error(`Translator name "${e}" does not match implementation name "${t.name}"`);return t}let B=[G("deepl",j),G("azure",U),G("google",F),G("yandex",M)],V=e=>B.find(t=>t.name===e),X=()=>B;e.s(["getTranslator",0,V,"getTranslators",0,X],152890),e.s([],523912);var z=e.i(305133),K=e.i(604111);function Y({provider:e="deepl",sourceLang:t="AUTO",targetLang:r="EN",enablePolishing:s=!0,enablePreprocessing:n=!0}={}){let a=(0,K.useTranslation)(),{token:i}=(0,c.useAuth)(),[o,h]=(0,l.useState)(!1),[d,p]=(0,l.useState)(e),[m,f]=(0,l.useState)(()=>V(e)),[E]=(0,l.useState)(()=>X());return(0,l.useEffect)(()=>{h(!1)},[e,t,r]),(0,l.useEffect)(()=>{let t=X().filter(e=>(!e.authRequired||!!i)&&!e.quotaExceeded),r=(t.find(t=>t.name===e)||t[0]).name;f(V(r)),p(r)},[e]),{translate:(0,l.useCallback)(async(e,o)=>{let l=o?.source||t,c=o?.target||r||(0,A.getLocale)(),m=o?.useCache??!1,f=n?function(e,t={}){let r=function(e={}){return t=>{let r;return 0===Object.keys(r={...R,...e}).length?t:r[t]?r[t]:t}}(t);return e.map(r)}(e):e;if(0===f.length||f.every(e=>!e?.trim()))return f;let w=[],y=[];if(await Promise.all(f.map(async(e,t)=>{!e?.trim()||await g(e,l,c,d)||(w.push(e),y.push(t))})),0===w.length){let e=await Promise.all(f.map(e=>g(e,l,c,d).then(t=>t||e)));return s?I(e,c):e}h(!0);try{let e=E.find(e=>e.name===d);if(!e)throw Error(`No translator found for provider: ${d}`);let t=await e.translate(w,l,c,i,m);await Promise.all(w.map(async(e,r)=>v(e,t[r]||"",l,c,d)));let r=[...f];return y.forEach((e,s)=>{r[e]=t[s]||""}),await Promise.all(r.map(async(e,t)=>{if(!y.includes(t)){let e=f[t];if(!e?.trim())return;let s=await g(e,l,c,d);s&&(r[t]=s)}})),h(!1),s?I(r,c):r}catch(e){throw e instanceof Error&&e.message.includes(u)&&(z.eventDispatcher.dispatch("toast",{timeout:5e3,message:a("Daily translation quota reached. Upgrade your plan to continue using AI translations."),type:"error"}),p("azure")),h(!1),e instanceof Error?e:Error(String(e))}},[d,t,r,m,i]),translator:m,translators:E,loading:o}}e.s(["useTranslator",()=>Y],477737)},265107,e=>{"use strict";e.s(["checkAppReleaseNotes",()=>m,"checkForAppUpdates",()=>h,"setLastShownReleaseNotesVersion",()=>p]);var t=e.i(168982),r=e.i(559245),s=e.i(897755),n=e.i(931955),a=e.i(841964),i=e.i(653184),o=e.i(141886),l=e.i(745519),c=e.i(262504);let u="lastAppUpdateCheck",h=async(e,o=!0)=>{let h=localStorage.getItem(u),d=Date.now();if(o&&h&&d-parseInt(h,10)<1e3*c.CHECK_UPDATE_INTERVAL_SEC)return!1;localStorage.setItem(u,d.toString()),console.log("Checking for updates");let p=(0,s.type)();if(["macos","windows","linux"].includes(p)){var m;let e,t=await (0,r.check)();return t&&(m=t.version,(e=new a.WebviewWindow("updater",{url:`/updater?latestVersion=${m}`,title:"Software Update",width:626,height:406,center:!0,resizable:!0})).once("tauri://created",()=>{console.log("new window created")}),e.once("tauri://error",e=>{console.error("error creating window",e)})),!!t}if("android"===p)try{let e=await (0,n.fetch)(c.READEST_UPDATER_FILE,{connectTimeout:5e3}),r=await e.json(),s=t.default.gt(r.version,(0,l.getAppVersion)());return s&&("android-arm64"in r.platforms||"android-universal"in r.platforms)&&(0,i.setUpdaterWindowVisible)(!0,r.version,(0,l.getAppVersion)()),s}catch(e){throw console.warn("Failed to fetch Android update info",e),Error("Failed to fetch Android update info")}return!1},d="lastShownReleaseNotesVersion",p=e=>{localStorage.setItem(d,e)},m=async(e=!0)=>{let r=(0,l.getAppVersion)(),s=localStorage.getItem(d)||"";if(s&&t.default.gt(r,s)||!e)try{let e=(0,o.isTauriAppPlatform)()?n.fetch:window.fetch;if((await e(c.READEST_CHANGELOG_FILE)).ok)return(0,i.setUpdaterWindowVisible)(!0,r,s,!1),!0}catch(e){console.warn("Failed to fetch release notes",e)}else s||p(r);return!1}},653184,647110,650244,837122,260805,e=>{"use strict";e.s(["UpdaterContent",()=>M,"UpdaterWindow",()=>B,"setUpdaterWindowVisible",()=>G],653184),e.i(307178);var t=e.i(374517),r=e.i(7284),s=e.i(168982),n=e.i(542748),a=e.i(96508),i=e.i(917409),o=e.i(897755),l=e.i(559245),c=e.i(44438),u=e.i(931955),h=e.i(26608),d=e.i(871611),p=e.i(141886),m=e.i(477737),f=e.i(604111),E=e.i(553438),w=e.i(745519),g=e.i(341612),v=e.i(341537),y=e.i(99500),L=e.i(62725),$=e.i(265107),x=e.i(262504),I=e.i(875245);let R=(e,t,r)=>{let s=(0,i.useRef)(!1),n=(0,i.useRef)(0),a=(0,i.useRef)(0),o=(0,i.useRef)(0),l=(0,i.useRef)(0),c=(0,i.useRef)(0);return{handleDragStart:(0,i.useCallback)(t=>{s.current=!0,"touches"in t?(a.current=t.touches[0].clientY,n.current=t.touches[0].clientX):(a.current=t.clientY,n.current=t.clientX),c.current=performance.now(),document.body.style.pointerEvents="none",document.body.style.userSelect="none",document.documentElement.style.cursor="col-resize";let i=t=>{if(s.current){let r=0,s=0,n=0,a=0;if("touches"in t&&t.touches.length>0){let e=t.touches[0];n=e.clientX,a=e.clientY}else n=t.clientX,a=t.clientY;r=n-o.current,s=a-l.current,o.current=n,l.current=a,e({clientX:n,clientY:a,deltaX:r,deltaY:s})}},u=e=>{s.current=!1,document.body.style.pointerEvents="",document.body.style.userSelect="",document.documentElement.style.cursor="";let t=0,o=0,l=0,h=0,d=performance.now()-c.current;if("touches"in e){let t=e.changedTouches[0];l=t.clientX,h=t.clientY}else l=e.clientX,h=e.clientY;t=l-n.current;let p=(o=h-a.current)/d;r&&r({velocity:p,deltaT:d,clientX:l,clientY:h,deltaX:t,deltaY:o}),window.removeEventListener("mousemove",i),window.removeEventListener("mouseup",u),window.removeEventListener("touchmove",i),window.removeEventListener("touchend",u)};window.addEventListener("mousemove",i,{passive:!0}),window.addEventListener("mouseup",u),window.addEventListener("touchmove",i,{passive:!0}),window.addEventListener("touchend",u)},[e,r]),handleDragKeyDown:(0,i.useCallback)(e=>{switch(e.key){case"ArrowUp":case"ArrowDown":case"ArrowLeft":case"ArrowRight":t({key:e.key,step:.02});break;default:return}e.preventDefault(),e.stopPropagation()},[t])}};e.s(["useDrag",0,R],647110);var N=e.i(981441),A=e.i(128818),b=e.i(305133);let S=e=>"VolumeUp"===e||"VolumeDown"===e?b.eventDispatcher.dispatch("native-key-down",{keyName:e}):"Back"===e&&b.eventDispatcher.dispatchSync("native-key-down",{keyName:e}),T=(0,A.create)((e,t)=>({volumeKeysIntercepted:!1,backKeyIntercepted:!1,volumeKeysInterceptionCount:0,backKeyInterceptionCount:0,acquireVolumeKeyInterception:()=>{let{volumeKeysInterceptionCount:r}=t();0==r&&(window.onNativeKeyDown=S,(0,v.interceptKeys)({volumeKeys:!0}),e({volumeKeysIntercepted:!0})),e({volumeKeysInterceptionCount:r+1})},releaseVolumeKeyInterception:()=>{let{volumeKeysInterceptionCount:r}=t();r<=1?((0,v.interceptKeys)({volumeKeys:!1}),e({volumeKeysIntercepted:!1,volumeKeysInterceptionCount:0})):e({volumeKeysInterceptionCount:r-1})},acquireBackKeyInterception:()=>{let{backKeyInterceptionCount:r}=t();0==r&&(window.onNativeKeyDown=S,(0,v.interceptKeys)({backKey:!0}),e({backKeyIntercepted:!0})),e({backKeyInterceptionCount:r+1})},releaseBackKeyInterception:()=>{let{backKeyInterceptionCount:r}=t();r<=1?((0,v.interceptKeys)({backKey:!1}),e({backKeyIntercepted:!1,backKeyInterceptionCount:0})):e({backKeyInterceptionCount:r-1})},listenToNativeTouchEvents:()=>{window.onNativeTouch=e=>b.eventDispatcher.dispatch("native-touch",e)},getScreenBrightness:async()=>(await (0,v.getScreenBrightness)()).brightness,setScreenBrightness:async e=>{await (0,v.setScreenBrightness)({brightness:e})}}));e.s(["useDeviceControlStore",0,T],650244);var O=e.i(34970);e.i(283683);let{vibrate:P,impactFeedback:j,notificationFeedback:k,selectionFeedback:C}={async vibrate(e){try{return{status:"ok",data:await (0,d.invoke)("plugin:haptics|vibrate",{duration:e})}}catch(e){if(!(e instanceof Error))return{status:"error",error:e};throw e}},async impactFeedback(e){try{return{status:"ok",data:await (0,d.invoke)("plugin:haptics|impact_feedback",{style:e})}}catch(e){if(!(e instanceof Error))return{status:"error",error:e};throw e}},async notificationFeedback(e){try{return{status:"ok",data:await (0,d.invoke)("plugin:haptics|notification_feedback",{type:e})}}catch(e){if(!(e instanceof Error))return{status:"error",error:e};throw e}},async selectionFeedback(){try{return{status:"ok",data:await (0,d.invoke)("plugin:haptics|selection_feedback")}}catch(e){if(!(e instanceof Error))return{status:"error",error:e};throw e}}};e.s(["impactFeedback",()=>j],837122);var D=e.i(266765),U=e.i(727309);let F=({id:e,isOpen:s,children:n,snapHeight:o,header:l,title:c,className:u,bgClassName:h,boxClassName:d,contentClassName:p,onClose:m})=>{let E=(0,f.useTranslation)(),{appService:w}=(0,a.useEnv)(),{systemUIVisible:g,statusBarHeight:v,safeAreaInsets:y}=(0,N.useThemeStore)(),{acquireBackKeyInterception:L,releaseBackKeyInterception:$}=T(),[x,A]=(0,i.useState)(!o),[S]=(0,i.useState)(()=>"rtl"===(0,D.getDirFromUILanguage)()),P=(0,i.useRef)(null),k=(0,i.useRef)(null),C=(0,O.useResponsiveSize)(22),F=window.innerWidth<640||window.innerHeight<640,_=e=>{if(e instanceof CustomEvent){if("Back"===e.detail.keyName)return m(),!0}else"Escape"===e.key&&m(),e.stopPropagation();return!1};(0,i.useEffect)(()=>{if(!s){k.current&&(k.current.focus(),k.current=null);return}k.current=document.activeElement,A(!o&&F),window.addEventListener("keydown",_),P.current&&P.current.addEventListener("keydown",_),w?.isAndroidApp&&(L(),b.eventDispatcher.onSync("native-key-down",_));let e=setTimeout(()=>{P.current&&P.current.focus()},100);return()=>{clearTimeout(e),window.removeEventListener("keydown",_),w?.isAndroidApp&&($(),b.eventDispatcher.offSync("native-key-down",_))}},[s]);let{handleDragStart:M}=R(e=>{if(!F||!P.current)return;let t=P.current.querySelector(".modal-box"),r=P.current.querySelector(".overlay"),s=e.clientY/window.innerHeight,n=Math.max(0,Math.min(1,s));t&&r&&(t.style.height="100%",t.style.transform=`translateY(${100*n}%)`,r.style.opacity=`${1-s}`,A(e.clientY<44),t.style.transition="padding-top 0.3s ease-out")},()=>{},e=>{if(!F||!P.current)return;let t=P.current.querySelector(".modal-box"),r=P.current.querySelector(".overlay");if(!t||!r)return;let s=o?1-o+.2:.5;if(e.velocity>.5||e.velocity>=0&&e.clientY>=window.innerHeight*s){let s=.15/Math.max(e.velocity,.5);t.style.height="100%",t.style.transition=`transform ${s}s ease-out`,t.style.transform="translateY(100%)",r.style.transition=`opacity ${s}s ease-out`,r.style.opacity="0",m(),setTimeout(()=>{t.style.transform="translateY(0%)"},300)}else o&&e.clientY>window.innerHeight*(o?1-o-.2:.5)&&e.clientY<window.innerHeight*s?(r.style.transition="opacity 0.3s ease-out",r.style.opacity=`${1-o}`,t.style.height=`${100*o}%`,t.style.bottom="0",t.style.transition="transform 0.3s ease-out",t.style.transform=""):(A(!0),t.style.height="100%",t.style.transition="transform 0.3s ease-out",t.style.transform="translateY(0%)",r.style.opacity="0");w?.hasHaptics&&j("medium")});return(0,t.jsxs)("dialog",{ref:P,id:e??"dialog",tabIndex:-1,open:s,"aria-hidden":!s,className:(0,r.default)("modal sm:min-w-90 z-50 h-full w-full !items-start !bg-transparent sm:w-full sm:!items-center",u),dir:S?"rtl":void 0,children:[(0,t.jsx)(U.Overlay,{className:(0,r.default)("dialog-overlay z-10 bg-black/50 sm:bg-black/50",w?.hasRoundedWindow&&"rounded-window",h),onDismiss:m}),(0,t.jsxs)("div",{className:(0,r.default)("modal-box settings-content absolute z-20 flex flex-col rounded-none rounded-tl-2xl rounded-tr-2xl p-0 sm:rounded-2xl","h-full max-h-full w-full max-w-full",window.innerWidth<window.innerHeight?"sm:h-[50%] sm:w-3/4":"sm:h-[65%] sm:w-1/2 sm:max-w-[600px]",d),style:{paddingTop:w?.hasSafeAreaInset&&x?`${Math.max(y?.top||0,g?v:0)}px`:"0px",...F?{height:o?`${100*o}%`:"100%",bottom:0}:{}},children:[(0,t.jsx)("div",{className:(0,r.default)("drag-handle h-10 max-h-10 min-h-10 w-full cursor-row-resize items-center justify-center","transition-padding-top flex duration-300 ease-out sm:hidden"),onMouseDown:M,onTouchStart:M,children:(0,t.jsx)("div",{className:"bg-base-content/50 h-1 w-10 rounded-full"})}),(0,t.jsx)("div",{className:"dialog-header sticky top-1 z-10 flex items-center justify-between px-2 sm:px-4",children:l||(0,t.jsxs)("div",{className:"flex h-11 w-full items-center justify-between",children:[(0,t.jsx)("button",{"aria-label":E("Close"),onClick:m,className:"btn btn-ghost btn-circle flex h-8 min-h-8 w-8 hover:bg-transparent focus:outline-none sm:hidden",children:S?(0,t.jsx)(I.MdArrowForwardIos,{size:C}):(0,t.jsx)(I.MdArrowBackIosNew,{size:C})}),(0,t.jsx)("div",{className:"z-15 pointer-events-none absolute inset-0 flex h-11 items-center justify-center",children:(0,t.jsx)("span",{className:"line-clamp-1 text-center font-bold",children:c??""})}),(0,t.jsx)("button",{"aria-label":E("Close"),onClick:m,className:"bg-base-300/65 btn btn-ghost btn-circle ml-auto hidden h-6 min-h-6 w-6 focus:outline-none sm:flex",children:(0,t.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{fill:"currentColor",d:"M19 6.41L17.59 5L12 10.59L6.41 5L5 6.41L10.59 12L5 17.59L6.41 19L12 13.41L17.59 19L19 17.59L13.41 12z"})})})]})}),(0,t.jsx)("div",{className:(0,r.default)("text-base-content my-2 flex-grow overflow-y-auto px-6 sm:px-[10%]",p),children:n})]})]})};e.s(["default",0,F],260805);var _=e.i(194072);let M=({latestVersion:e,lastVersion:I,checkUpdate:R=!0})=>{let N=(0,f.useTranslation)(),[A,b]=(0,i.useState)("EN"),{translate:S}=(0,m.useTranslator)({provider:"azure",sourceLang:"AUTO",targetLang:A}),{appService:T}=(0,a.useEnv)(),O=(0,E.useSearchParams)(),P=(0,w.getAppVersion)(),[j,k]=(0,i.useState)(e??O?.get("latestVersion")??""),[C,D]=(0,i.useState)(I??O?.get("lastVersion")??""),[U,F]=(0,i.useState)(null),[M,G]=(0,i.useState)([]),[B,V]=(0,i.useState)(null),[X,z]=(0,i.useState)(null),[K,Y]=(0,i.useState)(!1),[W,H]=(0,i.useState)(null),[q,J]=(0,i.useState)(!1);(0,i.useEffect)(()=>{b((0,L.getLocale)())},[]),(0,i.useEffect)(()=>{let e=async()=>{let e=await (0,l.check)();e&&F(e)},t=async()=>{if(!T)return;let e=(0,p.isTauriAppPlatform)()?u.fetch:window.fetch,t=await e(x.READEST_UPDATER_FILE),r=await t.json();if(s.default.gt(r.version,P)){let e=(0,o.arch)(),t=r.platforms["aarch64"===e?"android-arm64":"android-universal"]?.url,s=await T.resolveFilePath(`Readest_${r.version}_${"aarch64"===e?"arm64":"universal"}.apk`,"Cache");F({currentVersion:P,version:r.version,date:r.pub_date,body:r.notes,downloadAndInstall:async e=>{await new Promise(async(r,n)=>{let a=0,i=0;await (0,g.tauriDownload)(t,s,t=>{e&&(!i&&t.total?e({event:"Started",data:{contentLength:i=t.total}}):a>0&&t.progress===t.total&&(console.log("APK downloaded to",s),e?.({event:"Finished"}),setTimeout(()=>{r()},1e3)),e({event:"Progress",data:{chunkLength:t.progress-a}}),a=t.progress)}).catch(e=>{console.error("Download failed:",e),n(e)})});let r=await (0,v.installPackage)({path:s});r.success?console.log("APK installed successfully"):console.error("Failed to install APK:",r.error)}})}},r=async()=>{if(!T)return;let e=(0,p.isTauriAppPlatform)()?u.fetch:window.fetch,t=await e(x.READEST_UPDATER_FILE),r=await t.json();if(s.default.gt(r.version,P)){let e=(0,o.arch)(),t=r.platforms["x86_64"===e?"windows-x86_64-portable":"windows-aarch64-portable"]?.url,s=await (0,d.invoke)("get_executable_dir"),n=`Readest_${r.version}_${"x86_64"===e?"x64":"arm64"}-portable.exe`,a=await (0,y.join)(s,n);F({currentVersion:P,version:r.version,date:r.pub_date,body:r.notes,downloadAndInstall:async e=>{await new Promise(async(r,s)=>{let n=0,i=0;await (0,g.tauriDownload)(t,a,t=>{e&&(!i&&t.total?e({event:"Started",data:{contentLength:i=t.total}}):n>0&&t.progress===t.total&&(console.log("Portable EXE downloaded to",a),e?.({event:"Finished"}),setTimeout(()=>{r()},1e3)),e({event:"Progress",data:{chunkLength:t.progress-n}}),n=t.progress)}).catch(e=>{console.error("Download failed:",e),s(e)})});try{console.log("Launching new executable:",a);let e=h.Command.create("start-readest",["/C","start","",a]);await e.spawn(),console.log("New executable launched, exiting current app..."),setTimeout(async()=>{await (0,c.exit)(0)},500)}catch(e){console.error("Failed to launch new executable:",e)}}})}},n=async()=>{let s=(0,o.type)();T?.isPortableApp&&"windows"===s?r():["macos","windows","linux"].includes(s)?e():"android"===s&&t()};T?.hasUpdater&&R&&n()},[T?.hasUpdater]),(0,i.useEffect)(()=>{e&&k(e),I&&D(I),R||F({currentVersion:P,version:e,date:"",body:""})},[e,I,R]),(0,i.useEffect)(()=>{let e=async e=>{try{let t=(0,p.isTauriAppPlatform)()?u.fetch:window.fetch,r=await t(x.READEST_CHANGELOG_FILE),n=(await r.json()).releases,a=Object.entries(n).filter(([t])=>s.default.gt(t,e)).sort(([e],[t])=>s.default.rcompare(e,t));return(a=a.length?a:Object.entries(n).slice(0,3)).map(([e,t])=>({version:e,date:new Date(t.date).toLocaleDateString(),notes:t.notes}))}catch(e){return console.error("Failed to fetch changelog:",e),[]}},t=async t=>{k(t.version);let r=await e(C||P);if(0===r.length&&t.date&&t.body&&(r=[{version:t.version,date:new Date(t.date).toLocaleDateString(),notes:(t.body??"").split(/(?:^|\s)\d+\.\s/).map(e=>e.trim()).filter(e=>e.length>0)}]),!A.toLowerCase().startsWith("en"))for(let e of r)try{e.notes=await S(e.notes,{useCache:!0})}catch(e){console.log("Failed to translate changelog:",e)}G(r),(0,$.setLastShownReleaseNotesVersion)(j)};U&&t(U)},[U]),(0,i.useEffect)(()=>{J(!0)},[]);let Z=async()=>{if(!U)return;let e=0,t=0,r=0;V(0),Y(!0),await U.downloadAndInstall?.(s=>{switch(s.event){case"Started":z(t=s.data.contentLength);break;case"Progress":H(e+=s.data.chunkLength),V(Math.floor(e/t*100)),e-r>=1048576&&(console.log(`downloaded ${e} bytes from ${t}`),r=e);break;case"Finished":console.log("download finished"),V(100)}}),console.log("package installed"),T?.isAndroidApp||await (0,c.relaunch)()};return q&&j?(0,t.jsx)("div",{className:"bg-base-100 flex min-h-screen justify-center",children:(0,t.jsxs)("div",{className:"flex w-full max-w-2xl flex-col gap-4",children:[(0,t.jsxs)("div",{className:"flex flex-col justify-center gap-4 sm:flex-row sm:items-start",children:[(0,t.jsx)("div",{className:"flex items-center justify-center",children:(0,t.jsx)(n.default,{src:"/icon.png",alt:"Logo",className:"h-20 w-20",width:64,height:64})}),R?(0,t.jsxs)("div",{className:"text-base-content flex-grow text-sm",children:[(0,t.jsx)("h2",{className:"mb-4 text-center font-bold sm:text-start",children:N("A new version of Readest is available!")}),(0,t.jsx)("p",{className:"mb-2",children:N("Readest {{newVersion}} is available (installed version {{currentVersion}}).",{newVersion:j,currentVersion:P})}),(0,t.jsx)("p",{className:"mb-2",children:N("Download and install now?")}),(0,t.jsxs)("div",{className:"flex w-full flex-row items-center justify-end gap-4",children:[null!==B&&(0,t.jsxs)("div",{className:"flex flex-grow flex-col",children:[(0,t.jsx)("progress",{className:"progress my-1 h-4 w-full",value:B,max:"100"}),(0,t.jsx)("p",{className:"text-base-content/75 flex items-center justify-center text-sm",children:B<100?N("Downloading {{downloaded}} of {{contentLength}}",{downloaded:W?`${Math.floor(W/1024/1024)} MB`:"0 MB",contentLength:X?`${Math.floor(X/1024/1024)} MB`:"0 MB"}):N("Download finished")})]}),(0,t.jsx)("div",{className:"card-actions",children:(0,t.jsx)("button",{className:(0,r.default)("btn btn-warning text-base-100 px-6 font-bold",(!U||K)&&"btn-disabled"),onClick:Z,children:N("DOWNLOAD & INSTALL")})})]})]}):(0,t.jsx)("div",{className:"text-base-content flex h-full flex-grow flex-col text-sm sm:flex-row",children:(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center gap-4 p-1 sm:items-start sm:gap-2",children:[(0,t.jsx)("h2",{className:"text-center font-bold sm:text-start",children:N("Version {{version}}",{version:P})}),M.length>0&&s.default.gt(M[0].version,P)?(0,t.jsxs)("div",{className:"flex gap-2",children:[(T?.isIOSApp||T?.isMacOSApp)&&(0,t.jsx)(_.default,{href:"https://apps.apple.com/app/id6738622779",target:"_blank",rel:"noopener noreferrer",className:"btn btn-primary btn-sm",children:N("Check Update")}),T?.isAndroidApp&&(0,t.jsx)(_.default,{href:"https://play.google.com/store/apps/details?id=com.bilingify.readest",target:"_blank",rel:"noopener noreferrer",className:"btn btn-primary btn-sm",children:N("Check Update")})]}):(0,t.jsx)("div",{className:"flex",children:(0,t.jsx)("p",{className:"text-sm font-bold",children:N("Already the latest version")})})]})})]}),(0,t.jsxs)("div",{className:"text-base-content text-sm",children:[(0,t.jsx)("h3",{className:"mb-2 font-bold",children:N("Changelog")}),(0,t.jsx)("div",{className:"not-eink:bg-base-200 not-eink:px-4 mb-4 rounded-lg pb-2 pt-4",children:M.length>0?M.map(e=>(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsxs)("h4",{className:"mb-2 font-bold",children:[e.version," (",e.date,")"]}),(0,t.jsx)("ul",{className:"list-disc space-y-1 ps-6 text-sm",children:e.notes.map((e,r)=>(0,t.jsx)("li",{children:e},r))})]},e.version)):(0,t.jsxs)("div",{className:"flex h-56 w-full flex-col gap-4",children:[(0,t.jsx)("div",{className:"skeleton h-4 w-28"}),(0,t.jsx)("div",{className:"skeleton h-4 w-full"}),(0,t.jsx)("div",{className:"skeleton h-4 w-full"})]})})]})]})}):null},G=(e,t,r,s=!0)=>{let n=document.getElementById("updater_window");if(n){let a=new CustomEvent("setDialogVisibility",{detail:{visible:e,latestVersion:t,lastVersion:r,checkUpdate:s}});n.dispatchEvent(a)}},B=()=>{let e=(0,f.useTranslation)(),[r,s]=(0,i.useState)(""),[n,a]=(0,i.useState)(""),[o,l]=(0,i.useState)(!0),[c,u]=(0,i.useState)(!1);return(0,i.useEffect)(()=>{let e=e=>{let{visible:t,latestVersion:r,lastVersion:n,checkUpdate:i}=e.detail;u(t),l(i),r&&s(r),n&&a(n)},t=document.getElementById("updater_window");return t&&t.addEventListener("setDialogVisibility",e),()=>{t&&t.removeEventListener("setDialogVisibility",e)}},[]),(0,t.jsx)(F,{id:"updater_window",isOpen:c,title:e(o?"Software Update":"What's New in Readest"),onClose:()=>u(!1),boxClassName:"sm:!w-[75%] sm:h-auto sm:!max-h-[85vh] sm:!max-w-2xl",children:c&&(0,t.jsx)(M,{latestVersion:r??void 0,lastVersion:n??void 0,checkUpdate:o})})}},409383,e=>{"use strict";var t=e.i(374517),r=e.i(7284),s=e.i(981441),n=e.i(604111);e.s(["default",0,({loading:e,className:a})=>{let i=(0,n.useTranslation)(),{safeAreaInsets:o}=(0,s.useThemeStore)();return e?(0,t.jsxs)("div",{className:(0,r.default)("absolute left-1/2 top-4 -translate-x-1/2 transform text-center"),style:{paddingTop:`${(o?.top||0)+64}px`},role:"status",children:[(0,t.jsx)("span",{className:(0,r.default)("loading loading-lg not-eink:loading-dots eink:loading-spinner",a)}),(0,t.jsx)("span",{className:"sr-only",children:i("Loading...")})]}):null}])}]);