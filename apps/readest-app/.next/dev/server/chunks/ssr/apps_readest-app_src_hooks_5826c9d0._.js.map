{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/hooks/useTranslation.ts"],"sourcesContent":["'use client';\n\nimport '@/i18n/i18n';\nimport { useCallback } from 'react';\nimport { useTranslation as _useTranslation } from 'react-i18next';\n\nexport type TranslationFunc = (key: string, options?: Record<string, number | string>) => string;\n\nexport const useTranslation = (namespace: string = 'translation') => {\n  const { t } = _useTranslation(namespace);\n\n  return useCallback((key: string, options = {}) => t(key, { defaultValue: key, ...options }), [t]);\n};\n"],"names":[],"mappings":";;;;AAEA;AACA;AACA;AAAA;AAJA;;;;AAQO,MAAM,iBAAiB,CAAC,YAAoB,aAAa;IAC9D,MAAM,EAAE,CAAC,EAAE,GAAG,IAAA,mXAAe,EAAC;IAE9B,OAAO,IAAA,sXAAW,EAAC,CAAC,KAAa,UAAU,CAAC,CAAC,GAAK,EAAE,KAAK;YAAE,cAAc;YAAK,GAAG,OAAO;QAAC,IAAI;QAAC;KAAE;AAClG"}},
    {"offset": {"line": 29, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/hooks/useTranslator.ts"],"sourcesContent":["'use client';\n\nimport { useState, useCallback, useEffect } from 'react';\nimport { useAuth } from '@/context/AuthContext';\nimport { ErrorCodes, getTranslator, getTranslators, TranslatorName } from '@/services/translators';\nimport { getFromCache, storeInCache, UseTranslatorOptions } from '@/services/translators';\nimport { polish, preprocess } from '@/services/translators';\nimport { eventDispatcher } from '@/utils/event';\nimport { getLocale } from '@/utils/misc';\nimport { useTranslation } from './useTranslation';\n\nexport function useTranslator({\n  provider = 'deepl',\n  sourceLang = 'AUTO',\n  targetLang = 'EN',\n  enablePolishing = true,\n  enablePreprocessing = true,\n}: UseTranslatorOptions = {}) {\n  const _ = useTranslation();\n  const { token } = useAuth();\n  const [loading, setLoading] = useState(false);\n  const [selectedProvider, setSelectedProvider] = useState(provider);\n  const [translator, setTransltor] = useState(() => getTranslator(provider));\n  const [translators] = useState(() => getTranslators());\n\n  useEffect(() => {\n    setLoading(false);\n  }, [provider, sourceLang, targetLang]);\n\n  useEffect(() => {\n    const availableTranslators = getTranslators().filter(\n      (t) => (t.authRequired ? !!token : true) && !t.quotaExceeded,\n    );\n    const selectedTranslator =\n      availableTranslators.find((t) => t.name === provider) || availableTranslators[0]!;\n    const selectedProviderName = selectedTranslator.name as TranslatorName;\n    setTransltor(getTranslator(selectedProviderName));\n    setSelectedProvider(selectedProviderName);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [provider]);\n\n  const translate = useCallback(\n    async (\n      input: string[],\n      options?: { source?: string; target?: string; useCache?: boolean },\n    ): Promise<string[]> => {\n      const sourceLanguage = options?.source || sourceLang;\n      const targetLanguage = options?.target || targetLang || getLocale();\n      const useCache = options?.useCache ?? false;\n      const textsToTranslate = enablePreprocessing ? preprocess(input) : input;\n\n      if (textsToTranslate.length === 0 || textsToTranslate.every((t) => !t?.trim())) {\n        return textsToTranslate;\n      }\n\n      const textsNeedingTranslation: string[] = [];\n      const indicesNeedingTranslation: number[] = [];\n\n      await Promise.all(\n        textsToTranslate.map(async (text, index) => {\n          if (!text?.trim()) return;\n\n          const cachedTranslation = await getFromCache(\n            text,\n            sourceLanguage,\n            targetLanguage,\n            selectedProvider,\n          );\n          if (cachedTranslation) return;\n\n          textsNeedingTranslation.push(text);\n          indicesNeedingTranslation.push(index);\n        }),\n      );\n\n      if (textsNeedingTranslation.length === 0) {\n        const results = await Promise.all(\n          textsToTranslate.map((text) =>\n            getFromCache(text, sourceLanguage, targetLanguage, selectedProvider).then(\n              (cached) => cached || text,\n            ),\n          ),\n        );\n\n        return enablePolishing ? polish(results, targetLanguage) : results;\n      }\n\n      setLoading(true);\n\n      try {\n        const translator = translators.find((t) => t.name === selectedProvider);\n        if (!translator) {\n          throw new Error(`No translator found for provider: ${selectedProvider}`);\n        }\n        const translatedTexts = await translator.translate(\n          textsNeedingTranslation,\n          sourceLanguage,\n          targetLanguage,\n          token,\n          useCache,\n        );\n\n        await Promise.all(\n          textsNeedingTranslation.map(async (text, index) => {\n            return storeInCache(\n              text,\n              translatedTexts[index] || '',\n              sourceLanguage,\n              targetLanguage,\n              selectedProvider,\n            );\n          }),\n        );\n\n        const results = [...textsToTranslate];\n        indicesNeedingTranslation.forEach((originalIndex, translationIndex) => {\n          results[originalIndex] = translatedTexts[translationIndex] || '';\n        });\n\n        await Promise.all(\n          results.map(async (_, index) => {\n            if (!indicesNeedingTranslation.includes(index)) {\n              const originalText = textsToTranslate[index];\n              if (!originalText?.trim()) return;\n\n              const cachedTranslation = await getFromCache(\n                originalText,\n                sourceLanguage,\n                targetLanguage,\n                selectedProvider,\n              );\n\n              if (cachedTranslation) {\n                results[index] = cachedTranslation;\n              }\n            }\n          }),\n        );\n\n        setLoading(false);\n        return enablePolishing ? polish(results, targetLanguage) : results;\n      } catch (err) {\n        if (err instanceof Error && err.message.includes(ErrorCodes.DAILY_QUOTA_EXCEEDED)) {\n          eventDispatcher.dispatch('toast', {\n            timeout: 5000,\n            message: _(\n              'Daily translation quota reached. Upgrade your plan to continue using AI translations.',\n            ),\n            type: 'error',\n          });\n          setSelectedProvider('azure');\n        }\n        setLoading(false);\n        throw err instanceof Error ? err : new Error(String(err));\n      }\n    },\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    [selectedProvider, sourceLang, targetLang, translator, token],\n  );\n\n  return {\n    translate,\n    translator,\n    translators,\n    loading,\n  };\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 157, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/hooks/useDrag.ts"],"sourcesContent":["'use client';\n\nimport { useCallback, useRef } from 'react';\n\nexport type DragKey = 'ArrowLeft' | 'ArrowRight' | 'ArrowUp' | 'ArrowDown';\n\nexport const useDrag = (\n  onDragMove: (data: { clientX: number; clientY: number; deltaX: number; deltaY: number }) => void,\n  onDragKeyDown: (data: { key: DragKey; step: number }) => void,\n  onDragEnd?: (data: {\n    velocity: number;\n    deltaT: number;\n    clientX: number;\n    clientY: number;\n    deltaX: number;\n    deltaY: number;\n  }) => void,\n) => {\n  const isDragging = useRef(false);\n  const startX = useRef(0);\n  const startY = useRef(0);\n  const lastX = useRef(0);\n  const lastY = useRef(0);\n  const startTime = useRef(0);\n\n  const handleDragStart = useCallback(\n    (e: React.MouseEvent | React.TouchEvent) => {\n      isDragging.current = true;\n\n      if ('touches' in e) {\n        startY.current = e.touches[0]!.clientY;\n        startX.current = e.touches[0]!.clientX;\n      } else {\n        startY.current = e.clientY;\n        startX.current = e.clientX;\n      }\n      startTime.current = performance.now();\n\n      document.body.style.pointerEvents = 'none';\n      document.body.style.userSelect = 'none';\n      document.documentElement.style.cursor = 'col-resize';\n\n      const handleMove = (event: MouseEvent | TouchEvent) => {\n        if (isDragging.current) {\n          let deltaX = 0;\n          let deltaY = 0;\n          let clientX = 0;\n          let clientY = 0;\n\n          if ('touches' in event && event.touches.length > 0) {\n            const currentTouch = event.touches[0]!;\n            clientX = currentTouch.clientX;\n            clientY = currentTouch.clientY;\n          } else {\n            const evt = event as MouseEvent;\n            clientX = evt.clientX;\n            clientY = evt.clientY;\n          }\n          deltaX = clientX - lastX.current;\n          deltaY = clientY - lastY.current;\n          lastX.current = clientX;\n          lastY.current = clientY;\n\n          onDragMove({ clientX, clientY, deltaX, deltaY });\n        }\n      };\n\n      const handleEnd = (event: MouseEvent | TouchEvent) => {\n        isDragging.current = false;\n\n        document.body.style.pointerEvents = '';\n        document.body.style.userSelect = '';\n        document.documentElement.style.cursor = '';\n\n        let deltaX = 0;\n        let deltaY = 0;\n        let clientX = 0;\n        let clientY = 0;\n        const endTime = performance.now();\n        const deltaT = endTime - startTime.current;\n\n        if ('touches' in event) {\n          const currentTouch = event.changedTouches[0]!;\n          clientX = currentTouch.clientX;\n          clientY = currentTouch.clientY;\n        } else {\n          const evt = event as MouseEvent;\n          clientX = evt.clientX;\n          clientY = evt.clientY;\n        }\n        deltaX = clientX - startX.current;\n        deltaY = clientY - startY.current;\n        const velocity = deltaY / deltaT;\n\n        if (onDragEnd) {\n          onDragEnd({ velocity, deltaT, clientX, clientY, deltaX, deltaY });\n        }\n\n        window.removeEventListener('mousemove', handleMove);\n        window.removeEventListener('mouseup', handleEnd);\n        window.removeEventListener('touchmove', handleMove);\n        window.removeEventListener('touchend', handleEnd);\n      };\n\n      window.addEventListener('mousemove', handleMove, { passive: true });\n      window.addEventListener('mouseup', handleEnd);\n      window.addEventListener('touchmove', handleMove, { passive: true });\n      window.addEventListener('touchend', handleEnd);\n    },\n    [onDragMove, onDragEnd],\n  );\n\n  const handleDragKeyDown = useCallback(\n    (e: React.KeyboardEvent) => {\n      const step = 0.02;\n      switch (e.key) {\n        case 'ArrowUp':\n        case 'ArrowDown':\n        case 'ArrowLeft':\n        case 'ArrowRight':\n          onDragKeyDown({ key: e.key, step });\n          break;\n        default:\n          return;\n      }\n      e.preventDefault();\n      e.stopPropagation();\n    },\n    [onDragKeyDown],\n  );\n\n  return { handleDragStart, handleDragKeyDown };\n};\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 290, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/hooks/usePullToRefresh.ts"],"sourcesContent":["'use client';\n\nimport { useEffect } from 'react';\n\nconst TRIGGER_THRESHOLD = 120;\nconst SHOW_INDICATOR_THRESHOLD = 60;\n\nconst MAX = 128;\nconst k = 0.4;\nfunction appr(x: number) {\n  return MAX * (1 - Math.exp((-k * x) / MAX));\n}\n\nexport const usePullToRefresh = (ref: React.RefObject<HTMLDivElement>, onTrigger: () => void) => {\n  useEffect(() => {\n    const el = ref.current;\n    if (!el) return;\n\n    el.addEventListener('touchstart', handleTouchStart, { passive: true });\n\n    function handleTouchStart(startEvent: TouchEvent) {\n      const el = ref.current;\n      if (!el) return;\n\n      if (el.scrollTop > 0) return;\n\n      const initialX = startEvent.touches[0]!.clientX;\n      const initialY = startEvent.touches[0]!.clientY;\n\n      el.addEventListener('touchmove', handleTouchMove, { passive: true });\n      el.addEventListener('touchend', handleTouchEnd);\n\n      function handleTouchMove(moveEvent: TouchEvent) {\n        const el = ref.current;\n        if (!el) return;\n\n        const currentX = moveEvent.touches[0]!.clientX;\n        const currentY = moveEvent.touches[0]!.clientY;\n        const dx = currentX - initialX;\n        const dy = currentY - initialY;\n        if (dy < 0 || Math.abs(dx) * 2 > Math.abs(dy)) return;\n\n        const parentEl = el.parentNode as HTMLDivElement;\n        if (dy > TRIGGER_THRESHOLD) {\n          flipArrow(parentEl);\n        } else if (dy > SHOW_INDICATOR_THRESHOLD) {\n          addPullIndicator(parentEl);\n        } else {\n          removePullIndicator(parentEl);\n        }\n\n        const wrapper = el.querySelector('.transform-wrapper') as HTMLElement;\n        if (wrapper) {\n          wrapper.style.transform = `translate3d(0, ${appr(dy)}px, 0)`;\n        }\n      }\n\n      function addPullIndicator(el: HTMLDivElement) {\n        const indicator = el.querySelector('.pull-indicator');\n        if (indicator) {\n          if (indicator.classList.contains('flip')) {\n            indicator.classList.remove('flip');\n          }\n          return;\n        }\n\n        const headerbar = document.querySelector('.titlebar');\n        const pullIndicator = document.createElement('div');\n        const headerBottom = headerbar?.getBoundingClientRect().bottom || 0;\n        pullIndicator.style.top = `${headerBottom + 30}px`;\n        pullIndicator.className = 'pull-indicator text-gray-500';\n        pullIndicator.innerHTML = `\n          <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"currentColor\">\n            <path d=\"M12 19c-.3 0-.6-.1-.8-.3l-6-6c-.4-.4-.4-1 0-1.4s1-.4 1.4 0L11 16.2V5c0-.6.4-1 1-1s1 .4 1 1v11.2l4.4-4.4c.4-.4 1-.4 1.4 0s.4 1 0 1.4l-6 6c-.2.2-.5.3-.8.3z\"/>\n          </svg>\n        `;\n        el.appendChild(pullIndicator);\n      }\n\n      function removePullIndicator(el: HTMLDivElement) {\n        const pullIndicator = el.querySelector('.pull-indicator');\n        if (pullIndicator) {\n          pullIndicator.remove();\n        }\n      }\n\n      function flipArrow(el: HTMLDivElement) {\n        const pullIndicator = el.querySelector('.pull-indicator');\n        if (pullIndicator && !pullIndicator.classList.contains('flip')) {\n          pullIndicator.classList.add('flip');\n        }\n      }\n\n      function handleTouchEnd(endEvent: TouchEvent) {\n        const el = ref.current;\n        if (!el) return;\n\n        const wrapper = el.querySelector('.transform-wrapper') as HTMLElement;\n        if (wrapper) {\n          wrapper.style.transform = 'translateY(0)';\n        }\n        removePullIndicator(el.parentNode as HTMLDivElement);\n\n        el.style.transition = 'transform 0.2s';\n\n        const y = endEvent.changedTouches[0]!.clientY;\n        const dy = y - initialY;\n        if (dy > TRIGGER_THRESHOLD) {\n          onTrigger();\n        }\n\n        el.addEventListener('transitionend', onTransitionEnd);\n\n        el.removeEventListener('touchmove', handleTouchMove);\n        el.removeEventListener('touchend', handleTouchEnd);\n      }\n\n      function onTransitionEnd() {\n        const el = ref.current;\n        if (!el) return;\n\n        el.style.transition = '';\n        el.removeEventListener('transitionend', onTransitionEnd);\n      }\n    }\n\n    return () => {\n      el.removeEventListener('touchstart', handleTouchStart);\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [ref.current]);\n};\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 411, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/hooks/useTheme.ts"],"sourcesContent":["'use client';\n\nimport { useCallback, useEffect, useRef } from 'react';\nimport { useEnv } from '@/context/EnvContext';\nimport { useThemeStore } from '@/store/themeStore';\nimport { useSettingsStore } from '@/store/settingsStore';\nimport { themes, applyCustomTheme, Palette } from '@/styles/themes';\nimport { getStatusBarHeight, setSystemUIVisibility } from '@/utils/bridge';\nimport { getOSPlatform } from '@/utils/misc';\nimport { parseWebViewVersion } from '@/utils/ua';\n\ntype UseThemeProps = {\n  systemUIVisible?: boolean;\n  appThemeColor?: keyof Palette;\n};\n\nexport const useTheme = ({\n  systemUIVisible = true,\n  appThemeColor = 'base-100',\n}: UseThemeProps = {}) => {\n  const { appService } = useEnv();\n  const { settings } = useSettingsStore();\n  const {\n    themeColor,\n    isDarkMode,\n    isEinkMode,\n    showSystemUI,\n    dismissSystemUI,\n    updateAppTheme,\n    setStatusBarHeight,\n    systemUIAlwaysHidden,\n    setSystemUIAlwaysHidden,\n  } = useThemeStore();\n\n  const useFallbackColors = useRef(false);\n\n  useEffect(() => {\n    updateAppTheme(appThemeColor);\n    if (appService?.isAndroidApp) {\n      getStatusBarHeight().then((res) => {\n        if (res.height && res.height > 0) {\n          setStatusBarHeight(res.height / window.devicePixelRatio);\n        }\n      });\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [appService?.isAndroidApp]);\n\n  const handleSystemUIVisibility = useCallback(() => {\n    if (!appService?.isMobileApp) return;\n\n    const visible = !!(systemUIVisible && !systemUIAlwaysHidden);\n    if (visible) {\n      showSystemUI();\n    } else {\n      dismissSystemUI();\n    }\n    setSystemUIVisibility({ visible, darkMode: isDarkMode });\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [appService, isDarkMode, systemUIVisible]);\n\n  useEffect(() => {\n    if (appService?.isMobileApp) {\n      handleSystemUIVisibility();\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [handleSystemUIVisibility]);\n\n  useEffect(() => {\n    if (!appService?.isMobileApp) return;\n\n    handleSystemUIVisibility();\n    const handleVisibilityChange = () => {\n      if (document.visibilityState === 'visible') {\n        handleSystemUIVisibility();\n      }\n    };\n    const handleOrientationChange = () => {\n      if (appService?.isIOSApp && getOSPlatform() === 'ios') {\n        // FIXME: This is a workaround for iPhone apps where the system UI is not visible in landscape mode\n        // when the app is in fullscreen mode until we find a better solution to override the prefersStatusBarHidden\n        // in the ViewController. Note that screen.orientation.type is not abailable in iOS before 16.4.\n        const systemUIAlwaysHidden = screen.orientation?.type.includes('landscape');\n        setSystemUIAlwaysHidden(systemUIAlwaysHidden);\n        handleSystemUIVisibility();\n      }\n    };\n    document.addEventListener('visibilitychange', handleVisibilityChange);\n    screen.orientation?.addEventListener('change', handleOrientationChange);\n    return () => {\n      document.removeEventListener('visibilitychange', handleVisibilityChange);\n      screen.orientation?.removeEventListener('change', handleOrientationChange);\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [handleSystemUIVisibility]);\n\n  useEffect(() => {\n    if (!appService?.isAndroidApp) return;\n    const webViewVersion = parseWebViewVersion(appService);\n    // OKLCH color model is supported in Chromium 111+\n    useFallbackColors.current = webViewVersion < 111;\n  }, [appService]);\n\n  useEffect(() => {\n    if (!themeColor || !themes.find((t) => t.name === themeColor)) return;\n    if (useFallbackColors.current) {\n      applyCustomTheme(undefined, themeColor, true);\n    }\n  }, [themeColor]);\n\n  useEffect(() => {\n    const customThemes = settings.globalReadSettings?.customThemes ?? [];\n    customThemes.forEach((customTheme) => {\n      applyCustomTheme(customTheme, undefined, useFallbackColors.current);\n    });\n    localStorage.setItem('customThemes', JSON.stringify(customThemes));\n  }, [settings.globalReadSettings?.customThemes]);\n\n  useEffect(() => {\n    const colorScheme = isDarkMode ? 'dark' : 'light';\n    document.documentElement.setAttribute('data-theme', `${themeColor}-${colorScheme}`);\n    document.documentElement.style.setProperty('color-scheme', colorScheme);\n    document.documentElement.style.setProperty(\n      '--overlayer-highlight-opacity',\n      isEinkMode ? '1.0' : '0.3',\n    );\n    document.documentElement.style.setProperty(\n      '--overlayer-highlight-blend-mode',\n      isEinkMode ? 'difference' : isDarkMode ? 'lighten' : 'normal',\n    );\n    document.documentElement.style.setProperty(\n      '--bg-texture-blend-mode',\n      isDarkMode ? 'lighten' : 'multiply',\n    );\n  }, [themeColor, isDarkMode, isEinkMode]);\n};\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 546, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/hooks/useUICSS.ts"],"sourcesContent":["'use client';\n\nimport { useEffect, useState } from 'react';\nimport { useReaderStore } from '@/store/readerStore';\nimport { useSettingsStore } from '@/store/settingsStore';\n\n// This hook allows you to inject custom CSS into the reader UI.\n// Note that the book content is rendered in an iframe, so UI CSS won't affect book rendering.\nexport const useUICSS = (bookKey?: string) => {\n  const { settings } = useSettingsStore();\n  const { getViewSettings } = useReaderStore();\n  const viewSettings = getViewSettings(bookKey || '');\n  const [styleElement, setStyleElement] = useState<HTMLStyleElement | null>(null);\n\n  useEffect(() => {\n    if (styleElement) {\n      styleElement.remove();\n    }\n\n    const rawCSS =\n      viewSettings?.userUIStylesheet || settings?.globalViewSettings?.userUIStylesheet || '';\n\n    const newStyleEl = document.createElement('style');\n    newStyleEl.textContent = rawCSS.replace('foliate-view', `#foliate-view-${bookKey}`);\n    document.head.appendChild(newStyleEl);\n    setStyleElement(newStyleEl);\n\n    return () => {\n      newStyleEl.remove();\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [viewSettings?.userUIStylesheet, settings?.globalViewSettings?.userUIStylesheet, bookKey]);\n};\n"],"names":[],"mappings":";;;;AAEA;AACA;AACA;AAJA;;;;AAQO,MAAM,WAAW,CAAC;IACvB,MAAM,EAAE,QAAQ,EAAE,GAAG,IAAA,2KAAgB;IACrC,MAAM,EAAE,eAAe,EAAE,GAAG,IAAA,uKAAc;IAC1C,MAAM,eAAe,gBAAgB,WAAW;IAChD,MAAM,CAAC,cAAc,gBAAgB,GAAG,IAAA,mXAAQ,EAA0B;IAE1E,IAAA,oXAAS,EAAC;QACR,IAAI,cAAc;YAChB,aAAa,MAAM;QACrB;QAEA,MAAM,SACJ,cAAc,oBAAoB,UAAU,oBAAoB,oBAAoB;QAEtF,MAAM,aAAa,SAAS,aAAa,CAAC;QAC1C,WAAW,WAAW,GAAG,OAAO,OAAO,CAAC,gBAAgB,CAAC,cAAc,EAAE,SAAS;QAClF,SAAS,IAAI,CAAC,WAAW,CAAC;QAC1B,gBAAgB;QAEhB,OAAO;YACL,WAAW,MAAM;QACnB;IACA,uDAAuD;IACzD,GAAG;QAAC,cAAc;QAAkB,UAAU,oBAAoB;QAAkB;KAAQ;AAC9F"}},
    {"offset": {"line": 585, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/hooks/useSync.ts"],"sourcesContent":["'use client';\n\nimport { useCallback, useEffect, useState } from 'react';\nimport { useRouter } from 'next/navigation';\nimport { useSyncContext } from '@/context/SyncContext';\nimport { SyncData, SyncOp, SyncResult, SyncType } from '@/libs/sync';\nimport { useSettingsStore } from '@/store/settingsStore';\nimport { useBookDataStore } from '@/store/bookDataStore';\nimport { transformBookConfigFromDB } from '@/utils/transform';\nimport { transformBookNoteFromDB } from '@/utils/transform';\nimport { transformBookFromDB } from '@/utils/transform';\nimport { DBBook, DBBookConfig, DBBookNote } from '@/types/records';\nimport { Book, BookConfig, BookDataRecord, BookNote } from '@/types/book';\nimport { navigateToLogin } from '@/utils/nav';\nimport { useReaderStore } from '@/store/readerStore';\n\nconst transformsFromDB = {\n  books: transformBookFromDB,\n  notes: transformBookNoteFromDB,\n  configs: transformBookConfigFromDB,\n};\n\nconst computeMaxTimestamp = (records: BookDataRecord[]): number => {\n  let maxTime = 0;\n  for (const rec of records) {\n    if (rec.updated_at) {\n      const updatedTime = new Date(rec.updated_at).getTime();\n      maxTime = Math.max(maxTime, updatedTime);\n    }\n    if (rec.deleted_at) {\n      const deletedTime = new Date(rec.deleted_at).getTime();\n      maxTime = Math.max(maxTime, deletedTime);\n    }\n  }\n  return maxTime;\n};\n\nconst ONE_DAY_IN_MS = 24 * 60 * 60 * 1000;\nexport function useSync(bookKey?: string) {\n  const router = useRouter();\n  const { settings, setSettings } = useSettingsStore();\n  const { getConfig, setConfig } = useBookDataStore();\n  const { setIsSyncing } = useReaderStore();\n  const config = bookKey ? getConfig(bookKey) : null;\n\n  const [syncingBooks, setSyncingBooks] = useState(false);\n  const [syncingConfigs, setSyncingConfigs] = useState(false);\n  const [syncingNotes, setSyncingNotes] = useState(false);\n  const [syncError, setSyncError] = useState<string | null>(null);\n  const [lastSyncedAtBooks, setLastSyncedAtBooks] = useState<number>(0);\n  const [lastSyncedAtConfigs, setLastSyncedAtConfigs] = useState<number>(0);\n  const [lastSyncedAtNotes, setLastSyncedAtNotes] = useState<number>(0);\n  const [lastSyncedAtInited, setLastSyncedAtInited] = useState(false);\n\n  const [syncing, setSyncing] = useState(false);\n  // null means unsynced, empty array means synced no changes\n  const [syncResult, setSyncResult] = useState<SyncResult>({\n    books: null,\n    configs: null,\n    notes: null,\n  });\n  const [syncedBooks, setSyncedBooks] = useState<Book[] | null>(null);\n  const [syncedConfigs, setSyncedConfigs] = useState<BookConfig[] | null>(null);\n  const [syncedNotes, setSyncedNotes] = useState<BookNote[] | null>(null);\n\n  const { syncClient } = useSyncContext();\n\n  useEffect(() => {\n    if (!bookKey) return;\n    setIsSyncing(bookKey, syncing);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [bookKey, syncing]);\n\n  useEffect(() => {\n    if (!settings.version) return;\n    if (bookKey && !config?.location) return;\n    if (lastSyncedAtInited) return;\n\n    const lastSyncedBooksAt = settings.lastSyncedAtBooks ?? 0;\n    const lastSyncedConfigsAt = config?.lastSyncedAtConfig ?? settings.lastSyncedAtConfigs ?? 0;\n    const lastSyncedNotesAt = config?.lastSyncedAtNotes ?? settings.lastSyncedAtNotes ?? 0;\n    const now = Date.now();\n    setLastSyncedAtBooks(\n      now - lastSyncedBooksAt > 3 * ONE_DAY_IN_MS ? 0 : lastSyncedBooksAt - ONE_DAY_IN_MS,\n    );\n    setLastSyncedAtConfigs(\n      now - lastSyncedConfigsAt > 3 * ONE_DAY_IN_MS ? 0 : lastSyncedConfigsAt - ONE_DAY_IN_MS,\n    );\n    setLastSyncedAtNotes(\n      now - lastSyncedNotesAt > 3 * ONE_DAY_IN_MS ? 0 : lastSyncedNotesAt - ONE_DAY_IN_MS,\n    );\n    setLastSyncedAtInited(true);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [bookKey, settings, config]);\n\n  // bookId is for configs and notes only, if bookId is provided, only pull changes for that book\n  // and update the lastSyncedAt for that book in the book config\n  const pullChanges = async (\n    type: SyncType,\n    since: number,\n    setLastSyncedAt: React.Dispatch<React.SetStateAction<number>>,\n    setSyncing: React.Dispatch<React.SetStateAction<boolean>>,\n    bookId?: string,\n    metaHash?: string,\n  ) => {\n    setSyncing(true);\n    setSyncError(null);\n\n    try {\n      const result = await syncClient.pullChanges(since, type, bookId, metaHash);\n      setSyncResult({ ...syncResult, [type]: result[type] });\n      const records = result[type];\n      if (since > 0 && !records?.length) return;\n      // For since = 0, we set lastSyncedAt to now if no records returned\n      const maxTime = records?.length ? computeMaxTimestamp(records) : Date.now();\n      setLastSyncedAt(maxTime);\n\n      // due to closures in React hooks the settings might be stale\n      // we need to fetch the latest settings from store\n      const settings = useSettingsStore.getState().settings;\n      switch (type) {\n        case 'books':\n          settings.lastSyncedAtBooks = maxTime;\n          setSettings(settings);\n          break;\n        case 'configs':\n          if (!bookId) {\n            settings.lastSyncedAtConfigs = maxTime;\n            setSettings(settings);\n          } else if (bookKey) {\n            setConfig(bookKey, { lastSyncedAtConfig: maxTime });\n          }\n          break;\n        case 'notes':\n          if (!bookId) {\n            settings.lastSyncedAtNotes = maxTime;\n            setSettings(settings);\n          } else if (bookKey) {\n            setConfig(bookKey, { lastSyncedAtNotes: maxTime });\n          }\n          break;\n      }\n    } catch (err: unknown) {\n      console.error(err);\n      if (err instanceof Error) {\n        if (err.message.includes('Not authenticated') && settings.keepLogin) {\n          settings.keepLogin = false;\n          setSettings(settings);\n          navigateToLogin(router);\n        }\n        setSyncError(err.message || `Error pulling ${type}`);\n      } else {\n        setSyncError(`Error pulling ${type}`);\n      }\n    } finally {\n      setSyncing(false);\n    }\n  };\n\n  const pushChanges = async (payload: SyncData) => {\n    setSyncing(true);\n    setSyncError(null);\n\n    try {\n      const result = await syncClient.pushChanges(payload);\n      setSyncResult(result);\n    } catch (err: unknown) {\n      console.error(err);\n      if (err instanceof Error) {\n        setSyncError(err.message || 'Error pushing changes');\n      } else {\n        setSyncError('Error pushing changes');\n      }\n    } finally {\n      setSyncing(false);\n    }\n  };\n\n  const syncBooks = useCallback(\n    async (books?: Book[], op: SyncOp = 'both') => {\n      if (!lastSyncedAtInited) return;\n      if ((op === 'push' || op === 'both') && books?.length) {\n        await pushChanges({ books });\n      }\n      if (op === 'pull' || op === 'both') {\n        await pullChanges('books', lastSyncedAtBooks + 1, setLastSyncedAtBooks, setSyncingBooks);\n      }\n    },\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    [lastSyncedAtInited, lastSyncedAtBooks],\n  );\n\n  const syncConfigs = useCallback(\n    async (bookConfigs?: BookConfig[], bookId?: string, metaHash?: string, op: SyncOp = 'both') => {\n      if (!bookId && !lastSyncedAtInited) return;\n      if ((op === 'push' || op === 'both') && bookConfigs?.length) {\n        await pushChanges({ configs: bookConfigs });\n      }\n      if (op === 'pull' || op === 'both') {\n        await pullChanges(\n          'configs',\n          lastSyncedAtConfigs,\n          setLastSyncedAtConfigs,\n          setSyncingConfigs,\n          bookId,\n          metaHash,\n        );\n      }\n    },\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    [lastSyncedAtInited, lastSyncedAtConfigs],\n  );\n\n  const syncNotes = useCallback(\n    async (bookNotes?: BookNote[], bookId?: string, metaHash?: string, op: SyncOp = 'both') => {\n      if (!lastSyncedAtInited) return;\n      if ((op === 'push' || op === 'both') && bookNotes?.length) {\n        await pushChanges({ notes: bookNotes });\n      }\n      if (op === 'pull' || op === 'both') {\n        await pullChanges(\n          'notes',\n          lastSyncedAtNotes,\n          setLastSyncedAtNotes,\n          setSyncingNotes,\n          bookId,\n          metaHash,\n        );\n      }\n    },\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    [lastSyncedAtInited, lastSyncedAtNotes],\n  );\n\n  useEffect(() => {\n    if (!syncing && syncResult) {\n      const { books: dbBooks, configs: dbBookConfigs, notes: dbBookNotes } = syncResult;\n      const books = dbBooks?.map((dbBook) =>\n        transformsFromDB['books'](dbBook as unknown as DBBook),\n      );\n      const configs = dbBookConfigs?.map((dbBookConfig) =>\n        transformsFromDB['configs'](dbBookConfig as unknown as DBBookConfig),\n      );\n      const notes = dbBookNotes?.map((dbBookNote) =>\n        transformsFromDB['notes'](dbBookNote as unknown as DBBookNote),\n      );\n      if (books) setSyncedBooks(books);\n      if (configs) setSyncedConfigs(configs);\n      if (notes) setSyncedNotes(notes);\n    }\n  }, [syncResult, syncing]);\n\n  return {\n    syncing: syncingBooks || syncingConfigs || syncingNotes,\n    syncError,\n    syncResult,\n    syncedBooks,\n    syncedConfigs,\n    syncedNotes,\n    lastSyncedAtBooks,\n    lastSyncedAtNotes,\n    lastSyncedAtConfigs,\n    useSyncInited: lastSyncedAtInited,\n    pullChanges,\n    pushChanges,\n    syncBooks,\n    syncConfigs,\n    syncNotes,\n  };\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 838, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/hooks/useScreenWakeLock.ts"],"sourcesContent":["'use client';\n\nimport { useEffect, useRef } from 'react';\nimport { getCurrentWindow } from '@tauri-apps/api/window';\nimport { isTauriAppPlatform, isWebAppPlatform } from '@/services/environment';\n\nexport const useScreenWakeLock = (lock: boolean) => {\n  const wakeLockRef = useRef<WakeLockSentinel | null>(null);\n  const unlistenOnFocusChangedRef = useRef<Promise<() => void> | null>(null);\n\n  useEffect(() => {\n    const requestWakeLock = async () => {\n      try {\n        if ('wakeLock' in navigator) {\n          wakeLockRef.current = await navigator.wakeLock.request('screen');\n\n          wakeLockRef.current.addEventListener('release', () => {\n            wakeLockRef.current = null;\n          });\n\n          console.log('Wake lock acquired');\n        }\n      } catch (err) {\n        console.info('Failed to acquire wake lock:', err);\n      }\n    };\n\n    const releaseWakeLock = () => {\n      if (wakeLockRef.current) {\n        wakeLockRef.current.release();\n        wakeLockRef.current = null;\n        console.log('Wake lock released');\n      }\n    };\n\n    const handleVisibilityChange = () => {\n      if (document.hidden) {\n        releaseWakeLock();\n      } else {\n        requestWakeLock();\n      }\n    };\n\n    if (lock) {\n      requestWakeLock();\n    } else if (wakeLockRef.current) {\n      releaseWakeLock();\n    }\n\n    if (isWebAppPlatform() && lock) {\n      document.addEventListener('visibilitychange', handleVisibilityChange);\n    } else if (isTauriAppPlatform() && lock) {\n      unlistenOnFocusChangedRef.current = getCurrentWindow().onFocusChanged(\n        ({ payload: focused }) => {\n          if (focused) {\n            requestWakeLock();\n          } else {\n            releaseWakeLock();\n          }\n        },\n      );\n    }\n\n    return () => {\n      releaseWakeLock();\n      if (isWebAppPlatform() && lock) {\n        document.removeEventListener('visibilitychange', handleVisibilityChange);\n      }\n      if (unlistenOnFocusChangedRef.current) {\n        unlistenOnFocusChangedRef.current.then((f) => f());\n      }\n    };\n  }, [lock]);\n};\n"],"names":[],"mappings":";;;;AAEA;AACA;AACA;AAJA;;;;AAMO,MAAM,oBAAoB,CAAC;IAChC,MAAM,cAAc,IAAA,iXAAM,EAA0B;IACpD,MAAM,4BAA4B,IAAA,iXAAM,EAA6B;IAErE,IAAA,oXAAS,EAAC;QACR,MAAM,kBAAkB;YACtB,IAAI;gBACF,IAAI,cAAc,WAAW;oBAC3B,YAAY,OAAO,GAAG,MAAM,UAAU,QAAQ,CAAC,OAAO,CAAC;oBAEvD,YAAY,OAAO,CAAC,gBAAgB,CAAC,WAAW;wBAC9C,YAAY,OAAO,GAAG;oBACxB;oBAEA,QAAQ,GAAG,CAAC;gBACd;YACF,EAAE,OAAO,KAAK;gBACZ,QAAQ,IAAI,CAAC,gCAAgC;YAC/C;QACF;QAEA,MAAM,kBAAkB;YACtB,IAAI,YAAY,OAAO,EAAE;gBACvB,YAAY,OAAO,CAAC,OAAO;gBAC3B,YAAY,OAAO,GAAG;gBACtB,QAAQ,GAAG,CAAC;YACd;QACF;QAEA,MAAM,yBAAyB;YAC7B,IAAI,SAAS,MAAM,EAAE;gBACnB;YACF,OAAO;gBACL;YACF;QACF;QAEA,IAAI,MAAM;YACR;QACF,OAAO,IAAI,YAAY,OAAO,EAAE;YAC9B;QACF;QAEA,IAAI,IAAA,4KAAgB,OAAM,MAAM;YAC9B,SAAS,gBAAgB,CAAC,oBAAoB;QAChD,OAAO,IAAI,IAAA,8KAAkB,OAAM,MAAM;YACvC,0BAA0B,OAAO,GAAG,IAAA,uPAAgB,IAAG,cAAc,CACnE,CAAC,EAAE,SAAS,OAAO,EAAE;gBACnB,IAAI,SAAS;oBACX;gBACF,OAAO;oBACL;gBACF;YACF;QAEJ;QAEA,OAAO;YACL;YACA,IAAI,IAAA,4KAAgB,OAAM,MAAM;gBAC9B,SAAS,mBAAmB,CAAC,oBAAoB;YACnD;YACA,IAAI,0BAA0B,OAAO,EAAE;gBACrC,0BAA0B,OAAO,CAAC,IAAI,CAAC,CAAC,IAAM;YAChD;QACF;IACF,GAAG;QAAC;KAAK;AACX"}},
    {"offset": {"line": 913, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/hooks/useOpenWithBooks.ts"],"sourcesContent":["'use client';\n\nimport { useEffect, useRef } from 'react';\nimport { useRouter } from 'next/navigation';\nimport { useEnv } from '@/context/EnvContext';\nimport { useLibraryStore } from '@/store/libraryStore';\nimport { useSettingsStore } from '@/store/settingsStore';\nimport { addPluginListener, PluginListener } from '@tauri-apps/api/core';\nimport { onOpenUrl } from '@tauri-apps/plugin-deep-link';\nimport { getCurrentWindow, getAllWindows } from '@tauri-apps/api/window';\nimport { isTauriAppPlatform } from '@/services/environment';\nimport { navigateToLibrary, showLibraryWindow } from '@/utils/nav';\n\ninterface SingleInstancePayload {\n  args: string[];\n  cwd: string;\n}\n\ninterface OpenFilesPayload {\n  files: string[];\n}\n\ninterface SharedIntentPayload {\n  urls: string[];\n}\n\nexport function useOpenWithBooks() {\n  const router = useRouter();\n  const { appService } = useEnv();\n  const { setCheckOpenWithBooks } = useLibraryStore();\n  const listenedOpenWithBooks = useRef(false);\n\n  const isFirstWindow = async () => {\n    if (!isTauriAppPlatform()) return true; // Web \n    try {\n      const allWindows = await getAllWindows();\n      const currentWindow = getCurrentWindow();\n      const sortedWindows = allWindows.sort((a, b) => a.label.localeCompare(b.label));\n      return sortedWindows[0]?.label === currentWindow.label;\n    } catch (error) {\n      console.warn('Failed to check if first window:', error);\n      return true;\n    }\n  };\n\n  const handleOpenWithFileUrl = async (urls: string[]) => {\n    console.log('Handle Open with URL:', urls);\n    const filePaths = [];\n    for (let url of urls) {\n      if (url.startsWith('file://')) {\n        if (appService?.isIOSApp) {\n          url = decodeURI(url);\n        } else {\n          url = decodeURI(url.replace('file://', ''));\n        }\n      }\n      if (!/^(https?:|data:|blob:)/i.test(url)) {\n        filePaths.push(url);\n      }\n    }\n    if (filePaths.length > 0) {\n      const settings = useSettingsStore.getState().settings;\n      if (appService?.hasWindow && settings.openBookInNewWindow) {\n        if (await isFirstWindow()) {\n          showLibraryWindow(appService, filePaths);\n        }\n      } else {\n        window.OPEN_WITH_FILES = filePaths;\n        setCheckOpenWithBooks(true);\n        navigateToLibrary(router, `reload=${Date.now()}`);\n      }\n    }\n  };\n\n  const initializeListeners = async () => {\n    return await addPluginListener<SharedIntentPayload>(\n      'native-bridge',\n      'shared-intent',\n      (payload) => {\n        console.log('Received shared intent:', payload);\n        const { urls } = payload;\n        handleOpenWithFileUrl(urls);\n      },\n    );\n  };\n\n  useEffect(() => {\n    if (!isTauriAppPlatform() || !appService) return;\n    if (listenedOpenWithBooks.current) return;\n    listenedOpenWithBooks.current = true;\n\n    // For Windows/Linux deep link and macOS open-file event\n    const unlistenDeeplink = getCurrentWindow().listen<SingleInstancePayload>(\n      'single-instance',\n      ({ payload }) => {\n        console.log('Received deep link:', payload);\n        const { args } = payload;\n        if (args?.[1]) {\n          handleOpenWithFileUrl([args[1]]);\n        }\n      },\n    );\n\n    // macOS in-app open-files event\n    const unlistenOpenFiles = getCurrentWindow().listen<OpenFilesPayload>(\n      'open-files',\n      ({ payload }) => {\n        console.log('Received open files:', payload);\n        const { files } = payload;\n        if (files && files.length > 0) {\n          handleOpenWithFileUrl(files);\n        }\n      },\n    );\n\n    // For Android \"Share to Readest\" intent\n    let unlistenSharedIntent: Promise<PluginListener> | null = null;\n    // FIXME: register/unregister plugin listeniner on iOS might cause app freeze for unknown reason\n    // so we only register it on Android for now to support \"Shared to Readest\" feature\n    if (appService?.isAndroidApp) {\n      unlistenSharedIntent = initializeListeners();\n    }\n\n    // iOS Open with URL event\n    const listenOpenWithFiles = async () => {\n      return await onOpenUrl((urls) => {\n        handleOpenWithFileUrl(urls);\n      });\n    };\n    const unlistenOpenUrl = listenOpenWithFiles();\n    return () => {\n      unlistenDeeplink.then((f) => f());\n      unlistenOpenFiles.then((f) => f());\n      unlistenOpenUrl.then((f) => f());\n      unlistenSharedIntent?.then((f) => f.unregister());\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [appService]);\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1041, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/hooks/useFileSelector.ts"],"sourcesContent":["import { AppService } from '@/types/system';\nimport { isTauriAppPlatform } from '@/services/environment';\nimport { basename } from '@tauri-apps/api/path';\nimport { stubTranslation as _ } from '@/utils/misc';\nimport { BOOK_ACCEPT_FORMATS, SUPPORTED_BOOK_EXTS } from '@/services/constants';\n\nexport interface FileSelectorOptions {\n  type: SelectionType;\n  accept?: string;\n  multiple?: boolean;\n  extensions?: string[];\n  dialogTitle?: string;\n}\n\nexport interface SelectedFile {\n  // For Web file\n  file?: File;\n\n  // For Tauri file\n  path?: string;\n  basePath?: string;\n}\n\nexport interface FileSelectionResult {\n  files: SelectedFile[];\n  error?: string;\n}\n\nconst selectFileWeb = (options: FileSelectorOptions): Promise<File[]> => {\n  return new Promise((resolve) => {\n    const fileInput = document.createElement('input');\n    fileInput.type = 'file';\n    fileInput.accept = options.accept || '*/*';\n    fileInput.multiple = options.multiple || false;\n    fileInput.click();\n\n    fileInput.onchange = () => {\n      resolve(Array.from(fileInput.files || []));\n    };\n  });\n};\n\nconst selectFileTauri = async (\n  options: FileSelectorOptions,\n  appService: AppService,\n  _: (key: string) => string,\n): Promise<string[]> => {\n  const noFilter = appService?.isIOSApp || (appService?.isAndroidApp && options.type === 'books');\n  const exts = noFilter ? [] : options.extensions || [];\n  const title = options.dialogTitle || _('Select Files');\n  let files = (await appService?.selectFiles(_(title), exts)) || [];\n\n  if (noFilter && options.extensions) {\n    files = await Promise.all(\n      files.map(async (file: string) => {\n        let processedFile = file;\n        if (appService?.isAndroidApp && file.startsWith('content://')) {\n          processedFile = await basename(file);\n        }\n        const fileExt = processedFile.split('.').pop()?.toLowerCase() || 'unknown';\n        const extensions = options.extensions!;\n        const shouldInclude = extensions.includes(fileExt) || extensions.includes('*');\n        return shouldInclude ? file : null;\n      }),\n    ).then((results) => results.filter((file) => file !== null));\n  }\n\n  return files;\n};\n\nconst processWebFiles = (files: File[]): SelectedFile[] => {\n  return files.map((file) => ({\n    file,\n  }));\n};\n\nconst processTauriFiles = (files: string[]): SelectedFile[] => {\n  return files.map((path) => ({\n    path,\n  }));\n};\n\nexport const useFileSelector = (appService: AppService | null, _: (key: string) => string) => {\n  const selectFiles = async (options: FileSelectorOptions = { type: 'generic' }) => {\n    options = { ...FILE_SELECTION_PRESETS[options.type], ...options };\n    if (!appService) {\n      return { files: [] as SelectedFile[], error: 'App service is not available' };\n    }\n    try {\n      if (isTauriAppPlatform()) {\n        const filePaths = await selectFileTauri(options, appService, _);\n        const files = await processTauriFiles(filePaths);\n        return { files };\n      } else {\n        const webFiles = await selectFileWeb(options);\n        const files = processWebFiles(webFiles);\n        return { files };\n      }\n    } catch (error) {\n      return {\n        files: [],\n        error: error instanceof Error ? error.message : 'Unknown error occurred',\n      };\n    }\n  };\n  return {\n    selectFiles,\n  };\n};\n\nexport const FILE_SELECTION_PRESETS = {\n  generic: {\n    accept: '*/*',\n    extensions: ['*'],\n    dialogTitle: _('Select Files'),\n  },\n  images: {\n    accept: 'image/*',\n    extensions: ['jpg', 'jpeg', 'png', 'gif', 'webp', 'svg'],\n    dialogTitle: _('Select Image'),\n  },\n  videos: {\n    accept: 'video/*',\n    extensions: ['mp4', 'avi', 'mov', 'wmv', 'flv', 'webm'],\n    dialogTitle: _('Select Video'),\n  },\n  audio: {\n    accept: 'audio/*',\n    extensions: ['mp3', 'wav', 'ogg', 'flac', 'm4a'],\n    dialogTitle: _('Select Audio'),\n  },\n  books: {\n    accept: BOOK_ACCEPT_FORMATS,\n    extensions: SUPPORTED_BOOK_EXTS,\n    dialogTitle: _('Select Books'),\n  },\n  fonts: {\n    accept: '.ttf, .otf, .woff, .woff2',\n    extensions: ['ttf', 'otf', 'woff', 'woff2'],\n    dialogTitle: _('Select Fonts'),\n  },\n  covers: {\n    accept: '.png, .jpg, .jpeg, .gif',\n    extensions: ['png', 'jpg', 'jpeg', 'gif'],\n    dialogTitle: _('Select Image'),\n  },\n};\n\nexport type SelectionType = keyof typeof FILE_SELECTION_PRESETS;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1208, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/hooks/useKeyDownActions.ts"],"sourcesContent":["'use client';\n\nimport { RefObject, useEffect, useRef } from 'react';\nimport { useEnv } from '@/context/EnvContext';\nimport { useDeviceControlStore } from '@/store/deviceStore';\nimport { eventDispatcher } from '@/utils/event';\n\ninterface UseKeyDownOptions {\n  onCancel?: () => void;\n  onConfirm?: () => void;\n  enabled?: boolean;\n  elementRef?: RefObject<HTMLElement>;\n}\n\nexport const useKeyDownActions = ({\n  onCancel,\n  onConfirm,\n  enabled = true,\n  elementRef: providedRef,\n}: UseKeyDownOptions) => {\n  const { appService } = useEnv();\n  const { acquireBackKeyInterception, releaseBackKeyInterception } = useDeviceControlStore();\n  const internalRef = useRef<HTMLDivElement>(null);\n  const elementRef = providedRef || internalRef;\n\n  useEffect(() => {\n    if (!enabled) return;\n\n    const handleKeyDown = (event: KeyboardEvent | CustomEvent) => {\n      if (event instanceof CustomEvent) {\n        if (event.detail.keyName === 'Back') {\n          onCancel?.();\n          return true;\n        }\n      } else {\n        if (event.key === 'Escape') {\n          onCancel?.();\n        } else if (event.key === 'Enter') {\n          onConfirm?.();\n        }\n        event.stopPropagation();\n      }\n      return false;\n    };\n\n    window.addEventListener('keydown', handleKeyDown);\n\n    if (elementRef.current) {\n      elementRef.current.addEventListener('keydown', handleKeyDown);\n    }\n\n    if (appService?.isAndroidApp) {\n      acquireBackKeyInterception?.();\n      eventDispatcher.onSync('native-key-down', handleKeyDown);\n    }\n\n    return () => {\n      window.removeEventListener('keydown', handleKeyDown);\n\n      if (appService?.isAndroidApp) {\n        releaseBackKeyInterception?.();\n        eventDispatcher.offSync('native-key-down', handleKeyDown);\n      }\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [enabled, appService?.isAndroidApp]);\n\n  return internalRef;\n};\n"],"names":[],"mappings":";;;;AAEA;AACA;AACA;AACA;AALA;;;;;AAcO,MAAM,oBAAoB,CAAC,EAChC,QAAQ,EACR,SAAS,EACT,UAAU,IAAI,EACd,YAAY,WAAW,EACL;IAClB,MAAM,EAAE,UAAU,EAAE,GAAG,IAAA,iKAAM;IAC7B,MAAM,EAAE,0BAA0B,EAAE,0BAA0B,EAAE,GAAG,IAAA,8KAAqB;IACxF,MAAM,cAAc,IAAA,iXAAM,EAAiB;IAC3C,MAAM,aAAa,eAAe;IAElC,IAAA,oXAAS,EAAC;QACR,IAAI,CAAC,SAAS;QAEd,MAAM,gBAAgB,CAAC;YACrB,IAAI,iBAAiB,aAAa;gBAChC,IAAI,MAAM,MAAM,CAAC,OAAO,KAAK,QAAQ;oBACnC;oBACA,OAAO;gBACT;YACF,OAAO;gBACL,IAAI,MAAM,GAAG,KAAK,UAAU;oBAC1B;gBACF,OAAO,IAAI,MAAM,GAAG,KAAK,SAAS;oBAChC;gBACF;gBACA,MAAM,eAAe;YACvB;YACA,OAAO;QACT;QAEA,OAAO,gBAAgB,CAAC,WAAW;QAEnC,IAAI,WAAW,OAAO,EAAE;YACtB,WAAW,OAAO,CAAC,gBAAgB,CAAC,WAAW;QACjD;QAEA,IAAI,YAAY,cAAc;YAC5B;YACA,kKAAe,CAAC,MAAM,CAAC,mBAAmB;QAC5C;QAEA,OAAO;YACL,OAAO,mBAAmB,CAAC,WAAW;YAEtC,IAAI,YAAY,cAAc;gBAC5B;gBACA,kKAAe,CAAC,OAAO,CAAC,mBAAmB;YAC7C;QACF;IACA,uDAAuD;IACzD,GAAG;QAAC;QAAS,YAAY;KAAa;IAEtC,OAAO;AACT"}},
    {"offset": {"line": 1270, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/hooks/useTransferQueue.ts"],"sourcesContent":["'use client';\n\nimport { useEffect, useCallback, useMemo } from 'react';\nimport { useEnv } from '@/context/EnvContext';\nimport { useTranslation } from './useTranslation';\nimport { useLibraryStore } from '@/store/libraryStore';\nimport { useTransferStore, TransferType } from '@/store/transferStore';\nimport { transferManager } from '@/services/transferManager';\nimport { Book } from '@/types/book';\n\nexport function useTransferQueue(libraryLoaded = true, delayInit = 0) {\n  const { envConfig, appService } = useEnv();\n  const _ = useTranslation();\n\n  const transfers = useTransferStore((state) => state.transfers);\n  const isQueuePaused = useTransferStore((state) => state.isQueuePaused);\n  const setIsTransferQueueOpen = useTransferStore((state) => state.setIsTransferQueueOpen);\n\n  useEffect(() => {\n    const initManager = async () => {\n      if (appService && envConfig) {\n        const getLibrary = () => useLibraryStore.getState().library;\n        const updateBookFn = async (book: Book) => {\n          await useLibraryStore.getState().updateBook(envConfig, book);\n        };\n        const translationFn = _;\n        await transferManager.initialize(appService, getLibrary, updateBookFn, translationFn);\n      }\n    };\n\n    // Initialize transfer manager only when library is loaded\n    if (libraryLoaded) {\n      setTimeout(() => {\n        initManager();\n      }, delayInit);\n    }\n  }, [appService, envConfig, libraryLoaded, delayInit, _]);\n\n  const queueUpload = useCallback((book: Book, priority?: number) => {\n    return transferManager.queueUpload(book, priority);\n  }, []);\n\n  const queueDownload = useCallback((book: Book, priority?: number) => {\n    return transferManager.queueDownload(book, priority);\n  }, []);\n\n  const queueBatchUploads = useCallback((books: Book[], priority?: number) => {\n    return transferManager.queueBatchUploads(books, priority);\n  }, []);\n\n  const cancelTransfer = useCallback((transferId: string) => {\n    transferManager.cancelTransfer(transferId);\n  }, []);\n\n  const retryTransfer = useCallback((transferId: string) => {\n    transferManager.retryTransfer(transferId);\n  }, []);\n\n  const retryAllFailed = useCallback(() => {\n    transferManager.retryAllFailed();\n  }, []);\n\n  const pauseQueue = useCallback(() => {\n    transferManager.pauseQueue();\n  }, []);\n\n  const resumeQueue = useCallback(() => {\n    transferManager.resumeQueue();\n  }, []);\n\n  const clearCompleted = useCallback(() => {\n    useTransferStore.getState().clearCompleted();\n  }, []);\n\n  const clearFailed = useCallback(() => {\n    useTransferStore.getState().clearFailed();\n  }, []);\n\n  const clearAll = useCallback(() => {\n    useTransferStore.getState().clearAll();\n  }, []);\n\n  const getTransferProgress = useCallback((bookHash: string, type: TransferType) => {\n    return useTransferStore.getState().getTransferByBookHash(bookHash, type);\n  }, []);\n\n  const stats = useMemo(() => {\n    const transferList = Object.values(transfers);\n    return {\n      pending: transferList.filter((t) => t.status === 'pending').length,\n      active: transferList.filter((t) => t.status === 'in_progress').length,\n      completed: transferList.filter((t) => t.status === 'completed').length,\n      failed: transferList.filter((t) => t.status === 'failed' || t.status === 'cancelled').length,\n      total: transferList.length,\n    };\n  }, [transfers]);\n\n  const pendingTransfers = useMemo(() => {\n    return Object.values(transfers).filter((t) => t.status === 'pending');\n  }, [transfers]);\n\n  const activeTransfers = useMemo(() => {\n    return Object.values(transfers).filter((t) => t.status === 'in_progress');\n  }, [transfers]);\n\n  const failedTransfers = useMemo(() => {\n    return Object.values(transfers).filter(\n      (t) => t.status === 'failed' || t.status === 'cancelled',\n    );\n  }, [transfers]);\n\n  const completedTransfers = useMemo(() => {\n    return Object.values(transfers).filter((t) => t.status === 'completed');\n  }, [transfers]);\n\n  const hasActiveTransfers = useMemo(() => {\n    return pendingTransfers.length > 0 || activeTransfers.length > 0;\n  }, [pendingTransfers, activeTransfers]);\n\n  return {\n    transfers: Object.values(transfers),\n    isQueuePaused,\n    stats,\n    pendingTransfers,\n    activeTransfers,\n    failedTransfers,\n    completedTransfers,\n    hasActiveTransfers,\n\n    setIsTransferQueueOpen,\n    queueUpload,\n    queueDownload,\n    queueBatchUploads,\n    cancelTransfer,\n    retryTransfer,\n    retryAllFailed,\n    pauseQueue,\n    resumeQueue,\n    clearCompleted,\n    clearFailed,\n    clearAll,\n    getTransferProgress,\n  };\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1419, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/hooks/useQuotaStats.ts"],"sourcesContent":["'use client';\n\nimport { useEffect, useState } from 'react';\nimport { useAuth } from '@/context/AuthContext';\nimport { QuotaType, UserPlan } from '@/types/quota';\nimport { getStoragePlanData, getTranslationPlanData, getUserProfilePlan } from '@/utils/access';\nimport { useTranslation } from './useTranslation';\n\nexport const useQuotaStats = (briefName = false) => {\n  const _ = useTranslation();\n  const { token, user } = useAuth();\n  const [quotas, setQuotas] = useState<QuotaType[]>([]);\n  const [userProfilePlan, setUserProfilePlan] = useState<UserPlan | undefined>(undefined);\n\n  useEffect(() => {\n    if (!user || !token) return;\n\n    const storagPlan = getStoragePlanData(token);\n    const inGB = storagPlan.quota > 1e9;\n    const storageQuota: QuotaType = {\n      name: briefName ? _('Storage') : _('Cloud Sync Storage'),\n      tooltip: _('{{percentage}}% of Cloud Sync Space Used.', {\n        percentage: Math.round((storagPlan.usage / storagPlan.quota) * 100),\n      }),\n      used: parseFloat((storagPlan.usage / 1024 / 1024 / (inGB ? 1024 : 1)).toFixed(2)),\n      total: Math.round((storagPlan.quota / 1024 / 1024 / (inGB ? 1024 : 1)) * 10) / 10,\n      unit: inGB ? 'GB' : 'MB',\n    };\n    const translationPlan = getTranslationPlanData(token);\n    const translationQuota: QuotaType = {\n      name: briefName ? _('Translation') : _('Translation Characters'),\n      tooltip: _('{{percentage}}% of Daily Translation Characters Used.', {\n        percentage: Math.round((translationPlan.usage / translationPlan.quota) * 100),\n      }),\n      used: Math.round(translationPlan.usage / 1024),\n      total: Math.round(translationPlan.quota / 1024),\n      unit: 'K',\n    };\n    setUserProfilePlan(getUserProfilePlan(token));\n    setQuotas([storageQuota, translationQuota]);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [token]);\n\n  return {\n    quotas,\n    userProfilePlan,\n  };\n};\n"],"names":[],"mappings":";;;;AAEA;AACA;AAEA;AACA;AANA;;;;;AAQO,MAAM,gBAAgB,CAAC,YAAY,KAAK;IAC7C,MAAM,IAAI,IAAA,0KAAc;IACxB,MAAM,EAAE,KAAK,EAAE,IAAI,EAAE,GAAG,IAAA,mKAAO;IAC/B,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,mXAAQ,EAAc,EAAE;IACpD,MAAM,CAAC,iBAAiB,mBAAmB,GAAG,IAAA,mXAAQ,EAAuB;IAE7E,IAAA,oXAAS,EAAC;QACR,IAAI,CAAC,QAAQ,CAAC,OAAO;QAErB,MAAM,aAAa,IAAA,sKAAkB,EAAC;QACtC,MAAM,OAAO,WAAW,KAAK,GAAG;QAChC,MAAM,eAA0B;YAC9B,MAAM,YAAY,EAAE,aAAa,EAAE;YACnC,SAAS,EAAE,6CAA6C;gBACtD,YAAY,KAAK,KAAK,CAAC,AAAC,WAAW,KAAK,GAAG,WAAW,KAAK,GAAI;YACjE;YACA,MAAM,WAAW,CAAC,WAAW,KAAK,GAAG,OAAO,OAAO,CAAC,OAAO,OAAO,CAAC,CAAC,EAAE,OAAO,CAAC;YAC9E,OAAO,KAAK,KAAK,CAAC,AAAC,WAAW,KAAK,GAAG,OAAO,OAAO,CAAC,OAAO,OAAO,CAAC,IAAK,MAAM;YAC/E,MAAM,OAAO,OAAO;QACtB;QACA,MAAM,kBAAkB,IAAA,0KAAsB,EAAC;QAC/C,MAAM,mBAA8B;YAClC,MAAM,YAAY,EAAE,iBAAiB,EAAE;YACvC,SAAS,EAAE,yDAAyD;gBAClE,YAAY,KAAK,KAAK,CAAC,AAAC,gBAAgB,KAAK,GAAG,gBAAgB,KAAK,GAAI;YAC3E;YACA,MAAM,KAAK,KAAK,CAAC,gBAAgB,KAAK,GAAG;YACzC,OAAO,KAAK,KAAK,CAAC,gBAAgB,KAAK,GAAG;YAC1C,MAAM;QACR;QACA,mBAAmB,IAAA,sKAAkB,EAAC;QACtC,UAAU;YAAC;YAAc;SAAiB;IAC1C,uDAAuD;IACzD,GAAG;QAAC;KAAM;IAEV,OAAO;QACL;QACA;IACF;AACF"}},
    {"offset": {"line": 1478, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/hooks/useAutoFocus.ts"],"sourcesContent":["'use client';\n\nimport { useEffect, useRef } from 'react';\n\ninterface UseAutoFocusOptions {\n  ref?: React.RefObject<HTMLElement | null>;\n  delay?: number;\n  condition?: boolean;\n  preventScroll?: boolean;\n}\n\nexport const useAutoFocus = <T extends HTMLElement = HTMLDivElement>(\n  options: UseAutoFocusOptions = {},\n) => {\n  const { delay = 0, condition = true, preventScroll = false, ref } = options;\n  const localRef = useRef<T>(null);\n  const focusRef = ref || localRef;\n\n  useEffect(() => {\n    if (condition && focusRef.current) {\n      const focusElement = () => {\n        focusRef.current?.focus({ preventScroll });\n      };\n\n      if (delay > 0) {\n        const timer = setTimeout(focusElement, delay);\n        return () => clearTimeout(timer);\n      } else {\n        focusElement();\n      }\n    }\n    return;\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [condition, delay, preventScroll]);\n\n  return focusRef as React.RefObject<T>;\n};\n"],"names":[],"mappings":";;;;AAEA;AAFA;;AAWO,MAAM,eAAe,CAC1B,UAA+B,CAAC,CAAC;IAEjC,MAAM,EAAE,QAAQ,CAAC,EAAE,YAAY,IAAI,EAAE,gBAAgB,KAAK,EAAE,GAAG,EAAE,GAAG;IACpE,MAAM,WAAW,IAAA,iXAAM,EAAI;IAC3B,MAAM,WAAW,OAAO;IAExB,IAAA,oXAAS,EAAC;QACR,IAAI,aAAa,SAAS,OAAO,EAAE;YACjC,MAAM,eAAe;gBACnB,SAAS,OAAO,EAAE,MAAM;oBAAE;gBAAc;YAC1C;YAEA,IAAI,QAAQ,GAAG;gBACb,MAAM,QAAQ,WAAW,cAAc;gBACvC,OAAO,IAAM,aAAa;YAC5B,OAAO;gBACL;YACF;QACF;QACA;IACA,uDAAuD;IACzD,GAAG;QAAC;QAAW;QAAO;KAAc;IAEpC,OAAO;AACT"}},
    {"offset": {"line": 1516, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/hooks/useLongPress.ts"],"sourcesContent":["'use client';\n\nimport { useCallback, useEffect, useRef, useState } from 'react';\n\ninterface UseLongPressOptions {\n  onTap?: () => void;\n  onLongPress?: () => void;\n  onContextMenu?: () => void;\n  onCancel?: () => void;\n  threshold?: number;\n  moveThreshold?: number;\n}\n\ninterface UseLongPressResult {\n  pressing: boolean;\n  handlers: {\n    onPointerDown: (e: React.PointerEvent) => void;\n    onPointerUp: (e: React.PointerEvent) => void;\n    onPointerMove: (e: React.PointerEvent) => void;\n    onPointerCancel: (e: React.PointerEvent) => void;\n    onPointerLeave: (e: React.PointerEvent) => void;\n    onClick: (e: React.MouseEvent) => void;\n    onContextMenu: (e: React.MouseEvent) => void;\n  };\n}\n\nexport const useLongPress = (\n  {\n    onTap,\n    onLongPress,\n    onContextMenu,\n    onCancel,\n    threshold = 500,\n    moveThreshold = 10,\n  }: UseLongPressOptions,\n  deps: React.DependencyList,\n): UseLongPressResult => {\n  const [pressing, setPressing] = useState(false);\n  const timerRef = useRef<ReturnType<typeof setTimeout>>();\n  const startPosRef = useRef<{ x: number; y: number } | null>(null);\n  const pointerId = useRef<number | null>(null);\n  const hasPointerEventsRef = useRef(false);\n  const pointerEventTimeoutRef = useRef<ReturnType<typeof setTimeout>>();\n  const isLongPressTriggered = useRef(false);\n\n  const reset = useCallback(() => {\n    setPressing(false);\n    isLongPressTriggered.current = false;\n    startPosRef.current = null;\n    pointerId.current = null;\n    clearTimeout(timerRef.current);\n  }, []);\n\n  const handlePointerDown = useCallback(\n    (e: React.PointerEvent) => {\n      if (e.pointerType === 'mouse' && e.button !== 0) {\n        return;\n      }\n\n      hasPointerEventsRef.current = true;\n      clearTimeout(pointerEventTimeoutRef.current);\n\n      pointerId.current = e.pointerId;\n      startPosRef.current = { x: e.clientX, y: e.clientY };\n      isLongPressTriggered.current = false;\n      setPressing(true);\n\n      timerRef.current = setTimeout(() => {\n        if (startPosRef.current) {\n          isLongPressTriggered.current = true;\n          onLongPress?.();\n          setPressing(false);\n        }\n      }, threshold);\n    },\n    [onLongPress, threshold],\n  );\n\n  const handlePointerMove = useCallback(\n    (e: React.PointerEvent) => {\n      if (e.pointerId !== pointerId.current || !startPosRef.current) return;\n\n      const deltaX = Math.abs(e.clientX - startPosRef.current.x);\n      const deltaY = Math.abs(e.clientY - startPosRef.current.y);\n\n      if (deltaX > moveThreshold || deltaY > moveThreshold) {\n        onCancel?.();\n        reset();\n      }\n    },\n    [moveThreshold, onCancel, reset],\n  );\n\n  const handlePointerUp = useCallback(\n    (e: React.PointerEvent) => {\n      if (e.pointerId !== pointerId.current) return;\n\n      if (!isLongPressTriggered.current && startPosRef.current) {\n        const deltaX = Math.abs(e.clientX - startPosRef.current.x);\n        const deltaY = Math.abs(e.clientY - startPosRef.current.y);\n\n        if (deltaX <= moveThreshold && deltaY <= moveThreshold) {\n          onTap?.();\n        }\n      }\n\n      reset();\n\n      pointerEventTimeoutRef.current = setTimeout(() => {\n        hasPointerEventsRef.current = false;\n      }, 200);\n    },\n    [onTap, moveThreshold, reset],\n  );\n\n  const handleCancel = useCallback(\n    (e: React.PointerEvent) => {\n      if (e.pointerId !== pointerId.current) return;\n      onCancel?.();\n      reset();\n\n      pointerEventTimeoutRef.current = setTimeout(() => {\n        hasPointerEventsRef.current = false;\n      }, 200);\n    },\n    [onCancel, reset],\n  );\n\n  const handleClick = useCallback(() => {\n    // This is only for aria activation, if the user has used pointer events, we ignore the click event\n    if (!hasPointerEventsRef.current) {\n      onTap?.();\n    }\n  }, [onTap]);\n\n  const handleContextMenu = useCallback(\n    (e: React.MouseEvent) => {\n      if (onContextMenu) {\n        e.preventDefault();\n        e.stopPropagation();\n        onContextMenu();\n      }\n      reset();\n    },\n    [onContextMenu, reset],\n  );\n\n  useEffect(() => {\n    return () => {\n      clearTimeout(timerRef.current);\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, deps);\n\n  return {\n    pressing,\n    handlers: {\n      onPointerDown: handlePointerDown,\n      onPointerUp: handlePointerUp,\n      onPointerMove: handlePointerMove,\n      onPointerCancel: handleCancel,\n      onPointerLeave: handleCancel,\n      onClick: handleClick,\n      onContextMenu: handleContextMenu,\n    },\n  };\n};\n"],"names":[],"mappings":";;;;AAEA;AAFA;;AA0BO,MAAM,eAAe,CAC1B,EACE,KAAK,EACL,WAAW,EACX,aAAa,EACb,QAAQ,EACR,YAAY,GAAG,EACf,gBAAgB,EAAE,EACE,EACtB;IAEA,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,mXAAQ,EAAC;IACzC,MAAM,WAAW,IAAA,iXAAM;IACvB,MAAM,cAAc,IAAA,iXAAM,EAAkC;IAC5D,MAAM,YAAY,IAAA,iXAAM,EAAgB;IACxC,MAAM,sBAAsB,IAAA,iXAAM,EAAC;IACnC,MAAM,yBAAyB,IAAA,iXAAM;IACrC,MAAM,uBAAuB,IAAA,iXAAM,EAAC;IAEpC,MAAM,QAAQ,IAAA,sXAAW,EAAC;QACxB,YAAY;QACZ,qBAAqB,OAAO,GAAG;QAC/B,YAAY,OAAO,GAAG;QACtB,UAAU,OAAO,GAAG;QACpB,aAAa,SAAS,OAAO;IAC/B,GAAG,EAAE;IAEL,MAAM,oBAAoB,IAAA,sXAAW,EACnC,CAAC;QACC,IAAI,EAAE,WAAW,KAAK,WAAW,EAAE,MAAM,KAAK,GAAG;YAC/C;QACF;QAEA,oBAAoB,OAAO,GAAG;QAC9B,aAAa,uBAAuB,OAAO;QAE3C,UAAU,OAAO,GAAG,EAAE,SAAS;QAC/B,YAAY,OAAO,GAAG;YAAE,GAAG,EAAE,OAAO;YAAE,GAAG,EAAE,OAAO;QAAC;QACnD,qBAAqB,OAAO,GAAG;QAC/B,YAAY;QAEZ,SAAS,OAAO,GAAG,WAAW;YAC5B,IAAI,YAAY,OAAO,EAAE;gBACvB,qBAAqB,OAAO,GAAG;gBAC/B;gBACA,YAAY;YACd;QACF,GAAG;IACL,GACA;QAAC;QAAa;KAAU;IAG1B,MAAM,oBAAoB,IAAA,sXAAW,EACnC,CAAC;QACC,IAAI,EAAE,SAAS,KAAK,UAAU,OAAO,IAAI,CAAC,YAAY,OAAO,EAAE;QAE/D,MAAM,SAAS,KAAK,GAAG,CAAC,EAAE,OAAO,GAAG,YAAY,OAAO,CAAC,CAAC;QACzD,MAAM,SAAS,KAAK,GAAG,CAAC,EAAE,OAAO,GAAG,YAAY,OAAO,CAAC,CAAC;QAEzD,IAAI,SAAS,iBAAiB,SAAS,eAAe;YACpD;YACA;QACF;IACF,GACA;QAAC;QAAe;QAAU;KAAM;IAGlC,MAAM,kBAAkB,IAAA,sXAAW,EACjC,CAAC;QACC,IAAI,EAAE,SAAS,KAAK,UAAU,OAAO,EAAE;QAEvC,IAAI,CAAC,qBAAqB,OAAO,IAAI,YAAY,OAAO,EAAE;YACxD,MAAM,SAAS,KAAK,GAAG,CAAC,EAAE,OAAO,GAAG,YAAY,OAAO,CAAC,CAAC;YACzD,MAAM,SAAS,KAAK,GAAG,CAAC,EAAE,OAAO,GAAG,YAAY,OAAO,CAAC,CAAC;YAEzD,IAAI,UAAU,iBAAiB,UAAU,eAAe;gBACtD;YACF;QACF;QAEA;QAEA,uBAAuB,OAAO,GAAG,WAAW;YAC1C,oBAAoB,OAAO,GAAG;QAChC,GAAG;IACL,GACA;QAAC;QAAO;QAAe;KAAM;IAG/B,MAAM,eAAe,IAAA,sXAAW,EAC9B,CAAC;QACC,IAAI,EAAE,SAAS,KAAK,UAAU,OAAO,EAAE;QACvC;QACA;QAEA,uBAAuB,OAAO,GAAG,WAAW;YAC1C,oBAAoB,OAAO,GAAG;QAChC,GAAG;IACL,GACA;QAAC;QAAU;KAAM;IAGnB,MAAM,cAAc,IAAA,sXAAW,EAAC;QAC9B,mGAAmG;QACnG,IAAI,CAAC,oBAAoB,OAAO,EAAE;YAChC;QACF;IACF,GAAG;QAAC;KAAM;IAEV,MAAM,oBAAoB,IAAA,sXAAW,EACnC,CAAC;QACC,IAAI,eAAe;YACjB,EAAE,cAAc;YAChB,EAAE,eAAe;YACjB;QACF;QACA;IACF,GACA;QAAC;QAAe;KAAM;IAGxB,IAAA,oXAAS,EAAC;QACR,OAAO;YACL,aAAa,SAAS,OAAO;QAC/B;IACA,uDAAuD;IACzD,GAAG;IAEH,OAAO;QACL;QACA,UAAU;YACR,eAAe;YACf,aAAa;YACb,eAAe;YACf,iBAAiB;YACjB,gBAAgB;YAChB,SAAS;YACT,eAAe;QACjB;IACF;AACF"}},
    {"offset": {"line": 1646, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/hooks/useShortcuts.ts"],"sourcesContent":["'use client';\n\nimport { useEffect, useState } from 'react';\nimport { loadShortcuts, ShortcutConfig } from '../helpers/shortcuts';\n\nexport type KeyActionHandlers = {\n  [K in keyof ShortcutConfig]?: (event?: KeyboardEvent | MessageEvent) => void;\n};\n\nconst useShortcuts = (actions: KeyActionHandlers, dependencies: React.DependencyList = []) => {\n  const [shortcuts, setShortcuts] = useState<ShortcutConfig>(loadShortcuts);\n\n  useEffect(() => {\n    const handleShortcutUpdate = () => {\n      setShortcuts(loadShortcuts());\n    };\n\n    window.addEventListener('shortcutUpdate', handleShortcutUpdate);\n    return () => window.removeEventListener('shortcutUpdate', handleShortcutUpdate);\n  }, []);\n\n  const parseShortcut = (shortcut: string) => {\n    const keys = shortcut.toLowerCase().split('+');\n    return {\n      ctrlKey: keys.includes('ctrl'),\n      altKey: keys.includes('alt') || keys.includes('opt'),\n      metaKey: keys.includes('meta') || keys.includes('cmd'),\n      shiftKey: keys.includes('shift'),\n      key: keys.find((k) => !['ctrl', 'alt', 'opt', 'meta', 'cmd', 'shift'].includes(k)),\n    };\n  };\n\n  const isShortcutMatch = (\n    shortcut: string,\n    key: string,\n    ctrlKey: boolean,\n    altKey: boolean,\n    metaKey: boolean,\n    shiftKey: boolean,\n  ) => {\n    const parsedShortcut = parseShortcut(shortcut);\n    return (\n      parsedShortcut.key === key.toLowerCase() &&\n      parsedShortcut.ctrlKey === ctrlKey &&\n      parsedShortcut.altKey === altKey &&\n      parsedShortcut.metaKey === metaKey &&\n      parsedShortcut.shiftKey === shiftKey\n    );\n  };\n\n  const processKeyEvent = (\n    key: string,\n    ctrlKey: boolean,\n    altKey: boolean,\n    metaKey: boolean,\n    shiftKey: boolean,\n    event: KeyboardEvent | MessageEvent,\n  ) => {\n    // FIXME: This is a temporary fix to disable Back button navigation\n    if (key === 'backspace') return true;\n    for (const [actionName, actionHandler] of Object.entries(actions)) {\n      const shortcutKey = actionName as keyof ShortcutConfig;\n      const handler = actionHandler as\n        | ((event?: KeyboardEvent | MessageEvent) => void | boolean)\n        | undefined;\n      const shortcutList = shortcuts[shortcutKey as keyof ShortcutConfig];\n      // console.log('Checking action:', shortcutKey);\n      if (\n        handler &&\n        shortcutList?.some((shortcut) =>\n          isShortcutMatch(shortcut, key, ctrlKey, altKey, metaKey, shiftKey),\n        )\n      ) {\n        if (handler(event)) {\n          return true;\n        }\n      }\n    }\n    return false;\n  };\n\n  const unifiedHandleKeyDown = (event: KeyboardEvent | MessageEvent) => {\n    // Check if the focus is on an input, textarea, or contenteditable element\n    const activeElement = document.activeElement as HTMLElement;\n    const isInteractiveElement =\n      activeElement.tagName === 'INPUT' ||\n      activeElement.tagName === 'TEXTAREA' ||\n      activeElement.isContentEditable;\n\n    const isNoteEditor =\n      activeElement.tagName === 'TEXTAREA' && activeElement.classList.contains('note-editor');\n\n    if (isInteractiveElement && !isNoteEditor) {\n      return; // Skip handling if the user is typing in an input, textarea, or contenteditable\n    }\n\n    if (event instanceof KeyboardEvent) {\n      const { key, ctrlKey, altKey, metaKey, shiftKey } = event;\n\n      if (isNoteEditor && !((key === 'Enter' && ctrlKey) || key == 'Escape')) {\n        return;\n      }\n\n      const handled = processKeyEvent(key.toLowerCase(), ctrlKey, altKey, metaKey, shiftKey, event);\n      // console.log('Key event handled:', key, handled);\n      if (handled) event.preventDefault();\n    } else if (\n      event instanceof MessageEvent &&\n      event.data &&\n      event.data.type === 'iframe-keydown'\n    ) {\n      const { key, ctrlKey, altKey, metaKey, shiftKey } = event.data;\n      processKeyEvent(key.toLowerCase(), ctrlKey, altKey, metaKey, shiftKey, event);\n    }\n  };\n\n  useEffect(() => {\n    window.addEventListener('keydown', unifiedHandleKeyDown);\n    window.addEventListener('message', unifiedHandleKeyDown);\n\n    return () => {\n      window.removeEventListener('keydown', unifiedHandleKeyDown);\n      window.removeEventListener('message', unifiedHandleKeyDown);\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [shortcuts, ...dependencies]);\n};\n\nexport default useShortcuts;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1740, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/hooks/useResetSettings.ts"],"sourcesContent":["import { Dispatch, SetStateAction } from 'react';\nimport { useEnv } from '@/context/EnvContext';\nimport { ViewSettings } from '@/types/book';\n\ntype SetterKey = keyof ViewSettings;\ntype SetterValue = SetStateAction<string> & SetStateAction<number> & SetStateAction<boolean>;\n\ntype StateSetters = Partial<{\n  [Key in SetterKey]: Dispatch<SetterValue>;\n}>;\n\nexport const useResetViewSettings = () => {\n  const { appService } = useEnv();\n\n  const resetToDefaults = (setters: StateSetters) => {\n    if (!appService) return;\n    const defaultSettings = appService.getDefaultViewSettings();\n\n    Object.entries(setters).forEach(([settingKey, setter]) => {\n      const freshValue = defaultSettings[settingKey as SetterKey];\n      if (freshValue !== undefined) {\n        setter(freshValue as SetterValue);\n      }\n    });\n  };\n\n  return resetToDefaults;\n};\n"],"names":[],"mappings":";;;;AACA;;AAUO,MAAM,uBAAuB;IAClC,MAAM,EAAE,UAAU,EAAE,GAAG,IAAA,iKAAM;IAE7B,MAAM,kBAAkB,CAAC;QACvB,IAAI,CAAC,YAAY;QACjB,MAAM,kBAAkB,WAAW,sBAAsB;QAEzD,OAAO,OAAO,CAAC,SAAS,OAAO,CAAC,CAAC,CAAC,YAAY,OAAO;YACnD,MAAM,aAAa,eAAe,CAAC,WAAwB;YAC3D,IAAI,eAAe,WAAW;gBAC5B,OAAO;YACT;QACF;IACF;IAEA,OAAO;AACT"}}]
}