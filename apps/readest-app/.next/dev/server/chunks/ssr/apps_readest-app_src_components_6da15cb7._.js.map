{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/components/Overlay.tsx"],"sourcesContent":["import clsx from 'clsx';\nimport React from 'react';\n\ninterface OverlayProps {\n  onDismiss: () => void;\n  dismissLabel?: string;\n  className?: string;\n}\n\nexport const Overlay: React.FC<OverlayProps> = ({ onDismiss, className }) => {\n  const handleKeyDown = (e: React.KeyboardEvent) => {\n    if (e.key === 'Escape' || e.key === 'Enter' || e.key === ' ') {\n      e.preventDefault();\n      onDismiss();\n    }\n  };\n\n  return (\n    <div\n      className={clsx('overlay fixed inset-0 cursor-default', className)}\n      role='none'\n      tabIndex={-1}\n      onClick={onDismiss}\n      onContextMenu={onDismiss}\n      onKeyDown={handleKeyDown}\n    />\n  );\n};\n"],"names":[],"mappings":";;;;;AAAA;;;;;;;AASO,MAAM,UAAkC,CAAC,EAAE,SAAS,EAAE,SAAS,EAAE;IACtE,MAAM,gBAAgB,CAAC;QACrB,IAAI,EAAE,GAAG,KAAK,YAAY,EAAE,GAAG,KAAK,WAAW,EAAE,GAAG,KAAK,KAAK;YAC5D,EAAE,cAAc;YAChB;QACF;IACF;IAEA,qBACE,qKAAC;QACC,WAAW,IAAA,mHAAI,EAAC,wCAAwC;QACxD,MAAK;QACL,UAAU,CAAC;QACX,SAAS;QACT,eAAe;QACf,WAAW;;;;;;AAGjB"}},
    {"offset": {"line": 45, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/components/Dialog.tsx"],"sourcesContent":["'use client';\n\nimport clsx from 'clsx';\nimport React, { ReactNode, useEffect, useRef, useState } from 'react';\nimport { MdArrowBackIosNew, MdArrowForwardIos } from 'react-icons/md';\nimport { useEnv } from '@/context/EnvContext';\nimport { useDrag } from '@/hooks/useDrag';\nimport { useThemeStore } from '@/store/themeStore';\nimport { useTranslation } from '@/hooks/useTranslation';\nimport { useDeviceControlStore } from '@/store/deviceStore';\nimport { useResponsiveSize } from '@/hooks/useResponsiveSize';\nimport { impactFeedback } from '@tauri-apps/plugin-haptics';\nimport { getDirFromUILanguage } from '@/utils/rtl';\nimport { eventDispatcher } from '@/utils/event';\nimport { Overlay } from './Overlay';\n\nconst VELOCITY_THRESHOLD = 0.5;\nconst SNAP_THRESHOLD = 0.2;\n\ninterface DialogProps {\n  id?: string;\n  isOpen: boolean;\n  children: ReactNode;\n  snapHeight?: number;\n  header?: ReactNode;\n  title?: string;\n  className?: string;\n  bgClassName?: string;\n  boxClassName?: string;\n  contentClassName?: string;\n  onClose: () => void;\n}\n\nconst Dialog: React.FC<DialogProps> = ({\n  id,\n  isOpen,\n  children,\n  snapHeight,\n  header,\n  title,\n  className,\n  bgClassName,\n  boxClassName,\n  contentClassName,\n  onClose,\n}) => {\n  const _ = useTranslation();\n  const { appService } = useEnv();\n  const { systemUIVisible, statusBarHeight, safeAreaInsets } = useThemeStore();\n  const { acquireBackKeyInterception, releaseBackKeyInterception } = useDeviceControlStore();\n  const [isFullHeightInMobile, setIsFullHeightInMobile] = useState(!snapHeight);\n  const [isRtl] = useState(() => getDirFromUILanguage() === 'rtl');\n  const dialogRef = useRef<HTMLDialogElement>(null);\n  const previousActiveElementRef = useRef<HTMLElement | null>(null);\n  const iconSize22 = useResponsiveSize(22);\n  const isMobile = window.innerWidth < 640 || window.innerHeight < 640;\n\n  const handleKeyDown = (event: KeyboardEvent | CustomEvent) => {\n    if (event instanceof CustomEvent) {\n      if (event.detail.keyName === 'Back') {\n        onClose();\n        return true;\n      }\n    } else {\n      if (event.key === 'Escape') {\n        onClose();\n      }\n      event.stopPropagation();\n    }\n    return false;\n  };\n\n  useEffect(() => {\n    if (!isOpen) {\n      if (previousActiveElementRef.current) {\n        previousActiveElementRef.current.focus();\n        previousActiveElementRef.current = null;\n      }\n      return;\n    }\n\n    previousActiveElementRef.current = document.activeElement as HTMLElement;\n\n    setIsFullHeightInMobile(!snapHeight && isMobile);\n    window.addEventListener('keydown', handleKeyDown);\n    if (dialogRef.current) {\n      dialogRef.current.addEventListener('keydown', handleKeyDown);\n    }\n    if (appService?.isAndroidApp) {\n      acquireBackKeyInterception();\n      eventDispatcher.onSync('native-key-down', handleKeyDown);\n    }\n\n    const timer = setTimeout(() => {\n      if (dialogRef.current) {\n        dialogRef.current.focus();\n      }\n    }, 100);\n    return () => {\n      clearTimeout(timer);\n      window.removeEventListener('keydown', handleKeyDown);\n      if (appService?.isAndroidApp) {\n        releaseBackKeyInterception();\n        eventDispatcher.offSync('native-key-down', handleKeyDown);\n      }\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [isOpen]);\n\n  const handleDragMove = (data: { clientY: number; deltaY: number }) => {\n    if (!isMobile || !dialogRef.current) return;\n\n    const modal = dialogRef.current.querySelector('.modal-box') as HTMLElement;\n    const overlay = dialogRef.current.querySelector('.overlay') as HTMLElement;\n\n    const heightFraction = data.clientY / window.innerHeight;\n    const newTop = Math.max(0.0, Math.min(1, heightFraction));\n\n    if (modal && overlay) {\n      modal.style.height = '100%';\n      modal.style.transform = `translateY(${newTop * 100}%)`;\n      overlay.style.opacity = `${1 - heightFraction}`;\n\n      setIsFullHeightInMobile(data.clientY < 44);\n      modal.style.transition = `padding-top 0.3s ease-out`;\n    }\n  };\n\n  const handleDragEnd = (data: { velocity: number; clientY: number }) => {\n    if (!isMobile || !dialogRef.current) return;\n    const modal = dialogRef.current.querySelector('.modal-box') as HTMLElement;\n    const overlay = dialogRef.current.querySelector('.overlay') as HTMLElement;\n    if (!modal || !overlay) return;\n\n    const snapUpper = snapHeight ? 1 - snapHeight - SNAP_THRESHOLD : 0.5;\n    const snapLower = snapHeight ? 1 - snapHeight + SNAP_THRESHOLD : 0.5;\n    if (\n      data.velocity > VELOCITY_THRESHOLD ||\n      (data.velocity >= 0 && data.clientY >= window.innerHeight * snapLower)\n    ) {\n      // dialog is dismissed\n      const transitionDuration = 0.15 / Math.max(data.velocity, 0.5);\n      modal.style.height = '100%';\n      modal.style.transition = `transform ${transitionDuration}s ease-out`;\n      modal.style.transform = 'translateY(100%)';\n      overlay.style.transition = `opacity ${transitionDuration}s ease-out`;\n      overlay.style.opacity = '0';\n      onClose();\n      setTimeout(() => {\n        modal.style.transform = 'translateY(0%)';\n      }, 300);\n    } else if (\n      snapHeight &&\n      data.clientY > window.innerHeight * snapUpper &&\n      data.clientY < window.innerHeight * snapLower\n    ) {\n      // dialog is snapped\n      overlay.style.transition = `opacity 0.3s ease-out`;\n      overlay.style.opacity = `${1 - snapHeight}`;\n      modal.style.height = `${snapHeight * 100}%`;\n      modal.style.bottom = '0';\n      modal.style.transition = `transform 0.3s ease-out`;\n      modal.style.transform = '';\n    } else {\n      // dialog is opened without snap\n      setIsFullHeightInMobile(true);\n      modal.style.height = '100%';\n      modal.style.transition = `transform 0.3s ease-out`;\n      modal.style.transform = `translateY(0%)`;\n      overlay.style.opacity = '0';\n    }\n    if (appService?.hasHaptics) {\n      impactFeedback('medium');\n    }\n  };\n\n  const handleDragKeyDown = () => {};\n\n  const { handleDragStart } = useDrag(handleDragMove, handleDragKeyDown, handleDragEnd);\n\n  return (\n    <dialog\n      ref={dialogRef}\n      id={id ?? 'dialog'}\n      tabIndex={-1}\n      open={isOpen}\n      aria-hidden={!isOpen}\n      className={clsx(\n        'modal sm:min-w-90 z-50 h-full w-full !items-start !bg-transparent sm:w-full sm:!items-center',\n        className,\n      )}\n      dir={isRtl ? 'rtl' : undefined}\n    >\n      <Overlay\n        className={clsx(\n          'dialog-overlay z-10 bg-black/50 sm:bg-black/50',\n          appService?.hasRoundedWindow && 'rounded-window',\n          bgClassName,\n        )}\n        onDismiss={onClose}\n      />\n      <div\n        className={clsx(\n          'modal-box settings-content absolute z-20 flex flex-col rounded-none rounded-tl-2xl rounded-tr-2xl p-0 sm:rounded-2xl',\n          'h-full max-h-full w-full max-w-full',\n          window.innerWidth < window.innerHeight\n            ? 'sm:h-[50%] sm:w-3/4'\n            : 'sm:h-[65%] sm:w-1/2 sm:max-w-[600px]',\n          boxClassName,\n        )}\n        style={{\n          paddingTop:\n            appService?.hasSafeAreaInset && isFullHeightInMobile\n              ? `${Math.max(safeAreaInsets?.top || 0, systemUIVisible ? statusBarHeight : 0)}px`\n              : '0px',\n          ...(isMobile ? { height: snapHeight ? `${snapHeight * 100}%` : '100%', bottom: 0 } : {}),\n        }}\n      >\n        {/* eslint-disable-next-line jsx-a11y/no-static-element-interactions */}\n        <div\n          className={clsx(\n            'drag-handle h-10 max-h-10 min-h-10 w-full cursor-row-resize items-center justify-center',\n            'transition-padding-top flex duration-300 ease-out sm:hidden',\n          )}\n          onMouseDown={handleDragStart}\n          onTouchStart={handleDragStart}\n        >\n          <div className='bg-base-content/50 h-1 w-10 rounded-full'></div>\n        </div>\n        <div className='dialog-header sticky top-1 z-10 flex items-center justify-between px-2 sm:px-4'>\n          {header ? (\n            header\n          ) : (\n            <div className='flex h-11 w-full items-center justify-between'>\n              <button\n                aria-label={_('Close')}\n                onClick={onClose}\n                className={\n                  'btn btn-ghost btn-circle flex h-8 min-h-8 w-8 hover:bg-transparent focus:outline-none sm:hidden'\n                }\n              >\n                {isRtl ? (\n                  <MdArrowForwardIos size={iconSize22} />\n                ) : (\n                  <MdArrowBackIosNew size={iconSize22} />\n                )}\n              </button>\n              <div className='z-15 pointer-events-none absolute inset-0 flex h-11 items-center justify-center'>\n                <span className='line-clamp-1 text-center font-bold'>{title ?? ''}</span>\n              </div>\n              <button\n                aria-label={_('Close')}\n                onClick={onClose}\n                className={\n                  'bg-base-300/65 btn btn-ghost btn-circle ml-auto hidden h-6 min-h-6 w-6 focus:outline-none sm:flex'\n                }\n              >\n                <svg\n                  xmlns='http://www.w3.org/2000/svg'\n                  width='1em'\n                  height='1em'\n                  viewBox='0 0 24 24'\n                >\n                  <path\n                    fill='currentColor'\n                    d='M19 6.41L17.59 5L12 10.59L6.41 5L5 6.41L10.59 12L5 17.59L6.41 19L12 13.41L17.59 19L19 17.59L13.41 12z'\n                  />\n                </svg>\n              </button>\n            </div>\n          )}\n        </div>\n\n        <div\n          className={clsx(\n            'text-base-content my-2 flex-grow overflow-y-auto px-6 sm:px-[10%]',\n            contentClassName,\n          )}\n        >\n          {children}\n        </div>\n      </div>\n    </dialog>\n  );\n};\n\nexport default Dialog;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 356, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/components/Link.tsx"],"sourcesContent":["import { isTauriAppPlatform } from '@/services/environment';\nimport { openUrl } from '@tauri-apps/plugin-opener';\n\ninterface LinkProps extends React.AnchorHTMLAttributes<HTMLAnchorElement> {\n  href: string;\n  title?: string;\n}\n\nconst Link: React.FC<LinkProps> = ({ href, children, ...props }) => {\n  const handleClick = async (e: React.MouseEvent<HTMLAnchorElement>) => {\n    if (isTauriAppPlatform()) {\n      e.preventDefault();\n      await openUrl(href);\n    }\n  };\n\n  return (\n    <a href={href} target='_blank' rel='noopener noreferrer' onClick={handleClick} {...props}>\n      {children}\n    </a>\n  );\n};\n\nexport default Link;\n"],"names":[],"mappings":";;;;;AAAA;AACA;;;;;;;;AAOA,MAAM,OAA4B,CAAC,EAAE,IAAI,EAAE,QAAQ,EAAE,GAAG,OAAO;IAC7D,MAAM,cAAc,OAAO;QACzB,IAAI,IAAA,uKAAkB,KAAI;YACxB,EAAE,cAAc;YAChB,MAAM,IAAA,iLAAO,EAAC;QAChB;IACF;IAEA,qBACE,qKAAC;QAAE,MAAM;QAAM,QAAO;QAAS,KAAI;QAAsB,SAAS;QAAc,GAAG,KAAK;kBACrF;;;;;;AAGP;uCAEe"}},
    {"offset": {"line": 398, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/components/UpdaterWindow.tsx"],"sourcesContent":["'use client';\n\nimport clsx from 'clsx';\nimport semver from 'semver';\nimport Image from 'next/image';\nimport { useEnv } from '@/context/EnvContext';\nimport { useEffect, useState } from 'react';\nimport { type as osType, arch as osArch } from '@tauri-apps/plugin-os';\nimport { check, Update } from '@tauri-apps/plugin-updater';\nimport { relaunch, exit } from '@tauri-apps/plugin-process';\nimport { fetch as tauriFetch } from '@tauri-apps/plugin-http';\nimport { Command } from '@tauri-apps/plugin-shell';\nimport { invoke } from '@tauri-apps/api/core';\nimport { isTauriAppPlatform } from '@/services/environment';\nimport { useTranslator } from '@/hooks/useTranslator';\nimport { useTranslation } from '@/hooks/useTranslation';\nimport { useSearchParams } from 'next/navigation';\nimport { getAppVersion } from '@/utils/version';\nimport { tauriDownload } from '@/utils/transfer';\nimport { installPackage } from '@/utils/bridge';\nimport { join } from '@tauri-apps/api/path';\nimport { getLocale } from '@/utils/misc';\nimport { setLastShownReleaseNotesVersion } from '@/helpers/updater';\nimport { READEST_UPDATER_FILE, READEST_CHANGELOG_FILE } from '@/services/constants';\nimport Dialog from '@/components/Dialog';\nimport Link from './Link';\n\ninterface ReleaseNotes {\n  releases: Record<\n    string,\n    {\n      date: string;\n      notes: string[];\n    }\n  >;\n}\n\ninterface Changelog {\n  version: string;\n  date: string;\n  notes: string[];\n}\n\ntype DownloadEvent =\n  | {\n      event: 'Started';\n      data: {\n        contentLength?: number;\n      };\n    }\n  | {\n      event: 'Progress';\n      data: {\n        chunkLength: number;\n      };\n    }\n  | {\n      event: 'Finished';\n    };\n\ninterface GenericUpdate {\n  currentVersion: string;\n  version: string;\n  date?: string;\n  body?: string;\n  downloadAndInstall?(onEvent?: (progress: DownloadEvent) => void): Promise<void>;\n}\n\nexport const UpdaterContent = ({\n  latestVersion,\n  lastVersion,\n  checkUpdate = true,\n}: {\n  latestVersion?: string;\n  lastVersion?: string;\n  checkUpdate?: boolean;\n}) => {\n  const _ = useTranslation();\n  const [targetLang, setTargetLang] = useState('EN');\n  const { translate } = useTranslator({\n    provider: 'azure',\n    sourceLang: 'AUTO',\n    targetLang,\n  });\n  const { appService } = useEnv();\n  const searchParams = useSearchParams();\n  const currentVersion = getAppVersion();\n  const [newVersion, setNewVersion] = useState(\n    latestVersion ?? searchParams?.get('latestVersion') ?? '',\n  );\n  const [oldVersion, setOldVersion] = useState(\n    lastVersion ?? searchParams?.get('lastVersion') ?? '',\n  );\n  const [update, setUpdate] = useState<GenericUpdate | Update | null>(null);\n  const [changelogs, setChangelogs] = useState<Changelog[]>([]);\n  const [progress, setProgress] = useState<number | null>(null);\n  const [contentLength, setContentLength] = useState<number | null>(null);\n  const [isDownloading, setIsDownloading] = useState(false);\n  const [downloaded, setDownloaded] = useState<number | null>(null);\n  const [isMounted, setIsMounted] = useState(false);\n\n  useEffect(() => {\n    setTargetLang(getLocale());\n  }, []);\n\n  useEffect(() => {\n    const checkDesktopUpdate = async () => {\n      const update = await check();\n      if (update) {\n        setUpdate(update);\n      }\n    };\n    const checkAndroidUpdate = async () => {\n      if (!appService) return;\n      const fetch = isTauriAppPlatform() ? tauriFetch : window.fetch;\n      const response = await fetch(READEST_UPDATER_FILE);\n      const data = await response.json();\n      if (semver.gt(data.version, currentVersion)) {\n        const OS_ARCH = osArch();\n        const platformKey = OS_ARCH === 'aarch64' ? 'android-arm64' : 'android-universal';\n        const arch = OS_ARCH === 'aarch64' ? 'arm64' : 'universal';\n        const downloadUrl = data.platforms[platformKey]?.url as string;\n        const apkFilePath = await appService.resolveFilePath(\n          `Readest_${data.version}_${arch}.apk`,\n          'Cache',\n        );\n        setUpdate({\n          currentVersion,\n          version: data.version,\n          date: data.pub_date,\n          body: data.notes,\n          downloadAndInstall: async (onEvent) => {\n            await new Promise<void>(async (resolve, reject) => {\n              let downloaded = 0;\n              let total = 0;\n              await tauriDownload(downloadUrl, apkFilePath, (progress) => {\n                if (!onEvent) return;\n                if (!total && progress.total) {\n                  total = progress.total;\n                  onEvent({\n                    event: 'Started',\n                    data: { contentLength: total },\n                  });\n                } else if (downloaded > 0 && progress.progress === progress.total) {\n                  console.log('APK downloaded to', apkFilePath);\n                  onEvent?.({ event: 'Finished' });\n                  setTimeout(() => {\n                    resolve();\n                  }, 1000);\n                }\n\n                onEvent({\n                  event: 'Progress',\n                  data: { chunkLength: progress.progress - downloaded },\n                });\n                downloaded = progress.progress;\n              }).catch((error) => {\n                console.error('Download failed:', error);\n                reject(error);\n              });\n            });\n\n            const res = await installPackage({\n              path: apkFilePath,\n            });\n            if (res.success) {\n              console.log('APK installed successfully');\n            } else {\n              console.error('Failed to install APK:', res.error);\n            }\n          },\n        } as GenericUpdate);\n      }\n    };\n    const checkWindowsPortableUpdate = async () => {\n      if (!appService) return;\n      const fetch = isTauriAppPlatform() ? tauriFetch : window.fetch;\n      const response = await fetch(READEST_UPDATER_FILE);\n      const data = await response.json();\n      if (semver.gt(data.version, currentVersion)) {\n        const OS_ARCH = osArch();\n        const platformKey =\n          OS_ARCH === 'x86_64' ? 'windows-x86_64-portable' : 'windows-aarch64-portable';\n        const arch = OS_ARCH === 'x86_64' ? 'x64' : 'arm64';\n        const downloadUrl = data.platforms[platformKey]?.url as string;\n        const execDir = await invoke<string>('get_executable_dir');\n        const exeFileName = `Readest_${data.version}_${arch}-portable.exe`;\n        const exeFilePath = await join(execDir, exeFileName);\n        setUpdate({\n          currentVersion,\n          version: data.version,\n          date: data.pub_date,\n          body: data.notes,\n          downloadAndInstall: async (onEvent) => {\n            await new Promise<void>(async (resolve, reject) => {\n              let downloaded = 0;\n              let total = 0;\n              await tauriDownload(downloadUrl, exeFilePath, (progress) => {\n                if (!onEvent) return;\n                if (!total && progress.total) {\n                  total = progress.total;\n                  onEvent({\n                    event: 'Started',\n                    data: { contentLength: total },\n                  });\n                } else if (downloaded > 0 && progress.progress === progress.total) {\n                  console.log('Portable EXE downloaded to', exeFilePath);\n                  onEvent?.({ event: 'Finished' });\n                  setTimeout(() => {\n                    resolve();\n                  }, 1000);\n                }\n\n                onEvent({\n                  event: 'Progress',\n                  data: { chunkLength: progress.progress - downloaded },\n                });\n                downloaded = progress.progress;\n              }).catch((error) => {\n                console.error('Download failed:', error);\n                reject(error);\n              });\n            });\n\n            try {\n              console.log('Launching new executable:', exeFilePath);\n              const command = Command.create('start-readest', ['/C', 'start', '', exeFilePath]);\n              await command.spawn();\n              console.log('New executable launched, exiting current app...');\n              setTimeout(async () => {\n                await exit(0);\n              }, 500);\n            } catch (error) {\n              console.error('Failed to launch new executable:', error);\n            }\n          },\n        } as GenericUpdate);\n      }\n    };\n    const checkForUpdates = async () => {\n      const OS_TYPE = osType();\n      if (appService?.isPortableApp && OS_TYPE === 'windows') {\n        checkWindowsPortableUpdate();\n      } else if (['macos', 'windows', 'linux'].includes(OS_TYPE)) {\n        checkDesktopUpdate();\n      } else if (OS_TYPE === 'android') {\n        checkAndroidUpdate();\n      }\n    };\n    if (appService?.hasUpdater && checkUpdate) {\n      checkForUpdates();\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [appService?.hasUpdater]);\n\n  useEffect(() => {\n    if (latestVersion) {\n      setNewVersion(latestVersion);\n    }\n    if (lastVersion) {\n      setOldVersion(lastVersion);\n    }\n    if (!checkUpdate) {\n      setUpdate({\n        currentVersion,\n        version: latestVersion,\n        date: '',\n        body: '',\n      } as GenericUpdate);\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [latestVersion, lastVersion, checkUpdate]);\n\n  useEffect(() => {\n    const fetchChangelogs = async (fromVersion: string): Promise<Changelog[]> => {\n      try {\n        const fetch = isTauriAppPlatform() ? tauriFetch : window.fetch;\n        const res = await fetch(READEST_CHANGELOG_FILE);\n        const data: ReleaseNotes = await res.json();\n        const releases = data.releases;\n\n        let entries = Object.entries(releases)\n          .filter(([ver]) => semver.gt(ver, fromVersion))\n          .sort(([a], [b]) => semver.rcompare(a, b));\n        entries = entries.length ? entries : Object.entries(releases).slice(0, 3);\n        return entries.map(([version, info]) => ({\n          version,\n          date: new Date(info.date).toLocaleDateString(),\n          notes: info.notes,\n        }));\n      } catch (error) {\n        console.error('Failed to fetch changelog:', error);\n        return [];\n      }\n    };\n    const parseNumberedList = (input: string): string[] => {\n      return input\n        .split(/(?:^|\\s)\\d+\\.\\s/)\n        .map((item) => item.trim())\n        .filter((item) => item.length > 0);\n    };\n    const updateChangelogs = async (update: GenericUpdate) => {\n      setNewVersion(update.version);\n      let changelogs = await fetchChangelogs(oldVersion || currentVersion);\n      if (changelogs.length === 0 && update.date && update.body) {\n        changelogs = [\n          {\n            version: update.version,\n            date: new Date(update.date).toLocaleDateString(),\n            notes: parseNumberedList(update.body ?? ''),\n          },\n        ];\n      }\n      if (!targetLang.toLowerCase().startsWith('en')) {\n        for (const entry of changelogs) {\n          try {\n            entry.notes = await translate(entry.notes, { useCache: true });\n          } catch (error) {\n            console.log('Failed to translate changelog:', error);\n          }\n        }\n      }\n\n      setChangelogs(changelogs);\n      setLastShownReleaseNotesVersion(newVersion);\n    };\n    if (update) {\n      updateChangelogs(update);\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [update]);\n\n  useEffect(() => {\n    setIsMounted(true);\n  }, []);\n\n  const handleDownloadInstall = async () => {\n    if (!update) {\n      return;\n    }\n    let downloaded = 0;\n    let contentLength = 0;\n    let lastLogged = 0;\n    setProgress(0);\n    setIsDownloading(true);\n    await update.downloadAndInstall?.((event) => {\n      switch (event.event) {\n        case 'Started':\n          contentLength = event.data.contentLength!;\n          setContentLength(contentLength);\n          break;\n        case 'Progress':\n          downloaded += event.data.chunkLength;\n          setDownloaded(downloaded);\n          const percent = Math.floor((downloaded / contentLength) * 100);\n          setProgress(percent);\n          if (downloaded - lastLogged >= 1 * 1024 * 1024) {\n            console.log(`downloaded ${downloaded} bytes from ${contentLength}`);\n            lastLogged = downloaded;\n          }\n          break;\n        case 'Finished':\n          console.log('download finished');\n          setProgress(100);\n          break;\n      }\n    });\n    console.log('package installed');\n    if (!appService?.isAndroidApp && process.env['NODE_ENV'] === 'production') {\n      await relaunch();\n    }\n  };\n\n  if (!isMounted || !newVersion) {\n    return null;\n  }\n\n  return (\n    <div className='bg-base-100 flex min-h-screen justify-center'>\n      <div className='flex w-full max-w-2xl flex-col gap-4'>\n        <div className='flex flex-col justify-center gap-4 sm:flex-row sm:items-start'>\n          <div className='flex items-center justify-center'>\n            <Image src='/icon.png' alt='Logo' className='h-20 w-20' width={64} height={64} />\n          </div>\n\n          {checkUpdate ? (\n            <div className='text-base-content flex-grow text-sm'>\n              <h2 className='mb-4 text-center font-bold sm:text-start'>\n                {_('A new version of Readest is available!')}\n              </h2>\n              <p className='mb-2'>\n                {_('Readest {{newVersion}} is available (installed version {{currentVersion}}).', {\n                  newVersion,\n                  currentVersion,\n                })}\n              </p>\n              <p className='mb-2'>{_('Download and install now?')}</p>\n\n              <div className='flex w-full flex-row items-center justify-end gap-4'>\n                {progress !== null && (\n                  <div className='flex flex-grow flex-col'>\n                    <progress\n                      className='progress my-1 h-4 w-full'\n                      value={progress}\n                      max='100'\n                    ></progress>\n                    <p className='text-base-content/75 flex items-center justify-center text-sm'>\n                      {progress < 100\n                        ? _('Downloading {{downloaded}} of {{contentLength}}', {\n                            downloaded: downloaded\n                              ? `${Math.floor(downloaded / 1024 / 1024)} MB`\n                              : '0 MB',\n                            contentLength: contentLength\n                              ? `${Math.floor(contentLength / 1024 / 1024)} MB`\n                              : '0 MB',\n                          })\n                        : _('Download finished')}\n                    </p>\n                  </div>\n                )}\n\n                <div className='card-actions'>\n                  <button\n                    className={clsx(\n                      'btn btn-warning text-base-100 px-6 font-bold',\n                      (!update || isDownloading) && 'btn-disabled',\n                    )}\n                    onClick={handleDownloadInstall}\n                  >\n                    {_('DOWNLOAD & INSTALL')}\n                  </button>\n                </div>\n              </div>\n            </div>\n          ) : (\n            <div className='text-base-content flex h-full flex-grow flex-col text-sm sm:flex-row'>\n              <div className='flex flex-col items-center justify-center gap-4 p-1 sm:items-start sm:gap-2'>\n                <h2 className='text-center font-bold sm:text-start'>\n                  {_('Version {{version}}', { version: currentVersion })}\n                </h2>\n\n                {changelogs.length > 0 && semver.gt(changelogs[0]!.version, currentVersion) ? (\n                  <div className='flex gap-2'>\n                    {(appService?.isIOSApp || appService?.isMacOSApp) && (\n                      <Link\n                        href='https://apps.apple.com/app/id6738622779'\n                        target='_blank'\n                        rel='noopener noreferrer'\n                        className='btn btn-primary btn-sm'\n                      >\n                        {_('Check Update')}\n                      </Link>\n                    )}\n\n                    {appService?.isAndroidApp && (\n                      <Link\n                        href='https://play.google.com/store/apps/details?id=com.bilingify.readest'\n                        target='_blank'\n                        rel='noopener noreferrer'\n                        className='btn btn-primary btn-sm'\n                      >\n                        {_('Check Update')}\n                      </Link>\n                    )}\n                  </div>\n                ) : (\n                  <div className='flex'>\n                    <p className='text-sm font-bold'>{_('Already the latest version')}</p>\n                  </div>\n                )}\n              </div>\n            </div>\n          )}\n        </div>\n        <div className='text-base-content text-sm'>\n          <h3 className='mb-2 font-bold'>{_('Changelog')}</h3>\n          <div className='not-eink:bg-base-200 not-eink:px-4 mb-4 rounded-lg pb-2 pt-4'>\n            {changelogs.length > 0 ? (\n              changelogs.map((entry: Changelog) => (\n                <div key={entry.version} className='mb-4'>\n                  <h4 className='mb-2 font-bold'>\n                    {entry.version} ({entry.date})\n                  </h4>\n                  <ul className='list-disc space-y-1 ps-6 text-sm'>\n                    {entry.notes.map((note: string, i: number) => (\n                      <li key={i}>{note}</li>\n                    ))}\n                  </ul>\n                </div>\n              ))\n            ) : (\n              <div className='flex h-56 w-full flex-col gap-4'>\n                <div className='skeleton h-4 w-28'></div>\n                <div className='skeleton h-4 w-full'></div>\n                <div className='skeleton h-4 w-full'></div>\n              </div>\n            )}\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport const setUpdaterWindowVisible = (\n  visible: boolean,\n  latestVersion: string,\n  lastVersion?: string,\n  checkUpdate = true,\n) => {\n  const dialog = document.getElementById('updater_window');\n  if (dialog) {\n    const event = new CustomEvent('setDialogVisibility', {\n      detail: { visible, latestVersion, lastVersion, checkUpdate },\n    });\n    dialog.dispatchEvent(event);\n  }\n};\n\nexport const UpdaterWindow = () => {\n  const _ = useTranslation();\n  const [latestVersion, setLatestVersion] = useState('');\n  const [lastVersion, setLastVersion] = useState('');\n  const [checkUpdate, setCheckUpdate] = useState(true);\n  const [isOpen, setIsOpen] = useState(false);\n\n  useEffect(() => {\n    const handleCustomEvent = (event: CustomEvent) => {\n      const { visible, latestVersion, lastVersion, checkUpdate } = event.detail;\n      setIsOpen(visible);\n      setCheckUpdate(checkUpdate);\n      if (latestVersion) {\n        setLatestVersion(latestVersion);\n      }\n      if (lastVersion) {\n        setLastVersion(lastVersion);\n      }\n    };\n\n    const el = document.getElementById('updater_window');\n    if (el) {\n      el.addEventListener('setDialogVisibility', handleCustomEvent as EventListener);\n    }\n\n    return () => {\n      if (el) {\n        el.removeEventListener('setDialogVisibility', handleCustomEvent as EventListener);\n      }\n    };\n  }, []);\n\n  return (\n    <Dialog\n      id='updater_window'\n      isOpen={isOpen}\n      title={checkUpdate ? _('Software Update') : _(\"What's New in Readest\")}\n      onClose={() => setIsOpen(false)}\n      boxClassName='sm:!w-[75%] sm:h-auto sm:!max-h-[85vh] sm:!max-w-2xl'\n    >\n      {isOpen && (\n        <UpdaterContent\n          latestVersion={latestVersion ?? undefined}\n          lastVersion={lastVersion ?? undefined}\n          checkUpdate={checkUpdate}\n        />\n      )}\n    </Dialog>\n  );\n};\n"],"names":[],"mappings":";;;;;;;;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;AAzBA;;;;;;;;;;;;;;;;;;;;;;;;;;AAoEO,MAAM,iBAAiB,CAAC,EAC7B,aAAa,EACb,WAAW,EACX,cAAc,IAAI,EAKnB;IACC,MAAM,IAAI,IAAA,mKAAc;IACxB,MAAM,CAAC,YAAY,cAAc,GAAG,IAAA,+GAAQ,EAAC;IAC7C,MAAM,EAAE,SAAS,EAAE,GAAG,IAAA,iKAAa,EAAC;QAClC,UAAU;QACV,YAAY;QACZ;IACF;IACA,MAAM,EAAE,UAAU,EAAE,GAAG,IAAA,0JAAM;IAC7B,MAAM,eAAe,IAAA,gTAAe;IACpC,MAAM,iBAAiB,IAAA,2JAAa;IACpC,MAAM,CAAC,YAAY,cAAc,GAAG,IAAA,+GAAQ,EAC1C,iBAAiB,cAAc,IAAI,oBAAoB;IAEzD,MAAM,CAAC,YAAY,cAAc,GAAG,IAAA,+GAAQ,EAC1C,eAAe,cAAc,IAAI,kBAAkB;IAErD,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,+GAAQ,EAAgC;IACpE,MAAM,CAAC,YAAY,cAAc,GAAG,IAAA,+GAAQ,EAAc,EAAE;IAC5D,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,+GAAQ,EAAgB;IACxD,MAAM,CAAC,eAAe,iBAAiB,GAAG,IAAA,+GAAQ,EAAgB;IAClE,MAAM,CAAC,eAAe,iBAAiB,GAAG,IAAA,+GAAQ,EAAC;IACnD,MAAM,CAAC,YAAY,cAAc,GAAG,IAAA,+GAAQ,EAAgB;IAC5D,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,+GAAQ,EAAC;IAE3C,IAAA,gHAAS,EAAC;QACR,cAAc,IAAA,oJAAS;IACzB,GAAG,EAAE;IAEL,IAAA,gHAAS,EAAC;QACR,MAAM,qBAAqB;YACzB,MAAM,SAAS,MAAM,IAAA,iLAAK;YAC1B,IAAI,QAAQ;gBACV,UAAU;YACZ;QACF;QACA,MAAM,qBAAqB;YACzB,IAAI,CAAC,YAAY;YACjB,MAAM,QAAQ,IAAA,uKAAkB,MAAK,2KAAU,GAAG,OAAO,KAAK;YAC9D,MAAM,WAAW,MAAM,MAAM,uKAAoB;YACjD,MAAM,OAAO,MAAM,SAAS,IAAI;YAChC,IAAI,gHAAM,CAAC,EAAE,CAAC,KAAK,OAAO,EAAE,iBAAiB;gBAC3C,MAAM,UAAU,IAAA,sKAAM;gBACtB,MAAM,cAAc,YAAY,YAAY,kBAAkB;gBAC9D,MAAM,OAAO,YAAY,YAAY,UAAU;gBAC/C,MAAM,cAAc,KAAK,SAAS,CAAC,YAAY,EAAE;gBACjD,MAAM,cAAc,MAAM,WAAW,eAAe,CAClD,CAAC,QAAQ,EAAE,KAAK,OAAO,CAAC,CAAC,EAAE,KAAK,IAAI,CAAC,EACrC;gBAEF,UAAU;oBACR;oBACA,SAAS,KAAK,OAAO;oBACrB,MAAM,KAAK,QAAQ;oBACnB,MAAM,KAAK,KAAK;oBAChB,oBAAoB,OAAO;wBACzB,MAAM,IAAI,QAAc,OAAO,SAAS;4BACtC,IAAI,aAAa;4BACjB,IAAI,QAAQ;4BACZ,MAAM,IAAA,4JAAa,EAAC,aAAa,aAAa,CAAC;gCAC7C,IAAI,CAAC,SAAS;gCACd,IAAI,CAAC,SAAS,SAAS,KAAK,EAAE;oCAC5B,QAAQ,SAAS,KAAK;oCACtB,QAAQ;wCACN,OAAO;wCACP,MAAM;4CAAE,eAAe;wCAAM;oCAC/B;gCACF,OAAO,IAAI,aAAa,KAAK,SAAS,QAAQ,KAAK,SAAS,KAAK,EAAE;oCACjE,QAAQ,GAAG,CAAC,qBAAqB;oCACjC,UAAU;wCAAE,OAAO;oCAAW;oCAC9B,WAAW;wCACT;oCACF,GAAG;gCACL;gCAEA,QAAQ;oCACN,OAAO;oCACP,MAAM;wCAAE,aAAa,SAAS,QAAQ,GAAG;oCAAW;gCACtD;gCACA,aAAa,SAAS,QAAQ;4BAChC,GAAG,KAAK,CAAC,CAAC;gCACR,QAAQ,KAAK,CAAC,oBAAoB;gCAClC,OAAO;4BACT;wBACF;wBAEA,MAAM,MAAM,MAAM,IAAA,2JAAc,EAAC;4BAC/B,MAAM;wBACR;wBACA,IAAI,IAAI,OAAO,EAAE;4BACf,QAAQ,GAAG,CAAC;wBACd,OAAO;4BACL,QAAQ,KAAK,CAAC,0BAA0B,IAAI,KAAK;wBACnD;oBACF;gBACF;YACF;QACF;QACA,MAAM,6BAA6B;YACjC,IAAI,CAAC,YAAY;YACjB,MAAM,QAAQ,IAAA,uKAAkB,MAAK,2KAAU,GAAG,OAAO,KAAK;YAC9D,MAAM,WAAW,MAAM,MAAM,uKAAoB;YACjD,MAAM,OAAO,MAAM,SAAS,IAAI;YAChC,IAAI,gHAAM,CAAC,EAAE,CAAC,KAAK,OAAO,EAAE,iBAAiB;gBAC3C,MAAM,UAAU,IAAA,sKAAM;gBACtB,MAAM,cACJ,YAAY,WAAW,4BAA4B;gBACrD,MAAM,OAAO,YAAY,WAAW,QAAQ;gBAC5C,MAAM,cAAc,KAAK,SAAS,CAAC,YAAY,EAAE;gBACjD,MAAM,UAAU,MAAM,IAAA,sKAAM,EAAS;gBACrC,MAAM,cAAc,CAAC,QAAQ,EAAE,KAAK,OAAO,CAAC,CAAC,EAAE,KAAK,aAAa,CAAC;gBAClE,MAAM,cAAc,MAAM,IAAA,oKAAI,EAAC,SAAS;gBACxC,UAAU;oBACR;oBACA,SAAS,KAAK,OAAO;oBACrB,MAAM,KAAK,QAAQ;oBACnB,MAAM,KAAK,KAAK;oBAChB,oBAAoB,OAAO;wBACzB,MAAM,IAAI,QAAc,OAAO,SAAS;4BACtC,IAAI,aAAa;4BACjB,IAAI,QAAQ;4BACZ,MAAM,IAAA,4JAAa,EAAC,aAAa,aAAa,CAAC;gCAC7C,IAAI,CAAC,SAAS;gCACd,IAAI,CAAC,SAAS,SAAS,KAAK,EAAE;oCAC5B,QAAQ,SAAS,KAAK;oCACtB,QAAQ;wCACN,OAAO;wCACP,MAAM;4CAAE,eAAe;wCAAM;oCAC/B;gCACF,OAAO,IAAI,aAAa,KAAK,SAAS,QAAQ,KAAK,SAAS,KAAK,EAAE;oCACjE,QAAQ,GAAG,CAAC,8BAA8B;oCAC1C,UAAU;wCAAE,OAAO;oCAAW;oCAC9B,WAAW;wCACT;oCACF,GAAG;gCACL;gCAEA,QAAQ;oCACN,OAAO;oCACP,MAAM;wCAAE,aAAa,SAAS,QAAQ,GAAG;oCAAW;gCACtD;gCACA,aAAa,SAAS,QAAQ;4BAChC,GAAG,KAAK,CAAC,CAAC;gCACR,QAAQ,KAAK,CAAC,oBAAoB;gCAClC,OAAO;4BACT;wBACF;wBAEA,IAAI;4BACF,QAAQ,GAAG,CAAC,6BAA6B;4BACzC,MAAM,UAAU,+KAAO,CAAC,MAAM,CAAC,iBAAiB;gCAAC;gCAAM;gCAAS;gCAAI;6BAAY;4BAChF,MAAM,QAAQ,KAAK;4BACnB,QAAQ,GAAG,CAAC;4BACZ,WAAW;gCACT,MAAM,IAAA,gLAAI,EAAC;4BACb,GAAG;wBACL,EAAE,OAAO,OAAO;4BACd,QAAQ,KAAK,CAAC,oCAAoC;wBACpD;oBACF;gBACF;YACF;QACF;QACA,MAAM,kBAAkB;YACtB,MAAM,UAAU,IAAA,sKAAM;YACtB,IAAI,YAAY,iBAAiB,YAAY,WAAW;gBACtD;YACF,OAAO,IAAI;gBAAC;gBAAS;gBAAW;aAAQ,CAAC,QAAQ,CAAC,UAAU;gBAC1D;YACF,OAAO,IAAI,YAAY,WAAW;gBAChC;YACF;QACF;QACA,IAAI,YAAY,cAAc,aAAa;YACzC;QACF;IACA,uDAAuD;IACzD,GAAG;QAAC,YAAY;KAAW;IAE3B,IAAA,gHAAS,EAAC;QACR,IAAI,eAAe;YACjB,cAAc;QAChB;QACA,IAAI,aAAa;YACf,cAAc;QAChB;QACA,IAAI,CAAC,aAAa;YAChB,UAAU;gBACR;gBACA,SAAS;gBACT,MAAM;gBACN,MAAM;YACR;QACF;IACA,uDAAuD;IACzD,GAAG;QAAC;QAAe;QAAa;KAAY;IAE5C,IAAA,gHAAS,EAAC;QACR,MAAM,kBAAkB,OAAO;YAC7B,IAAI;gBACF,MAAM,QAAQ,IAAA,uKAAkB,MAAK,2KAAU,GAAG,OAAO,KAAK;gBAC9D,MAAM,MAAM,MAAM,MAAM,yKAAsB;gBAC9C,MAAM,OAAqB,MAAM,IAAI,IAAI;gBACzC,MAAM,WAAW,KAAK,QAAQ;gBAE9B,IAAI,UAAU,OAAO,OAAO,CAAC,UAC1B,MAAM,CAAC,CAAC,CAAC,IAAI,GAAK,gHAAM,CAAC,EAAE,CAAC,KAAK,cACjC,IAAI,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,EAAE,GAAK,gHAAM,CAAC,QAAQ,CAAC,GAAG;gBACzC,UAAU,QAAQ,MAAM,GAAG,UAAU,OAAO,OAAO,CAAC,UAAU,KAAK,CAAC,GAAG;gBACvE,OAAO,QAAQ,GAAG,CAAC,CAAC,CAAC,SAAS,KAAK,GAAK,CAAC;wBACvC;wBACA,MAAM,IAAI,KAAK,KAAK,IAAI,EAAE,kBAAkB;wBAC5C,OAAO,KAAK,KAAK;oBACnB,CAAC;YACH,EAAE,OAAO,OAAO;gBACd,QAAQ,KAAK,CAAC,8BAA8B;gBAC5C,OAAO,EAAE;YACX;QACF;QACA,MAAM,oBAAoB,CAAC;YACzB,OAAO,MACJ,KAAK,CAAC,mBACN,GAAG,CAAC,CAAC,OAAS,KAAK,IAAI,IACvB,MAAM,CAAC,CAAC,OAAS,KAAK,MAAM,GAAG;QACpC;QACA,MAAM,mBAAmB,OAAO;YAC9B,cAAc,OAAO,OAAO;YAC5B,IAAI,aAAa,MAAM,gBAAgB,cAAc;YACrD,IAAI,WAAW,MAAM,KAAK,KAAK,OAAO,IAAI,IAAI,OAAO,IAAI,EAAE;gBACzD,aAAa;oBACX;wBACE,SAAS,OAAO,OAAO;wBACvB,MAAM,IAAI,KAAK,OAAO,IAAI,EAAE,kBAAkB;wBAC9C,OAAO,kBAAkB,OAAO,IAAI,IAAI;oBAC1C;iBACD;YACH;YACA,IAAI,CAAC,WAAW,WAAW,GAAG,UAAU,CAAC,OAAO;gBAC9C,KAAK,MAAM,SAAS,WAAY;oBAC9B,IAAI;wBACF,MAAM,KAAK,GAAG,MAAM,UAAU,MAAM,KAAK,EAAE;4BAAE,UAAU;wBAAK;oBAC9D,EAAE,OAAO,OAAO;wBACd,QAAQ,GAAG,CAAC,kCAAkC;oBAChD;gBACF;YACF;YAEA,cAAc;YACd,IAAA,+KAA+B,EAAC;QAClC;QACA,IAAI,QAAQ;YACV,iBAAiB;QACnB;IACA,uDAAuD;IACzD,GAAG;QAAC;KAAO;IAEX,IAAA,gHAAS,EAAC;QACR,aAAa;IACf,GAAG,EAAE;IAEL,MAAM,wBAAwB;QAC5B,IAAI,CAAC,QAAQ;YACX;QACF;QACA,IAAI,aAAa;QACjB,IAAI,gBAAgB;QACpB,IAAI,aAAa;QACjB,YAAY;QACZ,iBAAiB;QACjB,MAAM,OAAO,kBAAkB,GAAG,CAAC;YACjC,OAAQ,MAAM,KAAK;gBACjB,KAAK;oBACH,gBAAgB,MAAM,IAAI,CAAC,aAAa;oBACxC,iBAAiB;oBACjB;gBACF,KAAK;oBACH,cAAc,MAAM,IAAI,CAAC,WAAW;oBACpC,cAAc;oBACd,MAAM,UAAU,KAAK,KAAK,CAAC,AAAC,aAAa,gBAAiB;oBAC1D,YAAY;oBACZ,IAAI,aAAa,cAAc,IAAI,OAAO,MAAM;wBAC9C,QAAQ,GAAG,CAAC,CAAC,WAAW,EAAE,WAAW,YAAY,EAAE,eAAe;wBAClE,aAAa;oBACf;oBACA;gBACF,KAAK;oBACH,QAAQ,GAAG,CAAC;oBACZ,YAAY;oBACZ;YACJ;QACF;QACA,QAAQ,GAAG,CAAC;QACZ,IAAI,CAAC,YAAY,gBAAgB,oDAA4B;;IAG/D;IAEA,IAAI,CAAC,aAAa,CAAC,YAAY;QAC7B,OAAO;IACT;IAEA,qBACE,qKAAC;QAAI,WAAU;kBACb,cAAA,qKAAC;YAAI,WAAU;;8BACb,qKAAC;oBAAI,WAAU;;sCACb,qKAAC;4BAAI,WAAU;sCACb,cAAA,qKAAC,mSAAK;gCAAC,KAAI;gCAAY,KAAI;gCAAO,WAAU;gCAAY,OAAO;gCAAI,QAAQ;;;;;;;;;;;wBAG5E,4BACC,qKAAC;4BAAI,WAAU;;8CACb,qKAAC;oCAAG,WAAU;8CACX,EAAE;;;;;;8CAEL,qKAAC;oCAAE,WAAU;8CACV,EAAE,+EAA+E;wCAChF;wCACA;oCACF;;;;;;8CAEF,qKAAC;oCAAE,WAAU;8CAAQ,EAAE;;;;;;8CAEvB,qKAAC;oCAAI,WAAU;;wCACZ,aAAa,sBACZ,qKAAC;4CAAI,WAAU;;8DACb,qKAAC;oDACC,WAAU;oDACV,OAAO;oDACP,KAAI;;;;;;8DAEN,qKAAC;oDAAE,WAAU;8DACV,WAAW,MACR,EAAE,mDAAmD;wDACnD,YAAY,aACR,GAAG,KAAK,KAAK,CAAC,aAAa,OAAO,MAAM,GAAG,CAAC,GAC5C;wDACJ,eAAe,gBACX,GAAG,KAAK,KAAK,CAAC,gBAAgB,OAAO,MAAM,GAAG,CAAC,GAC/C;oDACN,KACA,EAAE;;;;;;;;;;;;sDAKZ,qKAAC;4CAAI,WAAU;sDACb,cAAA,qKAAC;gDACC,WAAW,IAAA,mHAAI,EACb,gDACA,CAAC,CAAC,UAAU,aAAa,KAAK;gDAEhC,SAAS;0DAER,EAAE;;;;;;;;;;;;;;;;;;;;;;qFAMX,qKAAC;4BAAI,WAAU;sCACb,cAAA,qKAAC;gCAAI,WAAU;;kDACb,qKAAC;wCAAG,WAAU;kDACX,EAAE,uBAAuB;4CAAE,SAAS;wCAAe;;;;;;oCAGrD,WAAW,MAAM,GAAG,KAAK,gHAAM,CAAC,EAAE,CAAC,UAAU,CAAC,EAAE,CAAE,OAAO,EAAE,gCAC1D,qKAAC;wCAAI,WAAU;;4CACZ,CAAC,YAAY,YAAY,YAAY,UAAU,mBAC9C,qKAAC,wJAAI;gDACH,MAAK;gDACL,QAAO;gDACP,KAAI;gDACJ,WAAU;0DAET,EAAE;;;;;;4CAIN,YAAY,8BACX,qKAAC,wJAAI;gDACH,MAAK;gDACL,QAAO;gDACP,KAAI;gDACJ,WAAU;0DAET,EAAE;;;;;;;;;;;iGAKT,qKAAC;wCAAI,WAAU;kDACb,cAAA,qKAAC;4CAAE,WAAU;sDAAqB,EAAE;;;;;;;;;;;;;;;;;;;;;;;;;;;;8BAOhD,qKAAC;oBAAI,WAAU;;sCACb,qKAAC;4BAAG,WAAU;sCAAkB,EAAE;;;;;;sCAClC,qKAAC;4BAAI,WAAU;sCACZ,WAAW,MAAM,GAAG,IACnB,WAAW,GAAG,CAAC,CAAC,sBACd,qKAAC;oCAAwB,WAAU;;sDACjC,qKAAC;4CAAG,WAAU;;gDACX,MAAM,OAAO;gDAAC;gDAAG,MAAM,IAAI;gDAAC;;;;;;;sDAE/B,qKAAC;4CAAG,WAAU;sDACX,MAAM,KAAK,CAAC,GAAG,CAAC,CAAC,MAAc,kBAC9B,qKAAC;8DAAY;mDAAJ;;;;;;;;;;;mCANL,MAAM,OAAO;;;;8FAYzB,qKAAC;gCAAI,WAAU;;kDACb,qKAAC;wCAAI,WAAU;;;;;;kDACf,qKAAC;wCAAI,WAAU;;;;;;kDACf,qKAAC;wCAAI,WAAU;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAQ/B;AAEO,MAAM,0BAA0B,CACrC,SACA,eACA,aACA,cAAc,IAAI;IAElB,MAAM,SAAS,SAAS,cAAc,CAAC;IACvC,IAAI,QAAQ;QACV,MAAM,QAAQ,IAAI,YAAY,uBAAuB;YACnD,QAAQ;gBAAE;gBAAS;gBAAe;gBAAa;YAAY;QAC7D;QACA,OAAO,aAAa,CAAC;IACvB;AACF;AAEO,MAAM,gBAAgB;IAC3B,MAAM,IAAI,IAAA,mKAAc;IACxB,MAAM,CAAC,eAAe,iBAAiB,GAAG,IAAA,+GAAQ,EAAC;IACnD,MAAM,CAAC,aAAa,eAAe,GAAG,IAAA,+GAAQ,EAAC;IAC/C,MAAM,CAAC,aAAa,eAAe,GAAG,IAAA,+GAAQ,EAAC;IAC/C,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,+GAAQ,EAAC;IAErC,IAAA,gHAAS,EAAC;QACR,MAAM,oBAAoB,CAAC;YACzB,MAAM,EAAE,OAAO,EAAE,aAAa,EAAE,WAAW,EAAE,WAAW,EAAE,GAAG,MAAM,MAAM;YACzE,UAAU;YACV,eAAe;YACf,IAAI,eAAe;gBACjB,iBAAiB;YACnB;YACA,IAAI,aAAa;gBACf,eAAe;YACjB;QACF;QAEA,MAAM,KAAK,SAAS,cAAc,CAAC;QACnC,IAAI,IAAI;YACN,GAAG,gBAAgB,CAAC,uBAAuB;QAC7C;QAEA,OAAO;YACL,IAAI,IAAI;gBACN,GAAG,mBAAmB,CAAC,uBAAuB;YAChD;QACF;IACF,GAAG,EAAE;IAEL,qBACE,qKAAC,0JAAM;QACL,IAAG;QACH,QAAQ;QACR,OAAO,cAAc,EAAE,qBAAqB,EAAE;QAC9C,SAAS,IAAM,UAAU;QACzB,cAAa;kBAEZ,wBACC,qKAAC;YACC,eAAe,iBAAiB;YAChC,aAAa,eAAe;YAC5B,aAAa;;;;;;;;;;;AAKvB"}},
    {"offset": {"line": 1142, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/components/SupportLinks.tsx"],"sourcesContent":["import { FaGithub, FaDiscord, FaReddit } from 'react-icons/fa';\nimport { useTranslation } from '@/hooks/useTranslation';\nimport { useResponsiveSize } from '@/hooks/useResponsiveSize';\nimport Link from './Link';\n\nconst SupportLinks = () => {\n  const _ = useTranslation();\n  const iconSize = useResponsiveSize(24);\n\n  return (\n    <div className='my-2 flex flex-col items-center gap-2'>\n      <p className='text-neutral-content text-sm'>{_('Get Help from the Readest Community')}</p>\n      <div className='flex gap-4'>\n        <Link\n          href='https://github.com/readest/readest'\n          className='flex items-center gap-2 rounded-full bg-gray-800 p-1.5 text-white transition-colors hover:bg-gray-700'\n          title='GitHub'\n          aria-label='GitHub'\n        >\n          <FaGithub size={iconSize} />\n        </Link>\n        <Link\n          href='https://discord.gg/gntyVNk3BJ'\n          className='flex items-center gap-2 rounded-full bg-indigo-600 p-1.5 text-white transition-colors hover:bg-indigo-500'\n          title='Discord'\n          aria-label='Discord'\n        >\n          <FaDiscord size={iconSize} />\n        </Link>\n        <Link\n          href='https://reddit.com/r/readest/'\n          className='flex items-center gap-2 rounded-full bg-orange-600 p-1.5 text-white transition-colors hover:bg-orange-500'\n          title='Reddit'\n          aria-label='Reddit'\n        >\n          <FaReddit size={iconSize} />\n        </Link>\n      </div>\n    </div>\n  );\n};\n\nexport default SupportLinks;\n"],"names":[],"mappings":";;;;;AAAA;AACA;AACA;AACA;;;;;;;;;;;AAEA,MAAM,eAAe;IACnB,MAAM,IAAI,IAAA,mKAAc;IACxB,MAAM,WAAW,IAAA,yKAAiB,EAAC;IAEnC,qBACE,qKAAC;QAAI,WAAU;;0BACb,qKAAC;gBAAE,WAAU;0BAAgC,EAAE;;;;;;0BAC/C,qKAAC;gBAAI,WAAU;;kCACb,qKAAC,wJAAI;wBACH,MAAK;wBACL,WAAU;wBACV,OAAM;wBACN,cAAW;kCAEX,cAAA,qKAAC,oOAAQ;4BAAC,MAAM;;;;;;;;;;;kCAElB,qKAAC,wJAAI;wBACH,MAAK;wBACL,WAAU;wBACV,OAAM;wBACN,cAAW;kCAEX,cAAA,qKAAC,qOAAS;4BAAC,MAAM;;;;;;;;;;;kCAEnB,qKAAC,wJAAI;wBACH,MAAK;wBACL,WAAU;wBACV,OAAM;wBACN,cAAW;kCAEX,cAAA,qKAAC,oOAAQ;4BAAC,MAAM;;;;;;;;;;;;;;;;;;;;;;;AAK1B;uCAEe"}},
    {"offset": {"line": 1250, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/components/LegalLinks.tsx"],"sourcesContent":["import { useEnv } from '@/context/EnvContext';\nimport { useTranslation } from '@/hooks/useTranslation';\nimport Link from './Link';\n\nconst LegalLinks = () => {\n  const _ = useTranslation();\n  const { appService } = useEnv();\n\n  const termsUrl =\n    appService?.isIOSApp || appService?.isMacOSApp\n      ? 'https://www.apple.com/legal/internet-services/itunes/dev/stdeula/'\n      : 'https://readest.com/terms-of-service';\n\n  return (\n    <div className='my-2 flex flex-wrap justify-center gap-4 text-sm sm:text-xs'>\n      <Link href={termsUrl} className='text-blue-500 underline hover:text-blue-600'>\n        {_('Terms of Service')}\n      </Link>\n      <Link\n        href='https://readest.com/privacy-policy'\n        className='text-blue-500 underline hover:text-blue-600'\n      >\n        {_('Privacy Policy')}\n      </Link>\n    </div>\n  );\n};\n\nexport default LegalLinks;\n"],"names":[],"mappings":";;;;;AAAA;AACA;AACA;;;;;;;;;;AAEA,MAAM,aAAa;IACjB,MAAM,IAAI,IAAA,mKAAc;IACxB,MAAM,EAAE,UAAU,EAAE,GAAG,IAAA,0JAAM;IAE7B,MAAM,WACJ,YAAY,YAAY,YAAY,aAChC,sEACA;IAEN,qBACE,qKAAC;QAAI,WAAU;;0BACb,qKAAC,wJAAI;gBAAC,MAAM;gBAAU,WAAU;0BAC7B,EAAE;;;;;;0BAEL,qKAAC,wJAAI;gBACH,MAAK;gBACL,WAAU;0BAET,EAAE;;;;;;;;;;;;AAIX;uCAEe"}},
    {"offset": {"line": 1307, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/components/AboutWindow.tsx"],"sourcesContent":["'use client';\n\nimport React, { useEffect, useState } from 'react';\nimport Image from 'next/image';\nimport { useEnv } from '@/context/EnvContext';\nimport { useTranslation } from '@/hooks/useTranslation';\nimport { checkForAppUpdates, checkAppReleaseNotes } from '@/helpers/updater';\nimport { parseWebViewInfo } from '@/utils/ua';\nimport { getAppVersion } from '@/utils/version';\nimport SupportLinks from './SupportLinks';\nimport LegalLinks from './LegalLinks';\nimport Dialog from './Dialog';\nimport Link from './Link';\n\nexport const setAboutDialogVisible = (visible: boolean) => {\n  const dialog = document.getElementById('about_window');\n  if (dialog) {\n    const event = new CustomEvent('setDialogVisibility', {\n      detail: { visible },\n    });\n    dialog.dispatchEvent(event);\n  }\n};\n\ntype UpdateStatus = 'checking' | 'updating' | 'updated' | 'error';\n\nexport const AboutWindow = () => {\n  const _ = useTranslation();\n  const { appService } = useEnv();\n  const [updateStatus, setUpdateStatus] = useState<UpdateStatus | null>(null);\n  const [browserInfo, setBrowserInfo] = useState('');\n  const [isOpen, setIsOpen] = useState(false);\n\n  useEffect(() => {\n    setBrowserInfo(parseWebViewInfo(appService));\n\n    const handleCustomEvent = (event: CustomEvent) => {\n      setIsOpen(event.detail.visible);\n    };\n\n    const el = document.getElementById('about_window');\n    if (el) {\n      el.addEventListener('setDialogVisibility', handleCustomEvent as EventListener);\n    }\n\n    return () => {\n      if (el) {\n        el.removeEventListener('setDialogVisibility', handleCustomEvent as EventListener);\n      }\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  const handleCheckUpdate = async () => {\n    setUpdateStatus('checking');\n    try {\n      const hasUpdate = await checkForAppUpdates(_, false);\n      if (hasUpdate) {\n        handleClose();\n      } else {\n        setUpdateStatus('updated');\n      }\n    } catch (error) {\n      console.info('Error checking for updates:', error);\n      setUpdateStatus('error');\n    }\n  };\n\n  const handleShowRecentUpdates = async () => {\n    const hasNotes = await checkAppReleaseNotes(false);\n    if (hasNotes) {\n      handleClose();\n    } else {\n      setUpdateStatus('error');\n    }\n  };\n\n  const handleClose = () => {\n    setIsOpen(false);\n    setUpdateStatus(null);\n  };\n\n  return (\n    <Dialog\n      id='about_window'\n      isOpen={isOpen}\n      title={_('About Readest')}\n      onClose={handleClose}\n      boxClassName='sm:!w-[480px] sm:!max-w-screen-sm sm:h-auto'\n    >\n      {isOpen && (\n        <div className='about-content flex flex-col items-center justify-center gap-4 pb-10 sm:pb-0'>\n          <div className='flex flex-1 flex-col items-center justify-end gap-2 px-8 py-2'>\n            <div className='mb-2 mt-6'>\n              <Image src='/icon.png' alt='App Logo' className='h-20 w-20' width={64} height={64} />\n            </div>\n            <div className='flex select-text flex-col items-center'>\n              <h2 className='mb-2 text-2xl font-bold'>Readest</h2>\n              <p className='text-neutral-content text-center text-sm'>\n                {_('Version {{version}}', { version: getAppVersion() })} {`(${browserInfo})`}\n              </p>\n            </div>\n            <div className='my-1 h-5'>\n              {!updateStatus && (\n                <button\n                  className='btn btn-sm btn-primary cursor-pointer p-1 text-xs'\n                  onClick={appService?.hasUpdater ? handleCheckUpdate : handleShowRecentUpdates}\n                >\n                  {_('Check Update')}\n                </button>\n              )}\n              {updateStatus === 'updated' && (\n                <p className='text-neutral-content mt-2 text-xs'>\n                  {_('Already the latest version')}\n                </p>\n              )}\n              {updateStatus === 'checking' && (\n                <p className='text-neutral-content mt-2 text-xs'>{_('Checking for updates...')}</p>\n              )}\n              {updateStatus === 'error' && (\n                <p className='text-error mt-2 text-xs'>{_('Error checking for updates')}</p>\n              )}\n            </div>\n          </div>\n\n          <hr className='border-base-300 my-12 w-full sm:my-4' />\n\n          <div\n            className='flex flex-1 flex-col items-center justify-start gap-2 px-4 text-center'\n            dir='ltr'\n          >\n            <p className='text-neutral-content text-sm'>\n               {new Date().getFullYear()} Bilingify LLC. All rights reserved.\n            </p>\n\n            <p className='text-neutral-content text-xs'>\n              This software is licensed under the{' '}\n              <Link\n                href='https://www.gnu.org/licenses/agpl-3.0.html'\n                className='text-blue-500 underline'\n              >\n                GNU Affero General Public License v3.0\n              </Link>\n              . You are free to use, modify, and distribute this software under the terms of the\n              AGPL v3 license. Please see the license for more details.\n            </p>\n            <p className='text-neutral-content text-xs'>\n              Source code is available at{' '}\n              <Link href='https://github.com/readest/readest' className='text-blue-500 underline'>\n                GitHub\n              </Link>\n              .\n            </p>\n\n            <LegalLinks />\n          </div>\n          <SupportLinks />\n        </div>\n      )}\n    </Dialog>\n  );\n};\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1615, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/components/Toast.tsx"],"sourcesContent":["'use client';\n\nimport clsx from 'clsx';\nimport React, { useEffect, useRef, useState } from 'react';\nimport { useThemeStore } from '@/store/themeStore';\nimport { eventDispatcher } from '@/utils/event';\n\nexport type ToastType = 'info' | 'success' | 'warning' | 'error';\n\nexport const Toast = () => {\n  const { safeAreaInsets } = useThemeStore();\n  const [toastMessage, setToastMessage] = useState('');\n  const [toastType, setToastType] = useState<ToastType>('info');\n  const [toastTimeout, setToastTimeout] = useState(5000);\n  const [messageClass, setMessageClass] = useState('');\n  const [isVisible, setIsVisible] = useState(false);\n  const toastDismissTimeout = useRef<ReturnType<typeof setTimeout> | null>(null);\n\n  const toastClassMap = {\n    info: 'toast-info toast-center toast-middle',\n    success: 'toast-success toast-top sm:toast-end toast-center',\n    warning: 'toast-warning toast-top sm:toast-end toast-center',\n    error: 'toast-error toast-top sm:toast-end toast-center',\n  };\n\n  const alertClassMap = {\n    info: 'alert-primary border-base-300',\n    success: 'alert-success not-eink:from-green-500 not-eink:to-emerald-500',\n    warning: 'alert-warning not-eink:from-amber-500 not-eink:to-orange-500',\n    error: 'alert-error not-eink:from-red-500 not-eink:to-rose-500',\n  };\n\n  const iconMap = {\n    info: (\n      <svg className='h-5 w-5' fill='currentColor' viewBox='0 0 20 20'>\n        <path\n          fillRule='evenodd'\n          d='M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z'\n          clipRule='evenodd'\n        />\n      </svg>\n    ),\n    success: (\n      <svg className='h-5 w-5' fill='currentColor' viewBox='0 0 20 20'>\n        <path\n          fillRule='evenodd'\n          d='M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z'\n          clipRule='evenodd'\n        />\n      </svg>\n    ),\n    warning: (\n      <svg className='h-5 w-5' fill='currentColor' viewBox='0 0 20 20'>\n        <path\n          fillRule='evenodd'\n          d='M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z'\n          clipRule='evenodd'\n        />\n      </svg>\n    ),\n    error: (\n      <svg className='h-5 w-5' fill='currentColor' viewBox='0 0 20 20'>\n        <path\n          fillRule='evenodd'\n          d='M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z'\n          clipRule='evenodd'\n        />\n      </svg>\n    ),\n  };\n\n  useEffect(() => {\n    if (toastMessage) {\n      setTimeout(() => {\n        setIsVisible(true);\n      }, 0);\n    }\n  }, [toastMessage]);\n\n  useEffect(() => {\n    if (toastDismissTimeout.current) clearTimeout(toastDismissTimeout.current);\n    if (toastMessage) {\n      const timeout = setTimeout(() => {\n        setIsVisible(false);\n        setTimeout(() => setToastMessage(''), 300);\n      }, toastTimeout);\n      toastDismissTimeout.current = timeout;\n      return () => {\n        if (timeout) clearTimeout(timeout);\n      };\n    }\n    return;\n  }, [toastMessage, toastTimeout]);\n\n  const handleShowToast = async (event: CustomEvent) => {\n    const { message, type = 'info', timeout, className = '', callback = null } = event.detail;\n    setToastMessage(message);\n    setToastType(type);\n    if (timeout) setToastTimeout(timeout);\n    if (callback && typeof callback === 'function') {\n      setTimeout(() => callback(), timeout || 5000);\n    }\n    setMessageClass(className);\n  };\n\n  useEffect(() => {\n    eventDispatcher.on('toast', handleShowToast);\n    return () => {\n      eventDispatcher.off('toast', handleShowToast);\n    };\n  }, []);\n\n  const handleDismiss = () => {\n    setIsVisible(false);\n    setTimeout(() => setToastMessage(''), 300);\n    if (toastDismissTimeout.current) clearTimeout(toastDismissTimeout.current);\n  };\n\n  return (\n    toastMessage && (\n      <div\n        className={clsx(\n          'toast z-50 w-auto max-w-screen-sm transition-all duration-300',\n          toastClassMap[toastType],\n          isVisible ? 'scale-100 opacity-100' : 'scale-95 opacity-0',\n        )}\n        style={{\n          top: toastClassMap[toastType].includes('toast-top')\n            ? `${(safeAreaInsets?.top || 0) + 44}px`\n            : undefined,\n        }}\n      >\n        <div\n          className={clsx(\n            'alert flex items-center gap-3 shadow-2xl backdrop-blur-sm',\n            'min-h-0 rounded-2xl px-5 py-4',\n            'not-eink:bg-gradient-to-r border-0',\n            alertClassMap[toastType],\n            'eink:bg-base-100 eink:border eink:border-base-content',\n            toastType !== 'info' && 'text-white',\n          )}\n        >\n          {/* Icon */}\n          <div className='flex-shrink-0'>{iconMap[toastType]}</div>\n\n          {/* Message */}\n          <span\n            className={clsx(\n              'max-h-[50vh] flex-1 overflow-y-auto',\n              'font-sans text-base font-medium leading-snug sm:text-sm',\n              toastType === 'info'\n                ? 'max-w-[60vw] truncate sm:max-w-[80vw]'\n                : 'min-w-[60vw] max-w-[80vw] whitespace-normal break-words sm:min-w-40 sm:max-w-80',\n              messageClass,\n            )}\n          >\n            {toastMessage.split('\\n').map((line, idx) => (\n              <React.Fragment key={idx}>\n                {line || <>&nbsp;</>}\n                {idx < toastMessage.split('\\n').length - 1 && <br />}\n              </React.Fragment>\n            ))}\n          </span>\n\n          {/* Close button */}\n          <button\n            onClick={handleDismiss}\n            className={clsx(\n              'flex-shrink-0 rounded-lg p-1 transition-colors',\n              toastType === 'info' ? 'hover:bg-base-300' : 'hover:bg-white/20 active:bg-white/30',\n            )}\n            aria-label='Dismiss'\n          >\n            <svg className='h-4 w-4' fill='currentColor' viewBox='0 0 20 20'>\n              <path\n                fillRule='evenodd'\n                d='M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z'\n                clipRule='evenodd'\n              />\n            </svg>\n          </button>\n        </div>\n      </div>\n    )\n  );\n};\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1861, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/components/metadata/useMetadataEdit.ts"],"sourcesContent":["'use client';\n\nimport { useEffect, useState } from 'react';\nimport { BookMetadata } from '@/libs/document';\nimport {\n  validateAndNormalizeDate,\n  validateAndNormalizeLanguage,\n  validateAndNormalizeSubjects,\n  validateISBN,\n  ValidationResult,\n} from '@/utils/validation';\nimport { MetadataSource } from './SourceSelector';\nimport { searchMetadata } from '@/libs/metadata';\nimport { formatAuthors, formatTitle, getPrimaryLanguage } from '@/utils/book';\n\nexport const useMetadataEdit = (metadata: BookMetadata | null) => {\n  const [editedMeta, setEditedMeta] = useState<BookMetadata>({} as BookMetadata);\n  const [fieldSources, setFieldSources] = useState<Record<string, string>>({});\n  const [lockedFields, setLockedFields] = useState<Record<string, boolean>>({});\n  const [fieldErrors, setFieldErrors] = useState<Record<string, string>>({});\n\n  const [searchLoading, setSearchLoading] = useState(false);\n  const [showSourceSelection, setShowSourceSelection] = useState(false);\n  const [availableSources, setAvailableSources] = useState<MetadataSource[]>([]);\n\n  const lockableFields = [\n    'title',\n    'author',\n    'publisher',\n    'published',\n    'language',\n    'identifier',\n    'subject',\n    'description',\n    'subtitle',\n    'series',\n    'seriesIndex',\n    'seriesTotal',\n    'coverImageUrl',\n  ];\n\n  useEffect(() => {\n    if (metadata) {\n      setEditedMeta({ ...metadata });\n    }\n  }, [metadata]);\n\n  useEffect(() => {\n    const initialLockedFields: Record<string, boolean> = {};\n    lockableFields.forEach((field) => {\n      initialLockedFields[field] = false;\n    });\n    setLockedFields(initialLockedFields);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  const handleFieldChange = (field: string, value: string | undefined) => {\n    if (lockedFields[field]) {\n      return;\n    }\n\n    setEditedMeta((prevMeta) => {\n      const newMeta = { ...prevMeta } as { [key: string]: unknown };\n      switch (field) {\n        case 'subject':\n          newMeta['subject'] = value ? value.split(/,|;||/).map((s) => s.trim()) : [];\n          break;\n        default:\n          newMeta[field] = value;\n      }\n      return newMeta as BookMetadata;\n    });\n\n    if (value !== undefined) {\n      handleFieldValidation(field, value);\n    }\n\n    if (fieldSources[field]) {\n      setFieldSources((prevSources) => {\n        const newSources = { ...prevSources };\n        delete newSources[field];\n        return newSources;\n      });\n    }\n  };\n\n  const handleFieldValidation = (field: string, value: string) => {\n    if (lockedFields[field]) {\n      return true;\n    }\n\n    let validationResult: ValidationResult<unknown>;\n    switch (field) {\n      case 'title':\n      case 'author':\n        if (!value.trim()) {\n          console.warn(`Field ${field} cannot be empty`);\n          setFieldErrors((prev) => ({ ...prev, [field]: 'This field is required' }));\n          return false;\n        }\n        break;\n\n      case 'published':\n        if (value.trim()) {\n          validationResult = validateAndNormalizeDate(value);\n          if (!validationResult.isValid) {\n            console.warn(`Invalid date for field ${field}:`, validationResult.error);\n            setFieldErrors((prev) => ({ ...prev, [field]: validationResult.error || '' }));\n            return false;\n          }\n        }\n        break;\n\n      case 'language':\n        if (value.trim()) {\n          validationResult = validateAndNormalizeLanguage(value);\n          if (!validationResult.isValid) {\n            console.warn(`Invalid language for field ${field}:`, validationResult.error);\n            setFieldErrors((prev) => ({ ...prev, [field]: validationResult.error || '' }));\n            return false;\n          }\n        }\n        break;\n\n      case 'subject':\n        if (value.trim()) {\n          validationResult = validateAndNormalizeSubjects(value);\n          if (!validationResult.isValid) {\n            console.warn(`Invalid subjects for field ${field}:`, validationResult.error);\n            setFieldErrors((prev) => ({ ...prev, [field]: validationResult.error || '' }));\n            return false;\n          }\n        }\n        break;\n    }\n\n    setFieldErrors((prev) => {\n      const newErrors = { ...prev };\n      delete newErrors[field];\n      return newErrors;\n    });\n\n    return true;\n  };\n\n  const handleToggleFieldLock = (field: string) => {\n    setLockedFields((prev) => ({\n      ...prev,\n      [field]: !prev[field],\n    }));\n  };\n\n  const handleLockAll = () => {\n    const allLocked: Record<string, boolean> = {};\n    lockableFields.forEach((field) => {\n      allLocked[field] = true;\n    });\n    setLockedFields(allLocked);\n  };\n\n  const handleUnlockAll = () => {\n    const allUnlocked: Record<string, boolean> = {};\n    lockableFields.forEach((field) => {\n      allUnlocked[field] = false;\n    });\n    setLockedFields(allUnlocked);\n  };\n\n  const handleAutoRetrieve = async () => {\n    setSearchLoading(true);\n    try {\n      const isbnValidation = validateISBN(editedMeta.identifier || '');\n      const results = await searchMetadata({\n        title: formatTitle(editedMeta.title),\n        author: formatAuthors(editedMeta.author),\n        isbn: isbnValidation.isValid ? editedMeta.identifier : undefined,\n        language: getPrimaryLanguage(editedMeta.language),\n      });\n      const metadataSources = results.map((result) => ({\n        sourceName: result.providerName,\n        sourceLabel: result.providerLabel,\n        confidence: result.confidence,\n        data: result.metadata as BookMetadata,\n      }));\n      setAvailableSources(metadataSources);\n      setShowSourceSelection(true);\n    } catch (error) {\n      console.error('Failed to retrieve metadata:', error);\n    } finally {\n      setSearchLoading(false);\n    }\n  };\n\n  const handleSourceSelection = (selectedSource: MetadataSource) => {\n    const newMeta = { ...editedMeta } as { [key: string]: unknown };\n    const newSources = { ...fieldSources };\n\n    Object.entries(selectedSource.data).forEach(([key, value]) => {\n      if (lockedFields[key] || !value) {\n        return;\n      }\n      switch (key) {\n        default:\n          newMeta[key] = value;\n      }\n      newSources[key] = `${selectedSource.sourceName}-${selectedSource.confidence}`;\n    });\n\n    setEditedMeta(newMeta as BookMetadata);\n    setFieldSources(newSources);\n    setShowSourceSelection(false);\n  };\n\n  const handleCloseSourceSelection = () => {\n    setShowSourceSelection(false);\n  };\n\n  const resetToOriginal = () => {\n    if (metadata) {\n      setEditedMeta({ ...metadata });\n    }\n    setFieldSources({});\n    setShowSourceSelection(false);\n    handleUnlockAll();\n  };\n\n  return {\n    editedMeta,\n    fieldSources,\n    lockedFields,\n    fieldErrors,\n    searchLoading,\n    showSourceSelection,\n    availableSources,\n    handleFieldChange,\n    handleFieldValidation,\n    handleToggleFieldLock,\n    handleLockAll,\n    handleUnlockAll,\n    handleAutoRetrieve,\n    handleSourceSelection,\n    handleCloseSourceSelection,\n    resetToOriginal,\n  };\n};\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2119, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/components/Alert.tsx"],"sourcesContent":["'use client';\n\nimport clsx from 'clsx';\nimport React from 'react';\nimport { useTranslation } from '@/hooks/useTranslation';\nimport { useKeyDownActions } from '@/hooks/useKeyDownActions';\n\nconst Alert: React.FC<{\n  title: string;\n  message: string;\n  onCancel: () => void;\n  onConfirm: () => void;\n}> = ({ title, message, onCancel, onConfirm }) => {\n  const _ = useTranslation();\n  const [isProcessing, setIsProcessing] = React.useState(false);\n  const divRef = useKeyDownActions({ onCancel, onConfirm });\n\n  return (\n    <div className={clsx('z-[100] flex justify-center px-4')}>\n      <div\n        ref={divRef}\n        role='alert'\n        className={clsx(\n          'alert flex items-center justify-between',\n          'bg-base-300 rounded-lg border-none p-4 shadow-2xl',\n          'w-full max-w-[90vw] sm:max-w-[70vw] md:max-w-[50vw] lg:max-w-[40vw] xl:max-w-[40vw]',\n          'min-w-[70vw] flex-col sm:min-w-[40vw] sm:flex-row',\n        )}\n      >\n        <div className='labels flex items-center space-x-2 self-start sm:space-x-4 sm:self-center'>\n          <svg\n            xmlns='http://www.w3.org/2000/svg'\n            fill='none'\n            viewBox='0 0 24 24'\n            className='stroke-info h-6 w-6 shrink-0'\n          >\n            <path\n              strokeLinecap='round'\n              strokeLinejoin='round'\n              strokeWidth='2'\n              d='M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z'\n            ></path>\n          </svg>\n          <div className='flex flex-col gap-y-2'>\n            <h3 className='text-start text-sm font-medium sm:text-center'>{title}</h3>\n            <div className='text-start text-sm sm:text-center'>{message}</div>\n          </div>\n        </div>\n        <div className='buttons flex flex-wrap items-center justify-end gap-2 self-end sm:max-w-[20vw] sm:self-center'>\n          <button className='btn btn-sm btn-neutral' onClick={onCancel}>\n            {_('Cancel')}\n          </button>\n          <button\n            className={clsx('btn btn-sm btn-warning', { 'btn-disabled': isProcessing })}\n            onClick={() => {\n              setIsProcessing(true);\n              onConfirm();\n            }}\n          >\n            {_('Confirm')}\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default Alert;\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AACA;;;;;;;AALA;;;;;;AAOA,MAAM,QAKD,CAAC,EAAE,KAAK,EAAE,OAAO,EAAE,QAAQ,EAAE,SAAS,EAAE;IAC3C,MAAM,IAAI,IAAA,mKAAc;IACxB,MAAM,CAAC,cAAc,gBAAgB,GAAG,8GAAK,CAAC,QAAQ,CAAC;IACvD,MAAM,SAAS,IAAA,yKAAiB,EAAC;QAAE;QAAU;IAAU;IAEvD,qBACE,qKAAC;QAAI,WAAW,IAAA,mHAAI,EAAC;kBACnB,cAAA,qKAAC;YACC,KAAK;YACL,MAAK;YACL,WAAW,IAAA,mHAAI,EACb,2CACA,qDACA,uFACA;;8BAGF,qKAAC;oBAAI,WAAU;;sCACb,qKAAC;4BACC,OAAM;4BACN,MAAK;4BACL,SAAQ;4BACR,WAAU;sCAEV,cAAA,qKAAC;gCACC,eAAc;gCACd,gBAAe;gCACf,aAAY;gCACZ,GAAE;;;;;;;;;;;sCAGN,qKAAC;4BAAI,WAAU;;8CACb,qKAAC;oCAAG,WAAU;8CAAiD;;;;;;8CAC/D,qKAAC;oCAAI,WAAU;8CAAqC;;;;;;;;;;;;;;;;;;8BAGxD,qKAAC;oBAAI,WAAU;;sCACb,qKAAC;4BAAO,WAAU;4BAAyB,SAAS;sCACjD,EAAE;;;;;;sCAEL,qKAAC;4BACC,WAAW,IAAA,mHAAI,EAAC,0BAA0B;gCAAE,gBAAgB;4BAAa;4BACzE,SAAS;gCACP,gBAAgB;gCAChB;4BACF;sCAEC,EAAE;;;;;;;;;;;;;;;;;;;;;;;AAMf;uCAEe"}},
    {"offset": {"line": 2260, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/components/BookCover.tsx"],"sourcesContent":["'use client';\n\nimport clsx from 'clsx';\nimport Image from 'next/image';\nimport { memo, useEffect, useRef, useState } from 'react';\nimport { Book } from '@/types/book';\nimport { LibraryCoverFitType, LibraryViewModeType } from '@/types/settings';\nimport { formatAuthors, formatTitle } from '@/utils/book';\n\ninterface BookCoverProps {\n  book: Book;\n  mode?: LibraryViewModeType;\n  coverFit?: LibraryCoverFitType;\n  className?: string;\n  imageClassName?: string;\n  showSpine?: boolean;\n  isPreview?: boolean;\n  onImageError?: () => void;\n}\n\nconst BookCover: React.FC<BookCoverProps> = memo<BookCoverProps>(\n  ({\n    book,\n    mode = 'grid',\n    coverFit = 'crop',\n    showSpine = false,\n    className,\n    imageClassName,\n    isPreview,\n    onImageError,\n  }) => {\n    const coverRef = useRef<HTMLDivElement>(null);\n    const [imageLoaded, setImageLoaded] = useState(false);\n    const [imageError, setImageError] = useState(false);\n\n    const shouldShowSpine = showSpine && imageLoaded && !imageError;\n\n    const toggleImageVisibility = (showImage: boolean) => {\n      if (coverRef.current) {\n        const coverImage = coverRef.current.querySelector('.cover-image');\n        const fallbackCover = coverRef.current.querySelector('.fallback-cover');\n        if (coverImage) {\n          coverImage.classList.toggle('invisible', !showImage);\n        }\n        if (fallbackCover) {\n          fallbackCover.classList.toggle('invisible', showImage);\n        }\n      }\n    };\n\n    const handleImageLoad = () => {\n      setImageLoaded(true);\n      setImageError(false);\n      toggleImageVisibility(true);\n    };\n\n    const handleImageError = () => {\n      setImageLoaded(false);\n      setImageError(true);\n      toggleImageVisibility(false);\n      onImageError?.();\n    };\n\n    useEffect(() => {\n      toggleImageVisibility(true);\n    }, [book.metadata?.coverImageUrl, book.coverImageUrl]);\n\n    return (\n      <div\n        ref={coverRef}\n        className={clsx('book-cover-container relative flex h-full w-full', className)}\n      >\n        {coverFit === 'crop' ? (\n          <>\n            <Image\n              src={book.metadata?.coverImageUrl || book.coverImageUrl!}\n              alt={book.title}\n              fill={true}\n              className={clsx('cover-image crop-cover-img object-cover', imageClassName)}\n              onLoad={handleImageLoad}\n              onError={handleImageError}\n            />\n            <div\n              className={`book-spine absolute inset-0 ${shouldShowSpine ? 'visible' : 'invisible'}`}\n            />\n          </>\n        ) : (\n          <div className={clsx('flex h-full w-full justify-start')}>\n            <div\n              className={clsx(\n                'flex h-full max-h-full items-end',\n                mode === 'grid' ? 'items-end' : 'items-center',\n              )}\n            >\n              <Image\n                src={book.metadata?.coverImageUrl || book.coverImageUrl!}\n                alt={book.title}\n                width={0}\n                height={0}\n                sizes='100vw'\n                className={clsx(\n                  'cover-image fit-cover-img h-auto max-h-full w-auto max-w-full shadow-md',\n                  imageClassName,\n                )}\n                onLoad={handleImageLoad}\n                onError={handleImageError}\n              />\n              <div\n                className={`book-spine absolute inset-0 ${shouldShowSpine ? 'visible' : 'invisible'}`}\n              />\n            </div>\n          </div>\n        )}\n\n        <div\n          className={clsx(\n            'fallback-cover invisible absolute inset-0 p-2',\n            'text-neutral-content text-center font-serif font-medium',\n            isPreview ? 'bg-base-200/50' : 'bg-base-100',\n            imageClassName,\n          )}\n        >\n          <div className='flex h-1/2 items-center justify-center'>\n            <span\n              className={clsx(\n                isPreview ? 'line-clamp-2' : mode === 'grid' ? 'line-clamp-3' : 'line-clamp-2',\n                isPreview ? 'text-[0.5em]' : mode === 'grid' ? 'text-lg' : 'text-sm',\n              )}\n            >\n              {formatTitle(book.title)}\n            </span>\n          </div>\n          <div className='h-1/6'></div>\n          <div className='flex h-1/3 items-center justify-center'>\n            <span\n              className={clsx(\n                'text-neutral-content/50 line-clamp-1',\n                isPreview ? 'text-[0.4em]' : mode === 'grid' ? 'text-base' : 'text-xs',\n              )}\n            >\n              {formatAuthors(book.author)}\n            </span>\n          </div>\n        </div>\n      </div>\n    );\n  },\n  (prevProps, nextProps) => {\n    return (\n      prevProps.book.coverImageUrl === nextProps.book.coverImageUrl &&\n      prevProps.book.metadata?.coverImageUrl === nextProps.book.metadata?.coverImageUrl &&\n      prevProps.book.updatedAt === nextProps.book.updatedAt &&\n      prevProps.mode === nextProps.mode &&\n      prevProps.coverFit === nextProps.coverFit &&\n      prevProps.isPreview === nextProps.isPreview &&\n      prevProps.showSpine === nextProps.showSpine &&\n      prevProps.className === nextProps.className &&\n      prevProps.imageClassName === nextProps.imageClassName\n    );\n  },\n);\n\nBookCover.displayName = 'BookCover';\n\nexport default BookCover;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2441, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/components/MenuItem.tsx"],"sourcesContent":["import clsx from 'clsx';\nimport React from 'react';\nimport { IconType } from 'react-icons';\nimport { MdCheck } from 'react-icons/md';\nimport { useTranslation } from '@/hooks/useTranslation';\nimport { useResponsiveSize } from '@/hooks/useResponsiveSize';\n\ninterface MenuItemProps {\n  label: string;\n  toggled?: boolean;\n  description?: string;\n  tooltip?: string;\n  buttonClass?: string;\n  labelClass?: string;\n  shortcut?: string;\n  disabled?: boolean;\n  noIcon?: boolean;\n  transient?: boolean;\n  Icon?: React.ReactNode | IconType;\n  iconClassName?: string;\n  children?: React.ReactNode;\n  siblings?: React.ReactNode;\n  onClick?: () => void;\n  setIsDropdownOpen?: (isOpen: boolean) => void;\n}\n\nconst MenuItem: React.FC<MenuItemProps> = ({\n  label,\n  toggled,\n  description,\n  tooltip,\n  buttonClass,\n  labelClass,\n  shortcut,\n  disabled,\n  noIcon = false,\n  transient = false,\n  Icon,\n  iconClassName,\n  children,\n  siblings,\n  onClick,\n  setIsDropdownOpen,\n}) => {\n  const _ = useTranslation();\n  const iconSize = useResponsiveSize(16);\n  const IconType = Icon || (toggled !== undefined ? (toggled ? MdCheck : undefined) : undefined);\n\n  const handleClick = () => {\n    onClick?.();\n    if (transient) {\n      setIsDropdownOpen?.(false);\n    }\n  };\n\n  const buttonContent = (\n    <>\n      <div className='flex w-full items-center justify-between'>\n        <div className='flex min-w-0 items-center'>\n          {!noIcon && (\n            <span style={{ minWidth: `${iconSize}px` }}>\n              {typeof IconType === 'function' ? (\n                <IconType\n                  className={clsx(disabled ? 'text-gray-400' : 'text-base-content', iconClassName)}\n                  size={iconSize}\n                />\n              ) : (\n                IconType\n              )}\n            </span>\n          )}\n          <span\n            className={clsx('mx-2 flex-1 truncate text-base sm:text-sm', labelClass)}\n            style={{ minWidth: 0 }}\n          >\n            {label}\n          </span>\n        </div>\n        {shortcut && (\n          <kbd\n            className={clsx(\n              'border-base-300/40 bg-base-300/75 hidden rounded-md border shadow-sm sm:flex',\n              'shrink-0 px-1.5 py-0.5 text-xs font-medium',\n              disabled ? 'text-gray-400' : 'text-neutral-content',\n            )}\n          >\n            {shortcut}\n          </kbd>\n        )}\n      </div>\n      <div className='flex w-full'>\n        {description && (\n          <span\n            className='mt-1 truncate text-start text-xs text-gray-500'\n            style={{ minWidth: 0, paddingInlineStart: noIcon ? '0' : `${iconSize + 8}px` }}\n          >\n            {description}\n          </span>\n        )}\n      </div>\n    </>\n  );\n\n  if (children) {\n    return (\n      // eslint-disable-next-line jsx-a11y/no-noninteractive-element-to-interactive-role\n      <ul className='menu rounded-box m-0 p-0' role='menuitem' tabIndex={-1}>\n        <li aria-label={label}>\n          <details>\n            <summary\n              className={clsx(\n                'hover:bg-base-300 text-base-content cursor-pointer rounded-md p-1 py-[10px] pr-3',\n                disabled && 'btn-disabled cursor-not-allowed text-gray-400',\n                buttonClass,\n              )}\n              title={tooltip ? tooltip : ''}\n            >\n              {buttonContent}\n            </summary>\n            {children}\n          </details>\n        </li>\n      </ul>\n    );\n  }\n\n  return (\n    <div className='flex'>\n      <button\n        role={disabled ? 'none' : 'menuitem'}\n        aria-label={\n          toggled !== undefined ? `${label} - ${toggled ? _('ON') : _('OFF')}` : undefined\n        }\n        aria-live={toggled === undefined ? 'polite' : 'off'}\n        tabIndex={disabled ? -1 : 0}\n        className={clsx(\n          'hover:bg-base-300 text-base-content flex w-full flex-col items-center justify-center rounded-md p-1 py-[10px]',\n          disabled && 'btn-disabled text-gray-400',\n          buttonClass,\n        )}\n        title={tooltip ? tooltip : ''}\n        onClick={handleClick}\n        disabled={disabled}\n      >\n        {buttonContent}\n      </button>\n      {siblings}\n    </div>\n  );\n};\n\nexport default MenuItem;\n"],"names":[],"mappings":";;;;;AAAA;AAGA;AACA;AACA;;;;;;;;;;;AAqBA,MAAM,WAAoC,CAAC,EACzC,KAAK,EACL,OAAO,EACP,WAAW,EACX,OAAO,EACP,WAAW,EACX,UAAU,EACV,QAAQ,EACR,QAAQ,EACR,SAAS,KAAK,EACd,YAAY,KAAK,EACjB,IAAI,EACJ,aAAa,EACb,QAAQ,EACR,QAAQ,EACR,OAAO,EACP,iBAAiB,EAClB;IACC,MAAM,IAAI,IAAA,mKAAc;IACxB,MAAM,WAAW,IAAA,yKAAiB,EAAC;IACnC,MAAM,WAAW,QAAQ,CAAC,YAAY,YAAa,UAAU,mOAAO,GAAG,YAAa,SAAS;IAE7F,MAAM,cAAc;QAClB;QACA,IAAI,WAAW;YACb,oBAAoB;QACtB;IACF;IAEA,MAAM,8BACJ;;0BACE,qKAAC;gBAAI,WAAU;;kCACb,qKAAC;wBAAI,WAAU;;4BACZ,CAAC,wBACA,qKAAC;gCAAK,OAAO;oCAAE,UAAU,GAAG,SAAS,EAAE,CAAC;gCAAC;0CACtC,OAAO,aAAa,2BACnB,qKAAC;oCACC,WAAW,IAAA,mHAAI,EAAC,WAAW,kBAAkB,qBAAqB;oCAClE,MAAM;;;;;+EAGR;;;;;;0CAIN,qKAAC;gCACC,WAAW,IAAA,mHAAI,EAAC,6CAA6C;gCAC7D,OAAO;oCAAE,UAAU;gCAAE;0CAEpB;;;;;;;;;;;;oBAGJ,0BACC,qKAAC;wBACC,WAAW,IAAA,mHAAI,EACb,gFACA,8CACA,WAAW,kBAAkB;kCAG9B;;;;;;;;;;;;0BAIP,qKAAC;gBAAI,WAAU;0BACZ,6BACC,qKAAC;oBACC,WAAU;oBACV,OAAO;wBAAE,UAAU;wBAAG,oBAAoB,SAAS,MAAM,GAAG,WAAW,EAAE,EAAE,CAAC;oBAAC;8BAE5E;;;;;;;;;;;;;IAOX,IAAI,UAAU;QACZ,OACE,kFAAkF;sBAClF,qKAAC;YAAG,WAAU;YAA2B,MAAK;YAAW,UAAU,CAAC;sBAClE,cAAA,qKAAC;gBAAG,cAAY;0BACd,cAAA,qKAAC;;sCACC,qKAAC;4BACC,WAAW,IAAA,mHAAI,EACb,oFACA,YAAY,iDACZ;4BAEF,OAAO,UAAU,UAAU;sCAE1B;;;;;;wBAEF;;;;;;;;;;;;;;;;;IAKX;IAEA,qBACE,qKAAC;QAAI,WAAU;;0BACb,qKAAC;gBACC,MAAM,WAAW,SAAS;gBAC1B,cACE,YAAY,YAAY,GAAG,MAAM,GAAG,EAAE,UAAU,EAAE,QAAQ,EAAE,QAAQ,GAAG;gBAEzE,aAAW,YAAY,YAAY,WAAW;gBAC9C,UAAU,WAAW,CAAC,IAAI;gBAC1B,WAAW,IAAA,mHAAI,EACb,iHACA,YAAY,8BACZ;gBAEF,OAAO,UAAU,UAAU;gBAC3B,SAAS;gBACT,UAAU;0BAET;;;;;;YAEF;;;;;;;AAGP;uCAEe"}},
    {"offset": {"line": 2618, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/components/Dropdown.tsx"],"sourcesContent":["'use client';\n\nimport clsx from 'clsx';\nimport React, { useState, isValidElement, ReactElement, ReactNode, useRef } from 'react';\nimport { Overlay } from './Overlay';\nimport MenuItem from './MenuItem';\n\ninterface DropdownProps {\n  label: string;\n  className?: string;\n  menuClassName?: string;\n  buttonClassName?: string;\n  toggleButton: React.ReactNode;\n  children: ReactElement<{\n    setIsDropdownOpen: (isOpen: boolean) => void;\n    menuClassName?: string;\n    children: ReactNode;\n  }>;\n  disabled?: boolean;\n  onToggle?: (isOpen: boolean) => void;\n}\n\nconst enhanceMenuItems = (\n  children: ReactNode,\n  setIsDropdownOpen: (isOpen: boolean) => void,\n): ReactNode => {\n  const processNode = (node: ReactNode): ReactNode => {\n    if (!isValidElement(node)) {\n      return node;\n    }\n\n    const element = node as ReactElement;\n    const isMenuItem =\n      element.type === MenuItem ||\n      (typeof element.type === 'function' && element.type.name === 'MenuItem');\n\n    const clonedElement = isMenuItem\n      ? React.cloneElement(element, {\n          setIsDropdownOpen,\n          ...element.props,\n        })\n      : element;\n\n    if (clonedElement.props?.children) {\n      return React.cloneElement(clonedElement, {\n        ...clonedElement.props,\n        children: React.Children.map(clonedElement.props.children, processNode),\n      });\n    }\n\n    return clonedElement;\n  };\n\n  return React.Children.map(children, processNode);\n};\n\nconst Dropdown: React.FC<DropdownProps> = ({\n  label,\n  className,\n  menuClassName,\n  buttonClassName,\n  toggleButton,\n  children,\n  disabled,\n  onToggle,\n}) => {\n  const [isOpen, setIsOpen] = useState(false);\n  const [isFocused, setIsFocused] = useState(false);\n  const lastInteractionWasTapOrClick = useRef(false);\n  const containerRef = useRef<HTMLDivElement>(null);\n\n  const setIsDropdownOpen = (open: boolean) => {\n    if (disabled) return;\n    setIsOpen(open);\n    onToggle?.(open);\n  };\n\n  const handleTouchOrClick = () => {\n    lastInteractionWasTapOrClick.current = true;\n    setTimeout(() => (lastInteractionWasTapOrClick.current = false), 200);\n  };\n\n  const handleFocus = () => {\n    setIsFocused(true);\n    // skip touch and pointer triggered focus, this is only for keyboard and aria navigation\n    if (!lastInteractionWasTapOrClick.current) {\n      setIsDropdownOpen(true);\n    }\n  };\n\n  const toggleDropdown = () => {\n    setIsFocused(!isOpen);\n    setIsDropdownOpen(!isOpen);\n  };\n\n  const handleBlur = (e: React.FocusEvent) => {\n    if (process.env['NODE_ENV'] === 'development') {\n      return;\n    }\n    if (!containerRef.current) return;\n    if (!containerRef.current.contains(e.relatedTarget as Node)) {\n      setIsFocused(false);\n      setIsDropdownOpen(false);\n    }\n  };\n\n  const handleKeyDown = (e: React.KeyboardEvent) => {\n    if (e.key === 'Enter' || e.key === ' ') {\n      if (!isOpen) setIsDropdownOpen(true);\n      e.stopPropagation();\n    } else if (e.key === 'Escape') {\n      setIsDropdownOpen(false);\n      e.stopPropagation();\n    }\n  };\n\n  const childrenWithToggle = isValidElement(children)\n    ? React.cloneElement(children, {\n        ...(typeof children.type !== 'string' && {\n          setIsDropdownOpen,\n          menuClassName,\n        }),\n        children: enhanceMenuItems(children.props?.children, setIsDropdownOpen),\n      })\n    : children;\n\n  return (\n    <div className='dropdown-container flex'>\n      {isOpen && <Overlay onDismiss={() => setIsDropdownOpen(false)} />}\n      <div\n        ref={containerRef}\n        role='menu'\n        tabIndex={-1}\n        onBlur={handleBlur}\n        onKeyDown={handleKeyDown}\n        className={clsx('dropdown flex flex-col', className)}\n      >\n        <button\n          aria-haspopup='menu'\n          aria-expanded={isOpen}\n          aria-label={label}\n          title={label}\n          className={clsx(\n            'dropdown-toggle touch-target',\n            isFocused && isOpen && 'bg-base-300/50',\n            buttonClassName,\n          )}\n          onTouchStart={handleTouchOrClick}\n          onPointerDown={handleTouchOrClick}\n          onFocus={handleFocus}\n          onClick={toggleDropdown}\n        >\n          {toggleButton}\n        </button>\n        <div role='none' className={clsx('flex items-center justify-center')}>\n          {isOpen && childrenWithToggle}\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default Dropdown;\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AACA;;;;;;;AALA;;;;;;AAsBA,MAAM,mBAAmB,CACvB,UACA;IAEA,MAAM,cAAc,CAAC;QACnB,IAAI,eAAC,IAAA,qHAAc,EAAC,OAAO;YACzB,OAAO;QACT;QAEA,MAAM,UAAU;QAChB,MAAM,aACJ,QAAQ,IAAI,KAAK,4JAAQ,IACxB,OAAO,QAAQ,IAAI,KAAK,cAAc,QAAQ,IAAI,CAAC,IAAI,KAAK;QAE/D,MAAM,gBAAgB,2BAClB,8GAAK,CAAC,YAAY,CAAC,SAAS;YAC1B;YACA,GAAG,QAAQ,KAAK;QAClB,KACA;QAEJ,IAAI,cAAc,KAAK,EAAE,UAAU;YACjC,qBAAO,8GAAK,CAAC,YAAY,CAAC,eAAe;gBACvC,GAAG,cAAc,KAAK;gBACtB,UAAU,8GAAK,CAAC,QAAQ,CAAC,GAAG,CAAC,cAAc,KAAK,CAAC,QAAQ,EAAE;YAC7D;QACF;QAEA,OAAO;IACT;IAEA,OAAO,8GAAK,CAAC,QAAQ,CAAC,GAAG,CAAC,UAAU;AACtC;AAEA,MAAM,WAAoC,CAAC,EACzC,KAAK,EACL,SAAS,EACT,aAAa,EACb,eAAe,EACf,YAAY,EACZ,QAAQ,EACR,QAAQ,EACR,QAAQ,EACT;IACC,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,+GAAQ,EAAC;IACrC,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,+GAAQ,EAAC;IAC3C,MAAM,+BAA+B,IAAA,6GAAM,EAAC;IAC5C,MAAM,eAAe,IAAA,6GAAM,EAAiB;IAE5C,MAAM,oBAAoB,CAAC;QACzB,IAAI,UAAU;QACd,UAAU;QACV,WAAW;IACb;IAEA,MAAM,qBAAqB;QACzB,6BAA6B,OAAO,GAAG;QACvC,WAAW,IAAO,6BAA6B,OAAO,GAAG,OAAQ;IACnE;IAEA,MAAM,cAAc;QAClB,aAAa;QACb,wFAAwF;QACxF,IAAI,CAAC,6BAA6B,OAAO,EAAE;YACzC,kBAAkB;QACpB;IACF;IAEA,MAAM,iBAAiB;QACrB,aAAa,CAAC;QACd,kBAAkB,CAAC;IACrB;IAEA,MAAM,aAAa,CAAC;QAClB,wCAA+C;YAC7C;QACF;;;IAMF;IAEA,MAAM,gBAAgB,CAAC;QACrB,IAAI,EAAE,GAAG,KAAK,WAAW,EAAE,GAAG,KAAK,KAAK;YACtC,IAAI,CAAC,QAAQ,kBAAkB;YAC/B,EAAE,eAAe;QACnB,OAAO,IAAI,EAAE,GAAG,KAAK,UAAU;YAC7B,kBAAkB;YAClB,EAAE,eAAe;QACnB;IACF;IAEA,MAAM,mCAAqB,IAAA,qHAAc,EAAC,0BACtC,8GAAK,CAAC,YAAY,CAAC,UAAU;QAC3B,GAAI,OAAO,SAAS,IAAI,KAAK,YAAY;YACvC;YACA;QACF,CAAC;QACD,UAAU,iBAAiB,SAAS,KAAK,EAAE,UAAU;IACvD,KACA;IAEJ,qBACE,qKAAC;QAAI,WAAU;;YACZ,wBAAU,qKAAC,2JAAO;gBAAC,WAAW,IAAM,kBAAkB;;;;;;0BACvD,qKAAC;gBACC,KAAK;gBACL,MAAK;gBACL,UAAU,CAAC;gBACX,QAAQ;gBACR,WAAW;gBACX,WAAW,IAAA,mHAAI,EAAC,0BAA0B;;kCAE1C,qKAAC;wBACC,iBAAc;wBACd,iBAAe;wBACf,cAAY;wBACZ,OAAO;wBACP,WAAW,IAAA,mHAAI,EACb,gCACA,aAAa,UAAU,kBACvB;wBAEF,cAAc;wBACd,eAAe;wBACf,SAAS;wBACT,SAAS;kCAER;;;;;;kCAEH,qKAAC;wBAAI,MAAK;wBAAO,WAAW,IAAA,mHAAI,EAAC;kCAC9B,UAAU;;;;;;;;;;;;;;;;;;AAKrB;uCAEe"}},
    {"offset": {"line": 2772, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/components/metadata/BookDetailView.tsx"],"sourcesContent":["import clsx from 'clsx';\nimport React from 'react';\nimport {\n  MdOutlineCloudDownload,\n  MdOutlineCloudUpload,\n  MdOutlineDelete,\n  MdOutlineEdit,\n  MdSaveAlt,\n} from 'react-icons/md';\n\nimport { Book } from '@/types/book';\nimport { BookMetadata } from '@/libs/document';\nimport { useTranslation } from '@/hooks/useTranslation';\nimport {\n  formatAuthors,\n  formatDate,\n  formatBytes,\n  formatLanguage,\n  formatPublisher,\n  formatTitle,\n} from '@/utils/book';\nimport BookCover from '@/components/BookCover';\nimport Dropdown from '../Dropdown';\nimport MenuItem from '../MenuItem';\n\ninterface BookDetailViewProps {\n  book: Book;\n  metadata: BookMetadata | null;\n  fileSize: number | null;\n  onEdit?: () => void;\n  onDelete?: () => void;\n  onDeleteCloudBackup?: () => void;\n  onDeleteLocalCopy?: () => void;\n  onDownload?: () => void;\n  onUpload?: () => void;\n  onExport?: () => void;\n}\n\nconst BookDetailView: React.FC<BookDetailViewProps> = ({\n  book,\n  metadata,\n  fileSize,\n  onEdit,\n  onDelete,\n  onDeleteCloudBackup,\n  onDeleteLocalCopy,\n  onDownload,\n  onUpload,\n  onExport,\n}) => {\n  const _ = useTranslation();\n\n  return (\n    <div className='relative w-full rounded-lg'>\n      <div className='mb-6 me-4 flex h-32 items-start'>\n        <div className='me-6 aspect-[28/41] h-32 shadow-lg sm:me-10'>\n          <BookCover mode='list' book={book} />\n        </div>\n        <div className='title-author flex h-32 flex-col justify-between'>\n          <div>\n            <p className='text-base-content mb-2 line-clamp-2 break-words text-lg font-bold'>\n              {formatTitle(book.title).replace(/\\u00A0/g, ' ') || _('Untitled')}\n            </p>\n            <p className='text-neutral-content line-clamp-1'>\n              {formatAuthors(book.author, book.primaryLanguage) || _('Unknown')}\n            </p>\n          </div>\n          <div className='flex flex-nowrap items-center gap-3 sm:gap-x-4'>\n            {onEdit && (\n              <button\n                onClick={onEdit}\n                className={!metadata ? 'btn-disabled opacity-50' : ''}\n                title={_('Edit Metadata')}\n              >\n                <MdOutlineEdit className='hover:fill-blue-500' />\n              </button>\n            )}\n            {onDelete && (\n              <Dropdown\n                label={_('Delete Book Options')}\n                className='dropdown-bottom flex justify-center'\n                buttonClassName='btn btn-ghost h-8 min-h-8 w-8 p-0'\n                toggleButton={<MdOutlineDelete className='fill-red-500' />}\n              >\n                <div\n                  className={clsx(\n                    'delete-menu dropdown-content dropdown-center no-triangle',\n                    'border-base-300 !bg-base-200 z-20 mt-1 max-w-[90vw] shadow-2xl',\n                  )}\n                >\n                  <MenuItem\n                    noIcon\n                    transient\n                    label={_('Remove from Cloud & Device')}\n                    onClick={onDelete}\n                  />\n                  <MenuItem\n                    noIcon\n                    transient\n                    label={_('Remove from Cloud Only')}\n                    onClick={onDeleteCloudBackup}\n                    disabled={!book.uploadedAt}\n                  />\n                  <MenuItem\n                    noIcon\n                    transient\n                    label={_('Remove from Device Only')}\n                    onClick={onDeleteLocalCopy}\n                    disabled={!book.downloadedAt}\n                  />\n                </div>\n              </Dropdown>\n            )}\n            {book.uploadedAt && onDownload && (\n              <button onClick={onDownload} title={_('Download from Cloud')}>\n                <MdOutlineCloudDownload className='fill-base-content' />\n              </button>\n            )}\n            {book.downloadedAt && onUpload && (\n              <button onClick={onUpload} title={_('Upload to Cloud')}>\n                <MdOutlineCloudUpload className='fill-base-content' />\n              </button>\n            )}\n            {book.downloadedAt && onExport && (\n              <button onClick={onExport} title={_('Export Book')}>\n                <MdSaveAlt className='fill-base-content' />\n              </button>\n            )}\n          </div>\n        </div>\n      </div>\n\n      <div className='text-base-content my-4'>\n        <div className='mb-4 grid grid-cols-2 gap-4 sm:grid-cols-3'>\n          <div className='overflow-hidden'>\n            <span className='font-bold'>{_('Publisher')}</span>\n            <p className='text-neutral-content text-sm'>\n              {formatPublisher(metadata?.publisher || '') || _('Unknown')}\n            </p>\n          </div>\n          <div className='overflow-hidden'>\n            <span className='font-bold'>{_('Published')}</span>\n            <p className='text-neutral-content text-sm'>\n              {formatDate(metadata?.published, true) || _('Unknown')}\n            </p>\n          </div>\n          <div className='overflow-hidden'>\n            <span className='font-bold'>{_('Updated')}</span>\n            <p className='text-neutral-content text-sm'>{formatDate(book.updatedAt) || ''}</p>\n          </div>\n          <div className='overflow-hidden'>\n            <span className='font-bold'>{_('Added')}</span>\n            <p className='text-neutral-content text-sm'>{formatDate(book.createdAt) || ''}</p>\n          </div>\n          <div className='overflow-hidden'>\n            <span className='font-bold'>{_('Language')}</span>\n            <p className='text-neutral-content text-sm'>\n              {formatLanguage(metadata?.language) || _('Unknown')}\n            </p>\n          </div>\n          <div className='overflow-hidden'>\n            <span className='font-bold'>{_('Subjects')}</span>\n            <p className='text-neutral-content line-clamp-3 text-sm'>\n              {formatAuthors(metadata?.subject || '') || _('Unknown')}\n            </p>\n          </div>\n          <div className='overflow-hidden'>\n            <span className='font-bold'>{_('Format')}</span>\n            <p className='text-neutral-content text-sm'>{book.format || _('Unknown')}</p>\n          </div>\n          <div className='overflow-hidden'>\n            <span className='font-bold'>{_('File Size')}</span>\n            <p className='text-neutral-content text-sm'>{formatBytes(fileSize) || _('Unknown')}</p>\n          </div>\n        </div>\n        <div>\n          <span className='font-bold'>{_('Description')}</span>\n          <p\n            className='text-neutral-content prose prose-sm max-w-full whitespace-pre-line text-sm'\n            dangerouslySetInnerHTML={{\n              __html: metadata?.description || _('No description available'),\n            }}\n          ></p>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default BookDetailView;\n"],"names":[],"mappings":";;;;;AAAA;AAEA;AAUA;AACA;AAQA;AACA;AACA;;;;;;;;;;;;;;;;;;AAeA,MAAM,iBAAgD,CAAC,EACrD,IAAI,EACJ,QAAQ,EACR,QAAQ,EACR,MAAM,EACN,QAAQ,EACR,mBAAmB,EACnB,iBAAiB,EACjB,UAAU,EACV,QAAQ,EACR,QAAQ,EACT;IACC,MAAM,IAAI,IAAA,mKAAc;IAExB,qBACE,qKAAC;QAAI,WAAU;;0BACb,qKAAC;gBAAI,WAAU;;kCACb,qKAAC;wBAAI,WAAU;kCACb,cAAA,qKAAC,6JAAS;4BAAC,MAAK;4BAAO,MAAM;;;;;;;;;;;kCAE/B,qKAAC;wBAAI,WAAU;;0CACb,qKAAC;;kDACC,qKAAC;wCAAE,WAAU;kDACV,IAAA,sJAAW,EAAC,KAAK,KAAK,EAAE,OAAO,CAAC,WAAW,QAAQ,EAAE;;;;;;kDAExD,qKAAC;wCAAE,WAAU;kDACV,IAAA,wJAAa,EAAC,KAAK,MAAM,EAAE,KAAK,eAAe,KAAK,EAAE;;;;;;;;;;;;0CAG3D,qKAAC;gCAAI,WAAU;;oCACZ,wBACC,qKAAC;wCACC,SAAS;wCACT,WAAW,CAAC,WAAW,4BAA4B;wCACnD,OAAO,EAAE;kDAET,cAAA,qKAAC,yOAAa;4CAAC,WAAU;;;;;;;;;;;oCAG5B,0BACC,qKAAC,4JAAQ;wCACP,OAAO,EAAE;wCACT,WAAU;wCACV,iBAAgB;wCAChB,4BAAc,qKAAC,2OAAe;4CAAC,WAAU;;;;;;kDAEzC,cAAA,qKAAC;4CACC,WAAW,IAAA,mHAAI,EACb,4DACA;;8DAGF,qKAAC,4JAAQ;oDACP,MAAM;oDACN,SAAS;oDACT,OAAO,EAAE;oDACT,SAAS;;;;;;8DAEX,qKAAC,4JAAQ;oDACP,MAAM;oDACN,SAAS;oDACT,OAAO,EAAE;oDACT,SAAS;oDACT,UAAU,CAAC,KAAK,UAAU;;;;;;8DAE5B,qKAAC,4JAAQ;oDACP,MAAM;oDACN,SAAS;oDACT,OAAO,EAAE;oDACT,SAAS;oDACT,UAAU,CAAC,KAAK,YAAY;;;;;;;;;;;;;;;;;oCAKnC,KAAK,UAAU,IAAI,4BAClB,qKAAC;wCAAO,SAAS;wCAAY,OAAO,EAAE;kDACpC,cAAA,qKAAC,kPAAsB;4CAAC,WAAU;;;;;;;;;;;oCAGrC,KAAK,YAAY,IAAI,0BACpB,qKAAC;wCAAO,SAAS;wCAAU,OAAO,EAAE;kDAClC,cAAA,qKAAC,gPAAoB;4CAAC,WAAU;;;;;;;;;;;oCAGnC,KAAK,YAAY,IAAI,0BACpB,qKAAC;wCAAO,SAAS;wCAAU,OAAO,EAAE;kDAClC,cAAA,qKAAC,qOAAS;4CAAC,WAAU;;;;;;;;;;;;;;;;;;;;;;;;;;;;;0BAO/B,qKAAC;gBAAI,WAAU;;kCACb,qKAAC;wBAAI,WAAU;;0CACb,qKAAC;gCAAI,WAAU;;kDACb,qKAAC;wCAAK,WAAU;kDAAa,EAAE;;;;;;kDAC/B,qKAAC;wCAAE,WAAU;kDACV,IAAA,0JAAe,EAAC,UAAU,aAAa,OAAO,EAAE;;;;;;;;;;;;0CAGrD,qKAAC;gCAAI,WAAU;;kDACb,qKAAC;wCAAK,WAAU;kDAAa,EAAE;;;;;;kDAC/B,qKAAC;wCAAE,WAAU;kDACV,IAAA,qJAAU,EAAC,UAAU,WAAW,SAAS,EAAE;;;;;;;;;;;;0CAGhD,qKAAC;gCAAI,WAAU;;kDACb,qKAAC;wCAAK,WAAU;kDAAa,EAAE;;;;;;kDAC/B,qKAAC;wCAAE,WAAU;kDAAgC,IAAA,qJAAU,EAAC,KAAK,SAAS,KAAK;;;;;;;;;;;;0CAE7E,qKAAC;gCAAI,WAAU;;kDACb,qKAAC;wCAAK,WAAU;kDAAa,EAAE;;;;;;kDAC/B,qKAAC;wCAAE,WAAU;kDAAgC,IAAA,qJAAU,EAAC,KAAK,SAAS,KAAK;;;;;;;;;;;;0CAE7E,qKAAC;gCAAI,WAAU;;kDACb,qKAAC;wCAAK,WAAU;kDAAa,EAAE;;;;;;kDAC/B,qKAAC;wCAAE,WAAU;kDACV,IAAA,yJAAc,EAAC,UAAU,aAAa,EAAE;;;;;;;;;;;;0CAG7C,qKAAC;gCAAI,WAAU;;kDACb,qKAAC;wCAAK,WAAU;kDAAa,EAAE;;;;;;kDAC/B,qKAAC;wCAAE,WAAU;kDACV,IAAA,wJAAa,EAAC,UAAU,WAAW,OAAO,EAAE;;;;;;;;;;;;0CAGjD,qKAAC;gCAAI,WAAU;;kDACb,qKAAC;wCAAK,WAAU;kDAAa,EAAE;;;;;;kDAC/B,qKAAC;wCAAE,WAAU;kDAAgC,KAAK,MAAM,IAAI,EAAE;;;;;;;;;;;;0CAEhE,qKAAC;gCAAI,WAAU;;kDACb,qKAAC;wCAAK,WAAU;kDAAa,EAAE;;;;;;kDAC/B,qKAAC;wCAAE,WAAU;kDAAgC,IAAA,sJAAW,EAAC,aAAa,EAAE;;;;;;;;;;;;;;;;;;kCAG5E,qKAAC;;0CACC,qKAAC;gCAAK,WAAU;0CAAa,EAAE;;;;;;0CAC/B,qKAAC;gCACC,WAAU;gCACV,yBAAyB;oCACvB,QAAQ,UAAU,eAAe,EAAE;gCACrC;;;;;;;;;;;;;;;;;;;;;;;;AAMZ;uCAEe"}},
    {"offset": {"line": 3249, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/components/metadata/FormField.tsx"],"sourcesContent":["import React from 'react';\nimport clsx from 'clsx';\nimport { MdOutlineInfo, MdLock, MdLockOpen, MdError } from 'react-icons/md';\nimport { useTranslation } from '@/hooks/useTranslation';\n\nconst inputBaseStyles =\n  'w-full rounded-md px-3 py-2 focus:outline-none focus:ring-1 focus:ring-blue-500';\nconst inputBackgroundStyles = 'bg-base-200/50';\nconst labelStyles = 'text-base-content block text-sm font-medium';\n\ninterface SourceIndicatorProps {\n  source?: string;\n}\n\nconst SourceIndicator: React.FC<SourceIndicatorProps> = ({ source }) => {\n  if (!source) return null;\n\n  const [sourceName, confidence] = source.split('-');\n  const confidenceNum = parseInt(confidence!);\n\n  let color = 'text-green-500';\n  if (confidenceNum < 90) color = 'text-yellow-500';\n  if (confidenceNum < 70) color = 'text-red-500';\n\n  return (\n    <div className='flex items-center justify-end gap-1 text-xs'>\n      <MdOutlineInfo className={clsx('h-3 w-3', color)} />\n      <span className={clsx('capitalize', color)}>\n        {sourceName} ({confidence}%)\n      </span>\n    </div>\n  );\n};\n\ninterface LockButtonProps {\n  isLocked: boolean;\n  onToggle: () => void;\n  disabled?: boolean;\n}\n\nconst LockButton: React.FC<LockButtonProps> = ({ isLocked, onToggle, disabled = false }) => {\n  return (\n    <button\n      type='button'\n      onClick={onToggle}\n      disabled={disabled}\n      className={clsx(\n        'focus:outline-non absolute right-2 top-1/2 -translate-y-1/2 rounded p-1 transition-colors',\n        disabled && 'cursor-not-allowed opacity-50',\n        isLocked ? 'bg-green-100 text-green-500 hover:bg-green-200' : 'text-base-content',\n      )}\n      title={isLocked ? 'Unlock field' : 'Lock field'}\n    >\n      {isLocked ? <MdLock className='h-4 w-4' /> : <MdLockOpen className='h-4 w-4' />}\n    </button>\n  );\n};\n\ninterface FormFieldProps {\n  type?: 'input' | 'textarea';\n  field: string;\n  label: string;\n  isNumber?: boolean;\n  required?: boolean;\n  disabled?: boolean;\n  lockable?: boolean;\n  fieldSources: Record<string, string>;\n  lockedFields: Record<string, boolean>;\n  fieldErrors: Record<string, string>;\n  onToggleFieldLock: (field: string) => void;\n\n  value: string;\n  onFieldChange: (field: string, value: string) => void;\n  placeholder?: string;\n  rows?: number;\n  className?: string;\n}\n\nconst FormField: React.FC<FormFieldProps> = ({\n  type = 'input',\n  field,\n  label,\n  fieldSources,\n  lockedFields,\n  fieldErrors,\n  isNumber = false,\n  required = false,\n  lockable = true,\n  disabled = false,\n  onToggleFieldLock,\n\n  value,\n  onFieldChange,\n  placeholder,\n  rows,\n  className,\n}) => {\n  const _ = useTranslation();\n  const isLocked = lockedFields[field]!;\n  const source = fieldSources[field]!;\n  const error = fieldErrors[field]!;\n\n  return (\n    <div className='flex flex-col gap-1'>\n      <div className={clsx(labelStyles, 'flex items-center justify-between')}>\n        <span>\n          {label} {required && '*'}\n        </span>\n        {isLocked && (\n          <span className='flex items-center gap-1 text-xs text-green-500'>\n            <MdLock className='h-3 w-3' />\n            {_('Locked')}\n          </span>\n        )}\n      </div>\n      <div className='relative'>\n        {type === 'input' ? (\n          <input\n            type={isNumber ? 'number' : 'text'}\n            min={1}\n            value={value}\n            onChange={(e) => onFieldChange(field, e.target.value)}\n            placeholder={isLocked ? '' : placeholder}\n            disabled={disabled || isLocked}\n            className={clsx(\n              inputBaseStyles,\n              inputBackgroundStyles,\n              lockable && 'pe-10',\n              isLocked ? 'cursor-not-allowed' : 'bg-gray-100 text-gray-500',\n              error && 'border-red-500 focus:ring-red-500',\n              className,\n            )}\n          />\n        ) : (\n          <textarea\n            value={value}\n            onChange={(e) => onFieldChange(field, e.target.value)}\n            placeholder={isLocked ? '' : placeholder}\n            rows={rows || 4}\n            disabled={disabled || isLocked}\n            className={clsx(\n              inputBaseStyles,\n              inputBackgroundStyles,\n              lockable && 'pe-10',\n              isLocked ? 'cursor-not-allowed' : 'bg-gray-100 text-gray-500',\n              error && 'border-red-500 focus:ring-red-500',\n              className,\n            )}\n          />\n        )}\n        {lockable && <LockButton isLocked={isLocked} onToggle={() => onToggleFieldLock(field)} />}\n      </div>\n      {error && (\n        <div className='flex items-center gap-1 text-xs text-red-600'>\n          <MdError className='h-3 w-3' />\n          <span>{error}</span>\n        </div>\n      )}\n      {!error && <SourceIndicator source={source} />}\n    </div>\n  );\n};\n\nexport { FormField, SourceIndicator };\n"],"names":[],"mappings":";;;;;;;AACA;AACA;AACA;;;;;;;;;;AAEA,MAAM,kBACJ;AACF,MAAM,wBAAwB;AAC9B,MAAM,cAAc;AAMpB,MAAM,kBAAkD,CAAC,EAAE,MAAM,EAAE;IACjE,IAAI,CAAC,QAAQ,OAAO;IAEpB,MAAM,CAAC,YAAY,WAAW,GAAG,OAAO,KAAK,CAAC;IAC9C,MAAM,gBAAgB,SAAS;IAE/B,IAAI,QAAQ;IACZ,IAAI,gBAAgB,IAAI,QAAQ;IAChC,IAAI,gBAAgB,IAAI,QAAQ;IAEhC,qBACE,qKAAC;QAAI,WAAU;;0BACb,qKAAC,yOAAa;gBAAC,WAAW,IAAA,mHAAI,EAAC,WAAW;;;;;;0BAC1C,qKAAC;gBAAK,WAAW,IAAA,mHAAI,EAAC,cAAc;;oBACjC;oBAAW;oBAAG;oBAAW;;;;;;;;;;;;;AAIlC;AAQA,MAAM,aAAwC,CAAC,EAAE,QAAQ,EAAE,QAAQ,EAAE,WAAW,KAAK,EAAE;IACrF,qBACE,qKAAC;QACC,MAAK;QACL,SAAS;QACT,UAAU;QACV,WAAW,IAAA,mHAAI,EACb,6FACA,YAAY,iCACZ,WAAW,mDAAmD;QAEhE,OAAO,WAAW,iBAAiB;kBAElC,yBAAW,qKAAC,kOAAM;YAAC,WAAU;;;;;qEAAe,qKAAC,sOAAU;YAAC,WAAU;;;;;;;;;;;AAGzE;AAsBA,MAAM,YAAsC,CAAC,EAC3C,OAAO,OAAO,EACd,KAAK,EACL,KAAK,EACL,YAAY,EACZ,YAAY,EACZ,WAAW,EACX,WAAW,KAAK,EAChB,WAAW,KAAK,EAChB,WAAW,IAAI,EACf,WAAW,KAAK,EAChB,iBAAiB,EAEjB,KAAK,EACL,aAAa,EACb,WAAW,EACX,IAAI,EACJ,SAAS,EACV;IACC,MAAM,IAAI,IAAA,mKAAc;IACxB,MAAM,WAAW,YAAY,CAAC,MAAM;IACpC,MAAM,SAAS,YAAY,CAAC,MAAM;IAClC,MAAM,QAAQ,WAAW,CAAC,MAAM;IAEhC,qBACE,qKAAC;QAAI,WAAU;;0BACb,qKAAC;gBAAI,WAAW,IAAA,mHAAI,EAAC,aAAa;;kCAChC,qKAAC;;4BACE;4BAAM;4BAAE,YAAY;;;;;;;oBAEtB,0BACC,qKAAC;wBAAK,WAAU;;0CACd,qKAAC,kOAAM;gCAAC,WAAU;;;;;;4BACjB,EAAE;;;;;;;;;;;;;0BAIT,qKAAC;gBAAI,WAAU;;oBACZ,SAAS,wBACR,qKAAC;wBACC,MAAM,WAAW,WAAW;wBAC5B,KAAK;wBACL,OAAO;wBACP,UAAU,CAAC,IAAM,cAAc,OAAO,EAAE,MAAM,CAAC,KAAK;wBACpD,aAAa,WAAW,KAAK;wBAC7B,UAAU,YAAY;wBACtB,WAAW,IAAA,mHAAI,EACb,iBACA,uBACA,YAAY,SACZ,WAAW,uBAAuB,6BAClC,SAAS,qCACT;;;;;iFAIJ,qKAAC;wBACC,OAAO;wBACP,UAAU,CAAC,IAAM,cAAc,OAAO,EAAE,MAAM,CAAC,KAAK;wBACpD,aAAa,WAAW,KAAK;wBAC7B,MAAM,QAAQ;wBACd,UAAU,YAAY;wBACtB,WAAW,IAAA,mHAAI,EACb,iBACA,uBACA,YAAY,SACZ,WAAW,uBAAuB,6BAClC,SAAS,qCACT;;;;;;oBAIL,0BAAY,qKAAC;wBAAW,UAAU;wBAAU,UAAU,IAAM,kBAAkB;;;;;;;;;;;;YAEhF,uBACC,qKAAC;gBAAI,WAAU;;kCACb,qKAAC,mOAAO;wBAAC,WAAU;;;;;;kCACnB,qKAAC;kCAAM;;;;;;;;;;;;YAGV,CAAC,uBAAS,qKAAC;gBAAgB,QAAQ;;;;;;;;;;;;AAG1C"}},
    {"offset": {"line": 3465, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/components/metadata/BookDetailEdit.tsx"],"sourcesContent":["'use client';\n\nimport clsx from 'clsx';\nimport React, { useState } from 'react';\nimport { MdEdit, MdDelete, MdLock, MdLockOpen, MdOutlineSearch } from 'react-icons/md';\n\nimport { Book } from '@/types/book';\nimport { BookMetadata } from '@/libs/document';\nimport { useEnv } from '@/context/EnvContext';\nimport { useTranslation } from '@/hooks/useTranslation';\nimport { flattenContributors, formatAuthors, formatPublisher, formatTitle } from '@/utils/book';\nimport { useFileSelector } from '@/hooks/useFileSelector';\nimport { FormField } from './FormField';\nimport BookCover from '@/components/BookCover';\n\ninterface BookDetailEditProps {\n  book: Book;\n  metadata: BookMetadata;\n  fieldSources: Record<string, string>;\n  lockedFields: Record<string, boolean>;\n  fieldErrors: Record<string, string>;\n  searchLoading: boolean;\n  onFieldChange: (field: string, value: string | undefined) => void;\n  onToggleFieldLock: (field: string) => void;\n  onAutoRetrieve: () => void;\n  onLockAll: () => void;\n  onUnlockAll: () => void;\n  onCancel: () => void;\n  onReset: () => void;\n  onSave: () => void;\n}\n\nconst emptyCoverImageUrl = '_blank';\n\nconst BookDetailEdit: React.FC<BookDetailEditProps> = ({\n  book,\n  metadata,\n  fieldSources,\n  lockedFields,\n  fieldErrors,\n  searchLoading,\n  onFieldChange,\n  onToggleFieldLock,\n  onAutoRetrieve,\n  onLockAll,\n  onUnlockAll,\n  onCancel,\n  onReset,\n  onSave,\n}) => {\n  const _ = useTranslation();\n  const { appService } = useEnv();\n  const { selectFiles } = useFileSelector(appService, _);\n\n  const hasLockedFields = Object.values(lockedFields).some((locked) => locked);\n  const allFieldsLocked = Object.values(lockedFields).every((locked) => locked);\n  const isCoverLocked = lockedFields['coverImageUrl'] || false;\n  const coverImageUrl = metadata.coverImageUrl || null;\n  const [newCoverImageUrl, setNewCoverImageUrl] = useState<string | null>(coverImageUrl);\n\n  const titleAuthorFields = [\n    {\n      field: 'title',\n      label: _('Title'),\n      required: true,\n      value: formatTitle(metadata.title),\n      placeholder: _('Enter book title'),\n    },\n    {\n      field: 'subtitle',\n      label: _('Subtitle'),\n      required: false,\n      value: formatTitle(metadata.subtitle || ''),\n      placeholder: _('Enter book subtitle'),\n    },\n    {\n      field: 'author',\n      label: _('Author'),\n      required: true,\n      value: formatAuthors(metadata.author),\n      placeholder: _('Enter author name'),\n    },\n  ];\n\n  const metadataGridFields = [\n    {\n      field: 'series',\n      label: _('Series'),\n      value: metadata.series || '',\n      placeholder: _('Enter series name'),\n    },\n    {\n      field: 'seriesIndex',\n      label: _('Series Index'),\n      isNumber: true,\n      value: String(metadata.seriesIndex || ''),\n      placeholder: _('Enter series index'),\n    },\n    {\n      field: 'seriesTotal',\n      label: _('Total in Series'),\n      isNumber: true,\n      value: String(metadata.seriesTotal || ''),\n      placeholder: _('Enter total books in series'),\n    },\n    {\n      field: 'publisher',\n      label: _('Publisher'),\n      value: formatPublisher(metadata.publisher || ''),\n      placeholder: _('Enter publisher'),\n    },\n    {\n      field: 'published',\n      label: _('Publication Date'),\n      value: metadata.published || '',\n      placeholder: _('YYYY or YYYY-MM-DD'),\n    },\n    {\n      field: 'language',\n      label: _('Language'),\n      value: Array.isArray(metadata.language)\n        ? metadata.language.join(', ')\n        : metadata.language || '',\n      placeholder: 'en, zh, fr',\n    },\n    {\n      field: 'identifier',\n      label: _('Identifier'),\n      value: metadata.identifier || '',\n      placeholder: '978-0123456789',\n    },\n  ];\n  const metadataFullwidthFields = [\n    {\n      field: 'subject',\n      label: _('Subjects'),\n      value: flattenContributors(metadata.subject || []),\n      placeholder: _('Fiction, Science, History'),\n    },\n    {\n      field: 'description',\n      label: _('Description'),\n      type: 'textarea',\n      rows: 4,\n      value: metadata.description || '',\n      placeholder: _('Enter book description'),\n    },\n  ];\n\n  const handleSelectLocalImage = async () => {\n    selectFiles({ type: 'covers', multiple: false }).then(async (result) => {\n      if (result.error || result.files.length === 0) return;\n      const selectedFile = result.files[0]!;\n      if (selectedFile.path && appService) {\n        const filePath = selectedFile.path;\n        const imageUrl = await appService.getCachedImageUrl(filePath);\n        onFieldChange('coverImageFile', filePath);\n        onFieldChange('coverImageUrl', imageUrl);\n        setNewCoverImageUrl(imageUrl);\n      } else if (selectedFile.file) {\n        const coverImageBlobUrl = URL.createObjectURL(selectedFile.file);\n        onFieldChange('coverImageBlobUrl', coverImageBlobUrl);\n        setNewCoverImageUrl(coverImageBlobUrl);\n      }\n    });\n  };\n\n  return (\n    <div className='bg-base-100 relative w-full rounded-lg'>\n      <div className='mb-6 flex items-stretch gap-4'>\n        <div className='cover-field flex w-[30%] max-w-32 flex-col gap-2'>\n          <button\n            className='aspect-[28/41] h-full shadow-md'\n            onClick={!isCoverLocked ? handleSelectLocalImage : undefined}\n          >\n            <BookCover\n              mode='list'\n              book={{\n                ...book,\n                metadata: {\n                  ...metadata,\n                  coverImageUrl: newCoverImageUrl || metadata.coverImageUrl,\n                },\n                ...(newCoverImageUrl ? { coverImageUrl: newCoverImageUrl } : {}),\n              }}\n            />\n          </button>\n          <div className='flex w-full justify-between gap-1'>\n            <button\n              onClick={handleSelectLocalImage}\n              disabled={isCoverLocked}\n              className={clsx(\n                'flex w-1/2 min-w-0 items-center justify-center gap-1 rounded p-1 sm:w-3/5',\n                'text-sm hover:bg-gray-50 disabled:cursor-not-allowed disabled:opacity-50 sm:text-xs',\n                isCoverLocked ? '!text-base-content bg-base-200' : 'bg-gray-100 !text-gray-500',\n              )}\n              title={_('Change cover image')}\n            >\n              <MdEdit\n                className={clsx(\n                  'h-5 w-5 flex-shrink-0 sm:h-4 sm:w-4',\n                  isCoverLocked ? 'fill-base-content' : 'fill-gray-600',\n                )}\n              />\n              <span className='hidden truncate sm:inline'>{_('Replace')}</span>\n            </button>\n\n            <button\n              onClick={() => {\n                setNewCoverImageUrl(emptyCoverImageUrl);\n                onFieldChange('coverImageUrl', emptyCoverImageUrl);\n                onFieldChange('coverImageFile', undefined);\n                onFieldChange('coverImageBlobUrl', undefined);\n              }}\n              disabled={isCoverLocked}\n              className={clsx(\n                'flex w-1/4 items-center justify-center rounded p-1 sm:w-1/5',\n                'disabled:cursor-not-allowed disabled:opacity-50',\n                'text-red-500 hover:bg-red-50 hover:text-red-600',\n                isCoverLocked ? '!text-base-content bg-base-200' : 'bg-gray-100',\n              )}\n              title={_('Remove cover image')}\n            >\n              <MdDelete className='h-5 w-5 sm:h-4 sm:w-4' />\n            </button>\n\n            <button\n              onClick={() => onToggleFieldLock('coverImageUrl')}\n              className={clsx(\n                'flex w-1/4 items-center justify-center rounded p-1 hover:bg-gray-50 sm:w-1/5',\n                isCoverLocked\n                  ? 'bg-green-100 text-green-500 hover:bg-green-200'\n                  : 'bg-gray-100 text-gray-500',\n              )}\n              title={isCoverLocked ? _('Unlock cover') : _('Lock cover')}\n            >\n              {isCoverLocked ? (\n                <MdLock className='h-5 w-5 sm:h-4 sm:w-4' />\n              ) : (\n                <MdLockOpen className='h-5 w-5 sm:h-4 sm:w-4' />\n              )}\n            </button>\n          </div>\n        </div>\n        <div className='title-fields flex flex-1 flex-col justify-between'>\n          {titleAuthorFields.map(({ field, label, required, value, placeholder }) => (\n            <FormField\n              key={field}\n              field={field}\n              label={label}\n              required={required}\n              value={value}\n              onFieldChange={onFieldChange}\n              fieldSources={fieldSources}\n              lockedFields={lockedFields}\n              fieldErrors={fieldErrors}\n              onToggleFieldLock={onToggleFieldLock}\n              placeholder={placeholder}\n            />\n          ))}\n        </div>\n      </div>\n\n      {/* Metadata Fields Grid */}\n      <div className='mb-6 space-y-4'>\n        <div className='grid grid-cols-1 gap-4 sm:grid-cols-2'>\n          {metadataGridFields.map(({ field, label, value, isNumber, placeholder }) => (\n            <FormField\n              key={field}\n              field={field}\n              label={label}\n              value={value}\n              isNumber={isNumber}\n              onFieldChange={onFieldChange}\n              fieldSources={fieldSources}\n              lockedFields={lockedFields}\n              fieldErrors={fieldErrors}\n              onToggleFieldLock={onToggleFieldLock}\n              placeholder={placeholder}\n            />\n          ))}\n        </div>\n\n        {metadataFullwidthFields.map(\n          ({ field, label, type = 'input', rows, value, placeholder }) => (\n            <FormField\n              key={field}\n              field={field}\n              label={label}\n              type={type as 'input' | 'textarea'}\n              rows={rows}\n              value={value}\n              onFieldChange={onFieldChange}\n              fieldSources={fieldSources}\n              lockedFields={lockedFields}\n              fieldErrors={fieldErrors}\n              onToggleFieldLock={onToggleFieldLock}\n              placeholder={placeholder}\n            />\n          ),\n        )}\n      </div>\n\n      {/* Action Buttons */}\n      <div className='flex flex-col items-center justify-between gap-4'>\n        <div className='flex w-full items-center gap-2'>\n          <button\n            onClick={onAutoRetrieve}\n            disabled={searchLoading}\n            className='flex items-center gap-2 rounded-md bg-blue-500 px-4 py-2 text-sm text-white hover:bg-blue-600 disabled:opacity-50'\n            title={_('Auto-Retrieve Metadata')}\n          >\n            {searchLoading ? (\n              <span className='loading loading-spinner h-4 w-4'></span>\n            ) : (\n              <MdOutlineSearch className='mt-[1px] h-4 w-4' />\n            )}\n            <span className='sm:hidden'>{_('Auto')}</span>\n            <span className='hidden sm:inline'>{_('Auto-Retrieve')}</span>\n          </button>\n\n          {/* Lock/Unlock All Buttons */}\n          <div className='flex items-center gap-1 border-l border-gray-300 pl-2'>\n            <button\n              onClick={onUnlockAll}\n              disabled={!hasLockedFields}\n              className={clsx(\n                'hover:bg-base-200 flex items-center gap-1 rounded px-2 py-1 text-sm',\n                'disabled:cursor-not-allowed disabled:opacity-80',\n                'text-yellow-600 hover:text-yellow-700',\n              )}\n              title={_('Unlock all fields')}\n            >\n              <MdLockOpen className='h-3 w-3' />\n              {_('Unlock All')}\n            </button>\n            <button\n              onClick={onLockAll}\n              disabled={allFieldsLocked}\n              className={clsx(\n                'hover:bg-base-200 flex items-center gap-1 rounded px-2 py-1 text-sm',\n                'disabled:cursor-not-allowed disabled:opacity-80',\n                'text-green-600 hover:text-green-700',\n              )}\n              title={_('Lock all fields')}\n            >\n              <MdLock className='h-3 w-3' />\n              {_('Lock All')}\n            </button>\n          </div>\n        </div>\n\n        <div className='flex w-full justify-end gap-4'>\n          <button\n            onClick={onCancel}\n            className='hover:bg-base-200 rounded-md border-neutral-300 px-4 py-2'\n          >\n            {_('Cancel')}\n          </button>\n          <button\n            onClick={onReset}\n            className='hover:bg-base-200 rounded-md border-neutral-300 px-4 py-2'\n          >\n            {_('Reset')}\n          </button>\n          <button\n            onClick={onSave}\n            disabled={fieldErrors && Object.keys(fieldErrors).length > 0}\n            className='rounded-md bg-green-500 px-4 py-2 text-white hover:bg-green-600 disabled:opacity-50'\n          >\n            {_('Save')}\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default BookDetailEdit;\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AAIA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;AAbA;;;;;;;;;;;AAgCA,MAAM,qBAAqB;AAE3B,MAAM,iBAAgD,CAAC,EACrD,IAAI,EACJ,QAAQ,EACR,YAAY,EACZ,YAAY,EACZ,WAAW,EACX,aAAa,EACb,aAAa,EACb,iBAAiB,EACjB,cAAc,EACd,SAAS,EACT,WAAW,EACX,QAAQ,EACR,OAAO,EACP,MAAM,EACP;IACC,MAAM,IAAI,IAAA,mKAAc;IACxB,MAAM,EAAE,UAAU,EAAE,GAAG,IAAA,0JAAM;IAC7B,MAAM,EAAE,WAAW,EAAE,GAAG,IAAA,qKAAe,EAAC,YAAY;IAEpD,MAAM,kBAAkB,OAAO,MAAM,CAAC,cAAc,IAAI,CAAC,CAAC,SAAW;IACrE,MAAM,kBAAkB,OAAO,MAAM,CAAC,cAAc,KAAK,CAAC,CAAC,SAAW;IACtE,MAAM,gBAAgB,YAAY,CAAC,gBAAgB,IAAI;IACvD,MAAM,gBAAgB,SAAS,aAAa,IAAI;IAChD,MAAM,CAAC,kBAAkB,oBAAoB,GAAG,IAAA,+GAAQ,EAAgB;IAExE,MAAM,oBAAoB;QACxB;YACE,OAAO;YACP,OAAO,EAAE;YACT,UAAU;YACV,OAAO,IAAA,sJAAW,EAAC,SAAS,KAAK;YACjC,aAAa,EAAE;QACjB;QACA;YACE,OAAO;YACP,OAAO,EAAE;YACT,UAAU;YACV,OAAO,IAAA,sJAAW,EAAC,SAAS,QAAQ,IAAI;YACxC,aAAa,EAAE;QACjB;QACA;YACE,OAAO;YACP,OAAO,EAAE;YACT,UAAU;YACV,OAAO,IAAA,wJAAa,EAAC,SAAS,MAAM;YACpC,aAAa,EAAE;QACjB;KACD;IAED,MAAM,qBAAqB;QACzB;YACE,OAAO;YACP,OAAO,EAAE;YACT,OAAO,SAAS,MAAM,IAAI;YAC1B,aAAa,EAAE;QACjB;QACA;YACE,OAAO;YACP,OAAO,EAAE;YACT,UAAU;YACV,OAAO,OAAO,SAAS,WAAW,IAAI;YACtC,aAAa,EAAE;QACjB;QACA;YACE,OAAO;YACP,OAAO,EAAE;YACT,UAAU;YACV,OAAO,OAAO,SAAS,WAAW,IAAI;YACtC,aAAa,EAAE;QACjB;QACA;YACE,OAAO;YACP,OAAO,EAAE;YACT,OAAO,IAAA,0JAAe,EAAC,SAAS,SAAS,IAAI;YAC7C,aAAa,EAAE;QACjB;QACA;YACE,OAAO;YACP,OAAO,EAAE;YACT,OAAO,SAAS,SAAS,IAAI;YAC7B,aAAa,EAAE;QACjB;QACA;YACE,OAAO;YACP,OAAO,EAAE;YACT,OAAO,MAAM,OAAO,CAAC,SAAS,QAAQ,IAClC,SAAS,QAAQ,CAAC,IAAI,CAAC,QACvB,SAAS,QAAQ,IAAI;YACzB,aAAa;QACf;QACA;YACE,OAAO;YACP,OAAO,EAAE;YACT,OAAO,SAAS,UAAU,IAAI;YAC9B,aAAa;QACf;KACD;IACD,MAAM,0BAA0B;QAC9B;YACE,OAAO;YACP,OAAO,EAAE;YACT,OAAO,IAAA,8JAAmB,EAAC,SAAS,OAAO,IAAI,EAAE;YACjD,aAAa,EAAE;QACjB;QACA;YACE,OAAO;YACP,OAAO,EAAE;YACT,MAAM;YACN,MAAM;YACN,OAAO,SAAS,WAAW,IAAI;YAC/B,aAAa,EAAE;QACjB;KACD;IAED,MAAM,yBAAyB;QAC7B,YAAY;YAAE,MAAM;YAAU,UAAU;QAAM,GAAG,IAAI,CAAC,OAAO;YAC3D,IAAI,OAAO,KAAK,IAAI,OAAO,KAAK,CAAC,MAAM,KAAK,GAAG;YAC/C,MAAM,eAAe,OAAO,KAAK,CAAC,EAAE;YACpC,IAAI,aAAa,IAAI,IAAI,YAAY;gBACnC,MAAM,WAAW,aAAa,IAAI;gBAClC,MAAM,WAAW,MAAM,WAAW,iBAAiB,CAAC;gBACpD,cAAc,kBAAkB;gBAChC,cAAc,iBAAiB;gBAC/B,oBAAoB;YACtB,OAAO,IAAI,aAAa,IAAI,EAAE;gBAC5B,MAAM,oBAAoB,IAAI,eAAe,CAAC,aAAa,IAAI;gBAC/D,cAAc,qBAAqB;gBACnC,oBAAoB;YACtB;QACF;IACF;IAEA,qBACE,qKAAC;QAAI,WAAU;;0BACb,qKAAC;gBAAI,WAAU;;kCACb,qKAAC;wBAAI,WAAU;;0CACb,qKAAC;gCACC,WAAU;gCACV,SAAS,CAAC,gBAAgB,yBAAyB;0CAEnD,cAAA,qKAAC,6JAAS;oCACR,MAAK;oCACL,MAAM;wCACJ,GAAG,IAAI;wCACP,UAAU;4CACR,GAAG,QAAQ;4CACX,eAAe,oBAAoB,SAAS,aAAa;wCAC3D;wCACA,GAAI,mBAAmB;4CAAE,eAAe;wCAAiB,IAAI,CAAC,CAAC;oCACjE;;;;;;;;;;;0CAGJ,qKAAC;gCAAI,WAAU;;kDACb,qKAAC;wCACC,SAAS;wCACT,UAAU;wCACV,WAAW,IAAA,mHAAI,EACb,6EACA,uFACA,gBAAgB,mCAAmC;wCAErD,OAAO,EAAE;;0DAET,qKAAC,kOAAM;gDACL,WAAW,IAAA,mHAAI,EACb,uCACA,gBAAgB,sBAAsB;;;;;;0DAG1C,qKAAC;gDAAK,WAAU;0DAA6B,EAAE;;;;;;;;;;;;kDAGjD,qKAAC;wCACC,SAAS;4CACP,oBAAoB;4CACpB,cAAc,iBAAiB;4CAC/B,cAAc,kBAAkB;4CAChC,cAAc,qBAAqB;wCACrC;wCACA,UAAU;wCACV,WAAW,IAAA,mHAAI,EACb,+DACA,mDACA,mDACA,gBAAgB,mCAAmC;wCAErD,OAAO,EAAE;kDAET,cAAA,qKAAC,oOAAQ;4CAAC,WAAU;;;;;;;;;;;kDAGtB,qKAAC;wCACC,SAAS,IAAM,kBAAkB;wCACjC,WAAW,IAAA,mHAAI,EACb,gFACA,gBACI,mDACA;wCAEN,OAAO,gBAAgB,EAAE,kBAAkB,EAAE;kDAE5C,8BACC,qKAAC,kOAAM;4CAAC,WAAU;;;;;qGAElB,qKAAC,sOAAU;4CAAC,WAAU;;;;;;;;;;;;;;;;;;;;;;;kCAK9B,qKAAC;wBAAI,WAAU;kCACZ,kBAAkB,GAAG,CAAC,CAAC,EAAE,KAAK,EAAE,KAAK,EAAE,QAAQ,EAAE,KAAK,EAAE,WAAW,EAAE,iBACpE,qKAAC,2KAAS;gCAER,OAAO;gCACP,OAAO;gCACP,UAAU;gCACV,OAAO;gCACP,eAAe;gCACf,cAAc;gCACd,cAAc;gCACd,aAAa;gCACb,mBAAmB;gCACnB,aAAa;+BAVR;;;;;;;;;;;;;;;;0BAiBb,qKAAC;gBAAI,WAAU;;kCACb,qKAAC;wBAAI,WAAU;kCACZ,mBAAmB,GAAG,CAAC,CAAC,EAAE,KAAK,EAAE,KAAK,EAAE,KAAK,EAAE,QAAQ,EAAE,WAAW,EAAE,iBACrE,qKAAC,2KAAS;gCAER,OAAO;gCACP,OAAO;gCACP,OAAO;gCACP,UAAU;gCACV,eAAe;gCACf,cAAc;gCACd,cAAc;gCACd,aAAa;gCACb,mBAAmB;gCACnB,aAAa;+BAVR;;;;;;;;;;oBAeV,wBAAwB,GAAG,CAC1B,CAAC,EAAE,KAAK,EAAE,KAAK,EAAE,OAAO,OAAO,EAAE,IAAI,EAAE,KAAK,EAAE,WAAW,EAAE,iBACzD,qKAAC,2KAAS;4BAER,OAAO;4BACP,OAAO;4BACP,MAAM;4BACN,MAAM;4BACN,OAAO;4BACP,eAAe;4BACf,cAAc;4BACd,cAAc;4BACd,aAAa;4BACb,mBAAmB;4BACnB,aAAa;2BAXR;;;;;;;;;;;0BAkBb,qKAAC;gBAAI,WAAU;;kCACb,qKAAC;wBAAI,WAAU;;0CACb,qKAAC;gCACC,SAAS;gCACT,UAAU;gCACV,WAAU;gCACV,OAAO,EAAE;;oCAER,8BACC,qKAAC;wCAAK,WAAU;;;;;iGAEhB,qKAAC,2OAAe;wCAAC,WAAU;;;;;;kDAE7B,qKAAC;wCAAK,WAAU;kDAAa,EAAE;;;;;;kDAC/B,qKAAC;wCAAK,WAAU;kDAAoB,EAAE;;;;;;;;;;;;0CAIxC,qKAAC;gCAAI,WAAU;;kDACb,qKAAC;wCACC,SAAS;wCACT,UAAU,CAAC;wCACX,WAAW,IAAA,mHAAI,EACb,uEACA,mDACA;wCAEF,OAAO,EAAE;;0DAET,qKAAC,sOAAU;gDAAC,WAAU;;;;;;4CACrB,EAAE;;;;;;;kDAEL,qKAAC;wCACC,SAAS;wCACT,UAAU;wCACV,WAAW,IAAA,mHAAI,EACb,uEACA,mDACA;wCAEF,OAAO,EAAE;;0DAET,qKAAC,kOAAM;gDAAC,WAAU;;;;;;4CACjB,EAAE;;;;;;;;;;;;;;;;;;;kCAKT,qKAAC;wBAAI,WAAU;;0CACb,qKAAC;gCACC,SAAS;gCACT,WAAU;0CAET,EAAE;;;;;;0CAEL,qKAAC;gCACC,SAAS;gCACT,WAAU;0CAET,EAAE;;;;;;0CAEL,qKAAC;gCACC,SAAS;gCACT,UAAU,eAAe,OAAO,IAAI,CAAC,aAAa,MAAM,GAAG;gCAC3D,WAAU;0CAET,EAAE;;;;;;;;;;;;;;;;;;;;;;;;AAMf;uCAEe"}},
    {"offset": {"line": 3972, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/components/metadata/SourceSelector.tsx"],"sourcesContent":["'use client';\n\nimport React, { useEffect, useRef } from 'react';\nimport { MdOutlineCheck, MdOutlineEdit } from 'react-icons/md';\n\nimport { BookMetadata } from '@/libs/document';\nimport { useTranslation } from '@/hooks/useTranslation';\nimport { formatAuthors, formatTitle, getPrimaryLanguage } from '@/utils/book';\nimport BookCover from '../BookCover';\nimport { Metadata } from '@/services/metadata/types';\nimport { Book } from '@/types/book';\n\nexport interface MetadataSource {\n  sourceName: string;\n  sourceLabel: string;\n  confidence: number;\n  data: BookMetadata;\n}\n\ninterface SourceSelectorProps {\n  sources: MetadataSource[];\n  isOpen: boolean;\n  onSelect: (source: MetadataSource) => void;\n  onClose: () => void;\n}\n\nconst SourceSelector: React.FC<SourceSelectorProps> = ({ sources, isOpen, onSelect, onClose }) => {\n  const _ = useTranslation();\n  const modalRef = useRef<HTMLDivElement>(null);\n\n  useEffect(() => {\n    if (isOpen && modalRef.current) {\n      modalRef.current.focus();\n    }\n  }, [isOpen]);\n\n  const getConfidenceIcon = (confidence: number) => {\n    if (confidence >= 90) return <MdOutlineCheck className='text-green-500' />;\n    if (confidence >= 70) return <span className='text-yellow-500'></span>;\n    return <span className='text-red-500'></span>;\n  };\n\n  if (!isOpen) return null;\n\n  return (\n    <div className='source-selector fixed inset-0 z-[60] flex items-center justify-center bg-black/50'>\n      <div\n        ref={modalRef}\n        tabIndex={-1}\n        role='dialog'\n        aria-modal='true'\n        className='bg-base-100 mx-4 max-h-[80vh] w-full max-w-md overflow-y-auto rounded-lg p-6'\n      >\n        <h3 className='mb-4 text-lg font-semibold'>{_('Select Metadata Source')}</h3>\n\n        <div className='space-y-3'>\n          {sources.map((source, index) => (\n            <button\n              tabIndex={0}\n              key={index}\n              onClick={() => onSelect(source)}\n              className='hover:bg-base-300/75 bg-base-200 border-base-200 w-full cursor-pointer rounded-md border p-3 transition-colors'\n            >\n              <div className='flex items-start gap-4'>\n                <div className='aspect-[28/41] h-full w-[40%] max-w-32 shadow-md'>\n                  <BookCover\n                    mode='list'\n                    book={\n                      {\n                        title: formatTitle(source.data.title),\n                        author: formatAuthors(source.data.author),\n                        coverImageUrl: (source.data as Metadata)['coverImageUrl'] || '_blank',\n                      } as Book\n                    }\n                  />\n                </div>\n                <div className='flex-1'>\n                  <div className='mb-2 flex items-center justify-between'>\n                    <div className='flex items-center gap-2'>\n                      <span className='font-medium capitalize'>{source.sourceLabel}</span>\n                      {getConfidenceIcon(source.confidence)}\n                    </div>\n                    <span className='text-sm text-gray-500'>{source.confidence}%</span>\n                  </div>\n\n                  <div className='space-y-1 text-sm'>\n                    <div className='font-medium'>{formatTitle(source.data.title)}</div>\n                    <div className='text-gray-600'>{formatAuthors(source.data.author)}</div>\n                    <div className='text-gray-500'>\n                      {source.data.language ? `${getPrimaryLanguage(source.data.language)}  ` : ''}\n                      {source.data.publisher ? `${source.data.publisher}  ` : ''}\n                      {source.data.published}\n                    </div>\n                    {source.data.identifier && (\n                      <div className='text-gray-500'>Identifier: {source.data.identifier}</div>\n                    )}\n                    {source.data.description && (\n                      <div className='line-clamp-3 text-xs text-gray-500'>\n                        {source.data.description}\n                      </div>\n                    )}\n                  </div>\n                </div>\n              </div>\n            </button>\n          ))}\n\n          <button\n            tabIndex={0}\n            onClick={onClose}\n            className='hover:bg-base-300/75 border-base-200 bg-base-200 cursor-pointer rounded-md border p-3 transition-colors'\n          >\n            <div className='flex items-center gap-2'>\n              <MdOutlineEdit className='h-4 w-4' />\n              <span className='font-medium'>{_('Keep manual input')}</span>\n            </div>\n          </button>\n        </div>\n\n        <div className='mt-6 flex justify-end gap-2'>\n          <button onClick={onClose} className='hover:bg-base-200 rounded-md px-4 py-2'>\n            {_('Cancel')}\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default SourceSelector;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 4266, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/components/Spinner.tsx"],"sourcesContent":["import clsx from 'clsx';\nimport React from 'react';\nimport { useThemeStore } from '@/store/themeStore';\nimport { useTranslation } from '@/hooks/useTranslation';\n\nconst Spinner: React.FC<{\n  loading: boolean;\n  className?: string;\n}> = ({ loading, className }) => {\n  const _ = useTranslation();\n  const { safeAreaInsets } = useThemeStore();\n  if (!loading) return null;\n\n  return (\n    <div\n      className={clsx('absolute left-1/2 top-4 -translate-x-1/2 transform text-center')}\n      style={{\n        paddingTop: `${(safeAreaInsets?.top || 0) + 64}px`,\n      }}\n      role='status'\n    >\n      <span\n        className={clsx('loading loading-lg not-eink:loading-dots eink:loading-spinner', className)}\n      ></span>\n      <span className='sr-only'>{_('Loading...')}</span>\n    </div>\n  );\n};\n\nexport default Spinner;\n"],"names":[],"mappings":";;;;;AAAA;AAEA;AACA;;;;;;;;;;;AAEA,MAAM,UAGD,CAAC,EAAE,OAAO,EAAE,SAAS,EAAE;IAC1B,MAAM,IAAI,IAAA,mKAAc;IACxB,MAAM,EAAE,cAAc,EAAE,GAAG,IAAA,8JAAa;IACxC,IAAI,CAAC,SAAS,OAAO;IAErB,qBACE,qKAAC;QACC,WAAW,IAAA,mHAAI,EAAC;QAChB,OAAO;YACL,YAAY,GAAG,CAAC,gBAAgB,OAAO,CAAC,IAAI,GAAG,EAAE,CAAC;QACpD;QACA,MAAK;;0BAEL,qKAAC;gBACC,WAAW,IAAA,mHAAI,EAAC,iEAAiE;;;;;;0BAEnF,qKAAC;gBAAK,WAAU;0BAAW,EAAE;;;;;;;;;;;;AAGnC;uCAEe"}},
    {"offset": {"line": 4325, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/components/metadata/BookDetailModal.tsx"],"sourcesContent":["'use client';\n\nimport clsx from 'clsx';\nimport React, { useEffect, useState } from 'react';\n\nimport { Book } from '@/types/book';\nimport { BookMetadata } from '@/libs/document';\nimport { useEnv } from '@/context/EnvContext';\nimport { useThemeStore } from '@/store/themeStore';\nimport { useTranslation } from '@/hooks/useTranslation';\nimport { useMetadataEdit } from './useMetadataEdit';\nimport { DeleteAction } from '@/types/system';\nimport { eventDispatcher } from '@/utils/event';\nimport { isWebAppPlatform } from '@/services/environment';\nimport Alert from '@/components/Alert';\nimport Dialog from '@/components/Dialog';\nimport BookDetailView from './BookDetailView';\nimport BookDetailEdit from './BookDetailEdit';\nimport SourceSelector from './SourceSelector';\nimport Spinner from '../Spinner';\n\ninterface BookDetailModalProps {\n  book: Book;\n  isOpen: boolean;\n  onClose: () => void;\n  handleBookDownload?: (book: Book, options?: { redownload?: boolean; queued?: boolean }) => void;\n  handleBookUpload?: (book: Book) => void;\n  handleBookDelete?: (book: Book) => void;\n  handleBookDeleteCloudBackup?: (book: Book) => void;\n  handleBookDeleteLocalCopy?: (book: Book) => void;\n  handleBookMetadataUpdate?: (book: Book, updatedMetadata: BookMetadata) => void;\n}\n\ninterface DeleteConfig {\n  title: string;\n  message: string;\n  handler?: (book: Book) => void;\n}\n\nconst BookDetailModal: React.FC<BookDetailModalProps> = ({\n  book,\n  isOpen,\n  onClose,\n  handleBookDownload,\n  handleBookUpload,\n  handleBookDelete,\n  handleBookDeleteCloudBackup,\n  handleBookDeleteLocalCopy,\n  handleBookMetadataUpdate,\n}) => {\n  const _ = useTranslation();\n  const { envConfig, appService } = useEnv();\n  const { safeAreaInsets } = useThemeStore();\n  const [activeDeleteAction, setActiveDeleteAction] = useState<DeleteAction | null>(null);\n  const [isLoading, setIsLoading] = useState(false);\n  const [editMode, setEditMode] = useState(false);\n  const [bookMeta, setBookMeta] = useState<BookMetadata | null>(null);\n  const [fileSize, setFileSize] = useState<number | null>(null);\n\n  // Initialize metadata edit hook\n  const {\n    editedMeta,\n    fieldSources,\n    lockedFields,\n    fieldErrors,\n    searchLoading,\n    showSourceSelection,\n    availableSources,\n    handleFieldChange,\n    handleToggleFieldLock,\n    handleLockAll,\n    handleUnlockAll,\n    handleAutoRetrieve,\n    handleSourceSelection,\n    handleCloseSourceSelection,\n    resetToOriginal,\n  } = useMetadataEdit(bookMeta);\n\n  const deleteConfigs: Record<DeleteAction, DeleteConfig> = {\n    both: {\n      title: _('Confirm Deletion'),\n      message: _('Are you sure to delete the selected book?'),\n      handler: handleBookDelete,\n    },\n    cloud: {\n      title: _('Confirm Deletion'),\n      message: _('Are you sure to delete the cloud backup of the selected book?'),\n      handler: handleBookDeleteCloudBackup,\n    },\n    local: {\n      title: _('Confirm Deletion'),\n      message: _('Are you sure to delete the local copy of the selected book?'),\n      handler: handleBookDeleteLocalCopy,\n    },\n  };\n\n  useEffect(() => {\n    const fetchBookDetails = async () => {\n      const appService = await envConfig.getAppService();\n      try {\n        let details = book.metadata || null;\n        if (!details && book.downloadedAt) {\n          details = await appService.fetchBookDetails(book);\n        }\n        setBookMeta(details);\n        const size = await appService.getBookFileSize(book);\n        setFileSize(size);\n      } finally {\n      }\n    };\n    fetchBookDetails();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [book]);\n\n  const handleClose = () => {\n    setBookMeta(null);\n    setEditMode(false);\n    setActiveDeleteAction(null);\n    onClose();\n  };\n\n  const handleEditMetadata = () => {\n    setEditMode(true);\n  };\n\n  const handleCancelEdit = () => {\n    resetToOriginal();\n    setEditMode(false);\n  };\n\n  const handleSaveMetadata = () => {\n    if (editedMeta && handleBookMetadataUpdate) {\n      setBookMeta({ ...editedMeta });\n      handleBookMetadataUpdate(book, editedMeta);\n      setEditMode(false);\n    }\n  };\n\n  const handleDeleteAction = (action: DeleteAction) => {\n    setActiveDeleteAction(action);\n  };\n\n  const confirmDeleteAction = async () => {\n    if (!activeDeleteAction) return;\n\n    const config = deleteConfigs[activeDeleteAction];\n    handleClose();\n\n    if (config.handler) {\n      config.handler(book);\n    }\n  };\n\n  const cancelDeleteAction = () => {\n    setActiveDeleteAction(null);\n  };\n\n  const handleDelete = () => handleDeleteAction('both');\n  const handleDeleteCloudBackup = () => handleDeleteAction('cloud');\n  const handleDeleteLocalCopy = () => handleDeleteAction('local');\n\n  const handleRedownload = async () => {\n    handleClose();\n    if (handleBookDownload) {\n      handleBookDownload(book, { redownload: true, queued: false });\n    }\n  };\n\n  const handleReupload = async () => {\n    handleClose();\n    if (handleBookUpload) {\n      handleBookUpload(book);\n    }\n  };\n\n  const handleBookExport = async () => {\n    setIsLoading(true);\n    setTimeout(async () => {\n      const success = await appService?.exportBook(book);\n      setIsLoading(false);\n      if (!isWebAppPlatform()) {\n        eventDispatcher.dispatch('toast', {\n          type: success ? 'info' : 'error',\n          message: success ? _('Book exported successfully.') : _('Failed to export the book.'),\n        });\n      }\n    }, 0);\n  };\n\n  const currentDeleteConfig = activeDeleteAction ? deleteConfigs[activeDeleteAction] : null;\n\n  return (\n    <>\n      <div className='fixed inset-0 z-50 flex items-center justify-center'>\n        <Dialog\n          title={editMode ? _('Edit Metadata') : _('Book Details')}\n          isOpen={isOpen}\n          onClose={handleClose}\n          boxClassName={clsx(\n            editMode ? 'sm:min-w-[600px] sm:max-w-[600px]' : 'sm:min-w-[480px] sm:max-w-[480px]',\n            'sm:h-auto sm:max-h-[90%]',\n          )}\n          contentClassName='!px-6 !py-4'\n        >\n          <div className='flex w-full select-text items-start justify-center'>\n            {editMode && bookMeta ? (\n              <BookDetailEdit\n                book={book}\n                metadata={editedMeta}\n                fieldSources={fieldSources}\n                lockedFields={lockedFields}\n                fieldErrors={fieldErrors}\n                searchLoading={searchLoading}\n                onFieldChange={handleFieldChange}\n                onToggleFieldLock={handleToggleFieldLock}\n                onAutoRetrieve={handleAutoRetrieve}\n                onLockAll={handleLockAll}\n                onUnlockAll={handleUnlockAll}\n                onCancel={handleCancelEdit}\n                onReset={resetToOriginal}\n                onSave={handleSaveMetadata}\n              />\n            ) : (\n              <BookDetailView\n                book={book}\n                metadata={bookMeta}\n                fileSize={fileSize}\n                onEdit={handleBookMetadataUpdate ? handleEditMetadata : undefined}\n                onDelete={handleBookDelete ? handleDelete : undefined}\n                onDeleteCloudBackup={\n                  handleBookDeleteCloudBackup ? handleDeleteCloudBackup : undefined\n                }\n                onDeleteLocalCopy={handleBookDeleteLocalCopy ? handleDeleteLocalCopy : undefined}\n                onDownload={handleBookDownload ? handleRedownload : undefined}\n                onUpload={handleBookUpload ? handleReupload : undefined}\n                onExport={handleBookExport}\n              />\n            )}\n          </div>\n        </Dialog>\n\n        {/* Source Selection Modal */}\n        {showSourceSelection && (\n          <SourceSelector\n            sources={availableSources}\n            isOpen={showSourceSelection}\n            onSelect={handleSourceSelection}\n            onClose={handleCloseSourceSelection}\n          />\n        )}\n\n        {isLoading && (\n          <div className='fixed inset-0 z-50 flex items-center justify-center'>\n            <Spinner loading />\n          </div>\n        )}\n\n        {activeDeleteAction && currentDeleteConfig && (\n          <div\n            className={clsx('fixed bottom-0 left-0 right-0 z-50 flex justify-center')}\n            style={{\n              paddingBottom: `${(safeAreaInsets?.bottom || 0) + 16}px`,\n            }}\n          >\n            <Alert\n              title={currentDeleteConfig.title}\n              message={currentDeleteConfig.message}\n              onCancel={cancelDeleteAction}\n              onConfirm={confirmDeleteAction}\n            />\n          </div>\n        )}\n      </div>\n    </>\n  );\n};\n\nexport default BookDetailModal;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 4604, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/components/metadata/index.ts"],"sourcesContent":["export { default as BookDetailModal } from './BookDetailModal';\nexport { default as BookDetailView } from './BookDetailView';\nexport { default as BookDetailEdit } from './BookDetailEdit';\nexport { default as SourceSelector } from './SourceSelector';\n\nexport { useMetadataEdit } from './useMetadataEdit';\n\nexport type { MetadataSource } from './SourceSelector';\n"],"names":[],"mappings":";AAAA;AACA;AACA;AACA;AAEA"}},
    {"offset": {"line": 4646, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/components/Menu.tsx"],"sourcesContent":["'use client';\n\nimport clsx from 'clsx';\nimport React, { useEffect, useRef } from 'react';\nimport { useKeyDownActions } from '@/hooks/useKeyDownActions';\n\ninterface MenuProps {\n  children: React.ReactNode;\n  className?: string;\n  style?: React.CSSProperties;\n  onCancel?: () => void;\n}\n\nconst Menu: React.FC<MenuProps> = ({ children, className, style, onCancel }) => {\n  const menuRef = useRef<HTMLDivElement>(null);\n\n  useKeyDownActions({ onCancel, elementRef: menuRef });\n\n  useEffect(() => {\n    setTimeout(() => {\n      if (menuRef.current) {\n        const firstItem = menuRef.current.querySelector('[role=\"menuitem\"]');\n        if (firstItem) {\n          (firstItem as HTMLElement).focus();\n        }\n      }\n    }, 200);\n  }, []);\n\n  return (\n    <div\n      ref={menuRef}\n      role='none'\n      className={clsx(\n        'menu-container max-h-[calc(100vh-96px)] overflow-y-auto border-0',\n        className,\n      )}\n      style={style}\n    >\n      {children}\n    </div>\n  );\n};\n\nexport default Menu;\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;;;;;;AAJA;;;;;AAaA,MAAM,OAA4B,CAAC,EAAE,QAAQ,EAAE,SAAS,EAAE,KAAK,EAAE,QAAQ,EAAE;IACzE,MAAM,UAAU,IAAA,6GAAM,EAAiB;IAEvC,IAAA,yKAAiB,EAAC;QAAE;QAAU,YAAY;IAAQ;IAElD,IAAA,gHAAS,EAAC;QACR,WAAW;YACT,IAAI,QAAQ,OAAO,EAAE;gBACnB,MAAM,YAAY,QAAQ,OAAO,CAAC,aAAa,CAAC;gBAChD,IAAI,WAAW;oBACZ,UAA0B,KAAK;gBAClC;YACF;QACF,GAAG;IACL,GAAG,EAAE;IAEL,qBACE,qKAAC;QACC,KAAK;QACL,MAAK;QACL,WAAW,IAAA,mHAAI,EACb,oEACA;QAEF,OAAO;kBAEN;;;;;;AAGP;uCAEe"}},
    {"offset": {"line": 4700, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/components/TextButton.tsx"],"sourcesContent":["import clsx from 'clsx';\nimport React from 'react';\n\ninterface TextButtonProps {\n  children: React.ReactNode;\n  onClick?: () => void;\n  disabled?: boolean;\n  className?: string;\n  variant?: 'primary' | 'secondary' | 'danger' | 'success';\n  size?: 'sm' | 'md' | 'lg';\n  type?: 'button' | 'submit' | 'reset';\n}\n\nconst TextButton: React.FC<TextButtonProps> = ({\n  children,\n  onClick,\n  disabled = false,\n  className,\n  variant = 'primary',\n  size = 'sm',\n  type = 'button',\n}) => {\n  const variantClasses = {\n    primary: 'text-blue-500 hover:text-blue-600',\n    secondary: 'text-gray-500 hover:text-gray-600',\n    danger: 'text-red-500 hover:text-red-600',\n    success: 'text-green-500 hover:text-green-600',\n  };\n\n  const sizeClasses = {\n    sm: 'font-size-sm h-[1.3em] min-h-[1.3em]',\n    md: 'font-size-md h-[1.5em] min-h-[1.5em]',\n    lg: 'font-size-lg h-[1.8em] min-h-[1.8em]',\n  };\n\n  return (\n    <button\n      type={type}\n      className={clsx(\n        'content settings-content btn btn-ghost hover:bg-transparent',\n        'flex items-end p-0',\n        sizeClasses[size],\n        disabled ? 'btn-disabled !bg-opacity-0' : '',\n        className,\n      )}\n      onClick={onClick}\n      disabled={disabled}\n    >\n      <div\n        className={clsx('align-bottom', sizeClasses[size].split(' ')[0], variantClasses[variant])}\n      >\n        {children}\n      </div>\n    </button>\n  );\n};\n\nexport default TextButton;\n"],"names":[],"mappings":";;;;;AAAA;;;;;;;AAaA,MAAM,aAAwC,CAAC,EAC7C,QAAQ,EACR,OAAO,EACP,WAAW,KAAK,EAChB,SAAS,EACT,UAAU,SAAS,EACnB,OAAO,IAAI,EACX,OAAO,QAAQ,EAChB;IACC,MAAM,iBAAiB;QACrB,SAAS;QACT,WAAW;QACX,QAAQ;QACR,SAAS;IACX;IAEA,MAAM,cAAc;QAClB,IAAI;QACJ,IAAI;QACJ,IAAI;IACN;IAEA,qBACE,qKAAC;QACC,MAAM;QACN,WAAW,IAAA,mHAAI,EACb,+DACA,sBACA,WAAW,CAAC,KAAK,EACjB,WAAW,+BAA+B,IAC1C;QAEF,SAAS;QACT,UAAU;kBAEV,cAAA,qKAAC;YACC,WAAW,IAAA,mHAAI,EAAC,gBAAgB,WAAW,CAAC,KAAK,CAAC,KAAK,CAAC,IAAI,CAAC,EAAE,EAAE,cAAc,CAAC,QAAQ;sBAEvF;;;;;;;;;;;AAIT;uCAEe"}},
    {"offset": {"line": 4751, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/components/TextEditor.tsx"],"sourcesContent":["'use client';\n\nimport clsx from 'clsx';\nimport React, { useEffect, useRef, useImperativeHandle, forwardRef } from 'react';\n\ninterface TextEditorProps {\n  value: string;\n  onChange: (value: string) => void;\n  onBlur?: () => void;\n  onSave?: () => void;\n  onEscape?: () => void;\n  placeholder?: string;\n  className?: string;\n  autoFocus?: boolean;\n  spellCheck?: boolean;\n  disabled?: boolean;\n  maxRows?: number;\n  minRows?: number;\n}\n\nexport interface TextEditorRef {\n  focus: () => void;\n  blur: () => void;\n  getValue: () => string;\n  setValue: (value: string) => void;\n  getElement: () => HTMLTextAreaElement | null;\n}\n\nconst TextEditor = forwardRef<TextEditorRef, TextEditorProps>(\n  (\n    {\n      value,\n      onChange,\n      onBlur,\n      onSave,\n      onEscape,\n      placeholder,\n      className,\n      autoFocus = false,\n      spellCheck = false,\n      disabled = false,\n      maxRows,\n      minRows = 1,\n    },\n    ref,\n  ) => {\n    const editorRef = useRef<HTMLTextAreaElement>(null);\n\n    useImperativeHandle(ref, () => ({\n      focus: () => {\n        editorRef.current?.focus();\n      },\n      blur: () => {\n        editorRef.current?.blur();\n      },\n      getValue: () => {\n        return editorRef.current?.value || '';\n      },\n      setValue: (newValue: string) => {\n        if (editorRef.current) {\n          editorRef.current.value = newValue;\n          adjustHeight();\n        }\n      },\n      getElement: () => editorRef.current,\n    }));\n\n    useEffect(() => {\n      if (autoFocus && editorRef.current) {\n        editorRef.current.focus();\n      }\n    }, [autoFocus]);\n\n    useEffect(() => {\n      if (editorRef.current) {\n        editorRef.current.value = value;\n        adjustHeight();\n      }\n      // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, [value]);\n\n    const adjustHeight = () => {\n      if (editorRef.current) {\n        editorRef.current.style.height = 'auto';\n        const scrollHeight = editorRef.current.scrollHeight;\n\n        // Calculate max height based on maxRows\n        let maxHeight = Infinity;\n        if (maxRows) {\n          const lineHeight = parseInt(getComputedStyle(editorRef.current).lineHeight);\n          maxHeight = lineHeight * maxRows;\n        }\n\n        // Calculate min height based on minRows\n        const lineHeight = parseInt(getComputedStyle(editorRef.current).lineHeight) || 20;\n        const minHeight = lineHeight * minRows;\n\n        const finalHeight = Math.min(Math.max(scrollHeight, minHeight), maxHeight);\n        editorRef.current.style.height = `${finalHeight}px`;\n      }\n    };\n\n    const handleChange = (e: React.ChangeEvent<HTMLTextAreaElement>) => {\n      adjustHeight();\n      onChange(e.target.value);\n    };\n\n    const handleKeyDown = (e: React.KeyboardEvent<HTMLTextAreaElement>) => {\n      if (e.key === 'Escape' && onEscape) {\n        onEscape();\n        return;\n      }\n\n      if (e.key === 'Enter' && (e.metaKey || e.ctrlKey) && onSave) {\n        e.preventDefault();\n        onSave();\n        return;\n      }\n    };\n\n    return (\n      <textarea\n        ref={editorRef}\n        className={clsx(\n          'textarea textarea-ghost min-h-[1em] resize-none !outline-none',\n          'inset-0 w-full rounded-none border-0 bg-transparent p-0',\n          'content font-size-sm',\n          className,\n        )}\n        dir='auto'\n        rows={minRows}\n        spellCheck={spellCheck}\n        disabled={disabled}\n        onChange={handleChange}\n        onBlur={onBlur}\n        onKeyDown={handleKeyDown}\n        placeholder={placeholder || ''}\n      />\n    );\n  },\n);\n\nTextEditor.displayName = 'TextEditor';\n\nexport default TextEditor;\n"],"names":[],"mappings":";;;;;AAEA;AACA;;;;;AAHA;;;;AA4BA,MAAM,2BAAa,IAAA,iHAAU,EAC3B,CACE,EACE,KAAK,EACL,QAAQ,EACR,MAAM,EACN,MAAM,EACN,QAAQ,EACR,WAAW,EACX,SAAS,EACT,YAAY,KAAK,EACjB,aAAa,KAAK,EAClB,WAAW,KAAK,EAChB,OAAO,EACP,UAAU,CAAC,EACZ,EACD;IAEA,MAAM,YAAY,IAAA,6GAAM,EAAsB;IAE9C,IAAA,0HAAmB,EAAC,KAAK,IAAM,CAAC;YAC9B,OAAO;gBACL,UAAU,OAAO,EAAE;YACrB;YACA,MAAM;gBACJ,UAAU,OAAO,EAAE;YACrB;YACA,UAAU;gBACR,OAAO,UAAU,OAAO,EAAE,SAAS;YACrC;YACA,UAAU,CAAC;gBACT,IAAI,UAAU,OAAO,EAAE;oBACrB,UAAU,OAAO,CAAC,KAAK,GAAG;oBAC1B;gBACF;YACF;YACA,YAAY,IAAM,UAAU,OAAO;QACrC,CAAC;IAED,IAAA,gHAAS,EAAC;QACR,IAAI,aAAa,UAAU,OAAO,EAAE;YAClC,UAAU,OAAO,CAAC,KAAK;QACzB;IACF,GAAG;QAAC;KAAU;IAEd,IAAA,gHAAS,EAAC;QACR,IAAI,UAAU,OAAO,EAAE;YACrB,UAAU,OAAO,CAAC,KAAK,GAAG;YAC1B;QACF;IACA,uDAAuD;IACzD,GAAG;QAAC;KAAM;IAEV,MAAM,eAAe;QACnB,IAAI,UAAU,OAAO,EAAE;YACrB,UAAU,OAAO,CAAC,KAAK,CAAC,MAAM,GAAG;YACjC,MAAM,eAAe,UAAU,OAAO,CAAC,YAAY;YAEnD,wCAAwC;YACxC,IAAI,YAAY;YAChB,IAAI,SAAS;gBACX,MAAM,aAAa,SAAS,iBAAiB,UAAU,OAAO,EAAE,UAAU;gBAC1E,YAAY,aAAa;YAC3B;YAEA,wCAAwC;YACxC,MAAM,aAAa,SAAS,iBAAiB,UAAU,OAAO,EAAE,UAAU,KAAK;YAC/E,MAAM,YAAY,aAAa;YAE/B,MAAM,cAAc,KAAK,GAAG,CAAC,KAAK,GAAG,CAAC,cAAc,YAAY;YAChE,UAAU,OAAO,CAAC,KAAK,CAAC,MAAM,GAAG,GAAG,YAAY,EAAE,CAAC;QACrD;IACF;IAEA,MAAM,eAAe,CAAC;QACpB;QACA,SAAS,EAAE,MAAM,CAAC,KAAK;IACzB;IAEA,MAAM,gBAAgB,CAAC;QACrB,IAAI,EAAE,GAAG,KAAK,YAAY,UAAU;YAClC;YACA;QACF;QAEA,IAAI,EAAE,GAAG,KAAK,WAAW,CAAC,EAAE,OAAO,IAAI,EAAE,OAAO,KAAK,QAAQ;YAC3D,EAAE,cAAc;YAChB;YACA;QACF;IACF;IAEA,qBACE,qKAAC;QACC,KAAK;QACL,WAAW,IAAA,mHAAI,EACb,iEACA,2DACA,wBACA;QAEF,KAAI;QACJ,MAAM;QACN,YAAY;QACZ,UAAU;QACV,UAAU;QACV,QAAQ;QACR,WAAW;QACX,aAAa,eAAe;;;;;;AAGlC;AAGF,WAAW,WAAW,GAAG;uCAEV"}},
    {"offset": {"line": 4858, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/components/HighlighterIcon.tsx"],"sourcesContent":["import { IconBaseProps } from 'react-icons';\nimport { GenIcon } from 'react-icons/lib';\n\nexport function HighlighterIcon({\n  tipColor = '#FFD700',\n  tipStyle = {},\n  ...props\n}: IconBaseProps & { tipColor?: string; tipStyle?: React.CSSProperties }) {\n  return GenIcon({\n    tag: 'svg',\n    attr: {\n      viewBox: '0 0 256 256',\n      fill: 'none',\n    },\n    child: [\n      {\n        tag: 'path',\n        attr: {\n          d: 'M253.66,106.34a8,8,0,0,0-11.32,0L192,156.69,107.31,72l50.35-50.34a8,8,0,1,0-11.32-11.32L96,60.69A16,16,0,0,0,93.18,79.5L72,100.69a16,16,0,0,0,0,22.62L76.69,128,136,187.31l4.69,4.69a16,16,0,0,0,22.62,0l21.18-21.18A16,16,0,0,0,203.31,168l50.35-50.34A8,8,0,0,0,253.66,106.34ZM152,180.69,83.31,112,104,91.31,172.69,160Z',\n          fill: 'currentColor',\n        },\n        child: [],\n      },\n      {\n        tag: 'path',\n        attr: {\n          d: 'M18.34,186.34c-4.209212,4.20621-2.516471,11.37196,3.13,13.25l72,24c0.815308,0.27382,1.669943,0.41232,2.53,0.41c2.12237,0.002,4.15842-0.84009,5.66-2.34L136,187.31c13.62143,13.61626-70.243446-70.24754-64-64l4.69,4.69z',\n          fill: tipColor,\n          style: tipStyle as unknown as string,\n        },\n        child: [],\n      },\n    ],\n  })(props);\n}\n"],"names":[],"mappings":";;;;AACA;;AAEO,SAAS,gBAAgB,EAC9B,WAAW,SAAS,EACpB,WAAW,CAAC,CAAC,EACb,GAAG,OACmE;IACtE,OAAO,IAAA,uOAAO,EAAC;QACb,KAAK;QACL,MAAM;YACJ,SAAS;YACT,MAAM;QACR;QACA,OAAO;YACL;gBACE,KAAK;gBACL,MAAM;oBACJ,GAAG;oBACH,MAAM;gBACR;gBACA,OAAO,EAAE;YACX;YACA;gBACE,KAAK;gBACL,MAAM;oBACJ,GAAG;oBACH,MAAM;oBACN,OAAO;gBACT;gBACA,OAAO,EAAE;YACX;SACD;IACH,GAAG;AACL"}},
    {"offset": {"line": 4898, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/components/WindowButtons.tsx"],"sourcesContent":["'use client';\n\nimport clsx from 'clsx';\nimport React, { useEffect, useRef } from 'react';\nimport { useEnv } from '@/context/EnvContext';\n\nimport { tauriHandleMinimize, tauriHandleToggleMaximize, tauriHandleClose } from '@/utils/window';\nimport { isTauriAppPlatform } from '@/services/environment';\nimport { useTranslation } from '@/hooks/useTranslation';\n\ninterface WindowButtonsProps {\n  className?: string;\n  headerRef?: React.RefObject<HTMLDivElement>;\n  showMinimize?: boolean;\n  showMaximize?: boolean;\n  showClose?: boolean;\n  onMinimize?: () => void;\n  onToggleMaximize?: () => void;\n  onClose?: () => void;\n}\n\ninterface WindowButtonProps {\n  id: string;\n  onClick: () => void;\n  label: string;\n  children: React.ReactNode;\n}\n\nconst WindowButton: React.FC<WindowButtonProps> = ({ onClick, label, id, children }) => (\n  <button\n    id={id}\n    onClick={onClick}\n    className='window-button bg-base-200/35 hover:bg-base-200 text-base-content/85 hover:text-base-content'\n    aria-label={label}\n  >\n    {children}\n  </button>\n);\n\nconst WindowButtons: React.FC<WindowButtonsProps> = ({\n  className,\n  headerRef,\n  showMinimize = true,\n  showMaximize = true,\n  showClose = true,\n  onMinimize,\n  onToggleMaximize,\n  onClose,\n}) => {\n  const _ = useTranslation();\n  const parentRef = useRef<HTMLDivElement>(null);\n  const { appService } = useEnv();\n\n  const touchState = useRef({\n    lastPointerTime: 0,\n    pointerStartPosition: { x: 0, y: 0 },\n    isDragging: false,\n  });\n\n  const isExcludedElement = (target: HTMLElement) => {\n    return (\n      target.closest('.btn') ||\n      target.closest('.window-button') ||\n      target.closest('.dropdown-container') ||\n      target.closest('.exclude-title-bar-mousedown')\n    );\n  };\n\n  const handleMouseDown = async (e: MouseEvent) => {\n    const target = e.target as HTMLElement;\n\n    if (isExcludedElement(target)) {\n      return;\n    }\n\n    const { getCurrentWindow } = await import('@tauri-apps/api/window');\n    if (e.buttons === 1) {\n      if (e.detail === 2) {\n        getCurrentWindow().toggleMaximize();\n      } else {\n        getCurrentWindow().startDragging();\n      }\n    }\n  };\n\n  const handlePointerDown = async (e: PointerEvent) => {\n    const target = e.target as HTMLElement;\n\n    if (isExcludedElement(target)) {\n      return;\n    }\n\n    if (e.pointerType === 'mouse') {\n      return;\n    }\n\n    e.preventDefault();\n\n    const currentTime = Date.now();\n    const timeDiff = currentTime - touchState.current.lastPointerTime;\n\n    touchState.current.pointerStartPosition = {\n      x: e.clientX,\n      y: e.clientY,\n    };\n\n    if (timeDiff < 300) {\n      const { getCurrentWindow } = await import('@tauri-apps/api/window');\n      getCurrentWindow().toggleMaximize();\n      return;\n    }\n\n    touchState.current.lastPointerTime = currentTime;\n    touchState.current.isDragging = false;\n  };\n\n  const handlePointerMove = async (e: PointerEvent) => {\n    const target = e.target as HTMLElement;\n\n    if (isExcludedElement(target) || touchState.current.isDragging) {\n      return;\n    }\n\n    if (e.pointerType === 'mouse') {\n      return;\n    }\n\n    e.preventDefault();\n\n    const deltaX = Math.abs(e.clientX - touchState.current.pointerStartPosition.x);\n    const deltaY = Math.abs(e.clientY - touchState.current.pointerStartPosition.y);\n\n    if (deltaX > 5 || deltaY > 5) {\n      touchState.current.isDragging = true;\n      try {\n        const { getCurrentWindow } = await import('@tauri-apps/api/window');\n        await getCurrentWindow().startDragging();\n      } catch (error) {\n        console.warn('Failed to start window dragging:', error);\n      }\n    }\n  };\n\n  const handlePointerUp = () => {\n    touchState.current.isDragging = false;\n  };\n\n  useEffect(() => {\n    if (!isTauriAppPlatform()) return;\n    const headerElement = headerRef?.current;\n    if (!headerElement) return;\n\n    headerElement.addEventListener('mousedown', handleMouseDown);\n    headerElement.addEventListener('pointerdown', handlePointerDown);\n    headerElement.addEventListener('pointermove', handlePointerMove);\n    headerElement.addEventListener('pointerup', handlePointerUp);\n    headerElement.addEventListener('pointercancel', handlePointerUp);\n\n    return () => {\n      headerElement.removeEventListener('mousedown', handleMouseDown);\n      headerElement.removeEventListener('pointerdown', handlePointerDown);\n      headerElement.removeEventListener('pointermove', handlePointerMove);\n      headerElement.removeEventListener('pointerup', handlePointerUp);\n      headerElement.removeEventListener('pointercancel', handlePointerUp);\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  const handleMinimize = async () => {\n    if (onMinimize) {\n      onMinimize();\n    } else {\n      tauriHandleMinimize();\n    }\n  };\n\n  const handleMaximize = async () => {\n    if (onToggleMaximize) {\n      onToggleMaximize();\n    } else {\n      tauriHandleToggleMaximize();\n    }\n  };\n\n  const handleClose = async () => {\n    if (onClose) {\n      onClose();\n    } else {\n      tauriHandleClose();\n    }\n  };\n\n  return (\n    <div\n      ref={parentRef}\n      className={clsx(\n        'window-buttons flex h-8 items-center justify-end space-x-2',\n        showClose || showMaximize || showMinimize ? 'visible' : 'hidden',\n        className,\n      )}\n    >\n      {showMinimize && appService?.hasWindowBar && (\n        <WindowButton onClick={handleMinimize} label={_('Minimize')} id='titlebar-minimize'>\n          <svg xmlns='http://www.w3.org/2000/svg' width='1em' height='1em' viewBox='0 0 24 24'>\n            <path fill='currentColor' d='M20 14H4v-2h16' />\n          </svg>\n        </WindowButton>\n      )}\n\n      {showMaximize && appService?.hasWindowBar && (\n        <WindowButton\n          onClick={handleMaximize}\n          label={_('Maximize or Restore')}\n          id='titlebar-maximize'\n        >\n          <svg xmlns='http://www.w3.org/2000/svg' width='1em' height='1em' viewBox='0 0 24 24'>\n            <path fill='currentColor' d='M4 4h16v16H4zm2 4v10h12V8z' />\n          </svg>\n        </WindowButton>\n      )}\n\n      {showClose && (appService?.hasWindowBar || onClose) && (\n        <WindowButton onClick={handleClose} label={_('Close')} id='titlebar-close'>\n          <svg xmlns='http://www.w3.org/2000/svg' width='1em' height='1em' viewBox='0 0 24 24'>\n            <path\n              fill='currentColor'\n              d='M19 6.41L17.59 5L12 10.59L6.41 5L5 6.41L10.59 12L5 17.59L6.41 19L12 13.41L17.59 19L19 17.59L13.41 12z'\n            />\n          </svg>\n        </WindowButton>\n      )}\n    </div>\n  );\n};\n\nexport default WindowButtons;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 5149, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/components/Button.tsx"],"sourcesContent":["import clsx from 'clsx';\nimport React from 'react';\nimport { useEnv } from '@/context/EnvContext';\n\ninterface ButtonProps {\n  icon: React.ReactNode;\n  onClick: () => void;\n  disabled?: boolean;\n  label?: string;\n  className?: string;\n}\n\nconst Button: React.FC<ButtonProps> = ({ icon, onClick, disabled = false, label, className }) => {\n  const { appService } = useEnv();\n  return (\n    <button\n      className={clsx(\n        'btn btn-ghost h-8 min-h-8 w-8 p-0',\n        appService?.isMobileApp && 'hover:bg-transparent',\n        disabled && 'cursor-default !bg-transparent opacity-50',\n        className,\n      )}\n      title={label}\n      aria-label={label}\n      onClick={disabled ? undefined : onClick}\n    >\n      {icon}\n    </button>\n  );\n};\n\nexport default Button;\n"],"names":[],"mappings":";;;;;AAAA;AAEA;;;;;;;;AAUA,MAAM,SAAgC,CAAC,EAAE,IAAI,EAAE,OAAO,EAAE,WAAW,KAAK,EAAE,KAAK,EAAE,SAAS,EAAE;IAC1F,MAAM,EAAE,UAAU,EAAE,GAAG,IAAA,0JAAM;IAC7B,qBACE,qKAAC;QACC,WAAW,IAAA,mHAAI,EACb,qCACA,YAAY,eAAe,wBAC3B,YAAY,6CACZ;QAEF,OAAO;QACP,cAAY;QACZ,SAAS,WAAW,YAAY;kBAE/B;;;;;;AAGP;uCAEe"}},
    {"offset": {"line": 5183, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/components/Slider.tsx"],"sourcesContent":["'use client';\n\nimport React, { useEffect, useRef, useState } from 'react';\n\ninterface SliderProps {\n  label: string;\n  min?: number;\n  max?: number;\n  step?: number;\n  initialValue?: number;\n  heightPx?: number;\n  minLabel?: string;\n  maxLabel?: string;\n  minIcon?: React.ReactNode;\n  maxIcon?: React.ReactNode;\n  bubbleElement?: React.ReactNode;\n  bubbleLabel?: string;\n  className?: string;\n  minClassName?: string;\n  maxClassName?: string;\n  bubbleClassName?: string;\n  onChange?: (value: number) => void;\n  valueToPosition?: (value: number, min: number, max: number) => number;\n  positionToValue?: (position: number, min: number, max: number) => number;\n}\n\nconst Slider: React.FC<SliderProps> = ({\n  label,\n  min = 0,\n  max = 100,\n  step = 1,\n  initialValue = 50,\n  heightPx = 40,\n  minLabel = '',\n  maxLabel = '',\n  minIcon,\n  maxIcon,\n  bubbleElement,\n  bubbleLabel = '',\n  className = '',\n  minClassName = '',\n  maxClassName = '',\n  bubbleClassName = '',\n  onChange,\n  valueToPosition,\n  positionToValue,\n}) => {\n  const [value, setValue] = useState(initialValue);\n  const [isRtl, setIsRtl] = useState(false);\n  const sliderRef = useRef<HTMLDivElement>(null);\n\n  // Default linear mapping functions\n  const defaultValueToPosition = (val: number, minVal: number, maxVal: number) => {\n    return ((val - minVal) / (maxVal - minVal)) * 100;\n  };\n\n  const defaultPositionToValue = (pos: number, minVal: number, maxVal: number) => {\n    return minVal + (pos / 100) * (maxVal - minVal);\n  };\n\n  const valueToPos = valueToPosition || defaultValueToPosition;\n  const posToValue = positionToValue || defaultPositionToValue;\n\n  const handleChange = (e: React.ChangeEvent) => {\n    const position = parseInt((e.target as HTMLInputElement).value, 10);\n    const newValue = Math.round(posToValue(position, min, max) / step) * step;\n    setValue(newValue);\n    if (onChange) {\n      onChange(newValue);\n    }\n  };\n\n  useEffect(() => {\n    let node: HTMLElement | null = sliderRef.current;\n    while (node) {\n      if (node.getAttribute('dir') === 'rtl') {\n        setIsRtl(true);\n        break;\n      }\n      node = node.parentElement;\n    }\n  }, []);\n\n  useEffect(() => {\n    setValue(initialValue);\n  }, [initialValue]);\n\n  const percentage = valueToPos(value, min, max);\n  const visualPercentage = (percentage / 100) * 95;\n\n  return (\n    <div\n      ref={sliderRef}\n      aria-label={label}\n      className={`slider bg-base-200 mx-auto w-full rounded-xl ${className}`}\n      dir={isRtl ? 'rtl' : undefined}\n    >\n      <div className='relative' style={{ height: `${heightPx}px` }}>\n        {/* Background track */}\n        <div className='bg-base-300/40 absolute h-full w-full rounded-full'></div>\n        {/* Filled portion */}\n        <div\n          className='bg-base-300 absolute h-full rounded-full'\n          style={{\n            width:\n              visualPercentage > 0\n                ? `max(calc(${visualPercentage}% + ${heightPx / 2}px), ${heightPx}px)`\n                : '0px',\n            [isRtl ? 'right' : 'left']: 0,\n          }}\n        ></div>\n        {/* Min/Max labels */}\n        <div className='absolute inset-0 flex items-center justify-between px-4 text-sm'>\n          {minIcon ? minIcon : <span className={`ml-2 ${minClassName}`}>{minLabel}</span>}\n          {maxIcon ? maxIcon : <span className={`mr-2 ${maxClassName}`}>{maxLabel}</span>}\n        </div>\n        {/* Thumb bubble */}\n        <div\n          className='pointer-events-none absolute top-0 z-10'\n          style={{\n            [isRtl ? 'right' : 'left']: `max(${heightPx / 2}px, calc(${visualPercentage}%))`,\n            transform: isRtl ? 'translateX(calc(50%))' : 'translateX(calc(-50%))',\n            height: '100%',\n          }}\n        >\n          <div\n            className={`bg-base-200 flex h-full items-center justify-center rounded-full text-xs shadow-md ${bubbleClassName}`}\n            style={{ width: `${heightPx}px` }}\n          >\n            {bubbleElement || bubbleLabel}\n          </div>\n        </div>\n        <input\n          type='range'\n          min={0}\n          max={100}\n          step={step}\n          value={percentage}\n          className='absolute inset-0 h-full w-full cursor-pointer opacity-0'\n          onChange={handleChange}\n          aria-label={label}\n          aria-valuemin={min}\n          aria-valuemax={max}\n          aria-valuenow={value}\n          aria-valuetext={`${value}`}\n          aria-orientation='horizontal'\n        />\n      </div>\n    </div>\n  );\n};\n\nexport default Slider;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 5345, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/components/Popup.tsx"],"sourcesContent":["'use client';\n\nimport clsx from 'clsx';\nimport { Position } from '@/utils/sel';\nimport { useEffect, useRef, useState } from 'react';\nimport { useResponsiveSize } from '@/hooks/useResponsiveSize';\nimport { useKeyDownActions } from '@/hooks/useKeyDownActions';\n\nconst getTriangleStyles = (\n  trianglePosition: Position | undefined,\n  size: number,\n  offset: number,\n): React.CSSProperties => {\n  if (!trianglePosition) {\n    return { left: '-999px', top: '-999px' };\n  }\n\n  const { dir, point } = trianglePosition;\n\n  let topOffset = 0;\n  let leftOffset = 0;\n  switch (dir) {\n    case 'up':\n      topOffset = offset;\n      break;\n    case 'down':\n      topOffset = -offset;\n      break;\n    case 'left':\n      leftOffset = offset;\n      break;\n    case 'right':\n      leftOffset = -offset;\n      break;\n  }\n\n  return {\n    left: `${point.x + leftOffset}px`,\n    top: `${point.y + topOffset}px`,\n    borderLeft:\n      dir === 'right' ? 'none' : dir === 'left' ? `${size}px solid` : `${size}px solid transparent`,\n    borderRight:\n      dir === 'left' ? 'none' : dir === 'right' ? `${size}px solid` : `${size}px solid transparent`,\n    borderTop:\n      dir === 'down' ? 'none' : dir === 'up' ? `${size}px solid` : `${size}px solid transparent`,\n    borderBottom:\n      dir === 'up' ? 'none' : dir === 'down' ? `${size}px solid` : `${size}px solid transparent`,\n    transform: dir === 'left' || dir === 'right' ? 'translateY(-50%)' : 'translateX(-50%)',\n  };\n};\n\nconst Popup = ({\n  width,\n  height,\n  minHeight,\n  maxHeight,\n  position,\n  trianglePosition,\n  children,\n  className = '',\n  triangleClassName = '',\n  additionalStyle = {},\n  isOpen = true,\n  onDismiss,\n}: {\n  isOpen?: boolean;\n  width: number;\n  height?: number;\n  minHeight?: number;\n  maxHeight?: number;\n  position?: Position;\n  trianglePosition?: Position;\n  children: React.ReactNode;\n  className?: string;\n  triangleClassName?: string;\n  additionalStyle?: React.CSSProperties;\n  onDismiss?: () => void;\n}) => {\n  const containerRef = useRef<HTMLDivElement>(null);\n  const [adjustedPosition, setAdjustedPosition] = useState(position);\n  const [childrenHeight, setChildrenHeight] = useState(height || minHeight || 0);\n\n  useKeyDownActions({ onCancel: onDismiss, elementRef: containerRef, enabled: isOpen });\n\n  const popupPadding = useResponsiveSize(10);\n  let availableHeight = window.innerHeight - 2 * popupPadding;\n  if (trianglePosition?.dir === 'up') {\n    availableHeight = trianglePosition.point.y - popupPadding;\n  } else if (trianglePosition?.dir === 'down') {\n    availableHeight = window.innerHeight - trianglePosition.point.y - popupPadding;\n  }\n  maxHeight = Math.min(maxHeight || availableHeight, availableHeight);\n\n  useEffect(() => {\n    if (!containerRef.current) return;\n    const resizeObserver = new ResizeObserver((entries) => {\n      for (const entry of entries) {\n        const newHeight = entry.contentRect.height;\n        if (newHeight !== childrenHeight) {\n          setChildrenHeight(newHeight);\n          return;\n        }\n      }\n    });\n\n    resizeObserver.observe(containerRef.current);\n    return () => {\n      resizeObserver.disconnect();\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  useEffect(() => {\n    if (!containerRef.current) return;\n    if (!position || !trianglePosition || position.dir !== 'up') {\n      setAdjustedPosition(position);\n      return;\n    }\n    const containerHeight = childrenHeight || containerRef.current.offsetHeight;\n    const newPosition = {\n      ...position,\n      point: {\n        ...position.point,\n        y: Math.max(popupPadding, trianglePosition.point.y - containerHeight),\n      },\n    };\n    setAdjustedPosition(newPosition);\n  }, [position, trianglePosition, popupPadding, childrenHeight]);\n\n  const outerTriangleStyles = getTriangleStyles(trianglePosition, 7, 0);\n  const innerTriangleStyles = getTriangleStyles(trianglePosition, 7, -1);\n\n  return (\n    <div>\n      <div\n        className={clsx('popup-triangle-outer text-base-300 absolute z-50', triangleClassName)}\n        style={outerTriangleStyles}\n      />\n      <div\n        id='popup-container'\n        ref={containerRef}\n        className={clsx(\n          'popup-container bg-base-300 absolute z-50 rounded-lg font-sans',\n          'eink:border eink:border-base-content',\n          trianglePosition?.dir !== 'up' && 'not-eink:shadow-xl',\n          className,\n        )}\n        style={{\n          width: `${width}px`,\n          height: height ? `${height}px` : 'auto',\n          minHeight: minHeight ? `${minHeight}px` : 'none',\n          maxHeight: maxHeight ? `${maxHeight}px` : 'none',\n          left: `${adjustedPosition ? adjustedPosition.point.x : -999}px`,\n          top: `${adjustedPosition ? adjustedPosition.point.y : -999}px`,\n          ...additionalStyle,\n        }}\n      >\n        {children}\n      </div>\n      <div\n        className={clsx('popup-triangle-inner text-base-300 absolute z-50', triangleClassName)}\n        style={innerTriangleStyles}\n      />\n    </div>\n  );\n};\n\nexport default Popup;\n"],"names":[],"mappings":";;;;;AAEA;AAEA;AACA;AACA;;;;;;AANA;;;;;;AAQA,MAAM,oBAAoB,CACxB,kBACA,MACA;IAEA,IAAI,CAAC,kBAAkB;QACrB,OAAO;YAAE,MAAM;YAAU,KAAK;QAAS;IACzC;IAEA,MAAM,EAAE,GAAG,EAAE,KAAK,EAAE,GAAG;IAEvB,IAAI,YAAY;IAChB,IAAI,aAAa;IACjB,OAAQ;QACN,KAAK;YACH,YAAY;YACZ;QACF,KAAK;YACH,YAAY,CAAC;YACb;QACF,KAAK;YACH,aAAa;YACb;QACF,KAAK;YACH,aAAa,CAAC;YACd;IACJ;IAEA,OAAO;QACL,MAAM,GAAG,MAAM,CAAC,GAAG,WAAW,EAAE,CAAC;QACjC,KAAK,GAAG,MAAM,CAAC,GAAG,UAAU,EAAE,CAAC;QAC/B,YACE,QAAQ,UAAU,SAAS,QAAQ,SAAS,GAAG,KAAK,QAAQ,CAAC,GAAG,GAAG,KAAK,oBAAoB,CAAC;QAC/F,aACE,QAAQ,SAAS,SAAS,QAAQ,UAAU,GAAG,KAAK,QAAQ,CAAC,GAAG,GAAG,KAAK,oBAAoB,CAAC;QAC/F,WACE,QAAQ,SAAS,SAAS,QAAQ,OAAO,GAAG,KAAK,QAAQ,CAAC,GAAG,GAAG,KAAK,oBAAoB,CAAC;QAC5F,cACE,QAAQ,OAAO,SAAS,QAAQ,SAAS,GAAG,KAAK,QAAQ,CAAC,GAAG,GAAG,KAAK,oBAAoB,CAAC;QAC5F,WAAW,QAAQ,UAAU,QAAQ,UAAU,qBAAqB;IACtE;AACF;AAEA,MAAM,QAAQ,CAAC,EACb,KAAK,EACL,MAAM,EACN,SAAS,EACT,SAAS,EACT,QAAQ,EACR,gBAAgB,EAChB,QAAQ,EACR,YAAY,EAAE,EACd,oBAAoB,EAAE,EACtB,kBAAkB,CAAC,CAAC,EACpB,SAAS,IAAI,EACb,SAAS,EAcV;IACC,MAAM,eAAe,IAAA,6GAAM,EAAiB;IAC5C,MAAM,CAAC,kBAAkB,oBAAoB,GAAG,IAAA,+GAAQ,EAAC;IACzD,MAAM,CAAC,gBAAgB,kBAAkB,GAAG,IAAA,+GAAQ,EAAC,UAAU,aAAa;IAE5E,IAAA,yKAAiB,EAAC;QAAE,UAAU;QAAW,YAAY;QAAc,SAAS;IAAO;IAEnF,MAAM,eAAe,IAAA,yKAAiB,EAAC;IACvC,IAAI,kBAAkB,OAAO,WAAW,GAAG,IAAI;IAC/C,IAAI,kBAAkB,QAAQ,MAAM;QAClC,kBAAkB,iBAAiB,KAAK,CAAC,CAAC,GAAG;IAC/C,OAAO,IAAI,kBAAkB,QAAQ,QAAQ;QAC3C,kBAAkB,OAAO,WAAW,GAAG,iBAAiB,KAAK,CAAC,CAAC,GAAG;IACpE;IACA,YAAY,KAAK,GAAG,CAAC,aAAa,iBAAiB;IAEnD,IAAA,gHAAS,EAAC;QACR,IAAI,CAAC,aAAa,OAAO,EAAE;QAC3B,MAAM,iBAAiB,IAAI,eAAe,CAAC;YACzC,KAAK,MAAM,SAAS,QAAS;gBAC3B,MAAM,YAAY,MAAM,WAAW,CAAC,MAAM;gBAC1C,IAAI,cAAc,gBAAgB;oBAChC,kBAAkB;oBAClB;gBACF;YACF;QACF;QAEA,eAAe,OAAO,CAAC,aAAa,OAAO;QAC3C,OAAO;YACL,eAAe,UAAU;QAC3B;IACA,uDAAuD;IACzD,GAAG,EAAE;IAEL,IAAA,gHAAS,EAAC;QACR,IAAI,CAAC,aAAa,OAAO,EAAE;QAC3B,IAAI,CAAC,YAAY,CAAC,oBAAoB,SAAS,GAAG,KAAK,MAAM;YAC3D,oBAAoB;YACpB;QACF;QACA,MAAM,kBAAkB,kBAAkB,aAAa,OAAO,CAAC,YAAY;QAC3E,MAAM,cAAc;YAClB,GAAG,QAAQ;YACX,OAAO;gBACL,GAAG,SAAS,KAAK;gBACjB,GAAG,KAAK,GAAG,CAAC,cAAc,iBAAiB,KAAK,CAAC,CAAC,GAAG;YACvD;QACF;QACA,oBAAoB;IACtB,GAAG;QAAC;QAAU;QAAkB;QAAc;KAAe;IAE7D,MAAM,sBAAsB,kBAAkB,kBAAkB,GAAG;IACnE,MAAM,sBAAsB,kBAAkB,kBAAkB,GAAG,CAAC;IAEpE,qBACE,qKAAC;;0BACC,qKAAC;gBACC,WAAW,IAAA,mHAAI,EAAC,oDAAoD;gBACpE,OAAO;;;;;;0BAET,qKAAC;gBACC,IAAG;gBACH,KAAK;gBACL,WAAW,IAAA,mHAAI,EACb,kEACA,wCACA,kBAAkB,QAAQ,QAAQ,sBAClC;gBAEF,OAAO;oBACL,OAAO,GAAG,MAAM,EAAE,CAAC;oBACnB,QAAQ,SAAS,GAAG,OAAO,EAAE,CAAC,GAAG;oBACjC,WAAW,YAAY,GAAG,UAAU,EAAE,CAAC,GAAG;oBAC1C,WAAW,YAAY,GAAG,UAAU,EAAE,CAAC,GAAG;oBAC1C,MAAM,GAAG,mBAAmB,iBAAiB,KAAK,CAAC,CAAC,GAAG,CAAC,IAAI,EAAE,CAAC;oBAC/D,KAAK,GAAG,mBAAmB,iBAAiB,KAAK,CAAC,CAAC,GAAG,CAAC,IAAI,EAAE,CAAC;oBAC9D,GAAG,eAAe;gBACpB;0BAEC;;;;;;0BAEH,qKAAC;gBACC,WAAW,IAAA,mHAAI,EAAC,oDAAoD;gBACpE,OAAO;;;;;;;;;;;;AAIf;uCAEe"}},
    {"offset": {"line": 5508, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/components/Select.tsx"],"sourcesContent":["import clsx from 'clsx';\nimport React from 'react';\n\ntype Option = {\n  value: string;\n  label: string;\n};\n\ntype SelectProps = {\n  value: string;\n  onChange: (e: React.ChangeEvent<HTMLSelectElement>) => void;\n  options: Option[];\n  disabled?: boolean;\n  className?: string;\n};\n\nexport default function Select({\n  value,\n  onChange,\n  options,\n  className,\n  disabled = false,\n}: SelectProps) {\n  return (\n    <select\n      value={value}\n      onChange={onChange}\n      onKeyDown={(e) => e.stopPropagation()}\n      className={clsx(\n        'select bg-base-200 h-8 min-h-8 max-w-[60%] truncate rounded-md border-none text-sm',\n        className,\n      )}\n      disabled={disabled}\n      style={{\n        textAlignLast: 'end',\n      }}\n    >\n      {options.map(({ value, label }) => (\n        <option key={value} value={value}>\n          {label}\n        </option>\n      ))}\n    </select>\n  );\n}\n"],"names":[],"mappings":";;;;;AAAA;;;;;;;AAgBe,SAAS,OAAO,EAC7B,KAAK,EACL,QAAQ,EACR,OAAO,EACP,SAAS,EACT,WAAW,KAAK,EACJ;IACZ,qBACE,qKAAC;QACC,OAAO;QACP,UAAU;QACV,WAAW,CAAC,IAAM,EAAE,eAAe;QACnC,WAAW,IAAA,mHAAI,EACb,sFACA;QAEF,UAAU;QACV,OAAO;YACL,eAAe;QACjB;kBAEC,QAAQ,GAAG,CAAC,CAAC,EAAE,KAAK,EAAE,KAAK,EAAE,iBAC5B,qKAAC;gBAAmB,OAAO;0BACxB;eADU;;;;;;;;;;AAMrB"}},
    {"offset": {"line": 5551, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/components/settings/NumberInput.tsx"],"sourcesContent":["'use client';\n\nimport clsx from 'clsx';\nimport React, { useEffect, useState } from 'react';\nimport { FiMinus, FiPlus } from 'react-icons/fi';\nimport { useTranslation } from '@/hooks/useTranslation';\n\ninterface NumberInputProps {\n  className?: string;\n  inputClassName?: string;\n  label: string;\n  iconSize?: number;\n  value: number;\n  min: number;\n  max: number;\n  step?: number;\n  disabled?: boolean;\n  onChange: (value: number) => void;\n}\n\nconst NumberInput: React.FC<NumberInputProps> = ({\n  className,\n  inputClassName,\n  label,\n  iconSize,\n  value,\n  onChange,\n  min,\n  max,\n  step,\n  disabled,\n}) => {\n  const _ = useTranslation();\n  const [localValue, setLocalValue] = useState(value);\n  const numberStep = step || 1;\n\n  useEffect(() => {\n    setLocalValue(value);\n  }, [value]);\n\n  const handleChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const value = e.target.value;\n\n    // Allow empty string or valid numbers without leading zeros\n    if (value === '' || /^[1-9]\\d*\\.?\\d*$|^0?\\.?\\d*$/.test(value)) {\n      const newValue = value === '' ? 0 : parseFloat(value);\n      setLocalValue(newValue);\n\n      if (!isNaN(newValue)) {\n        const roundedValue = Math.round(newValue * 10) / 10;\n        onChange(Math.max(min, Math.min(max, roundedValue)));\n      }\n    }\n  };\n\n  const increment = () => {\n    const newValue = Math.min(max, localValue + numberStep);\n    const roundedValue = Math.round(newValue * 10) / 10;\n    setLocalValue(roundedValue);\n    onChange(roundedValue);\n  };\n\n  const decrement = () => {\n    const newValue = Math.max(min, localValue - numberStep);\n    const roundedValue = Math.round(newValue * 10) / 10;\n    setLocalValue(roundedValue);\n    onChange(roundedValue);\n  };\n\n  const handleOnBlur = () => {\n    const newValue = Math.max(min, Math.min(max, localValue));\n    setLocalValue(newValue);\n    onChange(newValue);\n  };\n\n  return (\n    <div className={clsx('config-item', className)}>\n      <span className='text-base-content line-clamp-2'>{label}</span>\n      {iconSize && <span style={{ minWidth: `${iconSize}px` }} />}\n      <div className='text-base-content flex items-center gap-2'>\n        <input\n          type='text'\n          inputMode='decimal'\n          disabled={disabled}\n          value={localValue}\n          onChange={handleChange}\n          onBlur={handleOnBlur}\n          className={clsx(\n            'input input-ghost settings-content text-base-content w-16 max-w-xs rounded border-0 bg-transparent pe-3 !outline-none',\n            label && 'py-1 ps-1 text-right',\n            disabled && 'input-disabled cursor-not-allowed disabled:bg-transparent',\n            inputClassName,\n          )}\n          onFocus={(e) => e.target.select()}\n        />\n        <button\n          tabIndex={disabled ? -1 : 0}\n          aria-label={_('Decrease')}\n          onClick={decrement}\n          className={`btn btn-circle btn-sm ${value <= min || disabled ? 'btn-disabled !bg-opacity-5' : ''}`}\n        >\n          <FiMinus className='h-4 w-4' />\n        </button>\n        <button\n          tabIndex={disabled ? -1 : 0}\n          aria-label={_('Increase')}\n          onClick={increment}\n          className={`btn btn-circle btn-sm ${value >= max || disabled ? 'btn-disabled !bg-opacity-5' : ''}`}\n        >\n          <FiPlus className='h-4 w-4' />\n        </button>\n      </div>\n    </div>\n  );\n};\n\nexport default NumberInput;\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AACA;;;;;;AALA;;;;;;AAoBA,MAAM,cAA0C,CAAC,EAC/C,SAAS,EACT,cAAc,EACd,KAAK,EACL,QAAQ,EACR,KAAK,EACL,QAAQ,EACR,GAAG,EACH,GAAG,EACH,IAAI,EACJ,QAAQ,EACT;IACC,MAAM,IAAI,IAAA,mKAAc;IACxB,MAAM,CAAC,YAAY,cAAc,GAAG,IAAA,+GAAQ,EAAC;IAC7C,MAAM,aAAa,QAAQ;IAE3B,IAAA,gHAAS,EAAC;QACR,cAAc;IAChB,GAAG;QAAC;KAAM;IAEV,MAAM,eAAe,CAAC;QACpB,MAAM,QAAQ,EAAE,MAAM,CAAC,KAAK;QAE5B,4DAA4D;QAC5D,IAAI,UAAU,MAAM,8BAA8B,IAAI,CAAC,QAAQ;YAC7D,MAAM,WAAW,UAAU,KAAK,IAAI,WAAW;YAC/C,cAAc;YAEd,IAAI,CAAC,MAAM,WAAW;gBACpB,MAAM,eAAe,KAAK,KAAK,CAAC,WAAW,MAAM;gBACjD,SAAS,KAAK,GAAG,CAAC,KAAK,KAAK,GAAG,CAAC,KAAK;YACvC;QACF;IACF;IAEA,MAAM,YAAY;QAChB,MAAM,WAAW,KAAK,GAAG,CAAC,KAAK,aAAa;QAC5C,MAAM,eAAe,KAAK,KAAK,CAAC,WAAW,MAAM;QACjD,cAAc;QACd,SAAS;IACX;IAEA,MAAM,YAAY;QAChB,MAAM,WAAW,KAAK,GAAG,CAAC,KAAK,aAAa;QAC5C,MAAM,eAAe,KAAK,KAAK,CAAC,WAAW,MAAM;QACjD,cAAc;QACd,SAAS;IACX;IAEA,MAAM,eAAe;QACnB,MAAM,WAAW,KAAK,GAAG,CAAC,KAAK,KAAK,GAAG,CAAC,KAAK;QAC7C,cAAc;QACd,SAAS;IACX;IAEA,qBACE,qKAAC;QAAI,WAAW,IAAA,mHAAI,EAAC,eAAe;;0BAClC,qKAAC;gBAAK,WAAU;0BAAkC;;;;;;YACjD,0BAAY,qKAAC;gBAAK,OAAO;oBAAE,UAAU,GAAG,SAAS,EAAE,CAAC;gBAAC;;;;;;0BACtD,qKAAC;gBAAI,WAAU;;kCACb,qKAAC;wBACC,MAAK;wBACL,WAAU;wBACV,UAAU;wBACV,OAAO;wBACP,UAAU;wBACV,QAAQ;wBACR,WAAW,IAAA,mHAAI,EACb,yHACA,SAAS,wBACT,YAAY,6DACZ;wBAEF,SAAS,CAAC,IAAM,EAAE,MAAM,CAAC,MAAM;;;;;;kCAEjC,qKAAC;wBACC,UAAU,WAAW,CAAC,IAAI;wBAC1B,cAAY,EAAE;wBACd,SAAS;wBACT,WAAW,CAAC,sBAAsB,EAAE,SAAS,OAAO,WAAW,+BAA+B,IAAI;kCAElG,cAAA,qKAAC,mOAAO;4BAAC,WAAU;;;;;;;;;;;kCAErB,qKAAC;wBACC,UAAU,WAAW,CAAC,IAAI;wBAC1B,cAAY,EAAE;wBACd,SAAS;wBACT,WAAW,CAAC,sBAAsB,EAAE,SAAS,OAAO,WAAW,+BAA+B,IAAI;kCAElG,cAAA,qKAAC,kOAAM;4BAAC,WAAU;;;;;;;;;;;;;;;;;;;;;;;AAK5B;uCAEe"}},
    {"offset": {"line": 5701, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/components/settings/FontDropDown.tsx"],"sourcesContent":["'use client';\n\nimport clsx from 'clsx';\nimport React, { useMemo } from 'react';\nimport { FixedSizeList as List } from 'react-window';\nimport { FiChevronUp, FiChevronLeft } from 'react-icons/fi';\nimport { MdCheck } from 'react-icons/md';\nimport { useEnv } from '@/context/EnvContext';\nimport { useTranslation } from '@/hooks/useTranslation';\nimport { useResponsiveSize } from '@/hooks/useResponsiveSize';\n\ninterface DropdownProps {\n  family?: string;\n  selected: string;\n  options: { option: string; label?: string }[];\n  moreOptions?: { option: string; label?: string }[];\n  onSelect: (option: string) => void;\n  onGetFontFamily: (option: string, family: string) => string;\n}\n\ninterface FontItemProps {\n  index: number;\n  style: React.CSSProperties;\n  data: {\n    options: { option: string; label?: string }[];\n    selected: string;\n    onSelect: (option: string) => void;\n    onGetFontFamily: (option: string, family: string) => string;\n    family: string;\n    iconSize: number;\n  };\n}\n\nconst FontItem: React.FC<FontItemProps> = ({ index, style, data }) => {\n  const { options, selected, onSelect, onGetFontFamily, family, iconSize: iconSize16 } = data;\n  const option = options[index]!;\n\n  return (\n    <li\n      role='option'\n      aria-selected={selected === option.option}\n      className='px-2'\n      key={option.option}\n      style={style}\n    >\n      <div\n        role='button'\n        tabIndex={0}\n        onClick={() => onSelect(option.option)}\n        onKeyDown={(e) => {\n          if (e.key === 'Enter' || e.key === ' ') {\n            onSelect(option.option);\n          }\n        }}\n        aria-label={option.label || option.option}\n        className='flex w-full items-center overflow-hidden !px-0 text-sm'\n      >\n        <span style={{ minWidth: `${iconSize16}px` }}>\n          {selected === option.option && (\n            <MdCheck className='text-base-content' size={iconSize16} />\n          )}\n        </span>\n        <span\n          className='line-clamp-1 overflow-visible break-all leading-loose'\n          style={{ fontFamily: onGetFontFamily(option.option, family) }}\n          title={option.label || option.option}\n        >\n          {option.label || option.option}\n        </span>\n      </div>\n    </li>\n  );\n};\n\nconst FontDropdown: React.FC<DropdownProps> = ({\n  family,\n  selected,\n  options,\n  moreOptions,\n  onSelect,\n  onGetFontFamily,\n}) => {\n  const _ = useTranslation();\n  const { appService } = useEnv();\n  const iconSize = useResponsiveSize(16);\n  const allOptions = [...options, ...(moreOptions ?? [])];\n  const selectedOption = allOptions.find((option) => option.option === selected) ?? allOptions[0]!;\n\n  const ITEM_HEIGHT = 40;\n  const MAX_HEIGHT = 320;\n\n  const mainListData = useMemo(\n    () => ({\n      options,\n      selected,\n      onSelect,\n      onGetFontFamily,\n      family: family ?? '',\n      iconSize,\n      appService,\n    }),\n    [options, selected, onSelect, onGetFontFamily, family, iconSize, appService],\n  );\n\n  const moreListData = useMemo(\n    () => ({\n      options: moreOptions ?? [],\n      selected,\n      onSelect,\n      onGetFontFamily,\n      family: family ?? '',\n      iconSize,\n    }),\n    [moreOptions, selected, onSelect, onGetFontFamily, family, iconSize],\n  );\n\n  return (\n    <div className='dropdown dropdown-top'>\n      <button\n        tabIndex={0}\n        className='btn btn-sm flex items-center px-[10px] font-normal normal-case sm:px-[20px]'\n        onClick={(e) => e.currentTarget.focus()}\n      >\n        <div className='flex items-center gap-x-1'>\n          <span\n            className='line-clamp-1 break-all leading-loose'\n            style={{\n              fontFamily: onGetFontFamily(selectedOption.option, family ?? ''),\n            }}\n          >\n            {selectedOption.label}\n          </span>\n          <FiChevronUp size={iconSize} />\n        </div>\n      </button>\n      <ul\n        role='listbox'\n        tabIndex={0}\n        className={clsx(\n          'dropdown-content bgcolor-base-200 no-triangle menu rounded-box absolute z-[1] mt-4 shadow',\n          'right-[-32px] w-[46vw] !px-0 sm:right-0 sm:w-44',\n          moreOptions?.length ? '' : 'inline overflow-hidden',\n        )}\n      >\n        {/* Virtualized main options */}\n        <div style={{ height: Math.min(options.length * ITEM_HEIGHT, MAX_HEIGHT) }}>\n          <List\n            width='100%'\n            height={Math.min(options.length * ITEM_HEIGHT, MAX_HEIGHT)}\n            itemCount={options.length}\n            itemSize={ITEM_HEIGHT}\n            itemData={mainListData}\n          >\n            {FontItem}\n          </List>\n        </div>\n\n        {/* More options with nested dropdown */}\n        {moreOptions && moreOptions.length > 0 && (\n          <li className='dropdown dropdown-left dropdown-top px-2'>\n            <div className='flex items-center px-0 text-sm'>\n              <span style={{ minWidth: `${iconSize}px` }}>\n                <FiChevronLeft size={iconSize} />\n              </span>\n              <span>{_('System Fonts')}</span>\n            </div>\n            <ul\n              role='listbox'\n              tabIndex={0}\n              className={clsx(\n                'dropdown-content bgcolor-base-200 menu rounded-box relative z-[1] shadow',\n                '!mr-4 mb-[-46px] inline w-[46vw] overflow-hidden !px-0 sm:w-[200px]',\n              )}\n            >\n              {/* Virtualized more options */}\n              <div style={{ height: Math.min(moreOptions.length * ITEM_HEIGHT, MAX_HEIGHT) }}>\n                <List\n                  width='100%'\n                  height={Math.min(moreOptions.length * ITEM_HEIGHT, MAX_HEIGHT)}\n                  itemCount={moreOptions.length}\n                  itemSize={ITEM_HEIGHT}\n                  itemData={moreListData}\n                >\n                  {FontItem}\n                </List>\n              </div>\n            </ul>\n          </li>\n        )}\n      </ul>\n    </div>\n  );\n};\n\nexport default FontDropdown;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 5990, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/components/settings/CustomFonts.tsx"],"sourcesContent":["'use client';\n\nimport clsx from 'clsx';\nimport React, { useState } from 'react';\nimport { MdAdd, MdDelete } from 'react-icons/md';\nimport { IoMdCloseCircleOutline } from 'react-icons/io';\nimport { useEnv } from '@/context/EnvContext';\nimport { useReaderStore } from '@/store/readerStore';\nimport { useTranslation } from '@/hooks/useTranslation';\nimport { useSettingsStore } from '@/store/settingsStore';\nimport { useCustomFontStore } from '@/store/customFontStore';\nimport { useFileSelector } from '@/hooks/useFileSelector';\nimport { saveViewSettings } from '@/helpers/settings';\nimport { CustomFont, mountCustomFont } from '@/styles/fonts';\n\ninterface CustomFontsProps {\n  bookKey: string;\n  onBack: () => void;\n}\n\ntype FontFamily = {\n  name: string;\n  fonts: CustomFont[];\n};\n\nconst CustomFonts: React.FC<CustomFontsProps> = ({ bookKey, onBack }) => {\n  const _ = useTranslation();\n  const { appService, envConfig } = useEnv();\n  const { settings } = useSettingsStore();\n  const {\n    fonts: customFonts,\n    addFont,\n    loadFont,\n    removeFont,\n    getAvailableFonts,\n    saveCustomFonts,\n  } = useCustomFontStore();\n  const { getViewSettings } = useReaderStore();\n  const viewSettings = getViewSettings(bookKey) || settings.globalViewSettings;\n  const [isDeleteMode, setIsDeleteMode] = useState(false);\n\n  const { selectFiles } = useFileSelector(appService, _);\n\n  const currentDefaultFont =\n    viewSettings.defaultFont.toLowerCase() === 'serif' ? 'serif' : 'sans-serif';\n\n  const currentFontFamily =\n    currentDefaultFont === 'serif' ? viewSettings.serifFont : viewSettings.sansSerifFont;\n\n  const handleImportFont = () => {\n    selectFiles({ type: 'fonts', multiple: true }).then(async (result) => {\n      if (result.error || result.files.length === 0) return;\n      for (const selectedFile of result.files) {\n        const fontInfo = await appService?.importFont(selectedFile.path || selectedFile.file);\n        if (!fontInfo) continue;\n\n        const customFont = addFont(fontInfo.path, {\n          name: fontInfo.name,\n          family: fontInfo.family,\n          style: fontInfo.style,\n          weight: fontInfo.weight,\n          variable: fontInfo.variable,\n        });\n        console.log('Added custom font:', customFont);\n        if (customFont && !customFont.error) {\n          const loadedFont = await loadFont(envConfig, customFont.id);\n          mountCustomFont(document, loadedFont);\n        }\n      }\n      saveCustomFonts(envConfig);\n    });\n  };\n\n  const handleDeleteFamily = (family: FontFamily) => {\n    for (const font of family.fonts) {\n      if (font) {\n        if (removeFont(font.id)) {\n          appService?.deleteFont(font);\n          saveCustomFonts(envConfig);\n          if (getAvailableFonts().length === 0) {\n            setIsDeleteMode(false);\n          }\n        }\n      }\n    }\n  };\n\n  const handleSelectFamily = (family: FontFamily) => {\n    if (currentDefaultFont === 'serif') {\n      saveViewSettings(envConfig, bookKey, 'serifFont', family.name);\n    } else {\n      saveViewSettings(envConfig, bookKey, 'sansSerifFont', family.name);\n    }\n  };\n\n  const toggleDeleteMode = () => {\n    setIsDeleteMode(!isDeleteMode);\n  };\n\n  const getAvailableFamilies = (fonts: CustomFont[]): FontFamily[] => {\n    const familyMap = new Map<string, string[]>();\n\n    for (const font of fonts) {\n      const family = font.family || font.name;\n      if (!familyMap.has(family)) {\n        familyMap.set(family, []);\n      }\n      familyMap.get(family)!.push(font.id);\n    }\n\n    return Array.from(familyMap.entries()).map(([family, ids]) => ({\n      name: family,\n      fonts: ids.map((id) => fonts.find((f) => f.id === id)!).filter((f): f is CustomFont => !!f),\n    }));\n  };\n\n  const availableFonts = customFonts\n    .filter((font) => !font.deletedAt)\n    .sort((a, b) => (b.downloadedAt || 0) - (a.downloadedAt || 0));\n\n  const availableFamilies = getAvailableFamilies(availableFonts);\n\n  return (\n    <div className='w-full'>\n      <div className='mb-6 flex h-8 items-center justify-between'>\n        <div className='breadcrumbs py-1'>\n          <ul>\n            <li>\n              <button className='font-semibold' onClick={onBack}>\n                {_('Font')}\n              </button>\n            </li>\n            <li className='font-medium'>{_('Custom Fonts')}</li>\n          </ul>\n        </div>\n        {availableFonts.length > 0 && (\n          <button\n            onClick={toggleDeleteMode}\n            className={`btn btn-ghost btn-sm text-base-content gap-2`}\n            title={isDeleteMode ? _('Cancel Delete') : _('Delete Font')}\n          >\n            {isDeleteMode ? (\n              <>{_('Cancel')}</>\n            ) : (\n              <>\n                <MdDelete className='h-4 w-4' />\n                {_('Delete')}\n              </>\n            )}\n          </button>\n        )}\n      </div>\n\n      <div className='grid grid-cols-2 gap-4'>\n        <div className='card border-primary/50 hover:border-primary/75 group h-12 border-2 transition-colors'>\n          <button\n            className='card-body flex cursor-pointer items-center justify-center p-2 text-center'\n            onClick={handleImportFont}\n          >\n            <div className='flex items-center gap-2'>\n              <div className='flex items-center justify-center'>\n                <MdAdd className='text-primary/85 group-hover:text-primary h-6 w-6' />\n              </div>\n              <div className='text-primary/85 group-hover:text-primary line-clamp-1 font-medium'>\n                {_('Import Font')}\n              </div>\n            </div>\n          </button>\n        </div>\n\n        {availableFamilies.map((family) => (\n          <div\n            role='none'\n            key={family.name}\n            className={clsx(\n              'card h-12 border shadow-sm',\n              currentFontFamily === family.name\n                ? 'border-primary/50 bg-primary/50'\n                : `border-base-200 bg-base-200 ${isDeleteMode ? '' : 'cursor-pointer'}`,\n            )}\n            onClick={!isDeleteMode ? () => handleSelectFamily(family) : undefined}\n            title={family.fonts.map((f) => f.name).join('\\n')}\n          >\n            <div className='card-body flex items-center justify-center p-2'>\n              <div\n                style={{\n                  fontFamily: `\"${family.name}\", sans-serif`,\n                  fontWeight: 400,\n                }}\n                className='text-base-content line-clamp-1 break-all'\n              >\n                {family.name}\n              </div>\n              {isDeleteMode && (\n                <button\n                  onClick={() => handleDeleteFamily(family)}\n                  className='btn btn-ghost btn-xs absolute right-[-10px] top-[-10px] h-6 min-h-0 w-6 p-0 hover:bg-transparent'\n                  title={_('Delete Font')}\n                >\n                  <IoMdCloseCircleOutline className='text-base-content/75 h-6 w-6' />\n                </button>\n              )}\n            </div>\n          </div>\n        ))}\n      </div>\n\n      <div className='bg-base-200/30 my-8 rounded-lg p-4'>\n        <div className='text-base-content/70 text-sm sm:text-xs'>\n          <div className='mb-1 indent-2 font-medium'>{_('Tips')}:</div>\n          <ul className='list-outside list-disc space-y-1 ps-2'>\n            <li>{_('Supported font formats: .ttf, .otf, .woff, .woff2')}</li>\n            <li>{_('Custom fonts can be selected from the Font Face menu')}</li>\n          </ul>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default CustomFonts;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 6347, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/components/settings/FontPanel.tsx"],"sourcesContent":["'use client';\n\nimport clsx from 'clsx';\nimport React, { useEffect, useState } from 'react';\nimport { MdSettings } from 'react-icons/md';\n\nimport {\n  CJK_EXCLUDE_PATTENS,\n  CJK_FONTS_PATTENS,\n  CJK_SANS_SERIF_FONTS,\n  CJK_SERIF_FONTS,\n  IOS_FONTS,\n  LINUX_FONTS,\n  MACOS_FONTS,\n  MONOSPACE_FONTS,\n  NON_FREE_FONTS,\n  SANS_SERIF_FONTS,\n  SERIF_FONTS,\n  WINDOWS_FONTS,\n} from '@/services/constants';\nimport { useEnv } from '@/context/EnvContext';\nimport { useReaderStore } from '@/store/readerStore';\nimport { useTranslation } from '@/hooks/useTranslation';\nimport { useSettingsStore } from '@/store/settingsStore';\nimport { useCustomFontStore } from '@/store/customFontStore';\nimport { useResponsiveSize } from '@/hooks/useResponsiveSize';\nimport { getOSPlatform, isCJKEnv } from '@/utils/misc';\nimport { getSysFontsList } from '@/utils/bridge';\nimport { isCJKStr } from '@/utils/lang';\nimport { isTauriAppPlatform } from '@/services/environment';\nimport { useResetViewSettings } from '@/hooks/useResetSettings';\nimport { saveViewSettings } from '@/helpers/settings';\nimport { SettingsPanelPanelProp } from './SettingsDialog';\nimport NumberInput from './NumberInput';\nimport FontDropdown from './FontDropDown';\nimport CustomFonts from './CustomFonts';\n\nconst genCJKFontsList = (sysFonts: string[]) => {\n  return Array.from(new Set([...sysFonts, ...CJK_SERIF_FONTS, ...CJK_SANS_SERIF_FONTS]))\n    .filter((font) => CJK_FONTS_PATTENS.test(font) || isCJKStr(font))\n    .filter((font) => !CJK_EXCLUDE_PATTENS.test(font))\n    .sort((a, b) => a.localeCompare(b));\n};\n\nconst isSymbolicFontName = (font: string) =>\n  /emoji|icons|symbol|dingbats|ornaments|webdings|wingdings|miuiex/i.test(font);\n\ninterface FontFaceProps {\n  className?: string;\n  family: string;\n  label: string;\n  options: string[];\n  moreOptions?: string[];\n  selected: string;\n  onSelect: (option: string) => void;\n}\n\nconst handleFontFaceFont = (option: string, family: string) => {\n  return `'${option}', ${family}`;\n};\n\nconst filterNonFreeFonts = (font: string) => {\n  return !['android', 'linux'].includes(getOSPlatform()) || !NON_FREE_FONTS.includes(font);\n};\n\nconst FontFace = ({\n  className,\n  family,\n  label,\n  options,\n  moreOptions,\n  selected,\n  onSelect,\n}: FontFaceProps) => {\n  const _ = useTranslation();\n  return (\n    <div className={clsx('config-item', className)}>\n      <span className='line-clamp-2 min-w-10'>{label}</span>\n      <FontDropdown\n        family={family}\n        options={options.map((option) => ({ option, label: _(option) }))}\n        moreOptions={moreOptions?.map((option) => ({ option, label: option })) ?? []}\n        selected={selected}\n        onSelect={onSelect}\n        onGetFontFamily={handleFontFaceFont}\n      />\n    </div>\n  );\n};\n\nconst FontPanel: React.FC<SettingsPanelPanelProp> = ({ bookKey, onRegisterReset }) => {\n  const _ = useTranslation();\n  const { envConfig, appService } = useEnv();\n  const { getView, getViewSettings } = useReaderStore();\n  const { settings, fontPanelView, setFontPanelView } = useSettingsStore();\n  const { fonts: allCustomFonts, getFontFamilies } = useCustomFontStore();\n  const viewSettings = getViewSettings(bookKey) || settings.globalViewSettings;\n  const view = getView(bookKey);\n  const iconSize18 = useResponsiveSize(18);\n\n  const fontFamilyOptions = [\n    {\n      option: 'Serif',\n      label: _('Serif Font'),\n    },\n    {\n      option: 'Sans-serif',\n      label: _('Sans-Serif Font'),\n    },\n  ];\n\n  const osPlatform = getOSPlatform();\n  let defaultSysFonts: string[] = [];\n  switch (osPlatform) {\n    case 'macos':\n      defaultSysFonts = MACOS_FONTS;\n      break;\n    case 'windows':\n      defaultSysFonts = WINDOWS_FONTS;\n      break;\n    case 'linux':\n      defaultSysFonts = LINUX_FONTS;\n      break;\n    case 'ios':\n      defaultSysFonts = IOS_FONTS;\n      break;\n    case 'android':\n      defaultSysFonts = [];\n      break;\n    default:\n      break;\n  }\n  const [sysFonts, setSysFonts] = useState<string[]>(defaultSysFonts);\n  const [defaultFont, setDefaultFont] = useState(viewSettings.defaultFont);\n  const [defaultFontSize, setDefaultFontSize] = useState(viewSettings.defaultFontSize);\n  const [minFontSize, setMinFontSize] = useState(viewSettings.minimumFontSize);\n  const [overrideFont, setOverrideFont] = useState(viewSettings.overrideFont);\n  const [defaultCJKFont, setDefaultCJKFont] = useState(viewSettings.defaultCJKFont);\n  const [serifFont, setSerifFont] = useState(viewSettings.serifFont);\n  const [sansSerifFont, setSansSerifFont] = useState(viewSettings.sansSerifFont);\n  const [monospaceFont, setMonospaceFont] = useState(viewSettings.monospaceFont);\n  const [fontWeight, setFontWeight] = useState(viewSettings.fontWeight);\n\n  const [customFonts, setCustomFonts] = useState<string[]>(getFontFamilies());\n  const [CJKFonts, setCJKFonts] = useState<string[]>(() => {\n    return genCJKFontsList([...customFonts, ...sysFonts]);\n  });\n\n  const resetToDefaults = useResetViewSettings();\n\n  const handleReset = () => {\n    resetToDefaults({\n      defaultFont: setDefaultFont,\n      defaultFontSize: setDefaultFontSize,\n      minimumFontSize: setMinFontSize,\n      overrideFont: setOverrideFont,\n      defaultCJKFont: setDefaultCJKFont,\n      serifFont: setSerifFont,\n      sansSerifFont: setSansSerifFont,\n      monospaceFont: setMonospaceFont,\n      fontWeight: setFontWeight,\n    });\n  };\n\n  const handleManageCustomFonts = () => {\n    setFontPanelView('custom-fonts');\n  };\n\n  const handleBackToMain = () => {\n    setFontPanelView('main-fonts');\n  };\n\n  useEffect(() => {\n    onRegisterReset(handleReset);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [appService]);\n\n  useEffect(() => {\n    setCJKFonts((prev) => {\n      const newFonts = genCJKFontsList([...customFonts, ...sysFonts]);\n      return prev.length !== newFonts.length ? newFonts : prev;\n    });\n  }, [customFonts, sysFonts]);\n\n  useEffect(() => {\n    setCustomFonts(getFontFamilies());\n  }, [allCustomFonts, getFontFamilies]);\n\n  useEffect(() => {\n    setSerifFont(viewSettings.serifFont);\n    setSansSerifFont(viewSettings.sansSerifFont);\n    setMonospaceFont(viewSettings.monospaceFont);\n  }, [viewSettings.serifFont, viewSettings.sansSerifFont, viewSettings.monospaceFont]);\n\n  useEffect(() => {\n    if (isTauriAppPlatform() && appService && !appService.isAndroidApp) {\n      getSysFontsList().then((res) => {\n        if (res.error || Object.keys(res.fonts).length === 0) {\n          console.error('Failed to get system fonts list:', res.error);\n          return;\n        }\n        const processedFonts: string[] = [];\n        Object.entries(res.fonts).forEach(([fontName, fontFamily]) => {\n          if (!fontName || isSymbolicFontName(fontName)) return;\n\n          const fontsInFamily = Object.entries(res.fonts).filter(\n            ([_, family]) => family === fontFamily,\n          );\n\n          if (fontsInFamily.length === 1) {\n            processedFonts.push(fontFamily);\n          } else {\n            processedFonts.push(fontName);\n          }\n        });\n        setSysFonts([...new Set(processedFonts)].sort((a, b) => a.localeCompare(b)));\n      });\n    }\n  }, [appService]);\n\n  useEffect(() => {\n    saveViewSettings(envConfig, bookKey, 'defaultFont', defaultFont);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [defaultFont]);\n\n  useEffect(() => {\n    saveViewSettings(envConfig, bookKey, 'defaultCJKFont', defaultCJKFont);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [defaultCJKFont]);\n\n  useEffect(() => {\n    saveViewSettings(envConfig, bookKey, 'defaultFontSize', defaultFontSize);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [defaultFontSize]);\n\n  useEffect(() => {\n    saveViewSettings(envConfig, bookKey, 'minimumFontSize', minFontSize);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [minFontSize]);\n\n  useEffect(() => {\n    saveViewSettings(envConfig, bookKey, 'fontWeight', fontWeight);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [fontWeight]);\n\n  useEffect(() => {\n    saveViewSettings(envConfig, bookKey, 'serifFont', serifFont);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [serifFont]);\n\n  useEffect(() => {\n    saveViewSettings(envConfig, bookKey, 'sansSerifFont', sansSerifFont);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [sansSerifFont]);\n\n  useEffect(() => {\n    saveViewSettings(envConfig, bookKey, 'monospaceFont', monospaceFont);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [monospaceFont]);\n\n  useEffect(() => {\n    saveViewSettings(envConfig, bookKey, 'overrideFont', overrideFont);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [overrideFont]);\n\n  const handleFontFamilyFont = (option: string) => {\n    switch (option) {\n      case 'Serif':\n        return `'${serifFont}', serif`;\n      case 'Sans-serif':\n        return `'${sansSerifFont}', sans-serif`;\n      case 'Monospace':\n        return `'${monospaceFont}', monospace`;\n      default:\n        return '';\n    }\n  };\n\n  if (fontPanelView === 'custom-fonts') {\n    return (\n      <div className='my-4 w-full'>\n        <CustomFonts bookKey={bookKey} onBack={handleBackToMain} />\n      </div>\n    );\n  }\n\n  return (\n    <div className='my-4 w-full space-y-6'>\n      <div className='flex items-center justify-between'>\n        <h2 className='font-medium'>{_('Override Book Font')}</h2>\n        <input\n          type='checkbox'\n          className='toggle'\n          checked={overrideFont}\n          onChange={() => setOverrideFont(!overrideFont)}\n        />\n      </div>\n\n      <div className='w-full'>\n        <h2 className='mb-2 font-medium'>{_('Font Size')}</h2>\n        <div className='card border-base-200 border shadow'>\n          <div className='divide-base-200 divide-y'>\n            <NumberInput\n              label={_('Default Font Size')}\n              value={defaultFontSize}\n              onChange={setDefaultFontSize}\n              min={minFontSize}\n              max={120}\n            />\n            <NumberInput\n              label={_('Minimum Font Size')}\n              value={minFontSize}\n              onChange={setMinFontSize}\n              min={1}\n              max={120}\n            />\n          </div>\n        </div>\n      </div>\n\n      <div className='w-full'>\n        <h2 className='mb-2 font-medium'>{_('Font Weight')}</h2>\n        <div className='card border-base-200 border shadow'>\n          <div className='divide-base-200 divide-y'>\n            <NumberInput\n              label={_('Font Weight')}\n              value={fontWeight}\n              onChange={setFontWeight}\n              min={100}\n              max={900}\n              step={100}\n            />\n          </div>\n        </div>\n      </div>\n\n      <div className='w-full'>\n        <h2 className='mb-2 font-medium'>{_('Font Family')}</h2>\n        <div className='card border-base-200 border shadow'>\n          <div className='divide-base-200 divide-y'>\n            <div className='config-item'>\n              <span className=''>{_('Default Font')}</span>\n              <FontDropdown\n                options={fontFamilyOptions}\n                selected={defaultFont}\n                onSelect={setDefaultFont}\n                onGetFontFamily={handleFontFamilyFont}\n              />\n            </div>\n\n            {(isCJKEnv() || view?.language.isCJK) && (\n              <FontFace\n                className='config-item-top'\n                family='serif'\n                label={_('CJK Font')}\n                options={CJKFonts}\n                selected={defaultCJKFont}\n                onSelect={setDefaultCJKFont}\n              />\n            )}\n          </div>\n        </div>\n      </div>\n\n      <div className='w-full'>\n        <div className='mb-2 flex items-center justify-between'>\n          <h2 className='font-medium'>{_('Font Face')}</h2>\n          <button\n            onClick={handleManageCustomFonts}\n            className='btn btn-ghost btn-xs gap-1 hover:bg-transparent'\n            title={_('Manage Custom Fonts')}\n          >\n            <MdSettings size={iconSize18} />\n          </button>\n        </div>\n        <div className='card border-base-200 border shadow'>\n          <div className='divide-base-200 divide-y'>\n            <FontFace\n              className='config-item-top'\n              family='serif'\n              label={_('Serif Font')}\n              options={[\n                ...customFonts,\n                ...SERIF_FONTS.filter(filterNonFreeFonts),\n                ...CJK_SERIF_FONTS,\n              ]}\n              moreOptions={sysFonts}\n              selected={serifFont}\n              onSelect={setSerifFont}\n            />\n            <FontFace\n              family='sans-serif'\n              label={_('Sans-Serif Font')}\n              options={[\n                ...customFonts,\n                ...SANS_SERIF_FONTS.filter(filterNonFreeFonts),\n                ...CJK_SANS_SERIF_FONTS,\n              ]}\n              moreOptions={sysFonts}\n              selected={sansSerifFont}\n              onSelect={setSansSerifFont}\n            />\n            <FontFace\n              className='config-item-bottom'\n              family='monospace'\n              label={_('Monospace Font')}\n              options={[...customFonts, ...MONOSPACE_FONTS]}\n              moreOptions={sysFonts}\n              selected={monospaceFont}\n              onSelect={setMonospaceFont}\n            />\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default FontPanel;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 7001, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/components/settings/LayoutPanel.tsx"],"sourcesContent":["'use client';\n\nimport React, { useEffect, useState } from 'react';\nimport { MdOutlineAutoMode, MdOutlineScreenRotation } from 'react-icons/md';\nimport { MdOutlineTextRotationNone, MdTextRotateVertical } from 'react-icons/md';\nimport { IoPhoneLandscapeOutline, IoPhonePortraitOutline } from 'react-icons/io5';\nimport { TbTextDirectionRtl } from 'react-icons/tb';\n\nimport { useEnv } from '@/context/EnvContext';\nimport { useReaderStore } from '@/store/readerStore';\nimport { useBookDataStore } from '@/store/bookDataStore';\nimport { useSettingsStore } from '@/store/settingsStore';\nimport { useTranslation } from '@/hooks/useTranslation';\nimport { useResetViewSettings } from '@/hooks/useResetSettings';\nimport { isCJKEnv } from '@/utils/misc';\nimport { getStyles } from '@/utils/style';\nimport { getMaxInlineSize } from '@/utils/config';\nimport { lockScreenOrientation } from '@/utils/bridge';\nimport { saveViewSettings } from '@/helpers/settings';\nimport { getBookDirFromWritingMode, getBookLangCode } from '@/utils/book';\nimport { MIGHT_BE_RTL_LANGS } from '@/services/constants';\nimport { SettingsPanelPanelProp } from './SettingsDialog';\nimport Select from '@/components/Select';\nimport NumberInput from './NumberInput';\n\nconst LayoutPanel: React.FC<SettingsPanelPanelProp> = ({ bookKey, onRegisterReset }) => {\n  const _ = useTranslation();\n  const { envConfig, appService } = useEnv();\n  const { settings } = useSettingsStore();\n  const { getView, getViewSettings, getGridInsets } = useReaderStore();\n  const { setViewSettings, recreateViewer } = useReaderStore();\n  const { getBookData } = useBookDataStore();\n  const viewSettings = getViewSettings(bookKey) || settings.globalViewSettings;\n\n  const view = getView(bookKey);\n  const bookData = getBookData(bookKey);\n  const gridInsets = getGridInsets(bookKey) || { top: 0, bottom: 0, left: 0, right: 0 };\n\n  const [paragraphMargin, setParagraphMargin] = useState(viewSettings.paragraphMargin);\n  const [lineHeight, setLineHeight] = useState(viewSettings.lineHeight);\n  const [wordSpacing, setWordSpacing] = useState(viewSettings.wordSpacing);\n  const [letterSpacing, setLetterSpacing] = useState(viewSettings.letterSpacing);\n  const [textIndent, setTextIndent] = useState(viewSettings.textIndent!);\n  const [fullJustification, setFullJustification] = useState(viewSettings.fullJustification);\n  const [hyphenation, setHyphenation] = useState(viewSettings.hyphenation);\n  const [marginTopPx, setMarginTopPx] = useState(viewSettings.marginPx || viewSettings.marginTopPx);\n  const [marginBottomPx, setMarginBottomPx] = useState(viewSettings.marginBottomPx);\n  const [marginLeftPx, setMarginLeftPx] = useState(viewSettings.marginLeftPx);\n  const [marginRightPx, setMarginRightPx] = useState(viewSettings.marginRightPx);\n  const [compactMarginTopPx, setCompactMarginTopPx] = useState(\n    viewSettings.compactMarginPx || viewSettings.compactMarginTopPx,\n  );\n  const [compactMarginBottomPx, setCompactMarginBottomPx] = useState(\n    viewSettings.compactMarginBottomPx,\n  );\n  const [gapPercent, setGapPercent] = useState(viewSettings.gapPercent);\n  const [compactMarginLeftPx, setCompactMarginLeftPx] = useState(viewSettings.compactMarginLeftPx);\n  const [compactMarginRightPx, setCompactMarginRightPx] = useState(\n    viewSettings.compactMarginRightPx,\n  );\n  const [maxColumnCount, setMaxColumnCount] = useState(viewSettings.maxColumnCount);\n  const [maxInlineSize, setMaxInlineSize] = useState(viewSettings.maxInlineSize);\n  const [maxBlockSize, setMaxBlockSize] = useState(viewSettings.maxBlockSize);\n  const [writingMode, setWritingMode] = useState(viewSettings.writingMode);\n  const [overrideLayout, setOverrideLayout] = useState(viewSettings.overrideLayout);\n  const [doubleBorder, setDoubleBorder] = useState(viewSettings.doubleBorder);\n  const [borderColor, setBorderColor] = useState(viewSettings.borderColor);\n  const [showHeader, setShowHeader] = useState(viewSettings.showHeader);\n  const [showFooter, setShowFooter] = useState(viewSettings.showFooter);\n  const [showBarsOnScroll, setShowBarsOnScroll] = useState(viewSettings.showBarsOnScroll);\n  const [showMarginsOnScroll, setShowMarginsOnScroll] = useState(viewSettings.showMarginsOnScroll);\n  const [showRemainingTime, setShowRemainingTime] = useState(viewSettings.showRemainingTime);\n  const [showRemainingPages, setShowRemainingPages] = useState(viewSettings.showRemainingPages);\n  const [showProgressInfo, setShowProgressInfo] = useState(viewSettings.showProgressInfo);\n  const [tapToToggleFooter, setTapToToggleFooter] = useState(viewSettings.tapToToggleFooter);\n  const [progressStyle, setProgressStyle] = useState(viewSettings.progressStyle);\n  const [screenOrientation, setScreenOrientation] = useState(viewSettings.screenOrientation);\n  const resetToDefaults = useResetViewSettings();\n\n  const handleReset = () => {\n    resetToDefaults({\n      paragraphMargin: setParagraphMargin,\n      lineHeight: setLineHeight,\n      wordSpacing: setWordSpacing,\n      letterSpacing: setLetterSpacing,\n      textIndent: setTextIndent,\n      fullJustification: setFullJustification,\n      hyphenation: setHyphenation,\n      marginTopPx: setMarginTopPx,\n      marginBottomPx: setMarginBottomPx,\n      marginLeftPx: setMarginLeftPx,\n      marginRightPx: setMarginRightPx,\n      compactMarginTopPx: setCompactMarginTopPx,\n      compactMarginBottomPx: setCompactMarginBottomPx,\n      compactMarginLeftPx: setCompactMarginLeftPx,\n      compactMarginRightPx: setCompactMarginRightPx,\n      gapPercent: setGapPercent,\n      maxColumnCount: setMaxColumnCount,\n      maxInlineSize: setMaxInlineSize,\n      maxBlockSize: setMaxBlockSize,\n      overrideLayout: setOverrideLayout,\n      doubleBorder: setDoubleBorder,\n      borderColor: setBorderColor,\n      showHeader: setShowHeader,\n      showFooter: setShowFooter,\n      showBarsOnScroll: setShowBarsOnScroll,\n      showRemainingTime: setShowRemainingTime,\n      showRemainingPages: setShowRemainingPages,\n      showProgressInfo: setShowProgressInfo,\n      tapToToggleFooter: setTapToToggleFooter,\n      showMarginsOnScroll: setShowMarginsOnScroll,\n    });\n  };\n\n  useEffect(() => {\n    onRegisterReset(handleReset);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  useEffect(() => {\n    saveViewSettings(envConfig, bookKey, 'paragraphMargin', paragraphMargin);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [paragraphMargin]);\n\n  useEffect(() => {\n    saveViewSettings(envConfig, bookKey, 'lineHeight', lineHeight);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [lineHeight]);\n\n  useEffect(() => {\n    saveViewSettings(envConfig, bookKey, 'wordSpacing', wordSpacing);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [wordSpacing]);\n\n  useEffect(() => {\n    saveViewSettings(envConfig, bookKey, 'letterSpacing', letterSpacing);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [letterSpacing]);\n\n  useEffect(() => {\n    saveViewSettings(envConfig, bookKey, 'textIndent', textIndent);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [textIndent]);\n\n  useEffect(() => {\n    saveViewSettings(envConfig, bookKey, 'fullJustification', fullJustification);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [fullJustification]);\n\n  useEffect(() => {\n    saveViewSettings(envConfig, bookKey, 'hyphenation', hyphenation);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [hyphenation]);\n\n  useEffect(() => {\n    if (marginTopPx === viewSettings.marginTopPx) return;\n    if (viewSettings.marginPx !== undefined) {\n      saveViewSettings(envConfig, bookKey, 'marginPx', undefined, false, false);\n    }\n    saveViewSettings(envConfig, bookKey, 'marginTopPx', marginTopPx, false, false);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [marginTopPx]);\n\n  useEffect(() => {\n    if (marginBottomPx === viewSettings.marginBottomPx) return;\n    if (viewSettings.marginPx !== undefined) {\n      saveViewSettings(envConfig, bookKey, 'marginPx', undefined, false, false);\n    }\n    saveViewSettings(envConfig, bookKey, 'marginBottomPx', marginBottomPx, false, false);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [marginBottomPx]);\n\n  useEffect(() => {\n    if (marginRightPx === viewSettings.marginRightPx) return;\n    if (viewSettings.marginPx !== undefined) {\n      saveViewSettings(envConfig, bookKey, 'marginPx', undefined, false, false);\n    }\n    saveViewSettings(envConfig, bookKey, 'marginRightPx', marginRightPx, false, false);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [marginRightPx]);\n\n  useEffect(() => {\n    if (marginLeftPx === viewSettings.marginLeftPx) return;\n    if (viewSettings.marginPx !== undefined) {\n      saveViewSettings(envConfig, bookKey, 'marginPx', undefined, false, false);\n    }\n    saveViewSettings(envConfig, bookKey, 'marginLeftPx', marginLeftPx, false, false);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [marginLeftPx]);\n\n  useEffect(() => {\n    if (compactMarginTopPx === viewSettings.compactMarginTopPx) return;\n    if (viewSettings.compactMarginPx !== undefined) {\n      saveViewSettings(envConfig, bookKey, 'compactMarginPx', undefined, false, false);\n    }\n    saveViewSettings(envConfig, bookKey, 'compactMarginTopPx', compactMarginTopPx, false, false);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [compactMarginTopPx]);\n\n  useEffect(() => {\n    if (compactMarginBottomPx === viewSettings.compactMarginBottomPx) return;\n    if (viewSettings.compactMarginPx !== undefined) {\n      saveViewSettings(envConfig, bookKey, 'compactMarginPx', undefined, false, false);\n    }\n    saveViewSettings(\n      envConfig,\n      bookKey,\n      'compactMarginBottomPx',\n      compactMarginBottomPx,\n      false,\n      false,\n    );\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [compactMarginBottomPx]);\n\n  useEffect(() => {\n    if (compactMarginRightPx === viewSettings.compactMarginRightPx) return;\n    if (viewSettings.compactMarginPx !== undefined) {\n      saveViewSettings(envConfig, bookKey, 'compactMarginPx', undefined, false, false);\n    }\n    saveViewSettings(\n      envConfig,\n      bookKey,\n      'compactMarginRightPx',\n      compactMarginRightPx,\n      false,\n      false,\n    );\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [compactMarginRightPx]);\n\n  useEffect(() => {\n    if (compactMarginLeftPx === viewSettings.compactMarginLeftPx) return;\n    if (viewSettings.compactMarginPx !== undefined) {\n      saveViewSettings(envConfig, bookKey, 'compactMarginPx', undefined, false, false);\n    }\n    saveViewSettings(envConfig, bookKey, 'compactMarginLeftPx', compactMarginLeftPx, false, false);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [compactMarginLeftPx]);\n\n  useEffect(() => {\n    if (gapPercent === viewSettings.gapPercent) return;\n    saveViewSettings(envConfig, bookKey, 'gapPercent', gapPercent, false, false);\n    view?.renderer.setAttribute('gap', `${gapPercent}%`);\n    if (viewSettings.scrolled) {\n      view?.renderer.setAttribute('flow', 'scrolled');\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [gapPercent]);\n\n  useEffect(() => {\n    if (maxColumnCount === viewSettings.maxColumnCount) return;\n    saveViewSettings(envConfig, bookKey, 'maxColumnCount', maxColumnCount, false, false);\n    const newViewSettings = getViewSettings(bookKey)!;\n    view?.renderer.setAttribute('max-column-count', maxColumnCount);\n    view?.renderer.setAttribute('max-inline-size', `${getMaxInlineSize(newViewSettings)}px`);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [maxColumnCount]);\n\n  useEffect(() => {\n    if (maxInlineSize === viewSettings.maxInlineSize) return;\n    saveViewSettings(envConfig, bookKey, 'maxInlineSize', maxInlineSize, false, false);\n    const newViewSettings = getViewSettings(bookKey)!;\n    view?.renderer.setAttribute('max-inline-size', `${getMaxInlineSize(newViewSettings)}px`);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [maxInlineSize]);\n\n  useEffect(() => {\n    if (maxBlockSize === viewSettings.maxBlockSize) return;\n    saveViewSettings(envConfig, bookKey, 'maxBlockSize', maxBlockSize, false, false);\n    view?.renderer.setAttribute('max-block-size', `${maxBlockSize}px`);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [maxBlockSize]);\n\n  useEffect(() => {\n    if (writingMode === viewSettings.writingMode) return;\n    // global settings are not supported for writing mode\n    const prevWritingMode = viewSettings.writingMode;\n    if (writingMode.includes('vertical')) {\n      viewSettings.vertical = true;\n    } else {\n      viewSettings.vertical = false;\n    }\n    saveViewSettings(envConfig, bookKey, 'writingMode', writingMode, true).then(() => {\n      if (view) {\n        const newViewSettings = getViewSettings(bookKey)!;\n        view.renderer.setStyles?.(getStyles(newViewSettings));\n        view.book.dir = getBookDirFromWritingMode(writingMode);\n      }\n      if (\n        prevWritingMode !== writingMode &&\n        (['horizontal-rl', 'vertical-rl'].includes(writingMode) ||\n          ['horizontal-rl', 'vertical-rl'].includes(prevWritingMode))\n      ) {\n        recreateViewer(envConfig, bookKey);\n      }\n    });\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [writingMode]);\n\n  useEffect(() => {\n    if (overrideLayout === viewSettings.overrideLayout) return;\n    saveViewSettings(envConfig, bookKey, 'overrideLayout', overrideLayout);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [overrideLayout]);\n\n  useEffect(() => {\n    if (doubleBorder === viewSettings.doubleBorder) return;\n    saveViewSettings(envConfig, bookKey, 'doubleBorder', doubleBorder, false, false);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [doubleBorder]);\n\n  useEffect(() => {\n    saveViewSettings(envConfig, bookKey, 'borderColor', borderColor, false, false);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [borderColor]);\n\n  useEffect(() => {\n    saveViewSettings(envConfig, bookKey, 'showBarsOnScroll', showBarsOnScroll, false, false);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [showBarsOnScroll]);\n\n  useEffect(() => {\n    saveViewSettings(envConfig, bookKey, 'showMarginsOnScroll', showMarginsOnScroll, false, false);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [showMarginsOnScroll]);\n\n  useEffect(() => {\n    saveViewSettings(envConfig, bookKey, 'showRemainingTime', showRemainingTime, false, false);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [showRemainingTime]);\n\n  useEffect(() => {\n    saveViewSettings(envConfig, bookKey, 'showRemainingPages', showRemainingPages, false, false);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [showRemainingPages]);\n\n  useEffect(() => {\n    saveViewSettings(envConfig, bookKey, 'showProgressInfo', showProgressInfo, false, false);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [showProgressInfo]);\n\n  useEffect(() => {\n    saveViewSettings(envConfig, bookKey, 'progressStyle', progressStyle, false, false);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [progressStyle]);\n\n  useEffect(() => {\n    saveViewSettings(envConfig, bookKey, 'tapToToggleFooter', tapToToggleFooter, false, false);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [tapToToggleFooter]);\n\n  useEffect(() => {\n    if (showHeader === viewSettings.showHeader) return;\n    if (showHeader && !viewSettings.vertical) {\n      const minMarginTop = Math.max(0, Math.round((44 - gridInsets.top) / 4) * 4);\n      viewSettings.marginTopPx = Math.max(viewSettings.marginTopPx, minMarginTop);\n      setMarginTopPx(viewSettings.marginTopPx);\n      setViewSettings(bookKey, viewSettings);\n    }\n    saveViewSettings(envConfig, bookKey, 'showHeader', showHeader, false, false);\n    // Margin and gap settings will be applied in FoliateViewer\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [showHeader]);\n\n  useEffect(() => {\n    if (showFooter === viewSettings.showFooter) return;\n    if (showFooter && !viewSettings.vertical) {\n      const minMarginBottom = Math.max(0, Math.round((44 - gridInsets.bottom) / 4) * 4);\n      viewSettings.marginBottomPx = Math.max(viewSettings.marginBottomPx, minMarginBottom);\n      setMarginBottomPx(viewSettings.marginBottomPx);\n      setViewSettings(bookKey, viewSettings);\n    }\n    saveViewSettings(envConfig, bookKey, 'showFooter', showFooter, false, false);\n    // Margin and gap settings will be applied in FoliateViewer\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [showFooter]);\n\n  useEffect(() => {\n    saveViewSettings(envConfig, bookKey, 'screenOrientation', screenOrientation, false, false);\n    if (appService?.isMobileApp) {\n      lockScreenOrientation({ orientation: screenOrientation });\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [screenOrientation]);\n\n  const langCode = getBookLangCode(bookData?.bookDoc?.metadata?.language);\n  const mightBeRTLBook = MIGHT_BE_RTL_LANGS.includes(langCode) || isCJKEnv();\n  const isVertical = viewSettings.vertical || writingMode.includes('vertical');\n\n  return (\n    <div className='my-4 w-full space-y-6'>\n      <div className='flex items-center justify-between'>\n        <h2 className='font-medium'>{_('Override Book Layout')}</h2>\n        <input\n          type='checkbox'\n          className='toggle'\n          checked={overrideLayout}\n          onChange={() => setOverrideLayout(!overrideLayout)}\n        />\n      </div>\n      {mightBeRTLBook && (\n        <div className='flex items-center justify-between'>\n          <h2 className='font-medium'>{_('Writing Mode')}</h2>\n          <div className='flex gap-4'>\n            <button\n              title={_('Default')}\n              className={`btn btn-ghost btn-circle btn-sm ${writingMode === 'auto' ? 'btn-active bg-base-300' : ''}`}\n              onClick={() => setWritingMode('auto')}\n            >\n              <MdOutlineAutoMode />\n            </button>\n\n            <button\n              title={_('Horizontal Direction')}\n              className={`btn btn-ghost btn-circle btn-sm ${writingMode === 'horizontal-tb' ? 'btn-active bg-base-300' : ''}`}\n              onClick={() => setWritingMode('horizontal-tb')}\n            >\n              <MdOutlineTextRotationNone />\n            </button>\n\n            <button\n              title={_('Vertical Direction')}\n              className={`btn btn-ghost btn-circle btn-sm ${writingMode === 'vertical-rl' ? 'btn-active bg-base-300' : ''}`}\n              onClick={() => setWritingMode('vertical-rl')}\n            >\n              <MdTextRotateVertical />\n            </button>\n\n            <button\n              title={_('RTL Direction')}\n              className={`btn btn-ghost btn-circle btn-sm ${writingMode === 'horizontal-rl' ? 'btn-active bg-base-300' : ''}`}\n              onClick={() => setWritingMode('horizontal-rl')}\n            >\n              <TbTextDirectionRtl />\n            </button>\n          </div>\n        </div>\n      )}\n\n      {viewSettings.vertical && (\n        <div className='w-full'>\n          <h2 className='mb-2 font-medium'>{_('Border Frame')}</h2>\n          <div className='card bg-base-100 border-base-200 border shadow'>\n            <div className='divide-base-200 divide-y'>\n              <div className='config-item'>\n                <span className=''>{_('Double Border')}</span>\n                <input\n                  type='checkbox'\n                  className='toggle'\n                  checked={doubleBorder}\n                  onChange={() => setDoubleBorder(!doubleBorder)}\n                />\n              </div>\n\n              <div className='config-item'>\n                <span className=''>{_('Border Color')}</span>\n                <div className='flex gap-4'>\n                  <button\n                    className={`btn btn-circle btn-sm bg-red-300 hover:bg-red-500 ${borderColor === 'red' ? 'btn-active !bg-red-500' : ''}`}\n                    onClick={() => setBorderColor('red')}\n                  ></button>\n\n                  <button\n                    className={`btn btn-circle btn-sm bg-black/50 hover:bg-black ${borderColor === 'black' ? 'btn-active !bg-black' : ''}`}\n                    onClick={() => setBorderColor('black')}\n                  ></button>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n\n      <div className='w-full'>\n        <h2 className='mb-2 font-medium'>{_('Paragraph')}</h2>\n        <div className='card bg-base-100 border-base-200 border shadow'>\n          <div className='divide-base-200 divide-y'>\n            <NumberInput\n              label={_('Paragraph Margin')}\n              value={paragraphMargin}\n              onChange={setParagraphMargin}\n              min={0}\n              max={4}\n              step={0.1}\n            />\n            <NumberInput\n              label={_('Line Spacing')}\n              value={lineHeight}\n              onChange={setLineHeight}\n              min={1.0}\n              max={3.0}\n              step={0.1}\n            />\n            {langCode !== 'zh' && (\n              <NumberInput\n                label={_('Word Spacing')}\n                value={wordSpacing}\n                onChange={setWordSpacing}\n                min={-4}\n                max={8}\n                step={0.5}\n              />\n            )}\n            <NumberInput\n              label={_('Letter Spacing')}\n              value={letterSpacing}\n              onChange={setLetterSpacing}\n              min={-2}\n              max={4}\n              step={0.5}\n            />\n            <NumberInput\n              label={_('Text Indent')}\n              value={textIndent}\n              onChange={setTextIndent}\n              min={-2}\n              max={4}\n              step={1}\n            />\n            <div className='config-item'>\n              <span className=''>{_('Full Justification')}</span>\n              <input\n                type='checkbox'\n                className='toggle'\n                checked={fullJustification}\n                onChange={() => setFullJustification(!fullJustification)}\n              />\n            </div>\n            <div className='config-item'>\n              <span className=''>{_('Hyphenation')}</span>\n              <input\n                type='checkbox'\n                className='toggle'\n                checked={hyphenation}\n                onChange={() => setHyphenation(!hyphenation)}\n              />\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <div className='w-full'>\n        <h2 className='mb-2 font-medium'>{_('Page')}</h2>\n        <div className='card bg-base-100 border-base-200 border shadow'>\n          <div className='divide-base-200 divide-y'>\n            <NumberInput\n              label={_('Top Margin (px)')}\n              value={showHeader && !isVertical ? marginTopPx : compactMarginTopPx}\n              onChange={showHeader && !isVertical ? setMarginTopPx : setCompactMarginTopPx}\n              min={\n                showHeader && !isVertical\n                  ? Math.max(0, Math.round((44 - gridInsets.top) / 4) * 4)\n                  : 0\n              }\n              max={88}\n              step={4}\n            />\n            <NumberInput\n              label={_('Bottom Margin (px)')}\n              value={showFooter && !isVertical ? marginBottomPx : compactMarginBottomPx}\n              onChange={showFooter && !isVertical ? setMarginBottomPx : setCompactMarginBottomPx}\n              min={\n                showFooter && !isVertical\n                  ? Math.max(0, Math.round((44 - gridInsets.bottom) / 4) * 4)\n                  : 0\n              }\n              max={88}\n              step={4}\n            />\n            <NumberInput\n              label={_('Left Margin (px)')}\n              value={showFooter && isVertical ? marginLeftPx : compactMarginLeftPx}\n              onChange={showFooter && isVertical ? setMarginLeftPx : setCompactMarginLeftPx}\n              min={0}\n              max={88}\n              step={4}\n            />\n            <NumberInput\n              label={_('Right Margin (px)')}\n              value={showHeader && isVertical ? marginRightPx : compactMarginRightPx}\n              onChange={showHeader && isVertical ? setMarginRightPx : setCompactMarginRightPx}\n              min={0}\n              max={88}\n              step={4}\n            />\n            <NumberInput\n              label={_('Column Gap (%)')}\n              value={gapPercent}\n              onChange={setGapPercent}\n              min={0}\n              max={30}\n            />\n            <NumberInput\n              label={_('Maximum Number of Columns')}\n              value={maxColumnCount}\n              onChange={setMaxColumnCount}\n              min={1}\n              max={4}\n            />\n            <NumberInput\n              label={viewSettings.vertical ? _('Maximum Column Height') : _('Maximum Column Width')}\n              value={maxInlineSize}\n              onChange={setMaxInlineSize}\n              disabled={false}\n              min={200}\n              max={9999}\n              step={50}\n            />\n            <NumberInput\n              label={viewSettings.vertical ? _('Maximum Column Width') : _('Maximum Column Height')}\n              value={maxBlockSize}\n              onChange={setMaxBlockSize}\n              disabled={false}\n              min={400}\n              max={9999}\n              step={50}\n            />\n            <div className='config-item'>\n              <span className=''>{_('Apply also in Scrolled Mode')}</span>\n              <input\n                type='checkbox'\n                className='toggle'\n                checked={showMarginsOnScroll}\n                onChange={() => setShowMarginsOnScroll(!showMarginsOnScroll)}\n              />\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <div className='w-full'>\n        <h2 className='mb-2 font-medium'>{_('Header & Footer')}</h2>\n        <div className='card bg-base-100 border-base-200 border shadow'>\n          <div className='divide-base-200 divide-y'>\n            <div className='config-item'>\n              <span className=''>{_('Show Header')}</span>\n              <input\n                type='checkbox'\n                className='toggle'\n                checked={showHeader}\n                onChange={() => setShowHeader(!showHeader)}\n              />\n            </div>\n            <div className='config-item'>\n              <span className=''>{_('Show Footer')}</span>\n              <input\n                type='checkbox'\n                className='toggle'\n                checked={showFooter}\n                onChange={() => setShowFooter(!showFooter)}\n              />\n            </div>\n            <div className='config-item'>\n              <span className=''>{_('Show Remaining Time')}</span>\n              <input\n                type='checkbox'\n                className='toggle'\n                checked={showRemainingTime}\n                disabled={!showFooter}\n                onChange={() => {\n                  if (!showRemainingTime) {\n                    setShowRemainingTime(true);\n                    setShowRemainingPages(false);\n                  } else {\n                    setShowRemainingTime(false);\n                  }\n                }}\n              />\n            </div>\n            <div className='config-item'>\n              <span className=''>{_('Show Remaining Pages')}</span>\n              <input\n                type='checkbox'\n                className='toggle'\n                checked={showRemainingPages}\n                disabled={!showFooter}\n                onChange={() => {\n                  if (!showRemainingPages) {\n                    setShowRemainingPages(true);\n                    setShowRemainingTime(false);\n                  } else {\n                    setShowRemainingPages(false);\n                  }\n                }}\n              />\n            </div>\n            <div className='config-item'>\n              <span className=''>{_('Show Reading Progress')}</span>\n              <input\n                type='checkbox'\n                className='toggle'\n                checked={showProgressInfo}\n                disabled={!showFooter}\n                onChange={() => setShowProgressInfo(!showProgressInfo)}\n              />\n            </div>\n            <div className='config-item'>\n              <span className=''>{_('Reading Progress Style')}</span>\n              <Select\n                value={progressStyle}\n                onChange={(e) => setProgressStyle(e.target.value as 'percentage' | 'fraction')}\n                options={[\n                  { value: 'fraction', label: _('Page Number') },\n                  { value: 'percentage', label: _('Percentage') },\n                ]}\n                disabled={!showProgressInfo}\n              />\n            </div>\n            <div className='config-item'>\n              <span className=''>{_('Tap to Toggle Footer')}</span>\n              <input\n                type='checkbox'\n                className='toggle'\n                checked={tapToToggleFooter}\n                disabled={!showFooter}\n                onChange={() => setTapToToggleFooter(!tapToToggleFooter)}\n              />\n            </div>\n            <div className='config-item'>\n              <span className=''>{_('Apply also in Scrolled Mode')}</span>\n              <input\n                type='checkbox'\n                className='toggle'\n                checked={showBarsOnScroll}\n                onChange={() => setShowBarsOnScroll(!showBarsOnScroll)}\n              />\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {appService?.hasOrientationLock && (\n        <div className='w-full'>\n          <h2 className='mb-2 font-medium'>{_('Screen')}</h2>\n          <div className='card border-base-200 bg-base-100 border shadow'>\n            <div className='divide-base-200 divide-y'>\n              <div className='config-item'>\n                <span className=''>{_('Orientation')}</span>\n                <div className='flex gap-4'>\n                  <div className='lg:tooltip lg:tooltip-bottom' data-tip={_('Auto')}>\n                    <button\n                      className={`btn btn-ghost btn-circle btn-sm ${screenOrientation === 'auto' ? 'btn-active bg-base-300' : ''}`}\n                      onClick={() => setScreenOrientation('auto')}\n                    >\n                      <MdOutlineScreenRotation />\n                    </button>\n                  </div>\n\n                  <div className='lg:tooltip lg:tooltip-bottom' data-tip={_('Portrait')}>\n                    <button\n                      className={`btn btn-ghost btn-circle btn-sm ${screenOrientation === 'portrait' ? 'btn-active bg-base-300' : ''}`}\n                      onClick={() => setScreenOrientation('portrait')}\n                    >\n                      <IoPhonePortraitOutline />\n                    </button>\n                  </div>\n\n                  <div className='lg:tooltip lg:tooltip-bottom' data-tip={_('Landscape')}>\n                    <button\n                      className={`btn btn-ghost btn-circle btn-sm ${screenOrientation === 'landscape' ? 'btn-active bg-base-300' : ''}`}\n                      onClick={() => setScreenOrientation('landscape')}\n                    >\n                      <IoPhoneLandscapeOutline />\n                    </button>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default LayoutPanel;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 8367, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/components/settings/color/ColorInput.tsx"],"sourcesContent":["'use client';\n\nimport React, { useState, useEffect, useRef } from 'react';\nimport { SketchPicker, ColorResult } from 'react-color';\n\ntype ColorInputProps = {\n  label: string;\n  value: string;\n  onChange: (value: string) => void;\n  compact?: boolean;\n  pickerPosition?: 'left' | 'center' | 'right';\n};\n\nconst ColorInput: React.FC<ColorInputProps> = ({\n  label,\n  value,\n  onChange,\n  compact = false,\n  pickerPosition = 'left',\n}) => {\n  const [isOpen, setIsOpen] = useState(false);\n  const pickerRef = useRef<HTMLDivElement>(null);\n\n  useEffect(() => {\n    function handleClickOutside(event: MouseEvent) {\n      if (pickerRef.current && !pickerRef.current.contains(event.target as Node)) {\n        setIsOpen(false);\n      }\n    }\n    if (isOpen) {\n      document.addEventListener('mousedown', handleClickOutside);\n    } else {\n      document.removeEventListener('mousedown', handleClickOutside);\n    }\n    return () => document.removeEventListener('mousedown', handleClickOutside);\n  }, [isOpen]);\n\n  const handlePickerChange = (colorResult: ColorResult) => {\n    onChange(colorResult.hex);\n  };\n\n  const getPickerPositionClass = () => {\n    if (pickerPosition === 'right') {\n      return 'right-0';\n    } else if (pickerPosition === 'center') {\n      return 'left-1/2 -translate-x-1/2';\n    }\n    return 'left-0';\n  };\n\n  if (compact) {\n    return (\n      <div className='relative'>\n        <input\n          type='text'\n          value={value}\n          spellCheck={false}\n          onChange={(e) => onChange(e.target.value)}\n          onClick={() => setIsOpen(!isOpen)}\n          className='bg-base-100 text-base-content border-base-200/75 w-16 cursor-pointer rounded border px-1 py-0.5 text-center font-mono text-xs'\n        />\n\n        {isOpen && (\n          <div\n            ref={pickerRef}\n            className={`absolute top-full z-50 py-1 ${getPickerPositionClass()}`}\n          >\n            <SketchPicker\n              width='200px'\n              color={value}\n              onChange={handlePickerChange}\n              disableAlpha={true}\n            />\n          </div>\n        )}\n      </div>\n    );\n  }\n\n  return (\n    <div className='mb-3'>\n      <label className='mb-1 block text-sm font-medium'>{label}</label>\n      <div className='flex items-center'>\n        <button\n          className='border-base-200/75 relative mr-2 flex h-7 w-8 cursor-pointer items-center justify-center overflow-hidden rounded border'\n          style={{ backgroundColor: value }}\n          onClick={() => setIsOpen(!isOpen)}\n        />\n\n        <input\n          type='text'\n          value={value}\n          spellCheck={false}\n          onChange={(e) => onChange(e.target.value)}\n          className='bg-base-100 text-base-content border-base-200/75 min-w-4 max-w-36 flex-1 rounded border p-1 font-mono text-sm'\n        />\n      </div>\n\n      {isOpen && (\n        <div ref={pickerRef} className='relative z-50 mt-2'>\n          <div className='absolute'>\n            <SketchPicker\n              width='100%'\n              color={value}\n              onChange={handlePickerChange}\n              disableAlpha={true}\n            />\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default ColorInput;\n"],"names":[],"mappings":";;;;;AAEA;AACA;AAHA;;;;AAaA,MAAM,aAAwC,CAAC,EAC7C,KAAK,EACL,KAAK,EACL,QAAQ,EACR,UAAU,KAAK,EACf,iBAAiB,MAAM,EACxB;IACC,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,+GAAQ,EAAC;IACrC,MAAM,YAAY,IAAA,6GAAM,EAAiB;IAEzC,IAAA,gHAAS,EAAC;QACR,SAAS,mBAAmB,KAAiB;YAC3C,IAAI,UAAU,OAAO,IAAI,CAAC,UAAU,OAAO,CAAC,QAAQ,CAAC,MAAM,MAAM,GAAW;gBAC1E,UAAU;YACZ;QACF;QACA,IAAI,QAAQ;YACV,SAAS,gBAAgB,CAAC,aAAa;QACzC,OAAO;YACL,SAAS,mBAAmB,CAAC,aAAa;QAC5C;QACA,OAAO,IAAM,SAAS,mBAAmB,CAAC,aAAa;IACzD,GAAG;QAAC;KAAO;IAEX,MAAM,qBAAqB,CAAC;QAC1B,SAAS,YAAY,GAAG;IAC1B;IAEA,MAAM,yBAAyB;QAC7B,IAAI,mBAAmB,SAAS;YAC9B,OAAO;QACT,OAAO,IAAI,mBAAmB,UAAU;YACtC,OAAO;QACT;QACA,OAAO;IACT;IAEA,IAAI,SAAS;QACX,qBACE,qKAAC;YAAI,WAAU;;8BACb,qKAAC;oBACC,MAAK;oBACL,OAAO;oBACP,YAAY;oBACZ,UAAU,CAAC,IAAM,SAAS,EAAE,MAAM,CAAC,KAAK;oBACxC,SAAS,IAAM,UAAU,CAAC;oBAC1B,WAAU;;;;;;gBAGX,wBACC,qKAAC;oBACC,KAAK;oBACL,WAAW,CAAC,4BAA4B,EAAE,0BAA0B;8BAEpE,cAAA,qKAAC,qIAAY;wBACX,OAAM;wBACN,OAAO;wBACP,UAAU;wBACV,cAAc;;;;;;;;;;;;;;;;;IAM1B;IAEA,qBACE,qKAAC;QAAI,WAAU;;0BACb,qKAAC;gBAAM,WAAU;0BAAkC;;;;;;0BACnD,qKAAC;gBAAI,WAAU;;kCACb,qKAAC;wBACC,WAAU;wBACV,OAAO;4BAAE,iBAAiB;wBAAM;wBAChC,SAAS,IAAM,UAAU,CAAC;;;;;;kCAG5B,qKAAC;wBACC,MAAK;wBACL,OAAO;wBACP,YAAY;wBACZ,UAAU,CAAC,IAAM,SAAS,EAAE,MAAM,CAAC,KAAK;wBACxC,WAAU;;;;;;;;;;;;YAIb,wBACC,qKAAC;gBAAI,KAAK;gBAAW,WAAU;0BAC7B,cAAA,qKAAC;oBAAI,WAAU;8BACb,cAAA,qKAAC,qIAAY;wBACX,OAAM;wBACN,OAAO;wBACP,UAAU;wBACV,cAAc;;;;;;;;;;;;;;;;;;;;;;AAO5B;uCAEe"}},
    {"offset": {"line": 8529, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/components/settings/color/ThemeEditor.tsx"],"sourcesContent":["'use client';\n\nimport { useState } from 'react';\nimport { useTranslation } from '@/hooks/useTranslation';\nimport { CustomTheme } from '@/styles/themes';\nimport { md5Fingerprint } from '@/utils/md5';\nimport { CUSTOM_THEME_TEMPLATES } from '@/services/constants';\nimport { useSettingsStore } from '@/store/settingsStore';\nimport clsx from 'clsx';\nimport ColorInput from './ColorInput';\n\ntype ThemeEditorProps = {\n  customTheme: CustomTheme | null;\n  onSave: (customTheme: CustomTheme) => void;\n  onDelete: (customTheme: CustomTheme) => void;\n  onCancel: () => void;\n};\n\nconst ThemePreview: React.FC<{\n  textColor: string;\n  backgroundColor: string;\n  primaryColor: string;\n  label: string;\n}> = ({ textColor, backgroundColor, primaryColor, label }) => {\n  const _ = useTranslation();\n  return (\n    <div className='mb-2 mt-4'>\n      <label className='mb-1 block text-sm font-medium'>{label}</label>\n      <div\n        className='border-base-300 overflow-hidden rounded border p-2'\n        style={{\n          backgroundColor: backgroundColor,\n          color: textColor,\n        }}\n      >\n        <p className='mb-2 whitespace-pre-line text-xs'>\n          {_(\n            \"All the world's a stage,\\nAnd all the men and women merely players;\\nThey have their exits and their entrances,\\nAnd one man in his time plays many parts,\\nHis acts being seven ages.\\n\\n William Shakespeare\",\n          )}\n          {'\\n\\n'}\n          <span\n            className='mt-4 cursor-pointer italic'\n            style={{\n              color: primaryColor,\n            }}\n          >\n            {_(\"(from 'As You Like It', Act II)\")}\n          </span>\n        </p>\n      </div>\n    </div>\n  );\n};\n\nconst ThemeEditor: React.FC<ThemeEditorProps> = ({ customTheme, onSave, onDelete, onCancel }) => {\n  const _ = useTranslation();\n  const { settings } = useSettingsStore();\n  const [template] = useState(\n    () => CUSTOM_THEME_TEMPLATES[Math.floor(Math.random() * CUSTOM_THEME_TEMPLATES.length)]!,\n  );\n  const [lightTextColor, setLightTextColor] = useState(\n    customTheme?.colors.light.fg || template.light.fg,\n  );\n  const [lightBackgroundColor, setLightBackgroundColor] = useState(\n    customTheme?.colors.light.bg || template.light.bg,\n  );\n  const [lightPrimaryColor, setLightPrimaryColor] = useState(\n    customTheme?.colors.light.primary || template.light.primary,\n  );\n  const [darkTextColor, setDarkTextColor] = useState(\n    customTheme?.colors.dark.fg || template.dark.fg,\n  );\n  const [darkBackgroundColor, setDarkBackgroundColor] = useState(\n    customTheme?.colors.dark.bg || template.dark.bg,\n  );\n  const [darkPrimaryColor, setDarkPrimaryColor] = useState(\n    customTheme?.colors.dark.primary || template.dark.primary,\n  );\n\n  const [themeName, setThemeName] = useState(customTheme?.label || _('Custom'));\n\n  const getCustomTheme = () => {\n    return {\n      name: md5Fingerprint(themeName),\n      label: themeName,\n      colors: {\n        light: {\n          fg: lightTextColor,\n          bg: lightBackgroundColor,\n          primary: lightPrimaryColor,\n        },\n        dark: {\n          fg: darkTextColor,\n          bg: darkBackgroundColor,\n          primary: darkPrimaryColor,\n        },\n      },\n    };\n  };\n\n  return (\n    <div className='mt-6 rounded-lg'>\n      <div className='mb-4'>\n        <div className='mb-4 flex items-center justify-between'>\n          <label className='font-medium'>{_('Custom Theme')}</label>\n          <div className='flex w-[calc(50%-12px)] justify-between'>\n            <button\n              className='btn btn-ghost btn-sm text-base-content px-2'\n              onClick={() => onSave(getCustomTheme())}\n            >\n              {_('Save')}\n            </button>\n\n            {settings.globalReadSettings.customThemes.find(\n              (theme) => theme.name === md5Fingerprint(themeName),\n            ) && (\n              <button\n                className={clsx('btn btn-ghost btn-sm px-2')}\n                onClick={() => onDelete(getCustomTheme())}\n              >\n                {_('Delete')}\n              </button>\n            )}\n\n            <button className='btn btn-ghost btn-sm px-2' onClick={onCancel}>\n              {_('Cancel')}\n            </button>\n          </div>\n        </div>\n        <div className='mb-4 flex items-center justify-between'>\n          <label className='font-medium'>{_('Theme Name')}</label>\n          <input\n            type='text'\n            value={themeName}\n            onChange={(e) => setThemeName(e.target.value)}\n            className='bg-base-100 text-base-content border-base-200 w-[calc(50%-12px)] rounded border p-2 text-sm'\n          />\n        </div>\n      </div>\n\n      <div className='grid grid-cols-2 gap-6'>\n        <div className='bg-base-200 rounded-lg p-3'>\n          <h3 className='mb-3 text-center font-medium'>{_('Light Mode')}</h3>\n\n          <ColorInput label={_('Text Color')} value={lightTextColor} onChange={setLightTextColor} />\n\n          <ColorInput\n            label={_('Background Color')}\n            value={lightBackgroundColor}\n            onChange={setLightBackgroundColor}\n          />\n\n          <ColorInput\n            label={_('Link Color')}\n            value={lightPrimaryColor}\n            onChange={setLightPrimaryColor}\n          />\n\n          <ThemePreview\n            textColor={lightTextColor}\n            backgroundColor={lightBackgroundColor}\n            primaryColor={lightPrimaryColor}\n            label={_('Preview')}\n          />\n        </div>\n\n        <div className='bg-base-300 rounded-lg p-3'>\n          <h3 className='mb-3 text-center font-medium'>{_('Dark Mode')}</h3>\n\n          <ColorInput label={_('Text Color')} value={darkTextColor} onChange={setDarkTextColor} />\n\n          <ColorInput\n            label={_('Background Color')}\n            value={darkBackgroundColor}\n            onChange={setDarkBackgroundColor}\n          />\n\n          <ColorInput\n            label={_('Link Color')}\n            value={darkPrimaryColor}\n            onChange={setDarkPrimaryColor}\n          />\n\n          <ThemePreview\n            textColor={darkTextColor}\n            backgroundColor={darkBackgroundColor}\n            primaryColor={darkPrimaryColor}\n            label={_('Preview')}\n          />\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default ThemeEditor;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 8862, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/components/settings/color/ThemeModeSelector.tsx"],"sourcesContent":["import React from 'react';\nimport { MdOutlineLightMode, MdOutlineDarkMode } from 'react-icons/md';\nimport { TbSunMoon } from 'react-icons/tb';\nimport { useTranslation } from '@/hooks/useTranslation';\n\ninterface ThemeModeSelectorProps {\n  themeMode: 'auto' | 'light' | 'dark';\n  onThemeModeChange: (mode: 'auto' | 'light' | 'dark') => void;\n}\n\nconst ThemeModeSelector: React.FC<ThemeModeSelectorProps> = ({ themeMode, onThemeModeChange }) => {\n  const _ = useTranslation();\n\n  return (\n    <div className='flex items-center justify-between'>\n      <h2 className='font-medium'>{_('Theme Mode')}</h2>\n      <div className='flex gap-4'>\n        <button\n          title={_('Auto Mode')}\n          className={`btn btn-ghost btn-circle btn-sm ${themeMode === 'auto' ? 'btn-active bg-base-300' : ''}`}\n          onClick={() => onThemeModeChange('auto')}\n        >\n          <TbSunMoon />\n        </button>\n        <button\n          title={_('Light Mode')}\n          className={`btn btn-ghost btn-circle btn-sm ${themeMode === 'light' ? 'btn-active bg-base-300' : ''}`}\n          onClick={() => onThemeModeChange('light')}\n        >\n          <MdOutlineLightMode />\n        </button>\n        <button\n          title={_('Dark Mode')}\n          className={`btn btn-ghost btn-circle btn-sm ${themeMode === 'dark' ? 'btn-active bg-base-300' : ''}`}\n          onClick={() => onThemeModeChange('dark')}\n        >\n          <MdOutlineDarkMode />\n        </button>\n      </div>\n    </div>\n  );\n};\n\nexport default ThemeModeSelector;\n"],"names":[],"mappings":";;;;;AACA;AACA;AACA;;;;;;;;;AAOA,MAAM,oBAAsD,CAAC,EAAE,SAAS,EAAE,iBAAiB,EAAE;IAC3F,MAAM,IAAI,IAAA,mKAAc;IAExB,qBACE,qKAAC;QAAI,WAAU;;0BACb,qKAAC;gBAAG,WAAU;0BAAe,EAAE;;;;;;0BAC/B,qKAAC;gBAAI,WAAU;;kCACb,qKAAC;wBACC,OAAO,EAAE;wBACT,WAAW,CAAC,gCAAgC,EAAE,cAAc,SAAS,2BAA2B,IAAI;wBACpG,SAAS,IAAM,kBAAkB;kCAEjC,cAAA,qKAAC,qOAAS;;;;;;;;;;kCAEZ,qKAAC;wBACC,OAAO,EAAE;wBACT,WAAW,CAAC,gCAAgC,EAAE,cAAc,UAAU,2BAA2B,IAAI;wBACrG,SAAS,IAAM,kBAAkB;kCAEjC,cAAA,qKAAC,8OAAkB;;;;;;;;;;kCAErB,qKAAC;wBACC,OAAO,EAAE;wBACT,WAAW,CAAC,gCAAgC,EAAE,cAAc,SAAS,2BAA2B,IAAI;wBACpG,SAAS,IAAM,kBAAkB;kCAEjC,cAAA,qKAAC,6OAAiB;;;;;;;;;;;;;;;;;;;;;;AAK5B;uCAEe"}},
    {"offset": {"line": 8957, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/components/settings/color/ThemeColorSelector.tsx"],"sourcesContent":["import React from 'react';\nimport { CgColorPicker } from 'react-icons/cg';\nimport { MdRadioButtonUnchecked, MdRadioButtonChecked } from 'react-icons/md';\nimport { PiPlus } from 'react-icons/pi';\nimport { Theme } from '@/styles/themes';\nimport { useTranslation } from '@/hooks/useTranslation';\nimport { useResponsiveSize } from '@/hooks/useResponsiveSize';\n\ninterface ThemeColorSelectorProps {\n  themes: Theme[];\n  themeColor: string;\n  isDarkMode: boolean;\n  onThemeColorChange: (name: string) => void;\n  onEditTheme: (name: string) => void;\n  onCreateTheme: () => void;\n}\n\nconst ThemeColorSelector: React.FC<ThemeColorSelectorProps> = ({\n  themes,\n  themeColor,\n  isDarkMode,\n  onThemeColorChange,\n  onEditTheme,\n  onCreateTheme,\n}) => {\n  const _ = useTranslation();\n  const iconSize16 = useResponsiveSize(16);\n  const iconSize24 = useResponsiveSize(24);\n\n  return (\n    <div>\n      <h2 className='mb-2 font-medium'>{_('Theme Color')}</h2>\n      <div className='grid grid-cols-3 gap-4'>\n        {themes.map(({ name, label, colors, isCustomizale }) => (\n          <button\n            key={name}\n            tabIndex={0}\n            onClick={() => onThemeColorChange(name)}\n            onKeyDown={(e) => {\n              if (e.key === 'Enter' || e.key === ' ') {\n                onThemeColorChange(name);\n              }\n              e.stopPropagation();\n            }}\n            className={`relative flex cursor-pointer flex-col items-center justify-center rounded-lg px-2 py-4 shadow-md ${\n              themeColor === name ? 'ring-2 ring-indigo-500 ring-offset-2' : ''\n            }`}\n            style={{\n              backgroundColor: isDarkMode ? colors.dark['base-100'] : colors.light['base-100'],\n              color: isDarkMode ? colors.dark['base-content'] : colors.light['base-content'],\n            }}\n          >\n            <input\n              aria-label={_(label)}\n              type='radio'\n              name='theme'\n              value={name}\n              checked={themeColor === name}\n              onChange={() => onThemeColorChange(name)}\n              className='hidden'\n            />\n            {themeColor === name ? (\n              <MdRadioButtonChecked size={iconSize24} />\n            ) : (\n              <MdRadioButtonUnchecked size={iconSize24} />\n            )}\n            <span className='max-w-full truncate'>{_(label)}</span>\n            {isCustomizale && themeColor === name && (\n              <button onClick={() => onEditTheme(name)}>\n                <CgColorPicker size={iconSize16} className='absolute right-2 top-2' />\n              </button>\n            )}\n          </button>\n        ))}\n        <button\n          className='relative flex cursor-pointer flex-col items-center justify-center rounded-lg border border-dashed px-2 py-4 shadow-md'\n          onClick={onCreateTheme}\n        >\n          <PiPlus size={iconSize24} />\n          <span className='max-w-full truncate'>{_('Custom')}</span>\n        </button>\n      </div>\n    </div>\n  );\n};\n\nexport default ThemeColorSelector;\n"],"names":[],"mappings":";;;;;AACA;AACA;AACA;AAEA;AACA;;;;;;;;;;;AAWA,MAAM,qBAAwD,CAAC,EAC7D,MAAM,EACN,UAAU,EACV,UAAU,EACV,kBAAkB,EAClB,WAAW,EACX,aAAa,EACd;IACC,MAAM,IAAI,IAAA,mKAAc;IACxB,MAAM,aAAa,IAAA,yKAAiB,EAAC;IACrC,MAAM,aAAa,IAAA,yKAAiB,EAAC;IAErC,qBACE,qKAAC;;0BACC,qKAAC;gBAAG,WAAU;0BAAoB,EAAE;;;;;;0BACpC,qKAAC;gBAAI,WAAU;;oBACZ,OAAO,GAAG,CAAC,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,MAAM,EAAE,aAAa,EAAE,iBACjD,qKAAC;4BAEC,UAAU;4BACV,SAAS,IAAM,mBAAmB;4BAClC,WAAW,CAAC;gCACV,IAAI,EAAE,GAAG,KAAK,WAAW,EAAE,GAAG,KAAK,KAAK;oCACtC,mBAAmB;gCACrB;gCACA,EAAE,eAAe;4BACnB;4BACA,WAAW,CAAC,iGAAiG,EAC3G,eAAe,OAAO,yCAAyC,IAC/D;4BACF,OAAO;gCACL,iBAAiB,aAAa,OAAO,IAAI,CAAC,WAAW,GAAG,OAAO,KAAK,CAAC,WAAW;gCAChF,OAAO,aAAa,OAAO,IAAI,CAAC,eAAe,GAAG,OAAO,KAAK,CAAC,eAAe;4BAChF;;8CAEA,qKAAC;oCACC,cAAY,EAAE;oCACd,MAAK;oCACL,MAAK;oCACL,OAAO;oCACP,SAAS,eAAe;oCACxB,UAAU,IAAM,mBAAmB;oCACnC,WAAU;;;;;;gCAEX,eAAe,qBACd,qKAAC,gPAAoB;oCAAC,MAAM;;;;;6FAE5B,qKAAC,kPAAsB;oCAAC,MAAM;;;;;;8CAEhC,qKAAC;oCAAK,WAAU;8CAAuB,EAAE;;;;;;gCACxC,iBAAiB,eAAe,sBAC/B,qKAAC;oCAAO,SAAS,IAAM,YAAY;8CACjC,cAAA,qKAAC,yOAAa;wCAAC,MAAM;wCAAY,WAAU;;;;;;;;;;;;2BAlC1C;;;;;kCAuCT,qKAAC;wBACC,WAAU;wBACV,SAAS;;0CAET,qKAAC,kOAAM;gCAAC,MAAM;;;;;;0CACd,qKAAC;gCAAK,WAAU;0CAAuB,EAAE;;;;;;;;;;;;;;;;;;;;;;;;AAKnD;uCAEe"}},
    {"offset": {"line": 9110, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/components/settings/color/BackgroundTextureSelector.tsx"],"sourcesContent":["import React from 'react';\nimport { MdRadioButtonChecked, MdClose, MdAdd } from 'react-icons/md';\nimport { useTranslation } from '@/hooks/useTranslation';\nimport { useResponsiveSize } from '@/hooks/useResponsiveSize';\nimport Select from '@/components/Select';\n\ninterface Texture {\n  id: string;\n  url?: string;\n  blobUrl?: string;\n  loaded?: boolean;\n}\n\ninterface BackgroundTextureSelectorProps {\n  predefinedTextures: Texture[];\n  customTextures: Texture[];\n  selectedTextureId: string;\n  backgroundOpacity: number;\n  backgroundSize: string;\n  onTextureSelect: (id: string) => void;\n  onOpacityChange: (opacity: number) => void;\n  onSizeChange: (size: string) => void;\n  onImportImage: () => void;\n  onDeleteTexture: (id: string) => void;\n}\n\nconst BackgroundTextureSelector: React.FC<BackgroundTextureSelectorProps> = ({\n  predefinedTextures,\n  customTextures,\n  selectedTextureId,\n  backgroundOpacity,\n  backgroundSize,\n  onTextureSelect,\n  onOpacityChange,\n  onSizeChange,\n  onImportImage,\n  onDeleteTexture,\n}) => {\n  const _ = useTranslation();\n  const iconSize24 = useResponsiveSize(24);\n\n  const allTextures = [...predefinedTextures, ...customTextures];\n\n  return (\n    <div>\n      <h2 className='mb-2 font-medium'>{_('Background Image')}</h2>\n      <div className='mb-4 grid grid-cols-2 gap-4'>\n        {allTextures.map((texture) => (\n          <button\n            key={texture.id}\n            onClick={() => onTextureSelect(texture.id)}\n            className={`bg-base-100 relative flex flex-col items-center justify-center rounded-lg border-2 p-4 shadow-md transition-all ${\n              selectedTextureId === texture.id\n                ? 'ring-2 ring-indigo-500 ring-offset-2'\n                : 'border-base-300'\n            }`}\n            style={{\n              backgroundImage: texture.loaded ? `url(\"${texture.blobUrl || texture.url}\")` : 'none',\n              backgroundSize: 'cover',\n              backgroundPosition: 'top',\n              minHeight: '80px',\n            }}\n          >\n            {selectedTextureId === texture.id && (\n              <MdRadioButtonChecked\n                size={iconSize24}\n                className='absolute right-2 top-2 rounded-full bg-white text-indigo-500'\n              />\n            )}\n            {!predefinedTextures.find((t) => t.id === texture.id) && (\n              <button\n                onClick={(e) => {\n                  e.stopPropagation();\n                  onDeleteTexture(texture.id);\n                }}\n                className='absolute left-2 top-2 rounded-full bg-red-500 p-1 text-white transition-colors hover:bg-red-600'\n                title={_('Delete')}\n              >\n                <MdClose size={16} />\n              </button>\n            )}\n          </button>\n        ))}\n\n        {/* Custom Image Upload */}\n        <div\n          className='border-base-300 relative flex cursor-pointer flex-col items-center justify-center rounded-lg border-2 border-dashed p-4 shadow-md transition-all'\n          style={{ minHeight: '80px' }}\n        >\n          <button\n            className='card-body flex cursor-pointer items-center justify-center p-2 text-center'\n            onClick={onImportImage}\n          >\n            <div className='flex items-center gap-2'>\n              <div className='flex items-center justify-center'>\n                <MdAdd className='text-primary/85 group-hover:text-primary h-6 w-6' />\n              </div>\n              <div className='text-primary/85 group-hover:text-primary line-clamp-1 font-medium'>\n                {_('Import Image')}\n              </div>\n            </div>\n          </button>\n        </div>\n      </div>\n\n      {/* Background Image Settings */}\n      {selectedTextureId !== 'none' && (\n        <div className='card border-base-200 bg-base-100 space-y-4 border p-4 shadow'>\n          <div className='flex items-center justify-between'>\n            <span className='text-sm font-medium'>{_('Opacity')}</span>\n            <div className='flex items-center gap-2'>\n              <input\n                type='range'\n                min='0'\n                max='1'\n                step='0.05'\n                value={backgroundOpacity}\n                onChange={(e) => onOpacityChange(parseFloat(e.target.value))}\n                className='range range-sm w-32'\n              />\n              <span className='w-12 text-right text-sm'>\n                {Math.round(backgroundOpacity * 100)}%\n              </span>\n            </div>\n          </div>\n\n          <div className='flex items-center justify-between'>\n            <span className='text-sm font-medium'>{_('Size')}</span>\n            <Select\n              value={backgroundSize}\n              onChange={(e) => onSizeChange(e.target.value)}\n              options={[\n                { value: 'auto', label: _('Auto') },\n                { value: 'cover', label: _('Cover') },\n                { value: 'contain', label: _('Contain') },\n              ]}\n            />\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default BackgroundTextureSelector;\n"],"names":[],"mappings":";;;;;AACA;AACA;AACA;AACA;;;;;;;;;;;AAsBA,MAAM,4BAAsE,CAAC,EAC3E,kBAAkB,EAClB,cAAc,EACd,iBAAiB,EACjB,iBAAiB,EACjB,cAAc,EACd,eAAe,EACf,eAAe,EACf,YAAY,EACZ,aAAa,EACb,eAAe,EAChB;IACC,MAAM,IAAI,IAAA,mKAAc;IACxB,MAAM,aAAa,IAAA,yKAAiB,EAAC;IAErC,MAAM,cAAc;WAAI;WAAuB;KAAe;IAE9D,qBACE,qKAAC;;0BACC,qKAAC;gBAAG,WAAU;0BAAoB,EAAE;;;;;;0BACpC,qKAAC;gBAAI,WAAU;;oBACZ,YAAY,GAAG,CAAC,CAAC,wBAChB,qKAAC;4BAEC,SAAS,IAAM,gBAAgB,QAAQ,EAAE;4BACzC,WAAW,CAAC,gHAAgH,EAC1H,sBAAsB,QAAQ,EAAE,GAC5B,yCACA,mBACJ;4BACF,OAAO;gCACL,iBAAiB,QAAQ,MAAM,GAAG,CAAC,KAAK,EAAE,QAAQ,OAAO,IAAI,QAAQ,GAAG,CAAC,EAAE,CAAC,GAAG;gCAC/E,gBAAgB;gCAChB,oBAAoB;gCACpB,WAAW;4BACb;;gCAEC,sBAAsB,QAAQ,EAAE,kBAC/B,qKAAC,gPAAoB;oCACnB,MAAM;oCACN,WAAU;;;;;;gCAGb,CAAC,mBAAmB,IAAI,CAAC,CAAC,IAAM,EAAE,EAAE,KAAK,QAAQ,EAAE,mBAClD,qKAAC;oCACC,SAAS,CAAC;wCACR,EAAE,eAAe;wCACjB,gBAAgB,QAAQ,EAAE;oCAC5B;oCACA,WAAU;oCACV,OAAO,EAAE;8CAET,cAAA,qKAAC,mOAAO;wCAAC,MAAM;;;;;;;;;;;;2BA7Bd,QAAQ,EAAE;;;;;kCAoCnB,qKAAC;wBACC,WAAU;wBACV,OAAO;4BAAE,WAAW;wBAAO;kCAE3B,cAAA,qKAAC;4BACC,WAAU;4BACV,SAAS;sCAET,cAAA,qKAAC;gCAAI,WAAU;;kDACb,qKAAC;wCAAI,WAAU;kDACb,cAAA,qKAAC,iOAAK;4CAAC,WAAU;;;;;;;;;;;kDAEnB,qKAAC;wCAAI,WAAU;kDACZ,EAAE;;;;;;;;;;;;;;;;;;;;;;;;;;;;YAQZ,sBAAsB,wBACrB,qKAAC;gBAAI,WAAU;;kCACb,qKAAC;wBAAI,WAAU;;0CACb,qKAAC;gCAAK,WAAU;0CAAuB,EAAE;;;;;;0CACzC,qKAAC;gCAAI,WAAU;;kDACb,qKAAC;wCACC,MAAK;wCACL,KAAI;wCACJ,KAAI;wCACJ,MAAK;wCACL,OAAO;wCACP,UAAU,CAAC,IAAM,gBAAgB,WAAW,EAAE,MAAM,CAAC,KAAK;wCAC1D,WAAU;;;;;;kDAEZ,qKAAC;wCAAK,WAAU;;4CACb,KAAK,KAAK,CAAC,oBAAoB;4CAAK;;;;;;;;;;;;;;;;;;;kCAK3C,qKAAC;wBAAI,WAAU;;0CACb,qKAAC;gCAAK,WAAU;0CAAuB,EAAE;;;;;;0CACzC,qKAAC,0JAAM;gCACL,OAAO;gCACP,UAAU,CAAC,IAAM,aAAa,EAAE,MAAM,CAAC,KAAK;gCAC5C,SAAS;oCACP;wCAAE,OAAO;wCAAQ,OAAO,EAAE;oCAAQ;oCAClC;wCAAE,OAAO;wCAAS,OAAO,EAAE;oCAAS;oCACpC;wCAAE,OAAO;wCAAW,OAAO,EAAE;oCAAW;iCACzC;;;;;;;;;;;;;;;;;;;;;;;;AAOf;uCAEe"}},
    {"offset": {"line": 9360, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/components/settings/color/HighlightColorsEditor.tsx"],"sourcesContent":["import React from 'react';\nimport { HighlightColor } from '@/types/book';\nimport { useTranslation } from '@/hooks/useTranslation';\nimport ColorInput from './ColorInput';\n\ninterface HighlightColorsEditorProps {\n  customHighlightColors: Record<HighlightColor, string>;\n  onChange: (colors: Record<HighlightColor, string>) => void;\n}\n\nconst HighlightColorsEditor: React.FC<HighlightColorsEditorProps> = ({\n  customHighlightColors,\n  onChange,\n}) => {\n  const _ = useTranslation();\n\n  const handleColorChange = (color: HighlightColor, value: string) => {\n    const updated = { ...customHighlightColors, [color]: value };\n    onChange(updated);\n  };\n\n  return (\n    <div>\n      <h2 className='mb-2 font-medium'>{_('Highlight Colors')}</h2>\n      <div className='card border-base-200 bg-base-100 overflow-visible border p-4 shadow'>\n        <div className='grid grid-cols-3 gap-3 sm:grid-cols-5'>\n          {(['red', 'violet', 'blue', 'green', 'yellow'] as HighlightColor[]).map(\n            (color, index, array) => {\n              const position =\n                index === 0 ? 'left' : index === array.length - 1 ? 'right' : 'center';\n              return (\n                <div key={color} className='flex flex-col items-center gap-2'>\n                  <div\n                    className='border-base-300 h-8 w-8 rounded-full border-2 shadow-sm'\n                    style={{ backgroundColor: customHighlightColors[color] }}\n                  />\n                  <ColorInput\n                    label=''\n                    value={customHighlightColors[color]}\n                    compact={true}\n                    pickerPosition={position}\n                    onChange={(value: string) => handleColorChange(color, value)}\n                  />\n                </div>\n              );\n            },\n          )}\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default HighlightColorsEditor;\n"],"names":[],"mappings":";;;;;AAEA;AACA;;;;;;;;AAOA,MAAM,wBAA8D,CAAC,EACnE,qBAAqB,EACrB,QAAQ,EACT;IACC,MAAM,IAAI,IAAA,mKAAc;IAExB,MAAM,oBAAoB,CAAC,OAAuB;QAChD,MAAM,UAAU;YAAE,GAAG,qBAAqB;YAAE,CAAC,MAAM,EAAE;QAAM;QAC3D,SAAS;IACX;IAEA,qBACE,qKAAC;;0BACC,qKAAC;gBAAG,WAAU;0BAAoB,EAAE;;;;;;0BACpC,qKAAC;gBAAI,WAAU;0BACb,cAAA,qKAAC;oBAAI,WAAU;8BACZ,AAAC;wBAAC;wBAAO;wBAAU;wBAAQ;wBAAS;qBAAS,CAAsB,GAAG,CACrE,CAAC,OAAO,OAAO;wBACb,MAAM,WACJ,UAAU,IAAI,SAAS,UAAU,MAAM,MAAM,GAAG,IAAI,UAAU;wBAChE,qBACE,qKAAC;4BAAgB,WAAU;;8CACzB,qKAAC;oCACC,WAAU;oCACV,OAAO;wCAAE,iBAAiB,qBAAqB,CAAC,MAAM;oCAAC;;;;;;8CAEzD,qKAAC,mLAAU;oCACT,OAAM;oCACN,OAAO,qBAAqB,CAAC,MAAM;oCACnC,SAAS;oCACT,gBAAgB;oCAChB,UAAU,CAAC,QAAkB,kBAAkB,OAAO;;;;;;;2BAVhD;;;;;oBAcd;;;;;;;;;;;;;;;;;AAMZ;uCAEe"}},
    {"offset": {"line": 9461, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/components/settings/color/TTSHighlightStyleEditor.tsx"],"sourcesContent":["import React from 'react';\nimport { MdClose } from 'react-icons/md';\nimport { useTranslation } from '@/hooks/useTranslation';\nimport Select from '@/components/Select';\nimport ColorInput from './ColorInput';\n\nexport type TTSHighlightStyle =\n  | 'highlight'\n  | 'underline'\n  | 'strikethrough'\n  | 'squiggly'\n  | 'outline';\n\ninterface TTSHighlightStyleEditorProps {\n  style: TTSHighlightStyle;\n  color: string;\n  customColors: string[];\n  onStyleChange: (style: TTSHighlightStyle) => void;\n  onColorChange: (color: string) => void;\n  onCustomColorsChange: (colors: string[]) => void;\n}\n\nconst TTSHighlightStyleEditor: React.FC<TTSHighlightStyleEditorProps> = ({\n  style,\n  color,\n  customColors,\n  onStyleChange,\n  onColorChange,\n  onCustomColorsChange,\n}) => {\n  const _ = useTranslation();\n\n  const defaultQuickColors = [\n    { color: '#FFD700', label: 'Gold' },\n    { color: '#00CED1', label: 'Cyan' },\n    { color: '#FF69B4', label: 'Pink' },\n    { color: '#90EE90', label: 'Green' },\n    { color: '#FFA500', label: 'Orange' },\n  ];\n\n  const handleAddCustomColor = () => {\n    if (!customColors.includes(color) && !defaultQuickColors.some((c) => c.color === color)) {\n      const updatedColors = [...customColors, color];\n      onCustomColorsChange(updatedColors);\n    }\n  };\n\n  const handleDeleteCustomColor = (colorToDelete: string) => {\n    const updatedColors = customColors.filter((c) => c !== colorToDelete);\n    onCustomColorsChange(updatedColors);\n  };\n\n  return (\n    <div className='w-full'>\n      <h2 className='mb-2 font-medium'>{_('TTS Highlighting')}</h2>\n      <div className='card border-base-200 bg-base-100 border p-4 shadow'>\n        <div className='space-y-4'>\n          <div className='flex items-center justify-between'>\n            <span className='text-sm font-medium'>{_('Style')}</span>\n            <Select\n              value={style}\n              onChange={(e) => onStyleChange(e.target.value as TTSHighlightStyle)}\n              options={[\n                { value: 'highlight', label: _('Highlighter') },\n                { value: 'underline', label: _('Underline') },\n                { value: 'strikethrough', label: _('Strikethrough') },\n                { value: 'squiggly', label: _('Squiggly') },\n                { value: 'outline', label: _('Outline') },\n              ]}\n            />\n          </div>\n\n          <div className='flex items-center justify-between'>\n            <span className='text-sm font-medium'>{_('Color')}</span>\n            <div className='flex items-center gap-2'>\n              <div\n                className='border-base-300 pointer-events-none h-8 w-8 cursor-pointer rounded-full border-2 shadow-sm'\n                style={{ backgroundColor: color }}\n              />\n              <ColorInput\n                label=''\n                value={color}\n                compact={true}\n                pickerPosition='center'\n                onChange={onColorChange}\n              />\n              <button\n                onClick={handleAddCustomColor}\n                disabled={\n                  customColors.includes(color) || defaultQuickColors.some((c) => c.color === color)\n                }\n                className='btn btn-ghost btn-sm gap-1 bg-transparent disabled:bg-transparent'\n                title={_('Save Current Color')}\n              >\n                <span className='text-xs'>{_('Save')}</span>\n              </button>\n            </div>\n          </div>\n\n          <div className='border-base-200 flex justify-between border-t pt-4'>\n            <div className='flex items-center'>\n              <span className='text-sm font-medium'>{_('Quick Colors')}</span>\n            </div>\n\n            <div className='flex max-w-[70%] flex-wrap justify-end gap-2'>\n              {defaultQuickColors.map(({ color: quickColor }) => (\n                <button\n                  key={quickColor}\n                  onClick={() => onColorChange(quickColor)}\n                  className={`h-8 w-8 rounded-full border-2 transition-all hover:scale-110 ${\n                    color === quickColor\n                      ? 'ring-2 ring-indigo-500 ring-offset-2'\n                      : 'border-base-300'\n                  }`}\n                  style={{ backgroundColor: quickColor }}\n                />\n              ))}\n\n              {customColors.map((customColor) => (\n                <div key={customColor} className='group relative'>\n                  <button\n                    onClick={() => onColorChange(customColor)}\n                    className={`h-8 w-8 rounded-full border-2 transition-all hover:scale-110 ${\n                      color === customColor\n                        ? 'ring-2 ring-indigo-500 ring-offset-2'\n                        : 'border-base-300'\n                    }`}\n                    style={{ backgroundColor: customColor }}\n                  />\n                  <button\n                    onClick={() => handleDeleteCustomColor(customColor)}\n                    className='absolute -right-1 -top-1 rounded-full bg-red-500 p-0.5 text-white opacity-0 transition-opacity hover:opacity-100 group-hover:opacity-100'\n                    title={_('Delete')}\n                  >\n                    <MdClose size={12} />\n                  </button>\n                </div>\n              ))}\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default TTSHighlightStyleEditor;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 9751, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/components/settings/color/CodeHighlightingSettings.tsx"],"sourcesContent":["import React from 'react';\nimport { CODE_LANGUAGES, CodeLanguage } from '@/utils/highlightjs';\nimport { useTranslation } from '@/hooks/useTranslation';\nimport Select from '@/components/Select';\n\ninterface CodeHighlightingSettingsProps {\n  codeHighlighting: boolean;\n  codeLanguage: string;\n  onToggle: (enabled: boolean) => void;\n  onLanguageChange: (language: CodeLanguage) => void;\n}\n\nconst CodeHighlightingSettings: React.FC<CodeHighlightingSettingsProps> = ({\n  codeHighlighting,\n  codeLanguage,\n  onToggle,\n  onLanguageChange,\n}) => {\n  const _ = useTranslation();\n\n  return (\n    <div className='w-full'>\n      <h2 className='mb-2 font-medium'>{_('Code Highlighting')}</h2>\n      <div className='card border-base-200 bg-base-100 border shadow'>\n        <div className='divide-base-200'>\n          <div className='config-item'>\n            <span>{_('Enable Highlighting')}</span>\n            <input\n              type='checkbox'\n              className='toggle'\n              checked={codeHighlighting}\n              onChange={() => onToggle(!codeHighlighting)}\n            />\n          </div>\n\n          <div className='config-item'>\n            <span>{_('Code Language')}</span>\n            <Select\n              value={codeLanguage}\n              onChange={(event) => onLanguageChange(event.target.value as CodeLanguage)}\n              options={CODE_LANGUAGES.map((lang) => ({\n                value: lang,\n                label: lang === 'auto-detect' ? _('Auto') : lang,\n              }))}\n              disabled={!codeHighlighting}\n            />\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default CodeHighlightingSettings;\n"],"names":[],"mappings":";;;;;AACA;AACA;AACA;;;;;;;;;;;AASA,MAAM,2BAAoE,CAAC,EACzE,gBAAgB,EAChB,YAAY,EACZ,QAAQ,EACR,gBAAgB,EACjB;IACC,MAAM,IAAI,IAAA,mKAAc;IAExB,qBACE,qKAAC;QAAI,WAAU;;0BACb,qKAAC;gBAAG,WAAU;0BAAoB,EAAE;;;;;;0BACpC,qKAAC;gBAAI,WAAU;0BACb,cAAA,qKAAC;oBAAI,WAAU;;sCACb,qKAAC;4BAAI,WAAU;;8CACb,qKAAC;8CAAM,EAAE;;;;;;8CACT,qKAAC;oCACC,MAAK;oCACL,WAAU;oCACV,SAAS;oCACT,UAAU,IAAM,SAAS,CAAC;;;;;;;;;;;;sCAI9B,qKAAC;4BAAI,WAAU;;8CACb,qKAAC;8CAAM,EAAE;;;;;;8CACT,qKAAC,0JAAM;oCACL,OAAO;oCACP,UAAU,CAAC,QAAU,iBAAiB,MAAM,MAAM,CAAC,KAAK;oCACxD,SAAS,gKAAc,CAAC,GAAG,CAAC,CAAC,OAAS,CAAC;4CACrC,OAAO;4CACP,OAAO,SAAS,gBAAgB,EAAE,UAAU;wCAC9C,CAAC;oCACD,UAAU,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAOzB;uCAEe"}},
    {"offset": {"line": 9868, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/components/settings/ColorPanel.tsx"],"sourcesContent":["'use client';\n\nimport React, { useState, useEffect } from 'react';\nimport {\n  applyCustomTheme,\n  CustomTheme,\n  generateDarkPalette,\n  generateLightPalette,\n  Theme,\n  themes,\n} from '@/styles/themes';\nimport { useEnv } from '@/context/EnvContext';\nimport { useThemeStore } from '@/store/themeStore';\nimport { useReaderStore } from '@/store/readerStore';\nimport { useTranslation } from '@/hooks/useTranslation';\nimport { useSettingsStore } from '@/store/settingsStore';\nimport { useResetViewSettings } from '@/hooks/useResetSettings';\nimport { useCustomTextureStore } from '@/store/customTextureStore';\nimport { saveViewSettings } from '@/helpers/settings';\nimport { manageSyntaxHighlighting } from '@/utils/highlightjs';\nimport { SettingsPanelPanelProp } from './SettingsDialog';\nimport { useFileSelector } from '@/hooks/useFileSelector';\nimport { PREDEFINED_TEXTURES } from '@/styles/textures';\nimport { HIGHLIGHT_COLOR_HEX } from '@/services/constants';\nimport ThemeEditor from './color/ThemeEditor';\nimport ThemeModeSelector from './color/ThemeModeSelector';\nimport ThemeColorSelector from './color/ThemeColorSelector';\nimport BackgroundTextureSelector from './color/BackgroundTextureSelector';\nimport HighlightColorsEditor from './color/HighlightColorsEditor';\nimport TTSHighlightStyleEditor, { TTSHighlightStyle } from './color/TTSHighlightStyleEditor';\nimport CodeHighlightingSettings from './color/CodeHighlightingSettings';\n\nconst ColorPanel: React.FC<SettingsPanelPanelProp> = ({ bookKey, onRegisterReset }) => {\n  const _ = useTranslation();\n  const { themeMode, themeColor, isDarkMode, setThemeMode, setThemeColor, saveCustomTheme } =\n    useThemeStore();\n  const { envConfig, appService } = useEnv();\n  const { settings, setSettings, saveSettings } = useSettingsStore();\n  const { getView, getViewSettings } = useReaderStore();\n  const viewSettings = getViewSettings(bookKey) || settings.globalViewSettings;\n\n  const [invertImgColorInDark, setInvertImgColorInDark] = useState(\n    viewSettings.invertImgColorInDark,\n  );\n  const [editTheme, setEditTheme] = useState<CustomTheme | null>(null);\n  const [customThemes, setCustomThemes] = useState<Theme[]>([]);\n  const [showCustomThemeEditor, setShowCustomThemeEditor] = useState(false);\n  const [overrideColor, setOverrideColor] = useState(viewSettings.overrideColor);\n  const [codeHighlighting, setcodeHighlighting] = useState(viewSettings.codeHighlighting);\n  const [codeLanguage, setCodeLanguage] = useState(viewSettings.codeLanguage);\n  const [selectedTextureId, setSelectedTextureId] = useState(viewSettings.backgroundTextureId);\n  const [backgroundOpacity, setBackgroundOpacity] = useState(viewSettings.backgroundOpacity);\n  const [backgroundSize, setBackgroundSize] = useState(viewSettings.backgroundSize);\n  const [ttsHighlightStyle, setTtsHighlightStyle] = useState(\n    viewSettings.ttsHighlightOptions.style,\n  );\n  const [ttsHighlightColor, setTtsHighlightColor] = useState(\n    viewSettings.ttsHighlightOptions.color,\n  );\n  const [customHighlightColors, setCustomHighlightColors] = useState(\n    settings.globalReadSettings.customHighlightColors,\n  );\n  const [customTtsHighlightColors, setCustomTtsHighlightColors] = useState(\n    settings.globalReadSettings.customTtsHighlightColors || [],\n  );\n\n  const {\n    textures: customTextures,\n    addTexture,\n    loadTexture,\n    applyTexture,\n    removeTexture,\n    loadCustomTextures,\n    saveCustomTextures,\n  } = useCustomTextureStore();\n  const resetToDefaults = useResetViewSettings();\n  const { selectFiles } = useFileSelector(appService, _);\n\n  const handleReset = () => {\n    resetToDefaults({\n      overrideColor: setOverrideColor,\n      invertImgColorInDark: setInvertImgColorInDark,\n      codeHighlighting: setcodeHighlighting,\n      codeLanguage: setCodeLanguage,\n    });\n    setThemeColor('default');\n    setThemeMode('auto');\n    setSelectedTextureId('none');\n    setBackgroundOpacity(0.6);\n    setBackgroundSize('cover');\n    setCustomHighlightColors(HIGHLIGHT_COLOR_HEX);\n  };\n\n  useEffect(() => {\n    onRegisterReset(handleReset);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  useEffect(() => {\n    loadCustomTextures(envConfig);\n  }, [loadCustomTextures, envConfig]);\n\n  useEffect(() => {\n    if (invertImgColorInDark === viewSettings.invertImgColorInDark) return;\n    saveViewSettings(envConfig, bookKey, 'invertImgColorInDark', invertImgColorInDark);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [invertImgColorInDark]);\n\n  useEffect(() => {\n    if (overrideColor === viewSettings.overrideColor) return;\n    saveViewSettings(envConfig, bookKey, 'overrideColor', overrideColor);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [overrideColor]);\n\n  useEffect(() => {\n    let update = false;\n    if (codeHighlighting !== viewSettings.codeHighlighting) {\n      saveViewSettings(envConfig, bookKey, 'codeHighlighting', codeHighlighting);\n      update = true;\n    }\n    if (codeLanguage !== viewSettings.codeLanguage) {\n      saveViewSettings(envConfig, bookKey, 'codeLanguage', codeLanguage);\n      update = true;\n    }\n    if (!update) return;\n    const view = getView(bookKey);\n    if (!view) return;\n    const docs = view.renderer.getContents();\n    docs.forEach(({ doc }) => manageSyntaxHighlighting(doc, viewSettings));\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [codeHighlighting, codeLanguage]);\n\n  useEffect(() => {\n    if (selectedTextureId === viewSettings.backgroundTextureId) return;\n    saveViewSettings(envConfig, bookKey, 'backgroundTextureId', selectedTextureId);\n    applyBackgroundTexture();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [selectedTextureId]);\n\n  useEffect(() => {\n    if (backgroundOpacity === viewSettings.backgroundOpacity) return;\n    saveViewSettings(envConfig, bookKey, 'backgroundOpacity', backgroundOpacity);\n    applyBackgroundTexture();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [backgroundOpacity]);\n\n  useEffect(() => {\n    if (backgroundSize === viewSettings.backgroundSize) return;\n    saveViewSettings(envConfig, bookKey, 'backgroundSize', backgroundSize);\n    applyBackgroundTexture();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [backgroundSize]);\n\n  const applyBackgroundTexture = () => {\n    applyTexture(envConfig, selectedTextureId);\n    document.documentElement.style.setProperty('--bg-texture-opacity', `${backgroundOpacity}`);\n    document.documentElement.style.setProperty('--bg-texture-size', backgroundSize);\n  };\n\n  useEffect(() => {\n    const customThemes = settings.globalReadSettings.customThemes ?? [];\n    setCustomThemes(\n      customThemes.map((customTheme) => ({\n        name: customTheme.name,\n        label: customTheme.label,\n        colors: {\n          light: generateLightPalette(customTheme.colors.light),\n          dark: generateDarkPalette(customTheme.colors.dark),\n        },\n        isCustomizale: true,\n      })),\n    );\n  }, [settings]);\n\n  const handleSaveCustomTheme = (customTheme: CustomTheme) => {\n    applyCustomTheme(customTheme);\n    saveCustomTheme(envConfig, settings, customTheme);\n    setSettings({ ...settings });\n    setThemeColor(customTheme.name);\n    setShowCustomThemeEditor(false);\n  };\n\n  const handleDeleteCustomTheme = (customTheme: CustomTheme) => {\n    saveCustomTheme(envConfig, settings, customTheme, true);\n    setSettings({ ...settings });\n    setThemeColor('default');\n    setShowCustomThemeEditor(false);\n  };\n\n  const handleEditTheme = (name: string) => {\n    const customTheme = settings.globalReadSettings.customThemes.find((t) => t.name === name);\n    if (customTheme) {\n      setEditTheme(customTheme);\n      setShowCustomThemeEditor(true);\n    }\n  };\n\n  const handleImportImage = () => {\n    selectFiles({ type: 'images', multiple: true }).then(async (result) => {\n      if (result.error || result.files.length === 0) return;\n      for (const selectedFile of result.files) {\n        const textureInfo = await appService?.importImage(selectedFile.path || selectedFile.file);\n        if (!textureInfo) continue;\n\n        const customTexture = addTexture(textureInfo.path);\n        console.log('Added custom texture:', customTexture);\n        if (customTexture && !customTexture.error) {\n          await loadTexture(envConfig, customTexture.id);\n        }\n      }\n      saveCustomTextures(envConfig);\n    });\n  };\n\n  const handleDeleteCustomTexture = (textureId: string) => {\n    removeTexture(textureId);\n    const updatedTextures = customTextures.filter((t) => t.id !== textureId);\n\n    settings.customTextures = updatedTextures;\n    setSettings(settings);\n\n    if (selectedTextureId === textureId) {\n      setSelectedTextureId('none');\n    }\n    saveCustomTextures(envConfig);\n  };\n\n  const handleHighlightColorsChange = (colors: typeof customHighlightColors) => {\n    setCustomHighlightColors(colors);\n    settings.globalReadSettings.customHighlightColors = colors;\n    setSettings(settings);\n    saveSettings(envConfig, settings);\n  };\n\n  const handleTTSStyleChange = (style: TTSHighlightStyle) => {\n    setTtsHighlightStyle(style);\n    saveViewSettings(envConfig, bookKey, 'ttsHighlightOptions', {\n      style,\n      color: ttsHighlightColor,\n    });\n  };\n\n  const handleTTSColorChange = (color: string) => {\n    setTtsHighlightColor(color);\n    saveViewSettings(envConfig, bookKey, 'ttsHighlightOptions', {\n      style: ttsHighlightStyle,\n      color,\n    });\n  };\n\n  const handleCustomTtsColorsChange = (colors: string[]) => {\n    setCustomTtsHighlightColors(colors);\n    settings.globalReadSettings.customTtsHighlightColors = colors;\n    setSettings(settings);\n    saveSettings(envConfig, settings);\n  };\n\n  return (\n    <div className='my-4 w-full space-y-6'>\n      {showCustomThemeEditor ? (\n        <ThemeEditor\n          customTheme={editTheme}\n          onSave={handleSaveCustomTheme}\n          onDelete={handleDeleteCustomTheme}\n          onCancel={() => setShowCustomThemeEditor(false)}\n        />\n      ) : (\n        <>\n          <ThemeModeSelector themeMode={themeMode} onThemeModeChange={setThemeMode} />\n\n          <div className='flex items-center justify-between'>\n            <h2 className='font-medium'>{_('Invert Image In Dark Mode')}</h2>\n            <input\n              type='checkbox'\n              className='toggle'\n              checked={invertImgColorInDark}\n              disabled={!isDarkMode}\n              onChange={() => setInvertImgColorInDark(!invertImgColorInDark)}\n            />\n          </div>\n\n          <div className='flex items-center justify-between'>\n            <h2 className='font-medium'>{_('Override Book Color')}</h2>\n            <input\n              type='checkbox'\n              className='toggle'\n              checked={overrideColor}\n              onChange={() => setOverrideColor(!overrideColor)}\n            />\n          </div>\n\n          <ThemeColorSelector\n            themes={themes.concat(customThemes)}\n            themeColor={themeColor}\n            isDarkMode={isDarkMode}\n            onThemeColorChange={setThemeColor}\n            onEditTheme={handleEditTheme}\n            onCreateTheme={() => setShowCustomThemeEditor(true)}\n          />\n\n          <BackgroundTextureSelector\n            predefinedTextures={PREDEFINED_TEXTURES}\n            customTextures={customTextures.filter((t) => !t.deletedAt)}\n            selectedTextureId={selectedTextureId}\n            backgroundOpacity={backgroundOpacity}\n            backgroundSize={backgroundSize}\n            onTextureSelect={setSelectedTextureId}\n            onOpacityChange={setBackgroundOpacity}\n            onSizeChange={setBackgroundSize}\n            onImportImage={handleImportImage}\n            onDeleteTexture={handleDeleteCustomTexture}\n          />\n\n          <HighlightColorsEditor\n            customHighlightColors={customHighlightColors}\n            onChange={handleHighlightColorsChange}\n          />\n\n          <TTSHighlightStyleEditor\n            style={ttsHighlightStyle}\n            color={ttsHighlightColor}\n            customColors={customTtsHighlightColors}\n            onStyleChange={handleTTSStyleChange}\n            onColorChange={handleTTSColorChange}\n            onCustomColorsChange={handleCustomTtsColorsChange}\n          />\n\n          <CodeHighlightingSettings\n            codeHighlighting={codeHighlighting}\n            codeLanguage={codeLanguage}\n            onToggle={setcodeHighlighting}\n            onLanguageChange={setCodeLanguage}\n          />\n        </>\n      )}\n    </div>\n  );\n};\n\nexport default ColorPanel;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 10290, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/components/settings/DialogMenu.tsx"],"sourcesContent":["import clsx from 'clsx';\nimport React from 'react';\nimport { MdCheck } from 'react-icons/md';\nimport { useEnv } from '@/context/EnvContext';\nimport { useSettingsStore } from '@/store/settingsStore';\nimport { useTranslation } from '@/hooks/useTranslation';\nimport { useCustomFontStore } from '@/store/customFontStore';\nimport { useResponsiveSize } from '@/hooks/useResponsiveSize';\nimport { SettingsPanelType } from './SettingsDialog';\nimport MenuItem from '@/components/MenuItem';\n\ninterface DialogMenuProps {\n  activePanel: SettingsPanelType;\n  setIsDropdownOpen?: (open: boolean) => void;\n  onReset: () => void;\n  resetLabel?: string;\n}\n\nconst DialogMenu: React.FC<DialogMenuProps> = ({\n  activePanel,\n  setIsDropdownOpen,\n  onReset,\n  resetLabel,\n}) => {\n  const _ = useTranslation();\n  const { envConfig, appService } = useEnv();\n  const iconSize = useResponsiveSize(16);\n  const { setFontPanelView, isSettingsGlobal, setSettingsGlobal } = useSettingsStore();\n  const { getAllFonts, removeFont, saveCustomFonts } = useCustomFontStore();\n\n  const handleToggleGlobal = () => {\n    setSettingsGlobal(!isSettingsGlobal);\n    setIsDropdownOpen?.(false);\n  };\n\n  const handleResetToDefaults = () => {\n    onReset();\n    setIsDropdownOpen?.(false);\n  };\n\n  const handleManageCustomFont = () => {\n    setFontPanelView('custom-fonts');\n    setIsDropdownOpen?.(false);\n  };\n\n  const handleClearCustomFont = () => {\n    getAllFonts().forEach((font) => {\n      if (removeFont(font.id)) {\n        appService!.deleteFont(font);\n      }\n    });\n    saveCustomFonts(envConfig);\n    setIsDropdownOpen?.(false);\n  };\n\n  return (\n    <div\n      className={clsx(\n        'dropdown-content dropdown-right no-triangle border-base-200 z-20 mt-1 border shadow-2xl',\n        'text-base sm:text-sm',\n      )}\n    >\n      <MenuItem\n        label={_('Global Settings')}\n        tooltip={isSettingsGlobal ? _('Apply to All Books') : _('Apply to This Book')}\n        buttonClass='lg:tooltip'\n        Icon={isSettingsGlobal ? <MdCheck size={iconSize} className='text-base-content' /> : null}\n        onClick={handleToggleGlobal}\n      />\n      <MenuItem label={resetLabel || _('Reset Settings')} onClick={handleResetToDefaults} />\n      {activePanel === 'Font' && (\n        <>\n          <MenuItem label={_('Clear Custom Fonts')} onClick={handleClearCustomFont} />\n          <MenuItem label={_('Manage Custom Fonts')} onClick={handleManageCustomFont} />\n        </>\n      )}\n    </div>\n  );\n};\n\nexport default DialogMenu;\n"],"names":[],"mappings":";;;;;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;;;;;;;;;;;;;;;;;;AASA,MAAM,aAAwC,CAAC,EAC7C,WAAW,EACX,iBAAiB,EACjB,OAAO,EACP,UAAU,EACX;IACC,MAAM,IAAI,IAAA,mKAAc;IACxB,MAAM,EAAE,SAAS,EAAE,UAAU,EAAE,GAAG,IAAA,0JAAM;IACxC,MAAM,WAAW,IAAA,yKAAiB,EAAC;IACnC,MAAM,EAAE,gBAAgB,EAAE,gBAAgB,EAAE,iBAAiB,EAAE,GAAG,IAAA,oKAAgB;IAClF,MAAM,EAAE,WAAW,EAAE,UAAU,EAAE,eAAe,EAAE,GAAG,IAAA,wKAAkB;IAEvE,MAAM,qBAAqB;QACzB,kBAAkB,CAAC;QACnB,oBAAoB;IACtB;IAEA,MAAM,wBAAwB;QAC5B;QACA,oBAAoB;IACtB;IAEA,MAAM,yBAAyB;QAC7B,iBAAiB;QACjB,oBAAoB;IACtB;IAEA,MAAM,wBAAwB;QAC5B,cAAc,OAAO,CAAC,CAAC;YACrB,IAAI,WAAW,KAAK,EAAE,GAAG;gBACvB,WAAY,UAAU,CAAC;YACzB;QACF;QACA,gBAAgB;QAChB,oBAAoB;IACtB;IAEA,qBACE,qKAAC;QACC,WAAW,IAAA,mHAAI,EACb,2FACA;;0BAGF,qKAAC,4JAAQ;gBACP,OAAO,EAAE;gBACT,SAAS,mBAAmB,EAAE,wBAAwB,EAAE;gBACxD,aAAY;gBACZ,MAAM,iCAAmB,qKAAC,mOAAO;oBAAC,MAAM;oBAAU,WAAU;;;;;6BAAyB;gBACrF,SAAS;;;;;;0BAEX,qKAAC,4JAAQ;gBAAC,OAAO,cAAc,EAAE;gBAAmB,SAAS;;;;;;YAC5D,gBAAgB,wBACf;;kCACE,qKAAC,4JAAQ;wBAAC,OAAO,EAAE;wBAAuB,SAAS;;;;;;kCACnD,qKAAC,4JAAQ;wBAAC,OAAO,EAAE;wBAAwB,SAAS;;;;;;;;;;;;;;AAK9D;uCAEe"}},
    {"offset": {"line": 10411, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/components/settings/ControlPanel.tsx"],"sourcesContent":["'use client';\n\nimport React, { useEffect, useState } from 'react';\nimport { useEnv } from '@/context/EnvContext';\nimport { useReaderStore } from '@/store/readerStore';\nimport { useDeviceControlStore } from '@/store/deviceStore';\nimport { useTranslation } from '@/hooks/useTranslation';\nimport { useBookDataStore } from '@/store/bookDataStore';\nimport { useSettingsStore } from '@/store/settingsStore';\nimport { useResetViewSettings } from '@/hooks/useResetSettings';\nimport { useEinkMode } from '@/hooks/useEinkMode';\nimport { getStyles } from '@/utils/style';\nimport { getMaxInlineSize } from '@/utils/config';\nimport { saveSysSettings, saveViewSettings } from '@/helpers/settings';\nimport { SettingsPanelPanelProp } from './SettingsDialog';\nimport { annotationToolQuickActions } from '@/app/reader/components/annotator/AnnotationTools';\nimport NumberInput from './NumberInput';\nimport Select from '../Select';\n\nconst ControlPanel: React.FC<SettingsPanelPanelProp> = ({ bookKey, onRegisterReset }) => {\n  const _ = useTranslation();\n  const { envConfig, appService } = useEnv();\n  const { getView, getViewSettings, recreateViewer } = useReaderStore();\n  const { getBookData } = useBookDataStore();\n  const { settings } = useSettingsStore();\n  const { applyEinkMode } = useEinkMode();\n  const { acquireVolumeKeyInterception, releaseVolumeKeyInterception } = useDeviceControlStore();\n  const bookData = getBookData(bookKey);\n  const viewSettings = getViewSettings(bookKey) || settings.globalViewSettings;\n\n  const [isScrolledMode, setScrolledMode] = useState(viewSettings.scrolled);\n  const [isContinuousScroll, setIsContinuousScroll] = useState(viewSettings.continuousScroll);\n  const [scrollingOverlap, setScrollingOverlap] = useState(viewSettings.scrollingOverlap);\n  const [volumeKeysToFlip, setVolumeKeysToFlip] = useState(viewSettings.volumeKeysToFlip);\n  const [isDisableClick, setIsDisableClick] = useState(viewSettings.disableClick);\n  const [fullscreenClickArea, setFullscreenClickArea] = useState(viewSettings.fullscreenClickArea);\n  const [swapClickArea, setSwapClickArea] = useState(viewSettings.swapClickArea);\n  const [isDisableDoubleClick, setIsDisableDoubleClick] = useState(viewSettings.disableDoubleClick);\n  const [enableAnnotationQuickActions, setEnableAnnotationQuickActions] = useState(\n    viewSettings.enableAnnotationQuickActions,\n  );\n  const [annotationQuickAction, setAnnotationQuickAction] = useState(\n    viewSettings.annotationQuickAction,\n  );\n  const [copyToNotebook, setCopyToNotebook] = useState(viewSettings.copyToNotebook);\n  const [animated, setAnimated] = useState(viewSettings.animated);\n  const [isEink, setIsEink] = useState(viewSettings.isEink);\n  const [autoScreenBrightness, setAutoScreenBrightness] = useState(settings.autoScreenBrightness);\n  const [allowScript, setAllowScript] = useState(viewSettings.allowScript);\n\n  const resetToDefaults = useResetViewSettings();\n\n  const handleReset = () => {\n    resetToDefaults({\n      scrolled: setScrolledMode,\n      continuousScroll: setIsContinuousScroll,\n      scrollingOverlap: setScrollingOverlap,\n      volumeKeysToFlip: setVolumeKeysToFlip,\n      disableClick: setIsDisableClick,\n      swapClickArea: setSwapClickArea,\n      animated: setAnimated,\n      isEink: setIsEink,\n      allowScript: setAllowScript,\n      fullscreenClickArea: setFullscreenClickArea,\n      disableDoubleClick: setIsDisableDoubleClick,\n      enableAnnotationQuickActions: setEnableAnnotationQuickActions,\n      copyToNotebook: setCopyToNotebook,\n    });\n  };\n\n  useEffect(() => {\n    onRegisterReset(handleReset);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  useEffect(() => {\n    if (isScrolledMode === viewSettings.scrolled) return;\n    saveViewSettings(envConfig, bookKey, 'scrolled', isScrolledMode);\n    getView(bookKey)?.renderer.setAttribute('flow', isScrolledMode ? 'scrolled' : 'paginated');\n    getView(bookKey)?.renderer.setAttribute(\n      'max-inline-size',\n      `${getMaxInlineSize(viewSettings)}px`,\n    );\n    getView(bookKey)?.renderer.setStyles?.(getStyles(viewSettings!));\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [isScrolledMode]);\n\n  useEffect(() => {\n    saveViewSettings(envConfig, bookKey, 'continuousScroll', isContinuousScroll, false, false);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [isContinuousScroll]);\n\n  useEffect(() => {\n    if (scrollingOverlap === viewSettings.scrollingOverlap) return;\n    saveViewSettings(envConfig, bookKey, 'scrollingOverlap', scrollingOverlap, false, false);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [scrollingOverlap]);\n\n  useEffect(() => {\n    saveViewSettings(envConfig, bookKey, 'volumeKeysToFlip', volumeKeysToFlip, false, false);\n    if (appService?.isMobileApp) {\n      if (volumeKeysToFlip) {\n        acquireVolumeKeyInterception();\n      } else {\n        releaseVolumeKeyInterception();\n      }\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [volumeKeysToFlip]);\n\n  useEffect(() => {\n    saveViewSettings(envConfig, bookKey, 'disableClick', isDisableClick, false, false);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [isDisableClick]);\n\n  useEffect(() => {\n    saveViewSettings(envConfig, bookKey, 'disableDoubleClick', isDisableDoubleClick, false, false);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [isDisableDoubleClick]);\n\n  useEffect(() => {\n    saveViewSettings(envConfig, bookKey, 'fullscreenClickArea', fullscreenClickArea, false, false);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [fullscreenClickArea]);\n\n  useEffect(() => {\n    saveViewSettings(envConfig, bookKey, 'swapClickArea', swapClickArea, false, false);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [swapClickArea]);\n\n  useEffect(() => {\n    saveViewSettings(envConfig, bookKey, 'animated', animated, false, false);\n    if (animated) {\n      getView(bookKey)?.renderer.setAttribute('animated', '');\n    } else {\n      getView(bookKey)?.renderer.removeAttribute('animated');\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [animated]);\n\n  useEffect(() => {\n    saveViewSettings(envConfig, bookKey, 'isEink', isEink);\n    if (isEink) {\n      getView(bookKey)?.renderer.setAttribute('eink', '');\n    } else {\n      getView(bookKey)?.renderer.removeAttribute('eink');\n    }\n    applyEinkMode(isEink);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [isEink]);\n\n  useEffect(() => {\n    if (autoScreenBrightness === settings.autoScreenBrightness) return;\n    saveSysSettings(envConfig, 'autoScreenBrightness', autoScreenBrightness);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [autoScreenBrightness]);\n\n  useEffect(() => {\n    if (viewSettings.allowScript === allowScript) return;\n    saveViewSettings(envConfig, bookKey, 'allowScript', allowScript, true, false).then(() => {\n      recreateViewer(envConfig, bookKey);\n    });\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [allowScript]);\n\n  useEffect(() => {\n    saveViewSettings(\n      envConfig,\n      bookKey,\n      'enableAnnotationQuickActions',\n      enableAnnotationQuickActions,\n      false,\n      false,\n    );\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [enableAnnotationQuickActions]);\n\n  useEffect(() => {\n    saveViewSettings(envConfig, bookKey, 'copyToNotebook', copyToNotebook, false, false);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [copyToNotebook]);\n\n  const getQuickActionOptions = () => {\n    return [\n      {\n        value: '',\n        label: _('None'),\n      },\n      ...annotationToolQuickActions.map((button) => ({\n        value: button.type,\n        label: _(button.label),\n      })),\n    ];\n  };\n\n  const handleSelectAnnotationQuickAction = (event: React.ChangeEvent<HTMLSelectElement>) => {\n    const action = event.target.value as typeof annotationQuickAction;\n    setAnnotationQuickAction(action);\n    saveViewSettings(envConfig, bookKey, 'annotationQuickAction', action, false, true);\n  };\n\n  return (\n    <div className='my-4 w-full space-y-6'>\n      <div className='w-full'>\n        <h2 className='mb-2 font-medium'>{_('Scroll')}</h2>\n        <div className='card border-base-200 bg-base-100 border shadow'>\n          <div className='divide-base-200 divide-y'>\n            <div className='config-item'>\n              <span className=''>{_('Scrolled Mode')}</span>\n              <input\n                type='checkbox'\n                className='toggle'\n                checked={isScrolledMode}\n                disabled={bookData?.isFixedLayout}\n                onChange={() => setScrolledMode(!isScrolledMode)}\n              />\n            </div>\n            <div className='config-item'>\n              <span className=''>{_('Continuous Scroll')}</span>\n              <input\n                type='checkbox'\n                className='toggle'\n                checked={isContinuousScroll}\n                disabled={bookData?.isFixedLayout}\n                onChange={() => setIsContinuousScroll(!isContinuousScroll)}\n              />\n            </div>\n            <NumberInput\n              label={_('Overlap Pixels')}\n              value={scrollingOverlap}\n              onChange={setScrollingOverlap}\n              disabled={!viewSettings.scrolled}\n              min={0}\n              max={200}\n              step={10}\n            />\n          </div>\n        </div>\n      </div>\n\n      <div className='w-full'>\n        <h2 className='mb-2 font-medium'>{_('Pagination')}</h2>\n        <div className='card border-base-200 bg-base-100 border shadow'>\n          <div className='divide-base-200'>\n            <div className='config-item'>\n              <span className=''>\n                {appService?.isMobileApp ? _('Tap to Paginate') : _('Click to Paginate')}\n              </span>\n              <input\n                type='checkbox'\n                className='toggle'\n                checked={!isDisableClick}\n                onChange={() => setIsDisableClick(!isDisableClick)}\n              />\n            </div>\n            <div className='config-item'>\n              <span className=''>\n                {appService?.isMobileApp ? _('Tap Both Sides') : _('Click Both Sides')}\n              </span>\n              <input\n                type='checkbox'\n                className='toggle'\n                checked={fullscreenClickArea}\n                disabled={isDisableClick}\n                onChange={() => setFullscreenClickArea(!fullscreenClickArea)}\n              />\n            </div>\n            <div className='config-item'>\n              <span className=''>\n                {appService?.isMobileApp ? _('Swap Tap Sides') : _('Swap Click Sides')}\n              </span>\n              <input\n                type='checkbox'\n                className='toggle'\n                checked={swapClickArea}\n                disabled={isDisableClick || fullscreenClickArea}\n                onChange={() => setSwapClickArea(!swapClickArea)}\n              />\n            </div>\n            <div className='config-item'>\n              <span className=''>\n                {appService?.isMobileApp ? _('Disable Double Tap') : _('Disable Double Click')}\n              </span>\n              <input\n                type='checkbox'\n                className='toggle'\n                checked={isDisableDoubleClick}\n                onChange={() => setIsDisableDoubleClick(!isDisableDoubleClick)}\n              />\n            </div>\n            {appService?.isMobileApp && (\n              <div className='config-item'>\n                <span className=''>{_('Volume Keys for Page Flip')}</span>\n                <input\n                  type='checkbox'\n                  className='toggle'\n                  checked={volumeKeysToFlip}\n                  onChange={() => setVolumeKeysToFlip(!volumeKeysToFlip)}\n                />\n              </div>\n            )}\n          </div>\n        </div>\n      </div>\n\n      <div className='w-full'>\n        <h2 className='mb-2 font-medium'>{_('Annotation Tools')}</h2>\n        <div className='card border-base-200 bg-base-100 border shadow'>\n          <div className='divide-base-200 divide-y'>\n            <div className='config-item'>\n              <span className=''>{_('Enable Quick Actions')}</span>\n              <input\n                type='checkbox'\n                className='toggle'\n                checked={enableAnnotationQuickActions}\n                onChange={() => setEnableAnnotationQuickActions(!enableAnnotationQuickActions)}\n              />\n            </div>\n            <div className='config-item'>\n              <span className=''>{_('Quick Action')}</span>\n              <Select\n                value={annotationQuickAction || ''}\n                onChange={handleSelectAnnotationQuickAction}\n                options={getQuickActionOptions()}\n                disabled={!enableAnnotationQuickActions}\n              />\n            </div>\n            <div className='config-item'>\n              <span className=''>{_('Copy to Notebook')}</span>\n              <input\n                type='checkbox'\n                className='toggle'\n                checked={copyToNotebook}\n                onChange={() => setCopyToNotebook(!copyToNotebook)}\n              />\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <div className='w-full'>\n        <h2 className='mb-2 font-medium'>{_('Animation')}</h2>\n        <div className='card border-base-200 bg-base-100 border shadow'>\n          <div className='divide-base-200 divide-y'>\n            <div className='config-item'>\n              <span className=''>{_('Paging Animation')}</span>\n              <input\n                type='checkbox'\n                className='toggle'\n                checked={animated}\n                onChange={() => setAnimated(!animated)}\n              />\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {(appService?.isMobileApp || appService?.appPlatform === 'web') && (\n        <div className='w-full'>\n          <h2 className='mb-2 font-medium'>{_('Device')}</h2>\n          <div className='card border-base-200 bg-base-100 border shadow'>\n            <div className='divide-base-200 divide-y'>\n              {(appService?.isAndroidApp || appService?.appPlatform === 'web') && (\n                <div className='config-item'>\n                  <span className=''>{_('E-Ink Mode')}</span>\n                  <input\n                    type='checkbox'\n                    className='toggle'\n                    checked={isEink}\n                    onChange={() => setIsEink(!isEink)}\n                  />\n                </div>\n              )}\n              {appService?.isMobileApp && (\n                <div className='config-item'>\n                  <span className=''>{_('Auto Screen Brightness')}</span>\n                  <input\n                    type='checkbox'\n                    className='toggle'\n                    checked={autoScreenBrightness}\n                    onChange={() => setAutoScreenBrightness(!autoScreenBrightness)}\n                  />\n                </div>\n              )}\n            </div>\n          </div>\n        </div>\n      )}\n\n      <div className='w-full'>\n        <h2 className='mb-2 font-medium'>{_('Security')}</h2>\n        <div className='card border-base-200 bg-base-100 border shadow'>\n          <div className='divide-base-200 divide-y'>\n            <div className='config-item !h-16'>\n              <div className='flex flex-col gap-1'>\n                <span className=''>{_('Allow JavaScript')}</span>\n                <span className='text-xs'>{_('Enable only if you trust the file.')}</span>\n              </div>\n              <input\n                type='checkbox'\n                className='toggle'\n                checked={allowScript}\n                disabled={bookData?.book?.format !== 'EPUB'}\n                onChange={() => setAllowScript(!allowScript)}\n              />\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default ControlPanel;\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;;;;;;;;;;;;;;AAjBA;;;;;;;;;;;;;;;;;AAmBA,MAAM,eAAiD,CAAC,EAAE,OAAO,EAAE,eAAe,EAAE;IAClF,MAAM,IAAI,IAAA,mKAAc;IACxB,MAAM,EAAE,SAAS,EAAE,UAAU,EAAE,GAAG,IAAA,0JAAM;IACxC,MAAM,EAAE,OAAO,EAAE,eAAe,EAAE,cAAc,EAAE,GAAG,IAAA,gKAAc;IACnE,MAAM,EAAE,WAAW,EAAE,GAAG,IAAA,oKAAgB;IACxC,MAAM,EAAE,QAAQ,EAAE,GAAG,IAAA,oKAAgB;IACrC,MAAM,EAAE,aAAa,EAAE,GAAG,IAAA,6JAAW;IACrC,MAAM,EAAE,4BAA4B,EAAE,4BAA4B,EAAE,GAAG,IAAA,uKAAqB;IAC5F,MAAM,WAAW,YAAY;IAC7B,MAAM,eAAe,gBAAgB,YAAY,SAAS,kBAAkB;IAE5E,MAAM,CAAC,gBAAgB,gBAAgB,GAAG,IAAA,+GAAQ,EAAC,aAAa,QAAQ;IACxE,MAAM,CAAC,oBAAoB,sBAAsB,GAAG,IAAA,+GAAQ,EAAC,aAAa,gBAAgB;IAC1F,MAAM,CAAC,kBAAkB,oBAAoB,GAAG,IAAA,+GAAQ,EAAC,aAAa,gBAAgB;IACtF,MAAM,CAAC,kBAAkB,oBAAoB,GAAG,IAAA,+GAAQ,EAAC,aAAa,gBAAgB;IACtF,MAAM,CAAC,gBAAgB,kBAAkB,GAAG,IAAA,+GAAQ,EAAC,aAAa,YAAY;IAC9E,MAAM,CAAC,qBAAqB,uBAAuB,GAAG,IAAA,+GAAQ,EAAC,aAAa,mBAAmB;IAC/F,MAAM,CAAC,eAAe,iBAAiB,GAAG,IAAA,+GAAQ,EAAC,aAAa,aAAa;IAC7E,MAAM,CAAC,sBAAsB,wBAAwB,GAAG,IAAA,+GAAQ,EAAC,aAAa,kBAAkB;IAChG,MAAM,CAAC,8BAA8B,gCAAgC,GAAG,IAAA,+GAAQ,EAC9E,aAAa,4BAA4B;IAE3C,MAAM,CAAC,uBAAuB,yBAAyB,GAAG,IAAA,+GAAQ,EAChE,aAAa,qBAAqB;IAEpC,MAAM,CAAC,gBAAgB,kBAAkB,GAAG,IAAA,+GAAQ,EAAC,aAAa,cAAc;IAChF,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,+GAAQ,EAAC,aAAa,QAAQ;IAC9D,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,+GAAQ,EAAC,aAAa,MAAM;IACxD,MAAM,CAAC,sBAAsB,wBAAwB,GAAG,IAAA,+GAAQ,EAAC,SAAS,oBAAoB;IAC9F,MAAM,CAAC,aAAa,eAAe,GAAG,IAAA,+GAAQ,EAAC,aAAa,WAAW;IAEvE,MAAM,kBAAkB,IAAA,2KAAoB;IAE5C,MAAM,cAAc;QAClB,gBAAgB;YACd,UAAU;YACV,kBAAkB;YAClB,kBAAkB;YAClB,kBAAkB;YAClB,cAAc;YACd,eAAe;YACf,UAAU;YACV,QAAQ;YACR,aAAa;YACb,qBAAqB;YACrB,oBAAoB;YACpB,8BAA8B;YAC9B,gBAAgB;QAClB;IACF;IAEA,IAAA,gHAAS,EAAC;QACR,gBAAgB;IAChB,uDAAuD;IACzD,GAAG,EAAE;IAEL,IAAA,gHAAS,EAAC;QACR,IAAI,mBAAmB,aAAa,QAAQ,EAAE;QAC9C,IAAA,iKAAgB,EAAC,WAAW,SAAS,YAAY;QACjD,QAAQ,UAAU,SAAS,aAAa,QAAQ,iBAAiB,aAAa;QAC9E,QAAQ,UAAU,SAAS,aACzB,mBACA,GAAG,IAAA,6JAAgB,EAAC,cAAc,EAAE,CAAC;QAEvC,QAAQ,UAAU,SAAS,YAAY,IAAA,qJAAS,EAAC;IACjD,uDAAuD;IACzD,GAAG;QAAC;KAAe;IAEnB,IAAA,gHAAS,EAAC;QACR,IAAA,iKAAgB,EAAC,WAAW,SAAS,oBAAoB,oBAAoB,OAAO;IACpF,uDAAuD;IACzD,GAAG;QAAC;KAAmB;IAEvB,IAAA,gHAAS,EAAC;QACR,IAAI,qBAAqB,aAAa,gBAAgB,EAAE;QACxD,IAAA,iKAAgB,EAAC,WAAW,SAAS,oBAAoB,kBAAkB,OAAO;IAClF,uDAAuD;IACzD,GAAG;QAAC;KAAiB;IAErB,IAAA,gHAAS,EAAC;QACR,IAAA,iKAAgB,EAAC,WAAW,SAAS,oBAAoB,kBAAkB,OAAO;QAClF,IAAI,YAAY,aAAa;YAC3B,IAAI,kBAAkB;gBACpB;YACF,OAAO;gBACL;YACF;QACF;IACA,uDAAuD;IACzD,GAAG;QAAC;KAAiB;IAErB,IAAA,gHAAS,EAAC;QACR,IAAA,iKAAgB,EAAC,WAAW,SAAS,gBAAgB,gBAAgB,OAAO;IAC5E,uDAAuD;IACzD,GAAG;QAAC;KAAe;IAEnB,IAAA,gHAAS,EAAC;QACR,IAAA,iKAAgB,EAAC,WAAW,SAAS,sBAAsB,sBAAsB,OAAO;IACxF,uDAAuD;IACzD,GAAG;QAAC;KAAqB;IAEzB,IAAA,gHAAS,EAAC;QACR,IAAA,iKAAgB,EAAC,WAAW,SAAS,uBAAuB,qBAAqB,OAAO;IACxF,uDAAuD;IACzD,GAAG;QAAC;KAAoB;IAExB,IAAA,gHAAS,EAAC;QACR,IAAA,iKAAgB,EAAC,WAAW,SAAS,iBAAiB,eAAe,OAAO;IAC5E,uDAAuD;IACzD,GAAG;QAAC;KAAc;IAElB,IAAA,gHAAS,EAAC;QACR,IAAA,iKAAgB,EAAC,WAAW,SAAS,YAAY,UAAU,OAAO;QAClE,IAAI,UAAU;YACZ,QAAQ,UAAU,SAAS,aAAa,YAAY;QACtD,OAAO;YACL,QAAQ,UAAU,SAAS,gBAAgB;QAC7C;IACA,uDAAuD;IACzD,GAAG;QAAC;KAAS;IAEb,IAAA,gHAAS,EAAC;QACR,IAAA,iKAAgB,EAAC,WAAW,SAAS,UAAU;QAC/C,IAAI,QAAQ;YACV,QAAQ,UAAU,SAAS,aAAa,QAAQ;QAClD,OAAO;YACL,QAAQ,UAAU,SAAS,gBAAgB;QAC7C;QACA,cAAc;IACd,uDAAuD;IACzD,GAAG;QAAC;KAAO;IAEX,IAAA,gHAAS,EAAC;QACR,IAAI,yBAAyB,SAAS,oBAAoB,EAAE;QAC5D,IAAA,gKAAe,EAAC,WAAW,wBAAwB;IACnD,uDAAuD;IACzD,GAAG;QAAC;KAAqB;IAEzB,IAAA,gHAAS,EAAC;QACR,IAAI,aAAa,WAAW,KAAK,aAAa;QAC9C,IAAA,iKAAgB,EAAC,WAAW,SAAS,eAAe,aAAa,MAAM,OAAO,IAAI,CAAC;YACjF,eAAe,WAAW;QAC5B;IACA,uDAAuD;IACzD,GAAG;QAAC;KAAY;IAEhB,IAAA,gHAAS,EAAC;QACR,IAAA,iKAAgB,EACd,WACA,SACA,gCACA,8BACA,OACA;IAEF,uDAAuD;IACzD,GAAG;QAAC;KAA6B;IAEjC,IAAA,gHAAS,EAAC;QACR,IAAA,iKAAgB,EAAC,WAAW,SAAS,kBAAkB,gBAAgB,OAAO;IAC9E,uDAAuD;IACzD,GAAG;QAAC;KAAe;IAEnB,MAAM,wBAAwB;QAC5B,OAAO;YACL;gBACE,OAAO;gBACP,OAAO,EAAE;YACX;eACG,oNAA0B,CAAC,GAAG,CAAC,CAAC,SAAW,CAAC;oBAC7C,OAAO,OAAO,IAAI;oBAClB,OAAO,EAAE,OAAO,KAAK;gBACvB,CAAC;SACF;IACH;IAEA,MAAM,oCAAoC,CAAC;QACzC,MAAM,SAAS,MAAM,MAAM,CAAC,KAAK;QACjC,yBAAyB;QACzB,IAAA,iKAAgB,EAAC,WAAW,SAAS,yBAAyB,QAAQ,OAAO;IAC/E;IAEA,qBACE,qKAAC;QAAI,WAAU;;0BACb,qKAAC;gBAAI,WAAU;;kCACb,qKAAC;wBAAG,WAAU;kCAAoB,EAAE;;;;;;kCACpC,qKAAC;wBAAI,WAAU;kCACb,cAAA,qKAAC;4BAAI,WAAU;;8CACb,qKAAC;oCAAI,WAAU;;sDACb,qKAAC;4CAAK,WAAU;sDAAI,EAAE;;;;;;sDACtB,qKAAC;4CACC,MAAK;4CACL,WAAU;4CACV,SAAS;4CACT,UAAU,UAAU;4CACpB,UAAU,IAAM,gBAAgB,CAAC;;;;;;;;;;;;8CAGrC,qKAAC;oCAAI,WAAU;;sDACb,qKAAC;4CAAK,WAAU;sDAAI,EAAE;;;;;;sDACtB,qKAAC;4CACC,MAAK;4CACL,WAAU;4CACV,SAAS;4CACT,UAAU,UAAU;4CACpB,UAAU,IAAM,sBAAsB,CAAC;;;;;;;;;;;;8CAG3C,qKAAC,2KAAW;oCACV,OAAO,EAAE;oCACT,OAAO;oCACP,UAAU;oCACV,UAAU,CAAC,aAAa,QAAQ;oCAChC,KAAK;oCACL,KAAK;oCACL,MAAM;;;;;;;;;;;;;;;;;;;;;;;0BAMd,qKAAC;gBAAI,WAAU;;kCACb,qKAAC;wBAAG,WAAU;kCAAoB,EAAE;;;;;;kCACpC,qKAAC;wBAAI,WAAU;kCACb,cAAA,qKAAC;4BAAI,WAAU;;8CACb,qKAAC;oCAAI,WAAU;;sDACb,qKAAC;4CAAK,WAAU;sDACb,YAAY,cAAc,EAAE,qBAAqB,EAAE;;;;;;sDAEtD,qKAAC;4CACC,MAAK;4CACL,WAAU;4CACV,SAAS,CAAC;4CACV,UAAU,IAAM,kBAAkB,CAAC;;;;;;;;;;;;8CAGvC,qKAAC;oCAAI,WAAU;;sDACb,qKAAC;4CAAK,WAAU;sDACb,YAAY,cAAc,EAAE,oBAAoB,EAAE;;;;;;sDAErD,qKAAC;4CACC,MAAK;4CACL,WAAU;4CACV,SAAS;4CACT,UAAU;4CACV,UAAU,IAAM,uBAAuB,CAAC;;;;;;;;;;;;8CAG5C,qKAAC;oCAAI,WAAU;;sDACb,qKAAC;4CAAK,WAAU;sDACb,YAAY,cAAc,EAAE,oBAAoB,EAAE;;;;;;sDAErD,qKAAC;4CACC,MAAK;4CACL,WAAU;4CACV,SAAS;4CACT,UAAU,kBAAkB;4CAC5B,UAAU,IAAM,iBAAiB,CAAC;;;;;;;;;;;;8CAGtC,qKAAC;oCAAI,WAAU;;sDACb,qKAAC;4CAAK,WAAU;sDACb,YAAY,cAAc,EAAE,wBAAwB,EAAE;;;;;;sDAEzD,qKAAC;4CACC,MAAK;4CACL,WAAU;4CACV,SAAS;4CACT,UAAU,IAAM,wBAAwB,CAAC;;;;;;;;;;;;gCAG5C,YAAY,6BACX,qKAAC;oCAAI,WAAU;;sDACb,qKAAC;4CAAK,WAAU;sDAAI,EAAE;;;;;;sDACtB,qKAAC;4CACC,MAAK;4CACL,WAAU;4CACV,SAAS;4CACT,UAAU,IAAM,oBAAoB,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;0BAQjD,qKAAC;gBAAI,WAAU;;kCACb,qKAAC;wBAAG,WAAU;kCAAoB,EAAE;;;;;;kCACpC,qKAAC;wBAAI,WAAU;kCACb,cAAA,qKAAC;4BAAI,WAAU;;8CACb,qKAAC;oCAAI,WAAU;;sDACb,qKAAC;4CAAK,WAAU;sDAAI,EAAE;;;;;;sDACtB,qKAAC;4CACC,MAAK;4CACL,WAAU;4CACV,SAAS;4CACT,UAAU,IAAM,gCAAgC,CAAC;;;;;;;;;;;;8CAGrD,qKAAC;oCAAI,WAAU;;sDACb,qKAAC;4CAAK,WAAU;sDAAI,EAAE;;;;;;sDACtB,qKAAC,0JAAM;4CACL,OAAO,yBAAyB;4CAChC,UAAU;4CACV,SAAS;4CACT,UAAU,CAAC;;;;;;;;;;;;8CAGf,qKAAC;oCAAI,WAAU;;sDACb,qKAAC;4CAAK,WAAU;sDAAI,EAAE;;;;;;sDACtB,qKAAC;4CACC,MAAK;4CACL,WAAU;4CACV,SAAS;4CACT,UAAU,IAAM,kBAAkB,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;0BAO7C,qKAAC;gBAAI,WAAU;;kCACb,qKAAC;wBAAG,WAAU;kCAAoB,EAAE;;;;;;kCACpC,qKAAC;wBAAI,WAAU;kCACb,cAAA,qKAAC;4BAAI,WAAU;sCACb,cAAA,qKAAC;gCAAI,WAAU;;kDACb,qKAAC;wCAAK,WAAU;kDAAI,EAAE;;;;;;kDACtB,qKAAC;wCACC,MAAK;wCACL,WAAU;wCACV,SAAS;wCACT,UAAU,IAAM,YAAY,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;YAOtC,CAAC,YAAY,eAAe,YAAY,gBAAgB,KAAK,mBAC5D,qKAAC;gBAAI,WAAU;;kCACb,qKAAC;wBAAG,WAAU;kCAAoB,EAAE;;;;;;kCACpC,qKAAC;wBAAI,WAAU;kCACb,cAAA,qKAAC;4BAAI,WAAU;;gCACZ,CAAC,YAAY,gBAAgB,YAAY,gBAAgB,KAAK,mBAC7D,qKAAC;oCAAI,WAAU;;sDACb,qKAAC;4CAAK,WAAU;sDAAI,EAAE;;;;;;sDACtB,qKAAC;4CACC,MAAK;4CACL,WAAU;4CACV,SAAS;4CACT,UAAU,IAAM,UAAU,CAAC;;;;;;;;;;;;gCAIhC,YAAY,6BACX,qKAAC;oCAAI,WAAU;;sDACb,qKAAC;4CAAK,WAAU;sDAAI,EAAE;;;;;;sDACtB,qKAAC;4CACC,MAAK;4CACL,WAAU;4CACV,SAAS;4CACT,UAAU,IAAM,wBAAwB,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;0BASvD,qKAAC;gBAAI,WAAU;;kCACb,qKAAC;wBAAG,WAAU;kCAAoB,EAAE;;;;;;kCACpC,qKAAC;wBAAI,WAAU;kCACb,cAAA,qKAAC;4BAAI,WAAU;sCACb,cAAA,qKAAC;gCAAI,WAAU;;kDACb,qKAAC;wCAAI,WAAU;;0DACb,qKAAC;gDAAK,WAAU;0DAAI,EAAE;;;;;;0DACtB,qKAAC;gDAAK,WAAU;0DAAW,EAAE;;;;;;;;;;;;kDAE/B,qKAAC;wCACC,MAAK;wCACL,WAAU;wCACV,SAAS;wCACT,UAAU,UAAU,MAAM,WAAW;wCACrC,UAAU,IAAM,eAAe,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAQhD;uCAEe"}},
    {"offset": {"line": 11261, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/components/settings/LangPanel.tsx"],"sourcesContent":["'use client';\n\nimport clsx from 'clsx';\nimport React, { useEffect, useState } from 'react';\nimport { useEnv } from '@/context/EnvContext';\nimport { useAuth } from '@/context/AuthContext';\nimport { useReaderStore } from '@/store/readerStore';\nimport { useTranslation } from '@/hooks/useTranslation';\nimport { useSettingsStore } from '@/store/settingsStore';\nimport { saveViewSettings } from '@/helpers/settings';\nimport { getTranslators } from '@/services/translators';\nimport { useResetViewSettings } from '@/hooks/useResetSettings';\nimport { TRANSLATED_LANGS, TRANSLATOR_LANGS } from '@/services/constants';\nimport { ConvertChineseVariant } from '@/types/book';\nimport { SettingsPanelPanelProp } from './SettingsDialog';\nimport { isCJKEnv } from '@/utils/misc';\nimport Select from '@/components/Select';\n\nconst LangPanel: React.FC<SettingsPanelPanelProp> = ({ bookKey, onRegisterReset }) => {\n  const _ = useTranslation();\n  const { token } = useAuth();\n  const { envConfig } = useEnv();\n  const { settings, applyUILanguage } = useSettingsStore();\n  const { getView, getViewSettings, setViewSettings, recreateViewer } = useReaderStore();\n  const view = getView(bookKey);\n  const viewSettings = getViewSettings(bookKey) || settings.globalViewSettings;\n\n  const [uiLanguage, setUILanguage] = useState(viewSettings.uiLanguage);\n  const [translationEnabled, setTranslationEnabled] = useState(viewSettings.translationEnabled);\n  const [translationProvider, setTranslationProvider] = useState(viewSettings.translationProvider);\n  const [translateTargetLang, setTranslateTargetLang] = useState(viewSettings.translateTargetLang);\n  const [showTranslateSource, setShowTranslateSource] = useState(viewSettings.showTranslateSource);\n  const [ttsReadAloudText, setTtsReadAloudText] = useState(viewSettings.ttsReadAloudText);\n  const [replaceQuotationMarks, setReplaceQuotationMarks] = useState(\n    viewSettings.replaceQuotationMarks,\n  );\n  const [convertChineseVariant, setConvertChineseVariant] = useState(\n    viewSettings.convertChineseVariant,\n  );\n\n  const resetToDefaults = useResetViewSettings();\n\n  const handleReset = () => {\n    resetToDefaults({\n      uiLanguage: setUILanguage,\n      translationEnabled: setTranslationEnabled,\n      translationProvider: setTranslationProvider,\n      translateTargetLang: setTranslateTargetLang,\n      showTranslateSource: setShowTranslateSource,\n      ttsReadAloudText: setTtsReadAloudText,\n      replaceQuotationMarks: setReplaceQuotationMarks,\n    });\n  };\n\n  useEffect(() => {\n    onRegisterReset(handleReset);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  const getCurrentUILangOption = () => {\n    const uiLanguage = viewSettings.uiLanguage;\n    return {\n      value: uiLanguage,\n      label:\n        uiLanguage === ''\n          ? _('Auto')\n          : TRANSLATED_LANGS[uiLanguage as keyof typeof TRANSLATED_LANGS],\n    };\n  };\n\n  const getLangOptions = (langs: Record<string, string>) => {\n    const options = Object.entries(langs).map(([value, label]) => ({ value, label }));\n    options.sort((a, b) => a.label.localeCompare(b.label));\n    options.unshift({ value: '', label: _('System Language') });\n    return options;\n  };\n\n  const handleSelectUILang = (event: React.ChangeEvent<HTMLSelectElement>) => {\n    const option = event.target.value;\n    setUILanguage(option);\n  };\n\n  const getTranslationProviderOptions = () => {\n    const translators = getTranslators();\n    const availableProviders = translators.map((t) => {\n      let label = t.label;\n      if (t.authRequired && !token) {\n        label = `${label} (${_('Login Required')})`;\n      } else if (t.quotaExceeded) {\n        label = `${label} (${_('Quota Exceeded')})`;\n      }\n      return { value: t.name, label };\n    });\n    return availableProviders;\n  };\n\n  const getCurrentTranslationProviderOption = () => {\n    const value = translationProvider;\n    const allProviders = getTranslationProviderOptions();\n    const availableTranslators = getTranslators().filter(\n      (t) => (t.authRequired ? !!token : true) && !t.quotaExceeded,\n    );\n    const currentProvider = availableTranslators.find((t) => t.name === value)\n      ? value\n      : availableTranslators[0]?.name;\n    return allProviders.find((p) => p.value === currentProvider) || allProviders[0]!;\n  };\n\n  const handleSelectTranslationProvider = (event: React.ChangeEvent<HTMLSelectElement>) => {\n    const option = event.target.value;\n    setTranslationProvider(option);\n    saveViewSettings(envConfig, bookKey, 'translationProvider', option, false, false);\n    viewSettings.translationProvider = option;\n    setViewSettings(bookKey, { ...viewSettings });\n  };\n\n  const getCurrentTargetLangOption = () => {\n    const value = translateTargetLang;\n    const availableOptions = getLangOptions(TRANSLATOR_LANGS);\n    return availableOptions.find((o) => o.value === value) || availableOptions[0]!;\n  };\n\n  const handleSelectTargetLang = (event: React.ChangeEvent<HTMLSelectElement>) => {\n    const option = event.target.value;\n    setTranslateTargetLang(option);\n    saveViewSettings(envConfig, bookKey, 'translateTargetLang', option, false, false);\n    viewSettings.translateTargetLang = option;\n    setViewSettings(bookKey, { ...viewSettings });\n  };\n\n  const handleSelectTTSText = (event: React.ChangeEvent<HTMLSelectElement>) => {\n    const option = event.target.value;\n    setTtsReadAloudText(option);\n    saveViewSettings(envConfig, bookKey, 'ttsReadAloudText', option, false, false);\n  };\n\n  const getTTSTextOptions = () => {\n    return [\n      { value: 'both', label: _('Source and Translated') },\n      { value: 'translated', label: _('Translated Only') },\n      { value: 'source', label: _('Source Only') },\n    ];\n  };\n\n  useEffect(() => {\n    if (uiLanguage === viewSettings.uiLanguage) return;\n    saveViewSettings(envConfig, bookKey, 'uiLanguage', uiLanguage, false, false);\n    applyUILanguage(uiLanguage);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [uiLanguage]);\n\n  useEffect(() => {\n    if (translationEnabled === viewSettings.translationEnabled) return;\n    saveViewSettings(\n      envConfig,\n      bookKey,\n      'translationEnabled',\n      translationEnabled,\n      true,\n      false,\n    ).then(() => {\n      if (!showTranslateSource && translationEnabled) {\n        recreateViewer(envConfig, bookKey);\n      }\n    });\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [translationEnabled]);\n\n  useEffect(() => {\n    if (showTranslateSource === viewSettings.showTranslateSource) return;\n    saveViewSettings(\n      envConfig,\n      bookKey,\n      'showTranslateSource',\n      showTranslateSource,\n      false,\n      false,\n    ).then(() => {\n      recreateViewer(envConfig, bookKey);\n    });\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [showTranslateSource]);\n\n  useEffect(() => {\n    if (ttsReadAloudText === viewSettings.ttsReadAloudText) return;\n    saveViewSettings(envConfig, bookKey, 'ttsReadAloudText', ttsReadAloudText, false, false);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [ttsReadAloudText]);\n\n  useEffect(() => {\n    if (replaceQuotationMarks === viewSettings.replaceQuotationMarks) return;\n    saveViewSettings(\n      envConfig,\n      bookKey,\n      'replaceQuotationMarks',\n      replaceQuotationMarks,\n      false,\n      false,\n    ).then(() => {\n      recreateViewer(envConfig, bookKey);\n    });\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [replaceQuotationMarks]);\n\n  const getConvertModeOptions: () => { value: ConvertChineseVariant; label: string }[] = () => {\n    return [\n      { value: 'none', label: _('No Conversion') },\n      { value: 's2t', label: _('Simplified to Traditional') },\n      { value: 't2s', label: _('Traditional to Simplified') },\n      { value: 's2tw', label: _('Simplified to Traditional (Taiwan)') },\n      { value: 's2hk', label: _('Simplified to Traditional (Hong Kong)') },\n      { value: 's2twp', label: _('Simplified to Traditional (Taiwan), with phrases') },\n      { value: 'tw2s', label: _('Traditional (Taiwan) to Simplified') },\n      { value: 'hk2s', label: _('Traditional (Hong Kong) to Simplified') },\n      { value: 'tw2sp', label: _('Traditional (Taiwan) to Simplified, with phrases') },\n    ];\n  };\n\n  const getConvertModeOption = () => {\n    const value = convertChineseVariant;\n    const availableOptions = getConvertModeOptions();\n    return availableOptions.find((o) => o.value === value) || availableOptions[0]!;\n  };\n\n  const handleSelectConvertMode = (event: React.ChangeEvent<HTMLSelectElement>) => {\n    const option = event.target.value as ConvertChineseVariant;\n    setConvertChineseVariant(option);\n  };\n\n  useEffect(() => {\n    if (convertChineseVariant === viewSettings.convertChineseVariant) return;\n    saveViewSettings(\n      envConfig,\n      bookKey,\n      'convertChineseVariant',\n      convertChineseVariant,\n      false,\n      false,\n    ).then(() => {\n      recreateViewer(envConfig, bookKey);\n    });\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [convertChineseVariant]);\n\n  return (\n    <div className={clsx('my-4 w-full space-y-6')}>\n      <div className='w-full'>\n        <h2 className='mb-2 font-medium'>{_('Language')}</h2>\n        <div className='card border-base-200 bg-base-100 border shadow'>\n          <div className='divide-base-200 divide-y'>\n            <div className='config-item'>\n              <span className=''>{_('Interface Language')}</span>\n              <Select\n                value={getCurrentUILangOption().value}\n                onChange={handleSelectUILang}\n                options={getLangOptions(TRANSLATED_LANGS)}\n              />\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <div className='w-full'>\n        <h2 className='mb-2 font-medium'>{_('Translation')}</h2>\n        <div className='card border-base-200 bg-base-100 border shadow'>\n          <div className='divide-base-200'>\n            <div className='config-item'>\n              <span className=''>{_('Enable Translation')}</span>\n              <input\n                type='checkbox'\n                className='toggle'\n                checked={translationEnabled}\n                onChange={() => setTranslationEnabled(!translationEnabled)}\n                disabled={!bookKey}\n              />\n            </div>\n\n            <div className='config-item'>\n              <span className=''>{_('Show Source Text')}</span>\n              <input\n                type='checkbox'\n                className='toggle'\n                checked={showTranslateSource}\n                onChange={() => setShowTranslateSource(!showTranslateSource)}\n              />\n            </div>\n\n            <div className='config-item'>\n              <span className=''>{_('TTS Text')}</span>\n              <Select\n                value={ttsReadAloudText}\n                onChange={handleSelectTTSText}\n                options={getTTSTextOptions()}\n              />\n            </div>\n\n            <div className='config-item'>\n              <span className=''>{_('Translation Service')}</span>\n              <Select\n                value={getCurrentTranslationProviderOption().value}\n                onChange={handleSelectTranslationProvider}\n                options={getTranslationProviderOptions()}\n              />\n            </div>\n\n            <div className='config-item'>\n              <span className=''>{_('Translate To')}</span>\n              <Select\n                value={getCurrentTargetLangOption().value}\n                onChange={handleSelectTargetLang}\n                options={getLangOptions(TRANSLATOR_LANGS)}\n              />\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {(isCJKEnv() || view?.language.isCJK) && (\n        <div className='w-full'>\n          <h2 className='mb-2 font-medium'>{_('Punctuation')}</h2>\n          <div className='card border-base-200 bg-base-100 border shadow'>\n            <div className='divide-base-200'>\n              <div className='config-item !h-16'>\n                <div className='flex flex-col gap-1'>\n                  <span className=''>{_('Replace Quotation Marks')}</span>\n                  <span className='text-xs'>{_('Enabled only in vertical layout.')}</span>\n                </div>\n                <input\n                  type='checkbox'\n                  className='toggle'\n                  checked={replaceQuotationMarks}\n                  onChange={() => setReplaceQuotationMarks(!replaceQuotationMarks)}\n                />\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {(isCJKEnv() || view?.language.isCJK) && (\n        <div className='w-full'>\n          <h2 className='mb-2 font-medium'>{_('Convert Simplified and Traditional Chinese')}</h2>\n          <div className='card border-base-200 bg-base-100 border shadow'>\n            <div className='divide-base-200'>\n              <div className='config-item'>\n                <span className=''>{_('Convert Mode')}</span>\n                <Select\n                  value={getConvertModeOption().value}\n                  onChange={handleSelectConvertMode}\n                  options={getConvertModeOptions()}\n                />\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default LangPanel;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 11903, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/components/settings/MiscPanel.tsx"],"sourcesContent":["'use client';\n\nimport clsx from 'clsx';\nimport React, { useEffect, useRef, useState } from 'react';\n\nimport { useEnv } from '@/context/EnvContext';\nimport { useReaderStore } from '@/store/readerStore';\nimport { useSettingsStore } from '@/store/settingsStore';\nimport { useTranslation } from '@/hooks/useTranslation';\nimport { useResetViewSettings } from '@/hooks/useResetSettings';\nimport { SettingsPanelPanelProp } from './SettingsDialog';\nimport { saveViewSettings } from '@/helpers/settings';\nimport { validateCSS, formatCSS } from '@/utils/css';\nimport { getStyles } from '@/utils/style';\n\ntype CSSType = 'book' | 'reader';\n\nconst MiscPanel: React.FC<SettingsPanelPanelProp> = ({ bookKey, onRegisterReset }) => {\n  const _ = useTranslation();\n  const { appService, envConfig } = useEnv();\n  const { settings, isSettingsGlobal, setSettings } = useSettingsStore();\n  const { getView, getViewSettings, setViewSettings } = useReaderStore();\n  const viewSettings = getViewSettings(bookKey) || settings.globalViewSettings;\n\n  const [draftContentStylesheet, setDraftContentStylesheet] = useState(viewSettings.userStylesheet);\n  const [draftContentStylesheetSaved, setDraftContentStylesheetSaved] = useState(true);\n  const [contentError, setContentError] = useState<string | null>(null);\n  const [draftUIStylesheet, setDraftUIStylesheet] = useState(viewSettings.userUIStylesheet);\n  const [draftUIStylesheetSaved, setDraftUIStylesheetSaved] = useState(true);\n  const [uiError, setUIError] = useState<string | null>(null);\n\n  const [inputFocusInAndroid, setInputFocusInAndroid] = useState(false);\n  const contentTextareaRef = useRef<HTMLTextAreaElement | null>(null);\n  const uiTextareaRef = useRef<HTMLTextAreaElement | null>(null);\n\n  const resetToDefaults = useResetViewSettings();\n\n  const handleReset = () => {\n    resetToDefaults({\n      userStylesheet: setDraftContentStylesheet,\n      userUIStylesheet: setDraftUIStylesheet,\n    });\n    applyStyles('book', true);\n    applyStyles('reader', true);\n  };\n\n  useEffect(() => {\n    onRegisterReset(handleReset);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  const handleValidateCSS = (cssInput: string): { isValid: boolean; error?: string } => {\n    if (!cssInput.trim()) return { isValid: true };\n\n    try {\n      const { isValid, error } = validateCSS(cssInput);\n      if (!isValid) {\n        return { isValid: false, error: error || 'Invalid CSS' };\n      }\n      return { isValid: true };\n    } catch (err: unknown) {\n      if (err instanceof Error) {\n        return { isValid: false, error: err.message };\n      }\n      return { isValid: false, error: 'Invalid CSS: Please check your input.' };\n    }\n  };\n\n  const handleStylesheetChange = (e: React.ChangeEvent<HTMLTextAreaElement>, type: CSSType) => {\n    const cssInput = e.target.value;\n\n    if (type === 'book') {\n      setDraftContentStylesheet(cssInput);\n      setDraftContentStylesheetSaved(false);\n\n      const { isValid, error } = handleValidateCSS(cssInput);\n      setContentError(isValid ? null : error || 'Invalid CSS');\n    } else {\n      setDraftUIStylesheet(cssInput);\n      setDraftUIStylesheetSaved(false);\n\n      const { isValid, error } = handleValidateCSS(cssInput);\n      setUIError(isValid ? null : error || 'Invalid CSS');\n    }\n  };\n\n  const applyStyles = (type: CSSType, clear = false) => {\n    const cssInput = type === 'book' ? draftContentStylesheet : draftUIStylesheet;\n    const formattedCSS = formatCSS(clear ? '' : cssInput);\n\n    if (type === 'book') {\n      setDraftContentStylesheet(formattedCSS);\n      setDraftContentStylesheetSaved(true);\n      viewSettings.userStylesheet = formattedCSS;\n\n      if (isSettingsGlobal) {\n        settings.globalViewSettings.userStylesheet = formattedCSS;\n        setSettings(settings);\n      }\n    } else {\n      setDraftUIStylesheet(formattedCSS);\n      setDraftUIStylesheetSaved(true);\n      viewSettings.userUIStylesheet = formattedCSS;\n\n      if (isSettingsGlobal) {\n        settings.globalViewSettings.userUIStylesheet = formattedCSS;\n        setSettings(settings);\n      }\n    }\n\n    setViewSettings(bookKey, { ...viewSettings });\n    getView(bookKey)?.renderer.setStyles?.(getStyles(viewSettings));\n    saveViewSettings(\n      envConfig,\n      bookKey,\n      type === 'book' ? 'userStylesheet' : 'userUIStylesheet',\n      formattedCSS,\n      false,\n      false,\n    );\n  };\n\n  const handleInput = (e: React.FormEvent<HTMLTextAreaElement>) => {\n    e.stopPropagation();\n    e.nativeEvent.stopImmediatePropagation();\n  };\n\n  const handleInputFocus = (textareaRef: React.RefObject<HTMLTextAreaElement>) => {\n    if (appService?.isAndroidApp) {\n      setInputFocusInAndroid(true);\n    }\n    setTimeout(() => {\n      textareaRef.current?.scrollIntoView({\n        behavior: 'instant',\n        block: 'center',\n      });\n    }, 300);\n  };\n\n  const handleInputBlur = () => {\n    if (appService?.isAndroidApp) {\n      setTimeout(() => {\n        setInputFocusInAndroid(false);\n      }, 100);\n    }\n  };\n\n  const renderCSSEditor = (\n    type: CSSType,\n    title: string,\n    placeholder: string,\n    value: string,\n    error: string | null,\n    saved: boolean,\n    textareaRef: React.RefObject<HTMLTextAreaElement>,\n  ) => (\n    <div className='w-full'>\n      <h2 className='mb-2 font-medium' aria-label={_(title)}>\n        {_(title)}\n      </h2>\n      <div\n        className={`card border-base-200 bg-base-100 border shadow ${error ? 'border-red-500' : ''}`}\n      >\n        <div className='relative p-1'>\n          <textarea\n            ref={textareaRef}\n            className={clsx(\n              'textarea textarea-ghost h-48 w-full border-0 p-3 text-base !outline-none sm:text-sm',\n              'placeholder:text-base-content/70',\n            )}\n            placeholder={_(placeholder)}\n            spellCheck='false'\n            value={value}\n            onFocus={() => handleInputFocus(textareaRef)}\n            onBlur={handleInputBlur}\n            onInput={handleInput}\n            onKeyDown={handleInput}\n            onKeyUp={handleInput}\n            onChange={(e) => handleStylesheetChange(e, type)}\n          />\n          <button\n            className={clsx(\n              'btn btn-ghost bg-base-200 absolute bottom-2 right-4 h-8 min-h-8 px-4 py-2',\n              saved ? 'hidden' : '',\n              error ? 'btn-disabled' : '',\n            )}\n            onClick={() => applyStyles(type)}\n            disabled={!!error}\n          >\n            {_('Apply')}\n          </button>\n        </div>\n      </div>\n      {error && <p className='mt-1 text-sm text-red-500'>{error}</p>}\n    </div>\n  );\n\n  return (\n    <div\n      className={clsx(\n        'my-4 w-full space-y-6',\n        inputFocusInAndroid && 'h-[50%] overflow-y-auto pb-[200px]',\n      )}\n    >\n      {renderCSSEditor(\n        'book',\n        _('Custom Content CSS'),\n        _('Enter CSS for book content styling...'),\n        draftContentStylesheet,\n        contentError,\n        draftContentStylesheetSaved,\n        contentTextareaRef,\n      )}\n\n      {renderCSSEditor(\n        'reader',\n        _('Custom Reader UI CSS'),\n        _('Enter CSS for reader interface styling...'),\n        draftUIStylesheet,\n        uiError,\n        draftUIStylesheetSaved,\n        uiTextareaRef,\n      )}\n    </div>\n  );\n};\n\nexport default MiscPanel;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 12146, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/components/settings/SettingsDialog.tsx"],"sourcesContent":["'use client';\n\nimport clsx from 'clsx';\nimport React, { useEffect, useRef, useState } from 'react';\nimport { useEnv } from '@/context/EnvContext';\nimport { useSettingsStore } from '@/store/settingsStore';\nimport { useResponsiveSize } from '@/hooks/useResponsiveSize';\nimport { useTranslation } from '@/hooks/useTranslation';\nimport { RiFontSize } from 'react-icons/ri';\nimport { RiDashboardLine, RiTranslate } from 'react-icons/ri';\nimport { VscSymbolColor } from 'react-icons/vsc';\nimport { PiDotsThreeVerticalBold } from 'react-icons/pi';\nimport { LiaHandPointerSolid } from 'react-icons/lia';\nimport { IoAccessibilityOutline } from 'react-icons/io5';\nimport { MdArrowBackIosNew, MdArrowForwardIos, MdClose } from 'react-icons/md';\nimport { getDirFromUILanguage } from '@/utils/rtl';\nimport FontPanel from './FontPanel';\nimport LayoutPanel from './LayoutPanel';\nimport ColorPanel from './ColorPanel';\nimport Dropdown from '@/components/Dropdown';\nimport Dialog from '@/components/Dialog';\nimport DialogMenu from './DialogMenu';\nimport ControlPanel from './ControlPanel';\nimport LangPanel from './LangPanel';\nimport MiscPanel from './MiscPanel';\n\nexport type SettingsPanelType = 'Font' | 'Layout' | 'Color' | 'Control' | 'Language' | 'Custom';\nexport type SettingsPanelPanelProp = {\n  bookKey: string;\n  onRegisterReset: (resetFn: () => void) => void;\n};\n\ntype TabConfig = {\n  tab: SettingsPanelType;\n  icon: React.ElementType;\n  label: string;\n};\n\nconst SettingsDialog: React.FC<{ bookKey: string }> = ({ bookKey }) => {\n  const _ = useTranslation();\n  const { appService } = useEnv();\n  const closeIconSize = useResponsiveSize(16);\n  const [isRtl] = useState(() => getDirFromUILanguage() === 'rtl');\n  const tabsRef = useRef<HTMLDivElement | null>(null);\n  const [showAllTabLabels, setShowAllTabLabels] = useState(false);\n  const { setFontPanelView, setSettingsDialogOpen } = useSettingsStore();\n\n  const tabConfig = [\n    {\n      tab: 'Font',\n      icon: RiFontSize,\n      label: _('Font'),\n    },\n    {\n      tab: 'Layout',\n      icon: RiDashboardLine,\n      label: _('Layout'),\n    },\n    {\n      tab: 'Color',\n      icon: VscSymbolColor,\n      label: _('Color'),\n    },\n    {\n      tab: 'Control',\n      icon: LiaHandPointerSolid,\n      label: _('Behavior'),\n    },\n    {\n      tab: 'Language',\n      icon: RiTranslate,\n      label: _('Language'),\n    },\n    {\n      tab: 'Custom',\n      icon: IoAccessibilityOutline,\n      label: _('Custom'),\n    },\n  ] as TabConfig[];\n\n  const [activePanel, setActivePanel] = useState<SettingsPanelType>(() => {\n    const lastPanel = localStorage.getItem('lastConfigPanel');\n    if (lastPanel && tabConfig.some((tab) => tab.tab === lastPanel)) {\n      return lastPanel as SettingsPanelType;\n    }\n    return 'Font' as SettingsPanelType;\n  });\n\n  const handleSetActivePanel = (tab: SettingsPanelType) => {\n    setActivePanel(tab);\n    setFontPanelView('main-fonts');\n    localStorage.setItem('lastConfigPanel', tab);\n  };\n\n  const [resetFunctions, setResetFunctions] = useState<\n    Record<SettingsPanelType, (() => void) | null>\n  >({\n    Font: null,\n    Layout: null,\n    Color: null,\n    Control: null,\n    Language: null,\n    Custom: null,\n  });\n\n  const registerResetFunction = (panel: SettingsPanelType, resetFn: () => void) => {\n    setResetFunctions((prev) => ({ ...prev, [panel]: resetFn }));\n  };\n\n  const handleResetCurrentPanel = () => {\n    const resetFn = resetFunctions[activePanel];\n    if (resetFn) {\n      resetFn();\n    }\n  };\n\n  const handleClose = () => {\n    setSettingsDialogOpen(false);\n  };\n\n  useEffect(() => {\n    setFontPanelView('main-fonts');\n\n    const container = tabsRef.current;\n    if (!container) return;\n\n    const checkButtonWidths = () => {\n      const threshold = (container.clientWidth - 64) * 0.22;\n      const hideLabel = Array.from(container.querySelectorAll('button')).some((button) => {\n        const labelSpan = button.querySelector('span');\n        const labelText = labelSpan?.textContent || '';\n        const clone = button.cloneNode(true) as HTMLButtonElement;\n        clone.style.position = 'absolute';\n        clone.style.visibility = 'hidden';\n        clone.style.width = 'auto';\n        const cloneSpan = clone.querySelector('span');\n        if (cloneSpan) {\n          cloneSpan.classList.remove('hidden');\n          cloneSpan.textContent = labelText;\n        }\n        document.body.appendChild(clone);\n        const fullWidth = clone.scrollWidth;\n        document.body.removeChild(clone);\n        return fullWidth > threshold;\n      });\n      setShowAllTabLabels(!hideLabel);\n    };\n\n    checkButtonWidths();\n\n    const resizeObserver = new ResizeObserver(checkButtonWidths);\n    resizeObserver.observe(container);\n    const mutationObserver = new MutationObserver(checkButtonWidths);\n    mutationObserver.observe(container, {\n      subtree: true,\n      characterData: true,\n    });\n\n    return () => {\n      resizeObserver.disconnect();\n      mutationObserver.disconnect();\n    };\n  }, [setFontPanelView]);\n\n  const currentPanel = tabConfig.find((tab) => tab.tab === activePanel);\n\n  return (\n    <Dialog\n      isOpen={true}\n      onClose={handleClose}\n      className='modal-open'\n      bgClassName={bookKey ? 'sm:!bg-black/20' : 'sm:!bg-black/50'}\n      boxClassName={clsx('sm:min-w-[520px]', appService?.isMobile && 'sm:max-w-[90%] sm:w-3/4')}\n      snapHeight={appService?.isMobile ? 0.7 : undefined}\n      header={\n        <div className='flex w-full flex-col items-center'>\n          <div className='tab-title flex pb-2 text-base font-semibold sm:hidden'>\n            {currentPanel?.label || ''}\n          </div>\n          <div className='flex w-full flex-row items-center justify-between'>\n            <button\n              tabIndex={-1}\n              aria-label={_('Close')}\n              onClick={handleClose}\n              className={\n                'btn btn-ghost btn-circle flex h-8 min-h-8 w-8 hover:bg-transparent focus:outline-none sm:hidden'\n              }\n            >\n              {isRtl ? <MdArrowForwardIos /> : <MdArrowBackIosNew />}\n            </button>\n            <div\n              ref={tabsRef}\n              role='group'\n              aria-label={_('Settings Panels') + ' - ' + (currentPanel?.label || '')}\n              className={clsx('dialog-tabs ms-1 flex h-10 w-full items-center gap-1 sm:ms-0')}\n            >\n              {tabConfig.map(({ tab, icon: Icon, label }) => (\n                <button\n                  key={tab}\n                  data-tab={tab}\n                  tabIndex={0}\n                  title={label}\n                  className={clsx(\n                    'btn btn-ghost text-base-content btn-sm gap-1 px-2',\n                    activePanel === tab ? 'btn-active' : '',\n                  )}\n                  onClick={() => handleSetActivePanel(tab)}\n                >\n                  <Icon className='mr-0' />\n                  <span\n                    className={clsx(\n                      window.innerWidth < 640 && 'hidden',\n                      !(showAllTabLabels || activePanel === tab) && 'hidden',\n                    )}\n                  >\n                    {label}\n                  </span>\n                </button>\n              ))}\n            </div>\n            <div className='flex h-full items-center justify-end gap-x-2'>\n              <Dropdown\n                label={_('Settings Menu')}\n                className='dropdown-bottom dropdown-end'\n                buttonClassName='btn btn-ghost h-8 min-h-8 w-8 p-0 flex items-center justify-center'\n                toggleButton={<PiDotsThreeVerticalBold />}\n              >\n                <DialogMenu\n                  activePanel={activePanel}\n                  onReset={handleResetCurrentPanel}\n                  resetLabel={\n                    currentPanel\n                      ? _('Reset {{settings}}', { settings: currentPanel.label })\n                      : undefined\n                  }\n                />\n              </Dropdown>\n              <button\n                onClick={handleClose}\n                aria-label={_('Close')}\n                className={\n                  'bg-base-300/65 btn btn-ghost btn-circle hidden h-6 min-h-6 w-6 p-0 sm:flex'\n                }\n              >\n                <MdClose size={closeIconSize} />\n              </button>\n            </div>\n          </div>\n        </div>\n      }\n    >\n      <div role='group' aria-label={`${_(currentPanel?.label || '')} - ${_('Settings')}`}>\n        {activePanel === 'Font' && (\n          <FontPanel\n            bookKey={bookKey}\n            onRegisterReset={(fn) => registerResetFunction('Font', fn)}\n          />\n        )}\n        {activePanel === 'Layout' && (\n          <LayoutPanel\n            bookKey={bookKey}\n            onRegisterReset={(fn) => registerResetFunction('Layout', fn)}\n          />\n        )}\n        {activePanel === 'Color' && (\n          <ColorPanel\n            bookKey={bookKey}\n            onRegisterReset={(fn) => registerResetFunction('Color', fn)}\n          />\n        )}\n        {activePanel === 'Control' && (\n          <ControlPanel\n            bookKey={bookKey}\n            onRegisterReset={(fn) => registerResetFunction('Control', fn)}\n          />\n        )}\n        {activePanel === 'Language' && (\n          <LangPanel\n            bookKey={bookKey}\n            onRegisterReset={(fn) => registerResetFunction('Language', fn)}\n          />\n        )}\n        {activePanel === 'Custom' && (\n          <MiscPanel\n            bookKey={bookKey}\n            onRegisterReset={(fn) => registerResetFunction('Custom', fn)}\n          />\n        )}\n      </div>\n    </Dialog>\n  );\n};\n\nexport default SettingsDialog;\n"],"names":[],"mappings":"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"}}]
}