{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/app/api/storage/_lib/localFs.ts"],"sourcesContent":["import fs from 'node:fs/promises';\nimport type { Dirent } from 'node:fs';\nimport path from 'node:path';\n\nexport const isLocalStorageEnabled = () =>\n    (process.env['STORAGE_MODE'] || process.env['NEXT_PUBLIC_STORAGE_MODE'] || 'remote') === 'local';\n\nexport const STORAGE_ROOT = path.resolve(\n    process.env['LOCAL_STORAGE_ROOT'] || path.join(process.cwd(), 'data', 'storage'),\n);\nexport const TEMP_ROOT = path.resolve(\n    process.env['LOCAL_STORAGE_TEMP_ROOT'] || path.join(STORAGE_ROOT, 'temp'),\n);\n\nexport const ensureRoots = async () => {\n    await fs.mkdir(STORAGE_ROOT, { recursive: true });\n    await fs.mkdir(TEMP_ROOT, { recursive: true });\n};\n\n// Keep user-provided relative paths intact; only trim leading slashes.\nconst stripUserPrefix = (fileKey: string) => fileKey.replace(/^\\/+/, '');\n\nexport const resolveLocalPath = (fileKey: string, useTemp = false) => {\n    const base = useTemp ? TEMP_ROOT : STORAGE_ROOT;\n\n    // Allow absolute paths inside the storage root without re-prefixing.\n    if (path.isAbsolute(fileKey)) {\n        const fullPath = path.resolve(fileKey);\n        if (!fullPath.startsWith(base)) {\n            throw new Error('Invalid file path');\n        }\n        const relPath = path.posix.normalize(path.relative(base, fullPath));\n        return { fullPath, relPath, basePath: base };\n    }\n\n    const cleanKey = stripUserPrefix(fileKey);\n\n    // In local storage mode, route certain files to .readest directory\n    if (isLocalStorageEnabled()) {\n        // Settings files go to .readest/ directory\n        if (cleanKey === 'settings.json' || cleanKey === 'settings.json.bak') {\n            const settingsRelPath = path.posix.normalize(`.readest/${cleanKey}`);\n            const settingsFullPath = path.join(base, settingsRelPath);\n            if (!settingsFullPath.startsWith(base)) {\n                throw new Error('Invalid file path');\n            }\n            console.log('[LocalFS] Settings file routed:', cleanKey, '->', settingsRelPath);\n            return { fullPath: settingsFullPath, relPath: settingsRelPath, basePath: base };\n        }\n\n        // Library files also go to .readest/ directory\n        if (cleanKey === 'library.json' || cleanKey === 'library.json.bak' || cleanKey === 'library_backup.json') {\n            const libraryRelPath = path.posix.normalize(`.readest/${cleanKey}`);\n            const libraryFullPath = path.join(base, libraryRelPath);\n            if (!libraryFullPath.startsWith(base)) {\n                throw new Error('Invalid file path');\n            }\n            console.log('[LocalFS] Library file routed:', cleanKey, '->', libraryRelPath);\n            return { fullPath: libraryFullPath, relPath: libraryRelPath, basePath: base };\n        }\n\n        // All other files use flat structure\n        console.log('[LocalFS] ✓ Using flat storage, cleanKey:', cleanKey);\n    }\n\n    const relPath = path.posix.normalize(cleanKey);\n    if (relPath.startsWith('..')) {\n        throw new Error('Invalid file path');\n    }\n    const fullPath = path.join(base, relPath);\n    if (!fullPath.startsWith(base)) {\n        throw new Error('Invalid file path');\n    }\n    console.log('[LocalFS] ✓ Final paths - Full:', fullPath, ', Relative:', relPath);\n    return { fullPath, relPath, basePath: base };\n};\n\nexport const ensureParentDir = async (fullPath: string) => {\n    const dir = path.dirname(fullPath);\n    await fs.mkdir(dir, { recursive: true });\n};\n\nexport const readFileBuffer = async (fullPath: string) => {\n    try {\n        const stats = await fs.stat(fullPath);\n        const fileSizeMB = stats.size / (1024 * 1024);\n\n        console.log(`[readFileBuffer] Reading file: ${fullPath}, size: ${fileSizeMB.toFixed(2)} MB`);\n\n        // 警告：文件超过 100MB\n        if (stats.size > 100 * 1024 * 1024) {\n            console.warn(`[readFileBuffer] ⚠️ Large file detected: ${fileSizeMB.toFixed(2)} MB`);\n        }\n\n        // 限制：文件超过 500MB 时抛出错误\n        if (stats.size > 500 * 1024 * 1024) {\n            throw new Error(`File too large: ${fileSizeMB.toFixed(2)} MB. Maximum size is 500 MB.`);\n        }\n\n        const buffer = Buffer.from(await fs.readFile(fullPath));\n        console.log(`[readFileBuffer] ✓ Successfully read ${fileSizeMB.toFixed(2)} MB`);\n        return buffer;\n    } catch (error: any) {\n        console.error(`[readFileBuffer] ✗ Error reading file ${fullPath}:`, error.message);\n        if (error.code === 'ENOMEM' || error.message?.includes('memory')) {\n            throw new Error(`Out of memory while reading file. File may be too large.`);\n        }\n        throw error;\n    }\n};\n\nexport const writeFileBuffer = async (fullPath: string, buffer: Buffer) => {\n    await ensureParentDir(fullPath);\n    await fs.writeFile(fullPath, buffer);\n};\n\nexport const deleteIfExists = async (fullPath: string) => {\n    try {\n        await fs.unlink(fullPath);\n        return true;\n    } catch (error: any) {\n        if (error?.code === 'ENOENT') return false;\n        throw error;\n    }\n};\n\nexport type LocalFileInfo = {\n    fileKey: string;\n    size: number;\n    mtime: number;\n};\n\nexport const walkFiles = async (root: string, prefix = ''): Promise<LocalFileInfo[]> => {\n    let entries: Dirent[] = [];\n    try {\n        entries = await fs.readdir(root, { withFileTypes: true });\n    } catch (error: any) {\n        if (error?.code === 'ENOENT') return [];\n        throw error;\n    }\n    const files: LocalFileInfo[] = [];\n\n    for (const entry of entries) {\n        const relKey = path.posix.join(prefix, entry.name);\n        const fullPath = path.join(root, entry.name);\n        if (entry.isDirectory()) {\n            files.push(...(await walkFiles(fullPath, relKey)));\n        } else if (entry.isFile()) {\n            const stat = await fs.stat(fullPath);\n            files.push({ fileKey: relKey, size: stat.size, mtime: stat.mtimeMs });\n        }\n    }\n\n    return files;\n};\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 253, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/app/api/storage/file/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport {\n    ensureRoots,\n    isLocalStorageEnabled,\n    resolveLocalPath,\n    readFileBuffer,\n    writeFileBuffer,\n} from '../_lib/localFs';\nimport { createReadStream } from 'fs';\nimport { stat } from 'fs/promises';\nimport { createHash } from 'crypto';\n\n/**\n * Generate ETag from file stats\n */\nfunction generateETag(size: number, mtime: number): string {\n    const hash = createHash('md5')\n        .update(`${size}-${mtime}`)\n        .digest('hex')\n        .slice(0, 8);\n    return `\"${hash}\"`;\n}\n\nexport async function GET(req: NextRequest) {\n    if (!isLocalStorageEnabled()) {\n        return NextResponse.json({ error: 'Local storage disabled' }, { status: 501 });\n    }\n\n    await ensureRoots();\n\n    const { searchParams } = new URL(req.url);\n    const filePath = searchParams.get('filePath');\n    if (!filePath) {\n        return NextResponse.json({ error: 'filePath is required' }, { status: 400 });\n    }\n\n    try {\n        const { fullPath, relPath } = resolveLocalPath(filePath, searchParams.get('temp') === '1');\n        console.log('[Storage File GET] Reading from:', fullPath);\n\n        // 获取文件信息\n        const stats = await stat(fullPath);\n        const fileSizeMB = stats.size / (1024 * 1024);\n        console.log('[Storage File GET] File size:', fileSizeMB.toFixed(2), 'MB');\n\n        // 对于大文件（> 50MB），使用流式传输\n        const USE_STREAMING_THRESHOLD = 50 * 1024 * 1024; // 50MB\n\n        const filename = relPath.split('/').pop() || 'file';\n        const encodedFilename = encodeURIComponent(filename);\n\n        // 生成 ETag\n        const etag = generateETag(stats.size, stats.mtimeMs || 0);\n        const ifNoneMatch = req.headers.get('if-none-match');\n\n        // 检查客户端缓存\n        if (ifNoneMatch === etag) {\n            console.log('[Storage File GET] 304 Not Modified for:', filename);\n            return new NextResponse(null, {\n                status: 304,\n                headers: {\n                    'ETag': etag,\n                    'Cache-Control': 'public, max-age=86400, immutable',\n                },\n            });\n        }\n\n        if (stats.size > USE_STREAMING_THRESHOLD) {\n            console.log('[Storage File GET] Using streaming for large file');\n\n            // 使用 Node.js ReadableStream 转换为 Web ReadableStream\n            const nodeStream = createReadStream(fullPath);\n            const webStream = new ReadableStream({\n                start(controller) {\n                    nodeStream.on('data', (chunk) => {\n                        const uint8Array = Buffer.isBuffer(chunk)\n                            ? new Uint8Array(chunk)\n                            : new TextEncoder().encode(String(chunk));\n                        controller.enqueue(uint8Array);\n                    });\n                    nodeStream.on('end', () => {\n                        controller.close();\n                    });\n                    nodeStream.on('error', (error) => {\n                        console.error('[Storage File GET] Stream error:', error);\n                        controller.error(error);\n                    });\n                },\n                cancel() {\n                    nodeStream.destroy();\n                }\n            });\n\n            return new NextResponse(webStream, {\n                status: 200,\n                headers: {\n                    'Content-Type': 'application/octet-stream',\n                    'Content-Disposition': `attachment; filename*=UTF-8''${encodedFilename}`,\n                    'Content-Length': stats.size.toString(),\n                    'ETag': etag,\n                    'Cache-Control': 'public, max-age=86400, immutable',\n                },\n            });\n        } else {\n            // 小文件继续使用原来的方式\n            const buffer = await readFileBuffer(fullPath);\n            return new NextResponse(buffer, {\n                status: 200,\n                headers: {\n                    'Content-Type': 'application/octet-stream',\n                    'Content-Disposition': `attachment; filename*=UTF-8''${encodedFilename}`,\n                    'Content-Length': buffer.length.toString(),\n                    'ETag': etag,\n                    'Cache-Control': 'public, max-age=86400, immutable',\n                },\n            });\n        }\n    } catch (error: any) {\n        console.error('[Storage File GET] Error:', error?.message);\n        return NextResponse.json({ error: error?.message || 'File not found' }, { status: 404 });\n    }\n}\n\nexport async function PUT(req: NextRequest) {\n    if (!isLocalStorageEnabled()) {\n        return NextResponse.json({ error: 'Local storage disabled' }, { status: 501 });\n    }\n\n    await ensureRoots();\n\n    const { searchParams } = new URL(req.url);\n    const filePath = searchParams.get('filePath');\n    if (!filePath) {\n        return NextResponse.json({ error: 'filePath is required' }, { status: 400 });\n    }\n\n    try {\n        const { fullPath, relPath } = resolveLocalPath(filePath, searchParams.get('temp') === '1');\n        console.log('[Storage File PUT] 15. Input filePath:', filePath);\n        console.log('[Storage File PUT] 16. Resolved fullPath:', fullPath);\n        console.log('[Storage File PUT] 17. Relative path:', relPath);\n        const buffer = Buffer.from(await req.arrayBuffer());\n        console.log('[Storage File PUT] 18. File size:', buffer.length, 'bytes');\n        await writeFileBuffer(fullPath, buffer);\n        console.log('[Storage File PUT] 19. ✓ File written successfully to:', fullPath);\n        return NextResponse.json({ ok: true });\n    } catch (error: any) {\n        console.error('[Storage File PUT] Error:', error?.message);\n        return NextResponse.json({ error: error?.message || 'Failed to write file' }, { status: 500 });\n    }\n}\n"],"names":[],"mappings":"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"}}]
}