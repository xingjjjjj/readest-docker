{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/app/library/hooks/useDemoBooks.ts"],"sourcesContent":["'use client';\n\nimport { useEffect, useRef, useState } from 'react';\n\nimport { useEnv } from '@/context/EnvContext';\nimport { Book } from '@/types/book';\nimport { getUserLang } from '@/utils/misc';\nimport { isWebAppPlatform } from '@/services/environment';\n\nimport libraryEn from '@/data/demo/library.en.json';\nimport libraryZh from '@/data/demo/library.zh.json';\n\nconst libraries = {\n  en: libraryEn,\n  zh: libraryZh,\n};\n\ninterface DemoBooks {\n  library: string[];\n}\n\nexport const useDemoBooks = () => {\n  const { envConfig } = useEnv();\n  const [books, setBooks] = useState<Book[]>([]);\n  const isLoading = useRef(false);\n\n  useEffect(() => {\n    if (isLoading.current) return;\n    isLoading.current = true;\n\n    const userLang = getUserLang() as keyof typeof libraries;\n    const fetchDemoBooks = async () => {\n      try {\n        const appService = await envConfig.getAppService();\n        const demoBooks = libraries[userLang] || (libraries.en as DemoBooks);\n        const books = await Promise.all(\n          demoBooks.library.map((url) => appService.importBook(url, [], false, true)),\n        );\n        setBooks(books.filter((book) => book !== null) as Book[]);\n      } catch (error) {\n        console.error('Failed to import demo books:', error);\n      }\n    };\n\n    const demoBooksFetchedFlag = localStorage.getItem('demoBooksFetched');\n    if (isWebAppPlatform() && !demoBooksFetchedFlag) {\n      fetchDemoBooks();\n      localStorage.setItem('demoBooksFetched', 'true');\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  return books;\n};\n"],"names":[],"mappings":";;;;AAEA;AAEA;AAEA;AACA;AAEA;AACA;;AAVA;;;;;;;AAYA,MAAM,YAAY;IAChB,IAAI,iJAAS;IACb,IAAI,iJAAS;AACf;AAMO,MAAM,eAAe;;IAC1B,MAAM,EAAE,SAAS,EAAE,GAAG,IAAA,oKAAM;IAC5B,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,2UAAQ,EAAS,EAAE;IAC7C,MAAM,YAAY,IAAA,yUAAM,EAAC;IAEzB,IAAA,4UAAS;kCAAC;YACR,IAAI,UAAU,OAAO,EAAE;YACvB,UAAU,OAAO,GAAG;YAEpB,MAAM,WAAW,IAAA,gKAAW;YAC5B,MAAM;yDAAiB;oBACrB,IAAI;wBACF,MAAM,aAAa,MAAM,UAAU,aAAa;wBAChD,MAAM,YAAY,SAAS,CAAC,SAAS,IAAK,UAAU,EAAE;wBACtD,MAAM,QAAQ,MAAM,QAAQ,GAAG,CAC7B,UAAU,OAAO,CAAC,GAAG;qEAAC,CAAC,MAAQ,WAAW,UAAU,CAAC,KAAK,EAAE,EAAE,OAAO;;wBAEvE,SAAS,MAAM,MAAM;qEAAC,CAAC,OAAS,SAAS;;oBAC3C,EAAE,OAAO,OAAO;wBACd,QAAQ,KAAK,CAAC,gCAAgC;oBAChD;gBACF;;YAEA,MAAM,uBAAuB,aAAa,OAAO,CAAC;YAClD,IAAI,IAAA,+KAAgB,OAAM,CAAC,sBAAsB;gBAC/C;gBACA,aAAa,OAAO,CAAC,oBAAoB;YAC3C;QACA,uDAAuD;QACzD;iCAAG,EAAE;IAEL,OAAO;AACT;GAhCa;;QACW,oKAAM"}},
    {"offset": {"line": 74, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/app/library/hooks/useBooksSync.ts"],"sourcesContent":["'use client';\n\nimport { useCallback, useEffect, useRef } from 'react';\nimport { Book } from '@/types/book';\nimport { useSync } from '@/hooks/useSync';\nimport { useEnv } from '@/context/EnvContext';\nimport { useAuth } from '@/context/AuthContext';\nimport { useLibraryStore } from '@/store/libraryStore';\nimport { SYNC_BOOKS_INTERVAL_SEC } from '@/services/constants';\nimport { throttle } from '@/utils/throttle';\n\nexport const useBooksSync = () => {\n  const { user } = useAuth();\n  const { appService } = useEnv();\n  const { library, isSyncing, setLibrary, setIsSyncing, setSyncProgress } = useLibraryStore();\n  const { useSyncInited, syncedBooks, syncBooks, lastSyncedAtBooks } = useSync();\n  const isPullingRef = useRef(false);\n\n  const getNewBooks = useCallback(() => {\n    if (!user) return {};\n    const library = useLibraryStore.getState().library;\n    const newBooks = library.filter(\n      (book) =>\n        !book.syncedAt ||\n        lastSyncedAtBooks < book.updatedAt ||\n        lastSyncedAtBooks < (book.deletedAt ?? 0),\n    );\n    return {\n      books: newBooks,\n      lastSyncedAt: lastSyncedAtBooks,\n    };\n  }, [user, lastSyncedAtBooks]);\n\n  const pullLibrary = useCallback(async () => {\n    if (!user) return;\n    if (isPullingRef.current) {\n      console.log('Pull already in progress, skipping...');\n      return;\n    }\n    try {\n      isPullingRef.current = true;\n      await syncBooks([], 'pull');\n    } finally {\n      isPullingRef.current = false;\n    }\n  }, [user, syncBooks]);\n\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  const handleAutoSync = useCallback(\n    throttle(\n      () => {\n        const newBooks = getNewBooks();\n        if (newBooks.lastSyncedAt) {\n          syncBooks(newBooks.books, 'both');\n        }\n      },\n      SYNC_BOOKS_INTERVAL_SEC * 1000,\n      { emitLast: true },\n    ),\n    [syncBooks],\n  );\n\n  useEffect(() => {\n    if (!user) return;\n    if (isPullingRef.current) {\n      return;\n    }\n    handleAutoSync();\n  }, [user, library, handleAutoSync]);\n\n  const pushLibrary = useCallback(async () => {\n    if (!user) return;\n    const newBooks = getNewBooks();\n    if (newBooks.lastSyncedAt) {\n      await syncBooks(newBooks?.books, 'push');\n    }\n  }, [user, syncBooks, getNewBooks]);\n\n  useEffect(() => {\n    if (!user || !useSyncInited) return;\n    pullLibrary();\n  }, [user, useSyncInited, pullLibrary]);\n\n  const updateLibrary = async () => {\n    if (isSyncing) return;\n    if (!syncedBooks?.length) return;\n\n    // Process old books first so that when we update the library the order is preserved\n    syncedBooks.sort((a, b) => a.updatedAt - b.updatedAt);\n    const bookHashesInSynced = new Set(syncedBooks.map((book) => book.hash));\n    const oldBooks = library.filter((book) => bookHashesInSynced.has(book.hash));\n    const oldBooksNeedsDownload = oldBooks.filter((book) => {\n      return !book.deletedAt && book.uploadedAt && !book.coverDownloadedAt;\n    });\n\n    const processOldBook = async (oldBook: Book) => {\n      const matchingBook = syncedBooks.find((newBook) => newBook.hash === oldBook.hash);\n      if (matchingBook) {\n        if (!matchingBook.deletedAt && matchingBook.uploadedAt && !oldBook.coverDownloadedAt) {\n          oldBook.coverImageUrl = await appService?.generateCoverImageUrl(oldBook);\n        }\n        const mergedBook =\n          matchingBook.updatedAt >= oldBook.updatedAt\n            ? { ...oldBook, ...matchingBook, syncedAt: Date.now() }\n            : { ...matchingBook, ...oldBook, syncedAt: Date.now() };\n        return mergedBook;\n      }\n      return oldBook;\n    };\n\n    const oldBooksBatchSize = 100;\n    for (let i = 0; i < oldBooksNeedsDownload.length; i += oldBooksBatchSize) {\n      const batch = oldBooksNeedsDownload.slice(i, i + oldBooksBatchSize);\n      // Cloud download covers functionality removed - covers are stored locally on server\n      console.log('Skipping cloud cover download for', batch.length, 'books');\n    }\n\n    const updatedLibrary = await Promise.all(library.map(processOldBook));\n    setLibrary(updatedLibrary);\n    appService?.saveLibraryBooks(updatedLibrary);\n\n    const bookHashesInLibrary = new Set(updatedLibrary.map((book) => book.hash));\n    const newBooks = syncedBooks.filter(\n      (newBook) =>\n        !bookHashesInLibrary.has(newBook.hash) && newBook.uploadedAt && !newBook.deletedAt,\n    );\n\n    const processNewBook = async (newBook: Book) => {\n      newBook.coverImageUrl = await appService?.generateCoverImageUrl(newBook);\n      newBook.syncedAt = Date.now();\n      updatedLibrary.push(newBook);\n    };\n\n    if (newBooks.length > 0) {\n      setIsSyncing(true);\n    }\n    try {\n      const batchSize = 10;\n      for (let i = 0; i < newBooks.length; i += batchSize) {\n        const batch = newBooks.slice(i, i + batchSize);\n        // Cloud download covers functionality removed - covers are stored locally on server\n        console.log('Skipping cloud cover download for', batch.length, 'books');\n        await Promise.all(batch.map(processNewBook));\n        const progress = Math.min((i + batchSize) / newBooks.length, 1);\n        setSyncProgress(progress);\n        setLibrary([...updatedLibrary]);\n        appService?.saveLibraryBooks(updatedLibrary);\n      }\n    } catch (err) {\n      console.error('Error updating new books:', err);\n    } finally {\n      if (newBooks.length > 0) {\n        setIsSyncing(false);\n      }\n    }\n  };\n\n  useEffect(() => {\n    updateLibrary();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [syncedBooks]);\n\n  return { pullLibrary, pushLibrary };\n};\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 282, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/app/opds/utils/opdsReq.ts"],"sourcesContent":["import { md5 } from 'js-md5';\nimport {\n  getAPIBaseUrl,\n  getNodeAPIBaseUrl,\n  isTauriAppPlatform,\n  isWebAppPlatform,\n} from '@/services/environment';\nimport { fetch as tauriFetch } from '@tauri-apps/plugin-http';\nimport { READEST_OPDS_USER_AGENT } from '@/services/constants';\n\nconst OPDS_PROXY_URL = `${getAPIBaseUrl()}/opds/proxy`;\nconst NODE_OPDS_PROXY_URL = `${getNodeAPIBaseUrl()}/opds/proxy`;\n/**\n * Extract username and password from URL credentials\n */\nconst extractCredentialsFromURL = (\n  url: string,\n): { url: string; username?: string; password?: string } => {\n  try {\n    const urlObj = new URL(url);\n    const username = decodeURIComponent(urlObj.username) || undefined;\n    const password = decodeURIComponent(urlObj.password) || undefined;\n\n    if (username || password) {\n      urlObj.username = '';\n      urlObj.password = '';\n      return {\n        url: urlObj.toString(),\n        username,\n        password,\n      };\n    }\n  } catch (e) {\n    console.warn('Failed to parse URL:', e);\n  }\n\n  return { url };\n};\n\nexport const needsProxy = (url: string): boolean => {\n  return isWebAppPlatform() && url.startsWith('http');\n};\n\nconst PROXY_OVERRIDES: Record<string, string> = {\n  standardebooks: NODE_OPDS_PROXY_URL,\n};\n\nconst getProxyBaseUrl = (url: string): string => {\n  for (const [domain, proxyUrl] of Object.entries(PROXY_OVERRIDES)) {\n    if (url.includes(domain)) {\n      return proxyUrl;\n    }\n  }\n  return OPDS_PROXY_URL;\n};\n\n/**\n * Generate proxied URL for OPDS requests\n */\nexport const getProxiedURL = (url: string, auth: string = '', stream = false): string => {\n  if (url.startsWith('http')) {\n    const { url: cleanUrl } = extractCredentialsFromURL(url);\n    const params = new URLSearchParams();\n    params.append('url', cleanUrl);\n    params.append('stream', `${stream}`);\n    if (auth) {\n      params.append('auth', auth);\n    }\n    const baseUrl = getProxyBaseUrl(url);\n    const proxyUrl = `${baseUrl}?${params.toString()}`;\n    return proxyUrl;\n  }\n  return url;\n};\n\n/**\n * Parse Digest authentication challenge from WWW-Authenticate header\n */\nconst parseDigestChallenge = (challenge: string): Record<string, string> => {\n  const params: Record<string, string> = {};\n  const regex = /(\\w+)=[\"']?([^\"',]+)[\"']?/g;\n  let match;\n\n  while ((match = regex.exec(challenge)) !== null) {\n    params[match[1]!] = match[2]!;\n  }\n\n  return params;\n};\n\n/**\n * Generate Digest authentication response hash\n */\nconst generateDigestResponse = (\n  username: string,\n  password: string,\n  params: Record<string, string>,\n  method: string,\n  uri: string,\n  nc: string,\n  cnonce: string,\n) => {\n  const realm = params['realm'];\n  const nonce = params['nonce'];\n  const qop = params['qop'];\n  const algorithm = params['algorithm'];\n\n  let ha1 = md5(`${username}:${realm}:${password}`);\n\n  if (algorithm && algorithm.toLowerCase() === 'md5-sess') {\n    ha1 = md5(`${ha1}:${nonce}:${cnonce}`);\n  }\n\n  const ha2 = md5(`${method}:${uri}`);\n\n  let response: string;\n\n  if (qop) {\n    response = md5(`${ha1}:${nonce}:${nc}:${cnonce}:${qop}:${ha2}`);\n  } else {\n    response = md5(`${ha1}:${nonce}:${ha2}`);\n  }\n\n  return response;\n};\n\n/**\n * Create Digest Authorization header\n */\nexport const createDigestAuth = async (\n  username: string,\n  password: string,\n  wwwAuthenticate: string,\n  method: string,\n  uri: string,\n): Promise<string> => {\n  const params = parseDigestChallenge(wwwAuthenticate);\n  const cnonce = Math.random().toString(36).slice(2);\n  const nc = '00000001';\n  const response = await generateDigestResponse(\n    username,\n    password,\n    params,\n    method,\n    uri,\n    nc,\n    cnonce,\n  );\n\n  const parts = [\n    `username=\"${username}\"`,\n    `realm=\"${params['realm']}\"`,\n    `nonce=\"${params['nonce']}\"`,\n    `uri=\"${uri}\"`,\n    `response=\"${response}\"`,\n  ];\n\n  if (params['algorithm']) {\n    parts.push(`algorithm=\"${params['algorithm']}\"`);\n  }\n\n  if (params['opaque']) {\n    parts.push(`opaque=\"${params['opaque']}\"`);\n  }\n\n  if (params['qop']) {\n    parts.push(`qop=\"auth\"`);\n    parts.push(`nc=${nc}`);\n    parts.push(`cnonce=\"${cnonce}\"`);\n  }\n\n  return `Digest ${parts.join(', ')}`;\n};\n\n/**\n * Create Basic Authorization header\n */\nexport const createBasicAuth = (username: string, password: string): string => {\n  const credentials = btoa(`${username}:${password}`);\n  return `Basic ${credentials}`;\n};\n\n/**\n * Probe URL for authentication requirements using HEAD request\n * Returns auth header if authentication is needed, null otherwise\n */\nexport const probeAuth = async (\n  url: string,\n  username?: string,\n  password?: string,\n  useProxy = false,\n): Promise<string | null> => {\n  const {\n    url: cleanUrl,\n    username: urlUsername,\n    password: urlPassword,\n  } = extractCredentialsFromURL(url);\n\n  const finalUsername = username || urlUsername;\n  const finalPassword = password || urlPassword;\n\n  // No credentials provided, can't generate auth header\n  if (!finalUsername || !finalPassword) {\n    return null;\n  }\n\n  const fetchURL = useProxy ? getProxiedURL(cleanUrl) : cleanUrl;\n  const headers: Record<string, string> = {\n    'User-Agent': READEST_OPDS_USER_AGENT,\n    Accept: 'application/atom+xml, application/xml, text/xml, */*',\n  };\n\n  // Probe with HEAD request\n  const fetch = isTauriAppPlatform() ? tauriFetch : window.fetch;\n  const res = await fetch(fetchURL, {\n    method: 'HEAD',\n    headers,\n    danger: { acceptInvalidCerts: true, acceptInvalidHostnames: true },\n  });\n\n  // Check if authentication is required\n  if (res.status === 401 || res.status === 403) {\n    const wwwAuthenticate = res.headers.get('WWW-Authenticate');\n    if (wwwAuthenticate) {\n      if (wwwAuthenticate.toLowerCase().startsWith('digest')) {\n        const urlObj = new URL(cleanUrl);\n        return await createDigestAuth(\n          finalUsername,\n          finalPassword,\n          wwwAuthenticate,\n          'GET',\n          urlObj.pathname + urlObj.search,\n        );\n      } else if (wwwAuthenticate.toLowerCase().startsWith('basic')) {\n        return createBasicAuth(finalUsername, finalPassword);\n      }\n    } else {\n      // Fallback to Basic auth if no WWW-Authenticate header\n      // some older Calibre-Web versions behave this way, see issue #2656\n      return createBasicAuth(finalUsername, finalPassword);\n    }\n  }\n\n  // Komga returns 200 even if requires auth, so we return Basic auth header in this case\n  return createBasicAuth(finalUsername, finalPassword);\n};\n\nexport const probeFilename = async (headers: Record<string, string>) => {\n  const contentDisposition = headers['content-disposition'];\n  if (contentDisposition) {\n    const extendedMatch = contentDisposition.match(\n      /filename\\*\\s*=\\s*(?:utf-8|UTF-8)'[^']*'([^;\\s]+)/i,\n    );\n    if (extendedMatch?.[1]) {\n      return decodeURIComponent(extendedMatch[1]);\n    }\n\n    const plainMatch = contentDisposition.match(/filename\\s*=\\s*[\"']?([^\"';\\s]+)[\"']?/i);\n    if (plainMatch?.[1]) {\n      return decodeURIComponent(plainMatch[1]);\n    }\n  }\n\n  return '';\n};\n\n/**\n * Perform authenticated HTTP request with retry logic for Digest/Basic auth\n */\nexport const fetchWithAuth = async (\n  url: string,\n  username?: string,\n  password?: string,\n  useProxy = false,\n  options: RequestInit = {},\n): Promise<Response> => {\n  const {\n    url: cleanUrl,\n    username: urlUsername,\n    password: urlPassword,\n  } = extractCredentialsFromURL(url);\n\n  const finalUsername = username || urlUsername;\n  const finalPassword = password || urlPassword;\n\n  const fetchURL = useProxy ? getProxiedURL(cleanUrl) : cleanUrl;\n  const headers: Record<string, string> = {\n    'User-Agent': READEST_OPDS_USER_AGENT,\n    Accept: 'application/atom+xml, application/xml, text/xml, */*',\n    ...(options.headers as Record<string, string>),\n  };\n\n  const fetch = isTauriAppPlatform() ? tauriFetch : window.fetch;\n  let res = await fetch(fetchURL, {\n    ...options,\n    method: options.method || 'GET',\n    headers,\n    danger: { acceptInvalidCerts: true, acceptInvalidHostnames: true },\n  });\n\n  // Handle authentication if needed\n  if (!res.ok && (res.status === 401 || res.status === 403) && finalUsername && finalPassword) {\n    const wwwAuthenticate = res.headers.get('WWW-Authenticate');\n    if (wwwAuthenticate) {\n      let authHeader: string | null = null;\n\n      if (wwwAuthenticate.toLowerCase().startsWith('digest')) {\n        const urlObj = new URL(cleanUrl);\n        authHeader = await createDigestAuth(\n          finalUsername,\n          finalPassword,\n          wwwAuthenticate,\n          options.method || 'GET',\n          urlObj.pathname + urlObj.search,\n        );\n      } else if (wwwAuthenticate.toLowerCase().startsWith('basic')) {\n        authHeader = createBasicAuth(finalUsername, finalPassword);\n      }\n\n      if (authHeader) {\n        const finalUrl = useProxy ? `${fetchURL}&auth=${encodeURIComponent(authHeader)}` : fetchURL;\n        res = await fetch(finalUrl, {\n          ...options,\n          method: options.method || 'GET',\n          headers: useProxy ? headers : { ...headers, Authorization: authHeader },\n          danger: { acceptInvalidCerts: true, acceptInvalidHostnames: true },\n        });\n      }\n    }\n  }\n\n  return res;\n};\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 533, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/app/opds/utils/opdsUtils.ts"],"sourcesContent":["import { isOPDSCatalog } from 'foliate-js/opds.js';\nimport { OPDSLink } from '@/types/opds';\nimport { EXTS } from '@/libs/document';\nimport { fetchWithAuth } from './opdsReq';\n\nexport const groupByArray = <T, K>(arr: T[] | undefined, f: (el: T) => K | K[]): Map<K, T[]> => {\n  const map = new Map<K, T[]>();\n  if (arr) {\n    for (const el of arr) {\n      const keys = f(el);\n      for (const key of [keys].flat()) {\n        const group = map.get(key as K);\n        if (group) group.push(el);\n        else map.set(key as K, [el]);\n      }\n    }\n  }\n  return map;\n};\n\nexport const MIME = {\n  XML: 'application/xml',\n  ATOM: 'application/atom+xml',\n  XHTML: 'application/xhtml+xml',\n  HTML: 'text/html',\n  EPUB: 'application/epub+zip',\n  PDF: 'application/pdf',\n  OPENSEARCH: 'application/opensearchdescription+xml',\n};\n\nexport const enum VALIDATION_ERROR {\n  INVALID_URL = 'Invalid URL format',\n  LOAD_FAILED = 'Failed to load OPDS feed',\n  NOT_OPDS = 'Invalid OPDS feed URL',\n  NO_OPDS_LINK = 'Document has no link to OPDS feeds',\n  NO_HREF = 'OPDS link has no href attribute',\n  INVALID_HTML = 'Invalid HTML document',\n  INVALID_CONTENT = 'Content is neither valid XML nor JSON',\n}\n\ninterface ValidationResult {\n  isValid: boolean;\n  error?: VALIDATION_ERROR | string;\n  data?: {\n    type: 'feed' | 'entry' | 'opensearch' | 'html';\n    doc: Document;\n    text: string;\n    responseURL: string;\n  };\n}\n\nexport const parseMediaType = (str?: string) => {\n  if (!str) return null;\n  const [mediaType, ...ps] = str.split(/ *; */);\n  if (!mediaType) return null;\n\n  return {\n    mediaType: mediaType.toLowerCase(),\n    parameters: Object.fromEntries(\n      ps\n        .map((p) => {\n          const [name, val] = p.split('=');\n          if (!name) return null;\n          return [name.toLowerCase(), val?.replace(/(^\"|\"$)/g, '')];\n        })\n        .filter((entry): entry is [string, string] => entry !== null),\n    ),\n  };\n};\n\nexport const isSearchLink = (link: OPDSLink): boolean => {\n  const rels = Array.isArray(link.rel) ? link.rel : [link.rel || ''];\n  return rels.includes('search') && (link.type === MIME.OPENSEARCH || link.type === MIME.ATOM);\n};\n\nexport const resolveURL = (url: string, relativeTo: string): string => {\n  if (!url) return '';\n  if (relativeTo.includes('/api/opds/proxy?url=')) {\n    const params = new URLSearchParams(relativeTo.split('?')[1]);\n    const proxiedURL = params.get('url') || '';\n    return resolveURL(url, proxiedURL);\n  }\n  try {\n    if (relativeTo.includes(':')) return new URL(url, relativeTo).toString();\n    const root = 'https://invalid.invalid/';\n    const obj = new URL(url, root + relativeTo);\n    obj.search = '';\n    return decodeURI(obj.href.replace(root, ''));\n  } catch (e) {\n    console.warn(e);\n    return url;\n  }\n};\n\nexport const validateOPDSURL = async (\n  url: string,\n  username?: string,\n  password?: string,\n  useProxy = false,\n): Promise<ValidationResult> => {\n  try {\n    const controller = new AbortController();\n    const timeout = setTimeout(() => controller.abort(), 10000);\n    const res = await fetchWithAuth(url, username, password, useProxy, {\n      signal: controller.signal,\n    });\n    clearTimeout(timeout);\n\n    if (!res.ok) {\n      if (res.status === 401) {\n        return {\n          isValid: false,\n          error: 'Authentication required. Please check your username and password.',\n        };\n      }\n      return {\n        isValid: false,\n        error: `Failed to load OPDS feed: ${res.status} ${res.statusText}`,\n      };\n    }\n\n    const responseURL = res.url;\n    const text = await res.text();\n\n    // Check if it's XML-based OPDS\n    if (text.startsWith('<')) {\n      const doc = new DOMParser().parseFromString(text, MIME.XML as DOMParserSupportedType);\n      const {\n        documentElement: { localName },\n      } = doc;\n\n      if (localName === 'feed') {\n        return {\n          isValid: true,\n          data: { type: 'feed', doc, text, responseURL },\n        };\n      } else if (localName === 'entry') {\n        return {\n          isValid: true,\n          data: { type: 'entry', doc, text, responseURL },\n        };\n      } else if (localName === 'OpenSearchDescription') {\n        return {\n          isValid: true,\n          data: { type: 'opensearch', doc, text, responseURL },\n        };\n      } else {\n        // Check for HTML with OPDS link\n        const contentType = res.headers.get('Content-Type') ?? MIME.HTML;\n        const type = parseMediaType(contentType)?.mediaType ?? MIME.HTML;\n        const htmlDoc = new DOMParser().parseFromString(text, type as DOMParserSupportedType);\n\n        if (!htmlDoc.head) {\n          return {\n            isValid: false,\n            error: VALIDATION_ERROR.NOT_OPDS,\n          };\n        }\n\n        const link = Array.from(htmlDoc.head.querySelectorAll('link')).find((link) =>\n          isOPDSCatalog(link.getAttribute('type') ?? ''),\n        );\n\n        if (!link) {\n          return {\n            isValid: false,\n            error: VALIDATION_ERROR.NOT_OPDS,\n          };\n        }\n\n        const href = link.getAttribute('href');\n        if (!href) {\n          return {\n            isValid: false,\n            error: 'OPDS link has no href attribute',\n          };\n        }\n\n        return {\n          isValid: true,\n          data: { type: 'html', doc: htmlDoc, text, responseURL },\n        };\n      }\n    } else {\n      // Check if it's JSON-based OPDS\n      try {\n        const feed = JSON.parse(text);\n        // Basic validation for OPDS JSON feed\n        if (!feed.metadata && !feed.links && !feed.publications && !feed.navigation) {\n          return {\n            isValid: false,\n            error: VALIDATION_ERROR.NOT_OPDS,\n          };\n        }\n        return {\n          isValid: true,\n          data: {\n            type: 'feed',\n            doc: new Document(),\n            text,\n            responseURL,\n          },\n        };\n      } catch {\n        return {\n          isValid: false,\n          error: VALIDATION_ERROR.NOT_OPDS,\n        };\n      }\n    }\n  } catch (e) {\n    console.error('OPDS validation error:', e);\n    return {\n      isValid: false,\n      error: e instanceof Error ? e.message : VALIDATION_ERROR.NOT_OPDS,\n    };\n  }\n};\n\nexport const getFileExtFromPath = (pathname: string, delimiter = '/'): string => {\n  const parts = pathname.split(delimiter);\n  for (const ext of Object.values(EXTS)) {\n    if (parts.includes(ext)) {\n      return ext;\n    }\n  }\n  return '';\n};\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 776, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/app/opds/components/CatelogManager.tsx"],"sourcesContent":["'use client';\n\nimport { useState } from 'react';\nimport { IoAdd, IoTrash, IoOpenOutline, IoBook, IoEyeOff, IoEye } from 'react-icons/io5';\nimport { useRouter } from 'next/navigation';\nimport { useEnv } from '@/context/EnvContext';\nimport { useTranslation } from '@/hooks/useTranslation';\nimport { useSettingsStore } from '@/store/settingsStore';\nimport { isWebAppPlatform } from '@/services/environment';\nimport { saveSysSettings } from '@/helpers/settings';\nimport { OPDSCatalog } from '@/types/opds';\nimport { isLanAddress } from '@/utils/network';\nimport { validateOPDSURL } from '../utils/opdsUtils';\nimport ModalPortal from '@/components/ModalPortal';\n\nconst POPULAR_CATALOGS: OPDSCatalog[] = [\n  {\n    id: 'gutenberg',\n    name: 'Project Gutenberg',\n    url: 'https://m.gutenberg.org/ebooks.opds/',\n    description: \"World's largest collection of free ebooks\",\n    icon: 'üèõÔ∏è',\n  },\n  {\n    id: 'standardebooks',\n    name: 'Standard Ebooks',\n    url: 'https://standardebooks.org/feeds/opds',\n    description: 'Free and liberated ebooks, carefully produced for the true book lover',\n    icon: 'üìö',\n  },\n  {\n    id: 'manybooks',\n    name: 'ManyBooks',\n    url: 'https://manybooks.net/opds/index.php',\n    description: 'Over 50,000 free ebooks',\n    icon: 'üìñ',\n  },\n  {\n    id: 'unglue.it',\n    name: 'Unglue.it',\n    url: 'https://unglue.it/api/opds/',\n    description: 'Free ebooks from authors who have \"unglued\" their books',\n    icon: 'üîì',\n  },\n];\n\nasync function validateOPDSCatalog(\n  url: string,\n  username?: string,\n  password?: string,\n): Promise<{ valid: boolean; error?: string }> {\n  const result = await validateOPDSURL(url, username, password, isWebAppPlatform());\n  return { valid: result.isValid, error: result.error };\n}\n\nexport function CatalogManager() {\n  const _ = useTranslation();\n  const router = useRouter();\n  const { envConfig } = useEnv();\n  const { settings } = useSettingsStore();\n  const [catalogs, setCatalogs] = useState<OPDSCatalog[]>(() => settings.opdsCatalogs || []);\n  const [showAddDialog, setShowAddDialog] = useState(false);\n  const [newCatalog, setNewCatalog] = useState({\n    name: '',\n    url: '',\n    description: '',\n    username: '',\n    password: '',\n  });\n  const [showPassword, setShowPassword] = useState(false);\n  const [urlError, setUrlError] = useState('');\n  const [isValidating, setIsValidating] = useState(false);\n\n  const saveCatalogs = (updatedCatalogs: OPDSCatalog[]) => {\n    setCatalogs(updatedCatalogs);\n    saveSysSettings(envConfig, 'opdsCatalogs', updatedCatalogs);\n  };\n\n  const handleAddCatalog = async () => {\n    if (!newCatalog.name || !newCatalog.url) return;\n\n    const urlLower = newCatalog.url.trim().toLowerCase();\n    if (!urlLower.startsWith('http://') && !urlLower.startsWith('https://')) {\n      setUrlError(_('URL must start with http:// or https://'));\n      return;\n    }\n\n    if (\n      process.env['NODE_ENV'] === 'production' &&\n      isWebAppPlatform() &&\n      isLanAddress(newCatalog.url)\n    ) {\n      setUrlError(_('Adding LAN addresses is not supported in the web app version.'));\n      return;\n    }\n\n    setIsValidating(true);\n    setUrlError('');\n\n    const validation = await validateOPDSCatalog(\n      newCatalog.url,\n      newCatalog.username || undefined,\n      newCatalog.password || undefined,\n    );\n\n    if (!validation.valid) {\n      setUrlError(validation.error || _('Invalid OPDS catalog. Please check the URL.'));\n      setIsValidating(false);\n      return;\n    }\n\n    const catalog: OPDSCatalog = {\n      id: Date.now().toString(),\n      name: newCatalog.name,\n      url: newCatalog.url,\n      description: newCatalog.description,\n      username: newCatalog.username || undefined,\n      password: newCatalog.password || undefined,\n    };\n\n    saveCatalogs([catalog, ...catalogs]);\n    setNewCatalog({ name: '', url: '', description: '', username: '', password: '' });\n    setUrlError('');\n    setIsValidating(false);\n    setShowAddDialog(false);\n  };\n\n  const handleAddPopularCatalog = (popularCatalog: OPDSCatalog) => {\n    if (catalogs.some((c) => c.url === popularCatalog.url)) {\n      return;\n    }\n\n    saveCatalogs([...catalogs, { ...popularCatalog }]);\n  };\n\n  const handleRemoveCatalog = (id: string) => {\n    saveCatalogs(catalogs.filter((c) => c.id !== id));\n  };\n\n  const handleOpenCatalog = (catalog: OPDSCatalog) => {\n    const params = new URLSearchParams({ url: catalog.url });\n    if (catalog.username) params.set('id', catalog.id);\n    router.push(`/opds?${params.toString()}`);\n  };\n\n  const handleCloseDialog = () => {\n    setShowAddDialog(false);\n    setNewCatalog({ name: '', url: '', description: '', username: '', password: '' });\n    setUrlError('');\n    setShowPassword(false);\n  };\n\n  return (\n    <div className='container max-w-2xl'>\n      <div className='mb-8'>\n        <h1 className='mb-2 text-base font-bold'>{_('OPDS Catalogs')}</h1>\n        <p className='text-base-content/70 text-xs'>\n          {_('Browse and download books from online catalogs')}\n        </p>\n      </div>\n\n      {/* My Catalogs */}\n      <section className='mb-12 text-base'>\n        <div className='mb-4 flex items-center justify-between'>\n          <h2 className='font-semibold'>{_('My Catalogs')}</h2>\n          <button onClick={() => setShowAddDialog(true)} className='btn btn-primary btn-sm'>\n            <IoAdd className='h-4 w-4' />\n            {_('Add Catalog')}\n          </button>\n        </div>\n\n        {catalogs.length === 0 ? (\n          <div className='border-base-300 rounded-lg border-2 border-dashed p-12 text-center'>\n            <IoBook className='text-base-content/30 mx-auto mb-4 h-12 w-12' />\n            <h3 className='mb-2 font-semibold'>{_('No catalogs yet')}</h3>\n            <p className='text-base-content/70 mb-4 text-sm'>\n              {_('Add your first OPDS catalog to start browsing books')}\n            </p>\n            <button onClick={() => setShowAddDialog(true)} className='btn btn-primary btn-sm'>\n              {_('Add Your First Catalog')}\n            </button>\n          </div>\n        ) : (\n          <div className='grid gap-4 sm:grid-cols-2'>\n            {catalogs.map((catalog) => (\n              <div\n                key={catalog.id}\n                className='card bg-base-100 border-base-300 h-full border shadow-sm transition-shadow hover:shadow-md'\n              >\n                <div className='card-body h-full justify-between p-4'>\n                  <div className='flex items-center justify-between'>\n                    <div className='min-w-0 flex-1'>\n                      <div className='mb-1 flex items-center justify-between'>\n                        <h3 className='card-title line-clamp-1 text-sm'>\n                          {catalog.icon && <span className=''>{catalog.icon}</span>}\n                          {catalog.name}\n                        </h3>\n                        <button\n                          onClick={() => handleRemoveCatalog(catalog.id)}\n                          className='btn btn-ghost btn-xs btn-square'\n                          title='Remove'\n                        >\n                          <IoTrash className='h-4 w-4' />\n                        </button>\n                      </div>\n                      {catalog.description && (\n                        <p className='text-base-content/70 mb-2 line-clamp-1 h-6 text-sm sm:line-clamp-2 sm:h-10'>\n                          {catalog.description}\n                        </p>\n                      )}\n                      <p className='text-base-content/50 line-clamp-1 text-xs'>{catalog.url}</p>\n                      {catalog.username && (\n                        <p className='text-base-content/50 mt-1 text-xs'>\n                          {_('Username')}: {catalog.username}\n                        </p>\n                      )}\n                    </div>\n                  </div>\n                  <div className='card-actions mt-4 justify-end'>\n                    <button\n                      onClick={() => handleOpenCatalog(catalog)}\n                      className='btn btn-sm btn-primary'\n                    >\n                      <IoOpenOutline className='h-4 w-4' />\n                      {_('Browse')}\n                    </button>\n                  </div>\n                </div>\n              </div>\n            ))}\n          </div>\n        )}\n      </section>\n\n      {/* Popular Catalogs */}\n      <section className='text-base'>\n        <h2 className='mb-4 font-semibold'>{_('Popular Catalogs')}</h2>\n        <div className='grid gap-4 sm:grid-cols-2'>\n          {POPULAR_CATALOGS.filter((catalog) => !catalog.disabled).map((catalog) => {\n            const isAdded = catalogs.some((c) => c.url === catalog.url);\n            return (\n              <div\n                key={catalog.id}\n                className='card bg-base-100 border-base-300 border shadow-sm transition-shadow hover:shadow-md'\n              >\n                <div className='card-body p-4'>\n                  <h3 className='card-title mb-1 text-sm'>\n                    {catalog.icon && <span className=''>{catalog.icon}</span>}\n                    {catalog.name}\n                  </h3>\n                  {catalog.description && (\n                    <p className='text-base-content/70 line-clamp-2 text-sm'>\n                      {catalog.description}\n                    </p>\n                  )}\n                  <div className='card-actions mt-4 justify-end gap-2'>\n                    {!isAdded && (\n                      <button\n                        onClick={() => handleAddPopularCatalog(catalog)}\n                        className='btn btn-sm'\n                      >\n                        <IoAdd className='h-4 w-4' />\n                        {_('Add')}\n                      </button>\n                    )}\n                    <button\n                      onClick={() => handleOpenCatalog(catalog)}\n                      className='btn btn-sm btn-primary'\n                    >\n                      <IoOpenOutline className='h-4 w-4' />\n                      {_('Browse')}\n                    </button>\n                  </div>\n                </div>\n              </div>\n            );\n          })}\n        </div>\n      </section>\n\n      {/* Add Catalog Dialog */}\n      {showAddDialog && (\n        <ModalPortal>\n          <dialog className='modal modal-open'>\n            <div className='modal-box'>\n              <h3 className='mb-4 text-lg font-bold'>{_('Add OPDS Catalog')}</h3>\n              <form\n                onSubmit={(e) => {\n                  e.preventDefault();\n                  handleAddCatalog();\n                }}\n                className='space-y-4'\n              >\n                <div className='form-control'>\n                  <div className='label'>\n                    <span className='label-text'>{_('Catalog Name')} *</span>\n                  </div>\n                  <input\n                    type='text'\n                    value={newCatalog.name}\n                    onChange={(e) => setNewCatalog({ ...newCatalog, name: e.target.value })}\n                    placeholder={_('My Calibre Library')}\n                    className='input input-bordered placeholder:text-sm'\n                    disabled={isValidating}\n                    required\n                  />\n                </div>\n\n                <div className='form-control'>\n                  <div className='label'>\n                    <span className='label-text'>{_('OPDS URL')} *</span>\n                  </div>\n                  <input\n                    type='url'\n                    value={newCatalog.url}\n                    onChange={(e) => setNewCatalog({ ...newCatalog, url: e.target.value })}\n                    placeholder='https://example.com/opds'\n                    className='input input-bordered placeholder:text-sm'\n                    disabled={isValidating}\n                    required\n                  />\n                  {urlError && (\n                    <div className='label'>\n                      <span className='label-text-alt text-error'>{urlError}</span>\n                    </div>\n                  )}\n                </div>\n\n                <div className='form-control'>\n                  <div className='label'>\n                    <span className='label-text'>{_('Username (optional)')}</span>\n                  </div>\n                  <input\n                    type='text'\n                    value={newCatalog.username}\n                    onChange={(e) => setNewCatalog({ ...newCatalog, username: e.target.value })}\n                    placeholder={_('Username')}\n                    className='input input-bordered placeholder:text-sm'\n                    disabled={isValidating}\n                    autoComplete='username'\n                  />\n                </div>\n\n                <div className='form-control'>\n                  <div className='label'>\n                    <span className='label-text'>{_('Password (optional)')}</span>\n                  </div>\n                  <div className='relative'>\n                    <input\n                      type={showPassword ? 'text' : 'password'}\n                      value={newCatalog.password}\n                      onChange={(e) => setNewCatalog({ ...newCatalog, password: e.target.value })}\n                      placeholder={_('Password')}\n                      className='input input-bordered w-full pr-10 placeholder:text-sm'\n                      disabled={isValidating}\n                      autoComplete='current-password'\n                    />\n                    <button\n                      type='button'\n                      onClick={() => setShowPassword(!showPassword)}\n                      className='btn btn-ghost btn-sm btn-square absolute right-1 top-1/2 -translate-y-1/2'\n                      tabIndex={-1}\n                    >\n                      {showPassword ? (\n                        <IoEyeOff className='h-4 w-4' />\n                      ) : (\n                        <IoEye className='h-4 w-4' />\n                      )}\n                    </button>\n                  </div>\n                </div>\n\n                <div className='form-control'>\n                  <div className='label'>\n                    <span className='label-text'>{_('Description (optional)')}</span>\n                  </div>\n                  <textarea\n                    value={newCatalog.description}\n                    onChange={(e) => setNewCatalog({ ...newCatalog, description: e.target.value })}\n                    placeholder={_('A brief description of this catalog')}\n                    className='textarea textarea-bordered text-sm placeholder:text-sm'\n                    rows={2}\n                    disabled={isValidating}\n                  />\n                </div>\n\n                <div className='modal-action'>\n                  <button\n                    type='button'\n                    onClick={handleCloseDialog}\n                    className='btn'\n                    disabled={isValidating}\n                  >\n                    {_('Cancel')}\n                  </button>\n                  <button type='submit' className='btn btn-primary' disabled={isValidating}>\n                    {isValidating ? (\n                      <>\n                        <span className='loading loading-spinner loading-sm'></span>\n                        {_('Validating...')}\n                      </>\n                    ) : (\n                      _('Add Catalog')\n                    )}\n                  </button>\n                </div>\n              </form>\n            </div>\n          </dialog>\n        </ModalPortal>\n      )}\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1663, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/app/library/components/OPDSDialog.tsx"],"sourcesContent":["import { clsx } from 'clsx';\nimport { CatalogManager } from '@/app/opds/components/CatelogManager';\nimport { useTranslation } from '@/hooks/useTranslation';\nimport Dialog from '@/components/Dialog';\n\ninterface CatalogDialogProps {\n  onClose: () => void;\n}\n\nexport function CatalogDialog({ onClose }: CatalogDialogProps) {\n  const _ = useTranslation();\n  return (\n    <Dialog\n      isOpen={true}\n      title={_('Online Library')}\n      onClose={onClose}\n      bgClassName={'sm:!bg-black/75'}\n      boxClassName='sm:min-w-[520px] sm:w-3/4 sm:h-[85%] sm:!max-w-screen-sm'\n    >\n      <div className={clsx('bg-base-100 relative flex flex-col overflow-y-auto pb-4')}>\n        <CatalogManager />\n      </div>\n    </Dialog>\n  );\n}\n"],"names":[],"mappings":";;;;;AAAA;AACA;AACA;AACA;;;;;;;AAMO,SAAS,cAAc,EAAE,OAAO,EAAsB;;IAC3D,MAAM,IAAI,IAAA,6KAAc;IACxB,qBACE,+VAAC,oKAAM;QACL,QAAQ;QACR,OAAO,EAAE;QACT,SAAS;QACT,aAAa;QACb,cAAa;kBAEb,cAAA,+VAAC;YAAI,WAAW,IAAA,iMAAI,EAAC;sBACnB,cAAA,+VAAC,kMAAc;;;;;;;;;;;;;;;AAIvB;GAfgB;;QACJ,6KAAc;;;KADV"}},
    {"offset": {"line": 1720, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/app/library/components/MigrateDataWindow.tsx"],"sourcesContent":["'use client';\n\nimport clsx from 'clsx';\nimport React, { useEffect, useState } from 'react';\nimport {\n  RiFolderOpenLine,\n  RiCheckboxCircleFill,\n  RiErrorWarningFill,\n  RiLoader2Line,\n} from 'react-icons/ri';\nimport { documentDir, join } from '@tauri-apps/api/path';\nimport { relaunch } from '@tauri-apps/plugin-process';\nimport { useEnv } from '@/context/EnvContext';\nimport { useTranslation } from '@/hooks/useTranslation';\nimport { useSettingsStore } from '@/store/settingsStore';\nimport { revealItemInDir } from '@tauri-apps/plugin-opener';\nimport { DATA_SUBDIR } from '@/services/constants';\nimport { FileItem } from '@/types/system';\nimport { getDirPath } from '@/utils/path';\nimport { formatBytes } from '@/utils/book';\nimport { getOSPlatform } from '@/utils/misc';\nimport { getExternalSDCardPath } from '@/utils/bridge';\nimport { FILE_REVEAL_LABELS, FILE_REVEAL_PLATFORMS } from '@/utils/os';\nimport { requestStoragePermission } from '@/utils/permission';\nimport Dialog from '@/components/Dialog';\nimport Dropdown from '@/components/Dropdown';\nimport MenuItem from '@/components/MenuItem';\n\nexport const setMigrateDataDirDialogVisible = (visible: boolean) => {\n  const dialog = document.getElementById('migrate_data_dir_window');\n  if (dialog) {\n    const event = new CustomEvent('setDialogVisibility', {\n      detail: { visible },\n    });\n    dialog.dispatchEvent(event);\n  }\n};\n\ntype MigrationStatus = 'idle' | 'selecting' | 'migrating' | 'completed' | 'error';\n\ninterface MigrationProgress {\n  current: number;\n  total: number;\n  currentFile?: string;\n}\n\nexport const MigrateDataWindow = () => {\n  const _ = useTranslation();\n  const { appService, envConfig } = useEnv();\n  const { settings, setSettings, saveSettings } = useSettingsStore();\n  const [isOpen, setIsOpen] = useState(false);\n  const [currentDataDir, setCurrentDataDir] = useState('');\n  const [newDataDir, setNewDataDir] = useState('');\n  const [migrationStatus, setMigrationStatus] = useState<MigrationStatus>('idle');\n  const [migrationProgress, setMigrationProgress] = useState<MigrationProgress>({\n    current: 0,\n    total: 0,\n  });\n  const [errorMessage, setErrorMessage] = useState('');\n  const [filesToMigrate, setFilesToMigrate] = useState<FileItem[]>([]);\n  const [currentDirFileCount, setCurrentDirFileCount] = useState('');\n  const [currentDirFileSize, setCurrentDirFileSize] = useState(0);\n  const [androidNewDirs, setAndroidNewDirs] = useState<{ path: string; label: string }[]>([]);\n\n  useEffect(() => {\n    const handleCustomEvent = (event: CustomEvent) => {\n      setIsOpen(event.detail.visible);\n      if (event.detail.visible) {\n        loadCurrentDataDir();\n        loadAndroidDirs();\n      }\n    };\n\n    const el = document.getElementById('migrate_data_dir_window');\n    if (el) {\n      el.addEventListener('setDialogVisibility', handleCustomEvent as EventListener);\n    }\n\n    return () => {\n      if (el) {\n        el.removeEventListener('setDialogVisibility', handleCustomEvent as EventListener);\n      }\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  const loadCurrentDataDir = async () => {\n    try {\n      if (!appService) return;\n\n      const dataDir = await appService.resolveFilePath('', 'Data');\n      setCurrentDataDir(dataDir);\n      const files = await appService.readDirectory(dataDir, 'None');\n      setFilesToMigrate(files);\n      setCurrentDirFileCount(files.length.toLocaleString());\n      setCurrentDirFileSize(files.reduce((acc, file) => acc + file.size, 0));\n    } catch (error) {\n      console.error('Error loading current data directory:', error);\n    }\n  };\n\n  const loadAndroidDirs = async () => {\n    try {\n      if (appService?.isAndroidApp) {\n        const sdCardPathResponse = await getExternalSDCardPath();\n        let sdcardDirs = [\n          { path: '/storage/emulated/0', label: '/sdcard/0' },\n          { path: '/storage/emulated/0/Books', label: '/sdcard/0/Books' },\n          { path: '/storage/emulated/0/Documents', label: '/sdcard/0/Documents' },\n          { path: '/storage/emulated/0/Download', label: '/sdcard/0/Download' },\n        ];\n        if (sdCardPathResponse.path) {\n          const externalSdCardPath = sdCardPathResponse.path;\n          sdcardDirs = [\n            ...sdcardDirs,\n            { path: externalSdCardPath, label: '/sdcard/1' },\n            { path: `${externalSdCardPath}/Books`, label: '/sdcard/1/Books' },\n            { path: `${externalSdCardPath}/Documents`, label: '/sdcard/1/Documents' },\n            { path: `${externalSdCardPath}/Download`, label: '/sdcard/1/Download' },\n          ];\n        }\n        const localDocumentDir = await documentDir();\n        setAndroidNewDirs([\n          // For Google Play version we won't request permission to access root of /sdcard\n          ...(appService?.distChannel === 'playstore' ? [] : sdcardDirs),\n          { path: localDocumentDir, label: '/sdcard/APPDATA/Documents' },\n        ]);\n      }\n    } catch (error) {\n      console.error('Error loading app local data directory:', error);\n    }\n  };\n\n  const handleSelectNewDir = async () => {\n    setMigrationStatus('selecting');\n    setErrorMessage('');\n\n    try {\n      const selectedDir = await appService?.selectDirectory?.('write');\n      if (selectedDir) {\n        const newDataDir = await join(selectedDir, DATA_SUBDIR);\n        await appService?.createDir(newDataDir, 'None', true);\n        setNewDataDir(newDataDir);\n        setMigrationStatus('idle');\n      } else {\n        setMigrationStatus('idle');\n      }\n    } catch (error) {\n      console.error('Error selecting directory:', error);\n      setErrorMessage(_('Failed to select directory'));\n      setMigrationStatus('error');\n    }\n  };\n\n  const handleSelectedNewDir = async (dir: string) => {\n    setErrorMessage('');\n\n    if (!dir.includes('Android/data')) {\n      if (!(await requestStoragePermission())) return;\n    }\n\n    try {\n      const newDataDir = await join(dir, DATA_SUBDIR);\n      await appService?.createDir(newDataDir, 'None', true);\n      setNewDataDir(newDataDir);\n      setMigrationStatus('idle');\n    } catch (error) {\n      console.error('Error selecting directory:', error);\n      setErrorMessage(_('Failed to select directory'));\n      setMigrationStatus('error');\n    }\n  };\n\n  const handleStartMigration = async () => {\n    if (!appService || !currentDataDir || !newDataDir || !filesToMigrate.length) return;\n\n    setMigrationStatus('migrating');\n    setErrorMessage('');\n    setMigrationProgress({ current: 0, total: 0 });\n\n    try {\n      if (newDataDir === currentDataDir) {\n        throw new Error(_('The new data directory must be different from the current one.'));\n      }\n\n      // Copy all files to new location\n      for (let i = 0; i < filesToMigrate.length; i++) {\n        const file = filesToMigrate[i]!;\n        setMigrationProgress({\n          current: i + 1,\n          total: filesToMigrate.length,\n          currentFile: file.path,\n        });\n\n        const srcPath = await join(currentDataDir, file.path);\n        const destPath = await join(newDataDir, file.path);\n        await appService.copyFile(srcPath, destPath, 'None');\n      }\n\n      // Verify all files copied\n      const filesMigrated = await appService.readDirectory(newDataDir, 'None');\n      for (const file of filesToMigrate) {\n        if (!filesMigrated.find((f) => f.path === file.path && f.size === file.size)) {\n          throw new Error(`File ${file.path} failed to copy.`);\n        }\n      }\n\n      // Delete old data directory\n      await appService.deleteDir(currentDataDir, 'None', true);\n\n      // Update settings for new data directory\n      const customRootDir = getDirPath(newDataDir);\n      await appService.setCustomRootDir(customRootDir);\n      settings.customRootDir = customRootDir;\n      settings.localBooksDir = await appService.resolveFilePath('', 'Books');\n      setSettings({ ...settings });\n      await saveSettings(envConfig, settings);\n\n      // Finalize migration\n      setMigrationStatus('completed');\n      setCurrentDataDir(newDataDir);\n      setFilesToMigrate([]);\n      setCurrentDirFileCount('');\n      setCurrentDirFileSize(0);\n      loadCurrentDataDir();\n    } catch (error) {\n      console.error('Error migrating data:', error);\n      setErrorMessage(_('Migration failed: {{error}}', { error: error || 'Unknown error' }));\n      setMigrationStatus('error');\n    }\n  };\n\n  const handleClose = () => {\n    if (migrationStatus === 'migrating') {\n      return;\n    }\n    setIsOpen(false);\n    setNewDataDir('');\n    setMigrationStatus('idle');\n    setErrorMessage('');\n    setMigrationProgress({ current: 0, total: 0 });\n  };\n\n  const handleRestartApp = () => {\n    relaunch();\n  };\n\n  const handleRevealDir = (dataDir: string) => {\n    if (dataDir && appService?.isDesktopApp) {\n      revealItemInDir(dataDir);\n    }\n  };\n\n  const progressPercentage =\n    migrationProgress.total > 0\n      ? Math.round((migrationProgress.current / migrationProgress.total) * 100)\n      : 0;\n\n  const canStartMigration =\n    newDataDir && newDataDir !== currentDataDir && migrationStatus === 'idle';\n\n  const osPlatform = getOSPlatform();\n  const fileRevealLabel =\n    FILE_REVEAL_LABELS[osPlatform as FILE_REVEAL_PLATFORMS] || FILE_REVEAL_LABELS.default;\n\n  return (\n    <Dialog\n      id='migrate_data_dir_window'\n      isOpen={isOpen}\n      title={_('Change Data Location')}\n      onClose={handleClose}\n      boxClassName='sm:!w-[520px] sm:!max-w-screen-sm sm:h-auto'\n    >\n      {isOpen && (\n        <div className='migrate-data-dir-content flex flex-col gap-6 px-6 py-4'>\n          {/* Current Data Directory */}\n          <div className='space-y-2'>\n            <h3 className='text-base-content text-sm font-semibold'>\n              {_('Current Data Location')}\n            </h3>\n            <button\n              title={_(fileRevealLabel)}\n              className='bg-base-200 flex w-full items-center gap-2 rounded-lg p-3'\n              onClick={() => handleRevealDir(currentDataDir)}\n            >\n              <RiFolderOpenLine className='text-base-content/70 h-4 w-4 flex-shrink-0' />\n              <span className='text-base-content/80 break-all text-start font-mono text-sm'>\n                {currentDataDir || _('Loading...')}\n              </span>\n            </button>\n            {currentDirFileCount ? (\n              <div className='flex space-x-4'>\n                <p className='text-base-content/60 text-xs'>\n                  {_('File count: {{size}}', { size: currentDirFileCount })}\n                </p>\n                <p className='text-base-content/60 text-xs'>\n                  {_('Total size: {{size}}', { size: formatBytes(currentDirFileSize) })}\n                </p>\n              </div>\n            ) : (\n              <p className='text-base-content/60 text-xs'>{_('Calculating file info...')}</p>\n            )}\n          </div>\n\n          {/* New Data Directory Selection */}\n          <div className='space-y-3'>\n            <h3 className='text-base-content text-sm font-semibold'>{_('New Data Location')}</h3>\n\n            {newDataDir && (\n              <button\n                title={_(fileRevealLabel)}\n                className='bg-primary/10 border-primary/20 flex w-full items-center gap-2 rounded-lg border p-3'\n                onClick={() => handleRevealDir(newDataDir)}\n              >\n                <RiFolderOpenLine className='text-primary h-4 w-4 flex-shrink-0' />\n                <span className='text-primary break-all text-start font-mono text-sm'>\n                  {newDataDir}\n                </span>\n              </button>\n            )}\n            {appService?.isAndroidApp ? (\n              <Dropdown\n                label={_('Choose New Folder')}\n                className='dropdown-bottom flex w-full justify-center'\n                buttonClassName='btn btn-ghost btn-outline w-full'\n                toggleButton={\n                  <div>{newDataDir ? _('Choose Different Folder') : _('Choose New Folder')}</div>\n                }\n              >\n                <div\n                  className={clsx(\n                    'folder-menu dropdown-content dropdown-center no-triangle',\n                    'border-base-300 !bg-base-200 z-20 mt-1 max-w-[90vw] shadow-2xl',\n                  )}\n                >\n                  {androidNewDirs.map((dir) => (\n                    <MenuItem\n                      key={dir.path}\n                      toggled={newDataDir.split(`/${DATA_SUBDIR}`)[0] === dir.path}\n                      transient\n                      label={dir.label}\n                      onClick={() => handleSelectedNewDir(dir.path)}\n                    />\n                  ))}\n                </div>\n              </Dropdown>\n            ) : (\n              <button\n                className='btn btn-outline btn-sm w-full'\n                onClick={handleSelectNewDir}\n                disabled={migrationStatus === 'migrating' || migrationStatus === 'selecting'}\n              >\n                {migrationStatus === 'selecting' && (\n                  <RiLoader2Line className='h-4 w-4 animate-spin' />\n                )}\n                {newDataDir ? _('Choose Different Folder') : _('Choose New Folder')}\n              </button>\n            )}\n          </div>\n\n          {/* Migration Progress */}\n          {migrationStatus === 'migrating' && (\n            <div className='space-y-3'>\n              <div className='flex items-center gap-2'>\n                <RiLoader2Line className='text-primary h-4 w-4 animate-spin' />\n                <span className='text-base-content text-sm font-medium'>\n                  {_('Migrating data...')}\n                </span>\n                <span className='text-base-content/70 text-sm'>{progressPercentage}%</span>\n              </div>\n\n              <div className='bg-base-200 h-2 w-full rounded-full'>\n                <div\n                  className='bg-primary h-2 rounded-full transition-all duration-300'\n                  style={{ width: `${progressPercentage}%` }}\n                />\n              </div>\n\n              {migrationProgress.currentFile && (\n                <p\n                  className='text-base-content/60 overflow-hidden font-mono text-xs'\n                  style={{\n                    direction: 'rtl',\n                    textAlign: 'left',\n                    whiteSpace: 'nowrap',\n                    textOverflow: 'ellipsis',\n                  }}\n                >\n                  {_('Copying: {{file}}', { file: migrationProgress.currentFile })}\n                </p>\n              )}\n\n              <p className='text-base-content/60 text-xs'>\n                {_('{{current}} of {{total}} files', {\n                  current: migrationProgress.current.toLocaleString(),\n                  total: migrationProgress.total.toLocaleString(),\n                })}\n              </p>\n            </div>\n          )}\n\n          {/* Success State */}\n          {migrationStatus === 'completed' && (\n            <div className='space-y-3'>\n              <div className='text-success flex items-center gap-2'>\n                <RiCheckboxCircleFill className='h-5 w-5' />\n                <span className='font-medium'>{_('Migration completed successfully!')}</span>\n              </div>\n              <div className='bg-success/10 border-success/20 rounded-lg border p-3'>\n                <p className='text-success/80 text-sm'>\n                  {_(\n                    'Your data has been moved to the new location. Please restart the application to complete the process.',\n                  )}\n                </p>\n              </div>\n            </div>\n          )}\n\n          {/* Error State */}\n          {migrationStatus === 'error' && errorMessage && (\n            <div className='space-y-2'>\n              <div className='text-error flex items-center gap-2'>\n                <RiErrorWarningFill className='h-5 w-5' />\n                <span className='font-medium'>{_('Migration failed')}</span>\n              </div>\n              <div className='bg-error/10 border-error/20 rounded-lg border p-3'>\n                <p className='text-error/80 break-all text-sm'>{errorMessage}</p>\n              </div>\n            </div>\n          )}\n\n          {/* Warning */}\n          {canStartMigration && (\n            <div className='bg-warning/10 border-warning/20 rounded-lg border p-3'>\n              <div className='flex items-start gap-2'>\n                <RiErrorWarningFill className='text-warning mt-0.5 h-4 w-4 flex-shrink-0' />\n                <div className='space-y-1'>\n                  <p className='text-base-content text-sm font-medium'>{_('Important Notice')}</p>\n                  <p className='text-base-content/80 text-sm'>\n                    {_(\n                      'This will move all your app data to the new location. Make sure the destination has enough free space.',\n                    )}\n                  </p>\n                </div>\n              </div>\n            </div>\n          )}\n\n          {/* Action Buttons */}\n          <div className='flex gap-3 pt-2'>\n            {migrationStatus === 'completed' ? (\n              <>\n                <button className='btn btn-outline flex-1' onClick={handleClose}>\n                  {_('Close')}\n                </button>\n                <button className='btn btn-primary flex-1' onClick={handleRestartApp}>\n                  {_('Restart App')}\n                </button>\n              </>\n            ) : (\n              <>\n                <button\n                  className='btn btn-outline flex-1'\n                  onClick={handleClose}\n                  disabled={migrationStatus === 'migrating'}\n                >\n                  {_('Cancel')}\n                </button>\n                <button\n                  className='btn btn-primary flex-1'\n                  onClick={handleStartMigration}\n                  disabled={!canStartMigration || migrationStatus !== 'idle'}\n                >\n                  {migrationStatus === 'migrating' && (\n                    <RiLoader2Line className='h-4 w-4 animate-spin' />\n                  )}\n                  {_('Start Migration')}\n                </button>\n              </>\n            )}\n          </div>\n        </div>\n      )}\n    </Dialog>\n  );\n};\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2514, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/app/library/hooks/useDragDropImport.ts"],"sourcesContent":["'use client';\n\nimport { useEffect, useState } from 'react';\nimport { useEnv } from '@/context/EnvContext';\nimport { impactFeedback } from '@tauri-apps/plugin-haptics';\nimport { eventDispatcher } from '@/utils/event';\nimport { SelectedFile } from '@/hooks/useFileSelector';\nimport { isTauriAppPlatform } from '@/services/environment';\nimport { getCurrentWebview } from '@tauri-apps/api/webview';\nimport { useTranslation } from '@/hooks/useTranslation';\nimport { BOOK_ACCEPT_FORMATS } from '@/services/constants';\nimport { useSearchParams } from 'next/navigation';\n\nexport const useDragDropImport = () => {\n  const _ = useTranslation();\n  const searchParams = useSearchParams();\n  const group = searchParams?.get('group') || '';\n\n  const { appService } = useEnv();\n  const [isDragging, setIsDragging] = useState(false);\n\n  const handleDroppedFiles = async (files: File[] | string[]) => {\n    if (files.length === 0) return;\n    const supportedFiles = files.filter((file) => {\n      let fileExt;\n      if (typeof file === 'string') {\n        fileExt = file.split('.').pop()?.toLowerCase();\n      } else {\n        fileExt = file.name.split('.').pop()?.toLowerCase();\n      }\n      return BOOK_ACCEPT_FORMATS.includes(`.${fileExt}`);\n    });\n    if (supportedFiles.length === 0) {\n      eventDispatcher.dispatch('toast', {\n        message: _('No supported files found. Supported formats: {{formats}}', {\n          formats: BOOK_ACCEPT_FORMATS,\n        }),\n        type: 'error',\n      });\n      return;\n    }\n\n    if (appService?.hasHaptics) {\n      impactFeedback('medium');\n    }\n\n    const selectedFiles = supportedFiles.map(\n      (file) =>\n        ({\n          file: typeof file === 'string' ? undefined : file,\n          path: typeof file === 'string' ? file : undefined,\n        }) as SelectedFile,\n    );\n    eventDispatcher.dispatch('import-book-files', { files: selectedFiles, groupId: group });\n  };\n\n  const handleDragOver = (event: React.DragEvent<HTMLDivElement> | DragEvent) => {\n    event.preventDefault();\n    event.stopPropagation();\n    setIsDragging(true);\n  };\n\n  const handleDragLeave = (event: React.DragEvent<HTMLDivElement> | DragEvent) => {\n    event.preventDefault();\n    event.stopPropagation();\n    setIsDragging(false);\n  };\n\n  const handleDrop = async (event: React.DragEvent<HTMLDivElement> | DragEvent) => {\n    event.preventDefault();\n    event.stopPropagation();\n    setIsDragging(false);\n\n    if (event.dataTransfer?.files && event.dataTransfer.files.length > 0) {\n      const files = Array.from(event.dataTransfer.files);\n      handleDroppedFiles(files);\n    }\n  };\n\n  useEffect(() => {\n    const libraryPage = document.querySelector('.library-page');\n    if (!appService?.isMobile) {\n      libraryPage?.addEventListener('dragover', handleDragOver as unknown as EventListener);\n      libraryPage?.addEventListener('dragleave', handleDragLeave as unknown as EventListener);\n      libraryPage?.addEventListener('drop', handleDrop as unknown as EventListener);\n    }\n\n    if (isTauriAppPlatform()) {\n      const unlisten = getCurrentWebview().onDragDropEvent((event) => {\n        if (event.payload.type === 'over') {\n          setIsDragging(true);\n        } else if (event.payload.type === 'drop') {\n          setIsDragging(false);\n          handleDroppedFiles(event.payload.paths);\n        } else {\n          setIsDragging(false);\n        }\n      });\n      return () => {\n        unlisten.then((fn) => fn());\n      };\n    }\n\n    return () => {\n      if (!appService?.isMobile) {\n        libraryPage?.removeEventListener('dragover', handleDragOver as unknown as EventListener);\n        libraryPage?.removeEventListener('dragleave', handleDragLeave as unknown as EventListener);\n        libraryPage?.removeEventListener('drop', handleDrop as unknown as EventListener);\n      }\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [group]);\n\n  return { isDragging };\n};\n"],"names":[],"mappings":";;;;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;;AAXA;;;;;;;;;;AAaO,MAAM,oBAAoB;;IAC/B,MAAM,IAAI,IAAA,6KAAc;IACxB,MAAM,eAAe,IAAA,0TAAe;IACpC,MAAM,QAAQ,cAAc,IAAI,YAAY;IAE5C,MAAM,EAAE,UAAU,EAAE,GAAG,IAAA,oKAAM;IAC7B,MAAM,CAAC,YAAY,cAAc,GAAG,IAAA,2UAAQ,EAAC;IAE7C,MAAM,qBAAqB,OAAO;QAChC,IAAI,MAAM,MAAM,KAAK,GAAG;QACxB,MAAM,iBAAiB,MAAM,MAAM,CAAC,CAAC;YACnC,IAAI;YACJ,IAAI,OAAO,SAAS,UAAU;gBAC5B,UAAU,KAAK,KAAK,CAAC,KAAK,GAAG,IAAI;YACnC,OAAO;gBACL,UAAU,KAAK,IAAI,CAAC,KAAK,CAAC,KAAK,GAAG,IAAI;YACxC;YACA,OAAO,gLAAmB,CAAC,QAAQ,CAAC,CAAC,CAAC,EAAE,SAAS;QACnD;QACA,IAAI,eAAe,MAAM,KAAK,GAAG;YAC/B,qKAAe,CAAC,QAAQ,CAAC,SAAS;gBAChC,SAAS,EAAE,4DAA4D;oBACrE,SAAS,gLAAmB;gBAC9B;gBACA,MAAM;YACR;YACA;QACF;QAEA,IAAI,YAAY,YAAY;YAC1B,IAAA,iRAAc,EAAC;QACjB;QAEA,MAAM,gBAAgB,eAAe,GAAG,CACtC,CAAC,OACC,CAAC;gBACC,MAAM,OAAO,SAAS,WAAW,YAAY;gBAC7C,MAAM,OAAO,SAAS,WAAW,OAAO;YAC1C,CAAC;QAEL,qKAAe,CAAC,QAAQ,CAAC,qBAAqB;YAAE,OAAO;YAAe,SAAS;QAAM;IACvF;IAEA,MAAM,iBAAiB,CAAC;QACtB,MAAM,cAAc;QACpB,MAAM,eAAe;QACrB,cAAc;IAChB;IAEA,MAAM,kBAAkB,CAAC;QACvB,MAAM,cAAc;QACpB,MAAM,eAAe;QACrB,cAAc;IAChB;IAEA,MAAM,aAAa,OAAO;QACxB,MAAM,cAAc;QACpB,MAAM,eAAe;QACrB,cAAc;QAEd,IAAI,MAAM,YAAY,EAAE,SAAS,MAAM,YAAY,CAAC,KAAK,CAAC,MAAM,GAAG,GAAG;YACpE,MAAM,QAAQ,MAAM,IAAI,CAAC,MAAM,YAAY,CAAC,KAAK;YACjD,mBAAmB;QACrB;IACF;IAEA,IAAA,4UAAS;uCAAC;YACR,MAAM,cAAc,SAAS,aAAa,CAAC;YAC3C,IAAI,CAAC,YAAY,UAAU;gBACzB,aAAa,iBAAiB,YAAY;gBAC1C,aAAa,iBAAiB,aAAa;gBAC3C,aAAa,iBAAiB,QAAQ;YACxC;YAEA,IAAI,IAAA,iLAAkB,KAAI;gBACxB,MAAM,WAAW,IAAA,4OAAiB,IAAG,eAAe;4DAAC,CAAC;wBACpD,IAAI,MAAM,OAAO,CAAC,IAAI,KAAK,QAAQ;4BACjC,cAAc;wBAChB,OAAO,IAAI,MAAM,OAAO,CAAC,IAAI,KAAK,QAAQ;4BACxC,cAAc;4BACd,mBAAmB,MAAM,OAAO,CAAC,KAAK;wBACxC,OAAO;4BACL,cAAc;wBAChB;oBACF;;gBACA;mDAAO;wBACL,SAAS,IAAI;2DAAC,CAAC,KAAO;;oBACxB;;YACF;YAEA;+CAAO;oBACL,IAAI,CAAC,YAAY,UAAU;wBACzB,aAAa,oBAAoB,YAAY;wBAC7C,aAAa,oBAAoB,aAAa;wBAC9C,aAAa,oBAAoB,QAAQ;oBAC3C;gBACF;;QACA,uDAAuD;QACzD;sCAAG;QAAC;KAAM;IAEV,OAAO;QAAE;IAAW;AACtB;GArGa;;QACD,6KAAc;QACH,0TAAe;QAGb,oKAAM"}},
    {"offset": {"line": 2657, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/app/library/utils/libraryUtils.ts"],"sourcesContent":["import { Book } from '@/types/book';\nimport { formatAuthors, formatTitle } from '@/utils/book';\n\nexport const createBookFilter = (queryTerm: string | null) => (item: Book) => {\n  if (!queryTerm) return true;\n  if (item.deletedAt) return false;\n  let searchTerm: RegExp;\n  try {\n    searchTerm = new RegExp(queryTerm, 'i');\n  } catch {\n    const lowerQuery = queryTerm.toLowerCase();\n    const title = formatTitle(item.title).toLowerCase();\n    const authors = formatAuthors(item.author).toLowerCase();\n\n    return (\n      title.includes(lowerQuery) ||\n      authors.includes(lowerQuery) ||\n      item.format.toLowerCase().includes(lowerQuery) ||\n      (item.groupName && item.groupName.toLowerCase().includes(lowerQuery)) ||\n      (item.metadata?.description && item.metadata.description.toLowerCase().includes(lowerQuery))\n    );\n  }\n  const title = formatTitle(item.title);\n  const authors = formatAuthors(item.author);\n  return (\n    searchTerm.test(title) ||\n    searchTerm.test(authors) ||\n    searchTerm.test(item.format) ||\n    (item.groupName && searchTerm.test(item.groupName)) ||\n    (item.metadata?.description && searchTerm.test(item.metadata?.description))\n  );\n};\n\nexport const createBookSorter = (sortBy: string, uiLanguage: string) => (a: Book, b: Book) => {\n  switch (sortBy) {\n    case 'title':\n      const aTitle = formatTitle(a.title);\n      const bTitle = formatTitle(b.title);\n      return aTitle.localeCompare(bTitle, uiLanguage || navigator.language);\n    case 'author':\n      const aAuthors = formatAuthors(a.author, a?.primaryLanguage || 'en', true);\n      const bAuthors = formatAuthors(b.author, b?.primaryLanguage || 'en', true);\n      return aAuthors.localeCompare(bAuthors, uiLanguage || navigator.language);\n    case 'updated':\n      return new Date(a.updatedAt).getTime() - new Date(b.updatedAt).getTime();\n    case 'created':\n      return new Date(a.createdAt).getTime() - new Date(b.createdAt).getTime();\n    case 'format':\n      return a.format.localeCompare(b.format, uiLanguage || navigator.language);\n    case 'published':\n      const aPublished = a.metadata?.published || '0001-01-01';\n      const bPublished = b.metadata?.published || '0001-01-01';\n\n      // Handle cases where published date might not exist\n      if (!aPublished && !bPublished) return 0;\n      if (!aPublished) return 1; // Books without published date go to the end\n      if (!bPublished) return -1;\n\n      // Try to parse dates - handle various date formats\n      const aDate = new Date(aPublished).getTime();\n      const bDate = new Date(bPublished).getTime();\n\n      // If dates are invalid (NaN), fall back to string comparison\n      if (isNaN(aDate) && isNaN(bDate)) {\n        return aPublished.localeCompare(bPublished, uiLanguage || navigator.language);\n      }\n      if (isNaN(aDate)) return 1;\n      if (isNaN(bDate)) return -1;\n\n      return aDate - bDate;\n    default:\n      return new Date(a.updatedAt).getTime() - new Date(b.updatedAt).getTime();\n  }\n};\n\nexport const getBreadcrumbs = (currentPath: string) => {\n  if (!currentPath) return [];\n  const segments = currentPath.split('/');\n  return segments.map((segment, index) => ({\n    name: segment,\n    path: segments.slice(0, index + 1).join('/'),\n  }));\n};\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2739, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/app/library/components/ImportMenu.tsx"],"sourcesContent":["import clsx from 'clsx';\nimport { useTranslation } from '@/hooks/useTranslation';\nimport { IoFileTray } from 'react-icons/io5';\nimport { MdRssFeed } from 'react-icons/md';\n\nimport MenuItem from '@/components/MenuItem';\nimport Menu from '@/components/Menu';\n\ninterface ImportMenuProps {\n  setIsDropdownOpen?: (open: boolean) => void;\n  onImportBooksFromFiles: () => void;\n  onImportBooksFromDirectory?: () => void;\n  onOpenCatalogManager: () => void;\n}\n\nconst ImportMenu: React.FC<ImportMenuProps> = ({\n  setIsDropdownOpen,\n  onImportBooksFromFiles,\n  onImportBooksFromDirectory,\n  onOpenCatalogManager,\n}) => {\n  const _ = useTranslation();\n\n  const handleImportFromFiles = () => {\n    onImportBooksFromFiles();\n    setIsDropdownOpen?.(false);\n  };\n\n  const handleImportFromDirectory = () => {\n    onImportBooksFromDirectory?.();\n    setIsDropdownOpen?.(false);\n  };\n\n  const handleOpenCatalogManager = () => {\n    onOpenCatalogManager();\n    setIsDropdownOpen?.(false);\n  };\n\n  return (\n    <Menu\n      className={clsx('dropdown-content bg-base-100 rounded-box z-[1] mt-3 p-2 shadow')}\n      onCancel={() => setIsDropdownOpen?.(false)}\n    >\n      <MenuItem\n        label={_('From Local File')}\n        Icon={<IoFileTray className='h-5 w-5' />}\n        onClick={handleImportFromFiles}\n      />\n      {onImportBooksFromDirectory && (\n        <MenuItem\n          label={_('From Directory')}\n          Icon={<IoFileTray className='h-5 w-5' />}\n          onClick={handleImportFromDirectory}\n        />\n      )}\n      <MenuItem\n        label={_('Online Library')}\n        Icon={<MdRssFeed className='h-5 w-5' />}\n        onClick={handleOpenCatalogManager}\n      />\n    </Menu>\n  );\n};\n\nexport default ImportMenu;\n"],"names":[],"mappings":";;;;;AAAA;AACA;AACA;AACA;AAEA;AACA;;;;;;;;;AASA,MAAM,aAAwC,CAAC,EAC7C,iBAAiB,EACjB,sBAAsB,EACtB,0BAA0B,EAC1B,oBAAoB,EACrB;;IACC,MAAM,IAAI,IAAA,6KAAc;IAExB,MAAM,wBAAwB;QAC5B;QACA,oBAAoB;IACtB;IAEA,MAAM,4BAA4B;QAChC;QACA,oBAAoB;IACtB;IAEA,MAAM,2BAA2B;QAC/B;QACA,oBAAoB;IACtB;IAEA,qBACE,+VAAC,kKAAI;QACH,WAAW,IAAA,oMAAI,EAAC;QAChB,UAAU,IAAM,oBAAoB;;0BAEpC,+VAAC,sKAAQ;gBACP,OAAO,EAAE;gBACT,oBAAM,+VAAC,iPAAU;oBAAC,WAAU;;;;;;gBAC5B,SAAS;;;;;;YAEV,4CACC,+VAAC,sKAAQ;gBACP,OAAO,EAAE;gBACT,oBAAM,+VAAC,iPAAU;oBAAC,WAAU;;;;;;gBAC5B,SAAS;;;;;;0BAGb,+VAAC,sKAAQ;gBACP,OAAO,EAAE;gBACT,oBAAM,+VAAC,+OAAS;oBAAC,WAAU;;;;;;gBAC3B,SAAS;;;;;;;;;;;;AAIjB;GA/CM;;QAMM,6KAAc;;;KANpB;uCAiDS"}},
    {"offset": {"line": 2845, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/app/library/components/LibraryHeader.tsx"],"sourcesContent":["'use client';\n\nimport React, { useState } from 'react';\nimport clsx from 'clsx';\nimport { BiScan } from 'react-icons/bi';\nimport { MdSelectAll, MdOutlineSelectAll, MdHomeRepairService } from 'react-icons/md';\nimport { IoChevronDown } from 'react-icons/io5';\n\nimport ImportMenu from './ImportMenu';\nimport { useTranslation } from '@/hooks/useTranslation';\nimport { useEnv } from '@/context/EnvContext';\nimport { useLibraryStore } from '@/store/libraryStore';\nimport { getBaseFilename } from '@/utils/path';\nimport { getCoverFilename } from '@/utils/book';\nimport { Book } from '@/types/book';\nimport { eventDispatcher } from '@/utils/event';\n\ninterface LibraryHeaderProps {\n    isSelectMode: boolean;\n    isSelectAll: boolean;\n    onImportBooksFromFiles: () => void;\n    onImportBooksFromDirectory?: () => void;\n    onOpenCatalogManager: () => void;\n    onToggleSelectMode: () => void;\n    onSelectAll: () => void;\n    onDeselectAll: () => void;\n    onReconcilePaths: () => void;\n}\n\ninterface ScannedBook {\n    filePath: string;\n    relativePath: string;\n    fileName: string;\n    directory: string;\n    size: number;\n    mtime: number;\n    ext: string;\n    hash?: string;\n}\n\nconst extToFormat = (ext?: string): Book['format'] => {\n    switch ((ext || '').toLowerCase()) {\n        case 'epub':\n            return 'EPUB';\n        case 'pdf':\n            return 'PDF';\n        case 'mobi':\n            return 'MOBI';\n        case 'azw':\n            return 'AZW';\n        case 'azw3':\n            return 'AZW3';\n        case 'cbz':\n            return 'CBZ';\n        case 'fb2':\n            return 'FB2';\n        case 'fbz':\n            return 'FBZ';\n        case 'txt':\n            return 'TXT';\n        case 'md':\n            return 'MD';\n        default:\n            return 'EPUB';\n    }\n};\n\nconst LibraryHeader: React.FC<LibraryHeaderProps> = ({\n    isSelectMode,\n    isSelectAll,\n    onImportBooksFromFiles,\n    onImportBooksFromDirectory,\n    onOpenCatalogManager,\n    onToggleSelectMode,\n    onSelectAll,\n    onDeselectAll,\n    onReconcilePaths,\n}) => {\n    const _ = useTranslation();\n    const { envConfig } = useEnv();\n    const { library, updateBooks } = useLibraryStore();\n    const [isDropdownOpen, setIsDropdownOpen] = useState(false);\n    const [isScanning, setIsScanning] = useState(false);\n\n    const handleScanBooks = async () => {\n        if (isScanning) return;\n        setIsScanning(true);\n\n        eventDispatcher.dispatch('toast', {\n            type: 'info',\n            timeout: 0,\n            message: _('Scanning books directory...'),\n        });\n\n        try {\n            const res = await fetch('/api/storage/scan', { method: 'POST' });\n            if (!res.ok) {\n                throw new Error(await res.text());\n            }\n            const data: { books: ScannedBook[]; count: number } = await res.json();\n\n            const existing = new Map(library.map((b) => [b.hash, b]));\n            const newBooks: Book[] = [];\n            const movedBooks: Book[] = [];\n            const now = Date.now();\n\n            for (const scanned of data.books || []) {\n                const hash = scanned.hash || scanned.relativePath;\n                const current = existing.get(hash);\n\n                if (current) {\n                    if (current.relativePath !== scanned.relativePath) {\n                        const updated: Book = {\n                            ...current,\n                            relativePath: scanned.relativePath,\n                            groupName: scanned.directory || '',\n                            updatedAt: now,\n                        };\n                        const coverPath = getCoverFilename(updated);\n                        updated.coverImageUrl = `/api/storage/file?filePath=${encodeURIComponent(coverPath)}`;\n                        movedBooks.push(updated);\n                    }\n                    continue;\n                }\n\n                const title = getBaseFilename(scanned.fileName);\n                const book: Book = {\n                    hash,\n                    format: extToFormat(scanned.ext),\n                    title,\n                    sourceTitle: title,\n                    author: _('Unknown Author'),\n                    groupName: scanned.directory || '',\n                    relativePath: scanned.relativePath,\n                    filePath: scanned.filePath,\n                    createdAt: now,\n                    updatedAt: now,\n                    deletedAt: null,\n                } as Book;\n                const coverPath = getCoverFilename(book);\n                book.coverImageUrl = `/api/storage/file?filePath=${encodeURIComponent(coverPath)}`;\n                newBooks.push(book);\n            }\n\n            const updates = [...newBooks, ...movedBooks];\n            if (updates.length > 0) {\n                await updateBooks(envConfig, updates);\n            }\n\n            eventDispatcher.dispatch('toast', {\n                type: 'success',\n                timeout: 4000,\n                message: newBooks.length\n                    ? _('Scan completed: {{count}} new book(s)', { count: newBooks.length })\n                    : _('Scan completed, no new books'),\n            });\n        } catch (error: any) {\n            console.error('[ScanBooks] Failed:', error);\n            eventDispatcher.dispatch('toast', {\n                type: 'error',\n                timeout: 5000,\n                message: _('Failed to scan books: {{error}}', { error: error?.message || 'Unknown error' }),\n            });\n        } finally {\n            setIsScanning(false);\n        }\n    };\n\n    return (\n        <div className='relative w-full border-b border-base-300 bg-base-100/90 backdrop-blur'>\n            <div className='flex items-center justify-between gap-3 px-4 py-3'>\n                <div className='flex items-center gap-2'>\n                    <h1 className='text-lg font-semibold'>{_('My Library')}</h1>\n                    <button\n                        className='btn btn-ghost btn-sm flex items-center gap-2'\n                        onClick={handleScanBooks}\n                        disabled={isScanning}\n                    >\n                        <BiScan className={clsx(isScanning && 'animate-spin')} size={16} />\n                        {isScanning ? _('Scanning...') : _('Scan Books')}\n                    </button>\n                    <button\n                        className='btn btn-ghost btn-sm flex items-center gap-2'\n                        onClick={onReconcilePaths}\n                    >\n                        <MdHomeRepairService size={16} />\n                        {_('Reconcile Paths')}\n                    </button>\n                </div>\n\n                <div className='flex items-center gap-2'>\n                    <div className='dropdown dropdown-end'>\n                        <button\n                            className='btn btn-primary btn-sm flex items-center gap-1'\n                            onClick={() => setIsDropdownOpen(!isDropdownOpen)}\n                        >\n                            {_('Import Books')}\n                            <IoChevronDown size={16} />\n                        </button>\n                        {isDropdownOpen && (\n                            <ImportMenu\n                                setIsDropdownOpen={setIsDropdownOpen}\n                                onImportBooksFromFiles={onImportBooksFromFiles}\n                                onImportBooksFromDirectory={onImportBooksFromDirectory}\n                                onOpenCatalogManager={onOpenCatalogManager}\n                            />\n                        )}\n                    </div>\n\n                    <button\n                        className={clsx('btn btn-ghost btn-sm flex items-center gap-2', isSelectMode && 'btn-active')}\n                        onClick={onToggleSelectMode}\n                    >\n                        {isSelectMode ? <MdOutlineSelectAll size={16} /> : <MdSelectAll size={16} />}\n                        {isSelectMode ? _('Exit Select') : _('Select')}\n                    </button>\n\n                    {isSelectMode && (\n                        <div className='flex items-center gap-1'>\n                            <button className='btn btn-ghost btn-sm' onClick={onSelectAll} disabled={isSelectAll}>\n                                {_('Select All')}\n                            </button>\n                            <button className='btn btn-ghost btn-sm' onClick={onDeselectAll}>\n                                {_('Clear')}\n                            </button>\n                        </div>\n                    )}\n                </div>\n            </div>\n        </div>\n    );\n};\n\nexport default LibraryHeader;\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;;;AAfA;;;;;;;;;;;;;AAwCA,MAAM,cAAc,CAAC;IACjB,OAAQ,CAAC,OAAO,EAAE,EAAE,WAAW;QAC3B,KAAK;YACD,OAAO;QACX,KAAK;YACD,OAAO;QACX,KAAK;YACD,OAAO;QACX,KAAK;YACD,OAAO;QACX,KAAK;YACD,OAAO;QACX,KAAK;YACD,OAAO;QACX,KAAK;YACD,OAAO;QACX,KAAK;YACD,OAAO;QACX,KAAK;YACD,OAAO;QACX,KAAK;YACD,OAAO;QACX;YACI,OAAO;IACf;AACJ;AAEA,MAAM,gBAA8C,CAAC,EACjD,YAAY,EACZ,WAAW,EACX,sBAAsB,EACtB,0BAA0B,EAC1B,oBAAoB,EACpB,kBAAkB,EAClB,WAAW,EACX,aAAa,EACb,gBAAgB,EACnB;;IACG,MAAM,IAAI,IAAA,6KAAc;IACxB,MAAM,EAAE,SAAS,EAAE,GAAG,IAAA,oKAAM;IAC5B,MAAM,EAAE,OAAO,EAAE,WAAW,EAAE,GAAG,IAAA,4KAAe;IAChD,MAAM,CAAC,gBAAgB,kBAAkB,GAAG,IAAA,2UAAQ,EAAC;IACrD,MAAM,CAAC,YAAY,cAAc,GAAG,IAAA,2UAAQ,EAAC;IAE7C,MAAM,kBAAkB;QACpB,IAAI,YAAY;QAChB,cAAc;QAEd,qKAAe,CAAC,QAAQ,CAAC,SAAS;YAC9B,MAAM;YACN,SAAS;YACT,SAAS,EAAE;QACf;QAEA,IAAI;YACA,MAAM,MAAM,MAAM,MAAM,qBAAqB;gBAAE,QAAQ;YAAO;YAC9D,IAAI,CAAC,IAAI,EAAE,EAAE;gBACT,MAAM,IAAI,MAAM,MAAM,IAAI,IAAI;YAClC;YACA,MAAM,OAAgD,MAAM,IAAI,IAAI;YAEpE,MAAM,WAAW,IAAI,IAAI,QAAQ,GAAG,CAAC,CAAC,IAAM;oBAAC,EAAE,IAAI;oBAAE;iBAAE;YACvD,MAAM,WAAmB,EAAE;YAC3B,MAAM,aAAqB,EAAE;YAC7B,MAAM,MAAM,KAAK,GAAG;YAEpB,KAAK,MAAM,WAAW,KAAK,KAAK,IAAI,EAAE,CAAE;gBACpC,MAAM,OAAO,QAAQ,IAAI,IAAI,QAAQ,YAAY;gBACjD,MAAM,UAAU,SAAS,GAAG,CAAC;gBAE7B,IAAI,SAAS;oBACT,IAAI,QAAQ,YAAY,KAAK,QAAQ,YAAY,EAAE;wBAC/C,MAAM,UAAgB;4BAClB,GAAG,OAAO;4BACV,cAAc,QAAQ,YAAY;4BAClC,WAAW,QAAQ,SAAS,IAAI;4BAChC,WAAW;wBACf;wBACA,MAAM,YAAY,IAAA,qKAAgB,EAAC;wBACnC,QAAQ,aAAa,GAAG,CAAC,2BAA2B,EAAE,mBAAmB,YAAY;wBACrF,WAAW,IAAI,CAAC;oBACpB;oBACA;gBACJ;gBAEA,MAAM,QAAQ,IAAA,oKAAe,EAAC,QAAQ,QAAQ;gBAC9C,MAAM,OAAa;oBACf;oBACA,QAAQ,YAAY,QAAQ,GAAG;oBAC/B;oBACA,aAAa;oBACb,QAAQ,EAAE;oBACV,WAAW,QAAQ,SAAS,IAAI;oBAChC,cAAc,QAAQ,YAAY;oBAClC,UAAU,QAAQ,QAAQ;oBAC1B,WAAW;oBACX,WAAW;oBACX,WAAW;gBACf;gBACA,MAAM,YAAY,IAAA,qKAAgB,EAAC;gBACnC,KAAK,aAAa,GAAG,CAAC,2BAA2B,EAAE,mBAAmB,YAAY;gBAClF,SAAS,IAAI,CAAC;YAClB;YAEA,MAAM,UAAU;mBAAI;mBAAa;aAAW;YAC5C,IAAI,QAAQ,MAAM,GAAG,GAAG;gBACpB,MAAM,YAAY,WAAW;YACjC;YAEA,qKAAe,CAAC,QAAQ,CAAC,SAAS;gBAC9B,MAAM;gBACN,SAAS;gBACT,SAAS,SAAS,MAAM,GAClB,EAAE,yCAAyC;oBAAE,OAAO,SAAS,MAAM;gBAAC,KACpE,EAAE;YACZ;QACJ,EAAE,OAAO,OAAY;YACjB,QAAQ,KAAK,CAAC,uBAAuB;YACrC,qKAAe,CAAC,QAAQ,CAAC,SAAS;gBAC9B,MAAM;gBACN,SAAS;gBACT,SAAS,EAAE,mCAAmC;oBAAE,OAAO,OAAO,WAAW;gBAAgB;YAC7F;QACJ,SAAU;YACN,cAAc;QAClB;IACJ;IAEA,qBACI,+VAAC;QAAI,WAAU;kBACX,cAAA,+VAAC;YAAI,WAAU;;8BACX,+VAAC;oBAAI,WAAU;;sCACX,+VAAC;4BAAG,WAAU;sCAAyB,EAAE;;;;;;sCACzC,+VAAC;4BACG,WAAU;4BACV,SAAS;4BACT,UAAU;;8CAEV,+VAAC,4OAAM;oCAAC,WAAW,IAAA,oMAAI,EAAC,cAAc;oCAAiB,MAAM;;;;;;gCAC5D,aAAa,EAAE,iBAAiB,EAAE;;;;;;;sCAEvC,+VAAC;4BACG,WAAU;4BACV,SAAS;;8CAET,+VAAC,yPAAmB;oCAAC,MAAM;;;;;;gCAC1B,EAAE;;;;;;;;;;;;;8BAIX,+VAAC;oBAAI,WAAU;;sCACX,+VAAC;4BAAI,WAAU;;8CACX,+VAAC;oCACG,WAAU;oCACV,SAAS,IAAM,kBAAkB,CAAC;;wCAEjC,EAAE;sDACH,+VAAC,oPAAa;4CAAC,MAAM;;;;;;;;;;;;gCAExB,gCACG,+VAAC,0LAAU;oCACP,mBAAmB;oCACnB,wBAAwB;oCACxB,4BAA4B;oCAC5B,sBAAsB;;;;;;;;;;;;sCAKlC,+VAAC;4BACG,WAAW,IAAA,oMAAI,EAAC,gDAAgD,gBAAgB;4BAChF,SAAS;;gCAER,6BAAe,+VAAC,wPAAkB;oCAAC,MAAM;;;;;6FAAS,+VAAC,iPAAW;oCAAC,MAAM;;;;;;gCACrE,eAAe,EAAE,iBAAiB,EAAE;;;;;;;wBAGxC,8BACG,+VAAC;4BAAI,WAAU;;8CACX,+VAAC;oCAAO,WAAU;oCAAuB,SAAS;oCAAa,UAAU;8CACpE,EAAE;;;;;;8CAEP,+VAAC;oCAAO,WAAU;oCAAuB,SAAS;8CAC7C,EAAE;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAQnC;GApKM;;QAWQ,6KAAc;QACF,oKAAM;QACK,4KAAe;;;KAb9C;uCAsKS"}},
    {"offset": {"line": 3183, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/app/library/components/ReadingProgress.tsx"],"sourcesContent":["'use client';\n\nimport type React from 'react';\nimport { memo, useMemo } from 'react';\nimport type { Book } from '@/types/book';\n\ninterface ReadingProgressProps {\n  book: Book;\n}\n\nconst getProgressPercentage = (book: Book) => {\n  if (!book.progress || !book.progress[1]) {\n    return null;\n  }\n  if (book.progress && book.progress[1] === 1) {\n    return 100;\n  }\n  const percentage = Math.round((book.progress[0] / book.progress[1]) * 100);\n  return Math.max(0, Math.min(100, percentage));\n};\n\nconst ReadingProgress: React.FC<ReadingProgressProps> = memo(\n  ({ book }) => {\n    const progressPercentage = useMemo(() => getProgressPercentage(book), [book]);\n\n    if (progressPercentage === null || Number.isNaN(progressPercentage)) {\n      return null;\n    }\n\n    return (\n      <div\n        className='text-neutral-content/70 flex justify-between text-xs'\n        role='status'\n        aria-label={`${progressPercentage}%`}\n      >\n        <span>{progressPercentage}%</span>\n      </div>\n    );\n  },\n  (prevProps, nextProps) => {\n    return (\n      prevProps.book.hash === nextProps.book.hash &&\n      prevProps.book.updatedAt === nextProps.book.updatedAt\n    );\n  },\n);\n\nReadingProgress.displayName = 'ReadingProgress';\n\nexport default ReadingProgress;\n"],"names":[],"mappings":";;;;;AAGA;;;AAHA;;AAUA,MAAM,wBAAwB,CAAC;IAC7B,IAAI,CAAC,KAAK,QAAQ,IAAI,CAAC,KAAK,QAAQ,CAAC,EAAE,EAAE;QACvC,OAAO;IACT;IACA,IAAI,KAAK,QAAQ,IAAI,KAAK,QAAQ,CAAC,EAAE,KAAK,GAAG;QAC3C,OAAO;IACT;IACA,MAAM,aAAa,KAAK,KAAK,CAAC,AAAC,KAAK,QAAQ,CAAC,EAAE,GAAG,KAAK,QAAQ,CAAC,EAAE,GAAI;IACtE,OAAO,KAAK,GAAG,CAAC,GAAG,KAAK,GAAG,CAAC,KAAK;AACnC;AAEA,MAAM,gCAAkD,GAAA,IAAA,uUAAI,UAC1D,CAAC,EAAE,IAAI,EAAE;;IACP,MAAM,qBAAqB,IAAA,0UAAO;uDAAC,IAAM,sBAAsB;sDAAO;QAAC;KAAK;IAE5E,IAAI,uBAAuB,QAAQ,OAAO,KAAK,CAAC,qBAAqB;QACnE,OAAO;IACT;IAEA,qBACE,+VAAC;QACC,WAAU;QACV,MAAK;QACL,cAAY,GAAG,mBAAmB,CAAC,CAAC;kBAEpC,cAAA,+VAAC;;gBAAM;gBAAmB;;;;;;;;;;;;AAGhC,oCACA,CAAC,WAAW;IACV,OACE,UAAU,IAAI,CAAC,IAAI,KAAK,UAAU,IAAI,CAAC,IAAI,IAC3C,UAAU,IAAI,CAAC,SAAS,KAAK,UAAU,IAAI,CAAC,SAAS;AAEzD;;AAGF,gBAAgB,WAAW,GAAG;uCAEf"}},
    {"offset": {"line": 3248, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/app/library/components/BookItem.tsx"],"sourcesContent":["'use client';\n\nimport clsx from 'clsx';\nimport { MdCheckCircle, MdCheckCircleOutline } from 'react-icons/md';\nimport {\n  LiaCloudUploadAltSolid,\n  LiaCloudDownloadAltSolid,\n  LiaInfoCircleSolid,\n} from 'react-icons/lia';\n\nimport { Book } from '@/types/book';\nimport { useEnv } from '@/context/EnvContext';\nimport { useAuth } from '@/context/AuthContext';\nimport { useRouter } from 'next/navigation';\nimport { useTranslation } from '@/hooks/useTranslation';\nimport { useResponsiveSize } from '@/hooks/useResponsiveSize';\nimport { LibraryCoverFitType, LibraryViewModeType } from '@/types/settings';\nimport { navigateToLogin } from '@/utils/nav';\nimport { formatAuthors, formatDescription } from '@/utils/book';\nimport ReadingProgress from './ReadingProgress';\nimport BookCover from '@/components/BookCover';\n\ninterface BookItemProps {\n  book: Book;\n  mode: LibraryViewModeType;\n  coverFit: LibraryCoverFitType;\n  isSelectMode: boolean;\n  bookSelected: boolean;\n  transferProgress: number | null;\n  handleBookUpload: (book: Book) => void;\n  handleBookDownload: (book: Book, options?: { redownload?: boolean; queued?: boolean }) => void;\n  showBookDetailsModal: (book: Book) => void;\n}\n\nconst BookItem: React.FC<BookItemProps> = ({\n  book,\n  mode,\n  coverFit,\n  isSelectMode,\n  bookSelected,\n  transferProgress,\n  handleBookUpload,\n  handleBookDownload,\n  showBookDetailsModal,\n}) => {\n  const _ = useTranslation();\n  const router = useRouter();\n  const { user } = useAuth();\n  const { appService } = useEnv();\n  const iconSize15 = useResponsiveSize(15);\n\n  return (\n    <div\n      role='none'\n      className={clsx(\n        'book-item flex',\n        mode === 'grid' && 'h-full flex-col justify-end',\n        mode === 'list' && 'h-28 flex-row gap-4 overflow-hidden',\n        mode === 'list' ? 'library-list-item' : 'library-grid-item',\n        appService?.hasContextMenu ? 'cursor-pointer' : '',\n      )}\n      onClick={(e) => e.stopPropagation()}\n    >\n      <div\n        className={clsx(\n          'bookitem-main relative flex aspect-[28/41] justify-center rounded',\n          coverFit === 'crop' && 'overflow-hidden shadow-md',\n          mode === 'grid' && 'items-end',\n          mode === 'list' && 'min-w-20 items-center',\n        )}\n      >\n        <BookCover\n          mode={mode}\n          book={book}\n          coverFit={coverFit}\n          showSpine={false}\n          imageClassName='rounded shadow-md'\n        />\n        {bookSelected && (\n          <div className='absolute inset-0 bg-black opacity-30 transition-opacity duration-300'></div>\n        )}\n        {isSelectMode && (\n          <div className='absolute bottom-1 right-1'>\n            {bookSelected ? (\n              <MdCheckCircle className='fill-blue-500' />\n            ) : (\n              <MdCheckCircleOutline className='fill-gray-300 drop-shadow-sm' />\n            )}\n          </div>\n        )}\n      </div>\n      <div\n        className={clsx(\n          'flex w-full flex-col p-0',\n          mode === 'grid' && 'pt-2',\n          mode === 'list' && 'gap-2 py-0',\n        )}\n      >\n        <div className={clsx('min-w-0 flex-1', mode === 'list' && 'flex flex-col gap-2')}>\n          <h4\n            className={clsx(\n              'overflow-hidden text-ellipsis font-semibold',\n              mode === 'grid' && 'block whitespace-nowrap text-[0.6em] text-xs',\n              mode === 'list' && 'line-clamp-2 text-base',\n            )}\n          >\n            {book.title}\n          </h4>\n          {mode === 'list' && (\n            <p className='text-neutral-content line-clamp-1 text-sm'>\n              {formatAuthors(book.author, book.primaryLanguage) || ''}\n            </p>\n          )}\n        </div>\n        {mode === 'list' && (\n          <h4 className='text-neutral-content line-clamp-1 text-sm'>\n            {formatDescription(book.metadata?.description)}\n          </h4>\n        )}\n        <div\n          className={clsx('flex items-center', book.progress ? 'justify-between' : 'justify-end')}\n          style={{\n            height: `${iconSize15}px`,\n            minHeight: `${iconSize15}px`,\n          }}\n        >\n          {book.progress && <ReadingProgress book={book} />}\n          <div className='flex items-center justify-center gap-x-2'>\n            {!appService?.isMobile && (\n              <button\n                aria-label={_('Show Book Details')}\n                className='show-detail-button -m-2 p-2 sm:opacity-0 sm:group-hover:opacity-100'\n                onPointerDown={(e) => e.stopPropagation()}\n                onClick={() => {\n                  showBookDetailsModal(book);\n                }}\n              >\n                <div className='pt-[2px] sm:pt-[1px]'>\n                  <LiaInfoCircleSolid size={iconSize15} />\n                </div>\n              </button>\n            )}\n            {transferProgress !== null ? (\n              transferProgress === 100 ? null : (\n                <div\n                  className='radial-progress'\n                  style={\n                    {\n                      '--value': transferProgress,\n                      '--size': `${iconSize15}px`,\n                      '--thickness': '2px',\n                    } as React.CSSProperties\n                  }\n                  role='progressbar'\n                ></div>\n              )\n            ) : (\n              (!book.uploadedAt || (book.uploadedAt && !book.downloadedAt)) && (\n                <button\n                  className='show-cloud-button -m-2 p-2'\n                  onPointerDown={(e) => e.stopPropagation()}\n                  onClick={() => {\n                    if (!user) {\n                      navigateToLogin(router);\n                      return;\n                    }\n                    if (!book.uploadedAt) {\n                      handleBookUpload(book);\n                    } else if (!book.downloadedAt) {\n                      handleBookDownload(book, { queued: true });\n                    }\n                  }}\n                >\n                  {!book.uploadedAt && <LiaCloudUploadAltSolid size={iconSize15} />}\n                  {book.uploadedAt && !book.downloadedAt && (\n                    <LiaCloudDownloadAltSolid size={iconSize15} />\n                  )}\n                </button>\n              )\n            )}\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default BookItem;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 3512, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/app/library/components/GroupItem.tsx"],"sourcesContent":["'use client';\n\nimport clsx from 'clsx';\nimport { useEffect, useRef, useState } from 'react';\nimport { MdCheckCircle, MdCheckCircleOutline, MdChevronRight, MdChevronLeft } from 'react-icons/md';\nimport { useEnv } from '@/context/EnvContext';\nimport { useResponsiveSize } from '@/hooks/useResponsiveSize';\nimport { BooksGroup } from '@/types/book';\nimport { LibraryViewModeType } from '@/types/settings';\nimport BookCover from '@/components/BookCover';\n\ninterface GroupItemProps {\n  mode: LibraryViewModeType;\n  group: BooksGroup;\n  isSelectMode: boolean;\n  groupSelected: boolean;\n}\n\nconst GroupItem: React.FC<GroupItemProps> = ({ mode, group, isSelectMode, groupSelected }) => {\n  const { appService } = useEnv();\n  const iconSize15 = useResponsiveSize(15);\n  const scrollContainerRef = useRef<HTMLDivElement>(null);\n  const [showLeftArrow, setShowLeftArrow] = useState(false);\n  const [showRightArrow, setShowRightArrow] = useState(false);\n\n  const checkScrollArrows = () => {\n    if (mode === 'list' && scrollContainerRef.current) {\n      const container = scrollContainerRef.current;\n      const hasOverflow = container.scrollWidth > container.clientWidth;\n\n      if (hasOverflow) {\n        const isAtStart = container.scrollLeft <= 5;\n        const isAtEnd = container.scrollLeft >= container.scrollWidth - container.clientWidth - 5;\n        setShowLeftArrow(!isAtStart);\n        setShowRightArrow(!isAtEnd);\n      } else {\n        setShowLeftArrow(false);\n        setShowRightArrow(false);\n      }\n    } else {\n      setShowLeftArrow(false);\n      setShowRightArrow(false);\n    }\n  };\n\n  useEffect(() => {\n    checkScrollArrows();\n    if (mode === 'list' && scrollContainerRef.current) {\n      const container = scrollContainerRef.current;\n      setTimeout(() => {\n        container.style.transform = 'translateZ(0)';\n        container.scrollLeft = 0;\n      }, 0);\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [mode, group.books.length, scrollContainerRef.current]);\n\n  const handleScroll = () => {\n    checkScrollArrows();\n  };\n\n  const scrollLeft = () => {\n    if (scrollContainerRef.current) {\n      const container = scrollContainerRef.current;\n      const scrollAmount = container.clientWidth * 0.5;\n      const currentScroll = container.scrollLeft;\n      const targetScroll = Math.max(0, currentScroll - scrollAmount);\n      container.scrollTo({ left: targetScroll, behavior: 'smooth' });\n    }\n  };\n\n  const scrollRight = () => {\n    if (scrollContainerRef.current) {\n      const container = scrollContainerRef.current;\n      const scrollAmount = container.clientWidth * 0.5;\n      const currentScroll = container.scrollLeft;\n      const maxScroll = container.scrollWidth - container.clientWidth;\n      const targetScroll = Math.min(maxScroll, currentScroll + scrollAmount);\n      container.scrollTo({ left: targetScroll, behavior: 'smooth' });\n    }\n  };\n\n  const stopEvent = (e: React.MouseEvent | React.TouchEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n  };\n\n  const handleLeftArrowClick = (e: React.MouseEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n    scrollLeft();\n  };\n\n  const handleRightArrowClick = (e: React.MouseEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n    scrollRight();\n  };\n\n  return (\n    <div className={clsx('group-item', appService?.hasContextMenu ? 'cursor-pointer' : '')}>\n      <div\n        className={clsx(\n          'groupitem-main relative flex overflow-hidden rounded',\n          mode === 'grid' && 'bg-base-100 aspect-[28/41] items-center justify-center shadow-md',\n          mode === 'list' && 'items-center justify-start gap-4 py-2',\n        )}\n      >\n        <div\n          className={clsx(\n            mode === 'grid' && 'flex h-full w-full p-2',\n            mode === 'list' && 'relative min-w-0 max-w-[85%]',\n          )}\n        >\n          <div\n            ref={mode === 'list' ? scrollContainerRef : undefined}\n            className={clsx(\n              mode === 'grid' && 'grid w-full grid-cols-2 grid-rows-2 gap-1 overflow-hidden',\n              mode === 'list' && 'flex h-28 gap-2 overflow-x-auto overflow-y-hidden',\n              mode === 'list' ? 'library-list-item' : 'library-grid-item',\n            )}\n            style={\n              mode === 'list'\n                ? {\n                    scrollbarWidth: 'none',\n                    msOverflowStyle: 'none',\n                    WebkitOverflowScrolling: 'touch',\n                    transform: 'translateZ(0)',\n                    willChange: 'scroll-position',\n                  }\n                : undefined\n            }\n            onScroll={mode === 'list' ? handleScroll : undefined}\n          >\n            {group.books.slice(0, mode === 'grid' ? 4 : undefined).map((book) => (\n              <div\n                key={book.hash}\n                className={clsx(\n                  'relative aspect-[28/41] h-full',\n                  mode === 'grid' && 'w-full',\n                  mode === 'list' && 'flex-shrink-0',\n                )}\n              >\n                <BookCover book={book} isPreview imageClassName='rounded-[2px]' />\n              </div>\n            ))}\n          </div>\n          {mode === 'list' && showLeftArrow && (\n            <div className='absolute left-[-0.5px] top-0 h-full w-12'>\n              <div className='from-base-200/85 via-base-200/20 absolute inset-0 bg-gradient-to-r to-transparent'></div>\n              <button\n                onClick={handleLeftArrowClick}\n                onPointerDown={(e) => stopEvent(e)}\n                onPointerUp={(e) => stopEvent(e)}\n                onPointerMove={(e) => stopEvent(e)}\n                onPointerCancel={(e) => stopEvent(e)}\n                onPointerLeave={(e) => stopEvent(e)}\n                className='absolute left-2 top-1/2 -translate-y-1/2 transition-all duration-200 hover:scale-110'\n              >\n                <div className='bg-base-100 border-base-content/10 hover:border-base-content/30 rounded-full border p-1 shadow-sm transition-colors duration-200'>\n                  <MdChevronLeft\n                    size={16}\n                    className='text-base-content/50 hover:text-base-content/70'\n                  />\n                </div>\n              </button>\n            </div>\n          )}\n          {mode === 'list' && showRightArrow && (\n            <div className='absolute right-[-0.5px] top-0 h-full w-12'>\n              <div className='from-base-200/85 via-base-200/20 absolute inset-0 bg-gradient-to-l to-transparent'></div>\n              <button\n                onClick={handleRightArrowClick}\n                onPointerDown={(e) => stopEvent(e)}\n                onPointerUp={(e) => stopEvent(e)}\n                onPointerMove={(e) => stopEvent(e)}\n                onPointerCancel={(e) => stopEvent(e)}\n                onPointerLeave={(e) => stopEvent(e)}\n                className='absolute right-2 top-1/2 -translate-y-1/2 transition-all duration-200 hover:scale-110'\n              >\n                <div className='bg-base-100 border-base-content/10 hover:border-base-content/30 rounded-full border p-1 shadow-sm transition-colors duration-200'>\n                  <MdChevronRight\n                    size={16}\n                    className='text-base-content/50 hover:text-base-content/70'\n                  />\n                </div>\n              </button>\n            </div>\n          )}\n        </div>\n        {mode === 'list' && (\n          <div className='text-base-content/75 w-28 min-w-24 max-w-40 overflow-hidden text-ellipsis text-base font-semibold'>\n            {group.displayName}\n          </div>\n        )}\n        {groupSelected && (\n          <div className='absolute inset-0 bg-black opacity-30 transition-opacity duration-300'></div>\n        )}\n        {isSelectMode && (\n          <div className='absolute bottom-1 right-1'>\n            {groupSelected ? (\n              <MdCheckCircle className='fill-blue-500' />\n            ) : (\n              <MdCheckCircleOutline className='fill-gray-300 drop-shadow-sm' />\n            )}\n          </div>\n        )}\n      </div>\n      {mode === 'grid' && (\n        <div className={clsx('flex w-full flex-col pt-2')}>\n          <div className='min-w-0 flex-1'>\n            <h4 className='block overflow-hidden text-ellipsis whitespace-nowrap text-xs font-semibold'>\n              {group.displayName}\n            </h4>\n          </div>\n          <div className='placeholder' style={{ height: `${iconSize15}px` }}></div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default GroupItem;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 3852, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/app/library/components/BookshelfItem.tsx"],"sourcesContent":["'use client';\n\nimport clsx from 'clsx';\nimport { useCallback } from 'react';\nimport { useRouter, useSearchParams } from 'next/navigation';\nimport { navigateToLibrary, navigateToReader, showReaderWindow } from '@/utils/nav';\nimport { useEnv } from '@/context/EnvContext';\nimport { useLibraryStore } from '@/store/libraryStore';\nimport { useSettingsStore } from '@/store/settingsStore';\nimport { useTranslation } from '@/hooks/useTranslation';\nimport { useLongPress } from '@/hooks/useLongPress';\nimport { Menu, MenuItem } from '@tauri-apps/api/menu';\nimport { revealItemInDir } from '@tauri-apps/plugin-opener';\nimport { eventDispatcher } from '@/utils/event';\nimport { getOSPlatform } from '@/utils/misc';\nimport { throttle } from '@/utils/throttle';\nimport { LibraryCoverFitType, LibraryViewModeType } from '@/types/settings';\nimport { BOOK_UNGROUPED_ID, BOOK_UNGROUPED_NAME } from '@/services/constants';\nimport { FILE_REVEAL_LABELS, FILE_REVEAL_PLATFORMS } from '@/utils/os';\nimport { Book, BooksGroup } from '@/types/book';\nimport { md5Fingerprint } from '@/utils/md5';\nimport BookItem from './BookItem';\nimport GroupItem from './GroupItem';\n\nexport const generateBookshelfItems = (\n  books: Book[],\n  parentGroupName: string,\n): (Book | BooksGroup)[] => {\n  const groups: BooksGroup[] = books.reduce((acc: BooksGroup[], book: Book) => {\n    if (book.deletedAt) return acc;\n    if (parentGroupName && (!book.groupName || !book.groupName.startsWith(parentGroupName)))\n      return acc;\n    book.groupId = book.groupId || BOOK_UNGROUPED_ID;\n    book.groupName = book.groupName || BOOK_UNGROUPED_NAME;\n    const slashIndex = book.groupName.indexOf('/', parentGroupName.length + 1);\n    const leafGroupName = book.groupName.substring(\n      parentGroupName ? parentGroupName.length + 1 : 0,\n      slashIndex > 0 ? slashIndex : undefined,\n    );\n    const fullGroupName = parentGroupName\n      ? `${parentGroupName}${leafGroupName ? `/${leafGroupName}` : ''}`\n      : leafGroupName;\n    const groupIndex = acc.findIndex(\n      (group) =>\n        group.name === fullGroupName ||\n        (parentGroupName && group.name === parentGroupName) ||\n        (leafGroupName === BOOK_UNGROUPED_NAME && group.name === BOOK_UNGROUPED_NAME),\n    );\n    const booksGroup = acc[groupIndex];\n    if (booksGroup) {\n      booksGroup.books.push(book);\n      booksGroup.updatedAt = Math.max(booksGroup.updatedAt, book.updatedAt);\n    } else {\n      const groupName = fullGroupName;\n      acc.push({\n        id: groupName === parentGroupName ? BOOK_UNGROUPED_ID : md5Fingerprint(groupName),\n        name: groupName === parentGroupName ? BOOK_UNGROUPED_NAME : groupName,\n        displayName: leafGroupName,\n        books: [book],\n        updatedAt: book.updatedAt,\n      });\n    }\n    return acc;\n  }, []);\n  groups.forEach((group) => {\n    group.books.sort((a, b) => b.updatedAt - a.updatedAt);\n  });\n  const ungroupedBooks: Book[] =\n    groups.find((group) => group.name === BOOK_UNGROUPED_NAME || group.name === parentGroupName)\n      ?.books || [];\n  const groupedBooks: BooksGroup[] = groups.filter(\n    (group) => group.name !== BOOK_UNGROUPED_NAME && group.name !== parentGroupName,\n  );\n  return [...ungroupedBooks, ...groupedBooks].sort((a, b) => b.updatedAt - a.updatedAt);\n};\n\ninterface BookshelfItemProps {\n  mode: LibraryViewModeType;\n  item: Book | BooksGroup;\n  coverFit: LibraryCoverFitType;\n  isSelectMode: boolean;\n  itemSelected: boolean;\n  transferProgress: number | null;\n  setLoading: React.Dispatch<React.SetStateAction<boolean>>;\n  toggleSelection: (hash: string) => void;\n  handleGroupBooks: () => void;\n  handleBookDownload: (\n    book: Book,\n    options?: { redownload?: boolean; queued?: boolean },\n  ) => Promise<boolean>;\n  handleBookUpload: (book: Book, syncBooks?: boolean) => Promise<boolean>;\n  handleBookDelete: (book: Book, syncBooks?: boolean) => Promise<boolean>;\n  handleSetSelectMode: (selectMode: boolean) => void;\n  handleShowDetailsBook: (book: Book) => void;\n}\n\nconst BookshelfItem: React.FC<BookshelfItemProps> = ({\n  mode,\n  item,\n  coverFit,\n  isSelectMode,\n  itemSelected,\n  transferProgress,\n  setLoading,\n  toggleSelection,\n  handleGroupBooks,\n  handleBookUpload,\n  handleBookDownload,\n  handleSetSelectMode,\n  handleShowDetailsBook,\n}) => {\n  const _ = useTranslation();\n  const router = useRouter();\n  const searchParams = useSearchParams();\n  const { envConfig, appService } = useEnv();\n  const { settings } = useSettingsStore();\n  const { updateBook } = useLibraryStore();\n\n  const showBookDetailsModal = useCallback(async (book: Book) => {\n    handleShowDetailsBook(book);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  const makeBookAvailable = async (book: Book) => {\n    if (book.uploadedAt && !book.downloadedAt) {\n      if (await appService?.isBookAvailable(book)) {\n        if (!book.downloadedAt || !book.coverDownloadedAt) {\n          book.downloadedAt = Date.now();\n          book.coverDownloadedAt = Date.now();\n          await updateBook(envConfig, book);\n        }\n        return true;\n      }\n      let available = false;\n      const loadingTimeout = setTimeout(() => setLoading(true), 200);\n      try {\n        available = await handleBookDownload(book, { queued: false });\n        await updateBook(envConfig, book);\n      } finally {\n        if (loadingTimeout) clearTimeout(loadingTimeout);\n        setLoading(false);\n        return available;\n      }\n    }\n    return true;\n  };\n\n  const handleBookClick = useCallback(\n    async (book: Book) => {\n      if (isSelectMode) {\n        toggleSelection(book.hash);\n      } else {\n        const available = await makeBookAvailable(book);\n        if (!available) return;\n        if (appService?.hasWindow && settings.openBookInNewWindow) {\n          showReaderWindow(appService, [book.hash]);\n        } else {\n          setTimeout(() => {\n            navigateToReader(router, [book.hash]);\n          }, 0);\n        }\n      }\n    },\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    [isSelectMode, settings.openBookInNewWindow, appService],\n  );\n\n  const handleGroupClick = useCallback(\n    (group: BooksGroup) => {\n      if (isSelectMode) {\n        toggleSelection(group.id);\n      } else {\n        const params = new URLSearchParams(searchParams?.toString());\n        params.set('group', group.id);\n        setTimeout(() => {\n          navigateToLibrary(router, `${params.toString()}`);\n        }, 0);\n      }\n    },\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    [isSelectMode, searchParams],\n  );\n\n  const bookContextMenuHandler = async (book: Book) => {\n    if (!appService?.hasContextMenu) return;\n    const osPlatform = getOSPlatform();\n    const fileRevealLabel =\n      FILE_REVEAL_LABELS[osPlatform as FILE_REVEAL_PLATFORMS] || FILE_REVEAL_LABELS.default;\n    const selectBookMenuItem = await MenuItem.new({\n      text: itemSelected ? _('Deselect Book') : _('Select Book'),\n      action: async () => {\n        if (!isSelectMode) handleSetSelectMode(true);\n        toggleSelection(book.hash);\n      },\n    });\n    const groupBooksMenuItem = await MenuItem.new({\n      text: _('Group Books'),\n      action: async () => {\n        if (!isSelectMode) handleSetSelectMode(true);\n        if (!itemSelected) {\n          toggleSelection(book.hash);\n        }\n        handleGroupBooks();\n      },\n    });\n    const showBookInFinderMenuItem = await MenuItem.new({\n      text: _(fileRevealLabel),\n      action: async () => {\n        // Use relativePath for flat structure, fallback to directory of the book file\n        const folder = book.relativePath\n          ? `${settings.localBooksDir}/${book.relativePath.replace(/\\/[^/]+$/, '')}`\n          : settings.localBooksDir;\n        revealItemInDir(folder);\n      },\n    });\n    const showBookDetailsMenuItem = await MenuItem.new({\n      text: _('Show Book Details'),\n      action: async () => {\n        showBookDetailsModal(book);\n      },\n    });\n    // Cloud upload/download functionality removed - using local server storage only\n    // const downloadBookMenuItem = await MenuItem.new({\n    //   text: _('Download Book'),\n    //   action: async () => {\n    //     handleBookDownload(book, { queued: true });\n    //   },\n    // });\n    // const uploadBookMenuItem = await MenuItem.new({\n    //   text: _('Upload Book'),\n    //   action: async () => {\n    //     handleBookUpload(book);\n    //   },\n    // });\n    const deleteBookMenuItem = await MenuItem.new({\n      text: _('Delete'),\n      action: async () => {\n        eventDispatcher.dispatch('delete-books', { ids: [book.hash] });\n      },\n    });\n    const menu = await Menu.new();\n    menu.append(selectBookMenuItem);\n    menu.append(groupBooksMenuItem);\n    menu.append(showBookDetailsMenuItem);\n    menu.append(showBookInFinderMenuItem);\n    // Cloud storage menu items removed\n    // if (book.uploadedAt && !book.downloadedAt) {\n    //   menu.append(downloadBookMenuItem);\n    // }\n    // if (!book.uploadedAt && book.downloadedAt) {\n    //   menu.append(uploadBookMenuItem);\n    // }\n    menu.append(deleteBookMenuItem);\n    menu.popup();\n  };\n\n  const groupContextMenuHandler = async (group: BooksGroup) => {\n    if (!appService?.hasContextMenu) return;\n    const selectGroupMenuItem = await MenuItem.new({\n      text: itemSelected ? _('Deselect Group') : _('Select Group'),\n      action: async () => {\n        if (!isSelectMode) handleSetSelectMode(true);\n        toggleSelection(group.id);\n      },\n    });\n    const groupBooksMenuItem = await MenuItem.new({\n      text: _('Group Books'),\n      action: async () => {\n        if (!isSelectMode) handleSetSelectMode(true);\n        if (!itemSelected) {\n          toggleSelection(group.id);\n        }\n        handleGroupBooks();\n      },\n    });\n    const deleteGroupMenuItem = await MenuItem.new({\n      text: _('Delete'),\n      action: async () => {\n        eventDispatcher.dispatch('delete-books', { ids: [group.id] });\n      },\n    });\n    const menu = await Menu.new();\n    menu.append(selectGroupMenuItem);\n    menu.append(groupBooksMenuItem);\n    menu.append(deleteGroupMenuItem);\n    menu.popup();\n  };\n\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  const handleSelectItem = useCallback(\n    throttle(() => {\n      if (!isSelectMode) {\n        handleSetSelectMode(true);\n      }\n      if ('format' in item) {\n        toggleSelection((item as Book).hash);\n      } else {\n        toggleSelection((item as BooksGroup).id);\n      }\n    }, 100),\n    [isSelectMode],\n  );\n\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  const handleOpenItem = useCallback(\n    throttle(() => {\n      if (isSelectMode) {\n        handleSelectItem();\n        return;\n      }\n      if ('format' in item) {\n        handleBookClick(item as Book);\n      } else {\n        handleGroupClick(item as BooksGroup);\n      }\n    }, 100),\n    [handleSelectItem, handleBookClick, handleGroupClick],\n  );\n\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  const handleContextMenu = useCallback(\n    throttle(() => {\n      if ('format' in item) {\n        bookContextMenuHandler(item as Book);\n      } else {\n        groupContextMenuHandler(item as BooksGroup);\n      }\n    }, 100),\n    [itemSelected, settings.localBooksDir],\n  );\n\n  const { pressing, handlers } = useLongPress(\n    {\n      onLongPress: () => {\n        handleSelectItem();\n      },\n      onTap: () => {\n        handleOpenItem();\n      },\n      onContextMenu: () => {\n        if (appService?.hasContextMenu) {\n          handleContextMenu();\n        } else if (appService?.isAndroidApp) {\n          handleSelectItem();\n        }\n      },\n    },\n    [isSelectMode, handleSelectItem, handleOpenItem, handleContextMenu],\n  );\n\n  const handleKeyDown = (e: React.KeyboardEvent) => {\n    if (e.key === 'Enter' || e.key === ' ') {\n      e.preventDefault();\n      handleOpenItem();\n    }\n    if (e.key === 'ContextMenu' || (e.shiftKey && e.key === 'F10')) {\n      e.preventDefault();\n      handleContextMenu();\n    }\n  };\n\n  return (\n    <div className={clsx(mode === 'list' && 'sm:hover:bg-base-300/50 px-4 sm:px-6')}>\n      <div\n        className={clsx(\n          'visible-focus-inset-2 group',\n          mode === 'grid' &&\n          'sm:hover:bg-base-300/50 flex h-full flex-col px-0 py-2 sm:px-4 sm:py-4',\n          mode === 'list' && 'border-base-300 flex flex-col border-b py-2',\n          appService?.isMobileApp && 'no-context-menu',\n          pressing && mode === 'grid' ? 'not-eink:scale-95' : 'scale-100',\n        )}\n        role='button'\n        tabIndex={0}\n        aria-label={'format' in item ? item.title : item.name}\n        style={{\n          transition: 'transform 0.2s',\n        }}\n        onKeyDown={handleKeyDown}\n        {...handlers}\n      >\n        <div className='flex h-full flex-col justify-end'>\n          {'format' in item ? (\n            <BookItem\n              mode={mode}\n              book={item}\n              coverFit={coverFit}\n              isSelectMode={isSelectMode}\n              bookSelected={itemSelected}\n              transferProgress={transferProgress}\n              handleBookUpload={handleBookUpload}\n              handleBookDownload={handleBookDownload}\n              showBookDetailsModal={showBookDetailsModal}\n            />\n          ) : (\n            <GroupItem\n              mode={mode}\n              group={item}\n              isSelectMode={isSelectMode}\n              groupSelected={itemSelected}\n            />\n          )}\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default BookshelfItem;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 4292, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/app/library/components/SelectModeActions.tsx"],"sourcesContent":["import clsx from 'clsx';\nimport { MdDelete, MdOpenInNew, MdOutlineCancel, MdInfoOutline } from 'react-icons/md';\nimport { LuFolderPlus } from 'react-icons/lu';\nimport { useKeyDownActions } from '@/hooks/useKeyDownActions';\nimport { useTranslation } from '@/hooks/useTranslation';\nimport { isMd5 } from '@/utils/md5';\n\ninterface SelectModeActionsProps {\n  selectedBooks: string[];\n  safeAreaBottom: number;\n  onOpen: () => void;\n  onGroup: () => void;\n  onDetails: () => void;\n  onDelete: () => void;\n  onCancel: () => void;\n}\n\nconst SelectModeActions: React.FC<SelectModeActionsProps> = ({\n  selectedBooks,\n  safeAreaBottom,\n  onOpen,\n  onGroup,\n  onDetails,\n  onDelete,\n  onCancel,\n}) => {\n  const _ = useTranslation();\n\n  const hasSelection = selectedBooks.length > 0;\n  const hasValidBooks = selectedBooks.every((id) => isMd5(id));\n  const hasSingleSelection = selectedBooks.length === 1;\n  const divRef = useKeyDownActions({ onCancel });\n\n  return (\n    <div\n      ref={divRef}\n      className='fixed bottom-0 left-0 right-0 z-40'\n      style={{\n        paddingBottom: `${safeAreaBottom + 16}px`,\n      }}\n    >\n      <div\n        className={clsx(\n          'text-base-content flex items-center justify-center text-xs shadow-lg',\n          'not-eink:bg-base-300 eink:bg-base-100 eink:border eink:border-base-content',\n          'mx-auto w-fit space-x-6 rounded-lg p-4',\n        )}\n      >\n        <button\n          onClick={onOpen}\n          className={clsx(\n            'flex flex-col items-center justify-center gap-1',\n            (!hasSelection || !hasValidBooks) && 'btn-disabled opacity-50',\n          )}\n        >\n          <MdOpenInNew />\n          <div>{_('Open')}</div>\n        </button>\n        <button\n          onClick={onGroup}\n          className={clsx(\n            'flex flex-col items-center justify-center gap-1',\n            !hasSelection && 'btn-disabled opacity-50',\n          )}\n        >\n          <LuFolderPlus />\n          <div>{_('Group')}</div>\n        </button>\n        <button\n          onClick={onDetails}\n          className={clsx(\n            'flex flex-col items-center justify-center gap-1',\n            (!hasSingleSelection || !hasValidBooks) && 'btn-disabled opacity-50',\n          )}\n        >\n          <MdInfoOutline />\n          <div>{_('Details')}</div>\n        </button>\n        <button\n          onClick={onDelete}\n          className={clsx(\n            'flex flex-col items-center justify-center gap-1',\n            !hasSelection && 'btn-disabled opacity-50',\n          )}\n        >\n          <MdDelete className='text-red-500' />\n          <div className='text-red-500'>{_('Delete')}</div>\n        </button>\n        <button onClick={onCancel} className='flex flex-col items-center justify-center gap-1'>\n          <MdOutlineCancel />\n          <div>{_('Cancel')}</div>\n        </button>\n      </div>\n    </div>\n  );\n};\n\nexport default SelectModeActions;\n"],"names":[],"mappings":";;;;;AAAA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;AAYA,MAAM,oBAAsD,CAAC,EAC3D,aAAa,EACb,cAAc,EACd,MAAM,EACN,OAAO,EACP,SAAS,EACT,QAAQ,EACR,QAAQ,EACT;;IACC,MAAM,IAAI,IAAA,6KAAc;IAExB,MAAM,eAAe,cAAc,MAAM,GAAG;IAC5C,MAAM,gBAAgB,cAAc,KAAK,CAAC,CAAC,KAAO,IAAA,yKAAK,EAAC;IACxD,MAAM,qBAAqB,cAAc,MAAM,KAAK;IACpD,MAAM,SAAS,IAAA,mLAAiB,EAAC;QAAE;IAAS;IAE5C,qBACE,+VAAC;QACC,KAAK;QACL,WAAU;QACV,OAAO;YACL,eAAe,GAAG,iBAAiB,GAAG,EAAE,CAAC;QAC3C;kBAEA,cAAA,+VAAC;YACC,WAAW,IAAA,oMAAI,EACb,wEACA,8EACA;;8BAGF,+VAAC;oBACC,SAAS;oBACT,WAAW,IAAA,oMAAI,EACb,mDACA,CAAC,CAAC,gBAAgB,CAAC,aAAa,KAAK;;sCAGvC,+VAAC,iPAAW;;;;;sCACZ,+VAAC;sCAAK,EAAE;;;;;;;;;;;;8BAEV,+VAAC;oBACC,SAAS;oBACT,WAAW,IAAA,oMAAI,EACb,mDACA,CAAC,gBAAgB;;sCAGnB,+VAAC,kPAAY;;;;;sCACb,+VAAC;sCAAK,EAAE;;;;;;;;;;;;8BAEV,+VAAC;oBACC,SAAS;oBACT,WAAW,IAAA,oMAAI,EACb,mDACA,CAAC,CAAC,sBAAsB,CAAC,aAAa,KAAK;;sCAG7C,+VAAC,mPAAa;;;;;sCACd,+VAAC;sCAAK,EAAE;;;;;;;;;;;;8BAEV,+VAAC;oBACC,SAAS;oBACT,WAAW,IAAA,oMAAI,EACb,mDACA,CAAC,gBAAgB;;sCAGnB,+VAAC,8OAAQ;4BAAC,WAAU;;;;;;sCACpB,+VAAC;4BAAI,WAAU;sCAAgB,EAAE;;;;;;;;;;;;8BAEnC,+VAAC;oBAAO,SAAS;oBAAU,WAAU;;sCACnC,+VAAC,qPAAe;;;;;sCAChB,+VAAC;sCAAK,EAAE;;;;;;;;;;;;;;;;;;;;;;;AAKlB;GA9EM;;QASM,6KAAc;QAKT,mLAAiB;;;KAd5B;uCAgFS"}},
    {"offset": {"line": 4471, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/app/library/components/GroupingModal.tsx"],"sourcesContent":["'use client';\n\nimport clsx from 'clsx';\nimport React, { useEffect, useRef, useState } from 'react';\nimport { MdCheck, MdChevronRight, MdEdit } from 'react-icons/md';\nimport { HiOutlineFolder, HiOutlineFolderAdd, HiOutlineFolderRemove } from 'react-icons/hi';\nimport { IoMdArrowBack } from 'react-icons/io';\n\nimport { Book, BookGroupType } from '@/types/book';\nimport { isMd5 } from '@/utils/md5';\nimport { useEnv } from '@/context/EnvContext';\nimport { useTranslation } from '@/hooks/useTranslation';\nimport { useLibraryStore } from '@/store/libraryStore';\nimport { useResponsiveSize } from '@/hooks/useResponsiveSize';\nimport { useKeyDownActions } from '@/hooks/useKeyDownActions';\nimport { BOOK_UNGROUPED_ID, BOOK_UNGROUPED_NAME } from '@/services/constants';\nimport { getBreadcrumbs } from '../utils/libraryUtils';\n\ninterface GroupingModalProps {\n  libraryBooks: Book[];\n  selectedBooks: string[];\n  parentGroupName: string;\n  onCancel: () => void;\n  onConfirm: () => void;\n}\n\nconst GroupingModal: React.FC<GroupingModalProps> = ({\n  libraryBooks,\n  selectedBooks,\n  parentGroupName,\n  onCancel,\n  onConfirm,\n}) => {\n  const _ = useTranslation();\n  const { appService } = useEnv();\n  const {\n    setLibrary,\n    addGroup,\n    getGroups,\n    getGroupId,\n    getGroupsByParent,\n    getParentPath,\n    refreshGroups,\n  } = useLibraryStore();\n\n  const [currentPath, setCurrentPath] = useState<string | undefined>(undefined);\n  const [showInput, setShowInput] = useState(false);\n  const [editGroupName, setEditGroupName] = useState('');\n  const [selectedGroup, setSelectedGroup] = useState<BookGroupType | null>(null);\n  const [newGroup, setNewGroup] = useState<BookGroupType | null>(null);\n  const [isRenaming, setIsRenaming] = useState(false);\n  const [originalGroupName, setOriginalGroupName] = useState<string | null>(null);\n\n  const divRef = useKeyDownActions({ onCancel, onConfirm });\n  const editorRef = useRef<HTMLInputElement>(null);\n  const iconSize = useResponsiveSize(16);\n\n  const allGroups = getGroups();\n  const currentGroups = getGroupsByParent(currentPath);\n  const currentGroupsList =\n    newGroup &&\n      !currentGroups.some((g) => g.id === newGroup.id) &&\n      !currentGroups.some((g) => newGroup.name.startsWith(g.name))\n      ? [newGroup, ...currentGroups]\n      : currentGroups;\n\n  const isSelectedBooksHasGroup =\n    selectedBooks.some((hash) => !isMd5(hash)) ||\n    selectedBooks\n      .map((hash) => libraryBooks.find((book) => book.hash === hash)?.groupId)\n      .some((group) => group && group !== BOOK_UNGROUPED_NAME);\n\n  const canRenameGroup = selectedBooks.length === 1 && selectedBooks.every((id) => !isMd5(id));\n  const currentGroupForRename = canRenameGroup\n    ? allGroups.find((group) => group.id === selectedBooks[0])\n    : null;\n\n  const generateNextUntitledGroupName = () => {\n    const baseName = _('Untitled Group');\n    const basePattern = parentGroupName\n      ? `${parentGroupName}/${baseName}`\n      : currentPath\n        ? `${currentPath}/${baseName}`\n        : baseName;\n\n    const escapedPattern = basePattern.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&');\n    const untitledGroupPattern = new RegExp(`^${escapedPattern}\\\\s*(\\\\d+)?$`);\n\n    const untitledGroupNumbers = allGroups\n      .map((group) => {\n        const match = group.name.match(untitledGroupPattern);\n        return match ? parseInt(match[1] || '1', 10) : null;\n      })\n      .filter((num) => num !== null) as number[];\n\n    const nextNumber = untitledGroupNumbers.length > 0 ? Math.max(...untitledGroupNumbers) + 1 : 1;\n\n    return `${basePattern} ${nextNumber}`;\n  };\n\n  const handleCreateGroup = () => {\n    const nextName = generateNextUntitledGroupName();\n    setEditGroupName(nextName);\n    setShowInput(true);\n    setIsRenaming(false);\n    setOriginalGroupName(null);\n    setSelectedGroup(null);\n  };\n\n  const handleRenameGroup = () => {\n    if (!currentGroupForRename) return;\n\n    setEditGroupName(currentGroupForRename.name);\n    setOriginalGroupName(currentGroupForRename.name);\n    setShowInput(true);\n    setIsRenaming(true);\n  };\n\n  const handleRemoveFromGroup = () => {\n    selectedBooks.forEach((id) => {\n      for (const book of libraryBooks.filter((book) => book.hash === id || book.groupId === id)) {\n        if (\n          book &&\n          book.groupId &&\n          book.groupName &&\n          book.groupId !== BOOK_UNGROUPED_ID &&\n          book.groupName !== BOOK_UNGROUPED_NAME\n        ) {\n          book.groupId = undefined;\n          book.groupName = undefined;\n          book.updatedAt = Date.now();\n        }\n      }\n    });\n    setLibrary([...libraryBooks]);\n    appService?.saveLibraryBooks(libraryBooks);\n    onConfirm();\n  };\n\n  const handleConfirmCreateGroup = () => {\n    let groupName = editGroupName.trim();\n    if (groupName) {\n      if (isRenaming && originalGroupName) {\n        // Renaming existing group\n        const oldGroupName = originalGroupName;\n\n        // Update the group name for all books in this group and nested groups\n        libraryBooks.forEach((book) => {\n          if (book.groupName === oldGroupName) {\n            const newGroupName = groupName;\n\n            // Âú®Êú¨Âú∞Â≠òÂÇ®Ê®°Âºè‰∏ãÔºåÁßªÂä®Êñá‰ª∂‰ª•ÂåπÈÖçÊñ∞ÁöÑÂàÜÁªÑÂêç\n            if (book.relativePath && appService?.reclassifyBook) {\n              appService.reclassifyBook(book, newGroupName, oldGroupName).catch((error) => {\n                console.error('Failed to reclassify book files during rename:', error);\n              });\n            }\n\n            book.groupName = newGroupName;\n            book.groupId = getGroupId(book.groupName);\n            book.updatedAt = Date.now();\n          } else if (book.groupName?.startsWith(oldGroupName + '/')) {\n            const newGroupName = book.groupName.replace(oldGroupName, groupName);\n\n            // Âú®Êú¨Âú∞Â≠òÂÇ®Ê®°Âºè‰∏ãÔºåÁßªÂä®Êñá‰ª∂‰ª•ÂåπÈÖçÊñ∞ÁöÑÂàÜÁªÑ\n            if (book.relativePath && appService?.reclassifyBook) {\n              appService.reclassifyBook(book, newGroupName, book.groupName).catch((error) => {\n                console.error('Failed to reclassify book files during rename:', error);\n              });\n            }\n\n            book.groupName = newGroupName;\n            book.groupId = getGroupId(book.groupName);\n            book.updatedAt = Date.now();\n          }\n        });\n\n        setLibrary([...libraryBooks]);\n        appService?.saveLibraryBooks(libraryBooks);\n\n        refreshGroups();\n        setShowInput(false);\n        setIsRenaming(false);\n        setOriginalGroupName(null);\n      } else {\n        // Creating new group\n        if (currentPath && !groupName.startsWith(currentPath + '/')) {\n          groupName = `${currentPath}/${groupName}`;\n        }\n\n        const newGroup = addGroup(groupName);\n        setNewGroup(newGroup);\n        setSelectedGroup(newGroup);\n        setShowInput(false);\n        const parentGroup = getParentPath(groupName);\n        if (parentGroup) {\n          setCurrentPath(parentGroup);\n        }\n      }\n    }\n  };\n\n  const handleToggleSelectGroup = (group: BookGroupType) => {\n    setSelectedGroup((prevGroup) => (prevGroup?.id === group.id ? null : group));\n  };\n\n  const handleNavigateToGroup = (group: BookGroupType) => {\n    setCurrentPath(group.name);\n  };\n\n  const handleNavigateBack = () => {\n    const parent = currentPath ? getParentPath(currentPath) : undefined;\n    setCurrentPath(parent);\n  };\n\n  const handleNavigateToPath = (path: string | undefined) => {\n    setCurrentPath(path);\n  };\n\n  const handleConfirmGrouping = async () => {\n    selectedBooks.forEach((id) => {\n      for (const book of libraryBooks.filter((book) => book.hash === id || book.groupId === id)) {\n        if (book && selectedGroup) {\n          const oldGroupName = book.groupName;\n          book.groupId = selectedGroup.id;\n          book.groupName = selectedGroup.name;\n          book.updatedAt = Date.now();\n\n          // Âú®Êú¨Âú∞Â≠òÂÇ®Ê®°Âºè‰∏ãÔºåÁßªÂä®Êñá‰ª∂‰ª•ÂåπÈÖçÊñ∞ÁöÑÂàÜÁªÑ\n          if (book.relativePath && appService?.reclassifyBook) {\n            appService.reclassifyBook(book, selectedGroup.name, oldGroupName).catch((error) => {\n              console.error('Failed to reclassify book files:', error);\n              // ‰∏ç‰∏≠Êñ≠ÊµÅÁ®ãÔºåÁªßÁª≠‰øùÂ≠òÂÖÉÊï∞ÊçÆ\n            });\n          }\n        }\n      }\n    });\n    setLibrary([...libraryBooks]);\n    appService?.saveLibraryBooks(libraryBooks);\n    onConfirm();\n  };\n\n  const getDisplayName = (fullPath: string) => {\n    const segments = fullPath.split('/');\n    return segments[segments.length - 1];\n  };\n\n  useEffect(() => {\n    if (editorRef.current) {\n      editorRef.current.select();\n    }\n  }, [showInput]);\n\n  useEffect(() => {\n    refreshGroups();\n  }, [refreshGroups]);\n\n  useEffect(() => {\n    const groupIds = selectedBooks\n      .map((id) => libraryBooks.find((book) => book.hash === id || book.groupId === id)?.groupId)\n      .filter((groupId) => groupId);\n    if (Array.from(new Set(groupIds)).length === 1) {\n      setTimeout(() => {\n        const allGroups = getGroups();\n        const group = allGroups.find((group) => group.id === groupIds[0]);\n        setSelectedGroup(group || null);\n        if (group && !currentPath) {\n          const parent = getParentPath(group.name);\n          setCurrentPath(parent);\n        }\n      }, 0);\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  return (\n    <div className='fixed inset-0 flex items-center justify-center'>\n      <div\n        ref={divRef}\n        className={clsx(\n          'modal-box bg-base-100 overflow-y-auto rounded-2xl shadow-xl',\n          'max-h-[85%] w-[95%] min-w-64 max-w-[440px] p-6 sm:w-[70%]',\n        )}\n      >\n        <h2 className='text-center text-lg font-bold'>{_('Group Books')}</h2>\n\n        {/* Action buttons */}\n        <div className={clsx('mt-4 grid grid-cols-1 gap-2 text-base md:grid-cols-2')}>\n          <button\n            onClick={handleRemoveFromGroup}\n            className='flex items-center space-x-2 p-2 text-blue-500 disabled:text-gray-400'\n            disabled={!isSelectedBooksHasGroup}\n          >\n            <HiOutlineFolderRemove size={iconSize} />\n            <span className='truncate'>{_('Remove From Group')}</span>\n          </button>\n          <button\n            onClick={handleCreateGroup}\n            className='flex items-center space-x-2 p-2 text-blue-500 disabled:text-gray-400'\n          >\n            <HiOutlineFolderAdd size={iconSize} />\n            <span className='truncate'>{_('Create New Group')}</span>\n          </button>\n          <button\n            onClick={handleRenameGroup}\n            className='flex items-center space-x-2 p-2 text-blue-500 disabled:text-gray-400'\n            disabled={!canRenameGroup}\n          >\n            <MdEdit size={iconSize} />\n            <span className='truncate'>{_('Rename Group')}</span>\n          </button>\n        </div>\n\n        {/* Create/Rename group input */}\n        {showInput && (\n          <div className='mt-4 space-y-2'>\n            <div className='flex items-center gap-2'>\n              <input\n                type='text'\n                ref={editorRef}\n                value={editGroupName}\n                onChange={(e) => setEditGroupName(e.target.value)}\n                onKeyDown={(e) => {\n                  if (e.key === 'Enter') handleConfirmCreateGroup();\n                  if (e.key === 'Escape') {\n                    setShowInput(false);\n                    setIsRenaming(false);\n                    setOriginalGroupName(null);\n                  }\n                  e.stopPropagation();\n                }}\n                className='input input-ghost w-full border-0 px-2 text-base !outline-none sm:text-sm'\n              />\n              <button\n                className={clsx(\n                  'btn btn-ghost settings-content hover:bg-transparent',\n                  'flex h-[1.3em] min-h-[1.3em] items-end p-0',\n                  editGroupName ? '' : 'btn-disabled !bg-opacity-0',\n                )}\n                onClick={() => handleConfirmCreateGroup()}\n              >\n                <div className='pr-1 align-bottom text-base text-blue-500 sm:text-sm'>\n                  {_('Save')}\n                </div>\n              </button>\n            </div>\n          </div>\n        )}\n\n        {/* Breadcrumb navigation */}\n        {currentPath && (\n          <div className='mt-4 flex flex-wrap items-center gap-2 text-base'>\n            <button\n              onClick={handleNavigateBack}\n              className='hover:bg-base-300 flex items-center gap-1 rounded px-2 py-1'\n            >\n              <IoMdArrowBack size={iconSize} />\n            </button>\n            <button\n              onClick={() => handleNavigateToPath(undefined)}\n              className='hover:bg-base-300 rounded px-2 py-1'\n            >\n              {_('All')}\n            </button>\n            {getBreadcrumbs(currentPath).map((crumb, index, array) => {\n              const isLast = index === array.length - 1;\n              return (\n                <React.Fragment key={index}>\n                  <MdChevronRight size={iconSize} className='text-neutral-content' />\n                  {isLast ? (\n                    <span className='truncate rounded px-2 py-1'>{crumb.name}</span>\n                  ) : (\n                    <button\n                      onClick={() => handleNavigateToPath(crumb.path)}\n                      className='hover:bg-base-300 truncate rounded px-2 py-1'\n                    >\n                      {crumb.name}\n                    </button>\n                  )}\n                </React.Fragment>\n              );\n            })}\n          </div>\n        )}\n\n        {/* Groups list */}\n        <ul className='groups-list mt-4 grid grid-cols-2 gap-2 overflow-x-hidden'>\n          {currentGroupsList.map((group, index) => {\n            const displayName = getDisplayName(group.name);\n            const hasChildren = allGroups.some((g) => g.name.startsWith(group.name + '/'));\n            return (\n              <div key={index} className='flex min-w-0 gap-1'>\n                <button\n                  className={clsx(\n                    'hover:bg-base-300 text-base-content flex min-w-0 max-w-[90%] flex-1',\n                    'items-center justify-between gap-2 rounded-md px-2 py-2',\n                  )}\n                  onClick={() => handleToggleSelectGroup(group)}\n                >\n                  <div className='flex min-w-0 flex-1 items-center gap-2'>\n                    <span className='shrink-0'>\n                      <HiOutlineFolder size={iconSize} />\n                    </span>\n                    <span className='min-w-0 truncate text-base sm:text-sm'>{displayName}</span>\n                  </div>\n                  <span className='text-neutral-content flex shrink-0 text-sm'>\n                    {selectedGroup && selectedGroup.id === group.id && (\n                      <MdCheck className='fill-blue-500' size={iconSize} />\n                    )}\n                  </span>\n                </button>\n                {hasChildren && (\n                  <button\n                    onClick={() => handleNavigateToGroup(group)}\n                    className='hover:bg-base-300 flex shrink-0 items-center rounded-md px-1'\n                  >\n                    <MdChevronRight size={iconSize} />\n                  </button>\n                )}\n              </div>\n            );\n          })}\n        </ul>\n\n        {/* Footer actions */}\n        <div className='mt-6 flex justify-end gap-x-8 p-2'>\n          <button onClick={onCancel} className='flex items-center'>\n            {_('Cancel')}\n          </button>\n          <button\n            onClick={handleConfirmGrouping}\n            className={clsx(\n              'flex items-center text-blue-500',\n              !selectedGroup && 'btn-disabled opacity-50',\n            )}\n          >\n            {_('Confirm')}\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default GroupingModal;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 5085, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/app/library/components/Bookshelf.tsx"],"sourcesContent":["'use client';\n\nimport clsx from 'clsx';\nimport * as React from 'react';\nimport { useRouter, useSearchParams } from 'next/navigation';\nimport { useCallback, useEffect, useMemo, useRef, useState } from 'react';\nimport { PiPlus } from 'react-icons/pi';\nimport { Book } from '@/types/book';\nimport { LibraryCoverFitType, LibraryViewModeType } from '@/types/settings';\nimport { useEnv } from '@/context/EnvContext';\nimport { useThemeStore } from '@/store/themeStore';\nimport { useAutoFocus } from '@/hooks/useAutoFocus';\nimport { useSettingsStore } from '@/store/settingsStore';\nimport { useLibraryStore } from '@/store/libraryStore';\nimport { useTranslation } from '@/hooks/useTranslation';\nimport { useResponsiveSize } from '@/hooks/useResponsiveSize';\nimport { navigateToLibrary, navigateToReader, showReaderWindow } from '@/utils/nav';\nimport { createBookFilter, createBookSorter } from '../utils/libraryUtils';\nimport { formatTitle } from '@/utils/book';\nimport { eventDispatcher } from '@/utils/event';\n\nimport Alert from '@/components/Alert';\nimport Spinner from '@/components/Spinner';\nimport ModalPortal from '@/components/ModalPortal';\nimport BookshelfItem, { generateBookshelfItems } from './BookshelfItem';\nimport SelectModeActions from './SelectModeActions';\nimport GroupingModal from './GroupingModal';\n\ninterface BookshelfProps {\n  libraryBooks: Book[];\n  isSelectMode: boolean;\n  isSelectAll: boolean;\n  isSelectNone: boolean;\n  handleImportBooks: () => void;\n  handleBookDownload: (\n    book: Book,\n    options?: { redownload?: boolean; queued?: boolean },\n  ) => Promise<boolean>;\n  handleBookUpload: (book: Book, syncBooks?: boolean) => Promise<boolean>;\n  handleBookDelete: (book: Book, syncBooks?: boolean) => Promise<boolean>;\n  handleSetSelectMode: (selectMode: boolean) => void;\n  handleShowDetailsBook: (book: Book) => void;\n  handlePushLibrary: () => Promise<void>;\n  booksTransferProgress: { [key: string]: number | null };\n}\n\nconst Bookshelf: React.FC<BookshelfProps> = ({\n  libraryBooks,\n  isSelectMode,\n  isSelectAll,\n  isSelectNone,\n  handleImportBooks,\n  handleBookUpload,\n  handleBookDownload,\n  handleBookDelete,\n  handleSetSelectMode,\n  handleShowDetailsBook,\n  handlePushLibrary,\n  booksTransferProgress,\n}) => {\n  const _ = useTranslation();\n  const router = useRouter();\n  const searchParams = useSearchParams();\n  const { appService } = useEnv();\n  const { settings } = useSettingsStore();\n  const { safeAreaInsets } = useThemeStore();\n\n  const groupId = searchParams?.get('group') || '';\n  const queryTerm = searchParams?.get('q') || null;\n  const viewMode = searchParams?.get('view') || settings.libraryViewMode;\n  const sortBy = searchParams?.get('sort') || settings.librarySortBy;\n  const sortOrder = searchParams?.get('order') || (settings.librarySortAscending ? 'asc' : 'desc');\n  const coverFit = searchParams?.get('cover') || settings.libraryCoverFit;\n\n  const [loading, setLoading] = useState(false);\n  const [showSelectModeActions, setShowSelectModeActions] = useState(false);\n  const [bookIdsToDelete, setBookIdsToDelete] = useState<string[]>([]);\n  const [showDeleteAlert, setShowDeleteAlert] = useState(false);\n  const [showGroupingModal, setShowGroupingModal] = useState(false);\n  const [importBookUrl] = useState(searchParams?.get('url') || '');\n\n  const abortDeletionRef = useRef(false);\n  const isImportingBook = useRef(false);\n  const iconSize15 = useResponsiveSize(15);\n  const autofocusRef = useAutoFocus<HTMLDivElement>();\n\n  const { setCurrentBookshelf, setLibrary } = useLibraryStore();\n  const { setSelectedBooks, getSelectedBooks, toggleSelectedBook } = useLibraryStore();\n  const { getGroupName } = useLibraryStore();\n\n  const uiLanguage = localStorage?.getItem('i18nextLng') || '';\n\n  const updateUrlParams = useCallback(\n    (updates: Record<string, string | null>) => {\n      const params = new URLSearchParams(searchParams?.toString());\n\n      Object.entries(updates).forEach(([key, value]) => {\n        if (value === null || value === '') {\n          params.delete(key);\n        } else {\n          params.set(key, value);\n        }\n      });\n\n      if (params.get('sort') === 'updated') params.delete('sort');\n      if (params.get('order') === 'desc') params.delete('order');\n      if (params.get('cover') === 'crop') params.delete('cover');\n      if (params.get('view') === 'grid') params.delete('view');\n\n      const newParamString = params.toString();\n      const currentParamString = searchParams?.toString() || '';\n\n      if (newParamString !== currentParamString) {\n        navigateToLibrary(router, newParamString);\n      }\n    },\n    [router, searchParams],\n  );\n\n  const filteredBooks = useMemo(() => {\n    const bookFilter = createBookFilter(queryTerm);\n    return queryTerm ? libraryBooks.filter((book) => bookFilter(book)) : libraryBooks;\n  }, [libraryBooks, queryTerm]);\n\n  const currentBookshelfItems = useMemo(() => {\n    const groupName = getGroupName(groupId) || '';\n    if (groupId && !groupName) {\n      return [];\n    }\n    const items = generateBookshelfItems(filteredBooks, groupName);\n    return items;\n  }, [filteredBooks, groupId, getGroupName]);\n\n  useEffect(() => {\n    if (groupId && currentBookshelfItems.length === 0) {\n      updateUrlParams({ group: null });\n    } else {\n      updateUrlParams({});\n    }\n  }, [searchParams, groupId, currentBookshelfItems.length, updateUrlParams]);\n\n  const sortedBookshelfItems = useMemo(() => {\n    const bookSorter = createBookSorter(sortBy, uiLanguage);\n    const sortOrderMultiplier = sortOrder === 'asc' ? 1 : -1;\n    return currentBookshelfItems.sort((a, b) => {\n      if (sortBy === 'updated') {\n        return (\n          (new Date(a.updatedAt).getTime() - new Date(b.updatedAt).getTime()) * sortOrderMultiplier\n        );\n      } else if ('name' in a || 'name' in b) {\n        const aName = 'name' in a ? a.name : formatTitle(a.title);\n        const bName = 'name' in b ? b.name : formatTitle(b.title);\n        return aName.localeCompare(bName, uiLanguage || navigator.language) * sortOrderMultiplier;\n      } else if (!('name' in a || 'name' in b)) {\n        return bookSorter(a, b) * sortOrderMultiplier;\n      } else {\n        return 0;\n      }\n    });\n  }, [sortOrder, sortBy, uiLanguage, currentBookshelfItems]);\n\n  useEffect(() => {\n    if (isImportingBook.current) return;\n    isImportingBook.current = true;\n\n    if (importBookUrl && appService) {\n      const importBook = async () => {\n        console.log('Importing book from URL:', importBookUrl);\n        const book = await appService.importBook(importBookUrl, libraryBooks);\n        if (book) {\n          setLibrary(libraryBooks);\n          appService.saveLibraryBooks(libraryBooks);\n          navigateToReader(router, [book.hash]);\n        }\n      };\n      importBook();\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [importBookUrl, appService]);\n\n  useEffect(() => {\n    setCurrentBookshelf(currentBookshelfItems);\n  }, [currentBookshelfItems, setCurrentBookshelf]);\n\n  const toggleSelection = useCallback(\n    (id: string) => {\n      toggleSelectedBook(id);\n    },\n    [toggleSelectedBook],\n  );\n\n  const openSelectedBooks = () => {\n    handleSetSelectMode(false);\n    if (appService?.hasWindow && settings.openBookInNewWindow) {\n      showReaderWindow(appService, getSelectedBooks());\n    } else {\n      setTimeout(() => setLoading(true), 200);\n      navigateToReader(router, getSelectedBooks());\n    }\n  };\n\n  const openBookDetails = () => {\n    handleSetSelectMode(false);\n    const selectedBooks = getSelectedBooks();\n    const book = libraryBooks.find((book) => book.hash === selectedBooks[0]);\n    if (book) {\n      handleShowDetailsBook(book);\n    }\n  };\n\n  const getBooksToDelete = () => {\n    const booksToDelete: Book[] = [];\n    bookIdsToDelete.forEach((id) => {\n      for (const book of filteredBooks.filter((book) => book.hash === id || book.groupId === id)) {\n        if (book && !book.deletedAt) {\n          booksToDelete.push(book);\n        }\n      }\n    });\n    return booksToDelete;\n  };\n\n  const confirmDelete = async () => {\n    const books = getBooksToDelete();\n    const concurrency = 20;\n\n    for (let i = 0; i < books.length; i += concurrency) {\n      if (abortDeletionRef.current) {\n        abortDeletionRef.current = false;\n        break;\n      }\n      const batch = books.slice(i, i + concurrency);\n      await Promise.all(batch.map((book) => handleBookDelete(book, false)));\n    }\n    handlePushLibrary();\n    setSelectedBooks([]);\n    setShowDeleteAlert(false);\n    setShowSelectModeActions(true);\n  };\n\n  const deleteSelectedBooks = () => {\n    setBookIdsToDelete(getSelectedBooks());\n    setShowSelectModeActions(false);\n    setShowDeleteAlert(true);\n  };\n\n  const groupSelectedBooks = () => {\n    setShowSelectModeActions(false);\n    setShowGroupingModal(true);\n  };\n\n  const handleDeleteBooksIntent = (event: CustomEvent) => {\n    const { ids } = event.detail;\n    setBookIdsToDelete(ids);\n    setShowSelectModeActions(false);\n    setShowDeleteAlert(true);\n  };\n\n  useEffect(() => {\n    if (isSelectMode) {\n      setShowSelectModeActions(true);\n      if (isSelectAll) {\n        setSelectedBooks(\n          currentBookshelfItems.map((item) => ('hash' in item ? item.hash : item.id)),\n        );\n      } else if (isSelectNone) {\n        setSelectedBooks([]);\n      }\n    } else {\n      setSelectedBooks([]);\n      setShowSelectModeActions(false);\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [isSelectMode, isSelectAll, isSelectNone, currentBookshelfItems]);\n\n  useEffect(() => {\n    eventDispatcher.on('delete-books', handleDeleteBooksIntent);\n    return () => {\n      eventDispatcher.off('delete-books', handleDeleteBooksIntent);\n    };\n  }, []);\n\n  const selectedBooks = getSelectedBooks();\n\n  return (\n    <div className='bookshelf'>\n      <div\n        ref={autofocusRef}\n        tabIndex={-1}\n        className={clsx(\n          'bookshelf-items transform-wrapper focus:outline-none',\n          viewMode === 'grid' && 'grid flex-1 grid-cols-3 gap-x-4 px-4 sm:gap-x-0 sm:px-2',\n          viewMode === 'grid' && 'sm:grid-cols-4 md:grid-cols-6 xl:grid-cols-8 2xl:grid-cols-12',\n          viewMode === 'list' && 'flex flex-col',\n        )}\n        style={{\n          gridTemplateColumns:\n            viewMode === 'grid' && !settings.libraryAutoColumns\n              ? `repeat(${settings.libraryColumns}, minmax(0, 1fr))`\n              : undefined,\n        }}\n        role='main'\n        aria-label={_('Bookshelf')}\n      >\n        {sortedBookshelfItems.map((item) => (\n          <BookshelfItem\n            key={`library-item-${'hash' in item ? item.hash : item.id}`}\n            item={item}\n            mode={viewMode as LibraryViewModeType}\n            coverFit={coverFit as LibraryCoverFitType}\n            isSelectMode={isSelectMode}\n            itemSelected={\n              'hash' in item ? selectedBooks.includes(item.hash) : selectedBooks.includes(item.id)\n            }\n            setLoading={setLoading}\n            toggleSelection={toggleSelection}\n            handleGroupBooks={groupSelectedBooks}\n            handleBookUpload={handleBookUpload}\n            handleBookDownload={handleBookDownload}\n            handleBookDelete={handleBookDelete}\n            handleSetSelectMode={handleSetSelectMode}\n            handleShowDetailsBook={handleShowDetailsBook}\n            transferProgress={\n              'hash' in item ? booksTransferProgress[(item as Book).hash] || null : null\n            }\n          />\n        ))}\n        {viewMode === 'grid' && currentBookshelfItems.length > 0 && (\n          <div\n            className={clsx('mx-0 my-2 sm:mx-4 sm:my-4')}\n            style={\n              coverFit === 'fit' && viewMode === 'grid'\n                ? {\n                    display: 'flex',\n                    paddingBottom: `${iconSize15 + 24}px`,\n                  }\n                : undefined\n            }\n          >\n            <button\n              aria-label={_('Import Books')}\n              className={clsx(\n                'bookitem-main bg-base-100 hover:bg-base-300/50',\n                'flex items-center justify-center',\n                'aspect-[28/41] w-full',\n              )}\n              onClick={handleImportBooks}\n            >\n              <div className='flex items-center justify-center'>\n                <PiPlus className='size-10' color='gray' />\n              </div>\n            </button>\n          </div>\n        )}\n      </div>\n      {loading && (\n        <div className='fixed inset-0 z-50 flex items-center justify-center'>\n          <Spinner loading />\n        </div>\n      )}\n      {!showGroupingModal && isSelectMode && showSelectModeActions && (\n        <SelectModeActions\n          selectedBooks={selectedBooks}\n          safeAreaBottom={safeAreaInsets?.bottom || 0}\n          onOpen={openSelectedBooks}\n          onGroup={groupSelectedBooks}\n          onDetails={openBookDetails}\n          onDelete={deleteSelectedBooks}\n          onCancel={() => handleSetSelectMode(false)}\n        />\n      )}\n      {showGroupingModal && selectedBooks.length > 0 && (\n        <ModalPortal>\n          <GroupingModal\n            libraryBooks={libraryBooks}\n            selectedBooks={selectedBooks}\n            parentGroupName={getGroupName(groupId) || ''}\n            onCancel={() => {\n              setShowGroupingModal(false);\n              setShowSelectModeActions(true);\n            }}\n            onConfirm={() => {\n              setShowGroupingModal(false);\n              handleSetSelectMode(false);\n            }}\n          />\n        </ModalPortal>\n      )}\n      {showDeleteAlert && (\n        <div\n          className={clsx('delete-alert fixed bottom-0 left-0 right-0 z-50 flex justify-center')}\n          style={{\n            paddingBottom: `${(safeAreaInsets?.bottom || 0) + 16}px`,\n          }}\n        >\n          <Alert\n            title={_('Confirm Deletion')}\n            message={_('Are you sure to delete {{count}} selected book(s)?', {\n              count: getBooksToDelete().length,\n            })}\n            onCancel={() => {\n              abortDeletionRef.current = true;\n              setShowDeleteAlert(false);\n              setShowSelectModeActions(true);\n            }}\n            onConfirm={confirmDelete}\n          />\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default Bookshelf;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 5573, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/app/reader/components/annotator/AnnotationTools.tsx"],"sourcesContent":["import { IconType } from 'react-icons';\nimport { FiSearch } from 'react-icons/fi';\nimport { FiCopy } from 'react-icons/fi';\nimport { PiHighlighterFill } from 'react-icons/pi';\nimport { FaWikipediaW } from 'react-icons/fa';\nimport { BsPencilSquare } from 'react-icons/bs';\nimport { BsTranslate } from 'react-icons/bs';\nimport { TbHexagonLetterD } from 'react-icons/tb';\nimport { FaHeadphones } from 'react-icons/fa6';\nimport { IoIosBuild } from 'react-icons/io';\nimport { AnnotationToolType } from '@/types/annotator';\nimport { stubTranslation as _ } from '@/utils/misc';\n\ntype AnnotationToolButton = {\n  type: AnnotationToolType;\n  label: string;\n  tooltip: string;\n  Icon: IconType;\n  quickAction?: boolean;\n};\n\nfunction createAnnotationToolButtons<T extends AnnotationToolType>(\n  buttons: AnnotationToolType extends T\n    ? {\n        [K in T]: {\n          type: K;\n          label: string;\n          tooltip: string;\n          Icon: IconType;\n          quickAction?: boolean;\n        };\n      }[T][]\n    : never,\n): AnnotationToolButton[] {\n  return buttons;\n}\n\nexport const annotationToolButtons = createAnnotationToolButtons([\n  { type: 'copy', label: _('Copy'), tooltip: _('Copy text after selection'), Icon: FiCopy },\n  {\n    type: 'highlight',\n    label: _('Highlight'),\n    tooltip: _('Highlight text after selection'),\n    Icon: PiHighlighterFill,\n    quickAction: true,\n  },\n  {\n    type: 'annotate',\n    label: _('Annotate'),\n    tooltip: _('Annotate text after selection'),\n    Icon: BsPencilSquare,\n  },\n  {\n    type: 'search',\n    label: _('Search'),\n    tooltip: _('Search text after selection'),\n    Icon: FiSearch,\n    quickAction: true,\n  },\n  {\n    type: 'dictionary',\n    label: _('Dictionary'),\n    tooltip: _('Look up text in dictionary after selection'),\n    Icon: TbHexagonLetterD,\n    quickAction: true,\n  },\n  {\n    type: 'wikipedia',\n    label: _('Wikipedia'),\n    tooltip: _('Look up text in Wikipedia after selection'),\n    Icon: FaWikipediaW,\n    quickAction: true,\n  },\n  {\n    type: 'translate',\n    label: _('Translate'),\n    tooltip: _('Translate text after selection'),\n    Icon: BsTranslate,\n    quickAction: true,\n  },\n  {\n    type: 'tts',\n    label: _('Speak'),\n    tooltip: _('Read text aloud after selection'),\n    Icon: FaHeadphones,\n    quickAction: true,\n  },\n  {\n    type: 'proofread',\n    label: _('Proofread'),\n    tooltip: _('Proofread text after selection'),\n    Icon: IoIosBuild,\n  },\n]);\n\nexport const annotationToolQuickActions = annotationToolButtons.filter(\n  (button) => button.quickAction,\n);\n"],"names":[],"mappings":";;;;;;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;;;;;;;;;;;AAUA,SAAS,4BACP,OAUS;IAET,OAAO;AACT;AAEO,MAAM,wBAAwB,4BAA4B;IAC/D;QAAE,MAAM;QAAQ,OAAO,IAAA,oKAAC,EAAC;QAAS,SAAS,IAAA,oKAAC,EAAC;QAA8B,MAAM,4OAAM;IAAC;IACxF;QACE,MAAM;QACN,OAAO,IAAA,oKAAC,EAAC;QACT,SAAS,IAAA,oKAAC,EAAC;QACX,MAAM,uPAAiB;QACvB,aAAa;IACf;IACA;QACE,MAAM;QACN,OAAO,IAAA,oKAAC,EAAC;QACT,SAAS,IAAA,oKAAC,EAAC;QACX,MAAM,oPAAc;IACtB;IACA;QACE,MAAM;QACN,OAAO,IAAA,oKAAC,EAAC;QACT,SAAS,IAAA,oKAAC,EAAC;QACX,MAAM,8OAAQ;QACd,aAAa;IACf;IACA;QACE,MAAM;QACN,OAAO,IAAA,oKAAC,EAAC;QACT,SAAS,IAAA,oKAAC,EAAC;QACX,MAAM,sPAAgB;QACtB,aAAa;IACf;IACA;QACE,MAAM;QACN,OAAO,IAAA,oKAAC,EAAC;QACT,SAAS,IAAA,oKAAC,EAAC;QACX,MAAM,kPAAY;QAClB,aAAa;IACf;IACA;QACE,MAAM;QACN,OAAO,IAAA,oKAAC,EAAC;QACT,SAAS,IAAA,oKAAC,EAAC;QACX,MAAM,iPAAW;QACjB,aAAa;IACf;IACA;QACE,MAAM;QACN,OAAO,IAAA,oKAAC,EAAC;QACT,SAAS,IAAA,oKAAC,EAAC;QACX,MAAM,mPAAY;QAClB,aAAa;IACf;IACA;QACE,MAAM;QACN,OAAO,IAAA,oKAAC,EAAC;QACT,SAAS,IAAA,oKAAC,EAAC;QACX,MAAM,gPAAU;IAClB;CACD;AAEM,MAAM,6BAA6B,sBAAsB,MAAM,CACpE,CAAC,SAAW,OAAO,WAAW"}},
    {"offset": {"line": 5670, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/app/library/components/TransferQueuePanel.tsx"],"sourcesContent":["'use client';\n\nimport clsx from 'clsx';\nimport React, { useState } from 'react';\nimport {\n  MdClose,\n  MdRefresh,\n  MdPause,\n  MdPlayArrow,\n  MdCloudUpload,\n  MdCloudDownload,\n  MdCheckCircle,\n  MdError,\n  MdCancel,\n  MdDeleteSweep,\n} from 'react-icons/md';\nimport { useTransferQueue } from '@/hooks/useTransferQueue';\nimport { useTranslation } from '@/hooks/useTranslation';\nimport { useResponsiveSize } from '@/hooks/useResponsiveSize';\nimport { useKeyDownActions } from '@/hooks/useKeyDownActions';\nimport { useLibraryStore } from '@/store/libraryStore';\nimport { TransferItem, TransferStatus, useTransferStore } from '@/store/transferStore';\n\nconst formatBytes = (bytes: number): string => {\n  if (bytes === 0) return '0 B';\n  const k = 1024;\n  const sizes = ['B', 'KB', 'MB', 'GB'];\n  const i = Math.floor(Math.log(bytes) / Math.log(k));\n  return `${parseFloat((bytes / Math.pow(k, i)).toFixed(1))} ${sizes[i]}`;\n};\n\nconst formatSpeed = (bytesPerSec: number): string => {\n  return `${formatBytes(bytesPerSec)}/s`;\n};\n\nconst formatDateTime = (timestamp: number): string => {\n  const date = new Date(timestamp);\n  const now = new Date();\n  const isToday = date.toDateString() === now.toDateString();\n  const yesterday = new Date(now);\n  yesterday.setDate(yesterday.getDate() - 1);\n  const isYesterday = date.toDateString() === yesterday.toDateString();\n\n  const timeStr = date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });\n\n  if (isToday) {\n    return timeStr;\n  } else if (isYesterday) {\n    return `Yesterday ${timeStr}`;\n  } else {\n    return date.toLocaleDateString([], { month: 'short', day: 'numeric' }) + ' ' + timeStr;\n  }\n};\n\nconst StatusIcon: React.FC<{\n  status: TransferStatus;\n  type: 'upload' | 'download' | 'delete';\n  size: number;\n}> = ({ status, type, size }) => {\n  switch (status) {\n    case 'completed':\n      return <MdCheckCircle className='text-success' size={size} />;\n    case 'failed':\n      return <MdError className='text-error' size={size} />;\n    case 'cancelled':\n      return <MdCancel className='text-warning' size={size} />;\n    case 'in_progress':\n    case 'pending':\n    default:\n      return type === 'upload' ? (\n        <MdCloudUpload className='text-primary' size={size} />\n      ) : type === 'delete' ? (\n        <MdDeleteSweep className='text-primary' size={size} />\n      ) : (\n        <MdCloudDownload className='text-primary' size={size} />\n      );\n  }\n};\n\nconst TransferItemRow: React.FC<{\n  transfer: TransferItem;\n  onCancel: (id: string) => void;\n  onRetry: (id: string) => void;\n  iconSize: number;\n}> = ({ transfer, onCancel, onRetry, iconSize }) => {\n  const _ = useTranslation();\n\n  const completedLabel = {\n    upload: _('Uploaded'),\n    download: _('Downloaded'),\n    delete: _('Deleted'),\n  };\n\n  return (\n    <div className='hover:bg-base-200 flex items-center gap-3 rounded-lg p-3'>\n      <StatusIcon status={transfer.status} type={transfer.type} size={iconSize} />\n\n      <div className='min-w-0 flex-1'>\n        <div className='truncate font-medium'>{transfer.bookTitle}</div>\n        <div className='text-base-content/60 text-xs'>\n          {transfer.status === 'in_progress' && (\n            <>\n              {Math.round(transfer.progress)}% - {formatSpeed(transfer.transferSpeed)}\n            </>\n          )}\n          {transfer.status === 'pending' && transfer.error && (\n            <span className='text-warning'>{transfer.error}</span>\n          )}\n          {transfer.status === 'pending' && !transfer.error && _('Waiting...')}\n          {transfer.status === 'failed' && (\n            <span className='text-error'>{transfer.error || _('Failed')}</span>\n          )}\n          {transfer.status === 'completed' && (completedLabel[transfer.type] || _('Completed'))}\n          {transfer.status === 'cancelled' && _('Cancelled')}\n          {' ¬∑ '}\n          {formatDateTime(transfer.completedAt || transfer.startedAt || transfer.createdAt)}\n        </div>\n\n        {transfer.status === 'in_progress' && (\n          <div className='bg-base-300 mt-1 h-1.5 w-full overflow-hidden rounded-full'>\n            <div\n              className='bg-primary h-full transition-all'\n              style={{ width: `${transfer.progress}%` }}\n            />\n          </div>\n        )}\n      </div>\n\n      <div className='flex items-center gap-1'>\n        {(transfer.status === 'failed' || transfer.status === 'cancelled') && (\n          <button\n            onClick={() => onRetry(transfer.id)}\n            className='btn btn-ghost btn-sm btn-circle'\n            aria-label={_('Retry')}\n          >\n            <MdRefresh size={iconSize} />\n          </button>\n        )}\n        {['pending', 'in_progress'].includes(transfer.status) && (\n          <button\n            onClick={() => onCancel(transfer.id)}\n            className='btn btn-ghost btn-sm btn-circle'\n            aria-label={_('Cancel')}\n          >\n            <MdClose size={iconSize} />\n          </button>\n        )}\n      </div>\n    </div>\n  );\n};\n\ntype FilterType = 'all' | 'active' | 'completed' | 'failed';\n\nconst TransferQueuePanel: React.FC = () => {\n  const _ = useTranslation();\n  const iconSize = useResponsiveSize(18);\n  const setIsOpen = useTransferStore((state) => state.setIsTransferQueueOpen);\n  const getVisibleLibrary = useLibraryStore((state) => state.getVisibleLibrary);\n  const {\n    transfers,\n    stats,\n    isQueuePaused,\n    cancelTransfer,\n    retryTransfer,\n    retryAllFailed,\n    pauseQueue,\n    resumeQueue,\n    clearCompleted,\n    clearFailed,\n    queueUpload,\n    queueDownload,\n  } = useTransferQueue();\n\n  const [filter, setFilter] = useState<FilterType>('all');\n\n  const onClose = () => setIsOpen(false);\n  const divRef = useKeyDownActions({ onCancel: onClose, onConfirm: onClose });\n\n  const booksToUpload = getVisibleLibrary().filter((book) => book.downloadedAt && !book.uploadedAt);\n  const booksToDownload = getVisibleLibrary().filter(\n    (book) => book.uploadedAt && !book.downloadedAt,\n  );\n\n  const handleUploadAll = () => {\n    booksToUpload.forEach((book) => queueUpload(book));\n  };\n\n  const handleDownloadAll = () => {\n    booksToDownload.forEach((book) => queueDownload(book));\n  };\n\n  const filteredTransfers = transfers\n    .filter((t) => {\n      switch (filter) {\n        case 'active':\n          return ['pending', 'in_progress'].includes(t.status);\n        case 'completed':\n          return t.status === 'completed';\n        case 'failed':\n          return t.status === 'failed' || t.status === 'cancelled';\n        default:\n          return true;\n      }\n    })\n    .sort((a, b) => {\n      // Sort by status priority then by createdAt\n      const statusOrder: Record<TransferStatus, number> = {\n        in_progress: 0,\n        pending: 1,\n        failed: 2,\n        cancelled: 3,\n        completed: 4,\n      };\n      const statusDiff = statusOrder[a.status] - statusOrder[b.status];\n      if (statusDiff !== 0) return statusDiff;\n      return b.createdAt - a.createdAt;\n    });\n\n  const filterLabels: Record<FilterType, string> = {\n    all: _('All'),\n    active: _('Active'),\n    completed: _('Completed'),\n    failed: _('Failed'),\n  };\n\n  return (\n    <div className='fixed inset-0 z-50 flex items-center justify-center'>\n      {/* eslint-disable-next-line jsx-a11y/click-events-have-key-events, jsx-a11y/no-static-element-interactions */}\n      <div className='absolute inset-0 bg-black/50' onClick={onClose} />\n      <div\n        ref={divRef}\n        className={clsx(\n          'modal-box bg-base-100 relative flex max-h-[85%] min-h-[65%] w-[95%] flex-col rounded-2xl p-0 shadow-xl',\n          'min-w-64 max-w-lg overflow-hidden',\n        )}\n      >\n        {/* Header */}\n        <div className='border-base-300 flex items-center justify-between border-b p-4'>\n          <h2 className='text-lg font-semibold'>{_('Transfer Queue')}</h2>\n          <div className='flex items-center gap-2'>\n            {booksToUpload.length > 0 && (\n              <button\n                onClick={handleUploadAll}\n                className='btn btn-ghost btn-sm gap-1'\n                title={_('Upload All')}\n                aria-label={_('Upload All')}\n              >\n                <MdCloudUpload size={iconSize} />\n                <span className='text-xs'>{booksToUpload.length}</span>\n              </button>\n            )}\n            {booksToDownload.length > 0 && (\n              <button\n                onClick={handleDownloadAll}\n                className='btn btn-ghost btn-sm gap-1'\n                title={_('Download All')}\n                aria-label={_('Download All')}\n              >\n                <MdCloudDownload size={iconSize} />\n                <span className='text-xs'>{booksToDownload.length}</span>\n              </button>\n            )}\n            <button\n              onClick={isQueuePaused ? resumeQueue : pauseQueue}\n              className='btn btn-ghost btn-sm btn-circle'\n              title={isQueuePaused ? _('Resume Transfers') : _('Pause Transfers')}\n              aria-label={isQueuePaused ? _('Resume Transfers') : _('Pause Transfers')}\n            >\n              {isQueuePaused ? <MdPlayArrow size={iconSize} /> : <MdPause size={iconSize} />}\n            </button>\n            <button\n              onClick={onClose}\n              className='btn btn-ghost btn-sm btn-circle'\n              title={_('Close')}\n              aria-label={_('Close')}\n            >\n              <MdClose size={iconSize} />\n            </button>\n          </div>\n        </div>\n\n        {/* Stats bar */}\n        <div className='bg-base-200 flex items-center gap-4 px-4 py-2 text-sm'>\n          <span>\n            {_('Active')}: {stats.active}\n          </span>\n          <span>\n            {_('Pending')}: {stats.pending}\n          </span>\n          <span>\n            {_('Completed')}: {stats.completed}\n          </span>\n          <span>\n            {_('Failed')}: {stats.failed}\n          </span>\n        </div>\n\n        {/* Filter tabs */}\n        <div className='border-base-300 flex gap-2 border-b p-4'>\n          {(['all', 'active', 'completed', 'failed'] as const).map((f) => (\n            <button\n              key={f}\n              onClick={() => setFilter(f)}\n              className={clsx(\n                'rounded-lg px-3 py-1 text-sm transition-colors',\n                filter === f ? 'bg-primary text-primary-content' : 'bg-base-200 hover:bg-base-300',\n              )}\n            >\n              {filterLabels[f]}\n            </button>\n          ))}\n        </div>\n\n        {/* Transfer list */}\n        <div className='flex-1 overflow-y-auto p-2'>\n          {filteredTransfers.length === 0 ? (\n            <div className='text-base-content/60 py-8 text-center'>{_('No transfers')}</div>\n          ) : (\n            filteredTransfers.map((transfer) => (\n              <TransferItemRow\n                key={transfer.id}\n                transfer={transfer}\n                onCancel={cancelTransfer}\n                onRetry={retryTransfer}\n                iconSize={iconSize}\n              />\n            ))\n          )}\n        </div>\n\n        {/* Footer actions */}\n        <div className='border-base-300 flex items-center justify-between border-t p-4'>\n          <div className='flex items-center gap-2'>\n            {stats.failed > 0 && (\n              <button onClick={retryAllFailed} className='btn btn-ghost btn-sm gap-1'>\n                <MdRefresh size={iconSize - 2} />\n                {_('Retry All')}\n              </button>\n            )}\n          </div>\n          <div className='flex items-center gap-2'>\n            {stats.completed > 0 && (\n              <button onClick={clearCompleted} className='btn btn-ghost btn-sm gap-1'>\n                <MdDeleteSweep size={iconSize - 2} />\n                {_('Clear Completed')}\n              </button>\n            )}\n            {stats.failed > 0 && (\n              <button onClick={clearFailed} className='btn btn-ghost btn-sm gap-1'>\n                <MdDeleteSweep size={iconSize - 2} />\n                {_('Clear Failed')}\n              </button>\n            )}\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default TransferQueuePanel;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 6344, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/app/library/components/ReconcileModal.tsx"],"sourcesContent":["'use client';\n\nimport React, { useState } from 'react';\nimport { MdSync, MdCheckCircle, MdWarning, MdError } from 'react-icons/md';\nimport { Book } from '@/types/book';\n\ninterface ReconcileResult {\n    hash: string;\n    status: 'matched' | 'moved' | 'missing' | 'duplicated';\n    oldRelativePath?: string;\n    newRelativePath?: string;\n    absolutePath?: string;\n    suggestedGroupName?: string;\n    message?: string;\n}\n\ninterface ReconcileModalProps {\n    isOpen: boolean;\n    onClose: () => void;\n    onConfirm: (results: ReconcileResult[]) => void;\n    reconcileBookPaths: (books: Book[]) => Promise<any>;\n    applyReconciliation: (books: Book[], results: ReconcileResult[]) => Promise<Book[]>;\n    books: Book[];\n}\n\nconst ReconcileModal: React.FC<ReconcileModalProps> = ({\n    isOpen,\n    onClose,\n    onConfirm,\n    reconcileBookPaths,\n    applyReconciliation,\n    books,\n}) => {\n    const [isScanning, setIsScanning] = useState(false);\n    const [scanComplete, setScanComplete] = useState(false);\n    const [reconcileData, setReconcileData] = useState<any>(null);\n    const [selectedResults, setSelectedResults] = useState<Set<string>>(new Set());\n\n    if (!isOpen) return null;\n\n    const handleScan = async () => {\n        setIsScanning(true);\n        setScanComplete(false);\n        try {\n            const result = await reconcileBookPaths(books);\n            setReconcileData(result);\n            setScanComplete(true);\n\n            // ÈªòËÆ§ÈÄâ‰∏≠ÊâÄÊúâÈúÄË¶ÅË∞ÉÊï¥ÁöÑ‰π¶Á±ç\n            if (result.results) {\n                const movedBooks = result.results\n                    .filter((r: ReconcileResult) => r.status === 'moved')\n                    .map((r: ReconcileResult) => r.hash);\n                setSelectedResults(new Set(movedBooks));\n            }\n        } catch (error) {\n            console.error('Ë∑ØÂæÑÊ†°ÂáÜÂ§±Ë¥•:', error);\n            alert('Ë∑ØÂæÑÊ†°ÂáÜÂ§±Ë¥•ÔºåËØ∑Êü•ÁúãÊéßÂà∂Âè∞Êó•Âøó');\n        } finally {\n            setIsScanning(false);\n        }\n    };\n\n    const handleApply = async () => {\n        if (!reconcileData || !reconcileData.results) return;\n\n        const selectedItems = reconcileData.results.filter((r: ReconcileResult) =>\n            selectedResults.has(r.hash)\n        );\n\n        try {\n            await applyReconciliation(books, selectedItems);\n            onConfirm(selectedItems);\n            onClose();\n        } catch (error) {\n            console.error('Â∫îÁî®Ê†°ÂáÜÁªìÊûúÂ§±Ë¥•:', error);\n            alert('Â∫îÁî®Ê†°ÂáÜÁªìÊûúÂ§±Ë¥•ÔºåËØ∑Êü•ÁúãÊéßÂà∂Âè∞Êó•Âøó');\n        }\n    };\n\n    const toggleSelection = (hash: string) => {\n        const newSelection = new Set(selectedResults);\n        if (newSelection.has(hash)) {\n            newSelection.delete(hash);\n        } else {\n            newSelection.add(hash);\n        }\n        setSelectedResults(newSelection);\n    };\n\n    const getStatusIcon = (status: string) => {\n        switch (status) {\n            case 'matched':\n                return <MdCheckCircle className='text-success' size={20} />;\n            case 'moved':\n                return <MdWarning className='text-warning' size={20} />;\n            case 'missing':\n                return <MdError className='text-error' size={20} />;\n            default:\n                return null;\n        }\n    };\n\n    const getStatusText = (status: string) => {\n        switch (status) {\n            case 'matched':\n                return 'Ë∑ØÂæÑÂåπÈÖç';\n            case 'moved':\n                return 'Êñá‰ª∂Â∑≤ÁßªÂä®';\n            case 'missing':\n                return 'Êñá‰ª∂‰∏¢Â§±';\n            default:\n                return status;\n        }\n    };\n\n    return (\n        <div className='fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50'>\n            <div className='bg-base-100 rounded-2xl shadow-xl w-full max-w-4xl max-h-[80vh] overflow-hidden flex flex-col'>\n                {/* Header */}\n                <div className='px-6 py-4 border-b border-base-300'>\n                    <h2 className='text-xl font-bold flex items-center gap-2'>\n                        <MdSync size={24} />\n                        ‰π¶Á±çË∑ØÂæÑÊ†°ÂáÜ\n                    </h2>\n                    <p className='text-sm text-base-content/70 mt-2'>\n                        Êâ´ÊèèÊñá‰ª∂Á≥ªÁªüÔºåÊ£ÄÊµã‰π¶Á±çÊñá‰ª∂‰ΩçÁΩÆÂèòÂåñÂπ∂ÂêåÊ≠•Âà∞‰π¶Â∫ì\n                    </p>\n                </div>\n\n                {/* Content */}\n                <div className='flex-1 overflow-y-auto px-6 py-4'>\n                    {!scanComplete ? (\n                        <div className='text-center py-12'>\n                            <button\n                                onClick={handleScan}\n                                disabled={isScanning}\n                                className='btn btn-primary btn-lg'\n                            >\n                                {isScanning ? (\n                                    <>\n                                        <span className='loading loading-spinner'></span>\n                                        Êâ´Êèè‰∏≠...\n                                    </>\n                                ) : (\n                                    <>\n                                        <MdSync size={20} />\n                                        ÂºÄÂßãÊâ´Êèè\n                                    </>\n                                )}\n                            </button>\n                            <p className='text-sm text-base-content/60 mt-4'>\n                                ÁÇπÂáªÂºÄÂßãÊâ´ÊèèÊñá‰ª∂Á≥ªÁªüÔºåÊü•ÊâæË∑ØÂæÑ‰∏ç‰∏ÄËá¥ÁöÑ‰π¶Á±ç\n                            </p>\n                        </div>\n                    ) : (\n                        <div>\n                            {/* Summary */}\n                            {reconcileData?.summary && (\n                                <div className='stats stats-horizontal shadow w-full mb-6'>\n                                    <div className='stat'>\n                                        <div className='stat-title'>ÊÄªËÆ°</div>\n                                        <div className='stat-value text-2xl'>{reconcileData.summary.total}</div>\n                                    </div>\n                                    <div className='stat'>\n                                        <div className='stat-title'>ÂåπÈÖç</div>\n                                        <div className='stat-value text-2xl text-success'>\n                                            {reconcileData.summary.matched}\n                                        </div>\n                                    </div>\n                                    <div className='stat'>\n                                        <div className='stat-title'>Â∑≤ÁßªÂä®</div>\n                                        <div className='stat-value text-2xl text-warning'>\n                                            {reconcileData.summary.moved}\n                                        </div>\n                                    </div>\n                                    <div className='stat'>\n                                        <div className='stat-title'>‰∏¢Â§±</div>\n                                        <div className='stat-value text-2xl text-error'>\n                                            {reconcileData.summary.missing}\n                                        </div>\n                                    </div>\n                                </div>\n                            )}\n\n                            {/* Results List */}\n                            {reconcileData?.results && reconcileData.results.length > 0 && (\n                                <div className='space-y-2'>\n                                    <h3 className='font-semibold mb-2'>ËØ¶ÁªÜÁªìÊûú</h3>\n                                    {reconcileData.results\n                                        .filter((r: ReconcileResult) => r.status !== 'matched')\n                                        .map((result: ReconcileResult) => (\n                                            <div\n                                                key={result.hash}\n                                                className='card bg-base-200 shadow-sm hover:shadow-md transition-shadow'\n                                            >\n                                                <div className='card-body p-4'>\n                                                    <div className='flex items-start gap-3'>\n                                                        {result.status === 'moved' && (\n                                                            <input\n                                                                type='checkbox'\n                                                                className='checkbox checkbox-primary mt-1'\n                                                                checked={selectedResults.has(result.hash)}\n                                                                onChange={() => toggleSelection(result.hash)}\n                                                            />\n                                                        )}\n                                                        <div className='flex-1'>\n                                                            <div className='flex items-center gap-2 mb-2'>\n                                                                {getStatusIcon(result.status)}\n                                                                <span className='font-semibold'>{getStatusText(result.status)}</span>\n                                                            </div>\n                                                            {result.oldRelativePath && (\n                                                                <div className='text-sm'>\n                                                                    <span className='text-base-content/60'>ÂéüË∑ØÂæÑ: </span>\n                                                                    <span className='font-mono'>{result.oldRelativePath}</span>\n                                                                </div>\n                                                            )}\n                                                            {result.newRelativePath && result.status === 'moved' && (\n                                                                <div className='text-sm'>\n                                                                    <span className='text-base-content/60'>Êñ∞Ë∑ØÂæÑ: </span>\n                                                                    <span className='font-mono text-success'>\n                                                                        {result.newRelativePath}\n                                                                    </span>\n                                                                </div>\n                                                            )}\n                                                            {result.suggestedGroupName !== undefined && (\n                                                                <div className='text-sm'>\n                                                                    <span className='text-base-content/60'>Âª∫ËÆÆÂàÜÁªÑ: </span>\n                                                                    <span className='badge badge-primary badge-sm'>\n                                                                        {result.suggestedGroupName || 'Êú™ÂàÜÁªÑ'}\n                                                                    </span>\n                                                                </div>\n                                                            )}\n                                                            {result.message && (\n                                                                <div className='text-xs text-base-content/50 mt-1'>\n                                                                    {result.message}\n                                                                </div>\n                                                            )}\n                                                        </div>\n                                                    </div>\n                                                </div>\n                                            </div>\n                                        ))}\n                                </div>\n                            )}\n\n                            {reconcileData?.unmatchedFiles && reconcileData.unmatchedFiles.length > 0 && (\n                                <div className='mt-6'>\n                                    <h3 className='font-semibold mb-2'>Êú™ÂåπÈÖçÁöÑÊñá‰ª∂</h3>\n                                    <p className='text-sm text-base-content/60 mb-2'>\n                                        Ëøô‰∫õÊñá‰ª∂Â≠òÂú®‰∫éÊñá‰ª∂Á≥ªÁªü‰∏≠Ôºå‰ΩÜ‰∏çÂú®‰π¶Â∫ìËÆ∞ÂΩï‰∏≠\n                                    </p>\n                                    <div className='space-y-1 max-h-40 overflow-y-auto'>\n                                        {reconcileData.unmatchedFiles.map((file: string) => (\n                                            <div key={file} className='text-sm font-mono bg-base-300 px-3 py-2 rounded'>\n                                                {file}\n                                            </div>\n                                        ))}\n                                    </div>\n                                </div>\n                            )}\n                        </div>\n                    )}\n                </div>\n\n                {/* Footer */}\n                <div className='px-6 py-4 border-t border-base-300 flex justify-end gap-3'>\n                    <button onClick={onClose} className='btn btn-ghost'>\n                        ÂèñÊ∂à\n                    </button>\n                    {scanComplete && reconcileData?.summary?.moved > 0 && (\n                        <>\n                            <button onClick={handleScan} className='btn btn-ghost'>\n                                ÈáçÊñ∞Êâ´Êèè\n                            </button>\n                            <button\n                                onClick={handleApply}\n                                className='btn btn-primary'\n                                disabled={selectedResults.size === 0}\n                            >\n                                Â∫îÁî®ÈÄâ‰∏≠ÁöÑË∞ÉÊï¥ ({selectedResults.size})\n                            </button>\n                        </>\n                    )}\n                </div>\n            </div>\n        </div>\n    );\n};\n\nexport default ReconcileModal;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 6928, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/app/library/page.tsx"],"sourcesContent":["'use client';\n\nimport clsx from 'clsx';\nimport * as React from 'react';\nimport { MdChevronRight } from 'react-icons/md';\nimport { useState, useRef, useEffect, Suspense, useCallback } from 'react';\nimport { ReadonlyURLSearchParams, useRouter, useSearchParams } from 'next/navigation';\nimport { OverlayScrollbarsComponent, OverlayScrollbarsComponentRef } from 'overlayscrollbars-react';\nimport 'overlayscrollbars/overlayscrollbars.css';\n\nimport { Book } from '@/types/book';\nimport { AppService, DeleteAction } from '@/types/system';\nimport { navigateToLibrary, navigateToReader } from '@/utils/nav';\nimport { formatAuthors, formatTitle, getPrimaryLanguage, listFormater } from '@/utils/book';\nimport { eventDispatcher } from '@/utils/event';\nimport { ProgressPayload } from '@/utils/transfer';\nimport { throttle } from '@/utils/throttle';\nimport { transferManager } from '@/services/transferManager';\nimport { getDirPath, getFilename, joinPaths } from '@/utils/path';\nimport { parseOpenWithFiles } from '@/helpers/openWith';\nimport { isTauriAppPlatform, isWebAppPlatform } from '@/services/environment';\nimport { checkForAppUpdates, checkAppReleaseNotes } from '@/helpers/updater';\nimport { impactFeedback } from '@tauri-apps/plugin-haptics';\nimport { getCurrentWebview } from '@tauri-apps/api/webview';\n\nimport { useEnv } from '@/context/EnvContext';\nimport { useAuth } from '@/context/AuthContext';\nimport { useThemeStore } from '@/store/themeStore';\nimport { useTranslation } from '@/hooks/useTranslation';\nimport { useLibraryStore } from '@/store/libraryStore';\nimport { useSettingsStore } from '@/store/settingsStore';\nimport { useResponsiveSize } from '@/hooks/useResponsiveSize';\nimport { usePullToRefresh } from '@/hooks/usePullToRefresh';\nimport { useTheme } from '@/hooks/useTheme';\nimport { useUICSS } from '@/hooks/useUICSS';\nimport { useDemoBooks } from './hooks/useDemoBooks';\nimport { useBooksSync } from './hooks/useBooksSync';\nimport { useBookDataStore } from '@/store/bookDataStore';\nimport { useTransferStore } from '@/store/transferStore';\nimport { useScreenWakeLock } from '@/hooks/useScreenWakeLock';\nimport { useOpenWithBooks } from '@/hooks/useOpenWithBooks';\nimport { SelectedFile, useFileSelector } from '@/hooks/useFileSelector';\nimport { lockScreenOrientation, selectDirectory } from '@/utils/bridge';\nimport { requestStoragePermission } from '@/utils/permission';\nimport { SUPPORTED_BOOK_EXTS } from '@/services/constants';\nimport {\n  tauriHandleClose,\n  tauriHandleSetAlwaysOnTop,\n  tauriHandleToggleFullScreen,\n  tauriQuitApp,\n} from '@/utils/window';\n\nimport { BookMetadata } from '@/libs/document';\nimport { AboutWindow } from '@/components/AboutWindow';\nimport { BookDetailModal } from '@/components/metadata';\nimport { UpdaterWindow } from '@/components/UpdaterWindow';\nimport { CatalogDialog } from './components/OPDSDialog';\nimport { MigrateDataWindow } from './components/MigrateDataWindow';\nimport { useDragDropImport } from './hooks/useDragDropImport';\nimport { useTransferQueue } from '@/hooks/useTransferQueue';\nimport { Toast } from '@/components/Toast';\nimport { getBreadcrumbs } from './utils/libraryUtils';\nimport Spinner from '@/components/Spinner';\nimport LibraryHeader from './components/LibraryHeader';\nimport Bookshelf from './components/Bookshelf';\nimport useShortcuts from '@/hooks/useShortcuts';\nimport DropIndicator from '@/components/DropIndicator';\nimport SettingsDialog from '@/components/settings/SettingsDialog';\nimport ModalPortal from '@/components/ModalPortal';\nimport TransferQueuePanel from './components/TransferQueuePanel';\nimport ReconcileModal from './components/ReconcileModal';\n\nconst LibraryPageWithSearchParams = () => {\n  const searchParams = useSearchParams();\n  return <LibraryPageContent searchParams={searchParams} />;\n};\n\nconst LibraryPageContent = ({ searchParams }: { searchParams: ReadonlyURLSearchParams | null }) => {\n  const router = useRouter();\n  const { envConfig, appService } = useEnv();\n  const { token, user } = useAuth();\n  const {\n    library: libraryBooks,\n    isSyncing,\n    syncProgress,\n    updateBook,\n    updateBooks,\n    setLibrary,\n    getGroupId,\n    getGroupName,\n    refreshGroups,\n    checkOpenWithBooks,\n    checkLastOpenBooks,\n    setCheckOpenWithBooks,\n    setCheckLastOpenBooks,\n  } = useLibraryStore();\n  const _ = useTranslation();\n  const { selectFiles } = useFileSelector(appService, _);\n  const { safeAreaInsets: insets, isRoundedWindow } = useThemeStore();\n  const { clearBookData } = useBookDataStore();\n  const { settings, setSettings, saveSettings } = useSettingsStore();\n  const { isSettingsDialogOpen, setSettingsDialogOpen } = useSettingsStore();\n  const { isTransferQueueOpen } = useTransferStore();\n  const [showCatalogManager, setShowCatalogManager] = useState(\n    searchParams?.get('opds') === 'true',\n  );\n  const [loading, setLoading] = useState(false);\n  const [libraryLoaded, setLibraryLoaded] = useState(false);\n  const [isSelectMode, setIsSelectMode] = useState(false);\n  const [isSelectAll, setIsSelectAll] = useState(false);\n  const [isSelectNone, setIsSelectNone] = useState(false);\n  const [showDetailsBook, setShowDetailsBook] = useState<Book | null>(null);\n  const [showReconcileModal, setShowReconcileModal] = useState(false);\n  const [currentGroupPath, setCurrentGroupPath] = useState<string | undefined>(undefined);\n  const [booksTransferProgress, setBooksTransferProgress] = useState<{\n    [key: string]: number | null;\n  }>({});\n  const [pendingNavigationBookIds, setPendingNavigationBookIds] = useState<string[] | null>(null);\n  const isInitiating = useRef(false);\n\n  const iconSize = useResponsiveSize(18);\n  const viewSettings = settings.globalViewSettings;\n  const demoBooks = useDemoBooks();\n  const osRef = useRef<OverlayScrollbarsComponentRef>(null);\n  const containerRef: React.MutableRefObject<HTMLDivElement | null> = useRef(null);\n  const pageRef = useRef<HTMLDivElement>(null);\n\n  useTheme({ systemUIVisible: true, appThemeColor: 'base-200' });\n  useUICSS();\n\n  useOpenWithBooks();\n  useTransferQueue(libraryLoaded);\n\n  const { pullLibrary, pushLibrary } = useBooksSync();\n  const { isDragging } = useDragDropImport();\n\n  usePullToRefresh(containerRef, pullLibrary);\n  useScreenWakeLock(settings.screenWakeLock);\n\n  useShortcuts({\n    onToggleFullscreen: async () => {\n      if (isTauriAppPlatform()) {\n        await tauriHandleToggleFullScreen();\n      }\n    },\n    onCloseWindow: async () => {\n      if (isTauriAppPlatform()) {\n        await tauriHandleClose();\n      }\n    },\n    onQuitApp: async () => {\n      if (isTauriAppPlatform()) {\n        await tauriQuitApp();\n      }\n    },\n    onOpenFontLayoutSettings: () => {\n      setSettingsDialogOpen(true);\n    },\n    onOpenBooks: () => {\n      handleImportBooksFromFiles();\n    },\n  });\n\n  useEffect(() => {\n    sessionStorage.setItem('lastLibraryParams', searchParams?.toString() || '');\n  }, [searchParams]);\n\n  useEffect(() => {\n    const doCheckAppUpdates = async () => {\n      if (appService?.hasUpdater && settings.autoCheckUpdates) {\n        await checkForAppUpdates(_);\n      } else if (appService?.hasUpdater === false) {\n        checkAppReleaseNotes();\n      }\n    };\n    if (settings.alwaysOnTop) {\n      tauriHandleSetAlwaysOnTop(settings.alwaysOnTop);\n    }\n    doCheckAppUpdates();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [appService?.hasUpdater, settings]);\n\n  useEffect(() => {\n    if (appService?.isMobileApp) {\n      lockScreenOrientation({ orientation: 'auto' });\n    }\n  }, [appService]);\n\n  const handleRefreshLibrary = useCallback(async () => {\n    const appService = await envConfig.getAppService();\n    const settings = await appService.loadSettings();\n    const library = await appService.loadLibraryBooks();\n    setSettings(settings);\n    setLibrary(library);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [envConfig, appService]);\n\n  useEffect(() => {\n    if (appService?.hasWindow) {\n      const currentWebview = getCurrentWebview();\n      const unlisten = currentWebview.listen('close-reader-window', async () => {\n        handleRefreshLibrary();\n      });\n      return () => {\n        unlisten.then((fn) => fn());\n      };\n    }\n    return;\n  }, [appService, handleRefreshLibrary]);\n\n  const handleImportBookFiles = useCallback(async (event: CustomEvent) => {\n    const selectedFiles: SelectedFile[] = event.detail.files;\n    const groupId: string = event.detail.groupId || '';\n    if (selectedFiles.length === 0) return;\n    await importBooks(selectedFiles, groupId);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  useEffect(() => {\n    eventDispatcher.on('import-book-files', handleImportBookFiles);\n    return () => {\n      eventDispatcher.off('import-book-files', handleImportBookFiles);\n    };\n  }, [handleImportBookFiles]);\n\n  useEffect(() => {\n    refreshGroups();\n    if (!libraryBooks.some((book) => !book.deletedAt)) {\n      handleSetSelectMode(false);\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [libraryBooks]);\n\n  const processOpenWithFiles = useCallback(\n    async (appService: AppService, openWithFiles: string[], libraryBooks: Book[]) => {\n      const settings = await appService.loadSettings();\n      const bookIds: string[] = [];\n      for (const file of openWithFiles) {\n        console.log('Open with book:', file);\n        try {\n          const temp = appService.isMobile ? false : !settings.autoImportBooksOnOpen;\n          const book = await appService.importBook(file, libraryBooks, true, true, false, temp);\n          if (book) {\n            bookIds.push(book.hash);\n          }\n          if (user && book && !temp && !book.uploadedAt && settings.autoUpload) {\n            setTimeout(() => {\n              console.log('Queueing upload for book:', book.title);\n              transferManager.queueUpload(book);\n              // wait for the initialization of the transfer manager and opening of the book\n            }, 3000);\n          }\n        } catch (error) {\n          console.log('Failed to import book:', file, error);\n        }\n      }\n      setLibrary(libraryBooks);\n      appService.saveLibraryBooks(libraryBooks);\n\n      console.log('Opening books:', bookIds);\n      if (bookIds.length > 0) {\n        setPendingNavigationBookIds(bookIds);\n        return true;\n      }\n      return false;\n    },\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    [],\n  );\n\n  const handleOpenLastBooks = async (\n    appService: AppService,\n    lastBookIds: string[],\n    libraryBooks: Book[],\n  ) => {\n    if (lastBookIds.length === 0) return false;\n    const bookIds: string[] = [];\n    for (const bookId of lastBookIds) {\n      const book = libraryBooks.find((b) => b.hash === bookId);\n      if (book && (await appService.isBookAvailable(book))) {\n        bookIds.push(book.hash);\n      }\n    }\n    console.log('Opening last books:', bookIds);\n    if (bookIds.length > 0) {\n      setPendingNavigationBookIds(bookIds);\n      return true;\n    }\n    return false;\n  };\n\n  const handleShowOPDSDialog = () => {\n    setShowCatalogManager(true);\n  };\n\n  const handleDismissOPDSDialog = () => {\n    setShowCatalogManager(false);\n    const params = new URLSearchParams(searchParams?.toString());\n    params.delete('opds');\n    navigateToLibrary(router, `${params.toString()}`);\n  };\n\n  useEffect(() => {\n    if (pendingNavigationBookIds) {\n      const bookIds = pendingNavigationBookIds;\n      setPendingNavigationBookIds(null);\n      if (bookIds.length > 0) {\n        navigateToReader(router, bookIds);\n      }\n    }\n  }, [pendingNavigationBookIds, appService, router]);\n\n  useEffect(() => {\n    if (isInitiating.current) return;\n    isInitiating.current = true;\n\n    const initLogin = async () => {\n      const appService = await envConfig.getAppService();\n      const settings = await appService.loadSettings();\n      if (token && user) {\n        if (!settings.keepLogin) {\n          settings.keepLogin = true;\n          setSettings(settings);\n          saveSettings(envConfig, settings);\n        }\n      } else if (settings.keepLogin) {\n        router.push('/auth');\n      }\n    };\n\n    const loadingTimeout = setTimeout(() => setLoading(true), 300);\n    const initLibrary = async () => {\n      const appService = await envConfig.getAppService();\n      const settings = await appService.loadSettings();\n      setSettings(settings);\n\n      // Reuse the library from the store when we return from the reader\n      const library = libraryBooks.length > 0 ? libraryBooks : await appService.loadLibraryBooks();\n      let opened = false;\n      if (checkOpenWithBooks) {\n        opened = await handleOpenWithBooks(appService, library);\n      }\n      setCheckOpenWithBooks(opened);\n      if (!opened && checkLastOpenBooks && settings.openLastBooks) {\n        opened = await handleOpenLastBooks(appService, settings.lastOpenBooks, library);\n      }\n      setCheckLastOpenBooks(opened);\n\n      setLibrary(library);\n      setLibraryLoaded(true);\n      if (loadingTimeout) clearTimeout(loadingTimeout);\n      setLoading(false);\n    };\n\n    const handleOpenWithBooks = async (appService: AppService, library: Book[]) => {\n      const openWithFiles = (await parseOpenWithFiles(appService)) || [];\n\n      if (openWithFiles.length > 0) {\n        return await processOpenWithFiles(appService, openWithFiles, library);\n      }\n      return false;\n    };\n\n    initLogin();\n    initLibrary();\n    return () => {\n      setCheckOpenWithBooks(false);\n      setCheckLastOpenBooks(false);\n      isInitiating.current = false;\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [searchParams]);\n\n  useEffect(() => {\n    const group = searchParams?.get('group') || '';\n    const groupName = getGroupName(group);\n    setCurrentGroupPath(groupName);\n  }, [libraryBooks, searchParams, getGroupName]);\n\n  useEffect(() => {\n    if (demoBooks.length > 0 && libraryLoaded) {\n      const newLibrary = [...libraryBooks];\n      for (const book of demoBooks) {\n        const idx = newLibrary.findIndex((b) => b.hash === book.hash);\n        if (idx === -1) {\n          newLibrary.push(book);\n        } else {\n          newLibrary[idx] = book;\n        }\n      }\n      setLibrary(newLibrary);\n      appService?.saveLibraryBooks(newLibrary);\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [demoBooks, libraryLoaded]);\n\n  const importBooks = async (files: SelectedFile[], groupId?: string) => {\n    setLoading(true);\n    const { library } = useLibraryStore.getState();\n    const failedImports: Array<{ filename: string; errorMessage: string }> = [];\n    const successfulImports: string[] = [];\n    const errorMap: [string, string][] = [\n      ['No chapters detected', _('No chapters detected')],\n      ['Failed to parse EPUB', _('Failed to parse the EPUB file')],\n      ['Unsupported format', _('This book format is not supported')],\n      ['Failed to open file', _('Failed to open the book file')],\n      ['Invalid or empty book file', _('The book file is empty')],\n      ['Unsupported or corrupted book file', _('The book file is corrupted')],\n    ];\n\n    const processFile = async (selectedFile: SelectedFile): Promise<Book | null> => {\n      const file = selectedFile.file || selectedFile.path;\n      if (!file) return null;\n      try {\n        const { path, basePath } = selectedFile;\n        let inferredGroupName = '';\n\n        if (groupId) {\n          inferredGroupName = getGroupName(groupId) || '';\n        } else if (path && basePath) {\n          const rootPath = getDirPath(basePath);\n          inferredGroupName = getDirPath(path).replace(rootPath, '').replace(/^\\//, '');\n        }\n\n        const book = await appService?.importBook(file, library, true, true, false, false, {\n          targetGroupName: inferredGroupName,\n        });\n        if (!book) return null;\n\n        if (groupId) {\n          book.groupId = groupId;\n          book.groupName = inferredGroupName;\n        } else if (inferredGroupName) {\n          book.groupName = inferredGroupName;\n          book.groupId = getGroupId(inferredGroupName);\n        }\n\n        if (user && !book.uploadedAt && settings.autoUpload) {\n          console.log('Queueing upload for book:', book.title);\n          transferManager.queueUpload(book);\n        }\n        successfulImports.push(book.title);\n        return book;\n      } catch (error) {\n        const filename = typeof file === 'string' ? file : file.name;\n        const baseFilename = getFilename(filename);\n        const errorMessage =\n          error instanceof Error\n            ? errorMap.find(([str]) => error.message.includes(str))?.[1] || error.message\n            : '';\n        failedImports.push({ filename: baseFilename, errorMessage });\n        console.error('Failed to import book:', filename, error);\n        return null;\n      }\n    };\n\n    const concurrency = 4;\n    for (let i = 0; i < files.length; i += concurrency) {\n      const batch = files.slice(i, i + concurrency);\n      const importedBooks = (await Promise.all(batch.map(processFile))).filter((book) => !!book);\n      await updateBooks(envConfig, importedBooks);\n    }\n\n    pushLibrary();\n\n    if (failedImports.length > 0) {\n      const filenames = failedImports.map((f) => f.filename);\n      const errorMessage = failedImports.find((f) => f.errorMessage)?.errorMessage || '';\n\n      eventDispatcher.dispatch('toast', {\n        message:\n          _('Failed to import book(s): {{filenames}}', {\n            filenames: listFormater(false).format(filenames),\n          }) + (errorMessage ? `\\n${errorMessage}` : ''),\n        timeout: 5000,\n        type: 'error',\n      });\n    } else if (successfulImports.length > 0) {\n      eventDispatcher.dispatch('toast', {\n        message: _('Successfully imported {{count}} book(s)', {\n          count: successfulImports.length,\n        }),\n        timeout: 2000,\n        type: 'success',\n      });\n    }\n\n    setLoading(false);\n  };\n\n  const updateBookTransferProgress = throttle((bookHash: string, progress: ProgressPayload) => {\n    if (progress.total === 0) return;\n    const progressPct = (progress.progress / progress.total) * 100;\n    setBooksTransferProgress((prev) => ({\n      ...prev,\n      [bookHash]: progressPct,\n    }));\n  }, 500);\n\n  const handleBookUpload = useCallback(\n    async (book: Book, _syncBooks = true) => {\n      // Use transfer queue for uploads - priority 1 for manual uploads (higher priority)\n      const transferId = transferManager.queueUpload(book, 1);\n      if (transferId) {\n        eventDispatcher.dispatch('toast', {\n          type: 'info',\n          timeout: 2000,\n          message: _('Upload queued: {{title}}', {\n            title: book.title,\n          }),\n        });\n        return true;\n      }\n      return false;\n    },\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    [],\n  );\n\n  const handleBookDownload = useCallback(\n    async (book: Book, downloadOptions: { redownload?: boolean; queued?: boolean } = {}) => {\n      // Cloud download functionality removed - using local server storage only\n      eventDispatcher.dispatch('toast', {\n        message: _('Cloud download has been removed. All books are stored locally on the server.'),\n        type: 'info',\n      });\n      return false;\n    },\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    [appService],\n  );\n\n  const handleBookDelete = (deleteAction: DeleteAction) => {\n    return async (book: Book, syncBooks = true) => {\n      const deletionMessages = {\n        both: _('Book deleted: {{title}}', { title: book.title }),\n        cloud: _('Deleted cloud backup of the book: {{title}}', { title: book.title }),\n        local: _('Deleted local copy of the book: {{title}}', { title: book.title }),\n      };\n      const deletionFailMessages = {\n        both: _('Failed to delete book: {{title}}', { title: book.title }),\n        cloud: _('Failed to delete cloud backup of the book: {{title}}', { title: book.title }),\n        local: _('Failed to delete local copy of the book: {{title}}', { title: book.title }),\n      };\n\n      try {\n        // Handle local deletion immediately\n        if (deleteAction === 'local' || deleteAction === 'both') {\n          await appService?.deleteBook(book, 'local');\n          if (deleteAction === 'both') {\n            book.deletedAt = Date.now();\n            book.downloadedAt = null;\n            book.coverDownloadedAt = null;\n          }\n          await updateBook(envConfig, book);\n          clearBookData(book.hash);\n          if (syncBooks) pushLibrary();\n        }\n\n        // Queue cloud deletion\n        if (deleteAction === 'cloud' || deleteAction === 'both') {\n          const transferId = transferManager.queueDelete(book, 1, true);\n          if (!transferId) {\n            throw new Error('Failed to queue cloud deletion');\n          }\n        }\n\n        eventDispatcher.dispatch('toast', {\n          type: 'info',\n          timeout: 1000,\n          message: deletionMessages[deleteAction],\n        });\n        return true;\n      } catch {\n        eventDispatcher.dispatch('toast', {\n          message: deletionFailMessages[deleteAction],\n          type: 'error',\n        });\n        return false;\n      }\n    };\n  };\n\n  const handleUpdateMetadata = async (book: Book, metadata: BookMetadata) => {\n    book.metadata = metadata;\n    book.title = formatTitle(metadata.title);\n    book.author = formatAuthors(metadata.author);\n    book.primaryLanguage = getPrimaryLanguage(metadata.language);\n    book.updatedAt = Date.now();\n    if (metadata.coverImageBlobUrl || metadata.coverImageUrl || metadata.coverImageFile) {\n      book.coverImageUrl = metadata.coverImageBlobUrl || metadata.coverImageUrl;\n      try {\n        await appService?.updateCoverImage(\n          book,\n          metadata.coverImageBlobUrl || metadata.coverImageUrl,\n          metadata.coverImageFile,\n        );\n      } catch (error) {\n        console.warn('Failed to update cover image:', error);\n      }\n    }\n    if (isWebAppPlatform()) {\n      // Clear HTTP cover image URL if cover is updated with a local file\n      if (metadata.coverImageBlobUrl) {\n        metadata.coverImageUrl = undefined;\n      }\n    } else {\n      metadata.coverImageUrl = undefined;\n    }\n    metadata.coverImageBlobUrl = undefined;\n    metadata.coverImageFile = undefined;\n    await updateBook(envConfig, book);\n  };\n\n  const handleImportBooksFromFiles = async () => {\n    setIsSelectMode(false);\n    console.log('Importing books from files...');\n    selectFiles({ type: 'books', multiple: true }).then((result) => {\n      if (result.files.length === 0 || result.error) return;\n      const groupId = searchParams?.get('group') || '';\n      importBooks(result.files, groupId);\n    });\n  };\n\n  const handleImportBooksFromDirectory = async () => {\n    if (!appService || !isTauriAppPlatform()) return;\n\n    setIsSelectMode(false);\n    console.log('Importing books from directory...');\n    let importDirectory: string | undefined = '';\n    if (appService.isAndroidApp) {\n      if (!(await requestStoragePermission())) return;\n      const response = await selectDirectory();\n      importDirectory = response.path;\n    } else {\n      const selectedDir = await appService.selectDirectory?.('read');\n      importDirectory = selectedDir;\n    }\n    if (!importDirectory) {\n      console.log('No directory selected');\n      return;\n    }\n    const files = await appService.readDirectory(importDirectory, 'None');\n    const supportedFiles = files.filter((file) => {\n      const ext = file.path.split('.').pop()?.toLowerCase() || '';\n      return SUPPORTED_BOOK_EXTS.includes(ext);\n    });\n    const toImportFiles = await Promise.all(\n      supportedFiles.map(async (file) => {\n        return {\n          path: await joinPaths(importDirectory, file.path),\n          basePath: importDirectory,\n        };\n      }),\n    );\n    importBooks(toImportFiles, undefined);\n  };\n\n  const handleSetSelectMode = (selectMode: boolean) => {\n    if (selectMode && appService?.hasHaptics) {\n      impactFeedback('medium');\n    }\n    setIsSelectMode(selectMode);\n    setIsSelectAll(false);\n    setIsSelectNone(false);\n  };\n\n  const handleSelectAll = () => {\n    setIsSelectAll(true);\n    setIsSelectNone(false);\n  };\n\n  const handleDeselectAll = () => {\n    setIsSelectNone(true);\n    setIsSelectAll(false);\n  };\n\n  const handleShowDetailsBook = (book: Book) => {\n    setShowDetailsBook(book);\n  };\n\n  const handleNavigateToPath = (path: string | undefined) => {\n    const group = path ? getGroupId(path) : '';\n    const params = new URLSearchParams(searchParams?.toString());\n    if (group) {\n      params.set('group', group);\n    } else {\n      params.delete('group');\n    }\n    setIsSelectAll(false);\n    setIsSelectNone(false);\n    navigateToLibrary(router, `${params.toString()}`);\n    setTimeout(() => {\n      setCurrentGroupPath(path);\n    }, 300);\n  };\n\n  if (!appService || !insets || checkOpenWithBooks || checkLastOpenBooks) {\n    return <div className={clsx('full-height', !appService?.isLinuxApp && 'bg-base-200')} />;\n  }\n\n  const showBookshelf = libraryLoaded || libraryBooks.length > 0;\n\n  return (\n    <div\n      ref={pageRef}\n      aria-label='Your Library'\n      className={clsx(\n        'library-page text-base-content full-height flex select-none flex-col overflow-hidden',\n        viewSettings?.isEink ? 'bg-base-100' : 'bg-base-200',\n        appService?.hasRoundedWindow && isRoundedWindow && 'window-border rounded-window',\n      )}\n    >\n      <div\n        className='relative top-0 z-40 w-full'\n        role='banner'\n        tabIndex={-1}\n        aria-label={_('Library Header')}\n      >\n        <LibraryHeader\n          isSelectMode={isSelectMode}\n          isSelectAll={isSelectAll}\n          onImportBooksFromFiles={handleImportBooksFromFiles}\n          onImportBooksFromDirectory={\n            appService?.canReadExternalDir ? handleImportBooksFromDirectory : undefined\n          }\n          onOpenCatalogManager={handleShowOPDSDialog}\n          onToggleSelectMode={() => handleSetSelectMode(!isSelectMode)}\n          onSelectAll={handleSelectAll}\n          onDeselectAll={handleDeselectAll}\n          onReconcilePaths={() => setShowReconcileModal(true)}\n        />\n        <progress\n          className={clsx(\n            'progress progress-success absolute bottom-0 left-0 right-0 h-1 translate-y-[2px] transition-opacity duration-200 sm:translate-y-[4px]',\n            isSyncing ? 'opacity-100' : 'opacity-0',\n          )}\n          value={syncProgress * 100}\n          max='100'\n        />\n      </div>\n      {(loading || isSyncing) && (\n        <div className='fixed inset-0 z-50 flex items-center justify-center'>\n          <Spinner loading />\n        </div>\n      )}\n      {currentGroupPath && (\n        <div\n          className={`transition-all duration-300 ease-in-out ${currentGroupPath ? 'opacity-100' : 'max-h-0 opacity-0'\n            }`}\n        >\n          <div className='flex flex-wrap items-center gap-y-1 px-4 text-base'>\n            <button\n              onClick={() => handleNavigateToPath(undefined)}\n              className='hover:bg-base-300 text-base-content/85 rounded px-2 py-1'\n            >\n              {_('All')}\n            </button>\n            {getBreadcrumbs(currentGroupPath).map((crumb, index, array) => {\n              const isLast = index === array.length - 1;\n              return (\n                <React.Fragment key={index}>\n                  <MdChevronRight size={iconSize} className='text-neutral-content' />\n                  {isLast ? (\n                    <span className='truncate rounded px-2 py-1'>{crumb.name}</span>\n                  ) : (\n                    <button\n                      onClick={() => handleNavigateToPath(crumb.path)}\n                      className='hover:bg-base-300 text-base-content/85 truncate rounded px-2 py-1'\n                    >\n                      {crumb.name}\n                    </button>\n                  )}\n                </React.Fragment>\n              );\n            })}\n          </div>\n        </div>\n      )}\n      {showBookshelf &&\n        (libraryBooks.some((book) => !book.deletedAt) ? (\n          <OverlayScrollbarsComponent\n            defer\n            aria-label=''\n            ref={osRef}\n            className='flex-grow'\n            options={{ scrollbars: { autoHide: 'scroll' } }}\n            events={{\n              initialized: (instance) => {\n                const { content } = instance.elements();\n                if (content) {\n                  containerRef.current = content as HTMLDivElement;\n                }\n              },\n            }}\n          >\n            <div\n              className={clsx('scroll-container drop-zone flex-grow', isDragging && 'drag-over')}\n              style={{\n                paddingTop: '0px',\n                paddingRight: `${insets.right}px`,\n                paddingBottom: `${insets.bottom}px`,\n                paddingLeft: `${insets.left}px`,\n              }}\n            >\n              <DropIndicator />\n              <Bookshelf\n                libraryBooks={libraryBooks}\n                isSelectMode={isSelectMode}\n                isSelectAll={isSelectAll}\n                isSelectNone={isSelectNone}\n                handleImportBooks={handleImportBooksFromFiles}\n                handleBookUpload={handleBookUpload}\n                handleBookDownload={handleBookDownload}\n                handleBookDelete={handleBookDelete('both')}\n                handleSetSelectMode={handleSetSelectMode}\n                handleShowDetailsBook={handleShowDetailsBook}\n                booksTransferProgress={booksTransferProgress}\n                handlePushLibrary={pushLibrary}\n              />\n            </div>\n          </OverlayScrollbarsComponent>\n        ) : (\n          <div className='hero drop-zone h-screen items-center justify-center'>\n            <DropIndicator />\n            <div className='hero-content text-neutral-content text-center'>\n              <div className='max-w-md'>\n                <h1 className='mb-5 text-5xl font-bold'>{_('Your Library')}</h1>\n                <p className='mb-5'>\n                  {_(\n                    'Welcome to your library. You can import your books here and read them anytime.',\n                  )}\n                </p>\n                <button className='btn btn-primary rounded-xl' onClick={handleImportBooksFromFiles}>\n                  {_('Import Books')}\n                </button>\n              </div>\n            </div>\n          </div>\n        ))}\n      {showDetailsBook && (\n        <BookDetailModal\n          isOpen={!!showDetailsBook}\n          book={showDetailsBook}\n          onClose={() => setShowDetailsBook(null)}\n          handleBookUpload={handleBookUpload}\n          handleBookDownload={handleBookDownload}\n          handleBookDelete={handleBookDelete('both')}\n          handleBookDeleteCloudBackup={handleBookDelete('cloud')}\n          handleBookDeleteLocalCopy={handleBookDelete('local')}\n          handleBookMetadataUpdate={handleUpdateMetadata}\n        />\n      )}\n      {isTransferQueueOpen && (\n        <ModalPortal>\n          <TransferQueuePanel />\n        </ModalPortal>\n      )}\n      <AboutWindow />\n      <UpdaterWindow />\n      <MigrateDataWindow />\n      {isSettingsDialogOpen && <SettingsDialog bookKey={''} />}\n      {showCatalogManager && <CatalogDialog onClose={handleDismissOPDSDialog} />}\n      {showReconcileModal && appService && (\n        <ReconcileModal\n          isOpen={showReconcileModal}\n          onClose={() => setShowReconcileModal(false)}\n          onConfirm={(results) => {\n            console.log('Ê†°ÂáÜÂÆåÊàêÔºåÊõ¥Êñ∞‰∫Ü', results.length, 'Êú¨‰π¶');\n            setShowReconcileModal(false);\n            handleRefreshLibrary();\n          }}\n          reconcileBookPaths={appService.reconcileBookPaths.bind(appService)}\n          applyReconciliation={appService.applyReconciliation.bind(appService)}\n          books={libraryBooks}\n        />\n      )}\n      <Toast />\n    </div>\n  );\n};\n\nconst LibraryPage = () => {\n  return (\n    <Suspense fallback={<div className='full-height' />}>\n      <LibraryPageWithSearchParams />\n    </Suspense>\n  );\n};\n\nexport default LibraryPage;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 8112, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/app/page.tsx"],"sourcesContent":["'use client';\n\nimport LibraryPage from './library/page';\n\nexport default function HomePage() {\n  return <LibraryPage />;\n}\n"],"names":[],"mappings":";;;;;AAEA;AAFA;;;AAIe,SAAS;IACtB,qBAAO,+VAAC,sKAAW;;;;;AACrB;KAFwB"}}]
}