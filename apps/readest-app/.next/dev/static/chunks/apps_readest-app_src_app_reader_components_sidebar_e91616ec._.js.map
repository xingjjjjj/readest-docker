{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/app/reader/components/sidebar/BookMenu.tsx"],"sourcesContent":["'use client';\n\nimport clsx from 'clsx';\nimport React from 'react';\nimport Image from 'next/image';\n\nimport { MdCheck } from 'react-icons/md';\nimport { useRouter } from 'next/navigation';\nimport { useEnv } from '@/context/EnvContext';\nimport { useAuth } from '@/context/AuthContext';\nimport { useReaderStore } from '@/store/readerStore';\nimport { useLibraryStore } from '@/store/libraryStore';\nimport { useSidebarStore } from '@/store/sidebarStore';\nimport { useTranslation } from '@/hooks/useTranslation';\nimport { useSettingsStore } from '@/store/settingsStore';\nimport { useParallelViewStore } from '@/store/parallelViewStore';\nimport { isWebAppPlatform } from '@/services/environment';\nimport { eventDispatcher } from '@/utils/event';\nimport { FIXED_LAYOUT_FORMATS } from '@/types/book';\nimport { DOWNLOAD_READEST_URL } from '@/services/constants';\nimport { navigateToLogin } from '@/utils/nav';\nimport { saveSysSettings } from '@/helpers/settings';\nimport { setKOSyncSettingsWindowVisible } from '@/app/reader/components/KOSyncSettings';\nimport { setProofreadRulesVisibility } from '@/app/reader/components/ProofreadRules';\nimport { setAboutDialogVisible } from '@/components/AboutWindow';\nimport useBooksManager from '../../hooks/useBooksManager';\nimport MenuItem from '@/components/MenuItem';\nimport Menu from '@/components/Menu';\n\ninterface BookMenuProps {\n  menuClassName?: string;\n  setIsDropdownOpen?: (isOpen: boolean) => void;\n}\n\nconst BookMenu: React.FC<BookMenuProps> = ({ menuClassName, setIsDropdownOpen }) => {\n  const _ = useTranslation();\n  const router = useRouter();\n  const { envConfig, appService } = useEnv();\n  const { user } = useAuth();\n  const { settings } = useSettingsStore();\n  const { bookKeys, recreateViewer, getViewSettings, setViewSettings } = useReaderStore();\n  const { getVisibleLibrary } = useLibraryStore();\n  const { openParallelView } = useBooksManager();\n  const { sideBarBookKey } = useSidebarStore();\n  const { parallelViews, setParallel, unsetParallel } = useParallelViewStore();\n  const viewSettings = getViewSettings(sideBarBookKey!);\n\n  const [isSortedTOC, setIsSortedTOC] = React.useState(viewSettings?.sortedTOC || false);\n\n  const handleParallelView = (id: string) => {\n    openParallelView(id);\n    setIsDropdownOpen?.(false);\n  };\n  const handleReloadPage = () => {\n    window.location.reload();\n    setIsDropdownOpen?.(false);\n  };\n  const showAboutReadest = () => {\n    setAboutDialogVisible(true);\n    setIsDropdownOpen?.(false);\n  };\n  const downloadReadest = () => {\n    window.open(DOWNLOAD_READEST_URL, '_blank');\n    setIsDropdownOpen?.(false);\n  };\n  const handleExportAnnotations = () => {\n    eventDispatcher.dispatch('export-annotations', { bookKey: sideBarBookKey });\n    setIsDropdownOpen?.(false);\n  };\n  const handleToggleSortTOC = () => {\n    setIsSortedTOC((prev) => !prev);\n    setIsDropdownOpen?.(false);\n    if (sideBarBookKey) {\n      const viewSettings = getViewSettings(sideBarBookKey)!;\n      viewSettings.sortedTOC = !isSortedTOC;\n      setViewSettings(sideBarBookKey, viewSettings);\n      recreateViewer(envConfig, sideBarBookKey);\n    }\n  };\n  const handleSetParallel = () => {\n    setParallel(bookKeys);\n    setIsDropdownOpen?.(false);\n  };\n  const handleUnsetParallel = () => {\n    unsetParallel(bookKeys);\n    setIsDropdownOpen?.(false);\n  };\n  const showKoSyncSettingsWindow = () => {\n    setKOSyncSettingsWindowVisible(true);\n    setIsDropdownOpen?.(false);\n  };\n  const showProofreadRulesWindow = () => {\n    setProofreadRulesVisibility(true);\n    setIsDropdownOpen?.(false);\n  };\n  const handlePullKOSync = () => {\n    eventDispatcher.dispatch('pull-kosync', { bookKey: sideBarBookKey });\n    setIsDropdownOpen?.(false);\n  };\n  const handlePushKOSync = () => {\n    eventDispatcher.dispatch('push-kosync', { bookKey: sideBarBookKey });\n    setIsDropdownOpen?.(false);\n  };\n  const toggleDiscordPresence = () => {\n    const discordRichPresenceEnabled = !settings.discordRichPresenceEnabled;\n    saveSysSettings(envConfig, 'discordRichPresenceEnabled', discordRichPresenceEnabled);\n    setIsDropdownOpen?.(false);\n    if (discordRichPresenceEnabled && !user) {\n      navigateToLogin(router);\n    }\n  };\n\n  return (\n    <Menu\n      className={clsx('book-menu dropdown-content z-20 shadow-2xl', menuClassName)}\n      onCancel={() => setIsDropdownOpen?.(false)}\n    >\n      <MenuItem\n        label={_('Parallel Read')}\n        buttonClass={bookKeys.length > 1 ? 'lg:tooltip lg:tooltip-bottom' : ''}\n        tooltip={parallelViews.length > 0 ? _('Disable') : bookKeys.length > 1 ? _('Enable') : ''}\n        Icon={parallelViews.length > 0 && bookKeys.length > 1 ? MdCheck : undefined}\n        onClick={\n          parallelViews.length > 0\n            ? handleUnsetParallel\n            : bookKeys.length > 1\n              ? handleSetParallel\n              : undefined\n        }\n      >\n        <ul className='max-h-60 overflow-y-auto'>\n          {getVisibleLibrary()\n            .filter((book) => !FIXED_LAYOUT_FORMATS.has(book.format))\n            .filter((book) => !!book.downloadedAt)\n            .slice(0, 20)\n            .map((book) => (\n              <MenuItem\n                key={book.hash}\n                Icon={\n                  <Image\n                    src={book.coverImageUrl!}\n                    alt={book.title}\n                    width={56}\n                    height={80}\n                    className='aspect-auto max-h-8 max-w-4 rounded-sm shadow-md'\n                    onError={(e) => {\n                      (e.target as HTMLImageElement).style.display = 'none';\n                    }}\n                  />\n                }\n                label={book.title}\n                labelClass='max-w-36'\n                onClick={() => handleParallelView(book.hash)}\n              />\n            ))}\n        </ul>\n      </MenuItem>\n      {bookKeys.length > 1 &&\n        (parallelViews.length > 0 ? (\n          <MenuItem label={_('Exit Parallel Read')} onClick={handleUnsetParallel} />\n        ) : (\n          <MenuItem label={_('Enter Parallel Read')} onClick={handleSetParallel} />\n        ))}\n      <hr className='border-base-200 my-1' />\n      <MenuItem label={_('KOReader Sync')} onClick={showKoSyncSettingsWindow} />\n      {settings.kosync.enabled && (\n        <>\n          <MenuItem label={_('Push Progress')} onClick={handlePushKOSync} />\n          <MenuItem label={_('Pull Progress')} onClick={handlePullKOSync} />\n        </>\n      )}\n      {appService?.isDesktopApp && (\n        <>\n          <hr className='border-base-200 my-1' />\n          <MenuItem\n            label={_('Show on Discord')}\n            tooltip={_(\"Display what I'm reading on Discord\")}\n            toggled={settings.discordRichPresenceEnabled}\n            onClick={toggleDiscordPresence}\n          />\n        </>\n      )}\n      <hr className='border-base-200 my-1' />\n      <MenuItem label={_('Proofread')} onClick={showProofreadRulesWindow} />\n      <hr className='border-base-200 my-1' />\n      <MenuItem label={_('Export Annotations')} onClick={handleExportAnnotations} />\n      <MenuItem\n        label={_('Sort TOC by Page')}\n        Icon={isSortedTOC ? MdCheck : undefined}\n        onClick={handleToggleSortTOC}\n      />\n      <MenuItem label={_('Reload Page')} shortcut='Shift+R' onClick={handleReloadPage} />\n      <hr className='border-base-200 my-1' />\n      {isWebAppPlatform() && <MenuItem label={_('Download Readest')} onClick={downloadReadest} />}\n      <MenuItem label={_('About Readest')} onClick={showAboutReadest} />\n    </Menu>\n  );\n};\n\nexport default BookMenu;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 363, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/app/reader/components/sidebar/Header.tsx"],"sourcesContent":["import clsx from 'clsx';\nimport React from 'react';\nimport { GiBookshelf } from 'react-icons/gi';\nimport { FiSearch } from 'react-icons/fi';\nimport { MdOutlineMenu, MdOutlinePushPin, MdPushPin } from 'react-icons/md';\nimport { MdArrowBackIosNew } from 'react-icons/md';\nimport { useTranslation } from '@/hooks/useTranslation';\nimport { useTrafficLight } from '@/hooks/useTrafficLight';\nimport { useResponsiveSize } from '@/hooks/useResponsiveSize';\nimport Dropdown from '@/components/Dropdown';\nimport BookMenu from './BookMenu';\n\nconst SidebarHeader: React.FC<{\n  isPinned: boolean;\n  isSearchBarVisible: boolean;\n  onGoToLibrary: () => void;\n  onClose: () => void;\n  onTogglePin: () => void;\n  onToggleSearchBar: () => void;\n}> = ({ isPinned, isSearchBarVisible, onGoToLibrary, onClose, onTogglePin, onToggleSearchBar }) => {\n  const _ = useTranslation();\n  const { isTrafficLightVisible } = useTrafficLight();\n  const iconSize14 = useResponsiveSize(14);\n  const iconSize18 = useResponsiveSize(18);\n  const iconSize22 = useResponsiveSize(22);\n\n  return (\n    <div\n      className={clsx(\n        'sidebar-header flex h-11 items-center justify-between pe-2',\n        isTrafficLightVisible ? 'ps-1.5 sm:ps-20' : 'ps-1.5',\n      )}\n      dir='ltr'\n    >\n      <div className='flex items-center gap-x-8'>\n        <button\n          title={_('Close')}\n          onClick={onClose}\n          className={'btn btn-ghost btn-circle flex h-6 min-h-6 w-6 hover:bg-transparent sm:hidden'}\n        >\n          <MdArrowBackIosNew size={iconSize22} />\n        </button>\n        <button\n          title={_('Go to Library')}\n          className='btn btn-ghost hidden h-8 min-h-8 w-8 p-0 sm:flex'\n          onClick={onGoToLibrary}\n        >\n          <GiBookshelf className='fill-base-content' />\n        </button>\n      </div>\n      <div className='flex min-w-24 max-w-32 items-center justify-between sm:size-[70%]'>\n        <button\n          title={isSearchBarVisible ? _('Hide Search Bar') : _('Show Search Bar')}\n          onClick={onToggleSearchBar}\n          className={clsx(\n            'btn btn-ghost left-0 h-8 min-h-8 w-8 p-0',\n            isSearchBarVisible ? 'bg-base-300' : '',\n          )}\n        >\n          <FiSearch size={iconSize18} className='text-base-content' />\n        </button>\n        <Dropdown\n          label={_('Book Menu')}\n          className={clsx(\n            window.innerWidth < 640 && 'dropdown-end',\n            'dropdown-bottom flex justify-center',\n          )}\n          menuClassName={window.innerWidth < 640 ? 'no-triangle mt-1' : 'dropdown-center mt-1'}\n          buttonClassName='btn btn-ghost h-8 min-h-8 w-8 p-0'\n          toggleButton={<MdOutlineMenu className='fill-base-content' />}\n        >\n          <BookMenu />\n        </Dropdown>\n        <div className='right-0 hidden h-8 w-8 items-center justify-center sm:flex'>\n          <button\n            title={isPinned ? _('Unpin Sidebar') : _('Pin Sidebar')}\n            onClick={onTogglePin}\n            className={clsx(\n              'sidebar-pin-btn btn btn-ghost btn-circle hidden h-6 min-h-6 w-6 sm:flex',\n              isPinned ? 'bg-base-300' : 'bg-base-300/65',\n            )}\n          >\n            {isPinned ? <MdPushPin size={iconSize14} /> : <MdOutlinePushPin size={iconSize14} />}\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default SidebarHeader;\n"],"names":[],"mappings":";;;;;AAAA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AAEA,MAAM,gBAOD,CAAC,EAAE,QAAQ,EAAE,kBAAkB,EAAE,aAAa,EAAE,OAAO,EAAE,WAAW,EAAE,iBAAiB,EAAE;;IAC5F,MAAM,IAAI,IAAA,sKAAc;IACxB,MAAM,EAAE,qBAAqB,EAAE,GAAG,IAAA,wKAAe;IACjD,MAAM,aAAa,IAAA,4KAAiB,EAAC;IACrC,MAAM,aAAa,IAAA,4KAAiB,EAAC;IACrC,MAAM,aAAa,IAAA,4KAAiB,EAAC;IAErC,qBACE,6MAAC;QACC,WAAW,IAAA,6LAAI,EACb,8DACA,wBAAwB,oBAAoB;QAE9C,KAAI;;0BAEJ,6MAAC;gBAAI,WAAU;;kCACb,6MAAC;wBACC,OAAO,EAAE;wBACT,SAAS;wBACT,WAAW;kCAEX,cAAA,6MAAC,gPAAiB;4BAAC,MAAM;;;;;;;;;;;kCAE3B,6MAAC;wBACC,OAAO,EAAE;wBACT,WAAU;wBACV,SAAS;kCAET,cAAA,6MAAC,0OAAW;4BAAC,WAAU;;;;;;;;;;;;;;;;;0BAG3B,6MAAC;gBAAI,WAAU;;kCACb,6MAAC;wBACC,OAAO,qBAAqB,EAAE,qBAAqB,EAAE;wBACrD,SAAS;wBACT,WAAW,IAAA,6LAAI,EACb,4CACA,qBAAqB,gBAAgB;kCAGvC,cAAA,6MAAC,uOAAQ;4BAAC,MAAM;4BAAY,WAAU;;;;;;;;;;;kCAExC,6MAAC,+JAAQ;wBACP,OAAO,EAAE;wBACT,WAAW,IAAA,6LAAI,EACb,OAAO,UAAU,GAAG,OAAO,gBAC3B;wBAEF,eAAe,OAAO,UAAU,GAAG,MAAM,qBAAqB;wBAC9D,iBAAgB;wBAChB,4BAAc,6MAAC,4OAAa;4BAAC,WAAU;;;;;;kCAEvC,cAAA,6MAAC,2LAAQ;;;;;;;;;;kCAEX,6MAAC;wBAAI,WAAU;kCACb,cAAA,6MAAC;4BACC,OAAO,WAAW,EAAE,mBAAmB,EAAE;4BACzC,SAAS;4BACT,WAAW,IAAA,6LAAI,EACb,2EACA,WAAW,gBAAgB;sCAG5B,yBAAW,6MAAC,wOAAS;gCAAC,MAAM;;;;;yFAAiB,6MAAC,+OAAgB;gCAAC,MAAM;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAMlF;GA5EM;;QAQM,sKAAc;QACU,wKAAe;QAC9B,4KAAiB;QACjB,4KAAiB;QACjB,4KAAiB;;;KAZhC;uCA8ES"}},
    {"offset": {"line": 545, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/app/reader/components/sidebar/TOCItem.tsx"],"sourcesContent":["'use client';\n\nimport clsx from 'clsx';\nimport React, { useCallback } from 'react';\nimport { ListChildComponentProps } from 'react-window';\nimport { TOCItem } from '@/libs/document';\nimport { getContentMd5 } from '@/utils/misc';\n\nconst createExpanderIcon = (isExpanded: boolean) => {\n  return (\n    <svg\n      viewBox='0 0 8 10'\n      width='8'\n      height='10'\n      className={clsx(\n        'text-base-content transform transition-transform',\n        isExpanded ? 'rotate-90' : 'rotate-0',\n      )}\n      style={{ transformOrigin: 'center' }}\n      fill='currentColor'\n    >\n      <polygon points='0 0, 8 5, 0 10' />\n    </svg>\n  );\n};\n\nexport interface FlatTOCItem {\n  item: TOCItem;\n  depth: number;\n  index: number;\n  isExpanded?: boolean;\n}\n\nconst TOCItemView = React.memo<{\n  bookKey: string;\n  flatItem: FlatTOCItem;\n  itemSize?: number;\n  isActive: boolean;\n  onToggleExpand: (item: TOCItem) => void;\n  onItemClick: (item: TOCItem) => void;\n}>(({ flatItem, itemSize, isActive, onToggleExpand, onItemClick }) => {\n  const { item, depth } = flatItem;\n\n  const handleToggleExpand = useCallback(\n    (event: React.MouseEvent) => {\n      event.preventDefault();\n      event.stopPropagation();\n      onToggleExpand(item);\n    },\n    [item, onToggleExpand],\n  );\n\n  const handleClickItem = useCallback(\n    (event: React.MouseEvent | React.KeyboardEvent) => {\n      event.preventDefault();\n      onItemClick(item);\n    },\n    [item, onItemClick],\n  );\n\n  return (\n    <div\n      tabIndex={0}\n      role='treeitem'\n      onClick={item.href ? handleClickItem : undefined}\n      onKeyDown={item.href ? (e) => e.key === 'Enter' && handleClickItem(e) : undefined}\n      aria-expanded={flatItem.isExpanded ? 'true' : 'false'}\n      aria-selected={isActive ? 'true' : 'false'}\n      data-href={item.href ? getContentMd5(item.href) : undefined}\n      className={clsx(\n        'flex w-full cursor-pointer items-center rounded-md py-4 sm:py-2',\n        isActive\n          ? 'text-bold-in-eink sm:bg-base-300/65 sm:hover:bg-base-300/75 sm:text-base-content text-blue-500'\n          : 'sm:hover:bg-base-300/75',\n      )}\n      style={{\n        height: itemSize ? `${itemSize}px` : 'auto',\n        paddingInlineStart: `${(depth + 1) * 12}px`,\n      }}\n    >\n      {item.subitems && (\n        <button\n          onClick={handleToggleExpand}\n          onKeyDown={(e) => {\n            e.stopPropagation();\n          }}\n          className='inline-block cursor-pointer'\n          style={{\n            padding: '12px',\n            margin: '-12px',\n          }}\n        >\n          {createExpanderIcon(flatItem.isExpanded || false)}\n        </button>\n      )}\n      <div\n        className='ms-2 truncate text-ellipsis'\n        style={{\n          maxWidth: 'calc(100% - 24px)',\n          whiteSpace: 'nowrap',\n          textOverflow: 'ellipsis',\n        }}\n      >\n        {item.label}\n      </div>\n      {item.location && (\n        <div className='text-base-content/50 ms-auto ps-1 text-xs sm:pe-1'>\n          {item.location.current + 1}\n        </div>\n      )}\n    </div>\n  );\n});\n\nTOCItemView.displayName = 'TOCItemView';\n\ninterface ListRowProps {\n  bookKey: string;\n  flatItem: FlatTOCItem;\n  itemSize?: number;\n  activeHref: string | null;\n  onToggleExpand: (item: TOCItem) => void;\n  onItemClick: (item: TOCItem) => void;\n}\n\nexport const StaticListRow: React.FC<ListRowProps> = ({\n  bookKey,\n  flatItem,\n  itemSize,\n  activeHref,\n  onToggleExpand,\n  onItemClick,\n}) => {\n  const isActive = activeHref === flatItem.item.href;\n\n  return (\n    <div\n      className={clsx(\n        'border-base-300 w-full border-b sm:border-none',\n        'pe-4 ps-2 pt-[1px] sm:pe-2',\n      )}\n      title={flatItem.item.label || ''}\n    >\n      <TOCItemView\n        bookKey={bookKey}\n        flatItem={flatItem}\n        itemSize={itemSize}\n        isActive={isActive}\n        onToggleExpand={onToggleExpand}\n        onItemClick={onItemClick}\n      />\n    </div>\n  );\n};\n\nexport const VirtualListRow: React.FC<\n  ListChildComponentProps & {\n    data: {\n      bookKey: string;\n      flatItems: FlatTOCItem[];\n      itemSize: number;\n      activeHref: string | null;\n      onToggleExpand: (item: TOCItem) => void;\n      onItemClick: (item: TOCItem) => void;\n    };\n  }\n> = ({ index, style, data }) => {\n  const { flatItems, bookKey, activeHref, itemSize, onToggleExpand, onItemClick } = data;\n  const flatItem = flatItems[index];\n\n  return (\n    <div style={style} title={flatItem.item.label || ''}>\n      <StaticListRow\n        bookKey={bookKey}\n        flatItem={flatItem}\n        itemSize={itemSize - 1}\n        activeHref={activeHref}\n        onToggleExpand={onToggleExpand}\n        onItemClick={onItemClick}\n      />\n    </div>\n  );\n};\n"],"names":[],"mappings":";;;;;;;AAEA;AACA;AAGA;;;AANA;;;;AAQA,MAAM,qBAAqB,CAAC;IAC1B,qBACE,6MAAC;QACC,SAAQ;QACR,OAAM;QACN,QAAO;QACP,WAAW,IAAA,6LAAI,EACb,oDACA,aAAa,cAAc;QAE7B,OAAO;YAAE,iBAAiB;QAAS;QACnC,MAAK;kBAEL,cAAA,6MAAC;YAAQ,QAAO;;;;;;;;;;;AAGtB;AASA,MAAM,4BAAc,wLAAK,CAAC,IAAI,IAO3B,CAAC,EAAE,QAAQ,EAAE,QAAQ,EAAE,QAAQ,EAAE,cAAc,EAAE,WAAW,EAAE;;IAC/D,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG;IAExB,MAAM,qBAAqB,IAAA,4LAAW;uDACpC,CAAC;YACC,MAAM,cAAc;YACpB,MAAM,eAAe;YACrB,eAAe;QACjB;sDACA;QAAC;QAAM;KAAe;IAGxB,MAAM,kBAAkB,IAAA,4LAAW;oDACjC,CAAC;YACC,MAAM,cAAc;YACpB,YAAY;QACd;mDACA;QAAC;QAAM;KAAY;IAGrB,qBACE,6MAAC;QACC,UAAU;QACV,MAAK;QACL,SAAS,KAAK,IAAI,GAAG,kBAAkB;QACvC,WAAW,KAAK,IAAI,GAAG,CAAC,IAAM,EAAE,GAAG,KAAK,WAAW,gBAAgB,KAAK;QACxE,iBAAe,SAAS,UAAU,GAAG,SAAS;QAC9C,iBAAe,WAAW,SAAS;QACnC,aAAW,KAAK,IAAI,GAAG,IAAA,2JAAa,EAAC,KAAK,IAAI,IAAI;QAClD,WAAW,IAAA,6LAAI,EACb,mEACA,WACI,mGACA;QAEN,OAAO;YACL,QAAQ,WAAW,GAAG,SAAS,EAAE,CAAC,GAAG;YACrC,oBAAoB,GAAG,CAAC,QAAQ,CAAC,IAAI,GAAG,EAAE,CAAC;QAC7C;;YAEC,KAAK,QAAQ,kBACZ,6MAAC;gBACC,SAAS;gBACT,WAAW,CAAC;oBACV,EAAE,eAAe;gBACnB;gBACA,WAAU;gBACV,OAAO;oBACL,SAAS;oBACT,QAAQ;gBACV;0BAEC,mBAAmB,SAAS,UAAU,IAAI;;;;;;0BAG/C,6MAAC;gBACC,WAAU;gBACV,OAAO;oBACL,UAAU;oBACV,YAAY;oBACZ,cAAc;gBAChB;0BAEC,KAAK,KAAK;;;;;;YAEZ,KAAK,QAAQ,kBACZ,6MAAC;gBAAI,WAAU;0BACZ,KAAK,QAAQ,CAAC,OAAO,GAAG;;;;;;;;;;;;AAKnC;KA/EM;AAiFN,YAAY,WAAW,GAAG;AAWnB,MAAM,gBAAwC,CAAC,EACpD,OAAO,EACP,QAAQ,EACR,QAAQ,EACR,UAAU,EACV,cAAc,EACd,WAAW,EACZ;IACC,MAAM,WAAW,eAAe,SAAS,IAAI,CAAC,IAAI;IAElD,qBACE,6MAAC;QACC,WAAW,IAAA,6LAAI,EACb,kDACA;QAEF,OAAO,SAAS,IAAI,CAAC,KAAK,IAAI;kBAE9B,cAAA,6MAAC;YACC,SAAS;YACT,UAAU;YACV,UAAU;YACV,UAAU;YACV,gBAAgB;YAChB,aAAa;;;;;;;;;;;AAIrB;MA5Ba;AA8BN,MAAM,iBAWT,CAAC,EAAE,KAAK,EAAE,KAAK,EAAE,IAAI,EAAE;IACzB,MAAM,EAAE,SAAS,EAAE,OAAO,EAAE,UAAU,EAAE,QAAQ,EAAE,cAAc,EAAE,WAAW,EAAE,GAAG;IAClF,MAAM,WAAW,SAAS,CAAC,MAAM;IAEjC,qBACE,6MAAC;QAAI,OAAO;QAAO,OAAO,SAAS,IAAI,CAAC,KAAK,IAAI;kBAC/C,cAAA,6MAAC;YACC,SAAS;YACT,UAAU;YACV,UAAU,WAAW;YACrB,YAAY;YACZ,gBAAgB;YAChB,aAAa;;;;;;;;;;;AAIrB;MA3Ba"}},
    {"offset": {"line": 726, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/app/reader/components/sidebar/TOCView.tsx"],"sourcesContent":["'use client';\n\nimport React, { useCallback, useEffect, useMemo, useRef, useState } from 'react';\nimport { FixedSizeList as VirtualList } from 'react-window';\n\nimport { useOverlayScrollbars } from 'overlayscrollbars-react';\nimport 'overlayscrollbars/overlayscrollbars.css';\nimport { SectionItem, TOCItem } from '@/libs/document';\nimport { useEnv } from '@/context/EnvContext';\nimport { useReaderStore } from '@/store/readerStore';\nimport { useSidebarStore } from '@/store/sidebarStore';\nimport { findParentPath } from '@/utils/toc';\nimport { eventDispatcher } from '@/utils/event';\nimport { getContentMd5 } from '@/utils/misc';\nimport { useTextTranslation } from '../../hooks/useTextTranslation';\nimport { FlatTOCItem, StaticListRow, VirtualListRow } from './TOCItem';\n\nconst getItemIdentifier = (item: TOCItem) => {\n  const href = item.href || '';\n  return `toc-item-${item.id}-${href}`;\n};\n\nconst useFlattenedTOC = (toc: TOCItem[], expandedItems: Set<string>) => {\n  return useMemo(() => {\n    const flattenTOC = (items: TOCItem[], depth = 0): FlatTOCItem[] => {\n      const result: FlatTOCItem[] = [];\n      items.forEach((item, index) => {\n        const isExpanded = expandedItems.has(getItemIdentifier(item));\n        result.push({ item, depth, index, isExpanded });\n        if (item.subitems && isExpanded) {\n          result.push(...flattenTOC(item.subitems, depth + 1));\n        }\n      });\n      return result;\n    };\n\n    return flattenTOC(toc);\n  }, [toc, expandedItems]);\n};\n\nconst TOCView: React.FC<{\n  bookKey: string;\n  toc: TOCItem[];\n  sections?: SectionItem[];\n}> = ({ bookKey, toc, sections }) => {\n  const { appService } = useEnv();\n  const { getView, getProgress, getViewSettings } = useReaderStore();\n  const { sideBarBookKey, isSideBarVisible } = useSidebarStore();\n  const viewSettings = getViewSettings(bookKey)!;\n  const progress = getProgress(bookKey);\n\n  const [expandedItems, setExpandedItems] = useState<Set<string>>(new Set());\n  const [containerHeight, setContainerHeight] = useState(400);\n\n  const hasInteractedWithTOCRef = useRef(false);\n  const lastInteractionTimeRef = useRef<number>(0);\n  const interactionCooldownMs = 10000;\n  const containerRef = useRef<HTMLDivElement | null>(null);\n  const listOuterRef = useRef<HTMLDivElement | null>(null);\n  const vitualListRef = useRef<VirtualList | null>(null);\n  const staticListRef = useRef<HTMLDivElement | null>(null);\n\n  const [initialize] = useOverlayScrollbars({\n    defer: true,\n    options: {\n      scrollbars: {\n        autoHide: 'scroll',\n      },\n      showNativeOverlaidScrollbars: false,\n    },\n    events: {\n      initialized(osInstance) {\n        const { viewport } = osInstance.elements();\n        viewport.style.overflowX = `var(--os-viewport-overflow-x)`;\n        viewport.style.overflowY = `var(--os-viewport-overflow-y)`;\n      },\n    },\n  });\n\n  const isInCooldown = useCallback(() => {\n    if (!hasInteractedWithTOCRef.current) return false;\n    const now = Date.now();\n    const timeSinceInteraction = now - lastInteractionTimeRef.current;\n    if (timeSinceInteraction >= interactionCooldownMs) {\n      hasInteractedWithTOCRef.current = false;\n      return false;\n    }\n    return true;\n  }, []);\n\n  const handleInteraction = useCallback(() => {\n    setTimeout(() => {\n      hasInteractedWithTOCRef.current = true;\n      lastInteractionTimeRef.current = Date.now();\n    }, 500);\n  }, []);\n\n  useEffect(() => {\n    const { current: root } = containerRef;\n    const { current: virtualOuter } = listOuterRef;\n\n    if (root && virtualOuter) {\n      initialize({\n        target: root,\n        elements: {\n          viewport: virtualOuter,\n        },\n      });\n\n      virtualOuter.addEventListener('scroll', handleInteraction);\n      return () => {\n        virtualOuter.removeEventListener('scroll', handleInteraction);\n      };\n    }\n    return;\n  }, [initialize, handleInteraction]);\n\n  useTextTranslation(\n    bookKey,\n    containerRef.current || staticListRef.current,\n    false,\n    'translation-target-toc',\n  );\n\n  useEffect(() => {\n    const updateHeight = () => {\n      if (containerRef.current) {\n        const rect = containerRef.current.getBoundingClientRect();\n        const parentContainer = containerRef.current.closest('.scroll-container');\n        if (parentContainer) {\n          const parentRect = parentContainer.getBoundingClientRect();\n          const availableHeight = parentRect.height - (rect.top - parentRect.top);\n          setContainerHeight(Math.max(400, availableHeight));\n        }\n      }\n    };\n    updateHeight();\n    window.addEventListener('resize', updateHeight);\n    let resizeObserver: ResizeObserver | null = null;\n    if (containerRef.current) {\n      const parentContainer = containerRef.current.closest('.scroll-container');\n      if (parentContainer) {\n        resizeObserver = new ResizeObserver(updateHeight);\n        resizeObserver.observe(parentContainer);\n      }\n    }\n\n    const staticList = staticListRef.current;\n    let scrollContainer: Element | null = null;\n\n    if (staticList) {\n      scrollContainer = staticList.parentElement;\n      if (scrollContainer) {\n        scrollContainer.addEventListener('scroll', handleInteraction);\n      }\n    }\n\n    return () => {\n      window.removeEventListener('resize', updateHeight);\n      if (resizeObserver) {\n        resizeObserver.disconnect();\n      }\n      if (scrollContainer) {\n        scrollContainer.removeEventListener('scroll', handleInteraction);\n      }\n    };\n  }, [expandedItems, handleInteraction]);\n\n  const activeHref = useMemo(() => progress?.sectionHref || null, [progress?.sectionHref]);\n  const flatItems = useFlattenedTOC(toc, expandedItems);\n  const activeItemIndex = useMemo(() => {\n    return flatItems.findIndex((item) => item.item.href === activeHref);\n  }, [flatItems, activeHref]);\n\n  const handleToggleExpand = useCallback(\n    (item: TOCItem) => {\n      const itemId = getItemIdentifier(item);\n      handleInteraction();\n      setExpandedItems((prev) => {\n        const newSet = new Set(prev);\n        if (newSet.has(itemId)) {\n          newSet.delete(itemId);\n        } else {\n          newSet.add(itemId);\n        }\n        return newSet;\n      });\n    },\n    [handleInteraction],\n  );\n\n  const handleItemClick = useCallback(\n    (item: TOCItem) => {\n      eventDispatcher.dispatch('navigate', { bookKey, href: item.href });\n      if (item.href) {\n        getView(bookKey)?.goTo(item.href);\n      }\n    },\n    [bookKey, getView],\n  );\n\n  const expandParents = useCallback((toc: TOCItem[], href: string) => {\n    const parentItems = findParentPath(toc, href)\n      .map((item) => getItemIdentifier(item))\n      .filter(Boolean);\n    setExpandedItems(new Set(parentItems));\n  }, []);\n\n  const scrollToActiveItem = useCallback(() => {\n    if (!activeHref) return;\n\n    if (vitualListRef.current) {\n      const activeIndex = flatItems.findIndex((flatItem) => flatItem.item.href === activeHref);\n      if (activeIndex !== -1) {\n        vitualListRef.current.scrollToItem(activeIndex, 'center');\n      }\n    }\n\n    if (staticListRef.current) {\n      const hrefMd5 = activeHref ? getContentMd5(activeHref) : '';\n      const activeItem = staticListRef.current?.querySelector(`[data-href=\"${hrefMd5}\"]`);\n      if (activeItem) {\n        const container = staticListRef.current.parentElement!;\n        const containerRect = container.getBoundingClientRect();\n        const itemRect = activeItem.getBoundingClientRect();\n        const isVisible =\n          itemRect.top >= containerRect.top && itemRect.bottom <= containerRect.bottom;\n        if (!isVisible) {\n          (activeItem as HTMLElement).scrollIntoView({ behavior: 'instant', block: 'center' });\n        }\n        (activeItem as HTMLElement).setAttribute('aria-current', 'page');\n      }\n    }\n  }, [flatItems, activeHref]);\n\n  const virtualItemSize = useMemo(() => {\n    return window.innerWidth >= 640 && !viewSettings?.translationEnabled ? 37 : 57;\n  }, [viewSettings?.translationEnabled]);\n\n  const virtualListData = useMemo(\n    () => ({\n      flatItems,\n      itemSize: virtualItemSize,\n      bookKey,\n      activeHref,\n      onToggleExpand: handleToggleExpand,\n      onItemClick: handleItemClick,\n    }),\n    [flatItems, virtualItemSize, bookKey, activeHref, handleToggleExpand, handleItemClick],\n  );\n\n  useEffect(() => {\n    if (!progress) return;\n    if (!isSideBarVisible) return;\n    if (sideBarBookKey !== bookKey) return;\n    if (isInCooldown()) return;\n\n    const { sectionHref: currentHref } = progress;\n    if (currentHref) {\n      expandParents(toc, currentHref);\n    }\n  }, [toc, progress, sideBarBookKey, isSideBarVisible, bookKey, expandParents, isInCooldown]);\n\n  useEffect(() => {\n    if (isInCooldown()) return;\n\n    if (flatItems.length > 0) {\n      setTimeout(scrollToActiveItem, appService?.isAndroidApp ? 300 : 100);\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [progress, scrollToActiveItem, isInCooldown]);\n\n  return sections && sections.length > 256 ? (\n    <div\n      className='virtual-list mt-2 rounded'\n      data-overlayscrollbars-initialize=''\n      ref={containerRef}\n    >\n      <VirtualList\n        ref={vitualListRef}\n        outerRef={listOuterRef}\n        width='100%'\n        height={containerHeight}\n        itemCount={flatItems.length}\n        itemSize={virtualItemSize}\n        itemData={virtualListData}\n        overscanCount={20}\n        initialScrollOffset={\n          appService?.isAndroidApp && activeItemIndex >= 0\n            ? Math.max(0, activeItemIndex * virtualItemSize - containerHeight / 2)\n            : undefined\n        }\n      >\n        {VirtualListRow}\n      </VirtualList>\n    </div>\n  ) : (\n    <div className='static-list mt-2 rounded' ref={staticListRef}>\n      {flatItems.map((flatItem, index) => (\n        <StaticListRow\n          key={`static-row-${index}`}\n          bookKey={bookKey}\n          flatItem={flatItem}\n          activeHref={activeHref}\n          onToggleExpand={handleToggleExpand}\n          onItemClick={handleItemClick}\n        />\n      ))}\n    </div>\n  );\n};\nexport default TOCView;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1133, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/app/reader/components/sidebar/BooknoteItem.tsx"],"sourcesContent":["'use client';\n\nimport clsx from 'clsx';\nimport dayjs from 'dayjs';\nimport React, { useRef, useState } from 'react';\n\nimport { marked } from 'marked';\nimport { useEnv } from '@/context/EnvContext';\nimport { BookNote } from '@/types/book';\nimport { useSettingsStore } from '@/store/settingsStore';\nimport { useReaderStore } from '@/store/readerStore';\nimport { useNotebookStore } from '@/store/notebookStore';\nimport { useBookDataStore } from '@/store/bookDataStore';\nimport { useTranslation } from '@/hooks/useTranslation';\nimport { useResponsiveSize } from '@/hooks/useResponsiveSize';\nimport { eventDispatcher } from '@/utils/event';\nimport { NOTE_PREFIX } from '@/types/view';\nimport useScrollToItem from '../../hooks/useScrollToItem';\nimport TextButton from '@/components/TextButton';\nimport TextEditor, { TextEditorRef } from '@/components/TextEditor';\n\ninterface BooknoteItemProps {\n  bookKey: string;\n  item: BookNote;\n  onClick?: () => void;\n}\n\nconst BooknoteItem: React.FC<BooknoteItemProps> = ({ bookKey, item, onClick }) => {\n  const _ = useTranslation();\n  const { envConfig } = useEnv();\n  const { settings } = useSettingsStore();\n  const { getConfig, saveConfig, updateBooknotes } = useBookDataStore();\n  const { getProgress, getView, getViewsById } = useReaderStore();\n  const { setNotebookEditAnnotation, setNotebookVisible } = useNotebookStore();\n\n  const { text, cfi, note } = item;\n  const editorRef = useRef<TextEditorRef>(null);\n  const [editorDraft, setEditorDraft] = useState(text || '');\n  const [inlineEditMode, setInlineEditMode] = useState(false);\n  const separatorWidth = useResponsiveSize(3);\n\n  const progress = getProgress(bookKey);\n  const { isCurrent, viewRef } = useScrollToItem(cfi, progress);\n\n  const handleClickItem = (event: React.MouseEvent | React.KeyboardEvent) => {\n    event.preventDefault();\n    eventDispatcher.dispatch('navigate', { bookKey, cfi });\n\n    onClick?.();\n    getView(bookKey)?.goTo(cfi);\n    if (note) {\n      setNotebookVisible(true);\n    }\n  };\n\n  const deleteNote = (note: BookNote) => {\n    if (!bookKey) return;\n    const config = getConfig(bookKey);\n    if (!config) return;\n    const { booknotes = [] } = config;\n    booknotes.forEach((item) => {\n      if (item.id === note.id) {\n        item.deletedAt = Date.now();\n        const views = getViewsById(bookKey.split('-')[0]!);\n        views.forEach((view) =>\n          view?.addAnnotation({ ...item, value: `${NOTE_PREFIX}${item.cfi}` }, true),\n        );\n      }\n    });\n    const updatedConfig = updateBooknotes(bookKey, booknotes);\n    if (updatedConfig) {\n      saveConfig(envConfig, bookKey, updatedConfig, settings);\n    }\n  };\n\n  const editNote = (note: BookNote) => {\n    setNotebookVisible(true);\n    setNotebookEditAnnotation(note);\n  };\n\n  const editBookmark = () => {\n    setEditorDraft(text || '');\n    setInlineEditMode(true);\n  };\n\n  const handleSaveBookmark = () => {\n    setInlineEditMode(false);\n    const config = getConfig(bookKey);\n    if (!config || !editorDraft) return;\n\n    const { booknotes: annotations = [] } = config;\n    const existingIndex = annotations.findIndex((annotation) => item.id === annotation.id);\n    if (existingIndex === -1) return;\n    annotations[existingIndex]!.updatedAt = Date.now();\n    annotations[existingIndex]!.text = editorDraft;\n    const updatedConfig = updateBooknotes(bookKey, annotations);\n    if (updatedConfig) {\n      saveConfig(envConfig, bookKey, updatedConfig, settings);\n    }\n  };\n\n  if (inlineEditMode) {\n    return (\n      <div\n        className={clsx(\n          'border-base-300 content group relative my-2 cursor-pointer rounded-lg p-2',\n          isCurrent ? 'bg-base-300/85 hover:bg-base-300' : 'hover:bg-base-300/55 bg-base-100',\n          'transition-all duration-300 ease-in-out',\n        )}\n      >\n        <div className='flex w-full'>\n          <TextEditor\n            className='!leading-normal'\n            ref={editorRef}\n            value={editorDraft}\n            onChange={setEditorDraft}\n            onSave={handleSaveBookmark}\n            onEscape={() => setInlineEditMode(false)}\n            spellCheck={false}\n          />\n        </div>\n        <div className='flex justify-end space-x-3 p-2' dir='ltr'>\n          <TextButton onClick={() => setInlineEditMode(false)}>{_('Cancel')}</TextButton>\n          <TextButton onClick={handleSaveBookmark} disabled={!editorDraft}>\n            {_('Save')}\n          </TextButton>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <li\n      // eslint-disable-next-line jsx-a11y/no-noninteractive-element-to-interactive-role\n      role='button'\n      ref={viewRef}\n      className={clsx(\n        'booknote-item border-base-300 content group relative my-2 cursor-pointer rounded-lg p-2',\n        isCurrent\n          ? 'bg-base-300/85 hover:bg-base-300 focus:bg-base-300'\n          : 'hover:bg-base-300/55 focus:bg-base-300/55 bg-base-100',\n        'transition-all duration-300 ease-in-out',\n      )}\n      tabIndex={0}\n      onClick={handleClickItem}\n      onKeyDown={(e) => {\n        if (e.key === 'Enter' || e.key === ' ') {\n          handleClickItem(e);\n        } else {\n          e.stopPropagation();\n        }\n      }}\n    >\n      <div\n        className={clsx('min-h-4 p-0 transition-all duration-300 ease-in-out')}\n        style={\n          {\n            '--top-override': '0.7rem',\n            '--end-override': '0.3rem',\n          } as React.CSSProperties\n        }\n      >\n        {item.note && (\n          <div\n            className='content prose prose-sm font-size-sm'\n            dir='auto'\n            dangerouslySetInnerHTML={{ __html: marked.parse(item.note) }}\n          ></div>\n        )}\n        <div className='flex items-start'>\n          {item.note && (\n            <div\n              className='me-2 mt-2.5 min-h-full self-stretch rounded-xl bg-gray-300'\n              style={{\n                minWidth: `${separatorWidth}px`,\n              }}\n            ></div>\n          )}\n          <div className={clsx('content font-size-sm line-clamp-3', item.note && 'mt-2')}>\n            <span\n              className={clsx(\n                'booknote-text inline leading-normal',\n                item.note && 'content font-size-xs text-gray-500',\n                (item.style === 'underline' || item.style === 'squiggly') &&\n                  'underline decoration-2',\n                item.style === 'highlight' && `bg-${item.color}-500 bg-opacity-40`,\n                item.style === 'underline' && `decoration-${item.color}-400`,\n                item.style === 'squiggly' && `decoration-wavy decoration-${item.color}-400`,\n              )}\n            >\n              {text || ''}\n            </span>\n          </div>\n        </div>\n      </div>\n      {/* eslint-disable-next-line jsx-a11y/click-events-have-key-events, jsx-a11y/no-static-element-interactions */}\n      <div\n        className={clsx(\n          'max-h-0 overflow-hidden p-0',\n          'transition-[max-height] duration-300 ease-in-out',\n          'group-hover:max-h-8 group-hover:overflow-visible',\n          'group-focus-within:max-h-8 group-focus-within:overflow-visible',\n        )}\n        style={\n          {\n            '--bottom-override': 0,\n          } as React.CSSProperties\n        }\n        // This is needed to prevent the parent onClick from being triggered\n        onClick={(e) => e.stopPropagation()}\n      >\n        <div className='flex cursor-default items-center justify-between'>\n          <div className='flex items-center'>\n            <span className='text-sm text-gray-500 sm:text-xs'>\n              {dayjs(item.createdAt).fromNow()}\n            </span>\n          </div>\n          <div className='flex items-center justify-end space-x-3 p-2' dir='ltr'>\n            {(item.note || item.type === 'bookmark') && (\n              <TextButton\n                onClick={item.type === 'bookmark' ? editBookmark : editNote.bind(null, item)}\n                variant='primary'\n                className='opacity-0 transition duration-300 ease-in-out group-focus-within:opacity-100 group-hover:opacity-100'\n              >\n                {_('Edit')}\n              </TextButton>\n            )}\n\n            <TextButton\n              onClick={deleteNote.bind(null, item)}\n              variant='danger'\n              className='opacity-0 transition duration-300 ease-in-out group-focus-within:opacity-100 group-hover:opacity-100'\n            >\n              {_('Delete')}\n            </TextButton>\n          </div>\n        </div>\n      </div>\n    </li>\n  );\n};\n\nexport default BooknoteItem;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1469, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/app/reader/components/sidebar/BooknoteView.tsx"],"sourcesContent":["import React from 'react';\nimport * as CFI from 'foliate-js/epubcfi.js';\nimport { useBookDataStore } from '@/store/bookDataStore';\nimport { useSidebarStore } from '@/store/sidebarStore';\nimport { findTocItemBS } from '@/utils/toc';\nimport { TOCItem } from '@/libs/document';\nimport { BooknoteGroup, BookNoteType } from '@/types/book';\nimport BooknoteItem from './BooknoteItem';\n\nconst BooknoteView: React.FC<{\n  type: BookNoteType;\n  bookKey: string;\n  toc: TOCItem[];\n}> = ({ type, bookKey, toc }) => {\n  const { getConfig } = useBookDataStore();\n  const { setActiveBooknoteType, setBooknoteResults } = useSidebarStore();\n  const config = getConfig(bookKey)!;\n\n  const { booknotes: allNotes = [] } = config;\n  const booknotes = allNotes.filter((note) => note.type === type && !note.deletedAt);\n\n  const booknoteGroups: { [href: string]: BooknoteGroup } = {};\n  for (const booknote of booknotes) {\n    const tocItem = findTocItemBS(toc ?? [], booknote.cfi);\n    const href = tocItem?.href || '';\n    const label = tocItem?.label || '';\n    const id = tocItem?.id || 0;\n    if (!booknoteGroups[href]) {\n      booknoteGroups[href] = { id, href, label, booknotes: [] };\n    }\n    booknoteGroups[href].booknotes.push(booknote);\n  }\n\n  Object.values(booknoteGroups).forEach((group) => {\n    group.booknotes.sort((a, b) => {\n      return CFI.compare(a.cfi, b.cfi);\n    });\n  });\n\n  const sortedGroups = Object.values(booknoteGroups).sort((a, b) => {\n    return a.id - b.id;\n  });\n\n  const handleBrowseBookNotes = () => {\n    if (booknotes.length === 0) return;\n\n    const sorted = [...booknotes].sort((a, b) => CFI.compare(a.cfi, b.cfi));\n    setActiveBooknoteType(bookKey, type);\n    setBooknoteResults(bookKey, sorted);\n  };\n\n  return (\n    <div className='rounded pt-2'>\n      <ul role='tree' className='px-2'>\n        {sortedGroups.map((group) => (\n          <li key={group.href} className='p-2'>\n            <h3 className='content font-size-base line-clamp-1 font-normal'>{group.label}</h3>\n            <ul>\n              {group.booknotes.map((item, index) => (\n                <BooknoteItem\n                  key={`${index}-${item.cfi}`}\n                  bookKey={bookKey}\n                  item={item}\n                  onClick={handleBrowseBookNotes}\n                />\n              ))}\n            </ul>\n          </li>\n        ))}\n      </ul>\n    </div>\n  );\n};\n\nexport default BooknoteView;\n"],"names":[],"mappings":";;;;;AACA;AACA;AACA;AACA;AAGA;;;;;;;;AAEA,MAAM,eAID,CAAC,EAAE,IAAI,EAAE,OAAO,EAAE,GAAG,EAAE;;IAC1B,MAAM,EAAE,SAAS,EAAE,GAAG,IAAA,uKAAgB;IACtC,MAAM,EAAE,qBAAqB,EAAE,kBAAkB,EAAE,GAAG,IAAA,qKAAe;IACrE,MAAM,SAAS,UAAU;IAEzB,MAAM,EAAE,WAAW,WAAW,EAAE,EAAE,GAAG;IACrC,MAAM,YAAY,SAAS,MAAM,CAAC,CAAC,OAAS,KAAK,IAAI,KAAK,QAAQ,CAAC,KAAK,SAAS;IAEjF,MAAM,iBAAoD,CAAC;IAC3D,KAAK,MAAM,YAAY,UAAW;QAChC,MAAM,UAAU,IAAA,0JAAa,EAAC,OAAO,EAAE,EAAE,SAAS,GAAG;QACrD,MAAM,OAAO,SAAS,QAAQ;QAC9B,MAAM,QAAQ,SAAS,SAAS;QAChC,MAAM,KAAK,SAAS,MAAM;QAC1B,IAAI,CAAC,cAAc,CAAC,KAAK,EAAE;YACzB,cAAc,CAAC,KAAK,GAAG;gBAAE;gBAAI;gBAAM;gBAAO,WAAW,EAAE;YAAC;QAC1D;QACA,cAAc,CAAC,KAAK,CAAC,SAAS,CAAC,IAAI,CAAC;IACtC;IAEA,OAAO,MAAM,CAAC,gBAAgB,OAAO,CAAC,CAAC;QACrC,MAAM,SAAS,CAAC,IAAI,CAAC,CAAC,GAAG;YACvB,OAAO,2IAAW,CAAC,EAAE,GAAG,EAAE,EAAE,GAAG;QACjC;IACF;IAEA,MAAM,eAAe,OAAO,MAAM,CAAC,gBAAgB,IAAI,CAAC,CAAC,GAAG;QAC1D,OAAO,EAAE,EAAE,GAAG,EAAE,EAAE;IACpB;IAEA,MAAM,wBAAwB;QAC5B,IAAI,UAAU,MAAM,KAAK,GAAG;QAE5B,MAAM,SAAS;eAAI;SAAU,CAAC,IAAI,CAAC,CAAC,GAAG,IAAM,2IAAW,CAAC,EAAE,GAAG,EAAE,EAAE,GAAG;QACrE,sBAAsB,SAAS;QAC/B,mBAAmB,SAAS;IAC9B;IAEA,qBACE,6MAAC;QAAI,WAAU;kBACb,cAAA,6MAAC;YAAG,MAAK;YAAO,WAAU;sBACvB,aAAa,GAAG,CAAC,CAAC,sBACjB,6MAAC;oBAAoB,WAAU;;sCAC7B,6MAAC;4BAAG,WAAU;sCAAmD,MAAM,KAAK;;;;;;sCAC5E,6MAAC;sCACE,MAAM,SAAS,CAAC,GAAG,CAAC,CAAC,MAAM,sBAC1B,6MAAC,+LAAY;oCAEX,SAAS;oCACT,MAAM;oCACN,SAAS;mCAHJ,GAAG,MAAM,CAAC,EAAE,KAAK,GAAG,EAAE;;;;;;;;;;;mBAL1B,MAAM,IAAI;;;;;;;;;;;;;;;AAiB7B;GA/DM;;QAKkB,uKAAgB;QACgB,qKAAe;;;KANjE;uCAiES"}},
    {"offset": {"line": 1590, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/app/reader/components/sidebar/TabNavigation.tsx"],"sourcesContent":["import clsx from 'clsx';\nimport React from 'react';\nimport { MdBookmarkBorder as BookmarkIcon } from 'react-icons/md';\nimport { IoIosList as TOCIcon } from 'react-icons/io';\nimport { PiNotePencil as NoteIcon } from 'react-icons/pi';\n\nimport { useEnv } from '@/context/EnvContext';\nimport { useTranslation } from '@/hooks/useTranslation';\n\nconst TabNavigation: React.FC<{\n  activeTab: string;\n  onTabChange: (tab: string) => void;\n}> = ({ activeTab, onTabChange }) => {\n  const _ = useTranslation();\n  const { appService } = useEnv();\n\n  const tabs = ['toc', 'annotations', 'bookmarks'];\n\n  return (\n    <div\n      className={clsx(\n        'bottom-tab border-base-300/50 bg-base-200/20 relative flex w-full border-t',\n        appService?.hasRoundedWindow && 'rounded-window-bottom-left',\n      )}\n      dir='ltr'\n    >\n      <div\n        className={clsx(\n          'bg-base-300/85 absolute bottom-1.5 start-1 z-10 h-[calc(100%-12px)] w-[calc(33.3%-8px)] rounded-lg',\n          'transform transition-transform duration-300',\n          activeTab === 'toc' && 'translate-x-0',\n          activeTab === 'annotations' && 'translate-x-[calc(100%+8px)]',\n          activeTab === 'bookmarks' && 'translate-x-[calc(200%+16px)]',\n        )}\n      />\n      {tabs.map((tab) => (\n        <div\n          key={tab}\n          tabIndex={0}\n          role='button'\n          className='z-[11] m-1.5 flex-1 cursor-pointer rounded-md p-2'\n          onClick={() => onTabChange(tab)}\n          onKeyDown={(e) => {\n            if (e.key === 'Enter' || e.key === ' ') {\n              e.preventDefault();\n              onTabChange(tab);\n            }\n          }}\n          title={tab === 'toc' ? _('TOC') : tab === 'annotations' ? _('Annotate') : _('Bookmark')}\n          aria-label={\n            tab === 'toc' ? _('TOC') : tab === 'annotations' ? _('Annotate') : _('Bookmark')\n          }\n        >\n          <div className={clsx('m-0 flex h-6 items-center p-0')}>\n            {tab === 'toc' ? (\n              <TOCIcon className='mx-auto' />\n            ) : tab === 'annotations' ? (\n              <NoteIcon className='mx-auto' />\n            ) : (\n              <BookmarkIcon className='mx-auto' />\n            )}\n          </div>\n        </div>\n      ))}\n    </div>\n  );\n};\n\nexport default TabNavigation;\n"],"names":[],"mappings":";;;;;AAAA;AAEA;AACA;AACA;AAEA;AACA;;;;;;;;;AAEA,MAAM,gBAGD,CAAC,EAAE,SAAS,EAAE,WAAW,EAAE;;IAC9B,MAAM,IAAI,IAAA,sKAAc;IACxB,MAAM,EAAE,UAAU,EAAE,GAAG,IAAA,6JAAM;IAE7B,MAAM,OAAO;QAAC;QAAO;QAAe;KAAY;IAEhD,qBACE,6MAAC;QACC,WAAW,IAAA,6LAAI,EACb,8EACA,YAAY,oBAAoB;QAElC,KAAI;;0BAEJ,6MAAC;gBACC,WAAW,IAAA,6LAAI,EACb,sGACA,+CACA,cAAc,SAAS,iBACvB,cAAc,iBAAiB,gCAC/B,cAAc,eAAe;;;;;;YAGhC,KAAK,GAAG,CAAC,CAAC,oBACT,6MAAC;oBAEC,UAAU;oBACV,MAAK;oBACL,WAAU;oBACV,SAAS,IAAM,YAAY;oBAC3B,WAAW,CAAC;wBACV,IAAI,EAAE,GAAG,KAAK,WAAW,EAAE,GAAG,KAAK,KAAK;4BACtC,EAAE,cAAc;4BAChB,YAAY;wBACd;oBACF;oBACA,OAAO,QAAQ,QAAQ,EAAE,SAAS,QAAQ,gBAAgB,EAAE,cAAc,EAAE;oBAC5E,cACE,QAAQ,QAAQ,EAAE,SAAS,QAAQ,gBAAgB,EAAE,cAAc,EAAE;8BAGvE,cAAA,6MAAC;wBAAI,WAAW,IAAA,6LAAI,EAAC;kCAClB,QAAQ,sBACP,6MAAC,wOAAO;4BAAC,WAAU;;;;;uEACjB,QAAQ,8BACV,6MAAC,2OAAQ;4BAAC,WAAU;;;;;qFAEpB,6MAAC,+OAAY;4BAAC,WAAU;;;;;;;;;;;mBAtBvB;;;;;;;;;;;AA6Bf;GAzDM;;QAIM,sKAAc;QACD,6JAAM;;;KALzB;uCA2DS"}},
    {"offset": {"line": 1697, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/app/reader/components/sidebar/Content.tsx"],"sourcesContent":["'use client';\n\nimport clsx from 'clsx';\nimport React, { useEffect, useState } from 'react';\n\nimport { BookDoc } from '@/libs/document';\nimport { useThemeStore } from '@/store/themeStore';\nimport { useReaderStore } from '@/store/readerStore';\nimport { useSidebarStore } from '@/store/sidebarStore';\nimport { useBookDataStore } from '@/store/bookDataStore';\nimport { OverlayScrollbarsComponent } from 'overlayscrollbars-react';\nimport 'overlayscrollbars/overlayscrollbars.css';\n\nimport TOCView from './TOCView';\nimport BooknoteView from './BooknoteView';\nimport TabNavigation from './TabNavigation';\n\nconst SidebarContent: React.FC<{\n  bookDoc: BookDoc;\n  sideBarBookKey: string;\n}> = ({ bookDoc, sideBarBookKey }) => {\n  const { safeAreaInsets } = useThemeStore();\n  const { setHoveredBookKey } = useReaderStore();\n  const { setSideBarVisible } = useSidebarStore();\n  const { getConfig, setConfig } = useBookDataStore();\n  const config = getConfig(sideBarBookKey);\n  const [activeTab, setActiveTab] = useState(config?.viewSettings?.sideBarTab || 'toc');\n  const [fade, setFade] = useState(false);\n  const [targetTab, setTargetTab] = useState(activeTab);\n  const isMobile = window.innerWidth < 640 || window.innerHeight < 640;\n\n  useEffect(() => {\n    if (!sideBarBookKey) return;\n    const config = getConfig(sideBarBookKey!)!;\n    setActiveTab(config.viewSettings!.sideBarTab!);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [sideBarBookKey]);\n\n  const handleTabChange = (tab: string) => {\n    setFade(true);\n    const timeout = setTimeout(() => {\n      if (activeTab === tab && isMobile) {\n        setHoveredBookKey(sideBarBookKey);\n        setSideBarVisible(false);\n        return;\n      }\n      setTargetTab(tab);\n      setFade(false);\n      setConfig(sideBarBookKey!, config);\n      clearTimeout(timeout);\n    }, 300);\n\n    setActiveTab(tab);\n    const config = getConfig(sideBarBookKey!)!;\n    config.viewSettings!.sideBarTab = tab;\n  };\n\n  return (\n    <>\n      <div\n        className={clsx(\n          'sidebar-content flex h-full min-h-0 flex-grow flex-col shadow-inner',\n          'font-sans text-base font-normal sm:text-sm',\n        )}\n      >\n        <OverlayScrollbarsComponent\n          className='min-h-0 flex-1'\n          options={{\n            scrollbars: { autoHide: 'scroll', clickScroll: true },\n            showNativeOverlaidScrollbars: false,\n          }}\n          defer\n        >\n          <div\n            className={clsx('scroll-container h-full transition-opacity duration-300 ease-in-out', {\n              'opacity-0': fade,\n              'opacity-100': !fade,\n            })}\n          >\n            {targetTab === 'toc' && bookDoc.toc && (\n              <TOCView toc={bookDoc.toc} sections={bookDoc.sections} bookKey={sideBarBookKey} />\n            )}\n            {targetTab === 'annotations' && (\n              <BooknoteView type='annotation' toc={bookDoc.toc ?? []} bookKey={sideBarBookKey} />\n            )}\n            {targetTab === 'bookmarks' && (\n              <BooknoteView type='bookmark' toc={bookDoc.toc ?? []} bookKey={sideBarBookKey} />\n            )}\n          </div>\n        </OverlayScrollbarsComponent>\n      </div>\n      <div\n        className='flex-shrink-0'\n        style={{\n          paddingBottom: `${(safeAreaInsets?.bottom || 0) / 2}px`,\n        }}\n      >\n        <TabNavigation activeTab={activeTab} onTabChange={handleTabChange} />\n      </div>\n    </>\n  );\n};\n\nexport default SidebarContent;\n"],"names":[],"mappings":";;;;;AAEA;AACA;AAGA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;;;AAfA;;;;;;;;;;;;AAiBA,MAAM,iBAGD,CAAC,EAAE,OAAO,EAAE,cAAc,EAAE;;IAC/B,MAAM,EAAE,cAAc,EAAE,GAAG,IAAA,iKAAa;IACxC,MAAM,EAAE,iBAAiB,EAAE,GAAG,IAAA,mKAAc;IAC5C,MAAM,EAAE,iBAAiB,EAAE,GAAG,IAAA,qKAAe;IAC7C,MAAM,EAAE,SAAS,EAAE,SAAS,EAAE,GAAG,IAAA,uKAAgB;IACjD,MAAM,SAAS,UAAU;IACzB,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,yLAAQ,EAAC,QAAQ,cAAc,cAAc;IAC/E,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,yLAAQ,EAAC;IACjC,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,yLAAQ,EAAC;IAC3C,MAAM,WAAW,OAAO,UAAU,GAAG,OAAO,OAAO,WAAW,GAAG;IAEjE,IAAA,0LAAS;oCAAC;YACR,IAAI,CAAC,gBAAgB;YACrB,MAAM,SAAS,UAAU;YACzB,aAAa,OAAO,YAAY,CAAE,UAAU;QAC5C,uDAAuD;QACzD;mCAAG;QAAC;KAAe;IAEnB,MAAM,kBAAkB,CAAC;QACvB,QAAQ;QACR,MAAM,UAAU,WAAW;YACzB,IAAI,cAAc,OAAO,UAAU;gBACjC,kBAAkB;gBAClB,kBAAkB;gBAClB;YACF;YACA,aAAa;YACb,QAAQ;YACR,UAAU,gBAAiB;YAC3B,aAAa;QACf,GAAG;QAEH,aAAa;QACb,MAAM,SAAS,UAAU;QACzB,OAAO,YAAY,CAAE,UAAU,GAAG;IACpC;IAEA,qBACE;;0BACE,6MAAC;gBACC,WAAW,IAAA,6LAAI,EACb,uEACA;0BAGF,cAAA,6MAAC,kUAA0B;oBACzB,WAAU;oBACV,SAAS;wBACP,YAAY;4BAAE,UAAU;4BAAU,aAAa;wBAAK;wBACpD,8BAA8B;oBAChC;oBACA,KAAK;8BAEL,cAAA,6MAAC;wBACC,WAAW,IAAA,6LAAI,EAAC,uEAAuE;4BACrF,aAAa;4BACb,eAAe,CAAC;wBAClB;;4BAEC,cAAc,SAAS,QAAQ,GAAG,kBACjC,6MAAC,0LAAO;gCAAC,KAAK,QAAQ,GAAG;gCAAE,UAAU,QAAQ,QAAQ;gCAAE,SAAS;;;;;;4BAEjE,cAAc,+BACb,6MAAC,+LAAY;gCAAC,MAAK;gCAAa,KAAK,QAAQ,GAAG,IAAI,EAAE;gCAAE,SAAS;;;;;;4BAElE,cAAc,6BACb,6MAAC,+LAAY;gCAAC,MAAK;gCAAW,KAAK,QAAQ,GAAG,IAAI,EAAE;gCAAE,SAAS;;;;;;;;;;;;;;;;;;;;;;0BAKvE,6MAAC;gBACC,WAAU;gBACV,OAAO;oBACL,eAAe,GAAG,CAAC,gBAAgB,UAAU,CAAC,IAAI,EAAE,EAAE,CAAC;gBACzD;0BAEA,cAAA,6MAAC,gMAAa;oBAAC,WAAW;oBAAW,aAAa;;;;;;;;;;;;;AAI1D;GApFM;;QAIuB,iKAAa;QACV,mKAAc;QACd,qKAAe;QACZ,uKAAgB;;;KAP7C;uCAsFS"}},
    {"offset": {"line": 1867, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/app/reader/components/sidebar/BookCard.tsx"],"sourcesContent":["'use client';\n\nimport clsx from 'clsx';\nimport React, { useRef } from 'react';\nimport { MdInfoOutline } from 'react-icons/md';\nimport { Book } from '@/types/book';\nimport { useThemeStore } from '@/store/themeStore';\nimport { useTranslation } from '@/hooks/useTranslation';\nimport { eventDispatcher } from '@/utils/event';\nimport { useResponsiveSize } from '@/hooks/useResponsiveSize';\nimport { formatAuthors, formatTitle } from '@/utils/book';\nimport BookCover from '@/components/BookCover';\n\nconst BookCard = ({ book }: { book: Book }) => {\n  const { title, author } = book;\n  const _ = useTranslation();\n  const { isDarkMode } = useThemeStore();\n  const iconSize18 = useResponsiveSize(18);\n  const bookCoverRef = useRef<HTMLDivElement | null>(null);\n\n  const showBookDetails = () => {\n    eventDispatcher.dispatchSync('show-book-details', book);\n  };\n\n  return (\n    <div className='flex h-20 w-full items-center'>\n      <div\n        ref={bookCoverRef}\n        className={clsx(\n          'me-4 aspect-[28/41] max-h-16 w-[15%] max-w-12 overflow-hidden rounded-sm shadow-md',\n          isDarkMode ? 'mix-blend-screen' : 'mix-blend-multiply',\n        )}\n      >\n        <BookCover\n          book={book}\n          mode='list'\n          coverFit='crop'\n          imageClassName='rounded-sm'\n          onImageError={() => (bookCoverRef.current!.style.display = 'none')}\n        />\n      </div>\n      <div className='min-w-0 flex-1'>\n        <h4 className='line-clamp-2 w-[90%] text-sm font-semibold'>\n          {formatTitle(title).replace(/\\u00A0/g, ' ')}\n        </h4>\n        <p className='truncate text-xs opacity-75'>{formatAuthors(author)}</p>\n      </div>\n      <button\n        className='btn btn-ghost hover:bg-base-300 h-6 min-h-6 w-6 rounded-full p-0 transition-colors'\n        aria-label={_('More Info')}\n        onClick={showBookDetails}\n      >\n        <MdInfoOutline size={iconSize18} className='fill-base-content' />\n      </button>\n    </div>\n  );\n};\n\nexport default BookCard;\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;;;AAXA;;;;;;;;;;AAaA,MAAM,WAAW,CAAC,EAAE,IAAI,EAAkB;;IACxC,MAAM,EAAE,KAAK,EAAE,MAAM,EAAE,GAAG;IAC1B,MAAM,IAAI,IAAA,sKAAc;IACxB,MAAM,EAAE,UAAU,EAAE,GAAG,IAAA,iKAAa;IACpC,MAAM,aAAa,IAAA,4KAAiB,EAAC;IACrC,MAAM,eAAe,IAAA,uLAAM,EAAwB;IAEnD,MAAM,kBAAkB;QACtB,8JAAe,CAAC,YAAY,CAAC,qBAAqB;IACpD;IAEA,qBACE,6MAAC;QAAI,WAAU;;0BACb,6MAAC;gBACC,KAAK;gBACL,WAAW,IAAA,6LAAI,EACb,sFACA,aAAa,qBAAqB;0BAGpC,cAAA,6MAAC,gKAAS;oBACR,MAAM;oBACN,MAAK;oBACL,UAAS;oBACT,gBAAe;oBACf,cAAc,IAAO,aAAa,OAAO,CAAE,KAAK,CAAC,OAAO,GAAG;;;;;;;;;;;0BAG/D,6MAAC;gBAAI,WAAU;;kCACb,6MAAC;wBAAG,WAAU;kCACX,IAAA,yJAAW,EAAC,OAAO,OAAO,CAAC,WAAW;;;;;;kCAEzC,6MAAC;wBAAE,WAAU;kCAA+B,IAAA,2JAAa,EAAC;;;;;;;;;;;;0BAE5D,6MAAC;gBACC,WAAU;gBACV,cAAY,EAAE;gBACd,SAAS;0BAET,cAAA,6MAAC,4OAAa;oBAAC,MAAM;oBAAY,WAAU;;;;;;;;;;;;;;;;;AAInD;GA3CM;;QAEM,sKAAc;QACD,iKAAa;QACjB,4KAAiB;;;KAJhC;uCA6CS"}},
    {"offset": {"line": 1992, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/app/reader/components/sidebar/SearchOptions.tsx"],"sourcesContent":["import clsx from 'clsx';\nimport React from 'react';\nimport { MdCheck } from 'react-icons/md';\nimport { BookSearchConfig } from '@/types/book';\nimport { useTranslation } from '@/hooks/useTranslation';\nimport { useDefaultIconSize } from '@/hooks/useResponsiveSize';\n\ninterface SearchOptionsProps {\n  isEink: boolean;\n  searchConfig: BookSearchConfig;\n  menuClassName?: string;\n  onSearchConfigChanged: (searchConfig: BookSearchConfig) => void;\n  setIsDropdownOpen?: (isOpen: boolean) => void;\n}\n\ninterface OptionProps {\n  label: string;\n  isActive: boolean;\n  onClick: () => void;\n}\n\nconst Option: React.FC<OptionProps> = ({ label, isActive, onClick }) => (\n  <button\n    className='hover:bg-base-300 flex w-full items-center justify-between rounded-md p-2'\n    onClick={onClick}\n  >\n    <div className='flex items-center'>\n      <span style={{ minWidth: `${useDefaultIconSize()}px` }}>\n        {isActive && <MdCheck className='text-base-content' />}\n      </span>\n      <span className='ml-2'>{label}</span>\n    </div>\n  </button>\n);\n\nconst SearchOptions: React.FC<SearchOptionsProps> = ({\n  isEink,\n  searchConfig,\n  menuClassName,\n  onSearchConfigChanged,\n  setIsDropdownOpen,\n}) => {\n  const _ = useTranslation();\n  const updateConfig = (key: keyof BookSearchConfig, value: boolean | string) => {\n    onSearchConfigChanged({ ...searchConfig, [key]: value });\n    setIsDropdownOpen?.(false);\n  };\n\n  return (\n    <div\n      className={clsx(\n        'search-options dropdown-content dropdown-center border-base-200 z-20 w-56 border shadow-2xl',\n        isEink ? 'bordercolor-content border-base-content !bg-base-100 border' : '',\n        menuClassName,\n      )}\n    >\n      <Option\n        label={_('Book')}\n        isActive={searchConfig.scope === 'book'}\n        onClick={() => updateConfig('scope', 'book')}\n      />\n      <Option\n        label={_('Chapter')}\n        isActive={searchConfig.scope === 'section'}\n        onClick={() => updateConfig('scope', 'section')}\n      />\n      <hr className='border-base-200 my-1' />\n      <Option\n        label={_('Match Case')}\n        isActive={searchConfig.matchCase}\n        onClick={() => updateConfig('matchCase', !searchConfig.matchCase)}\n      />\n      <Option\n        label={_('Match Whole Words')}\n        isActive={searchConfig.matchWholeWords}\n        onClick={() => updateConfig('matchWholeWords', !searchConfig.matchWholeWords)}\n      />\n      <Option\n        label={_('Match Diacritics')}\n        isActive={searchConfig.matchDiacritics}\n        onClick={() => updateConfig('matchDiacritics', !searchConfig.matchDiacritics)}\n      />\n    </div>\n  );\n};\n\nexport default SearchOptions;\n"],"names":[],"mappings":";;;;;AAAA;AAEA;AAEA;AACA;;;;;;;AAgBA,MAAM,SAAgC,CAAC,EAAE,KAAK,EAAE,QAAQ,EAAE,OAAO,EAAE;;IAAK,qBACtE,6MAAC;QACC,WAAU;QACV,SAAS;kBAET,cAAA,6MAAC;YAAI,WAAU;;8BACb,6MAAC;oBAAK,OAAO;wBAAE,UAAU,GAAG,IAAA,6KAAkB,IAAG,EAAE,CAAC;oBAAC;8BAClD,0BAAY,6MAAC,sOAAO;wBAAC,WAAU;;;;;;;;;;;8BAElC,6MAAC;oBAAK,WAAU;8BAAQ;;;;;;;;;;;;;;;;;AAG9B;GAZM;;QAM4B,6KAAkB;;;KAN9C;AAcN,MAAM,gBAA8C,CAAC,EACnD,MAAM,EACN,YAAY,EACZ,aAAa,EACb,qBAAqB,EACrB,iBAAiB,EAClB;;IACC,MAAM,IAAI,IAAA,sKAAc;IACxB,MAAM,eAAe,CAAC,KAA6B;QACjD,sBAAsB;YAAE,GAAG,YAAY;YAAE,CAAC,IAAI,EAAE;QAAM;QACtD,oBAAoB;IACtB;IAEA,qBACE,6MAAC;QACC,WAAW,IAAA,6LAAI,EACb,+FACA,SAAS,gEAAgE,IACzE;;0BAGF,6MAAC;gBACC,OAAO,EAAE;gBACT,UAAU,aAAa,KAAK,KAAK;gBACjC,SAAS,IAAM,aAAa,SAAS;;;;;;0BAEvC,6MAAC;gBACC,OAAO,EAAE;gBACT,UAAU,aAAa,KAAK,KAAK;gBACjC,SAAS,IAAM,aAAa,SAAS;;;;;;0BAEvC,6MAAC;gBAAG,WAAU;;;;;;0BACd,6MAAC;gBACC,OAAO,EAAE;gBACT,UAAU,aAAa,SAAS;gBAChC,SAAS,IAAM,aAAa,aAAa,CAAC,aAAa,SAAS;;;;;;0BAElE,6MAAC;gBACC,OAAO,EAAE;gBACT,UAAU,aAAa,eAAe;gBACtC,SAAS,IAAM,aAAa,mBAAmB,CAAC,aAAa,eAAe;;;;;;0BAE9E,6MAAC;gBACC,OAAO,EAAE;gBACT,UAAU,aAAa,eAAe;gBACtC,SAAS,IAAM,aAAa,mBAAmB,CAAC,aAAa,eAAe;;;;;;;;;;;;AAIpF;IAjDM;;QAOM,sKAAc;;;MAPpB;uCAmDS"}},
    {"offset": {"line": 2146, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/app/reader/components/sidebar/SearchBar.tsx"],"sourcesContent":["'use client';\n\nimport clsx from 'clsx';\nimport React, { useCallback, useEffect, useMemo, useRef, useState } from 'react';\nimport { FaSearch, FaChevronDown } from 'react-icons/fa';\nimport { IoMdCloseCircle } from 'react-icons/io';\nimport { MdDeleteOutline } from 'react-icons/md';\n\nimport { md5 } from 'js-md5';\nimport { useEnv } from '@/context/EnvContext';\nimport { useSettingsStore } from '@/store/settingsStore';\nimport { useBookDataStore } from '@/store/bookDataStore';\nimport { useReaderStore } from '@/store/readerStore';\nimport { useSidebarStore } from '@/store/sidebarStore';\nimport { useTranslation } from '@/hooks/useTranslation';\nimport { BookSearchConfig, BookSearchMatch, BookSearchResult } from '@/types/book';\nimport { useResponsiveSize } from '@/hooks/useResponsiveSize';\nimport { debounce } from '@/utils/debounce';\nimport { isCJKStr } from '@/utils/lang';\nimport { createRejectFilter } from '@/utils/node';\nimport Dropdown from '@/components/Dropdown';\nimport SearchOptions from './SearchOptions';\n\nconst MINIMUM_SEARCH_TERM_LENGTH_DEFAULT = 2;\nconst MINIMUM_SEARCH_TERM_LENGTH_CJK = 1;\nconst SEARCH_HISTORY_KEY = 'search-history';\nconst SEARCH_CACHE_DIR = 'search';\nconst MAX_SEARCH_HISTORY = 10;\n\ninterface SearchBarProps {\n  isVisible: boolean;\n  bookKey: string;\n  onHideSearchBar: () => void;\n}\n\nconst SearchBar: React.FC<SearchBarProps> = ({ isVisible, bookKey, onHideSearchBar }) => {\n  const _ = useTranslation();\n  const { envConfig, appService } = useEnv();\n  const { settings } = useSettingsStore();\n  const { getBookData } = useBookDataStore();\n  const { getConfig, setConfig, saveConfig } = useBookDataStore();\n  const { getView, getProgress, getViewSettings } = useReaderStore();\n  const { setSearchTerm, setSearchResults, setSearchProgress } = useSidebarStore();\n  const { getSearchNavState, getSearchStatus, setSearchStatus } = useSidebarStore();\n  const viewSettings = getViewSettings(bookKey);\n  const searchNavState = getSearchNavState(bookKey);\n\n  const { searchTerm } = searchNavState;\n  const queuedSearchTerm = useRef('');\n  const inputRef = useRef<HTMLInputElement>(null);\n  const inputFocusedRef = useRef(false);\n\n  const bookHash = useMemo(() => bookKey.split('-')[0]!, [bookKey]);\n  const historyStorageKey = useMemo(() => `${SEARCH_HISTORY_KEY}-${bookHash}`, [bookHash]);\n\n  const [searchHistory, setSearchHistory] = useState<string[]>(() => {\n    if (typeof window !== 'undefined') {\n      const saved = localStorage.getItem(historyStorageKey);\n      return saved ? JSON.parse(saved) : [];\n    }\n    return [];\n  });\n\n  useEffect(() => {\n    const saved = localStorage.getItem(historyStorageKey);\n    setSearchHistory(saved ? JSON.parse(saved) : []);\n  }, [historyStorageKey]);\n\n  const addToHistory = useCallback(\n    (term: string) => {\n      const filtered = searchHistory.filter((t) => t !== term);\n      const updated = [term, ...filtered].slice(0, MAX_SEARCH_HISTORY);\n      localStorage.setItem(historyStorageKey, JSON.stringify(updated));\n      setSearchHistory(updated);\n    },\n    [historyStorageKey, searchHistory],\n  );\n\n  const handleHistoryClick = (term: string) => {\n    setSearchTerm(bookKey, term);\n    handleSearchTermChange(term);\n  };\n\n  const handleClearInput = () => {\n    setSearchTerm(bookKey, '');\n    resetSearch();\n    inputRef.current?.focus();\n  };\n\n  const handleClearHistory = async () => {\n    setSearchHistory([]);\n    localStorage.removeItem(historyStorageKey);\n    await clearSearchCache();\n  };\n\n  const getSearchCacheKey = useCallback((term: string, config: BookSearchConfig) => {\n    const configStr = JSON.stringify({\n      scope: config.scope,\n      matchCase: config.matchCase,\n      matchWholeWords: config.matchWholeWords,\n      matchDiacritics: config.matchDiacritics,\n    });\n    return md5(`${term}-${configStr}`);\n  }, []);\n\n  const getSearchCache = useCallback(\n    async (\n      term: string,\n      config: BookSearchConfig,\n    ): Promise<BookSearchResult[] | BookSearchMatch[] | null> => {\n      const cacheKey = getSearchCacheKey(term, config);\n      const cachePath = `${SEARCH_CACHE_DIR}/${bookHash}/${cacheKey}.json`;\n      try {\n        if (await appService?.exists(cachePath, 'Cache')) {\n          const content = await appService?.readFile(cachePath, 'Cache', 'text');\n          if (content) return JSON.parse(content as string);\n        }\n      } catch (error) {\n        console.error('Failed to read search cache:', error);\n      }\n      return null;\n    },\n    [bookHash, appService, getSearchCacheKey],\n  );\n\n  const saveSearchCache = useCallback(\n    async (\n      term: string,\n      config: BookSearchConfig,\n      results: BookSearchResult[] | BookSearchMatch[],\n    ) => {\n      const cacheKey = getSearchCacheKey(term, config);\n      const cacheDir = `${SEARCH_CACHE_DIR}/${bookHash}`;\n      const cachePath = `${cacheDir}/${cacheKey}.json`;\n      try {\n        if (!(await appService?.exists(cacheDir, 'Cache'))) {\n          await appService?.createDir(cacheDir, 'Cache', true);\n        }\n        await appService?.writeFile(cachePath, 'Cache', JSON.stringify(results));\n      } catch (error) {\n        console.error('Failed to save search cache:', error);\n      }\n    },\n    [bookHash, appService, getSearchCacheKey],\n  );\n\n  const clearSearchCache = useCallback(async () => {\n    const cacheDir = `${SEARCH_CACHE_DIR}/${bookHash}`;\n    try {\n      if (await appService?.exists(cacheDir, 'Cache')) {\n        await appService?.deleteDir(cacheDir, 'Cache', true);\n      }\n    } catch (error) {\n      console.error('Failed to clear search cache:', error);\n    }\n  }, [bookHash, appService]);\n\n  const view = getView(bookKey)!;\n  const config = getConfig(bookKey)!;\n  const bookData = getBookData(bookKey)!;\n  const progress = getProgress(bookKey)!;\n  const primaryLang = bookData.book?.primaryLanguage || 'en';\n\n  const iconSize12 = useResponsiveSize(12);\n  const iconSize16 = useResponsiveSize(16);\n\n  useEffect(() => {\n    handleSearchTermChange(searchTerm);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [bookKey, searchTerm]);\n\n  useEffect(() => {\n    if (isVisible && inputRef.current) {\n      inputRef.current.onblur = () => {\n        inputFocusedRef.current = false;\n      };\n      inputRef.current.onfocus = () => {\n        inputFocusedRef.current = true;\n      };\n      if (!appService?.isMobile) {\n        inputRef.current.focus();\n      }\n    }\n    if (isVisible && searchTerm) {\n      handleSearchTermChange(searchTerm);\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [appService, isVisible]);\n\n  useEffect(() => {\n    const handleKeyDown = (e: KeyboardEvent) => {\n      if (e.key === 'Escape') {\n        if (inputRef.current && inputFocusedRef.current) {\n          inputRef.current.blur();\n        } else {\n          onHideSearchBar();\n        }\n      }\n    };\n    window.addEventListener('keydown', handleKeyDown);\n    return () => {\n      window.removeEventListener('keydown', handleKeyDown);\n    };\n  }, [onHideSearchBar]);\n\n  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const value = e.target.value;\n    setSearchTerm(bookKey, value);\n    handleSearchTermChange(value);\n  };\n\n  const handleSearchConfigChange = (searchConfig: BookSearchConfig) => {\n    setConfig(bookKey, { searchConfig: { ...searchConfig } });\n    saveConfig(envConfig, bookKey, config, settings);\n    handleSearchTermChange(searchTerm);\n  };\n\n  const exceedMinSearchTermLength = (searchTerm: string) => {\n    const minLength = isCJKStr(searchTerm)\n      ? MINIMUM_SEARCH_TERM_LENGTH_CJK\n      : MINIMUM_SEARCH_TERM_LENGTH_DEFAULT;\n\n    return searchTerm.length >= minLength;\n  };\n\n  const handleSearch = useCallback(\n    async (term: string) => {\n      console.log('searching for:', term);\n\n      const searchConfig = config.searchConfig as BookSearchConfig;\n      const cachedResults = await getSearchCache(term, searchConfig);\n      if (cachedResults) {\n        setSearchResults(bookKey, cachedResults);\n        setSearchProgress(bookKey, 1);\n        if (cachedResults.length > 0) {\n          addToHistory(term);\n        }\n      }\n\n      // Reset progress at start of search\n      setSearchProgress(bookKey, 0);\n      setSearchStatus(bookKey, 'searching');\n\n      const { section } = progress;\n      const index = searchConfig.scope === 'section' ? section.current : undefined;\n      const generator = await view.search({\n        ...searchConfig,\n        index,\n        query: term,\n        acceptNode: createRejectFilter({\n          tags: primaryLang.startsWith('ja') ? ['rt'] : [],\n        }),\n        results: cachedResults,\n      });\n      const results: BookSearchResult[] = [];\n      let lastProgressLogTime = 0;\n\n      const processResults = async () => {\n        for await (const result of generator) {\n          if (getSearchStatus(bookKey) === 'terminated') {\n            console.log('search terminated');\n            return;\n          }\n          if (typeof result === 'string') {\n            if (result === 'done') {\n              setSearchStatus(bookKey, 'completed');\n              setSearchResults(bookKey, [...results]);\n              setSearchProgress(bookKey, 1);\n              if (results.length > 0) {\n                addToHistory(term);\n                await saveSearchCache(term, searchConfig, results);\n              }\n              console.log('search done');\n            }\n          } else {\n            if (result.progress) {\n              setSearchProgress(bookKey, result.progress);\n              const now = Date.now();\n              if (now - lastProgressLogTime >= 1000) {\n                console.log('search progress:', result.progress);\n                lastProgressLogTime = now;\n              }\n              if (queuedSearchTerm.current !== term) {\n                console.log('search term changed, resetting search');\n                resetSearch();\n                return;\n              }\n            } else {\n              results.push(result);\n              setSearchResults(bookKey, [...results]);\n            }\n          }\n\n          await new Promise((resolve) => setTimeout(resolve, 0));\n        }\n      };\n\n      processResults();\n    },\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    [\n      progress,\n      config.searchConfig,\n      setSearchResults,\n      setSearchProgress,\n      addToHistory,\n      getSearchCache,\n      saveSearchCache,\n    ],\n  );\n\n  const resetSearch = useCallback(() => {\n    setSearchResults(bookKey, []);\n    view?.clearSearch();\n  }, [bookKey, view, setSearchResults]);\n\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  const handleSearchTermChange = useCallback(\n    debounce((term: string) => {\n      queuedSearchTerm.current = term;\n      if (exceedMinSearchTermLength(term)) {\n        handleSearch(term);\n      } else {\n        resetSearch();\n      }\n    }, 500),\n    [handleSearch, resetSearch],\n  );\n\n  return (\n    <div className='relative flex flex-col gap-3 p-2'>\n      <div className='bg-base-100 flex h-8 items-center rounded-lg'>\n        <div className='absolute ps-3'>\n          <FaSearch size={iconSize16} className='text-base-content/50' />\n        </div>\n\n        <input\n          ref={inputRef}\n          type='text'\n          value={searchTerm}\n          spellCheck={false}\n          onChange={handleInputChange}\n          placeholder={_('Search...')}\n          className='search-input w-full bg-transparent p-2 pr-0 ps-10 font-sans text-sm font-light focus:outline-none'\n        />\n\n        {searchTerm && (\n          <button\n            onClick={handleClearInput}\n            className='absolute end-8 flex h-8 w-8 items-center justify-center bg-transparent'\n            aria-label={_('Clear search')}\n          >\n            <IoMdCloseCircle size={iconSize16} className='text-base-content/75' />\n          </button>\n        )}\n\n        <div\n          className={clsx(\n            'absolute end-2 flex h-8 w-8 items-center rounded-r-lg',\n            viewSettings?.isEink ? 'bg-transparent' : 'bg-base-300',\n          )}\n        >\n          <Dropdown\n            label={_('Search Options')}\n            className={clsx(\n              window.innerWidth < 640 && 'dropdown-end',\n              'dropdown-bottom flex justify-center',\n            )}\n            menuClassName={window.innerWidth < 640 ? 'no-triangle mt-1' : 'dropdown-center mt-3.5'}\n            buttonClassName={clsx(\n              'btn btn-ghost h-8 min-h-8 w-8 p-0 rounded-none rounded-r-lg',\n              viewSettings?.isEink ? '!bg-transparent hover:!bg-transparent' : '',\n            )}\n            toggleButton={<FaChevronDown size={iconSize12} className='text-base-content/50' />}\n          >\n            <SearchOptions\n              isEink={!!viewSettings?.isEink}\n              searchConfig={config.searchConfig as BookSearchConfig}\n              onSearchConfigChanged={handleSearchConfigChange}\n            />\n          </Dropdown>\n        </div>\n      </div>\n\n      {searchHistory.length > 0 && !searchTerm && (\n        <div className='relative flex'>\n          <div\n            className={clsx(\n              'from-base-200 pointer-events-none absolute left-0 top-0 h-full w-3 bg-gradient-to-r to-transparent',\n              viewSettings?.isEink ? 'hidden' : '',\n            )}\n            aria-hidden='true'\n          />\n          <div\n            className='scrollbar-hidden flex flex-1 gap-1.5 overflow-x-auto'\n            style={{ scrollbarWidth: 'none', msOverflowStyle: 'none' }}\n          >\n            {searchHistory.map((term, index) => (\n              <button\n                key={index}\n                onClick={() => handleHistoryClick(term)}\n                className='hover:bg-base-200/20 text-base-content/70 bg-base-100 max-w-[60%] flex-shrink-0 whitespace-nowrap rounded-full px-3 py-0.5 text-xs'\n              >\n                <p className='truncate'>{term}</p>\n              </button>\n            ))}\n          </div>\n          <div\n            className={clsx(\n              'from-base-200 pointer-events-none absolute right-6 top-0 h-full w-6 bg-gradient-to-l to-transparent',\n              viewSettings?.isEink ? 'hidden' : '',\n            )}\n            aria-hidden='true'\n          />\n          <button\n            onClick={handleClearHistory}\n            className={clsx(\n              'text-base-content/50 hover:text-base-content/80 flex-shrink-0 items-center',\n              'flex h-6 min-h-6 w-8 min-w-8 items-center justify-center p-0',\n            )}\n            title={_('Clear search history')}\n            aria-label={_('Clear search history')}\n          >\n            <MdDeleteOutline size={iconSize16} />\n          </button>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default SearchBar;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2720, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/app/reader/components/sidebar/SearchResults.tsx"],"sourcesContent":["import React from 'react';\nimport { BookSearchMatch, BookSearchResult, SearchExcerpt } from '@/types/book';\nimport { useReaderStore } from '@/store/readerStore';\nimport useScrollToItem from '../../hooks/useScrollToItem';\nimport clsx from 'clsx';\n\ninterface SearchResultItemProps {\n  bookKey: string;\n  cfi: string;\n  excerpt: SearchExcerpt;\n  onSelectResult: (cfi: string) => void;\n}\n\nconst SearchResultItem: React.FC<SearchResultItemProps> = ({\n  bookKey,\n  cfi,\n  excerpt,\n  onSelectResult,\n}) => {\n  const { getProgress } = useReaderStore();\n  const progress = getProgress(bookKey)!;\n  const { isCurrent, viewRef } = useScrollToItem(cfi, progress);\n\n  return (\n    <li\n      // eslint-disable-next-line jsx-a11y/no-noninteractive-element-to-interactive-role\n      role='button'\n      ref={viewRef}\n      className={clsx(\n        'my-2 cursor-pointer rounded-lg p-2 text-sm',\n        isCurrent ? 'bg-base-300 hover:bg-gray-300/70' : 'hover:bg-base-300 bg-base-100',\n      )}\n      tabIndex={0}\n      onClick={() => onSelectResult(cfi)}\n      onKeyDown={(e) => {\n        if (e.key === 'Enter' || e.key === ' ') {\n          onSelectResult(cfi);\n        } else {\n          e.stopPropagation();\n        }\n      }}\n    >\n      <div className='line-clamp-3'>\n        <span className=''>{excerpt.pre}</span>\n        <span className='font-bold text-red-500'>{excerpt.match}</span>\n        <span className=''>{excerpt.post}</span>\n      </div>\n    </li>\n  );\n};\ninterface SearchResultsProps {\n  bookKey: string;\n  results: BookSearchResult[] | BookSearchMatch[];\n  onSelectResult: (cfi: string) => void;\n}\n\nconst SearchResults: React.FC<SearchResultsProps> = ({ bookKey, results, onSelectResult }) => {\n  return (\n    <div className='search-results overflow-y-auto p-2 font-sans text-sm font-light'>\n      <ul className='px-2'>\n        {results.map((result, index) => {\n          if ('subitems' in result) {\n            return (\n              <ul key={`${index}-${result.label}`}>\n                <h3 className='line-clamp-1 font-normal'>{result.label}</h3>\n                <ul>\n                  {result.subitems.map((item, index) => (\n                    <SearchResultItem\n                      key={`${index}-${item.cfi}`}\n                      bookKey={bookKey}\n                      cfi={item.cfi}\n                      excerpt={item.excerpt}\n                      onSelectResult={onSelectResult}\n                    />\n                  ))}\n                </ul>\n              </ul>\n            );\n          } else {\n            return (\n              <SearchResultItem\n                key={`${index}-${result.cfi}`}\n                bookKey={bookKey}\n                cfi={result.cfi}\n                excerpt={result.excerpt}\n                onSelectResult={onSelectResult}\n              />\n            );\n          }\n        })}\n      </ul>\n    </div>\n  );\n};\n\nexport default SearchResults;\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;;;;;;AASA,MAAM,mBAAoD,CAAC,EACzD,OAAO,EACP,GAAG,EACH,OAAO,EACP,cAAc,EACf;;IACC,MAAM,EAAE,WAAW,EAAE,GAAG,IAAA,mKAAc;IACtC,MAAM,WAAW,YAAY;IAC7B,MAAM,EAAE,SAAS,EAAE,OAAO,EAAE,GAAG,IAAA,iLAAe,EAAC,KAAK;IAEpD,qBACE,6MAAC;QACC,kFAAkF;QAClF,MAAK;QACL,KAAK;QACL,WAAW,IAAA,6LAAI,EACb,8CACA,YAAY,qCAAqC;QAEnD,UAAU;QACV,SAAS,IAAM,eAAe;QAC9B,WAAW,CAAC;YACV,IAAI,EAAE,GAAG,KAAK,WAAW,EAAE,GAAG,KAAK,KAAK;gBACtC,eAAe;YACjB,OAAO;gBACL,EAAE,eAAe;YACnB;QACF;kBAEA,cAAA,6MAAC;YAAI,WAAU;;8BACb,6MAAC;oBAAK,WAAU;8BAAI,QAAQ,GAAG;;;;;;8BAC/B,6MAAC;oBAAK,WAAU;8BAA0B,QAAQ,KAAK;;;;;;8BACvD,6MAAC;oBAAK,WAAU;8BAAI,QAAQ,IAAI;;;;;;;;;;;;;;;;;AAIxC;GApCM;;QAMoB,mKAAc;QAEP,iLAAe;;;KAR1C;AA2CN,MAAM,gBAA8C,CAAC,EAAE,OAAO,EAAE,OAAO,EAAE,cAAc,EAAE;IACvF,qBACE,6MAAC;QAAI,WAAU;kBACb,cAAA,6MAAC;YAAG,WAAU;sBACX,QAAQ,GAAG,CAAC,CAAC,QAAQ;gBACpB,IAAI,cAAc,QAAQ;oBACxB,qBACE,6MAAC;;0CACC,6MAAC;gCAAG,WAAU;0CAA4B,OAAO,KAAK;;;;;;0CACtD,6MAAC;0CACE,OAAO,QAAQ,CAAC,GAAG,CAAC,CAAC,MAAM,sBAC1B,6MAAC;wCAEC,SAAS;wCACT,KAAK,KAAK,GAAG;wCACb,SAAS,KAAK,OAAO;wCACrB,gBAAgB;uCAJX,GAAG,MAAM,CAAC,EAAE,KAAK,GAAG,EAAE;;;;;;;;;;;uBAL1B,GAAG,MAAM,CAAC,EAAE,OAAO,KAAK,EAAE;;;;;gBAevC,OAAO;oBACL,qBACE,6MAAC;wBAEC,SAAS;wBACT,KAAK,OAAO,GAAG;wBACf,SAAS,OAAO,OAAO;wBACvB,gBAAgB;uBAJX,GAAG,MAAM,CAAC,EAAE,OAAO,GAAG,EAAE;;;;;gBAOnC;YACF;;;;;;;;;;;AAIR;MArCM;uCAuCS"}},
    {"offset": {"line": 2873, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/app/reader/components/sidebar/SideBar.tsx"],"sourcesContent":["'use client';\n\nimport clsx from 'clsx';\nimport React, { useCallback, useEffect, useRef, useState } from 'react';\n\nimport { impactFeedback } from '@tauri-apps/plugin-haptics';\nimport { useSettingsStore } from '@/store/settingsStore';\nimport { useBookDataStore } from '@/store/bookDataStore';\nimport { useReaderStore } from '@/store/readerStore';\nimport { useSidebarStore } from '@/store/sidebarStore';\nimport { useTranslation } from '@/hooks/useTranslation';\nimport { eventDispatcher } from '@/utils/event';\nimport { getBookDirFromLanguage } from '@/utils/book';\nimport { useEnv } from '@/context/EnvContext';\nimport { DragKey, useDrag } from '@/hooks/useDrag';\nimport { useThemeStore } from '@/store/themeStore';\nimport { Overlay } from '@/components/Overlay';\nimport useShortcuts from '@/hooks/useShortcuts';\nimport SidebarHeader from './Header';\nimport SidebarContent from './Content';\nimport BookCard from './BookCard';\nimport useSidebar from '../../hooks/useSidebar';\nimport SearchBar from './SearchBar';\nimport SearchResults from './SearchResults';\n\nconst MIN_SIDEBAR_WIDTH = 0.05;\nconst MAX_SIDEBAR_WIDTH = 0.45;\n\nconst VELOCITY_THRESHOLD = 0.5;\n\nconst SideBar: React.FC<{\n  onGoToLibrary: () => void;\n}> = ({ onGoToLibrary }) => {\n  const _ = useTranslation();\n  const { appService } = useEnv();\n  const { updateAppTheme, safeAreaInsets } = useThemeStore();\n  const { settings } = useSettingsStore();\n  const { sideBarBookKey, setSideBarBookKey, getSearchNavState, setSearchTerm, clearSearch } =\n    useSidebarStore();\n  const searchNavState = sideBarBookKey ? getSearchNavState(sideBarBookKey) : null;\n  const { searchTerm = '', searchResults = null } = searchNavState || {};\n  const { getBookData } = useBookDataStore();\n  const { getView, getViewSettings } = useReaderStore();\n  const [isSearchBarVisible, setIsSearchBarVisible] = useState(false);\n  const searchTermRef = useRef(searchTerm);\n  const sidebarHeight = useRef(1.0);\n  const isMobile = window.innerWidth < 640;\n  const {\n    sideBarWidth,\n    isSideBarPinned,\n    isSideBarVisible,\n    getSideBarWidth,\n    setSideBarVisible,\n    handleSideBarResize,\n    handleSideBarTogglePin,\n  } = useSidebar(\n    settings.globalReadSettings.sideBarWidth,\n    isMobile ? false : settings.globalReadSettings.isSideBarPinned,\n  );\n\n  const onSearchEvent = async (event: CustomEvent) => {\n    const { term, bookKey } = event.detail;\n    setSideBarVisible(true);\n    setSideBarBookKey(bookKey);\n    setIsSearchBarVisible(true);\n    if (term !== undefined && term !== null) {\n      setSearchTerm(bookKey, term);\n    }\n  };\n\n  const onNavigateEvent = async () => {\n    const pinButton = document.querySelector('.sidebar-pin-btn');\n    const isPinButtonHidden = !pinButton || window.getComputedStyle(pinButton).display === 'none';\n    if (isPinButtonHidden) {\n      setSideBarVisible(false);\n    }\n  };\n\n  useEffect(() => {\n    if (isSideBarVisible) {\n      updateAppTheme('base-200');\n    } else {\n      updateAppTheme('base-100');\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [isSideBarVisible]);\n\n  useEffect(() => {\n    searchTermRef.current = searchTerm;\n  }, [searchTerm]);\n\n  useEffect(() => {\n    eventDispatcher.on('search-term', onSearchEvent);\n    eventDispatcher.on('navigate', onNavigateEvent);\n    return () => {\n      eventDispatcher.off('search-term', onSearchEvent);\n      eventDispatcher.off('navigate', onNavigateEvent);\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  const handleVerticalDragMove = (data: { clientY: number }) => {\n    if (!isMobile) return;\n\n    const heightFraction = data.clientY / window.innerHeight;\n    const newTop = Math.max(0.0, Math.min(1, heightFraction));\n    sidebarHeight.current = newTop;\n\n    const sidebar = document.querySelector('.sidebar-container') as HTMLElement;\n    const overlay = document.querySelector('.overlay') as HTMLElement;\n\n    if (sidebar && overlay) {\n      sidebar.style.top = `${newTop * 100}%`;\n      overlay.style.opacity = `${1 - heightFraction}`;\n    }\n  };\n\n  const handleVerticalDragEnd = (data: { velocity: number; clientY: number }) => {\n    const sidebar = document.querySelector('.sidebar-container') as HTMLElement;\n    const overlay = document.querySelector('.overlay') as HTMLElement;\n\n    if (!sidebar || !overlay) return;\n\n    if (\n      data.velocity > VELOCITY_THRESHOLD ||\n      (data.velocity >= 0 && data.clientY >= window.innerHeight * 0.5)\n    ) {\n      const transitionDuration = 0.15 / Math.max(data.velocity, 0.5);\n      sidebar.style.transition = `top ${transitionDuration}s ease-out`;\n      sidebar.style.top = '100%';\n      overlay.style.transition = `opacity ${transitionDuration}s ease-out`;\n      overlay.style.opacity = '0';\n      setTimeout(() => setSideBarVisible(false), 300);\n      if (appService?.hasHaptics) {\n        impactFeedback('medium');\n      }\n    } else {\n      sidebar.style.transition = 'top 0.3s ease-out';\n      sidebar.style.top = '0%';\n      overlay.style.transition = 'opacity 0.3s ease-out';\n      overlay.style.opacity = '0.8';\n      if (appService?.hasHaptics) {\n        impactFeedback('medium');\n      }\n    }\n  };\n\n  const handleHorizontalDragMove = (data: { clientX: number }) => {\n    const widthFraction = data.clientX / window.innerWidth;\n    const newWidth = Math.max(MIN_SIDEBAR_WIDTH, Math.min(MAX_SIDEBAR_WIDTH, widthFraction));\n    handleSideBarResize(`${Math.round(newWidth * 10000) / 100}%`);\n  };\n\n  const handleHorizontalDragKeyDown = (data: { key: DragKey; step: number }) => {\n    const currentWidth = parseFloat(getSideBarWidth()) / 100;\n    let newWidth = currentWidth;\n\n    if (data.key === 'ArrowLeft') {\n      newWidth = Math.max(MIN_SIDEBAR_WIDTH, currentWidth - data.step);\n    } else if (data.key === 'ArrowRight') {\n      newWidth = Math.min(MAX_SIDEBAR_WIDTH, currentWidth + data.step);\n    }\n    handleSideBarResize(`${Math.round(newWidth * 10000) / 100}%`);\n  };\n\n  const handleVerticalDragKeyDown = () => {};\n\n  const { handleDragStart: handleVerticalDragStart } = useDrag(\n    handleVerticalDragMove,\n    handleVerticalDragKeyDown,\n    handleVerticalDragEnd,\n  );\n  const { handleDragStart: handleHorizontalDragStart, handleDragKeyDown } = useDrag(\n    handleHorizontalDragMove,\n    handleHorizontalDragKeyDown,\n  );\n\n  const handleClickOverlay = () => {\n    setSideBarVisible(false);\n  };\n\n  const handleToggleSearchBar = () => {\n    setIsSearchBarVisible((prev) => {\n      if (prev) handleHideSearchBar();\n      return !prev;\n    });\n  };\n\n  const handleShowSearchBar = useCallback(() => {\n    setTimeout(() => {\n      setSideBarVisible(true);\n      setIsSearchBarVisible(true);\n    }, 100);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  const handleHideSearchBar = useCallback(() => {\n    setIsSearchBarVisible(false);\n    setTimeout(() => {\n      if (sideBarBookKey) clearSearch(sideBarBookKey);\n    }, 100);\n    getView(sideBarBookKey)?.clearSearch();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [sideBarBookKey, clearSearch]);\n\n  const handleHideSideBar = useCallback(() => {\n    if (searchTermRef.current) {\n      handleHideSearchBar();\n    } else if (!isSideBarPinned) {\n      setSideBarVisible(false);\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [sideBarBookKey, isSideBarPinned]);\n\n  useShortcuts({ onShowSearchBar: handleShowSearchBar, onEscape: handleHideSideBar }, [\n    handleHideSideBar,\n  ]);\n\n  const handleSearchResultClick = (cfi: string) => {\n    onNavigateEvent();\n    getView(sideBarBookKey)?.goTo(cfi);\n  };\n\n  if (!sideBarBookKey) return null;\n\n  const viewSettings = getViewSettings(sideBarBookKey);\n  const bookData = getBookData(sideBarBookKey);\n  if (!bookData || !bookData.book || !bookData.bookDoc) {\n    return null;\n  }\n  const { book, bookDoc } = bookData;\n  const languageDir = getBookDirFromLanguage(bookDoc.metadata.language);\n\n  return isSideBarVisible ? (\n    <>\n      {!isSideBarPinned && (\n        <Overlay\n          className={clsx('z-[45]', viewSettings?.isEink ? '' : 'bg-black/50 sm:bg-black/20')}\n          onDismiss={handleClickOverlay}\n        />\n      )}\n      <div\n        className={clsx(\n          'sidebar-container flex min-w-60 select-none flex-col',\n          'full-height transition-[padding-top] duration-300',\n          viewSettings?.isEink ? 'bg-base-100' : 'bg-base-200',\n          appService?.hasRoundedWindow && 'rounded-window-top-left rounded-window-bottom-left',\n          isSideBarPinned ? 'z-20' : 'z-[45] shadow-2xl',\n          !isSideBarPinned && viewSettings?.isEink && 'border-base-content border-e',\n        )}\n        role='group'\n        aria-label={_('Sidebar')}\n        dir={viewSettings?.rtl && languageDir === 'rtl' ? 'rtl' : 'ltr'}\n        style={{\n          width: `${sideBarWidth}`,\n          maxWidth: `${MAX_SIDEBAR_WIDTH * 100}%`,\n          position: isSideBarPinned ? 'relative' : 'absolute',\n          paddingTop: `${safeAreaInsets?.top || 0}px`,\n        }}\n      >\n        <style jsx>{`\n          @media (max-width: 640px) {\n            .sidebar-container {\n              width: 100%;\n              min-width: 100%;\n              border-top-left-radius: 16px;\n              border-top-right-radius: 16px;\n            }\n            .sidebar-container.open {\n              top: 0%;\n            }\n            .overlay {\n              transition: opacity 0.3s ease-in-out;\n            }\n          }\n        `}</style>\n        <div\n          className={clsx(\n            'drag-bar absolute -right-2 top-0 h-full w-0.5 cursor-col-resize bg-transparent p-1',\n            isMobile && 'hidden',\n          )}\n          role='slider'\n          tabIndex={0}\n          aria-label={_('Resize Sidebar')}\n          aria-orientation='horizontal'\n          aria-valuenow={parseFloat(sideBarWidth)}\n          onMouseDown={handleHorizontalDragStart}\n          onTouchStart={handleHorizontalDragStart}\n          onKeyDown={handleDragKeyDown}\n        ></div>\n        <div className='flex-shrink-0'>\n          {isMobile && (\n            <div\n              role='slider'\n              tabIndex={0}\n              aria-label={_('Resize Sidebar')}\n              aria-orientation='vertical'\n              aria-valuenow={sidebarHeight.current}\n              className='drag-handle flex h-10 w-full cursor-row-resize items-center justify-center'\n              onMouseDown={handleVerticalDragStart}\n              onTouchStart={handleVerticalDragStart}\n            >\n              <div className='bg-base-content/50 h-1 w-10 rounded-full'></div>\n            </div>\n          )}\n          <SidebarHeader\n            isPinned={isSideBarPinned}\n            isSearchBarVisible={isSearchBarVisible}\n            onGoToLibrary={onGoToLibrary}\n            onClose={() => setSideBarVisible(false)}\n            onTogglePin={handleSideBarTogglePin}\n            onToggleSearchBar={handleToggleSearchBar}\n          />\n          <div\n            className={clsx('search-bar', {\n              'search-bar-visible': isSearchBarVisible,\n            })}\n          >\n            <SearchBar\n              isVisible={isSearchBarVisible}\n              bookKey={sideBarBookKey!}\n              onHideSearchBar={handleHideSearchBar}\n            />\n          </div>\n          <div className='border-base-300/50 border-b px-3'>\n            <BookCard book={book} />\n          </div>\n        </div>\n        {isSearchBarVisible && searchResults ? (\n          <SearchResults\n            bookKey={sideBarBookKey!}\n            results={searchResults}\n            onSelectResult={handleSearchResultClick}\n          />\n        ) : (\n          <SidebarContent bookDoc={bookDoc} sideBarBookKey={sideBarBookKey!} />\n        )}\n      </div>\n    </>\n  ) : null;\n};\n\nexport default SideBar;\n"],"names":[],"mappings":";;;;;;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAvBA;;;;;;;;;;;;;;;;;;;;;;;AAyBA,MAAM,oBAAoB;AAC1B,MAAM,oBAAoB;AAE1B,MAAM,qBAAqB;AAE3B,MAAM,UAED,CAAC,EAAE,aAAa,EAAE;;IACrB,MAAM,IAAI,IAAA,sKAAc;IACxB,MAAM,EAAE,UAAU,EAAE,GAAG,IAAA,6JAAM;IAC7B,MAAM,EAAE,cAAc,EAAE,cAAc,EAAE,GAAG,IAAA,iKAAa;IACxD,MAAM,EAAE,QAAQ,EAAE,GAAG,IAAA,uKAAgB;IACrC,MAAM,EAAE,cAAc,EAAE,iBAAiB,EAAE,iBAAiB,EAAE,aAAa,EAAE,WAAW,EAAE,GACxF,IAAA,qKAAe;IACjB,MAAM,iBAAiB,iBAAiB,kBAAkB,kBAAkB;IAC5E,MAAM,EAAE,aAAa,EAAE,EAAE,gBAAgB,IAAI,EAAE,GAAG,kBAAkB,CAAC;IACrE,MAAM,EAAE,WAAW,EAAE,GAAG,IAAA,uKAAgB;IACxC,MAAM,EAAE,OAAO,EAAE,eAAe,EAAE,GAAG,IAAA,mKAAc;IACnD,MAAM,CAAC,oBAAoB,sBAAsB,GAAG,IAAA,yLAAQ,EAAC;IAC7D,MAAM,gBAAgB,IAAA,uLAAM,EAAC;IAC7B,MAAM,gBAAgB,IAAA,uLAAM,EAAC;IAC7B,MAAM,WAAW,OAAO,UAAU,GAAG;IACrC,MAAM,EACJ,YAAY,EACZ,eAAe,EACf,gBAAgB,EAChB,eAAe,EACf,iBAAiB,EACjB,mBAAmB,EACnB,sBAAsB,EACvB,GAAG,IAAA,4KAAU,EACZ,SAAS,kBAAkB,CAAC,YAAY,EACxC,WAAW,QAAQ,SAAS,kBAAkB,CAAC,eAAe;IAGhE,MAAM,gBAAgB,OAAO;QAC3B,MAAM,EAAE,IAAI,EAAE,OAAO,EAAE,GAAG,MAAM,MAAM;QACtC,kBAAkB;QAClB,kBAAkB;QAClB,sBAAsB;QACtB,IAAI,SAAS,aAAa,SAAS,MAAM;YACvC,cAAc,SAAS;QACzB;IACF;IAEA,MAAM,kBAAkB;QACtB,MAAM,YAAY,SAAS,aAAa,CAAC;QACzC,MAAM,oBAAoB,CAAC,aAAa,OAAO,gBAAgB,CAAC,WAAW,OAAO,KAAK;QACvF,IAAI,mBAAmB;YACrB,kBAAkB;QACpB;IACF;IAEA,IAAA,0LAAS;6BAAC;YACR,IAAI,kBAAkB;gBACpB,eAAe;YACjB,OAAO;gBACL,eAAe;YACjB;QACA,uDAAuD;QACzD;4BAAG;QAAC;KAAiB;IAErB,IAAA,0LAAS;6BAAC;YACR,cAAc,OAAO,GAAG;QAC1B;4BAAG;QAAC;KAAW;IAEf,IAAA,0LAAS;6BAAC;YACR,8JAAe,CAAC,EAAE,CAAC,eAAe;YAClC,8JAAe,CAAC,EAAE,CAAC,YAAY;YAC/B;qCAAO;oBACL,8JAAe,CAAC,GAAG,CAAC,eAAe;oBACnC,8JAAe,CAAC,GAAG,CAAC,YAAY;gBAClC;;QACA,uDAAuD;QACzD;4BAAG,EAAE;IAEL,MAAM,yBAAyB,CAAC;QAC9B,IAAI,CAAC,UAAU;QAEf,MAAM,iBAAiB,KAAK,OAAO,GAAG,OAAO,WAAW;QACxD,MAAM,SAAS,KAAK,GAAG,CAAC,KAAK,KAAK,GAAG,CAAC,GAAG;QACzC,cAAc,OAAO,GAAG;QAExB,MAAM,UAAU,SAAS,aAAa,CAAC;QACvC,MAAM,UAAU,SAAS,aAAa,CAAC;QAEvC,IAAI,WAAW,SAAS;YACtB,QAAQ,KAAK,CAAC,GAAG,GAAG,GAAG,SAAS,IAAI,CAAC,CAAC;YACtC,QAAQ,KAAK,CAAC,OAAO,GAAG,GAAG,IAAI,gBAAgB;QACjD;IACF;IAEA,MAAM,wBAAwB,CAAC;QAC7B,MAAM,UAAU,SAAS,aAAa,CAAC;QACvC,MAAM,UAAU,SAAS,aAAa,CAAC;QAEvC,IAAI,CAAC,WAAW,CAAC,SAAS;QAE1B,IACE,KAAK,QAAQ,GAAG,sBACf,KAAK,QAAQ,IAAI,KAAK,KAAK,OAAO,IAAI,OAAO,WAAW,GAAG,KAC5D;YACA,MAAM,qBAAqB,OAAO,KAAK,GAAG,CAAC,KAAK,QAAQ,EAAE;YAC1D,QAAQ,KAAK,CAAC,UAAU,GAAG,CAAC,IAAI,EAAE,mBAAmB,UAAU,CAAC;YAChE,QAAQ,KAAK,CAAC,GAAG,GAAG;YACpB,QAAQ,KAAK,CAAC,UAAU,GAAG,CAAC,QAAQ,EAAE,mBAAmB,UAAU,CAAC;YACpE,QAAQ,KAAK,CAAC,OAAO,GAAG;YACxB,WAAW,IAAM,kBAAkB,QAAQ;YAC3C,IAAI,YAAY,YAAY;gBAC1B,IAAA,0QAAc,EAAC;YACjB;QACF,OAAO;YACL,QAAQ,KAAK,CAAC,UAAU,GAAG;YAC3B,QAAQ,KAAK,CAAC,GAAG,GAAG;YACpB,QAAQ,KAAK,CAAC,UAAU,GAAG;YAC3B,QAAQ,KAAK,CAAC,OAAO,GAAG;YACxB,IAAI,YAAY,YAAY;gBAC1B,IAAA,0QAAc,EAAC;YACjB;QACF;IACF;IAEA,MAAM,2BAA2B,CAAC;QAChC,MAAM,gBAAgB,KAAK,OAAO,GAAG,OAAO,UAAU;QACtD,MAAM,WAAW,KAAK,GAAG,CAAC,mBAAmB,KAAK,GAAG,CAAC,mBAAmB;QACzE,oBAAoB,GAAG,KAAK,KAAK,CAAC,WAAW,SAAS,IAAI,CAAC,CAAC;IAC9D;IAEA,MAAM,8BAA8B,CAAC;QACnC,MAAM,eAAe,WAAW,qBAAqB;QACrD,IAAI,WAAW;QAEf,IAAI,KAAK,GAAG,KAAK,aAAa;YAC5B,WAAW,KAAK,GAAG,CAAC,mBAAmB,eAAe,KAAK,IAAI;QACjE,OAAO,IAAI,KAAK,GAAG,KAAK,cAAc;YACpC,WAAW,KAAK,GAAG,CAAC,mBAAmB,eAAe,KAAK,IAAI;QACjE;QACA,oBAAoB,GAAG,KAAK,KAAK,CAAC,WAAW,SAAS,IAAI,CAAC,CAAC;IAC9D;IAEA,MAAM,4BAA4B,KAAO;IAEzC,MAAM,EAAE,iBAAiB,uBAAuB,EAAE,GAAG,IAAA,wJAAO,EAC1D,wBACA,2BACA;IAEF,MAAM,EAAE,iBAAiB,yBAAyB,EAAE,iBAAiB,EAAE,GAAG,IAAA,wJAAO,EAC/E,0BACA;IAGF,MAAM,qBAAqB;QACzB,kBAAkB;IACpB;IAEA,MAAM,wBAAwB;QAC5B,sBAAsB,CAAC;YACrB,IAAI,MAAM;YACV,OAAO,CAAC;QACV;IACF;IAEA,MAAM,sBAAsB,IAAA,4LAAW;oDAAC;YACtC;4DAAW;oBACT,kBAAkB;oBAClB,sBAAsB;gBACxB;2DAAG;QACH,uDAAuD;QACzD;mDAAG,EAAE;IAEL,MAAM,sBAAsB,IAAA,4LAAW;oDAAC;YACtC,sBAAsB;YACtB;4DAAW;oBACT,IAAI,gBAAgB,YAAY;gBAClC;2DAAG;YACH,QAAQ,iBAAiB;QACzB,uDAAuD;QACzD;mDAAG;QAAC;QAAgB;KAAY;IAEhC,MAAM,oBAAoB,IAAA,4LAAW;kDAAC;YACpC,IAAI,cAAc,OAAO,EAAE;gBACzB;YACF,OAAO,IAAI,CAAC,iBAAiB;gBAC3B,kBAAkB;YACpB;QACA,uDAAuD;QACzD;iDAAG;QAAC;QAAgB;KAAgB;IAEpC,IAAA,6JAAY,EAAC;QAAE,iBAAiB;QAAqB,UAAU;IAAkB,GAAG;QAClF;KACD;IAED,MAAM,0BAA0B,CAAC;QAC/B;QACA,QAAQ,iBAAiB,KAAK;IAChC;IAEA,IAAI,CAAC,gBAAgB,OAAO;IAE5B,MAAM,eAAe,gBAAgB;IACrC,MAAM,WAAW,YAAY;IAC7B,IAAI,CAAC,YAAY,CAAC,SAAS,IAAI,IAAI,CAAC,SAAS,OAAO,EAAE;QACpD,OAAO;IACT;IACA,MAAM,EAAE,IAAI,EAAE,OAAO,EAAE,GAAG;IAC1B,MAAM,cAAc,IAAA,oKAAsB,EAAC,QAAQ,QAAQ,CAAC,QAAQ;IAEpE,OAAO,iCACL;;YACG,CAAC,iCACA,6MAAC,8JAAO;gBACN,WAAW,IAAA,6LAAI,EAAC,UAAU,cAAc,SAAS,KAAK;gBACtD,WAAW;;;;;;0BAGf,6MAAC;gBASC,MAAK;gBACL,cAAY,EAAE;gBACd,KAAK,cAAc,OAAO,gBAAgB,QAAQ,QAAQ;gBAC1D,OAAO;oBACL,OAAO,GAAG,cAAc;oBACxB,UAAU,GAAG,oBAAoB,IAAI,CAAC,CAAC;oBACvC,UAAU,kBAAkB,aAAa;oBACzC,YAAY,GAAG,gBAAgB,OAAO,EAAE,EAAE,CAAC;gBAC7C;2DAhBW,IAAA,6LAAI,EACb,wDACA,qDACA,cAAc,SAAS,gBAAgB,eACvC,YAAY,oBAAoB,sDAChC,kBAAkB,SAAS,qBAC3B,CAAC,mBAAmB,cAAc,UAAU;;;;;;kCA4B9C,6MAAC;wBAKC,MAAK;wBACL,UAAU;wBACV,cAAY,EAAE;wBACd,oBAAiB;wBACjB,iBAAe,WAAW;wBAC1B,aAAa;wBACb,cAAc;wBACd,WAAW;mEAXA,IAAA,6LAAI,EACb,sFACA,YAAY;;;;;;kCAWhB,6MAAC;kEAAc;;4BACZ,0BACC,6MAAC;gCACC,MAAK;gCACL,UAAU;gCACV,cAAY,EAAE;gCACd,oBAAiB;gCACjB,iBAAe,cAAc,OAAO;gCAEpC,aAAa;gCACb,cAAc;0EAFJ;0CAIV,cAAA,6MAAC;8EAAc;;;;;;;;;;;0CAGnB,6MAAC,yLAAa;gCACZ,UAAU;gCACV,oBAAoB;gCACpB,eAAe;gCACf,SAAS,IAAM,kBAAkB;gCACjC,aAAa;gCACb,mBAAmB;;;;;;0CAErB,6MAAC;2EACY,IAAA,6LAAI,EAAC,cAAc;oCAC5B,sBAAsB;gCACxB;0CAEA,cAAA,6MAAC,4LAAS;oCACR,WAAW;oCACX,SAAS;oCACT,iBAAiB;;;;;;;;;;;0CAGrB,6MAAC;0EAAc;0CACb,cAAA,6MAAC,2LAAQ;oCAAC,MAAM;;;;;;;;;;;;;;;;;oBAGnB,sBAAsB,8BACrB,6MAAC,gMAAa;wBACZ,SAAS;wBACT,SAAS;wBACT,gBAAgB;;;;;iFAGlB,6MAAC,0LAAc;wBAAC,SAAS;wBAAS,gBAAgB;;;;;;;;;;;;;uBAItD;AACN;GAtTM;;QAGM,sKAAc;QACD,6JAAM;QACc,iKAAa;QACnC,uKAAgB;QAEnC,qKAAe;QAGO,uKAAgB;QACH,mKAAc;QAa/C,4KAAU;QAgHuC,wJAAO;QAKc,wJAAO;QA0CjF,6JAAY;;;KAxLR;uCAwTS"}},
    {"offset": {"line": 3278, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/app/reader/components/sidebar/ContentNavBar.tsx"],"sourcesContent":["import clsx from 'clsx';\nimport React from 'react';\nimport { IoIosList, IoMdCloseCircle } from 'react-icons/io';\nimport { HiArrowLongLeft, HiArrowLongRight } from 'react-icons/hi2';\n\nimport { Insets } from '@/types/misc';\nimport { useEnv } from '@/context/EnvContext';\nimport { useTranslation } from '@/hooks/useTranslation';\nimport { useResponsiveSize } from '@/hooks/useResponsiveSize';\nimport { useReaderStore } from '@/store/readerStore';\n\ninterface ContentNavBarProps {\n  bookKey: string;\n  gridInsets: Insets;\n  title: string;\n  section?: string;\n  progress?: number; // 0 to 1, where 1 means complete\n  showListButton?: boolean;\n  hasPrevious: boolean;\n  hasNext: boolean;\n  previousLabel?: string;\n  nextLabel?: string;\n  previousTitle?: string;\n  nextTitle?: string;\n  showResultsTitle?: string;\n  closeTitle?: string;\n  onShowResults?: () => void;\n  onClose: () => void;\n  onPrevious: () => void;\n  onNext: () => void;\n}\n\nconst ContentNavBar: React.FC<ContentNavBarProps> = ({\n  bookKey,\n  gridInsets,\n  title,\n  section,\n  progress,\n  showListButton = true,\n  hasPrevious,\n  hasNext,\n  previousLabel,\n  nextLabel,\n  previousTitle,\n  nextTitle,\n  showResultsTitle,\n  closeTitle,\n  onShowResults,\n  onClose,\n  onPrevious,\n  onNext,\n}) => {\n  const { appService } = useEnv();\n  const _ = useTranslation();\n  const { getViewSettings } = useReaderStore();\n  const viewSettings = getViewSettings(bookKey);\n  const iconSize16 = useResponsiveSize(16);\n  const iconSize18 = useResponsiveSize(18);\n  const iconSize20 = useResponsiveSize(20);\n\n  const showSection = appService?.isMobile || !viewSettings?.showHeader;\n\n  return (\n    <div\n      className='results-nav-bar pointer-events-none absolute inset-0 z-30 flex flex-col items-center justify-between px-4 py-1'\n      style={{\n        top: gridInsets.top,\n        right: gridInsets.right,\n        bottom: gridInsets.bottom / 4,\n        left: gridInsets.left,\n      }}\n    >\n      {/* Top bar: Info */}\n      <div className='bg-base-100 pointer-events-auto relative flex items-center justify-between overflow-hidden rounded-xl px-2 py-1 shadow-lg sm:gap-6'>\n        {progress !== undefined && progress < 1 && (\n          <div\n            className='bg-base-200 absolute inset-y-0 left-0 transition-all duration-300'\n            style={{ width: `${progress * 100}%` }}\n          />\n        )}\n        {progress === 1 && <div className='bg-base-200 absolute inset-0' />}\n        {showListButton && onShowResults ? (\n          <button\n            title={showResultsTitle || _('Show Results')}\n            onClick={onShowResults}\n            className='btn btn-ghost relative z-10 h-8 min-h-8 w-8 p-0 hover:bg-transparent'\n          >\n            <IoIosList size={iconSize20} className='text-base-content' />\n          </button>\n        ) : (\n          <div className='relative z-10 w-8' />\n        )}\n\n        <div className='relative z-10 flex flex-1 flex-col items-center px-2'>\n          <span className='line-clamp-1 text-sm font-medium'>{title}</span>\n          {section && showSection && (\n            <span className='text-base-content/70 line-clamp-1 text-xs'>{section}</span>\n          )}\n        </div>\n\n        <button\n          title={closeTitle || _('Close')}\n          onClick={onClose}\n          className='btn btn-ghost relative z-10 h-8 min-h-8 w-8 p-0 hover:bg-transparent'\n        >\n          <IoMdCloseCircle size={iconSize16} />\n        </button>\n      </div>\n\n      {/* Bottom bar: Navigation buttons */}\n      <div className='bg-base-200 pointer-events-auto flex items-center justify-between gap-6 rounded-xl px-4 py-0 shadow-lg'>\n        <button\n          title={previousTitle || _('Previous')}\n          onClick={onPrevious}\n          disabled={!hasPrevious}\n          className={clsx(\n            'btn btn-ghost flex h-auto min-h-0 flex-1 flex-col items-center gap-0 p-1 hover:bg-transparent',\n            !hasPrevious && 'opacity-40 disabled:bg-transparent',\n          )}\n        >\n          <HiArrowLongLeft size={iconSize18} className='text-base-content' />\n          <span className='text-sm font-medium'>{previousLabel || _('Previous')}</span>\n        </button>\n\n        <button\n          title={nextTitle || _('Next')}\n          onClick={onNext}\n          disabled={!hasNext}\n          className={clsx(\n            'btn btn-ghost flex h-auto min-h-0 flex-1 flex-col items-center gap-0 p-1 hover:bg-transparent',\n            !hasNext && 'opacity-40 disabled:bg-transparent',\n          )}\n        >\n          <HiArrowLongRight size={iconSize18} className='text-base-content' />\n          <span className='text-sm font-medium'>{nextLabel || _('Next')}</span>\n        </button>\n      </div>\n    </div>\n  );\n};\n\nexport default ContentNavBar;\n"],"names":[],"mappings":";;;;;AAAA;AAEA;AACA;AAGA;AACA;AACA;AACA;;;;;;;;;;AAuBA,MAAM,gBAA8C,CAAC,EACnD,OAAO,EACP,UAAU,EACV,KAAK,EACL,OAAO,EACP,QAAQ,EACR,iBAAiB,IAAI,EACrB,WAAW,EACX,OAAO,EACP,aAAa,EACb,SAAS,EACT,aAAa,EACb,SAAS,EACT,gBAAgB,EAChB,UAAU,EACV,aAAa,EACb,OAAO,EACP,UAAU,EACV,MAAM,EACP;;IACC,MAAM,EAAE,UAAU,EAAE,GAAG,IAAA,6JAAM;IAC7B,MAAM,IAAI,IAAA,sKAAc;IACxB,MAAM,EAAE,eAAe,EAAE,GAAG,IAAA,mKAAc;IAC1C,MAAM,eAAe,gBAAgB;IACrC,MAAM,aAAa,IAAA,4KAAiB,EAAC;IACrC,MAAM,aAAa,IAAA,4KAAiB,EAAC;IACrC,MAAM,aAAa,IAAA,4KAAiB,EAAC;IAErC,MAAM,cAAc,YAAY,YAAY,CAAC,cAAc;IAE3D,qBACE,6MAAC;QACC,WAAU;QACV,OAAO;YACL,KAAK,WAAW,GAAG;YACnB,OAAO,WAAW,KAAK;YACvB,QAAQ,WAAW,MAAM,GAAG;YAC5B,MAAM,WAAW,IAAI;QACvB;;0BAGA,6MAAC;gBAAI,WAAU;;oBACZ,aAAa,aAAa,WAAW,mBACpC,6MAAC;wBACC,WAAU;wBACV,OAAO;4BAAE,OAAO,GAAG,WAAW,IAAI,CAAC,CAAC;wBAAC;;;;;;oBAGxC,aAAa,mBAAK,6MAAC;wBAAI,WAAU;;;;;;oBACjC,kBAAkB,8BACjB,6MAAC;wBACC,OAAO,oBAAoB,EAAE;wBAC7B,SAAS;wBACT,WAAU;kCAEV,cAAA,6MAAC,wOAAS;4BAAC,MAAM;4BAAY,WAAU;;;;;;;;;;iFAGzC,6MAAC;wBAAI,WAAU;;;;;;kCAGjB,6MAAC;wBAAI,WAAU;;0CACb,6MAAC;gCAAK,WAAU;0CAAoC;;;;;;4BACnD,WAAW,6BACV,6MAAC;gCAAK,WAAU;0CAA6C;;;;;;;;;;;;kCAIjE,6MAAC;wBACC,OAAO,cAAc,EAAE;wBACvB,SAAS;wBACT,WAAU;kCAEV,cAAA,6MAAC,8OAAe;4BAAC,MAAM;;;;;;;;;;;;;;;;;0BAK3B,6MAAC;gBAAI,WAAU;;kCACb,6MAAC;wBACC,OAAO,iBAAiB,EAAE;wBAC1B,SAAS;wBACT,UAAU,CAAC;wBACX,WAAW,IAAA,6LAAI,EACb,iGACA,CAAC,eAAe;;0CAGlB,6MAAC,+OAAe;gCAAC,MAAM;gCAAY,WAAU;;;;;;0CAC7C,6MAAC;gCAAK,WAAU;0CAAuB,iBAAiB,EAAE;;;;;;;;;;;;kCAG5D,6MAAC;wBACC,OAAO,aAAa,EAAE;wBACtB,SAAS;wBACT,UAAU,CAAC;wBACX,WAAW,IAAA,6LAAI,EACb,iGACA,CAAC,WAAW;;0CAGd,6MAAC,gPAAgB;gCAAC,MAAM;gCAAY,WAAU;;;;;;0CAC9C,6MAAC;gCAAK,WAAU;0CAAuB,aAAa,EAAE;;;;;;;;;;;;;;;;;;;;;;;;AAKhE;GA3GM;;QAoBmB,6JAAM;QACnB,sKAAc;QACI,mKAAc;QAEvB,4KAAiB;QACjB,4KAAiB;QACjB,4KAAiB;;;KA1BhC;uCA6GS"}},
    {"offset": {"line": 3501, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/app/reader/components/sidebar/SearchResultsNav.tsx"],"sourcesContent":["import React from 'react';\n\nimport { Insets } from '@/types/misc';\nimport { BookSearchMatch, BookSearchResult } from '@/types/book';\nimport { useTranslation } from '@/hooks/useTranslation';\nimport { useSearchNav } from '../../hooks/useSearchNav';\nimport ContentNavBar from './ContentNavBar';\n\ninterface SearchResultsNavProps {\n  bookKey: string;\n  gridInsets: Insets;\n}\n\nconst SearchResultsNav: React.FC<SearchResultsNavProps> = ({ bookKey, gridInsets }) => {\n  const {\n    searchTerm,\n    searchProgress,\n    currentSection,\n    showSearchNav,\n    hasPreviousPage,\n    hasNextPage,\n    handleShowResults,\n    handleCloseSearch,\n    handlePreviousResult,\n    handleNextResult,\n  } = useSearchNav(bookKey);\n  const _ = useTranslation();\n\n  if (!showSearchNav) {\n    return null;\n  }\n\n  return (\n    <ContentNavBar\n      bookKey={bookKey}\n      gridInsets={gridInsets}\n      title={_(\"Search results for '{{term}}'\", { term: searchTerm })}\n      section={currentSection}\n      progress={searchProgress}\n      hasPrevious={hasPreviousPage}\n      hasNext={hasNextPage}\n      previousTitle={_('Previous Result')}\n      nextTitle={_('Next Result')}\n      showResultsTitle={_('Show Search Results')}\n      closeTitle={_('Close Search')}\n      onShowResults={handleShowResults}\n      onClose={handleCloseSearch}\n      onPrevious={handlePreviousResult}\n      onNext={handleNextResult}\n    />\n  );\n};\n\nexport default SearchResultsNav;\n\n// Helper function to flatten search results into a single array of matches with section labels\nexport function flattenSearchResults(\n  results: BookSearchResult[] | BookSearchMatch[],\n): { cfi: string; sectionLabel: string }[] {\n  const flattened: { cfi: string; sectionLabel: string }[] = [];\n\n  for (const result of results) {\n    if ('subitems' in result) {\n      // BookSearchResult with subitems\n      for (const item of result.subitems) {\n        flattened.push({ cfi: item.cfi, sectionLabel: result.label });\n      }\n    } else {\n      // BookSearchMatch\n      flattened.push({ cfi: result.cfi, sectionLabel: '' });\n    }\n  }\n\n  return flattened;\n}\n\n// Helper function to find the index of current result based on CFI\nexport function findCurrentResultIndex(\n  flattenedResults: { cfi: string; sectionLabel: string }[],\n  currentLocation: string | undefined,\n): number {\n  if (!currentLocation || flattenedResults.length === 0) return 0;\n\n  // Try to find exact match or closest match\n  for (let i = 0; i < flattenedResults.length; i++) {\n    if (flattenedResults[i]!.cfi === currentLocation) {\n      return i;\n    }\n  }\n\n  return 0;\n}\n"],"names":[],"mappings":";;;;;;;;;AAIA;AACA;AACA;;;;;;AAOA,MAAM,mBAAoD,CAAC,EAAE,OAAO,EAAE,UAAU,EAAE;;IAChF,MAAM,EACJ,UAAU,EACV,cAAc,EACd,cAAc,EACd,aAAa,EACb,eAAe,EACf,WAAW,EACX,iBAAiB,EACjB,iBAAiB,EACjB,oBAAoB,EACpB,gBAAgB,EACjB,GAAG,IAAA,mLAAY,EAAC;IACjB,MAAM,IAAI,IAAA,sKAAc;IAExB,IAAI,CAAC,eAAe;QAClB,OAAO;IACT;IAEA,qBACE,6MAAC,gMAAa;QACZ,SAAS;QACT,YAAY;QACZ,OAAO,EAAE,iCAAiC;YAAE,MAAM;QAAW;QAC7D,SAAS;QACT,UAAU;QACV,aAAa;QACb,SAAS;QACT,eAAe,EAAE;QACjB,WAAW,EAAE;QACb,kBAAkB,EAAE;QACpB,YAAY,EAAE;QACd,eAAe;QACf,SAAS;QACT,YAAY;QACZ,QAAQ;;;;;;AAGd;GAtCM;;QAYA,mLAAY;QACN,sKAAc;;;KAbpB;uCAwCS;AAGR,SAAS,qBACd,OAA+C;IAE/C,MAAM,YAAqD,EAAE;IAE7D,KAAK,MAAM,UAAU,QAAS;QAC5B,IAAI,cAAc,QAAQ;YACxB,iCAAiC;YACjC,KAAK,MAAM,QAAQ,OAAO,QAAQ,CAAE;gBAClC,UAAU,IAAI,CAAC;oBAAE,KAAK,KAAK,GAAG;oBAAE,cAAc,OAAO,KAAK;gBAAC;YAC7D;QACF,OAAO;YACL,kBAAkB;YAClB,UAAU,IAAI,CAAC;gBAAE,KAAK,OAAO,GAAG;gBAAE,cAAc;YAAG;QACrD;IACF;IAEA,OAAO;AACT;AAGO,SAAS,uBACd,gBAAyD,EACzD,eAAmC;IAEnC,IAAI,CAAC,mBAAmB,iBAAiB,MAAM,KAAK,GAAG,OAAO;IAE9D,2CAA2C;IAC3C,IAAK,IAAI,IAAI,GAAG,IAAI,iBAAiB,MAAM,EAAE,IAAK;QAChD,IAAI,gBAAgB,CAAC,EAAE,CAAE,GAAG,KAAK,iBAAiB;YAChD,OAAO;QACT;IACF;IAEA,OAAO;AACT"}},
    {"offset": {"line": 3597, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/app/reader/components/sidebar/BooknotesNav.tsx"],"sourcesContent":["import React from 'react';\n\nimport { Insets } from '@/types/misc';\nimport { TOCItem } from '@/libs/document';\nimport { useTranslation } from '@/hooks/useTranslation';\nimport { useBooknotesNav } from '../../hooks/useBooknotesNav';\nimport ContentNavBar from './ContentNavBar';\n\ninterface BooknotesNavProps {\n  bookKey: string;\n  gridInsets: Insets;\n  toc: TOCItem[];\n}\n\nconst BooknotesNav: React.FC<BooknotesNavProps> = ({ bookKey, gridInsets, toc }) => {\n  const {\n    activeBooknoteType,\n    currentSection,\n    showBooknotesNav,\n    hasPreviousPage,\n    hasNextPage,\n    handleShowResults,\n    handleClose,\n    handlePrevious,\n    handleNext,\n  } = useBooknotesNav(bookKey, toc);\n  const _ = useTranslation();\n\n  if (!showBooknotesNav) {\n    return null;\n  }\n\n  const getShowResultsTitle = () => {\n    switch (activeBooknoteType) {\n      case 'bookmark':\n        return _('Bookmarks');\n      case 'annotation':\n        return _('Annotations');\n      case 'excerpt':\n        return _('Excerpts');\n      default:\n        return '';\n    }\n  };\n\n  return (\n    <ContentNavBar\n      bookKey={bookKey}\n      gridInsets={gridInsets}\n      title={getShowResultsTitle()}\n      section={currentSection}\n      hasPrevious={hasPreviousPage}\n      hasNext={hasNextPage}\n      progress={1}\n      previousTitle={_('Previous')}\n      nextTitle={_('Next')}\n      showResultsTitle={getShowResultsTitle()}\n      closeTitle={_('Close')}\n      onShowResults={handleShowResults}\n      onClose={handleClose}\n      onPrevious={handlePrevious}\n      onNext={handleNext}\n    />\n  );\n};\n\nexport default BooknotesNav;\n"],"names":[],"mappings":";;;;;AAIA;AACA;AACA;;;;;;AAQA,MAAM,eAA4C,CAAC,EAAE,OAAO,EAAE,UAAU,EAAE,GAAG,EAAE;;IAC7E,MAAM,EACJ,kBAAkB,EAClB,cAAc,EACd,gBAAgB,EAChB,eAAe,EACf,WAAW,EACX,iBAAiB,EACjB,WAAW,EACX,cAAc,EACd,UAAU,EACX,GAAG,IAAA,yLAAe,EAAC,SAAS;IAC7B,MAAM,IAAI,IAAA,sKAAc;IAExB,IAAI,CAAC,kBAAkB;QACrB,OAAO;IACT;IAEA,MAAM,sBAAsB;QAC1B,OAAQ;YACN,KAAK;gBACH,OAAO,EAAE;YACX,KAAK;gBACH,OAAO,EAAE;YACX,KAAK;gBACH,OAAO,EAAE;YACX;gBACE,OAAO;QACX;IACF;IAEA,qBACE,6MAAC,gMAAa;QACZ,SAAS;QACT,YAAY;QACZ,OAAO;QACP,SAAS;QACT,aAAa;QACb,SAAS;QACT,UAAU;QACV,eAAe,EAAE;QACjB,WAAW,EAAE;QACb,kBAAkB;QAClB,YAAY,EAAE;QACd,eAAe;QACf,SAAS;QACT,YAAY;QACZ,QAAQ;;;;;;AAGd;GAlDM;;QAWA,yLAAe;QACT,sKAAc;;;KAZpB;uCAoDS"}}]
}