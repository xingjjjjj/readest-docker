{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/hooks/useTheme.ts"],"sourcesContent":["'use client';\n\nimport { useCallback, useEffect, useRef } from 'react';\nimport { useEnv } from '@/context/EnvContext';\nimport { useThemeStore } from '@/store/themeStore';\nimport { useSettingsStore } from '@/store/settingsStore';\nimport { themes, applyCustomTheme, Palette } from '@/styles/themes';\nimport { getStatusBarHeight, setSystemUIVisibility } from '@/utils/bridge';\nimport { getOSPlatform } from '@/utils/misc';\nimport { parseWebViewVersion } from '@/utils/ua';\n\ntype UseThemeProps = {\n  systemUIVisible?: boolean;\n  appThemeColor?: keyof Palette;\n};\n\nexport const useTheme = ({\n  systemUIVisible = true,\n  appThemeColor = 'base-100',\n}: UseThemeProps = {}) => {\n  const { appService } = useEnv();\n  const { settings } = useSettingsStore();\n  const {\n    themeColor,\n    isDarkMode,\n    isEinkMode,\n    showSystemUI,\n    dismissSystemUI,\n    updateAppTheme,\n    setStatusBarHeight,\n    systemUIAlwaysHidden,\n    setSystemUIAlwaysHidden,\n  } = useThemeStore();\n\n  const useFallbackColors = useRef(false);\n\n  useEffect(() => {\n    updateAppTheme(appThemeColor);\n    if (appService?.isAndroidApp) {\n      getStatusBarHeight().then((res) => {\n        if (res.height && res.height > 0) {\n          setStatusBarHeight(res.height / window.devicePixelRatio);\n        }\n      });\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [appService?.isAndroidApp]);\n\n  const handleSystemUIVisibility = useCallback(() => {\n    if (!appService?.isMobileApp) return;\n\n    const visible = !!(systemUIVisible && !systemUIAlwaysHidden);\n    if (visible) {\n      showSystemUI();\n    } else {\n      dismissSystemUI();\n    }\n    setSystemUIVisibility({ visible, darkMode: isDarkMode });\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [appService, isDarkMode, systemUIVisible]);\n\n  useEffect(() => {\n    if (appService?.isMobileApp) {\n      handleSystemUIVisibility();\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [handleSystemUIVisibility]);\n\n  useEffect(() => {\n    if (!appService?.isMobileApp) return;\n\n    handleSystemUIVisibility();\n    const handleVisibilityChange = () => {\n      if (document.visibilityState === 'visible') {\n        handleSystemUIVisibility();\n      }\n    };\n    const handleOrientationChange = () => {\n      if (appService?.isIOSApp && getOSPlatform() === 'ios') {\n        // FIXME: This is a workaround for iPhone apps where the system UI is not visible in landscape mode\n        // when the app is in fullscreen mode until we find a better solution to override the prefersStatusBarHidden\n        // in the ViewController. Note that screen.orientation.type is not abailable in iOS before 16.4.\n        const systemUIAlwaysHidden = screen.orientation?.type.includes('landscape');\n        setSystemUIAlwaysHidden(systemUIAlwaysHidden);\n        handleSystemUIVisibility();\n      }\n    };\n    document.addEventListener('visibilitychange', handleVisibilityChange);\n    screen.orientation?.addEventListener('change', handleOrientationChange);\n    return () => {\n      document.removeEventListener('visibilitychange', handleVisibilityChange);\n      screen.orientation?.removeEventListener('change', handleOrientationChange);\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [handleSystemUIVisibility]);\n\n  useEffect(() => {\n    if (!appService?.isAndroidApp) return;\n    const webViewVersion = parseWebViewVersion(appService);\n    // OKLCH color model is supported in Chromium 111+\n    useFallbackColors.current = webViewVersion < 111;\n  }, [appService]);\n\n  useEffect(() => {\n    if (!themeColor || !themes.find((t) => t.name === themeColor)) return;\n    if (useFallbackColors.current) {\n      applyCustomTheme(undefined, themeColor, true);\n    }\n  }, [themeColor]);\n\n  useEffect(() => {\n    const customThemes = settings.globalReadSettings?.customThemes ?? [];\n    customThemes.forEach((customTheme) => {\n      applyCustomTheme(customTheme, undefined, useFallbackColors.current);\n    });\n    localStorage.setItem('customThemes', JSON.stringify(customThemes));\n  }, [settings.globalReadSettings?.customThemes]);\n\n  useEffect(() => {\n    const colorScheme = isDarkMode ? 'dark' : 'light';\n    document.documentElement.setAttribute('data-theme', `${themeColor}-${colorScheme}`);\n    document.documentElement.style.setProperty('color-scheme', colorScheme);\n    document.documentElement.style.setProperty(\n      '--overlayer-highlight-opacity',\n      isEinkMode ? '1.0' : '0.3',\n    );\n    document.documentElement.style.setProperty(\n      '--overlayer-highlight-blend-mode',\n      isEinkMode ? 'difference' : isDarkMode ? 'lighten' : 'normal',\n    );\n    document.documentElement.style.setProperty(\n      '--bg-texture-blend-mode',\n      isDarkMode ? 'lighten' : 'multiply',\n    );\n  }, [themeColor, isDarkMode, isEinkMode]);\n};\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 179, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/hooks/useLibrary.ts"],"sourcesContent":["'use client';\n\nimport { useEffect, useRef, useState } from 'react';\nimport { useEnv } from '@/context/EnvContext';\nimport { useLibraryStore } from '@/store/libraryStore';\nimport { useSettingsStore } from '@/store/settingsStore';\n\nexport const useLibrary = () => {\n  const { envConfig } = useEnv();\n  const { setLibrary } = useLibraryStore();\n  const { setSettings } = useSettingsStore();\n  const [libraryLoaded, setLibraryLoaded] = useState(false);\n  const isInitiating = useRef(false);\n\n  useEffect(() => {\n    if (isInitiating.current) return;\n    isInitiating.current = true;\n    const initLibrary = async () => {\n      const appService = await envConfig.getAppService();\n      const settings = await appService.loadSettings();\n      setSettings(settings);\n      setLibrary(await appService.loadLibraryBooks());\n      setLibraryLoaded(true);\n    };\n\n    initLibrary();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  return { libraryLoaded };\n};\n"],"names":[],"mappings":";;;;AAEA;AACA;AACA;AACA;;AALA;;;;;AAOO,MAAM,aAAa;;IACxB,MAAM,EAAE,SAAS,EAAE,GAAG,IAAA,6JAAM;IAC5B,MAAM,EAAE,UAAU,EAAE,GAAG,IAAA,qKAAe;IACtC,MAAM,EAAE,WAAW,EAAE,GAAG,IAAA,uKAAgB;IACxC,MAAM,CAAC,eAAe,iBAAiB,GAAG,IAAA,yLAAQ,EAAC;IACnD,MAAM,eAAe,IAAA,uLAAM,EAAC;IAE5B,IAAA,0LAAS;gCAAC;YACR,IAAI,aAAa,OAAO,EAAE;YAC1B,aAAa,OAAO,GAAG;YACvB,MAAM;oDAAc;oBAClB,MAAM,aAAa,MAAM,UAAU,aAAa;oBAChD,MAAM,WAAW,MAAM,WAAW,YAAY;oBAC9C,YAAY;oBACZ,WAAW,MAAM,WAAW,gBAAgB;oBAC5C,iBAAiB;gBACnB;;YAEA;QACA,uDAAuD;QACzD;+BAAG,EAAE;IAEL,OAAO;QAAE;IAAc;AACzB;GAvBa;;QACW,6JAAM;QACL,qKAAe;QACd,uKAAgB"}},
    {"offset": {"line": 235, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/hooks/useScreenWakeLock.ts"],"sourcesContent":["'use client';\n\nimport { useEffect, useRef } from 'react';\nimport { getCurrentWindow } from '@tauri-apps/api/window';\nimport { isTauriAppPlatform, isWebAppPlatform } from '@/services/environment';\n\nexport const useScreenWakeLock = (lock: boolean) => {\n  const wakeLockRef = useRef<WakeLockSentinel | null>(null);\n  const unlistenOnFocusChangedRef = useRef<Promise<() => void> | null>(null);\n\n  useEffect(() => {\n    const requestWakeLock = async () => {\n      try {\n        if ('wakeLock' in navigator) {\n          wakeLockRef.current = await navigator.wakeLock.request('screen');\n\n          wakeLockRef.current.addEventListener('release', () => {\n            wakeLockRef.current = null;\n          });\n\n          console.log('Wake lock acquired');\n        }\n      } catch (err) {\n        console.info('Failed to acquire wake lock:', err);\n      }\n    };\n\n    const releaseWakeLock = () => {\n      if (wakeLockRef.current) {\n        wakeLockRef.current.release();\n        wakeLockRef.current = null;\n        console.log('Wake lock released');\n      }\n    };\n\n    const handleVisibilityChange = () => {\n      if (document.hidden) {\n        releaseWakeLock();\n      } else {\n        requestWakeLock();\n      }\n    };\n\n    if (lock) {\n      requestWakeLock();\n    } else if (wakeLockRef.current) {\n      releaseWakeLock();\n    }\n\n    if (isWebAppPlatform() && lock) {\n      document.addEventListener('visibilitychange', handleVisibilityChange);\n    } else if (isTauriAppPlatform() && lock) {\n      unlistenOnFocusChangedRef.current = getCurrentWindow().onFocusChanged(\n        ({ payload: focused }) => {\n          if (focused) {\n            requestWakeLock();\n          } else {\n            releaseWakeLock();\n          }\n        },\n      );\n    }\n\n    return () => {\n      releaseWakeLock();\n      if (isWebAppPlatform() && lock) {\n        document.removeEventListener('visibilitychange', handleVisibilityChange);\n      }\n      if (unlistenOnFocusChangedRef.current) {\n        unlistenOnFocusChangedRef.current.then((f) => f());\n      }\n    };\n  }, [lock]);\n};\n"],"names":[],"mappings":";;;;AAEA;AACA;AACA;;AAJA;;;;AAMO,MAAM,oBAAoB,CAAC;;IAChC,MAAM,cAAc,IAAA,uLAAM,EAA0B;IACpD,MAAM,4BAA4B,IAAA,uLAAM,EAA6B;IAErE,IAAA,0LAAS;uCAAC;YACR,MAAM;+DAAkB;oBACtB,IAAI;wBACF,IAAI,cAAc,WAAW;4BAC3B,YAAY,OAAO,GAAG,MAAM,UAAU,QAAQ,CAAC,OAAO,CAAC;4BAEvD,YAAY,OAAO,CAAC,gBAAgB,CAAC;+EAAW;oCAC9C,YAAY,OAAO,GAAG;gCACxB;;4BAEA,QAAQ,GAAG,CAAC;wBACd;oBACF,EAAE,OAAO,KAAK;wBACZ,QAAQ,IAAI,CAAC,gCAAgC;oBAC/C;gBACF;;YAEA,MAAM;+DAAkB;oBACtB,IAAI,YAAY,OAAO,EAAE;wBACvB,YAAY,OAAO,CAAC,OAAO;wBAC3B,YAAY,OAAO,GAAG;wBACtB,QAAQ,GAAG,CAAC;oBACd;gBACF;;YAEA,MAAM;sEAAyB;oBAC7B,IAAI,SAAS,MAAM,EAAE;wBACnB;oBACF,OAAO;wBACL;oBACF;gBACF;;YAEA,IAAI,MAAM;gBACR;YACF,OAAO,IAAI,YAAY,OAAO,EAAE;gBAC9B;YACF;YAEA,IAAI,IAAA,wKAAgB,OAAM,MAAM;gBAC9B,SAAS,gBAAgB,CAAC,oBAAoB;YAChD,OAAO,IAAI,IAAA,0KAAkB,OAAM,MAAM;gBACvC,0BAA0B,OAAO,GAAG,IAAA,mPAAgB,IAAG,cAAc;mDACnE,CAAC,EAAE,SAAS,OAAO,EAAE;wBACnB,IAAI,SAAS;4BACX;wBACF,OAAO;4BACL;wBACF;oBACF;;YAEJ;YAEA;+CAAO;oBACL;oBACA,IAAI,IAAA,wKAAgB,OAAM,MAAM;wBAC9B,SAAS,mBAAmB,CAAC,oBAAoB;oBACnD;oBACA,IAAI,0BAA0B,OAAO,EAAE;wBACrC,0BAA0B,OAAO,CAAC,IAAI;2DAAC,CAAC,IAAM;;oBAChD;gBACF;;QACF;sCAAG;QAAC;KAAK;AACX;GAnEa"}},
    {"offset": {"line": 332, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/hooks/useTranslation.ts"],"sourcesContent":["'use client';\n\nimport '@/i18n/i18n';\nimport { useCallback } from 'react';\nimport { useTranslation as _useTranslation } from 'react-i18next';\n\nexport type TranslationFunc = (key: string, options?: Record<string, number | string>) => string;\n\nexport const useTranslation = (namespace: string = 'translation') => {\n  const { t } = _useTranslation(namespace);\n\n  return useCallback((key: string, options = {}) => t(key, { defaultValue: key, ...options }), [t]);\n};\n"],"names":[],"mappings":";;;;AAEA;AACA;AACA;AAAA;;AAJA;;;;AAQO,MAAM,iBAAiB,CAAC,YAAoB,aAAa;;IAC9D,MAAM,EAAE,CAAC,EAAE,GAAG,IAAA,+WAAe,EAAC;IAE9B,OAAO,IAAA,4LAAW;sCAAC,CAAC,KAAa,UAAU,CAAC,CAAC,GAAK,EAAE,KAAK;gBAAE,cAAc;gBAAK,GAAG,OAAO;YAAC;qCAAI;QAAC;KAAE;AAClG;GAJa"}},
    {"offset": {"line": 365, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/hooks/useTransferQueue.ts"],"sourcesContent":["'use client';\n\nimport { useEffect, useCallback, useMemo } from 'react';\nimport { useEnv } from '@/context/EnvContext';\nimport { useTranslation } from './useTranslation';\nimport { useLibraryStore } from '@/store/libraryStore';\nimport { useTransferStore, TransferType } from '@/store/transferStore';\nimport { transferManager } from '@/services/transferManager';\nimport { Book } from '@/types/book';\n\nexport function useTransferQueue(libraryLoaded = true, delayInit = 0) {\n  const { envConfig, appService } = useEnv();\n  const _ = useTranslation();\n\n  const transfers = useTransferStore((state) => state.transfers);\n  const isQueuePaused = useTransferStore((state) => state.isQueuePaused);\n  const setIsTransferQueueOpen = useTransferStore((state) => state.setIsTransferQueueOpen);\n\n  useEffect(() => {\n    const initManager = async () => {\n      if (appService && envConfig) {\n        const getLibrary = () => useLibraryStore.getState().library;\n        const updateBookFn = async (book: Book) => {\n          await useLibraryStore.getState().updateBook(envConfig, book);\n        };\n        const translationFn = _;\n        await transferManager.initialize(appService, getLibrary, updateBookFn, translationFn);\n      }\n    };\n\n    // Initialize transfer manager only when library is loaded\n    if (libraryLoaded) {\n      setTimeout(() => {\n        initManager();\n      }, delayInit);\n    }\n  }, [appService, envConfig, libraryLoaded, delayInit, _]);\n\n  const queueUpload = useCallback((book: Book, priority?: number) => {\n    return transferManager.queueUpload(book, priority);\n  }, []);\n\n  const queueDownload = useCallback((book: Book, priority?: number) => {\n    return transferManager.queueDownload(book, priority);\n  }, []);\n\n  const queueBatchUploads = useCallback((books: Book[], priority?: number) => {\n    return transferManager.queueBatchUploads(books, priority);\n  }, []);\n\n  const cancelTransfer = useCallback((transferId: string) => {\n    transferManager.cancelTransfer(transferId);\n  }, []);\n\n  const retryTransfer = useCallback((transferId: string) => {\n    transferManager.retryTransfer(transferId);\n  }, []);\n\n  const retryAllFailed = useCallback(() => {\n    transferManager.retryAllFailed();\n  }, []);\n\n  const pauseQueue = useCallback(() => {\n    transferManager.pauseQueue();\n  }, []);\n\n  const resumeQueue = useCallback(() => {\n    transferManager.resumeQueue();\n  }, []);\n\n  const clearCompleted = useCallback(() => {\n    useTransferStore.getState().clearCompleted();\n  }, []);\n\n  const clearFailed = useCallback(() => {\n    useTransferStore.getState().clearFailed();\n  }, []);\n\n  const clearAll = useCallback(() => {\n    useTransferStore.getState().clearAll();\n  }, []);\n\n  const getTransferProgress = useCallback((bookHash: string, type: TransferType) => {\n    return useTransferStore.getState().getTransferByBookHash(bookHash, type);\n  }, []);\n\n  const stats = useMemo(() => {\n    const transferList = Object.values(transfers);\n    return {\n      pending: transferList.filter((t) => t.status === 'pending').length,\n      active: transferList.filter((t) => t.status === 'in_progress').length,\n      completed: transferList.filter((t) => t.status === 'completed').length,\n      failed: transferList.filter((t) => t.status === 'failed' || t.status === 'cancelled').length,\n      total: transferList.length,\n    };\n  }, [transfers]);\n\n  const pendingTransfers = useMemo(() => {\n    return Object.values(transfers).filter((t) => t.status === 'pending');\n  }, [transfers]);\n\n  const activeTransfers = useMemo(() => {\n    return Object.values(transfers).filter((t) => t.status === 'in_progress');\n  }, [transfers]);\n\n  const failedTransfers = useMemo(() => {\n    return Object.values(transfers).filter(\n      (t) => t.status === 'failed' || t.status === 'cancelled',\n    );\n  }, [transfers]);\n\n  const completedTransfers = useMemo(() => {\n    return Object.values(transfers).filter((t) => t.status === 'completed');\n  }, [transfers]);\n\n  const hasActiveTransfers = useMemo(() => {\n    return pendingTransfers.length > 0 || activeTransfers.length > 0;\n  }, [pendingTransfers, activeTransfers]);\n\n  return {\n    transfers: Object.values(transfers),\n    isQueuePaused,\n    stats,\n    pendingTransfers,\n    activeTransfers,\n    failedTransfers,\n    completedTransfers,\n    hasActiveTransfers,\n\n    setIsTransferQueueOpen,\n    queueUpload,\n    queueDownload,\n    queueBatchUploads,\n    cancelTransfer,\n    retryTransfer,\n    retryAllFailed,\n    pauseQueue,\n    resumeQueue,\n    clearCompleted,\n    clearFailed,\n    clearAll,\n    getTransferProgress,\n  };\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 596, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/hooks/useTranslator.ts"],"sourcesContent":["'use client';\n\nimport { useState, useCallback, useEffect } from 'react';\nimport { useAuth } from '@/context/AuthContext';\nimport { ErrorCodes, getTranslator, getTranslators, TranslatorName } from '@/services/translators';\nimport { getFromCache, storeInCache, UseTranslatorOptions } from '@/services/translators';\nimport { polish, preprocess } from '@/services/translators';\nimport { eventDispatcher } from '@/utils/event';\nimport { getLocale } from '@/utils/misc';\nimport { useTranslation } from './useTranslation';\n\nexport function useTranslator({\n  provider = 'deepl',\n  sourceLang = 'AUTO',\n  targetLang = 'EN',\n  enablePolishing = true,\n  enablePreprocessing = true,\n}: UseTranslatorOptions = {}) {\n  const _ = useTranslation();\n  const { token } = useAuth();\n  const [loading, setLoading] = useState(false);\n  const [selectedProvider, setSelectedProvider] = useState(provider);\n  const [translator, setTransltor] = useState(() => getTranslator(provider));\n  const [translators] = useState(() => getTranslators());\n\n  useEffect(() => {\n    setLoading(false);\n  }, [provider, sourceLang, targetLang]);\n\n  useEffect(() => {\n    const availableTranslators = getTranslators().filter(\n      (t) => (t.authRequired ? !!token : true) && !t.quotaExceeded,\n    );\n    const selectedTranslator =\n      availableTranslators.find((t) => t.name === provider) || availableTranslators[0]!;\n    const selectedProviderName = selectedTranslator.name as TranslatorName;\n    setTransltor(getTranslator(selectedProviderName));\n    setSelectedProvider(selectedProviderName);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [provider]);\n\n  const translate = useCallback(\n    async (\n      input: string[],\n      options?: { source?: string; target?: string; useCache?: boolean },\n    ): Promise<string[]> => {\n      const sourceLanguage = options?.source || sourceLang;\n      const targetLanguage = options?.target || targetLang || getLocale();\n      const useCache = options?.useCache ?? false;\n      const textsToTranslate = enablePreprocessing ? preprocess(input) : input;\n\n      if (textsToTranslate.length === 0 || textsToTranslate.every((t) => !t?.trim())) {\n        return textsToTranslate;\n      }\n\n      const textsNeedingTranslation: string[] = [];\n      const indicesNeedingTranslation: number[] = [];\n\n      await Promise.all(\n        textsToTranslate.map(async (text, index) => {\n          if (!text?.trim()) return;\n\n          const cachedTranslation = await getFromCache(\n            text,\n            sourceLanguage,\n            targetLanguage,\n            selectedProvider,\n          );\n          if (cachedTranslation) return;\n\n          textsNeedingTranslation.push(text);\n          indicesNeedingTranslation.push(index);\n        }),\n      );\n\n      if (textsNeedingTranslation.length === 0) {\n        const results = await Promise.all(\n          textsToTranslate.map((text) =>\n            getFromCache(text, sourceLanguage, targetLanguage, selectedProvider).then(\n              (cached) => cached || text,\n            ),\n          ),\n        );\n\n        return enablePolishing ? polish(results, targetLanguage) : results;\n      }\n\n      setLoading(true);\n\n      try {\n        const translator = translators.find((t) => t.name === selectedProvider);\n        if (!translator) {\n          throw new Error(`No translator found for provider: ${selectedProvider}`);\n        }\n        const translatedTexts = await translator.translate(\n          textsNeedingTranslation,\n          sourceLanguage,\n          targetLanguage,\n          token,\n          useCache,\n        );\n\n        await Promise.all(\n          textsNeedingTranslation.map(async (text, index) => {\n            return storeInCache(\n              text,\n              translatedTexts[index] || '',\n              sourceLanguage,\n              targetLanguage,\n              selectedProvider,\n            );\n          }),\n        );\n\n        const results = [...textsToTranslate];\n        indicesNeedingTranslation.forEach((originalIndex, translationIndex) => {\n          results[originalIndex] = translatedTexts[translationIndex] || '';\n        });\n\n        await Promise.all(\n          results.map(async (_, index) => {\n            if (!indicesNeedingTranslation.includes(index)) {\n              const originalText = textsToTranslate[index];\n              if (!originalText?.trim()) return;\n\n              const cachedTranslation = await getFromCache(\n                originalText,\n                sourceLanguage,\n                targetLanguage,\n                selectedProvider,\n              );\n\n              if (cachedTranslation) {\n                results[index] = cachedTranslation;\n              }\n            }\n          }),\n        );\n\n        setLoading(false);\n        return enablePolishing ? polish(results, targetLanguage) : results;\n      } catch (err) {\n        if (err instanceof Error && err.message.includes(ErrorCodes.DAILY_QUOTA_EXCEEDED)) {\n          eventDispatcher.dispatch('toast', {\n            timeout: 5000,\n            message: _(\n              'Daily translation quota reached. Upgrade your plan to continue using AI translations.',\n            ),\n            type: 'error',\n          });\n          setSelectedProvider('azure');\n        }\n        setLoading(false);\n        throw err instanceof Error ? err : new Error(String(err));\n      }\n    },\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    [selectedProvider, sourceLang, targetLang, translator, token],\n  );\n\n  return {\n    translate,\n    translator,\n    translators,\n    loading,\n  };\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 765, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/hooks/useDrag.ts"],"sourcesContent":["'use client';\n\nimport { useCallback, useRef } from 'react';\n\nexport type DragKey = 'ArrowLeft' | 'ArrowRight' | 'ArrowUp' | 'ArrowDown';\n\nexport const useDrag = (\n  onDragMove: (data: { clientX: number; clientY: number; deltaX: number; deltaY: number }) => void,\n  onDragKeyDown: (data: { key: DragKey; step: number }) => void,\n  onDragEnd?: (data: {\n    velocity: number;\n    deltaT: number;\n    clientX: number;\n    clientY: number;\n    deltaX: number;\n    deltaY: number;\n  }) => void,\n) => {\n  const isDragging = useRef(false);\n  const startX = useRef(0);\n  const startY = useRef(0);\n  const lastX = useRef(0);\n  const lastY = useRef(0);\n  const startTime = useRef(0);\n\n  const handleDragStart = useCallback(\n    (e: React.MouseEvent | React.TouchEvent) => {\n      isDragging.current = true;\n\n      if ('touches' in e) {\n        startY.current = e.touches[0]!.clientY;\n        startX.current = e.touches[0]!.clientX;\n      } else {\n        startY.current = e.clientY;\n        startX.current = e.clientX;\n      }\n      startTime.current = performance.now();\n\n      document.body.style.pointerEvents = 'none';\n      document.body.style.userSelect = 'none';\n      document.documentElement.style.cursor = 'col-resize';\n\n      const handleMove = (event: MouseEvent | TouchEvent) => {\n        if (isDragging.current) {\n          let deltaX = 0;\n          let deltaY = 0;\n          let clientX = 0;\n          let clientY = 0;\n\n          if ('touches' in event && event.touches.length > 0) {\n            const currentTouch = event.touches[0]!;\n            clientX = currentTouch.clientX;\n            clientY = currentTouch.clientY;\n          } else {\n            const evt = event as MouseEvent;\n            clientX = evt.clientX;\n            clientY = evt.clientY;\n          }\n          deltaX = clientX - lastX.current;\n          deltaY = clientY - lastY.current;\n          lastX.current = clientX;\n          lastY.current = clientY;\n\n          onDragMove({ clientX, clientY, deltaX, deltaY });\n        }\n      };\n\n      const handleEnd = (event: MouseEvent | TouchEvent) => {\n        isDragging.current = false;\n\n        document.body.style.pointerEvents = '';\n        document.body.style.userSelect = '';\n        document.documentElement.style.cursor = '';\n\n        let deltaX = 0;\n        let deltaY = 0;\n        let clientX = 0;\n        let clientY = 0;\n        const endTime = performance.now();\n        const deltaT = endTime - startTime.current;\n\n        if ('touches' in event) {\n          const currentTouch = event.changedTouches[0]!;\n          clientX = currentTouch.clientX;\n          clientY = currentTouch.clientY;\n        } else {\n          const evt = event as MouseEvent;\n          clientX = evt.clientX;\n          clientY = evt.clientY;\n        }\n        deltaX = clientX - startX.current;\n        deltaY = clientY - startY.current;\n        const velocity = deltaY / deltaT;\n\n        if (onDragEnd) {\n          onDragEnd({ velocity, deltaT, clientX, clientY, deltaX, deltaY });\n        }\n\n        window.removeEventListener('mousemove', handleMove);\n        window.removeEventListener('mouseup', handleEnd);\n        window.removeEventListener('touchmove', handleMove);\n        window.removeEventListener('touchend', handleEnd);\n      };\n\n      window.addEventListener('mousemove', handleMove, { passive: true });\n      window.addEventListener('mouseup', handleEnd);\n      window.addEventListener('touchmove', handleMove, { passive: true });\n      window.addEventListener('touchend', handleEnd);\n    },\n    [onDragMove, onDragEnd],\n  );\n\n  const handleDragKeyDown = useCallback(\n    (e: React.KeyboardEvent) => {\n      const step = 0.02;\n      switch (e.key) {\n        case 'ArrowUp':\n        case 'ArrowDown':\n        case 'ArrowLeft':\n        case 'ArrowRight':\n          onDragKeyDown({ key: e.key, step });\n          break;\n        default:\n          return;\n      }\n      e.preventDefault();\n      e.stopPropagation();\n    },\n    [onDragKeyDown],\n  );\n\n  return { handleDragStart, handleDragKeyDown };\n};\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 912, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/hooks/useResponsiveSize.ts"],"sourcesContent":["import { useMediaQuery } from 'react-responsive';\n\n// use desktop size as base size\nexport const useResponsiveSize = (baseSize: number) => {\n  const isPhone = useMediaQuery({ maxWidth: 480 });\n  const isTablet = useMediaQuery({ minWidth: 481, maxWidth: 1024 });\n  if (isPhone) return baseSize * 1.25;\n  if (isTablet) return baseSize * 1.25;\n  return baseSize;\n};\n\nexport const useDefaultIconSize = () => {\n  return useResponsiveSize(20);\n};\n"],"names":[],"mappings":";;;;;;AAAA;;;AAGO,MAAM,oBAAoB,CAAC;;IAChC,MAAM,UAAU,IAAA,+PAAa,EAAC;QAAE,UAAU;IAAI;IAC9C,MAAM,WAAW,IAAA,+PAAa,EAAC;QAAE,UAAU;QAAK,UAAU;IAAK;IAC/D,IAAI,SAAS,OAAO,WAAW;IAC/B,IAAI,UAAU,OAAO,WAAW;IAChC,OAAO;AACT;GANa;;QACK,+PAAa;QACZ,+PAAa;;;AAMzB,MAAM,qBAAqB;;IAChC,OAAO,kBAAkB;AAC3B;IAFa;;QACJ"}},
    {"offset": {"line": 956, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/hooks/useKeyDownActions.ts"],"sourcesContent":["'use client';\n\nimport { RefObject, useEffect, useRef } from 'react';\nimport { useEnv } from '@/context/EnvContext';\nimport { useDeviceControlStore } from '@/store/deviceStore';\nimport { eventDispatcher } from '@/utils/event';\n\ninterface UseKeyDownOptions {\n  onCancel?: () => void;\n  onConfirm?: () => void;\n  enabled?: boolean;\n  elementRef?: RefObject<HTMLElement>;\n}\n\nexport const useKeyDownActions = ({\n  onCancel,\n  onConfirm,\n  enabled = true,\n  elementRef: providedRef,\n}: UseKeyDownOptions) => {\n  const { appService } = useEnv();\n  const { acquireBackKeyInterception, releaseBackKeyInterception } = useDeviceControlStore();\n  const internalRef = useRef<HTMLDivElement>(null);\n  const elementRef = providedRef || internalRef;\n\n  useEffect(() => {\n    if (!enabled) return;\n\n    const handleKeyDown = (event: KeyboardEvent | CustomEvent) => {\n      if (event instanceof CustomEvent) {\n        if (event.detail.keyName === 'Back') {\n          onCancel?.();\n          return true;\n        }\n      } else {\n        if (event.key === 'Escape') {\n          onCancel?.();\n        } else if (event.key === 'Enter') {\n          onConfirm?.();\n        }\n        event.stopPropagation();\n      }\n      return false;\n    };\n\n    window.addEventListener('keydown', handleKeyDown);\n\n    if (elementRef.current) {\n      elementRef.current.addEventListener('keydown', handleKeyDown);\n    }\n\n    if (appService?.isAndroidApp) {\n      acquireBackKeyInterception?.();\n      eventDispatcher.onSync('native-key-down', handleKeyDown);\n    }\n\n    return () => {\n      window.removeEventListener('keydown', handleKeyDown);\n\n      if (appService?.isAndroidApp) {\n        releaseBackKeyInterception?.();\n        eventDispatcher.offSync('native-key-down', handleKeyDown);\n      }\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [enabled, appService?.isAndroidApp]);\n\n  return internalRef;\n};\n"],"names":[],"mappings":";;;;AAEA;AACA;AACA;AACA;;AALA;;;;;AAcO,MAAM,oBAAoB,CAAC,EAChC,QAAQ,EACR,SAAS,EACT,UAAU,IAAI,EACd,YAAY,WAAW,EACL;;IAClB,MAAM,EAAE,UAAU,EAAE,GAAG,IAAA,6JAAM;IAC7B,MAAM,EAAE,0BAA0B,EAAE,0BAA0B,EAAE,GAAG,IAAA,0KAAqB;IACxF,MAAM,cAAc,IAAA,uLAAM,EAAiB;IAC3C,MAAM,aAAa,eAAe;IAElC,IAAA,0LAAS;uCAAC;YACR,IAAI,CAAC,SAAS;YAEd,MAAM;6DAAgB,CAAC;oBACrB,IAAI,iBAAiB,aAAa;wBAChC,IAAI,MAAM,MAAM,CAAC,OAAO,KAAK,QAAQ;4BACnC;4BACA,OAAO;wBACT;oBACF,OAAO;wBACL,IAAI,MAAM,GAAG,KAAK,UAAU;4BAC1B;wBACF,OAAO,IAAI,MAAM,GAAG,KAAK,SAAS;4BAChC;wBACF;wBACA,MAAM,eAAe;oBACvB;oBACA,OAAO;gBACT;;YAEA,OAAO,gBAAgB,CAAC,WAAW;YAEnC,IAAI,WAAW,OAAO,EAAE;gBACtB,WAAW,OAAO,CAAC,gBAAgB,CAAC,WAAW;YACjD;YAEA,IAAI,YAAY,cAAc;gBAC5B;gBACA,8JAAe,CAAC,MAAM,CAAC,mBAAmB;YAC5C;YAEA;+CAAO;oBACL,OAAO,mBAAmB,CAAC,WAAW;oBAEtC,IAAI,YAAY,cAAc;wBAC5B;wBACA,8JAAe,CAAC,OAAO,CAAC,mBAAmB;oBAC7C;gBACF;;QACA,uDAAuD;QACzD;sCAAG;QAAC;QAAS,YAAY;KAAa;IAEtC,OAAO;AACT;GAtDa;;QAMY,6JAAM;QACsC,0KAAqB"}},
    {"offset": {"line": 1035, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/hooks/useFileSelector.ts"],"sourcesContent":["import { AppService } from '@/types/system';\nimport { isTauriAppPlatform } from '@/services/environment';\nimport { basename } from '@tauri-apps/api/path';\nimport { stubTranslation as _ } from '@/utils/misc';\nimport { BOOK_ACCEPT_FORMATS, SUPPORTED_BOOK_EXTS } from '@/services/constants';\n\nexport interface FileSelectorOptions {\n  type: SelectionType;\n  accept?: string;\n  multiple?: boolean;\n  extensions?: string[];\n  dialogTitle?: string;\n}\n\nexport interface SelectedFile {\n  // For Web file\n  file?: File;\n\n  // For Tauri file\n  path?: string;\n  basePath?: string;\n}\n\nexport interface FileSelectionResult {\n  files: SelectedFile[];\n  error?: string;\n}\n\nconst selectFileWeb = (options: FileSelectorOptions): Promise<File[]> => {\n  return new Promise((resolve) => {\n    const fileInput = document.createElement('input');\n    fileInput.type = 'file';\n    fileInput.accept = options.accept || '*/*';\n    fileInput.multiple = options.multiple || false;\n    fileInput.click();\n\n    fileInput.onchange = () => {\n      resolve(Array.from(fileInput.files || []));\n    };\n  });\n};\n\nconst selectFileTauri = async (\n  options: FileSelectorOptions,\n  appService: AppService,\n  _: (key: string) => string,\n): Promise<string[]> => {\n  const noFilter = appService?.isIOSApp || (appService?.isAndroidApp && options.type === 'books');\n  const exts = noFilter ? [] : options.extensions || [];\n  const title = options.dialogTitle || _('Select Files');\n  let files = (await appService?.selectFiles(_(title), exts)) || [];\n\n  if (noFilter && options.extensions) {\n    files = await Promise.all(\n      files.map(async (file: string) => {\n        let processedFile = file;\n        if (appService?.isAndroidApp && file.startsWith('content://')) {\n          processedFile = await basename(file);\n        }\n        const fileExt = processedFile.split('.').pop()?.toLowerCase() || 'unknown';\n        const extensions = options.extensions!;\n        const shouldInclude = extensions.includes(fileExt) || extensions.includes('*');\n        return shouldInclude ? file : null;\n      }),\n    ).then((results) => results.filter((file) => file !== null));\n  }\n\n  return files;\n};\n\nconst processWebFiles = (files: File[]): SelectedFile[] => {\n  return files.map((file) => ({\n    file,\n  }));\n};\n\nconst processTauriFiles = (files: string[]): SelectedFile[] => {\n  return files.map((path) => ({\n    path,\n  }));\n};\n\nexport const useFileSelector = (appService: AppService | null, _: (key: string) => string) => {\n  const selectFiles = async (options: FileSelectorOptions = { type: 'generic' }) => {\n    options = { ...FILE_SELECTION_PRESETS[options.type], ...options };\n    if (!appService) {\n      return { files: [] as SelectedFile[], error: 'App service is not available' };\n    }\n    try {\n      if (isTauriAppPlatform()) {\n        const filePaths = await selectFileTauri(options, appService, _);\n        const files = await processTauriFiles(filePaths);\n        return { files };\n      } else {\n        const webFiles = await selectFileWeb(options);\n        const files = processWebFiles(webFiles);\n        return { files };\n      }\n    } catch (error) {\n      return {\n        files: [],\n        error: error instanceof Error ? error.message : 'Unknown error occurred',\n      };\n    }\n  };\n  return {\n    selectFiles,\n  };\n};\n\nexport const FILE_SELECTION_PRESETS = {\n  generic: {\n    accept: '*/*',\n    extensions: ['*'],\n    dialogTitle: _('Select Files'),\n  },\n  images: {\n    accept: 'image/*',\n    extensions: ['jpg', 'jpeg', 'png', 'gif', 'webp', 'svg'],\n    dialogTitle: _('Select Image'),\n  },\n  videos: {\n    accept: 'video/*',\n    extensions: ['mp4', 'avi', 'mov', 'wmv', 'flv', 'webm'],\n    dialogTitle: _('Select Video'),\n  },\n  audio: {\n    accept: 'audio/*',\n    extensions: ['mp3', 'wav', 'ogg', 'flac', 'm4a'],\n    dialogTitle: _('Select Audio'),\n  },\n  books: {\n    accept: BOOK_ACCEPT_FORMATS,\n    extensions: SUPPORTED_BOOK_EXTS,\n    dialogTitle: _('Select Books'),\n  },\n  fonts: {\n    accept: '.ttf, .otf, .woff, .woff2',\n    extensions: ['ttf', 'otf', 'woff', 'woff2'],\n    dialogTitle: _('Select Fonts'),\n  },\n  covers: {\n    accept: '.png, .jpg, .jpeg, .gif',\n    extensions: ['png', 'jpg', 'jpeg', 'gif'],\n    dialogTitle: _('Select Image'),\n  },\n};\n\nexport type SelectionType = keyof typeof FILE_SELECTION_PRESETS;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1205, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/hooks/useShortcuts.ts"],"sourcesContent":["'use client';\n\nimport { useEffect, useState } from 'react';\nimport { loadShortcuts, ShortcutConfig } from '../helpers/shortcuts';\n\nexport type KeyActionHandlers = {\n  [K in keyof ShortcutConfig]?: (event?: KeyboardEvent | MessageEvent) => void;\n};\n\nconst useShortcuts = (actions: KeyActionHandlers, dependencies: React.DependencyList = []) => {\n  const [shortcuts, setShortcuts] = useState<ShortcutConfig>(loadShortcuts);\n\n  useEffect(() => {\n    const handleShortcutUpdate = () => {\n      setShortcuts(loadShortcuts());\n    };\n\n    window.addEventListener('shortcutUpdate', handleShortcutUpdate);\n    return () => window.removeEventListener('shortcutUpdate', handleShortcutUpdate);\n  }, []);\n\n  const parseShortcut = (shortcut: string) => {\n    const keys = shortcut.toLowerCase().split('+');\n    return {\n      ctrlKey: keys.includes('ctrl'),\n      altKey: keys.includes('alt') || keys.includes('opt'),\n      metaKey: keys.includes('meta') || keys.includes('cmd'),\n      shiftKey: keys.includes('shift'),\n      key: keys.find((k) => !['ctrl', 'alt', 'opt', 'meta', 'cmd', 'shift'].includes(k)),\n    };\n  };\n\n  const isShortcutMatch = (\n    shortcut: string,\n    key: string,\n    ctrlKey: boolean,\n    altKey: boolean,\n    metaKey: boolean,\n    shiftKey: boolean,\n  ) => {\n    const parsedShortcut = parseShortcut(shortcut);\n    return (\n      parsedShortcut.key === key.toLowerCase() &&\n      parsedShortcut.ctrlKey === ctrlKey &&\n      parsedShortcut.altKey === altKey &&\n      parsedShortcut.metaKey === metaKey &&\n      parsedShortcut.shiftKey === shiftKey\n    );\n  };\n\n  const processKeyEvent = (\n    key: string,\n    ctrlKey: boolean,\n    altKey: boolean,\n    metaKey: boolean,\n    shiftKey: boolean,\n    event: KeyboardEvent | MessageEvent,\n  ) => {\n    // FIXME: This is a temporary fix to disable Back button navigation\n    if (key === 'backspace') return true;\n    for (const [actionName, actionHandler] of Object.entries(actions)) {\n      const shortcutKey = actionName as keyof ShortcutConfig;\n      const handler = actionHandler as\n        | ((event?: KeyboardEvent | MessageEvent) => void | boolean)\n        | undefined;\n      const shortcutList = shortcuts[shortcutKey as keyof ShortcutConfig];\n      // console.log('Checking action:', shortcutKey);\n      if (\n        handler &&\n        shortcutList?.some((shortcut) =>\n          isShortcutMatch(shortcut, key, ctrlKey, altKey, metaKey, shiftKey),\n        )\n      ) {\n        if (handler(event)) {\n          return true;\n        }\n      }\n    }\n    return false;\n  };\n\n  const unifiedHandleKeyDown = (event: KeyboardEvent | MessageEvent) => {\n    // Check if the focus is on an input, textarea, or contenteditable element\n    const activeElement = document.activeElement as HTMLElement;\n    const isInteractiveElement =\n      activeElement.tagName === 'INPUT' ||\n      activeElement.tagName === 'TEXTAREA' ||\n      activeElement.isContentEditable;\n\n    const isNoteEditor =\n      activeElement.tagName === 'TEXTAREA' && activeElement.classList.contains('note-editor');\n\n    if (isInteractiveElement && !isNoteEditor) {\n      return; // Skip handling if the user is typing in an input, textarea, or contenteditable\n    }\n\n    if (event instanceof KeyboardEvent) {\n      const { key, ctrlKey, altKey, metaKey, shiftKey } = event;\n\n      if (isNoteEditor && !((key === 'Enter' && ctrlKey) || key == 'Escape')) {\n        return;\n      }\n\n      const handled = processKeyEvent(key.toLowerCase(), ctrlKey, altKey, metaKey, shiftKey, event);\n      // console.log('Key event handled:', key, handled);\n      if (handled) event.preventDefault();\n    } else if (\n      event instanceof MessageEvent &&\n      event.data &&\n      event.data.type === 'iframe-keydown'\n    ) {\n      const { key, ctrlKey, altKey, metaKey, shiftKey } = event.data;\n      processKeyEvent(key.toLowerCase(), ctrlKey, altKey, metaKey, shiftKey, event);\n    }\n  };\n\n  useEffect(() => {\n    window.addEventListener('keydown', unifiedHandleKeyDown);\n    window.addEventListener('message', unifiedHandleKeyDown);\n\n    return () => {\n      window.removeEventListener('keydown', unifiedHandleKeyDown);\n      window.removeEventListener('message', unifiedHandleKeyDown);\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [shortcuts, ...dependencies]);\n};\n\nexport default useShortcuts;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1315, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/hooks/useTrafficLight.ts"],"sourcesContent":["'use client';\n\nimport { useEffect } from 'react';\nimport { useEnv } from '@/context/EnvContext';\nimport { useTrafficLightStore } from '@/store/trafficLightStore';\n\nexport const useTrafficLight = () => {\n  const { appService } = useEnv();\n\n  const {\n    isTrafficLightVisible,\n    initializeTrafficLightStore,\n    initializeTrafficLightListeners,\n    setTrafficLightVisibility,\n    cleanupTrafficLightListeners,\n  } = useTrafficLightStore();\n\n  useEffect(() => {\n    if (!appService?.hasTrafficLight) return;\n\n    initializeTrafficLightStore(appService);\n    initializeTrafficLightListeners();\n    setTrafficLightVisibility(true);\n    return () => {\n      cleanupTrafficLightListeners();\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [appService?.hasTrafficLight]);\n\n  return { isTrafficLightVisible };\n};\n"],"names":[],"mappings":";;;;AAEA;AACA;AACA;;AAJA;;;;AAMO,MAAM,kBAAkB;;IAC7B,MAAM,EAAE,UAAU,EAAE,GAAG,IAAA,6JAAM;IAE7B,MAAM,EACJ,qBAAqB,EACrB,2BAA2B,EAC3B,+BAA+B,EAC/B,yBAAyB,EACzB,4BAA4B,EAC7B,GAAG,IAAA,+KAAoB;IAExB,IAAA,0LAAS;qCAAC;YACR,IAAI,CAAC,YAAY,iBAAiB;YAElC,4BAA4B;YAC5B;YACA,0BAA0B;YAC1B;6CAAO;oBACL;gBACF;;QACA,uDAAuD;QACzD;oCAAG;QAAC,YAAY;KAAgB;IAEhC,OAAO;QAAE;IAAsB;AACjC;GAxBa;;QACY,6JAAM;QAQzB,+KAAoB"}},
    {"offset": {"line": 1364, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/hooks/useSync.ts"],"sourcesContent":["'use client';\n\nimport { useCallback, useEffect, useState } from 'react';\nimport { useRouter } from 'next/navigation';\nimport { useSyncContext } from '@/context/SyncContext';\nimport { SyncData, SyncOp, SyncResult, SyncType } from '@/libs/sync';\nimport { useSettingsStore } from '@/store/settingsStore';\nimport { useBookDataStore } from '@/store/bookDataStore';\nimport { transformBookConfigFromDB } from '@/utils/transform';\nimport { transformBookNoteFromDB } from '@/utils/transform';\nimport { transformBookFromDB } from '@/utils/transform';\nimport { DBBook, DBBookConfig, DBBookNote } from '@/types/records';\nimport { Book, BookConfig, BookDataRecord, BookNote } from '@/types/book';\nimport { navigateToLogin } from '@/utils/nav';\nimport { useReaderStore } from '@/store/readerStore';\n\nconst transformsFromDB = {\n  books: transformBookFromDB,\n  notes: transformBookNoteFromDB,\n  configs: transformBookConfigFromDB,\n};\n\nconst computeMaxTimestamp = (records: BookDataRecord[]): number => {\n  let maxTime = 0;\n  for (const rec of records) {\n    if (rec.updated_at) {\n      const updatedTime = new Date(rec.updated_at).getTime();\n      maxTime = Math.max(maxTime, updatedTime);\n    }\n    if (rec.deleted_at) {\n      const deletedTime = new Date(rec.deleted_at).getTime();\n      maxTime = Math.max(maxTime, deletedTime);\n    }\n  }\n  return maxTime;\n};\n\nconst ONE_DAY_IN_MS = 24 * 60 * 60 * 1000;\nexport function useSync(bookKey?: string) {\n  const router = useRouter();\n  const { settings, setSettings } = useSettingsStore();\n  const { getConfig, setConfig } = useBookDataStore();\n  const { setIsSyncing } = useReaderStore();\n  const config = bookKey ? getConfig(bookKey) : null;\n\n  const [syncingBooks, setSyncingBooks] = useState(false);\n  const [syncingConfigs, setSyncingConfigs] = useState(false);\n  const [syncingNotes, setSyncingNotes] = useState(false);\n  const [syncError, setSyncError] = useState<string | null>(null);\n  const [lastSyncedAtBooks, setLastSyncedAtBooks] = useState<number>(0);\n  const [lastSyncedAtConfigs, setLastSyncedAtConfigs] = useState<number>(0);\n  const [lastSyncedAtNotes, setLastSyncedAtNotes] = useState<number>(0);\n  const [lastSyncedAtInited, setLastSyncedAtInited] = useState(false);\n\n  const [syncing, setSyncing] = useState(false);\n  // null means unsynced, empty array means synced no changes\n  const [syncResult, setSyncResult] = useState<SyncResult>({\n    books: null,\n    configs: null,\n    notes: null,\n  });\n  const [syncedBooks, setSyncedBooks] = useState<Book[] | null>(null);\n  const [syncedConfigs, setSyncedConfigs] = useState<BookConfig[] | null>(null);\n  const [syncedNotes, setSyncedNotes] = useState<BookNote[] | null>(null);\n\n  const { syncClient } = useSyncContext();\n\n  useEffect(() => {\n    if (!bookKey) return;\n    setIsSyncing(bookKey, syncing);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [bookKey, syncing]);\n\n  useEffect(() => {\n    if (!settings.version) return;\n    if (bookKey && !config?.location) return;\n    if (lastSyncedAtInited) return;\n\n    const lastSyncedBooksAt = settings.lastSyncedAtBooks ?? 0;\n    const lastSyncedConfigsAt = config?.lastSyncedAtConfig ?? settings.lastSyncedAtConfigs ?? 0;\n    const lastSyncedNotesAt = config?.lastSyncedAtNotes ?? settings.lastSyncedAtNotes ?? 0;\n    const now = Date.now();\n    setLastSyncedAtBooks(\n      now - lastSyncedBooksAt > 3 * ONE_DAY_IN_MS ? 0 : lastSyncedBooksAt - ONE_DAY_IN_MS,\n    );\n    setLastSyncedAtConfigs(\n      now - lastSyncedConfigsAt > 3 * ONE_DAY_IN_MS ? 0 : lastSyncedConfigsAt - ONE_DAY_IN_MS,\n    );\n    setLastSyncedAtNotes(\n      now - lastSyncedNotesAt > 3 * ONE_DAY_IN_MS ? 0 : lastSyncedNotesAt - ONE_DAY_IN_MS,\n    );\n    setLastSyncedAtInited(true);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [bookKey, settings, config]);\n\n  // bookId is for configs and notes only, if bookId is provided, only pull changes for that book\n  // and update the lastSyncedAt for that book in the book config\n  const pullChanges = async (\n    type: SyncType,\n    since: number,\n    setLastSyncedAt: React.Dispatch<React.SetStateAction<number>>,\n    setSyncing: React.Dispatch<React.SetStateAction<boolean>>,\n    bookId?: string,\n    metaHash?: string,\n  ) => {\n    setSyncing(true);\n    setSyncError(null);\n\n    try {\n      const result = await syncClient.pullChanges(since, type, bookId, metaHash);\n      setSyncResult({ ...syncResult, [type]: result[type] });\n      const records = result[type];\n      if (since > 0 && !records?.length) return;\n      // For since = 0, we set lastSyncedAt to now if no records returned\n      const maxTime = records?.length ? computeMaxTimestamp(records) : Date.now();\n      setLastSyncedAt(maxTime);\n\n      // due to closures in React hooks the settings might be stale\n      // we need to fetch the latest settings from store\n      const settings = useSettingsStore.getState().settings;\n      switch (type) {\n        case 'books':\n          settings.lastSyncedAtBooks = maxTime;\n          setSettings(settings);\n          break;\n        case 'configs':\n          if (!bookId) {\n            settings.lastSyncedAtConfigs = maxTime;\n            setSettings(settings);\n          } else if (bookKey) {\n            setConfig(bookKey, { lastSyncedAtConfig: maxTime });\n          }\n          break;\n        case 'notes':\n          if (!bookId) {\n            settings.lastSyncedAtNotes = maxTime;\n            setSettings(settings);\n          } else if (bookKey) {\n            setConfig(bookKey, { lastSyncedAtNotes: maxTime });\n          }\n          break;\n      }\n    } catch (err: unknown) {\n      console.error(err);\n      if (err instanceof Error) {\n        if (err.message.includes('Not authenticated') && settings.keepLogin) {\n          settings.keepLogin = false;\n          setSettings(settings);\n          navigateToLogin(router);\n        }\n        setSyncError(err.message || `Error pulling ${type}`);\n      } else {\n        setSyncError(`Error pulling ${type}`);\n      }\n    } finally {\n      setSyncing(false);\n    }\n  };\n\n  const pushChanges = async (payload: SyncData) => {\n    setSyncing(true);\n    setSyncError(null);\n\n    try {\n      const result = await syncClient.pushChanges(payload);\n      setSyncResult(result);\n    } catch (err: unknown) {\n      console.error(err);\n      if (err instanceof Error) {\n        setSyncError(err.message || 'Error pushing changes');\n      } else {\n        setSyncError('Error pushing changes');\n      }\n    } finally {\n      setSyncing(false);\n    }\n  };\n\n  const syncBooks = useCallback(\n    async (books?: Book[], op: SyncOp = 'both') => {\n      if (!lastSyncedAtInited) return;\n      if ((op === 'push' || op === 'both') && books?.length) {\n        await pushChanges({ books });\n      }\n      if (op === 'pull' || op === 'both') {\n        await pullChanges('books', lastSyncedAtBooks + 1, setLastSyncedAtBooks, setSyncingBooks);\n      }\n    },\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    [lastSyncedAtInited, lastSyncedAtBooks],\n  );\n\n  const syncConfigs = useCallback(\n    async (bookConfigs?: BookConfig[], bookId?: string, metaHash?: string, op: SyncOp = 'both') => {\n      if (!bookId && !lastSyncedAtInited) return;\n      if ((op === 'push' || op === 'both') && bookConfigs?.length) {\n        await pushChanges({ configs: bookConfigs });\n      }\n      if (op === 'pull' || op === 'both') {\n        await pullChanges(\n          'configs',\n          lastSyncedAtConfigs,\n          setLastSyncedAtConfigs,\n          setSyncingConfigs,\n          bookId,\n          metaHash,\n        );\n      }\n    },\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    [lastSyncedAtInited, lastSyncedAtConfigs],\n  );\n\n  const syncNotes = useCallback(\n    async (bookNotes?: BookNote[], bookId?: string, metaHash?: string, op: SyncOp = 'both') => {\n      if (!lastSyncedAtInited) return;\n      if ((op === 'push' || op === 'both') && bookNotes?.length) {\n        await pushChanges({ notes: bookNotes });\n      }\n      if (op === 'pull' || op === 'both') {\n        await pullChanges(\n          'notes',\n          lastSyncedAtNotes,\n          setLastSyncedAtNotes,\n          setSyncingNotes,\n          bookId,\n          metaHash,\n        );\n      }\n    },\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    [lastSyncedAtInited, lastSyncedAtNotes],\n  );\n\n  useEffect(() => {\n    if (!syncing && syncResult) {\n      const { books: dbBooks, configs: dbBookConfigs, notes: dbBookNotes } = syncResult;\n      const books = dbBooks?.map((dbBook) =>\n        transformsFromDB['books'](dbBook as unknown as DBBook),\n      );\n      const configs = dbBookConfigs?.map((dbBookConfig) =>\n        transformsFromDB['configs'](dbBookConfig as unknown as DBBookConfig),\n      );\n      const notes = dbBookNotes?.map((dbBookNote) =>\n        transformsFromDB['notes'](dbBookNote as unknown as DBBookNote),\n      );\n      if (books) setSyncedBooks(books);\n      if (configs) setSyncedConfigs(configs);\n      if (notes) setSyncedNotes(notes);\n    }\n  }, [syncResult, syncing]);\n\n  return {\n    syncing: syncingBooks || syncingConfigs || syncingNotes,\n    syncError,\n    syncResult,\n    syncedBooks,\n    syncedConfigs,\n    syncedNotes,\n    lastSyncedAtBooks,\n    lastSyncedAtNotes,\n    lastSyncedAtConfigs,\n    useSyncInited: lastSyncedAtInited,\n    pullChanges,\n    pushChanges,\n    syncBooks,\n    syncConfigs,\n    syncNotes,\n  };\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1649, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/hooks/useBackgroundTexture.ts"],"sourcesContent":["'use client';\n\nimport { useCallback } from 'react';\nimport { useCustomTextureStore } from '@/store/customTextureStore';\nimport { useSettingsStore } from '@/store/settingsStore';\nimport { EnvConfigType } from '@/services/environment';\nimport { ViewSettings } from '@/types/book';\n\nexport const useBackgroundTexture = () => {\n  const applyBackgroundTexture = useCallback(\n    (envConfig: EnvConfigType, viewSettings: ViewSettings) => {\n      const textureId = viewSettings.backgroundTextureId;\n      const textureOpacity = viewSettings.backgroundOpacity;\n      const textureSize = viewSettings.backgroundSize;\n      if (!textureId || textureId === 'none') return;\n\n      document.documentElement.style.setProperty('--bg-texture-opacity', `${textureOpacity}`);\n      document.documentElement.style.setProperty('--bg-texture-size', textureSize);\n\n      const settings = useSettingsStore.getState().settings;\n      const customTexture = settings.customTextures?.find((t) => t.id === textureId);\n\n      if (customTexture) {\n        useCustomTextureStore.getState().addTexture(customTexture.path);\n      }\n\n      useCustomTextureStore.getState().applyTexture(envConfig, textureId);\n    },\n    [],\n  );\n\n  return { applyBackgroundTexture };\n};\n"],"names":[],"mappings":";;;;AAEA;AACA;AACA;;AAJA;;;;AAQO,MAAM,uBAAuB;;IAClC,MAAM,yBAAyB,IAAA,4LAAW;oEACxC,CAAC,WAA0B;YACzB,MAAM,YAAY,aAAa,mBAAmB;YAClD,MAAM,iBAAiB,aAAa,iBAAiB;YACrD,MAAM,cAAc,aAAa,cAAc;YAC/C,IAAI,CAAC,aAAa,cAAc,QAAQ;YAExC,SAAS,eAAe,CAAC,KAAK,CAAC,WAAW,CAAC,wBAAwB,GAAG,gBAAgB;YACtF,SAAS,eAAe,CAAC,KAAK,CAAC,WAAW,CAAC,qBAAqB;YAEhE,MAAM,WAAW,uKAAgB,CAAC,QAAQ,GAAG,QAAQ;YACrD,MAAM,gBAAgB,SAAS,cAAc,EAAE;4EAAK,CAAC,IAAM,EAAE,EAAE,KAAK;;YAEpE,IAAI,eAAe;gBACjB,iLAAqB,CAAC,QAAQ,GAAG,UAAU,CAAC,cAAc,IAAI;YAChE;YAEA,iLAAqB,CAAC,QAAQ,GAAG,YAAY,CAAC,WAAW;QAC3D;mEACA,EAAE;IAGJ,OAAO;QAAE;IAAuB;AAClC;GAxBa"}},
    {"offset": {"line": 1693, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/hooks/useAutoFocus.ts"],"sourcesContent":["'use client';\n\nimport { useEffect, useRef } from 'react';\n\ninterface UseAutoFocusOptions {\n  ref?: React.RefObject<HTMLElement | null>;\n  delay?: number;\n  condition?: boolean;\n  preventScroll?: boolean;\n}\n\nexport const useAutoFocus = <T extends HTMLElement = HTMLDivElement>(\n  options: UseAutoFocusOptions = {},\n) => {\n  const { delay = 0, condition = true, preventScroll = false, ref } = options;\n  const localRef = useRef<T>(null);\n  const focusRef = ref || localRef;\n\n  useEffect(() => {\n    if (condition && focusRef.current) {\n      const focusElement = () => {\n        focusRef.current?.focus({ preventScroll });\n      };\n\n      if (delay > 0) {\n        const timer = setTimeout(focusElement, delay);\n        return () => clearTimeout(timer);\n      } else {\n        focusElement();\n      }\n    }\n    return;\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [condition, delay, preventScroll]);\n\n  return focusRef as React.RefObject<T>;\n};\n"],"names":[],"mappings":";;;;AAEA;;AAFA;;AAWO,MAAM,eAAe,CAC1B,UAA+B,CAAC,CAAC;;IAEjC,MAAM,EAAE,QAAQ,CAAC,EAAE,YAAY,IAAI,EAAE,gBAAgB,KAAK,EAAE,GAAG,EAAE,GAAG;IACpE,MAAM,WAAW,IAAA,uLAAM,EAAI;IAC3B,MAAM,WAAW,OAAO;IAExB,IAAA,0LAAS;kCAAC;YACR,IAAI,aAAa,SAAS,OAAO,EAAE;gBACjC,MAAM;2DAAe;wBACnB,SAAS,OAAO,EAAE,MAAM;4BAAE;wBAAc;oBAC1C;;gBAEA,IAAI,QAAQ,GAAG;oBACb,MAAM,QAAQ,WAAW,cAAc;oBACvC;kDAAO,IAAM,aAAa;;gBAC5B,OAAO;oBACL;gBACF;YACF;YACA;QACA,uDAAuD;QACzD;iCAAG;QAAC;QAAW;QAAO;KAAc;IAEpC,OAAO;AACT;GAzBa"}},
    {"offset": {"line": 1743, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/hooks/useEinkMode.ts"],"sourcesContent":["'use client';\n\nimport { useThemeStore } from '@/store/themeStore';\nimport { useCallback } from 'react';\n\nexport const useEinkMode = () => {\n  const { setIsEinkMode } = useThemeStore();\n  const applyEinkMode = useCallback(\n    (isEink: boolean) => {\n      setIsEinkMode(isEink);\n      if (isEink) {\n        document.body.classList.add('no-transitions');\n      } else {\n        document.body.classList.remove('no-transitions');\n      }\n      document.documentElement.setAttribute('data-eink', isEink.toString());\n    },\n    [setIsEinkMode],\n  );\n\n  return { applyEinkMode };\n};\n"],"names":[],"mappings":";;;;AAEA;AACA;;AAHA;;;AAKO,MAAM,cAAc;;IACzB,MAAM,EAAE,aAAa,EAAE,GAAG,IAAA,iKAAa;IACvC,MAAM,gBAAgB,IAAA,4LAAW;kDAC/B,CAAC;YACC,cAAc;YACd,IAAI,QAAQ;gBACV,SAAS,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC;YAC9B,OAAO;gBACL,SAAS,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC;YACjC;YACA,SAAS,eAAe,CAAC,YAAY,CAAC,aAAa,OAAO,QAAQ;QACpE;iDACA;QAAC;KAAc;IAGjB,OAAO;QAAE;IAAc;AACzB;GAhBa;;QACe,iKAAa"}},
    {"offset": {"line": 1785, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/hooks/useUICSS.ts"],"sourcesContent":["'use client';\n\nimport { useEffect, useState } from 'react';\nimport { useReaderStore } from '@/store/readerStore';\nimport { useSettingsStore } from '@/store/settingsStore';\n\n// This hook allows you to inject custom CSS into the reader UI.\n// Note that the book content is rendered in an iframe, so UI CSS won't affect book rendering.\nexport const useUICSS = (bookKey?: string) => {\n  const { settings } = useSettingsStore();\n  const { getViewSettings } = useReaderStore();\n  const viewSettings = getViewSettings(bookKey || '');\n  const [styleElement, setStyleElement] = useState<HTMLStyleElement | null>(null);\n\n  useEffect(() => {\n    if (styleElement) {\n      styleElement.remove();\n    }\n\n    const rawCSS =\n      viewSettings?.userUIStylesheet || settings?.globalViewSettings?.userUIStylesheet || '';\n\n    const newStyleEl = document.createElement('style');\n    newStyleEl.textContent = rawCSS.replace('foliate-view', `#foliate-view-${bookKey}`);\n    document.head.appendChild(newStyleEl);\n    setStyleElement(newStyleEl);\n\n    return () => {\n      newStyleEl.remove();\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [viewSettings?.userUIStylesheet, settings?.globalViewSettings?.userUIStylesheet, bookKey]);\n};\n"],"names":[],"mappings":";;;;AAEA;AACA;AACA;;AAJA;;;;AAQO,MAAM,WAAW,CAAC;;IACvB,MAAM,EAAE,QAAQ,EAAE,GAAG,IAAA,uKAAgB;IACrC,MAAM,EAAE,eAAe,EAAE,GAAG,IAAA,mKAAc;IAC1C,MAAM,eAAe,gBAAgB,WAAW;IAChD,MAAM,CAAC,cAAc,gBAAgB,GAAG,IAAA,yLAAQ,EAA0B;IAE1E,IAAA,0LAAS;8BAAC;YACR,IAAI,cAAc;gBAChB,aAAa,MAAM;YACrB;YAEA,MAAM,SACJ,cAAc,oBAAoB,UAAU,oBAAoB,oBAAoB;YAEtF,MAAM,aAAa,SAAS,aAAa,CAAC;YAC1C,WAAW,WAAW,GAAG,OAAO,OAAO,CAAC,gBAAgB,CAAC,cAAc,EAAE,SAAS;YAClF,SAAS,IAAI,CAAC,WAAW,CAAC;YAC1B,gBAAgB;YAEhB;sCAAO;oBACL,WAAW,MAAM;gBACnB;;QACA,uDAAuD;QACzD;6BAAG;QAAC,cAAc;QAAkB,UAAU,oBAAoB;QAAkB;KAAQ;AAC9F;GAxBa;;QACU,uKAAgB;QACT,mKAAc"}},
    {"offset": {"line": 1839, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/hooks/useDiscordPresence.ts"],"sourcesContent":["'use client';\n\nimport { useEffect, useRef } from 'react';\nimport { Book } from '@/types/book';\nimport { useEnv } from '@/context/EnvContext';\nimport { updateDiscordPresence, clearDiscordPresence } from '@/utils/discord';\n\n/**\n * Hook to manage Discord Rich Presence for a book\n * @param book - Current book being read (null if no book)\n * @param isPrimary - Whether this is the primary book (for multi-book scenarios)\n */\nexport const useDiscordPresence = (book: Book | null, isPrimary: boolean, enabled: boolean) => {\n  const { appService } = useEnv();\n\n  const sessionStartRef = useRef<number>(Date.now());\n  const updateIntervalRef = useRef<NodeJS.Timeout | null>(null);\n  const currentBookHashRef = useRef<string | null>(null);\n  const isUpdatingRef = useRef<boolean>(false);\n\n  useEffect(() => {\n    if (!isPrimary || !book) return;\n    if (!appService?.isDesktopApp) return;\n\n    const stopUpdates = () => {\n      if (updateIntervalRef.current) {\n        clearInterval(updateIntervalRef.current);\n        updateIntervalRef.current = null;\n      }\n      isUpdatingRef.current = false;\n    };\n\n    if (!enabled) {\n      stopUpdates();\n      clearDiscordPresence(appService);\n      currentBookHashRef.current = null;\n      return;\n    }\n\n    if (currentBookHashRef.current !== book.hash) {\n      sessionStartRef.current = Date.now();\n      currentBookHashRef.current = book.hash;\n    }\n\n    const safeUpdate = async () => {\n      if (isUpdatingRef.current) return;\n\n      isUpdatingRef.current = true;\n      try {\n        await updateDiscordPresence(book, sessionStartRef.current, appService);\n      } catch (err) {\n        console.error('Discord presence update failed:', err);\n      } finally {\n        isUpdatingRef.current = false;\n      }\n    };\n\n    void safeUpdate();\n\n    updateIntervalRef.current = setInterval(() => {\n      void safeUpdate();\n    }, 15000);\n\n    return () => {\n      stopUpdates();\n      clearDiscordPresence(appService);\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [book?.hash, isPrimary, enabled, appService]);\n};\n"],"names":[],"mappings":";;;;AAEA;AAEA;AACA;;AALA;;;;AAYO,MAAM,qBAAqB,CAAC,MAAmB,WAAoB;;IACxE,MAAM,EAAE,UAAU,EAAE,GAAG,IAAA,6JAAM;IAE7B,MAAM,kBAAkB,IAAA,uLAAM,EAAS,KAAK,GAAG;IAC/C,MAAM,oBAAoB,IAAA,uLAAM,EAAwB;IACxD,MAAM,qBAAqB,IAAA,uLAAM,EAAgB;IACjD,MAAM,gBAAgB,IAAA,uLAAM,EAAU;IAEtC,IAAA,0LAAS;wCAAC;YACR,IAAI,CAAC,aAAa,CAAC,MAAM;YACzB,IAAI,CAAC,YAAY,cAAc;YAE/B,MAAM;4DAAc;oBAClB,IAAI,kBAAkB,OAAO,EAAE;wBAC7B,cAAc,kBAAkB,OAAO;wBACvC,kBAAkB,OAAO,GAAG;oBAC9B;oBACA,cAAc,OAAO,GAAG;gBAC1B;;YAEA,IAAI,CAAC,SAAS;gBACZ;gBACA,IAAA,qKAAoB,EAAC;gBACrB,mBAAmB,OAAO,GAAG;gBAC7B;YACF;YAEA,IAAI,mBAAmB,OAAO,KAAK,KAAK,IAAI,EAAE;gBAC5C,gBAAgB,OAAO,GAAG,KAAK,GAAG;gBAClC,mBAAmB,OAAO,GAAG,KAAK,IAAI;YACxC;YAEA,MAAM;2DAAa;oBACjB,IAAI,cAAc,OAAO,EAAE;oBAE3B,cAAc,OAAO,GAAG;oBACxB,IAAI;wBACF,MAAM,IAAA,sKAAqB,EAAC,MAAM,gBAAgB,OAAO,EAAE;oBAC7D,EAAE,OAAO,KAAK;wBACZ,QAAQ,KAAK,CAAC,mCAAmC;oBACnD,SAAU;wBACR,cAAc,OAAO,GAAG;oBAC1B;gBACF;;YAEA,KAAK;YAEL,kBAAkB,OAAO,GAAG;gDAAY;oBACtC,KAAK;gBACP;+CAAG;YAEH;gDAAO;oBACL;oBACA,IAAA,qKAAoB,EAAC;gBACvB;;QACA,uDAAuD;QACzD;uCAAG;QAAC,MAAM;QAAM;QAAW;QAAS;KAAW;AACjD;GAzDa;;QACY,6JAAM"}},
    {"offset": {"line": 1927, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/hooks/useResetSettings.ts"],"sourcesContent":["import { Dispatch, SetStateAction } from 'react';\nimport { useEnv } from '@/context/EnvContext';\nimport { ViewSettings } from '@/types/book';\n\ntype SetterKey = keyof ViewSettings;\ntype SetterValue = SetStateAction<string> & SetStateAction<number> & SetStateAction<boolean>;\n\ntype StateSetters = Partial<{\n  [Key in SetterKey]: Dispatch<SetterValue>;\n}>;\n\nexport const useResetViewSettings = () => {\n  const { appService } = useEnv();\n\n  const resetToDefaults = (setters: StateSetters) => {\n    if (!appService) return;\n    const defaultSettings = appService.getDefaultViewSettings();\n\n    Object.entries(setters).forEach(([settingKey, setter]) => {\n      const freshValue = defaultSettings[settingKey as SetterKey];\n      if (freshValue !== undefined) {\n        setter(freshValue as SetterValue);\n      }\n    });\n  };\n\n  return resetToDefaults;\n};\n"],"names":[],"mappings":";;;;AACA;;;AAUO,MAAM,uBAAuB;;IAClC,MAAM,EAAE,UAAU,EAAE,GAAG,IAAA,6JAAM;IAE7B,MAAM,kBAAkB,CAAC;QACvB,IAAI,CAAC,YAAY;QACjB,MAAM,kBAAkB,WAAW,sBAAsB;QAEzD,OAAO,OAAO,CAAC,SAAS,OAAO,CAAC,CAAC,CAAC,YAAY,OAAO;YACnD,MAAM,aAAa,eAAe,CAAC,WAAwB;YAC3D,IAAI,eAAe,WAAW;gBAC5B,OAAO;YACT;QACF;IACF;IAEA,OAAO;AACT;GAhBa;;QACY,6JAAM"}}]
}