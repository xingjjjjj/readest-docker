{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/packages/foliate-js/progress.js"],"sourcesContent":["// assign a unique ID for each TOC item\nconst assignIDs = toc => {\n    let id = 0\n    const assignID = item => {\n        item.id = id++\n        if (item.subitems) for (const subitem of item.subitems) assignID(subitem)\n    }\n    for (const item of toc) assignID(item)\n    return toc\n}\n\nconst flatten = items => items\n    .map(item => item.subitems?.length\n        ? [item, flatten(item.subitems)].flat()\n        : item)\n    .flat()\n\nexport class TOCProgress {\n    async init({ toc, ids, splitHref, getFragment }) {\n        assignIDs(toc)\n        const items = flatten(toc)\n        const grouped = new Map()\n        for (const [i, item] of items.entries()) {\n            const [id, fragment] = await splitHref(item?.href) ?? []\n            const value = { fragment, item }\n            if (grouped.has(id)) grouped.get(id).items.push(value)\n            else grouped.set(id, { prev: items[i - 1], items: [value] })\n        }\n        const map = new Map()\n        for (const [i, id] of ids.entries()) {\n            if (grouped.has(id)) map.set(id, grouped.get(id))\n            else map.set(id, map.get(ids[i - 1]))\n        }\n        this.ids = ids\n        this.map = map\n        this.getFragment = getFragment\n    }\n    getProgress(index, range) {\n        if (!this.ids) return\n        const id = this.ids[index]\n        const obj = this.map.get(id)\n        if (!obj) return null\n        const { prev, items } = obj\n        if (!items) return prev\n        if (!range || items.length === 1 && !items[0].fragment) return items[0].item\n\n        const doc = range.startContainer.getRootNode()\n        for (const [i, { fragment }] of items.entries()) {\n            const el = this.getFragment(doc, fragment)\n            if (!el) continue\n            if (range.comparePoint(el, 0) > 0)\n                return (items[i - 1]?.item ?? prev)\n        }\n        return items[items.length - 1].item\n    }\n}\n\nexport class SectionProgress {\n    constructor(sections, sizePerLoc, sizePerTimeUnit) {\n        this.sizes = sections.map(s => s.linear != 'no' && s.size > 0 ? s.size : 0)\n        this.sizePerLoc = sizePerLoc\n        this.sizePerTimeUnit = sizePerTimeUnit\n        this.sizeTotal = this.sizes.reduce((a, b) => a + b, 0)\n        this.sectionFractions = this.#getSectionFractions()\n    }\n    #getSectionFractions() {\n        const { sizeTotal } = this\n        const results = [0]\n        let sum = 0\n        for (const size of this.sizes) results.push((sum += size) / sizeTotal)\n        return results\n    }\n    // get progress given index of and fractions within a section\n    getProgress(index, fractionInSection, pageFraction = 0) {\n        const { sizes, sizePerLoc, sizePerTimeUnit, sizeTotal } = this\n        const sizeInSection = sizes[index] ?? 0\n        const sizeBefore = sizes.slice(0, index).reduce((a, b) => a + b, 0)\n        const size = sizeBefore + fractionInSection * sizeInSection\n        const nextSize = size + pageFraction * sizeInSection\n        const remainingTotal = sizeTotal - size\n        const remainingSection = (1 - fractionInSection) * sizeInSection\n        return {\n            fraction: nextSize / sizeTotal,\n            section: {\n                current: index,\n                total: sizes.length,\n            },\n            location: {\n                current: Math.floor(size / sizePerLoc),\n                next: Math.floor(nextSize / sizePerLoc),\n                total: Math.ceil(sizeTotal / sizePerLoc),\n            },\n            time: {\n                section: remainingSection / sizePerTimeUnit,\n                total: remainingTotal / sizePerTimeUnit,\n            },\n        }\n    }\n    // the inverse of `getProgress`\n    // get index of and fraction in section based on total fraction\n    getSection(fraction) {\n        if (fraction <= 0) return [0, 0]\n        if (fraction >= 1) return [this.sizes.length - 1, 1]\n        fraction = fraction + Number.EPSILON\n        const { sizeTotal } = this\n        let index = this.sectionFractions.findIndex(x => x > fraction) - 1\n        if (index < 0) return [0, 0]\n        while (!this.sizes[index]) index++\n        const fractionInSection = (fraction - this.sectionFractions[index])\n            / (this.sizes[index] / sizeTotal)\n        return [index, fractionInSection]\n    }\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 145, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/packages/foliate-js/text-walker.js"],"sourcesContent":["const walkRange = (range, walker) => {\n    const nodes = []\n    for (let node = walker.currentNode; node; node = walker.nextNode()) {\n        const compare = range.comparePoint(node, 0)\n        if (compare === 0) nodes.push(node)\n        else if (compare > 0) break\n    }\n    return nodes\n}\n\nconst walkDocument = (_, walker) => {\n    const nodes = []\n    for (let node = walker.nextNode(); node; node = walker.nextNode())\n        nodes.push(node)\n    return nodes\n}\n\nconst filter = NodeFilter.SHOW_ELEMENT | NodeFilter.SHOW_TEXT\n    | NodeFilter.SHOW_CDATA_SECTION\n\nconst acceptNode = node => {\n    if (node.nodeType === 1) {\n        const name = node.tagName.toLowerCase()\n        if (name === 'script' || name === 'style') return NodeFilter.FILTER_REJECT\n        return NodeFilter.FILTER_SKIP\n    }\n    return NodeFilter.FILTER_ACCEPT\n}\n\nexport const textWalker = function* (x, func, filterFunc) {\n    const root = x.commonAncestorContainer ?? x.body ?? x\n    const walker = document.createTreeWalker(root, filter, { acceptNode: filterFunc || acceptNode })\n    const walk = x.commonAncestorContainer ? walkRange : walkDocument\n    const nodes = walk(x, walker)\n    const strs = nodes.map(node => node.nodeValue ?? '')\n    const makeRange = (startIndex, startOffset, endIndex, endOffset) => {\n        const range = document.createRange()\n        range.setStart(nodes[startIndex], startOffset)\n        range.setEnd(nodes[endIndex], endOffset)\n        return range\n    }\n    for (const match of func(strs, makeRange)) yield match\n}\n"],"names":[],"mappings":";;;;AAAA,MAAM,YAAY,CAAC,OAAO;IACtB,MAAM,QAAQ,EAAE;IAChB,IAAK,IAAI,OAAO,OAAO,WAAW,EAAE,MAAM,OAAO,OAAO,QAAQ,GAAI;QAChE,MAAM,UAAU,MAAM,YAAY,CAAC,MAAM;QACzC,IAAI,YAAY,GAAG,MAAM,IAAI,CAAC;aACzB,IAAI,UAAU,GAAG;IAC1B;IACA,OAAO;AACX;AAEA,MAAM,eAAe,CAAC,GAAG;IACrB,MAAM,QAAQ,EAAE;IAChB,IAAK,IAAI,OAAO,OAAO,QAAQ,IAAI,MAAM,OAAO,OAAO,QAAQ,GAC3D,MAAM,IAAI,CAAC;IACf,OAAO;AACX;AAEA,MAAM,SAAS,WAAW,YAAY,GAAG,WAAW,SAAS,GACvD,WAAW,kBAAkB;AAEnC,MAAM,aAAa,CAAA;IACf,IAAI,KAAK,QAAQ,KAAK,GAAG;QACrB,MAAM,OAAO,KAAK,OAAO,CAAC,WAAW;QACrC,IAAI,SAAS,YAAY,SAAS,SAAS,OAAO,WAAW,aAAa;QAC1E,OAAO,WAAW,WAAW;IACjC;IACA,OAAO,WAAW,aAAa;AACnC;AAEO,MAAM,aAAa,UAAW,CAAC,EAAE,IAAI,EAAE,UAAU;IACpD,MAAM,OAAO,EAAE,uBAAuB,IAAI,EAAE,IAAI,IAAI;IACpD,MAAM,SAAS,SAAS,gBAAgB,CAAC,MAAM,QAAQ;QAAE,YAAY,cAAc;IAAW;IAC9F,MAAM,OAAO,EAAE,uBAAuB,GAAG,YAAY;IACrD,MAAM,QAAQ,KAAK,GAAG;IACtB,MAAM,OAAO,MAAM,GAAG,CAAC,CAAA,OAAQ,KAAK,SAAS,IAAI;IACjD,MAAM,YAAY,CAAC,YAAY,aAAa,UAAU;QAClD,MAAM,QAAQ,SAAS,WAAW;QAClC,MAAM,QAAQ,CAAC,KAAK,CAAC,WAAW,EAAE;QAClC,MAAM,MAAM,CAAC,KAAK,CAAC,SAAS,EAAE;QAC9B,OAAO;IACX;IACA,KAAK,MAAM,SAAS,KAAK,MAAM,WAAY,MAAM;AACrD"}},
    {"offset": {"line": 195, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/packages/foliate-js/view.js"],"sourcesContent":["import * as CFI from './epubcfi.js'\nimport { TOCProgress, SectionProgress } from './progress.js'\nimport { Overlayer } from './overlayer.js'\nimport { textWalker } from './text-walker.js'\n\nconst SEARCH_PREFIX = 'foliate-search:'\n\nconst NOTE_PREFIX = 'foliate-note:'\n\nconst isZip = async file => {\n    const arr = new Uint8Array(await file.slice(0, 4).arrayBuffer())\n    return arr[0] === 0x50 && arr[1] === 0x4b && arr[2] === 0x03 && arr[3] === 0x04\n}\n\nconst isPDF = async file => {\n    const arr = new Uint8Array(await file.slice(0, 5).arrayBuffer())\n    return arr[0] === 0x25\n        && arr[1] === 0x50 && arr[2] === 0x44 && arr[3] === 0x46\n        && arr[4] === 0x2d\n}\n\nconst isCBZ = ({ name, type }) =>\n    type === 'application/vnd.comicbook+zip' || name.endsWith('.cbz')\n\nconst isFB2 = ({ name, type }) =>\n    type === 'application/x-fictionbook+xml' || name.endsWith('.fb2')\n\nconst isFBZ = ({ name, type }) =>\n    type === 'application/x-zip-compressed-fb2'\n    || name.endsWith('.fb2.zip') || name.endsWith('.fbz')\n\nconst makeZipLoader = async file => {\n    const { configure, ZipReader, BlobReader, TextWriter, BlobWriter } =\n        await import('./vendor/zip.js')\n    configure({ useWebWorkers: false })\n    const reader = new ZipReader(new BlobReader(file))\n    const entries = await reader.getEntries()\n    const map = new Map(entries.map(entry => [entry.filename, entry]))\n    const load = f => (name, ...args) =>\n        map.has(name) ? f(map.get(name), ...args) : null\n    const loadText = load(entry => entry.getData(new TextWriter()))\n    const loadBlob = load((entry, type) => entry.getData(new BlobWriter(type)))\n    const getSize = name => map.get(name)?.uncompressedSize ?? 0\n    return { entries, loadText, loadBlob, getSize }\n}\n\nconst getFileEntries = async entry => entry.isFile ? entry\n    : (await Promise.all(Array.from(\n        await new Promise((resolve, reject) => entry.createReader()\n            .readEntries(entries => resolve(entries), error => reject(error))),\n        getFileEntries))).flat()\n\nconst makeDirectoryLoader = async entry => {\n    const entries = await getFileEntries(entry)\n    const files = await Promise.all(\n        entries.map(entry => new Promise((resolve, reject) =>\n            entry.file(file => resolve([file, entry.fullPath]),\n                error => reject(error)))))\n    const map = new Map(files.map(([file, path]) =>\n        [path.replace(entry.fullPath + '/', ''), file]))\n    const decoder = new TextDecoder()\n    const decode = x => x ? decoder.decode(x) : null\n    const getBuffer = name => map.get(name)?.arrayBuffer() ?? null\n    const loadText = async name => decode(await getBuffer(name))\n    const loadBlob = name => map.get(name)\n    const getSize = name => map.get(name)?.size ?? 0\n    return { loadText, loadBlob, getSize }\n}\n\nexport class ResponseError extends Error {}\nexport class NotFoundError extends Error {}\nexport class UnsupportedTypeError extends Error {}\n\nconst fetchFile = async url => {\n    const res = await fetch(url)\n    if (!res.ok) throw new ResponseError(\n        `${res.status} ${res.statusText}`, { cause: res })\n    return new File([await res.blob()], new URL(res.url).pathname)\n}\n\nexport const makeBook = async file => {\n    if (typeof file === 'string') file = await fetchFile(file)\n    let book\n    if (file.isDirectory) {\n        const loader = await makeDirectoryLoader(file)\n        const { EPUB } = await import('./epub.js')\n        book = await new EPUB(loader).init()\n    }\n    else if (!file.size) throw new NotFoundError('File not found')\n    else if (await isZip(file)) {\n        const loader = await makeZipLoader(file)\n        if (isCBZ(file)) {\n            const { makeComicBook } = await import('./comic-book.js')\n            book = makeComicBook(loader, file)\n        }\n        else if (isFBZ(file)) {\n            const { makeFB2 } = await import('./fb2.js')\n            const { entries } = loader\n            const entry = entries.find(entry => entry.filename.endsWith('.fb2'))\n            const blob = await loader.loadBlob((entry ?? entries[0]).filename)\n            book = await makeFB2(blob)\n        }\n        else {\n            const { EPUB } = await import('./epub.js')\n            book = await new EPUB(loader).init()\n        }\n    }\n    else if (await isPDF(file)) {\n        const { makePDF } = await import('./pdf.js')\n        book = await makePDF(file)\n    }\n    else {\n        const { isMOBI, MOBI } = await import('./mobi.js')\n        if (await isMOBI(file)) {\n            const fflate = await import('./vendor/fflate.js')\n            book = await new MOBI({ unzlib: fflate.unzlibSync }).open(file)\n        }\n        else if (isFB2(file)) {\n            const { makeFB2 } = await import('./fb2.js')\n            book = await makeFB2(file)\n        }\n    }\n    if (!book) throw new UnsupportedTypeError('File type not supported')\n    return book\n}\n\nclass CursorAutohider {\n    #timeout\n    #el\n    #check\n    #state\n    constructor(el, check, state = {}) {\n        this.#el = el\n        this.#check = check\n        this.#state = state\n        if (this.#state.hidden) this.hide()\n        this.#el.addEventListener('mousemove', ({ screenX, screenY }) => {\n            // check if it actually moved\n            if (screenX === this.#state.x && screenY === this.#state.y) return\n            this.#state.x = screenX, this.#state.y = screenY\n            this.show()\n            if (this.#timeout) clearTimeout(this.#timeout)\n            if (check()) this.#timeout = setTimeout(this.hide.bind(this), 1000)\n        }, false)\n    }\n    cloneFor(el) {\n        return new CursorAutohider(el, this.#check, this.#state)\n    }\n    hide() {\n        this.#el.style.cursor = 'none'\n        this.#state.hidden = true\n    }\n    show() {\n        this.#el.style.removeProperty('cursor')\n        this.#state.hidden = false\n    }\n}\n\nclass History extends EventTarget {\n    #arr = []\n    #index = -1\n    pushState(x) {\n        const last = this.#arr[this.#index]\n        if (last === x || last?.fraction && last.fraction === x.fraction) return\n        this.#arr[++this.#index] = x\n        this.#arr.length = this.#index + 1\n        this.dispatchEvent(new Event('index-change'))\n    }\n    replaceState(x) {\n        const index = this.#index\n        this.#arr[index] = x\n    }\n    back() {\n        const index = this.#index\n        if (index <= 0) return\n        const detail = { state: this.#arr[index - 1] }\n        this.#index = index - 1\n        this.dispatchEvent(new CustomEvent('popstate', { detail }))\n        this.dispatchEvent(new Event('index-change'))\n    }\n    forward() {\n        const index = this.#index\n        if (index >= this.#arr.length - 1) return\n        const detail = { state: this.#arr[index + 1] }\n        this.#index = index + 1\n        this.dispatchEvent(new CustomEvent('popstate', { detail }))\n        this.dispatchEvent(new Event('index-change'))\n    }\n    get canGoBack() {\n        return this.#index > 0\n    }\n    get canGoForward() {\n        return this.#index < this.#arr.length - 1\n    }\n    clear() {\n        this.#arr = []\n        this.#index = -1\n    }\n}\n\nconst languageInfo = lang => {\n    if (!lang) return {}\n    try {\n        const canonical = Intl.getCanonicalLocales(lang)[0]\n        const locale = new Intl.Locale(canonical)\n        const isCJK = ['zh', 'ja', 'kr'].includes(locale.language)\n        const direction = (locale.getTextInfo?.() ?? locale.textInfo)?.direction\n        return { canonical, locale, isCJK, direction }\n    } catch (e) {\n        console.warn(e)\n        return {}\n    }\n}\n\nexport class View extends HTMLElement {\n    #root = this.attachShadow({ mode: 'open' })\n    #sectionProgress\n    #tocProgress\n    #pageProgress\n    #searchResults = new Map()\n    #cursorAutohider = new CursorAutohider(this, () =>\n        this.hasAttribute('autohide-cursor'))\n    isFixedLayout = false\n    lastLocation\n    history = new History()\n    constructor() {\n        super()\n        this.history.addEventListener('popstate', ({ detail }) => {\n            const resolved = this.resolveNavigation(detail.state)\n            this.renderer.goTo(resolved)\n        })\n    }\n    async open(book) {\n        if (typeof book === 'string'\n        || typeof book.arrayBuffer === 'function'\n        || book.isDirectory) book = await makeBook(book)\n        this.book = book\n        this.language = languageInfo(book.metadata?.language)\n\n        if (book.splitTOCHref && book.getTOCFragment) {\n            const ids = book.sections.map(s => s.id)\n            this.#sectionProgress = new SectionProgress(book.sections, 1500, 1600)\n            const splitHref = book.splitTOCHref.bind(book)\n            const getFragment = book.getTOCFragment.bind(book)\n            this.#tocProgress = new TOCProgress()\n            await this.#tocProgress.init({\n                toc: book.toc ?? [], ids, splitHref, getFragment })\n            this.#pageProgress = new TOCProgress()\n            await this.#pageProgress.init({\n                toc: book.pageList ?? [], ids, splitHref, getFragment })\n        }\n\n        this.isFixedLayout = this.book.rendition?.layout === 'pre-paginated'\n        if (this.isFixedLayout) {\n            await import('./fixed-layout.js')\n            this.renderer = document.createElement('foliate-fxl')\n        } else {\n            await import('./paginator.js')\n            this.renderer = document.createElement('foliate-paginator')\n        }\n        this.renderer.setAttribute('exportparts', 'head,foot,filter,container')\n        this.renderer.addEventListener('load', e => this.#onLoad(e.detail))\n        this.renderer.addEventListener('relocate', e => this.#onRelocate(e.detail))\n        this.renderer.addEventListener('create-overlayer', e =>\n            e.detail.attach(this.#createOverlayer(e.detail)))\n        this.renderer.open(book)\n        this.#root.append(this.renderer)\n\n        if (book.sections.some(section => section.mediaOverlay)) {\n            const activeClass = book.media.activeClass\n            const playbackActiveClass = book.media.playbackActiveClass\n            this.mediaOverlay = book.getMediaOverlay()\n            let lastActive\n            this.mediaOverlay.addEventListener('highlight', e => {\n                const resolved = this.resolveNavigation(e.detail.text)\n                this.renderer.goTo(resolved)\n                    .then(() => {\n                        const { doc } = this.renderer.getContents()\n                            .find(x => x.index = resolved.index)\n                        const el = resolved.anchor(doc)\n                        el.classList.add(activeClass)\n                        if (playbackActiveClass) el.ownerDocument\n                            .documentElement.classList.add(playbackActiveClass)\n                        lastActive = new WeakRef(el)\n                    })\n            })\n            this.mediaOverlay.addEventListener('unhighlight', () => {\n                const el = lastActive?.deref()\n                if (el) {\n                    el.classList.remove(activeClass)\n                    if (playbackActiveClass) el.ownerDocument\n                        .documentElement.classList.remove(playbackActiveClass)\n                }\n            })\n        }\n    }\n    close() {\n        this.renderer?.destroy()\n        this.renderer?.remove()\n        this.#sectionProgress = null\n        this.#tocProgress = null\n        this.#pageProgress = null\n        this.#searchResults = new Map()\n        this.lastLocation = null\n        this.history.clear()\n        this.tts = null\n        this.mediaOverlay = null\n    }\n    goToTextStart() {\n        return this.goTo(this.book.landmarks\n            ?.find(m => m.type.includes('bodymatter') || m.type.includes('text'))\n            ?.href ?? this.book.sections.findIndex(s => s.linear !== 'no'))\n    }\n    async init({ lastLocation, showTextStart }) {\n        const resolved = lastLocation ? this.resolveNavigation(lastLocation) : null\n        if (resolved) {\n            await this.renderer.goTo(resolved)\n            this.history.pushState(lastLocation)\n        }\n        else if (showTextStart) await this.goToTextStart()\n        else {\n            this.history.pushState(0)\n            await this.next()\n        }\n    }\n    #emit(name, detail, cancelable) {\n        return this.dispatchEvent(new CustomEvent(name, { detail, cancelable }))\n    }\n    #onRelocate({ reason, range, index, fraction, size }) {\n        const progress = this.#sectionProgress?.getProgress(index, fraction, size) ?? {}\n        const tocItem = this.#tocProgress?.getProgress(index, range)\n        const pageItem = this.#pageProgress?.getProgress(index, range)\n        const cfi = this.getCFI(index, range)\n        this.lastLocation = { ...progress, tocItem, pageItem, cfi, range }\n        if (reason === 'snap' || reason === 'page' || reason === 'scroll')\n            this.history.replaceState(cfi)\n        this.#emit('relocate', this.lastLocation)\n    }\n    #onLoad({ doc, index }) {\n        // set language and dir if not already set\n        doc.documentElement.lang ||= this.language.canonical ?? ''\n        if (!this.language.isCJK)\n            doc.documentElement.dir ||= this.language.direction ?? ''\n\n        this.#handleLinks(doc, index)\n        this.#cursorAutohider.cloneFor(doc.documentElement)\n\n        this.#emit('load', { doc, index })\n    }\n    #handleLinks(doc, index) {\n        const { book } = this\n        const section = book.sections[index]\n        doc.addEventListener('click', e => {\n            const a = e.target.closest('a[href]')\n            if (!a) return\n            e.preventDefault()\n            const href_ = a.getAttribute('href')\n            const href = section?.resolveHref?.(href_) ?? href_\n            if (book?.isExternal?.(href))\n                Promise.resolve(this.#emit('external-link', { a, href }, true))\n                    .then(x => x ? globalThis.open(href, '_blank') : null)\n                    .catch(e => console.error(e))\n            else {\n                let internalHref = href\n                if (!book.resolveHref(href)) {\n                    const hashIndex = href_.indexOf('#')\n                    if (hashIndex >= 0) {\n                        const hash = href_.slice(hashIndex)\n                        internalHref = section?.resolveHref?.(hash) ?? href\n                    }\n                }\n                Promise.resolve(this.#emit('link', { a, href: internalHref }, true))\n                    .then(x => x ? this.goTo(internalHref) : null)\n                    .catch(e => console.error(e))\n            }\n        })\n    }\n    async addAnnotation(annotation, remove) {\n        const { value } = annotation\n        if (value.startsWith(SEARCH_PREFIX)) {\n            const cfi = value.replace(SEARCH_PREFIX, '')\n            const { index, anchor } = await this.resolveNavigation(cfi)\n            const obj = this.#getOverlayer(index)\n            if (obj) {\n                const { overlayer, doc } = obj\n                if (remove) {\n                    overlayer.remove(value)\n                    return\n                }\n                const range = doc ? anchor(doc) : anchor\n                overlayer.add(value, range, Overlayer.outline)\n            }\n            return\n        } else if (value.startsWith(NOTE_PREFIX)) {\n            const cfi = value.replace(NOTE_PREFIX, '')\n            const { index, anchor } = await this.resolveNavigation(cfi)\n            const obj = this.#getOverlayer(index)\n            if (obj) {\n                const { overlayer, doc } = obj\n                if (remove) {\n                    overlayer.remove(value)\n                    return\n                }\n                const range = doc ? anchor(doc) : anchor\n                const draw = (func, opts) => overlayer.add(value, range, func, opts)\n                this.#emit('draw-annotation', { draw, annotation, doc, range })\n            }\n            return\n        }\n        const { index, anchor } = await this.resolveNavigation(value)\n        const obj = this.#getOverlayer(index)\n        if (obj) {\n            const { overlayer, doc } = obj\n            overlayer.remove(value)\n            if (!remove) {\n                const range = doc ? anchor(doc) : anchor\n                const draw = (func, opts) => overlayer.add(value, range, func, opts)\n                this.#emit('draw-annotation', { draw, annotation, doc, range })\n            }\n        }\n        const label = this.#tocProgress.getProgress(index)?.label ?? ''\n        return { index, label }\n    }\n    deleteAnnotation(annotation) {\n        return this.addAnnotation(annotation, true)\n    }\n    #getOverlayer(index) {\n        return this.renderer.getContents()\n            .find(x => x.index === index && x.overlayer)\n    }\n    #createOverlayer({ doc, index }) {\n        const overlayer = new Overlayer(doc)\n        doc.addEventListener('click', e => {\n            const [value, range, rect] = overlayer.hitTest(e)\n            if (value && !value.startsWith(SEARCH_PREFIX)) {\n                this.#emit('show-annotation', { value, index, range, rect })\n            }\n        }, false)\n\n        let lastHitTestTime = 0\n        const THROTTLE_MS = 200\n        const isAndroid = /Android/i.test(navigator.userAgent)\n\n        doc.addEventListener('mousemove', (e) => {\n            if (isAndroid) return\n            const now = performance.now()\n            if (now - lastHitTestTime < THROTTLE_MS) return\n            lastHitTestTime = now\n            const [value] = overlayer.hitTest(e)\n            if (value && !value.startsWith(SEARCH_PREFIX)) {\n                doc.body.style.cursor = 'pointer'\n            } else {\n                doc.body.style.cursor = ''\n            }\n        })\n\n        const list = this.#searchResults.get(index)\n        if (list) for (const item of list) this.addAnnotation(item)\n\n        this.#emit('create-overlay', { index })\n        return overlayer\n    }\n    async showAnnotation(annotation) {\n        const { value } = annotation\n        const resolved = await this.goTo(value)\n        if (resolved) {\n            const { index, anchor } = resolved\n            const { doc } =  this.#getOverlayer(index)\n            const range = anchor(doc)\n            this.#emit('show-annotation', { value, index, range })\n        }\n    }\n    getCFI(index, range) {\n        const baseCFI = this.book.sections[index].cfi ?? CFI.fake.fromIndex(index)\n        if (!range) return baseCFI\n        return CFI.joinIndir(baseCFI, CFI.fromRange(range))\n    }\n    resolveCFI(cfi) {\n        if (this.book.resolveCFI)\n            return this.book.resolveCFI(cfi)\n        else {\n            const parts = CFI.parse(cfi)\n            const index = CFI.fake.toIndex((parts.parent ?? parts).shift())\n            const anchor = doc => CFI.toRange(doc, parts)\n            return { index, anchor }\n        }\n    }\n    resolveNavigation(target) {\n        try {\n            if (typeof target === 'number') return { index: target }\n            if (typeof target.fraction === 'number') {\n                const [index, anchor] = this.#sectionProgress.getSection(target.fraction)\n                return { index, anchor }\n            }\n            if (CFI.isCFI.test(target)) return this.resolveCFI(target)\n            return this.book.resolveHref(target)\n        } catch (e) {\n            console.error(e)\n            console.error(`Could not resolve target ${target}`)\n        }\n    }\n    async goTo(target) {\n        const resolved = this.resolveNavigation(target)\n        try {\n            await this.renderer.goTo(resolved)\n            this.history.pushState(target)\n            return resolved\n        } catch(e) {\n            console.error(e)\n            console.error(`Could not go to ${target}`)\n        }\n    }\n    async goToFraction(frac) {\n        const [index, anchor] = this.#sectionProgress.getSection(frac)\n        await this.renderer.goTo({ index, anchor })\n        this.history.pushState({ fraction: frac })\n    }\n    async select(target) {\n        try {\n            const obj = await this.resolveNavigation(target)\n            await this.renderer.goTo({ ...obj, select: true })\n            this.history.pushState(target)\n        } catch(e) {\n            console.error(e)\n            console.error(`Could not go to ${target}`)\n        }\n    }\n    deselect() {\n        for (const { doc } of this.renderer.getContents())\n            doc.defaultView.getSelection().removeAllRanges()\n    }\n    getSectionFractions() {\n        return (this.#sectionProgress?.sectionFractions ?? [])\n            .map(x => x + Number.EPSILON)\n    }\n    getProgressOf(index, range) {\n        const tocItem = this.#tocProgress?.getProgress(index, range)\n        const pageItem = this.#pageProgress?.getProgress(index, range)\n        return { tocItem, pageItem }\n    }\n    async getTOCItemOf(target) {\n        try {\n            const { index, anchor } = await this.resolveNavigation(target)\n            const doc = await this.book.sections[index].createDocument()\n            const frag = anchor(doc)\n            const isRange = frag instanceof Range\n            const range = isRange ? frag : doc.createRange()\n            if (!isRange) range.selectNodeContents(frag)\n            return this.#tocProgress.getProgress(index, range)\n        } catch(e) {\n            console.error(e)\n            console.error(`Could not get ${target}`)\n        }\n    }\n    async prev(distance) {\n        await this.renderer.prev(distance)\n    }\n    async next(distance) {\n        await this.renderer.next(distance)\n    }\n    async pan(dx, dy) {\n        await this.renderer.pan(dx, dy)\n    }\n    isOverflowX() {\n        return this.renderer.isOverflowX\n    }\n    isOverflowY() {\n        return this.renderer.isOverflowY\n    }\n    goLeft() {\n        return this.book.dir === 'rtl' ? this.next() : this.prev()\n    }\n    goRight() {\n        return this.book.dir === 'rtl' ? this.prev() : this.next()\n    }\n    async * #searchSection(matcher, query, index) {\n        const doc = await this.book.sections[index].createDocument()\n        for (const { range, excerpt } of matcher(doc, query))\n            yield { cfi: this.getCFI(index, range), excerpt }\n    }\n    async * #searchBook(matcher, query) {\n        const { sections } = this.book\n        for (const [index, { createDocument }] of sections.entries()) {\n            if (!createDocument) continue\n            const doc = await createDocument()\n            const subitems = Array.from(matcher(doc, query), ({ range, excerpt }) =>\n                ({ cfi: this.getCFI(index, range), excerpt }))\n            const progress = (index + 1) / sections.length\n            yield { progress }\n            if (subitems.length) yield { index, subitems }\n        }\n    }\n    async * search(opts) {\n        this.clearSearch()\n        const { searchMatcher } = await import('./search.js')\n        const { sections } = this.book\n        const { query, index, results } = opts\n        const matcher = searchMatcher(textWalker,\n            { defaultLocale: this.language, ...opts })\n\n        const iter = results?.length\n            ? (async function* () {\n                for (const result of results) {\n                    if (result.subitems) {\n                        const progress = (result.index + 1) / sections.length\n                        yield { progress }\n                        yield { index: result.index, subitems: result.subitems }\n                    } else {\n                        yield { cfi: result.cfi, excerpt: result.excerpt }\n                    }\n                }\n            })()\n            : index != null\n                ? this.#searchSection(matcher, query, index)\n                : this.#searchBook(matcher, query)\n\n        const list = []\n        this.#searchResults.set(index, list)\n\n        for await (const result of iter) {\n            if (result.subitems){\n                const list = result.subitems\n                    .map(({ cfi }) => ({ value: SEARCH_PREFIX + cfi }))\n                this.#searchResults.set(result.index, list)\n                for (const item of list) this.addAnnotation(item)\n                yield {\n                    index: result.index,\n                    label: this.#tocProgress.getProgress(result.index)?.label ?? '',\n                    subitems: result.subitems,\n                }\n            }\n            else {\n                if (result.cfi) {\n                    const item = { value: SEARCH_PREFIX + result.cfi }\n                    list.push(item)\n                    this.addAnnotation(item)\n                }\n                yield result\n            }\n        }\n        yield 'done'\n    }\n    clearSearch() {\n        for (const list of this.#searchResults.values())\n            for (const item of list) this.deleteAnnotation(item)\n        this.#searchResults.clear()\n    }\n    async initTTS(granularity = 'word', nodeFilter, highlighter) {\n        const doc = this.renderer.getContents()[0].doc\n        if (this.tts && this.tts.doc === doc) return\n        const { TTS } = await import('./tts.js')\n        this.tts = new TTS(doc, textWalker, nodeFilter, highlighter || (range =>\n            this.renderer.scrollToAnchor(range, true)), granularity)\n    }\n    startMediaOverlay() {\n        const { index } = this.renderer.getContents()[0]\n        return this.mediaOverlay.start(index)\n    }\n}\n\ncustomElements.define('foliate-view', View)\n"],"names":[],"mappings":"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"}}]
}