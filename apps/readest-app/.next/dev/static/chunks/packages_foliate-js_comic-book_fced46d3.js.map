{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/packages/foliate-js/comic-book.js"],"sourcesContent":["export const makeComicBook = async ({ entries, loadBlob, getSize, getComment }, file) => {\n    const cache = new Map()\n    const urls = new Map()\n    const load = async name => {\n        if (cache.has(name)) return cache.get(name)\n        const src = URL.createObjectURL(await loadBlob(name))\n        const page = URL.createObjectURL(\n            new Blob([`<!DOCTYPE html><html><head><meta charset=\"utf-8\"></head><body style=\"margin: 0\"><img src=\"${src}\"></body></html>`], { type: 'text/html' }))\n        urls.set(name, [src, page])\n        cache.set(name, page)\n        return page\n    }\n    const unload = name => {\n        urls.get(name)?.forEach?.(url => URL.revokeObjectURL(url))\n        urls.delete(name)\n        cache.delete(name)\n    }\n\n    const exts = ['.jpg', '.jpeg', '.png', '.gif', '.bmp', '.webp', '.svg', '.jxl', '.avif']\n    const files = entries\n        .map(entry => entry.filename)\n        .filter(name => exts.some(ext => name.endsWith(ext)))\n        .sort()\n    if (!files.length) throw new Error('No supported image files in archive')\n\n    const book = {}\n    try {\n        const jsonComment = JSON.parse(await getComment() || '')\n        const info = jsonComment['ComicBookInfo/1.0']\n        if (info) {\n            const year = info.publicationYear\n            const month = info.publicationMonth\n            const mm = month && month >= 1 && month <= 12 ? String(month).padStart(2, '0') : null\n            book.metadata = {\n                title: info.title || file.name,\n                publisher: info.publisher,\n                language: info.language || info.lang,\n                author: info.credits ? info.credits.map(c => `${c.person} (${c.role})`).join(', ') : '',\n                published: year && month ? `${year}-${mm}` : undefined,\n            }\n        } else {\n            book.metadata = { title: file.name }\n        }\n    } catch {\n        book.metadata = { title: file.name }\n    }\n    book.getCover = () => loadBlob(files[0])\n    book.sections = files.map(name => ({\n        id: name,\n        load: () => load(name),\n        unload: () => unload(name),\n        size: getSize(name),\n    }))\n    book.toc = files.map(name => ({ label: name, href: name }))\n    book.rendition = { layout: 'pre-paginated' }\n    book.resolveHref = href => ({ index: book.sections.findIndex(s => s.id === href) })\n    book.splitTOCHref = href => [href, null]\n    book.getTOCFragment = doc => doc.documentElement\n    book.destroy = () => {\n        for (const arr of urls.values())\n            for (const url of arr) URL.revokeObjectURL(url)\n    }\n    return book\n}\n"],"names":[],"mappings":"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"}}]
}