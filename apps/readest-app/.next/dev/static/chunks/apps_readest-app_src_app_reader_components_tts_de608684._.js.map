{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/app/reader/components/tts/TTSPanel.tsx"],"sourcesContent":["'use client';\n\nimport clsx from 'clsx';\nimport React, { useState, ChangeEvent, useEffect } from 'react';\nimport { MdPlayCircle, MdPauseCircle, MdFastRewind, MdFastForward, MdAlarm } from 'react-icons/md';\nimport { TbChevronCompactDown, TbChevronCompactUp } from 'react-icons/tb';\nimport { RiVoiceAiFill } from 'react-icons/ri';\nimport { MdCheck } from 'react-icons/md';\nimport { TTSVoicesGroup } from '@/services/tts';\nimport { useEnv } from '@/context/EnvContext';\nimport { useReaderStore } from '@/store/readerStore';\nimport { TranslationFunc, useTranslation } from '@/hooks/useTranslation';\nimport { useSettingsStore } from '@/store/settingsStore';\nimport { useDefaultIconSize, useResponsiveSize } from '@/hooks/useResponsiveSize';\nimport { getLanguageName } from '@/utils/lang';\n\ntype TTSPanelProps = {\n  bookKey: string;\n  ttsLang: string;\n  isPlaying: boolean;\n  timeoutOption: number;\n  timeoutTimestamp: number;\n  onTogglePlay: () => void;\n  onBackward: () => void;\n  onForward: () => void;\n  onSetRate: (rate: number) => void;\n  onGetVoices: (lang: string) => Promise<TTSVoicesGroup[]>;\n  onSetVoice: (voice: string, lang: string) => void;\n  onGetVoiceId: () => string;\n  onSelectTimeout: (bookKey: string, value: number) => void;\n  onToogleTTSBar: () => void;\n};\n\nconst getTTSTimeoutOptions = (_: TranslationFunc) => {\n  return [\n    {\n      label: _('No Timeout'),\n      value: 0,\n    },\n    {\n      label: _('{{value}} minute', { value: 1 }),\n      value: 60,\n    },\n    {\n      label: _('{{value}} minutes', { value: 3 }),\n      value: 180,\n    },\n    {\n      label: _('{{value}} minutes', { value: 5 }),\n      value: 300,\n    },\n    {\n      label: _('{{value}} minutes', { value: 10 }),\n      value: 600,\n    },\n    {\n      label: _('{{value}} minutes', { value: 20 }),\n      value: 1200,\n    },\n    {\n      label: _('{{value}} minutes', { value: 30 }),\n      value: 1800,\n    },\n    {\n      label: _('{{value}} minutes', { value: 45 }),\n      value: 2700,\n    },\n    {\n      label: _('{{value}} hour', { value: 1 }),\n      value: 3600,\n    },\n    {\n      label: _('{{value}} hours', { value: 2 }),\n      value: 7200,\n    },\n    {\n      label: _('{{value}} hours', { value: 3 }),\n      value: 10800,\n    },\n    {\n      label: _('{{value}} hours', { value: 4 }),\n      value: 14400,\n    },\n    {\n      label: _('{{value}} hours', { value: 6 }),\n      value: 21600,\n    },\n    {\n      label: _('{{value}} hours', { value: 8 }),\n      value: 28800,\n    },\n  ];\n};\n\nconst getCountdownTime = (timeout: number) => {\n  const now = Date.now();\n  if (timeout > now) {\n    const remainingTime = Math.floor((timeout - now) / 1000);\n    const minutes = Math.floor(remainingTime / 3600) * 60 + Math.floor((remainingTime % 3600) / 60);\n    const seconds = remainingTime % 60;\n    return `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;\n  }\n  return '';\n};\n\nconst TTSPanel = ({\n  bookKey,\n  ttsLang,\n  isPlaying,\n  timeoutOption,\n  timeoutTimestamp,\n  onTogglePlay,\n  onBackward,\n  onForward,\n  onSetRate,\n  onGetVoices,\n  onSetVoice,\n  onGetVoiceId,\n  onSelectTimeout,\n  onToogleTTSBar,\n}: TTSPanelProps) => {\n  const _ = useTranslation();\n  const { envConfig } = useEnv();\n  const { getViewSettings, setViewSettings } = useReaderStore();\n  const { settings, setSettings, saveSettings } = useSettingsStore();\n  const viewSettings = getViewSettings(bookKey);\n\n  const [voiceGroups, setVoiceGroups] = useState<TTSVoicesGroup[]>([]);\n  const [rate, setRate] = useState(viewSettings?.ttsRate ?? 1.0);\n  const [selectedVoice, setSelectedVoice] = useState(viewSettings?.ttsVoice ?? '');\n\n  const [timeoutCountdown, setTimeoutCountdown] = useState(() => {\n    return getCountdownTime(timeoutTimestamp);\n  });\n\n  const defaultIconSize = useDefaultIconSize();\n  const iconSize32 = useResponsiveSize(32);\n  const iconSize48 = useResponsiveSize(48);\n\n  const handleSetRate = (e: ChangeEvent<HTMLInputElement>) => {\n    let newRate = parseFloat(e.target.value);\n    newRate = Math.max(0.2, Math.min(3.0, newRate));\n    setRate(newRate);\n    onSetRate(newRate);\n    const viewSettings = getViewSettings(bookKey)!;\n    viewSettings.ttsRate = newRate;\n    settings.globalViewSettings.ttsRate = newRate;\n    setViewSettings(bookKey, viewSettings);\n    setSettings(settings);\n    saveSettings(envConfig, settings);\n  };\n\n  const handleSelectVoice = (voice: string, lang: string) => {\n    onSetVoice(voice, lang);\n    setSelectedVoice(voice);\n    const viewSettings = getViewSettings(bookKey)!;\n    viewSettings.ttsVoice = voice;\n    setViewSettings(bookKey, viewSettings);\n  };\n\n  const updateTimeout = (timeout: number) => {\n    const now = Date.now();\n    if (timeout > 0 && timeout < now) {\n      onSelectTimeout(bookKey, 0);\n      setTimeoutCountdown('');\n    } else if (timeout > 0) {\n      setTimeoutCountdown(getCountdownTime(timeout));\n    }\n  };\n\n  useEffect(() => {\n    setTimeout(() => {\n      updateTimeout(timeoutTimestamp);\n    }, 1000);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [timeoutTimestamp, timeoutCountdown]);\n\n  useEffect(() => {\n    const voiceId = onGetVoiceId();\n    setSelectedVoice(voiceId);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  useEffect(() => {\n    const fetchVoices = async () => {\n      const voiceGroups = await onGetVoices(ttsLang);\n      const voicesCount = voiceGroups.reduce((acc, group) => acc + group.voices.length, 0);\n      if (!voiceGroups || voicesCount === 0) {\n        console.warn('No voices found for TTSPanel');\n        setVoiceGroups([\n          {\n            id: 'no-voices',\n            name: _('Voices for {{lang}}', { lang: getLanguageName(ttsLang) }),\n            voices: [],\n          },\n        ]);\n      } else {\n        setVoiceGroups(voiceGroups);\n      }\n    };\n    fetchVoices();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [ttsLang]);\n\n  const timeoutOptions = getTTSTimeoutOptions(_);\n\n  return (\n    <div className='flex w-full flex-col items-center justify-center gap-2 rounded-2xl px-4 pt-4 sm:gap-1'>\n      <div className='flex w-full flex-col items-center gap-0.5'>\n        <input\n          className='range'\n          type='range'\n          min={0.0}\n          max={3.0}\n          step='0.1'\n          value={rate}\n          onChange={handleSetRate}\n        />\n        <div className='grid w-full grid-cols-7 text-xs'>\n          <span className='text-center'>|</span>\n          <span className='text-center'>|</span>\n          <span className='text-center'>|</span>\n          <span className='text-center'>|</span>\n          <span className='text-center'>|</span>\n          <span className='text-center'>|</span>\n          <span className='text-center'>|</span>\n        </div>\n        <div className='grid w-full grid-cols-7 text-xs'>\n          <span className='text-center'>{_('Slow')}</span>\n          <span className='text-center'></span>\n          <span className='text-center'>1.0</span>\n          <span className='text-center'>1.5</span>\n          <span className='text-center'>2.0</span>\n          <span className='text-center'></span>\n          <span className='text-center'>{_('Fast')}</span>\n        </div>\n      </div>\n      <div className='flex items-center justify-between space-x-2'>\n        <button\n          onClick={() => onBackward()}\n          className='rounded-full p-1 transition-transform duration-200 hover:scale-105'\n          title={_('Previous Paragraph')}\n          aria-label={_('Previous Paragraph')}\n        >\n          <MdFastRewind size={iconSize32} />\n        </button>\n        <button\n          onClick={onTogglePlay}\n          className='rounded-full p-1 transition-transform duration-200 hover:scale-105'\n          title={isPlaying ? _('Pause') : _('Play')}\n          aria-label={isPlaying ? _('Pause') : _('Play')}\n        >\n          {isPlaying ? (\n            <MdPauseCircle size={iconSize48} className='fill-primary' />\n          ) : (\n            <MdPlayCircle size={iconSize48} className='fill-primary' />\n          )}\n        </button>\n        <button\n          onClick={() => onForward()}\n          className='rounded-full p-1 transition-transform duration-200 hover:scale-105'\n          title={_('Next Paragraph')}\n          aria-label={_('Next Paragraph')}\n        >\n          <MdFastForward size={iconSize32} />\n        </button>\n        <div className='dropdown dropdown-top'>\n          <button\n            tabIndex={0}\n            className='flex flex-col items-center justify-center rounded-full p-1 transition-transform duration-200 hover:scale-105'\n            onClick={(e) => e.currentTarget.focus()}\n            title={_('Set Timeout')}\n            aria-label={_('Set Timeout')}\n          >\n            <MdAlarm size={iconSize32} />\n            {timeoutCountdown && (\n              <span\n                className={clsx(\n                  'absolute bottom-0 left-1/2 w-12 translate-x-[-50%] translate-y-[80%] px-1',\n                  'bg-primary/80 text-base-100 rounded-full text-center text-xs',\n                )}\n              >\n                {timeoutCountdown}\n              </span>\n            )}\n          </button>\n          <ul\n            // eslint-disable-next-line jsx-a11y/no-noninteractive-tabindex\n            tabIndex={0}\n            className={clsx(\n              'dropdown-content bgcolor-base-200 no-triangle menu menu-vertical rounded-box absolute right-0 z-[1] shadow',\n              'mt-4 inline max-h-96 w-[200px] overflow-y-scroll',\n            )}\n          >\n            {timeoutOptions.map((option, index) => (\n              // eslint-disable-next-line jsx-a11y/click-events-have-key-events, jsx-a11y/no-noninteractive-element-interactions\n              <li\n                key={`${index}-${option.value}`}\n                onClick={() => onSelectTimeout(bookKey, option.value)}\n              >\n                <div className='flex items-center px-2'>\n                  <span\n                    style={{\n                      width: `${defaultIconSize}px`,\n                      height: `${defaultIconSize}px`,\n                    }}\n                  >\n                    {timeoutOption === option.value && <MdCheck className='text-base-content' />}\n                  </span>\n                  <span className={clsx('text-base sm:text-sm')}>{option.label}</span>\n                </div>\n              </li>\n            ))}\n          </ul>\n        </div>\n\n        <div className='dropdown dropdown-top'>\n          <button\n            tabIndex={0}\n            className='rounded-full p-1 transition-transform duration-200 hover:scale-105'\n            onClick={(e) => e.currentTarget.focus()}\n          >\n            <RiVoiceAiFill size={iconSize32} />\n          </button>\n          <ul\n            // eslint-disable-next-line jsx-a11y/no-noninteractive-tabindex\n            tabIndex={0}\n            className={clsx(\n              'dropdown-content bgcolor-base-200 no-triangle menu menu-vertical rounded-box absolute right-0 z-[1] shadow',\n              'mt-4 inline max-h-96 w-[250px] overflow-y-scroll',\n            )}\n            title={_('Select Voice')}\n            aria-label={_('Select Voice')}\n          >\n            {voiceGroups.map((voiceGroup, index) => {\n              return (\n                <div key={voiceGroup.id} className=''>\n                  <div className='flex items-center gap-2 px-2 py-1'>\n                    <span\n                      style={{ width: `${defaultIconSize}px`, height: `${defaultIconSize}px` }}\n                    ></span>\n                    <span className='text-sm text-gray-400 sm:text-xs'>\n                      {_('{{engine}}: {{count}} voices', {\n                        engine: _(voiceGroup.name),\n                        count: voiceGroup.voices.length,\n                      })}\n                    </span>\n                  </div>\n                  {voiceGroup.voices.map((voice, voiceIndex) => (\n                    // eslint-disable-next-line jsx-a11y/click-events-have-key-events, jsx-a11y/no-noninteractive-element-interactions\n                    <li\n                      key={`${index}-${voiceGroup.id}-${voiceIndex}`}\n                      onClick={() => !voice.disabled && handleSelectVoice(voice.id, voice.lang)}\n                    >\n                      <div className='flex items-center px-2'>\n                        <span\n                          style={{\n                            width: `${defaultIconSize}px`,\n                            height: `${defaultIconSize}px`,\n                          }}\n                        >\n                          {selectedVoice === voice.id && <MdCheck className='text-base-content' />}\n                        </span>\n                        <span\n                          className={clsx(\n                            'max-w-[180px] overflow-hidden text-ellipsis text-base sm:text-sm',\n                            voice.disabled && 'text-gray-400',\n                          )}\n                        >\n                          {_(voice.name)}\n                        </span>\n                      </div>\n                    </li>\n                  ))}\n                </div>\n              );\n            })}\n          </ul>\n        </div>\n      </div>\n      <div className='flex h-4 items-center justify-center opacity-60 transition-transform duration-200 hover:scale-105 hover:opacity-100'>\n        <button\n          onClick={onToogleTTSBar}\n          className='p-0'\n          title={_('Toggle Sticky Bottom TTS Bar')}\n          aria-label={_('Toggle Sticky Bottom TTS Bar')}\n        >\n          {viewSettings?.showTTSBar ? (\n            <TbChevronCompactUp size={iconSize48} style={{ transform: 'scaleY(0.85)' }} />\n          ) : (\n            <TbChevronCompactDown size={iconSize48} style={{ transform: 'scaleY(0.85)' }} />\n          )}\n        </button>\n      </div>\n    </div>\n  );\n};\n\nexport default TTSPanel;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 721, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/app/reader/components/tts/TTSIcon.tsx"],"sourcesContent":["import clsx from 'clsx';\nimport React from 'react';\n\ntype TTSIconProps = {\n  isPlaying: boolean;\n  ttsInited: boolean;\n  onClick: () => void;\n};\n\nconst TTSIcon: React.FC<TTSIconProps> = ({ isPlaying, ttsInited, onClick }) => {\n  const bars = [1, 2, 3, 4];\n\n  return (\n    <button\n      className={clsx(\n        'relative h-full w-full rounded-full',\n        ttsInited ? 'cursor-pointer' : 'cursor-not-allowed',\n      )}\n      style={{\n        maskImage: 'radial-gradient(circle, white 100%, transparent 100%)',\n        WebkitMaskImage: 'radial-gradient(circle, white 100%, transparent 100%)',\n      }}\n      onClick={onClick}\n    >\n      <div className='absolute inset-0 overflow-hidden rounded-full bg-gradient-to-r from-blue-500 via-emerald-500 to-violet-500'>\n        <div\n          className='absolute -inset-full rounded-full bg-gradient-to-r from-blue-500 via-emerald-500 to-violet-500'\n          style={{\n            animation: isPlaying && ttsInited ? 'moveGradient 2s alternate infinite' : 'none',\n          }}\n        />\n      </div>\n\n      <div className='absolute inset-0 flex items-center justify-center'>\n        <style>{`\n          @keyframes moveGradient {\n            0% { transform: translate(0, 0); }\n            100% { transform: translate(25%, 25%); }\n          }\n          @keyframes bounce {\n            0%, 100% { transform: scaleY(1); }\n            50% { transform: scaleY(0.6); }\n          }\n        `}</style>\n        <div className='flex items-end space-x-1'>\n          {bars.map((bar) => (\n            <div\n              key={bar}\n              className='w-1 rounded-t bg-white'\n              style={{\n                height: '16px',\n                animationName: isPlaying ? 'bounce' : 'none',\n                animationDuration: isPlaying ? `${1 + bar * 0.1}s` : '0s',\n                animationTimingFunction: 'ease-in-out',\n                animationIterationCount: 'infinite',\n                animationDelay: `${bar * 0.1}s`,\n              }}\n            />\n          ))}\n        </div>\n      </div>\n    </button>\n  );\n};\n\nexport default TTSIcon;\n"],"names":[],"mappings":";;;;;AAAA;;;AASA,MAAM,UAAkC,CAAC,EAAE,SAAS,EAAE,SAAS,EAAE,OAAO,EAAE;IACxE,MAAM,OAAO;QAAC;QAAG;QAAG;QAAG;KAAE;IAEzB,qBACE,6MAAC;QACC,WAAW,IAAA,6LAAI,EACb,uCACA,YAAY,mBAAmB;QAEjC,OAAO;YACL,WAAW;YACX,iBAAiB;QACnB;QACA,SAAS;;0BAET,6MAAC;gBAAI,WAAU;0BACb,cAAA,6MAAC;oBACC,WAAU;oBACV,OAAO;wBACL,WAAW,aAAa,YAAY,uCAAuC;oBAC7E;;;;;;;;;;;0BAIJ,6MAAC;gBAAI,WAAU;;kCACb,6MAAC;kCAAO,CAAC;;;;;;;;;QAST,CAAC;;;;;;kCACD,6MAAC;wBAAI,WAAU;kCACZ,KAAK,GAAG,CAAC,CAAC,oBACT,6MAAC;gCAEC,WAAU;gCACV,OAAO;oCACL,QAAQ;oCACR,eAAe,YAAY,WAAW;oCACtC,mBAAmB,YAAY,GAAG,IAAI,MAAM,IAAI,CAAC,CAAC,GAAG;oCACrD,yBAAyB;oCACzB,yBAAyB;oCACzB,gBAAgB,GAAG,MAAM,IAAI,CAAC,CAAC;gCACjC;+BATK;;;;;;;;;;;;;;;;;;;;;;AAgBnB;KAtDM;uCAwDS"}},
    {"offset": {"line": 826, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/app/reader/components/tts/TTSBar.tsx"],"sourcesContent":["import clsx from 'clsx';\nimport React from 'react';\nimport {\n  MdPlayArrow,\n  MdOutlinePause,\n  MdFastRewind,\n  MdFastForward,\n  MdSkipPrevious,\n  MdSkipNext,\n} from 'react-icons/md';\nimport { Insets } from '@/types/misc';\nimport { useEnv } from '@/context/EnvContext';\nimport { useReaderStore } from '@/store/readerStore';\nimport { useResponsiveSize } from '@/hooks/useResponsiveSize';\nimport { useTranslation } from '@/hooks/useTranslation';\n\ntype TTSBarProps = {\n  bookKey: string;\n  isPlaying: boolean;\n  onTogglePlay: () => void;\n  onBackward: (byMark: boolean) => void;\n  onForward: (byMark: boolean) => void;\n  gridInsets: Insets;\n};\n\nconst TTSBar = ({\n  bookKey,\n  isPlaying,\n  onTogglePlay,\n  onBackward,\n  onForward,\n  gridInsets,\n}: TTSBarProps) => {\n  const _ = useTranslation();\n  const { appService } = useEnv();\n  const { hoveredBookKey, setHoveredBookKey } = useReaderStore();\n  const iconSize32 = useResponsiveSize(30);\n  const iconSize48 = useResponsiveSize(36);\n\n  const isVisible = hoveredBookKey !== bookKey;\n\n  return (\n    <div\n      className={clsx(\n        'bg-base-100 absolute bottom-0 z-40',\n        'inset-x-0 mx-auto flex w-full justify-center sm:w-fit',\n        'transition-opacity duration-300',\n        isVisible ? `pointer-events-auto opacity-100` : `pointer-events-none opacity-0`,\n      )}\n      style={{ paddingBottom: appService?.hasSafeAreaInset ? `${gridInsets.bottom * 0.33}px` : 0 }}\n      onMouseEnter={() => !appService?.isMobile && setHoveredBookKey('')}\n      onTouchStart={() => !appService?.isMobile && setHoveredBookKey('')}\n    >\n      <div className='text-base-content flex h-[52px] items-center space-x-2 px-2'>\n        <button\n          onClick={onBackward.bind(null, false)}\n          className='rounded-full p-1 transition-transform duration-200 hover:scale-105'\n          title={_('Previous Paragraph')}\n          aria-label={_('Previous Paragraph')}\n        >\n          <MdFastRewind size={iconSize32} />\n        </button>\n        <button\n          onClick={onBackward.bind(null, true)}\n          className='rounded-full p-1 transition-transform duration-200 hover:scale-105'\n          title={_('Previous Sentence')}\n          aria-label={_('Previous Sentence')}\n        >\n          <MdSkipPrevious size={iconSize32} />\n        </button>\n        <button\n          onClick={onTogglePlay}\n          className='rounded-full p-1 transition-transform duration-200 hover:scale-105'\n          title={isPlaying ? _('Pause') : _('Play')}\n          aria-label={isPlaying ? _('Pause') : _('Play')}\n        >\n          {isPlaying ? <MdOutlinePause size={iconSize48} /> : <MdPlayArrow size={iconSize48} />}\n        </button>\n        <button\n          onClick={onForward.bind(null, true)}\n          className='rounded-full p-1 transition-transform duration-200 hover:scale-105'\n          title={_('Next Sentence')}\n          aria-label={_('Next Sentence')}\n        >\n          <MdSkipNext size={iconSize32} />\n        </button>\n        <button\n          onClick={onForward.bind(null, false)}\n          className='rounded-full p-1 transition-transform duration-200 hover:scale-105'\n          title={_('Next Paragraph')}\n          aria-label={_('Next Paragraph')}\n        >\n          <MdFastForward size={iconSize32} />\n        </button>\n      </div>\n    </div>\n  );\n};\n\nexport default TTSBar;\n"],"names":[],"mappings":";;;;;AAAA;AAEA;AASA;AACA;AACA;AACA;;;;;;;;;AAWA,MAAM,SAAS,CAAC,EACd,OAAO,EACP,SAAS,EACT,YAAY,EACZ,UAAU,EACV,SAAS,EACT,UAAU,EACE;;IACZ,MAAM,IAAI,IAAA,sKAAc;IACxB,MAAM,EAAE,UAAU,EAAE,GAAG,IAAA,6JAAM;IAC7B,MAAM,EAAE,cAAc,EAAE,iBAAiB,EAAE,GAAG,IAAA,mKAAc;IAC5D,MAAM,aAAa,IAAA,4KAAiB,EAAC;IACrC,MAAM,aAAa,IAAA,4KAAiB,EAAC;IAErC,MAAM,YAAY,mBAAmB;IAErC,qBACE,6MAAC;QACC,WAAW,IAAA,6LAAI,EACb,sCACA,yDACA,mCACA,YAAY,CAAC,+BAA+B,CAAC,GAAG,CAAC,6BAA6B,CAAC;QAEjF,OAAO;YAAE,eAAe,YAAY,mBAAmB,GAAG,WAAW,MAAM,GAAG,KAAK,EAAE,CAAC,GAAG;QAAE;QAC3F,cAAc,IAAM,CAAC,YAAY,YAAY,kBAAkB;QAC/D,cAAc,IAAM,CAAC,YAAY,YAAY,kBAAkB;kBAE/D,cAAA,6MAAC;YAAI,WAAU;;8BACb,6MAAC;oBACC,SAAS,WAAW,IAAI,CAAC,MAAM;oBAC/B,WAAU;oBACV,OAAO,EAAE;oBACT,cAAY,EAAE;8BAEd,cAAA,6MAAC,2OAAY;wBAAC,MAAM;;;;;;;;;;;8BAEtB,6MAAC;oBACC,SAAS,WAAW,IAAI,CAAC,MAAM;oBAC/B,WAAU;oBACV,OAAO,EAAE;oBACT,cAAY,EAAE;8BAEd,cAAA,6MAAC,6OAAc;wBAAC,MAAM;;;;;;;;;;;8BAExB,6MAAC;oBACC,SAAS;oBACT,WAAU;oBACV,OAAO,YAAY,EAAE,WAAW,EAAE;oBAClC,cAAY,YAAY,EAAE,WAAW,EAAE;8BAEtC,0BAAY,6MAAC,6OAAc;wBAAC,MAAM;;;;;iFAAiB,6MAAC,0OAAW;wBAAC,MAAM;;;;;;;;;;;8BAEzE,6MAAC;oBACC,SAAS,UAAU,IAAI,CAAC,MAAM;oBAC9B,WAAU;oBACV,OAAO,EAAE;oBACT,cAAY,EAAE;8BAEd,cAAA,6MAAC,yOAAU;wBAAC,MAAM;;;;;;;;;;;8BAEpB,6MAAC;oBACC,SAAS,UAAU,IAAI,CAAC,MAAM;oBAC9B,WAAU;oBACV,OAAO,EAAE;oBACT,cAAY,EAAE;8BAEd,cAAA,6MAAC,4OAAa;wBAAC,MAAM;;;;;;;;;;;;;;;;;;;;;;AAK/B;GAxEM;;QAQM,sKAAc;QACD,6JAAM;QACiB,mKAAc;QACzC,4KAAiB;QACjB,4KAAiB;;;KAZhC;uCA0ES"}},
    {"offset": {"line": 986, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/app/reader/components/tts/TTSControl.tsx"],"sourcesContent":["'use client';\n\nimport clsx from 'clsx';\nimport React, { useState, useRef, useEffect, useCallback, useMemo } from 'react';\nimport { useEnv } from '@/context/EnvContext';\nimport { useAuth } from '@/context/AuthContext';\nimport { useThemeStore } from '@/store/themeStore';\nimport { useSettingsStore } from '@/store/settingsStore';\nimport { useBookDataStore } from '@/store/bookDataStore';\nimport { useReaderStore } from '@/store/readerStore';\nimport { useProofreadStore } from '@/store/proofreadStore';\nimport { TransformContext } from '@/services/transformers/types';\nimport { proofreadTransformer } from '@/services/transformers/proofread';\nimport { useTranslation } from '@/hooks/useTranslation';\nimport { useResponsiveSize } from '@/hooks/useResponsiveSize';\nimport { TTSController, SILENCE_DATA, TTSMark, TTSHighlightOptions } from '@/services/tts';\nimport { getMediaSession, TauriMediaSession } from '@/libs/mediaSession';\nimport { getPopupPosition, Position } from '@/utils/sel';\nimport { eventDispatcher } from '@/utils/event';\nimport { parseSSMLLang } from '@/utils/ssml';\nimport { throttle } from '@/utils/throttle';\nimport { Insets } from '@/types/misc';\nimport { Overlay } from '@/components/Overlay';\nimport { fetchImageAsBase64 } from '@/utils/image';\nimport { invokeUseBackgroundAudio } from '@/utils/bridge';\nimport { isCfiInLocation } from '@/utils/cfi';\nimport { getLocale } from '@/utils/misc';\nimport Popup from '@/components/Popup';\nimport TTSPanel from './TTSPanel';\nimport TTSIcon from './TTSIcon';\nimport TTSBar from './TTSBar';\n\nconst POPUP_WIDTH = 282;\nconst POPUP_HEIGHT = 160;\nconst POPUP_PADDING = 10;\n\ninterface TTSControlProps {\n  bookKey: string;\n  gridInsets: Insets;\n}\n\nconst TTSControl: React.FC<TTSControlProps> = ({ bookKey, gridInsets }) => {\n  const _ = useTranslation();\n  const { appService } = useEnv();\n  const { user } = useAuth();\n  const { safeAreaInsets, isDarkMode } = useThemeStore();\n  const { settings } = useSettingsStore();\n  const { getBookData } = useBookDataStore();\n  const { hoveredBookKey, getView, getProgress, getViewSettings } = useReaderStore();\n  const { setViewSettings, setTTSEnabled } = useReaderStore();\n  const { getMergedRules } = useProofreadStore();\n  const viewSettings = getViewSettings(bookKey);\n  const [ttsLang, setTtsLang] = useState<string>('en');\n  const [isPlaying, setIsPlaying] = useState(false);\n  const [isPaused, setIsPaused] = useState(false);\n  const [showIndicator, setShowIndicator] = useState(false);\n  const [showPanel, setShowPanel] = useState(false);\n  const [showTTSBar, setShowTTSBar] = useState(() => !!viewSettings?.showTTSBar);\n  const [panelPosition, setPanelPosition] = useState<Position>();\n  const [trianglePosition, setTrianglePosition] = useState<Position>();\n\n  const [timeoutOption, setTimeoutOption] = useState(0);\n  const [timeoutTimestamp, setTimeoutTimestamp] = useState(0);\n  const [timeoutFunc, setTimeoutFunc] = useState<ReturnType<typeof setTimeout> | null>(null);\n\n  const hoverTimeoutRef = useRef<ReturnType<typeof setTimeout> | null>(null);\n  const [showIndicatorWithinTimeout, setShowIndicatorWithinTimeout] = useState(true);\n\n  const popupPadding = useResponsiveSize(POPUP_PADDING);\n  const maxWidth = window.innerWidth - 2 * popupPadding;\n  const popupWidth = Math.min(maxWidth, useResponsiveSize(POPUP_WIDTH));\n  const popupHeight = useResponsiveSize(POPUP_HEIGHT);\n\n  const iconRef = useRef<HTMLDivElement>(null);\n  const unblockerAudioRef = useRef<HTMLAudioElement | null>(null);\n  const ttsControllerRef = useRef<TTSController | null>(null);\n  const mediaSessionRef = useRef<TauriMediaSession | MediaSession | null>(null);\n  const [ttsController, setTtsController] = useState<TTSController | null>(null);\n  const [ttsClientsInited, setTtsClientsInitialized] = useState(false);\n\n  // this enables WebAudio to play even when the mute toggle switch is ON\n  const unblockAudio = () => {\n    if (unblockerAudioRef.current) return;\n    unblockerAudioRef.current = document.createElement('audio');\n    unblockerAudioRef.current.setAttribute('x-webkit-airplay', 'deny');\n    unblockerAudioRef.current.addEventListener('play', () => {\n      if ('mediaSession' in navigator) {\n        navigator.mediaSession.metadata = null;\n      }\n    });\n    unblockerAudioRef.current.preload = 'auto';\n    unblockerAudioRef.current.loop = true;\n    unblockerAudioRef.current.src = SILENCE_DATA;\n    unblockerAudioRef.current.play();\n  };\n\n  const releaseUnblockAudio = () => {\n    if (!unblockerAudioRef.current) return;\n    try {\n      unblockerAudioRef.current.pause();\n      unblockerAudioRef.current.currentTime = 0;\n      unblockerAudioRef.current.removeAttribute('src');\n      unblockerAudioRef.current.src = '';\n      unblockerAudioRef.current.load();\n      unblockerAudioRef.current = null;\n      console.log('Unblock audio released');\n    } catch (err) {\n      console.warn('Error releasing unblock audio:', err);\n    }\n  };\n\n  const initMediaSession = async () => {\n    const mediaSession = getMediaSession();\n    if (!mediaSession) return;\n\n    mediaSessionRef.current = mediaSession;\n\n    if (mediaSession instanceof TauriMediaSession) {\n      const bookData = getBookData(bookKey);\n      const progress = getProgress(bookKey);\n      if (!bookData || !bookData.book) return;\n      const { title, author, coverImageUrl } = bookData.book;\n      const { sectionLabel } = progress || {};\n\n      let artworkImage = '/icon.png';\n      try {\n        artworkImage = await fetchImageAsBase64(coverImageUrl || '/icon.png');\n      } catch {\n        artworkImage = await fetchImageAsBase64('/icon.png');\n      }\n\n      await mediaSession.setActive({\n        active: true,\n        keepAppInForeground: settings.alwaysInForeground,\n        notificationTitle: _('Read Aloud'),\n        notificationText: _('Ready to read aloud'),\n        foregroundServiceTitle: _('Read Aloud'),\n        foregroundServiceText: _('Ready to read aloud'),\n      });\n      mediaSession.updateMetadata({\n        title: title,\n        artist: sectionLabel || title,\n        album: author,\n        artwork: artworkImage,\n      });\n    }\n  };\n\n  const deinitMediaSession = async () => {\n    if (mediaSessionRef.current && mediaSessionRef.current instanceof TauriMediaSession) {\n      await mediaSessionRef.current.setActive({\n        active: false,\n        keepAppInForeground: settings.alwaysInForeground,\n      });\n    }\n    mediaSessionRef.current = null;\n  };\n\n  useEffect(() => {\n    return () => {\n      if (ttsControllerRef.current) {\n        ttsControllerRef.current.shutdown();\n        ttsControllerRef.current = null;\n      }\n    };\n  }, []);\n\n  useEffect(() => {\n    eventDispatcher.on('tts-speak', handleTTSSpeak);\n    eventDispatcher.on('tts-stop', handleTTSStop);\n    return () => {\n      eventDispatcher.off('tts-speak', handleTTSSpeak);\n      eventDispatcher.off('tts-stop', handleTTSStop);\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  useEffect(() => {\n    if (!ttsController || !bookKey) return;\n    const bookData = getBookData(bookKey);\n    if (!bookData || !bookData.book) return;\n    const { title, author, coverImageUrl } = bookData.book;\n\n    const handleNeedAuth = () => {\n      eventDispatcher.dispatch('toast', {\n        message: _('Please log in to use advanced TTS features'),\n        type: 'error',\n        timeout: 5000,\n      });\n    };\n\n    const handleSpeakMark = (e: Event) => {\n      const progress = getProgress(bookKey);\n      const { sectionLabel } = progress || {};\n      const mark = (e as CustomEvent<TTSMark>).detail;\n\n      if (mediaSessionRef.current) {\n        const mediaSession = mediaSessionRef.current;\n        if (mediaSession instanceof TauriMediaSession) {\n          mediaSession.updateMetadata({\n            title: mark?.text || '',\n            artist: sectionLabel || title,\n            album: author,\n            artwork: '',\n          });\n        } else {\n          mediaSession.metadata = new MediaMetadata({\n            title: mark?.text || '',\n            artist: sectionLabel || title,\n            album: author,\n            artwork: [{ src: coverImageUrl || '/icon.png', sizes: '512x512', type: 'image/png' }],\n          });\n        }\n      }\n    };\n\n    const handleHighlightMark = (e: Event) => {\n      const range = (e as CustomEvent<Range>).detail;\n      const view = getView(bookKey);\n      const progress = getProgress(bookKey);\n      const viewSettings = getViewSettings(bookKey);\n      if (!range || !view || !progress || !viewSettings) return;\n\n      const { location } = progress;\n      const { index } = view.resolveCFI(location);\n      const cfi = view?.getCFI(index, range);\n      if (cfi) {\n        viewSettings.ttsLocation = cfi || '';\n        setViewSettings(bookKey, viewSettings);\n      }\n\n      const docs = view.renderer.getContents();\n      if (docs.some(({ doc }) => (doc.getSelection()?.toString().length ?? 0) > 0)) {\n        return;\n      }\n\n      if (!view.renderer.scrolled) {\n        view.renderer.scrollToAnchor(range);\n      } else {\n        const rect = range.getBoundingClientRect();\n        const { start, size, viewSize, sideProp } = view.renderer;\n        const positionStart = rect[sideProp === 'height' ? 'y' : 'x'] + viewSettings.marginTopPx;\n        const positionEnd = rect[sideProp === 'height' ? 'height' : 'width'] + positionStart;\n        const offsetStart = view.book.dir === 'rtl' ? viewSize - positionStart : positionStart;\n        const offsetEnd = view.book.dir === 'rtl' ? viewSize - positionEnd : positionEnd;\n\n        const showHeader = viewSettings.showHeader;\n        const showFooter = viewSettings.showFooter;\n        const showBarsOnScroll = viewSettings.showBarsOnScroll;\n        const headerScrollOverlap = showHeader && showBarsOnScroll ? 44 : 0;\n        const footerScrollOverlap = showFooter && showBarsOnScroll ? 44 : 0;\n        const scrollingOverlap = viewSettings.scrollingOverlap;\n        const endInNextView = offsetEnd > start + size - footerScrollOverlap - scrollingOverlap;\n        const startInPrevView = offsetStart < start + headerScrollOverlap + scrollingOverlap;\n        if (endInNextView || startInPrevView) {\n          const scrollTo = offsetStart - headerScrollOverlap - scrollingOverlap;\n          view.renderer.scrollToAnchor(scrollTo / viewSize);\n        }\n      }\n    };\n\n    ttsController.addEventListener('tts-need-auth', handleNeedAuth);\n    ttsController.addEventListener('tts-speak-mark', handleSpeakMark);\n    ttsController.addEventListener('tts-highlight-mark', handleHighlightMark);\n    return () => {\n      ttsController.removeEventListener('tts-need-auth', handleNeedAuth);\n      ttsController.removeEventListener('tts-speak-mark', handleSpeakMark);\n      ttsController.removeEventListener('tts-highlight-mark', handleHighlightMark);\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [ttsController, bookKey]);\n\n  const getTTSTargetLang = useCallback((): string | null => {\n    const ttsReadAloudText = viewSettings?.ttsReadAloudText;\n    if (viewSettings?.translationEnabled && ttsReadAloudText === 'translated') {\n      return viewSettings?.translateTargetLang || getLocale();\n    } else if (viewSettings?.translationEnabled && ttsReadAloudText === 'source') {\n      const bookData = getBookData(bookKey);\n      return bookData?.book?.primaryLanguage || '';\n    }\n    return null;\n  }, [\n    bookKey,\n    getBookData,\n    viewSettings?.translationEnabled,\n    viewSettings?.ttsReadAloudText,\n    viewSettings?.translateTargetLang,\n  ]);\n\n  useEffect(() => {\n    ttsControllerRef.current?.setTargetLang(getTTSTargetLang() || '');\n  }, [getTTSTargetLang]);\n\n  const transformCtx: TransformContext = useMemo(\n    () => ({\n      bookKey,\n      viewSettings: getViewSettings(bookKey)!,\n      userLocale: getLocale(),\n      content: '',\n      transformers: [],\n      reversePunctuationTransform: true,\n    }),\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    [],\n  );\n\n  const preprocessSSMLForTTS = useCallback(\n    async (ssml: string) => {\n      const rules = getMergedRules(bookKey);\n      const viewSettings = getViewSettings(bookKey)!;\n      const ttsOnlyRules = rules.filter(\n        (rule) =>\n          rule.enabled && rule.onlyForTTS && (rule.scope === 'book' || rule.scope === 'library'),\n      );\n      if (ttsOnlyRules.length === 0) return ssml;\n\n      transformCtx['content'] = ssml;\n      transformCtx['viewSettings'] = viewSettings;\n      ssml = await proofreadTransformer.transform(transformCtx, {\n        docType: 'text/xml',\n        onlyForTTS: true,\n      });\n      return ssml;\n    },\n    [bookKey, getMergedRules, getViewSettings, transformCtx],\n  );\n\n  const getTTSHighlightOptions = useCallback(\n    (ttsHighlightOptions: TTSHighlightOptions, isEink: boolean) => {\n      const einkBgColor = isDarkMode ? '#000000' : '#ffffff';\n      const color = isEink ? einkBgColor : ttsHighlightOptions.color;\n      return {\n        ...ttsHighlightOptions,\n        color,\n      };\n    },\n    [isDarkMode],\n  );\n\n  useEffect(() => {\n    const ttsHighlightOptions = viewSettings?.ttsHighlightOptions;\n    if (ttsControllerRef.current && ttsHighlightOptions) {\n      ttsControllerRef.current.initViewTTS(\n        getTTSHighlightOptions(ttsHighlightOptions, viewSettings.isEink),\n      );\n    }\n  }, [viewSettings?.ttsHighlightOptions, viewSettings?.isEink, getTTSHighlightOptions]);\n\n  const handleTTSSpeak = async (event: CustomEvent) => {\n    const { bookKey: ttsBookKey, range, oneTime = false } = event.detail;\n    if (bookKey !== ttsBookKey) return;\n\n    const view = getView(bookKey);\n    const progress = getProgress(bookKey);\n    const viewSettings = getViewSettings(bookKey);\n    const bookData = getBookData(bookKey);\n    if (!view || !progress || !viewSettings || !bookData || !bookData.book) return;\n    if (bookData.book?.format === 'PDF') {\n      eventDispatcher.dispatch('toast', {\n        message: _('TTS not supported for PDF'),\n        type: 'warning',\n      });\n      return;\n    }\n\n    let ttsFromRange = range;\n    if (!ttsFromRange && viewSettings.ttsLocation) {\n      const { location } = progress;\n      const ttsCfi = viewSettings.ttsLocation;\n      if (isCfiInLocation(ttsCfi, location)) {\n        const { index, anchor } = view.resolveCFI(ttsCfi);\n        const { doc } = view.renderer.getContents().find((x) => x.index === index) || {};\n        if (doc) {\n          ttsFromRange = anchor(doc);\n        }\n      }\n    }\n    if (!ttsFromRange) {\n      ttsFromRange = progress.range;\n    }\n\n    const primaryLang = bookData.book.primaryLanguage;\n\n    if (ttsControllerRef.current) {\n      ttsControllerRef.current.stop();\n      ttsControllerRef.current = null;\n    }\n\n    try {\n      if (appService?.isIOSApp) {\n        await invokeUseBackgroundAudio({ enabled: true });\n      }\n      if (appService?.isMobile) {\n        unblockAudio();\n      }\n      await initMediaSession();\n      setTtsClientsInitialized(false);\n\n      if (!oneTime) {\n        setShowIndicator(true);\n      }\n      const ttsController = new TTSController(appService, view, !!user?.id, preprocessSSMLForTTS);\n      ttsControllerRef.current = ttsController;\n      setTtsController(ttsController);\n\n      await ttsController.init();\n      await ttsController.initViewTTS(\n        getTTSHighlightOptions(viewSettings.ttsHighlightOptions, viewSettings.isEink),\n      );\n      const ssml = view.tts?.from(ttsFromRange);\n      if (ssml) {\n        const lang = parseSSMLLang(ssml, primaryLang) || 'en';\n        setIsPlaying(true);\n        setTtsLang(lang);\n\n        ttsController.setLang(lang);\n        ttsController.setRate(viewSettings.ttsRate);\n        ttsController.speak(ssml, oneTime);\n        ttsController.setTargetLang(getTTSTargetLang() || '');\n      }\n      setTtsClientsInitialized(true);\n      setTTSEnabled(bookKey, true);\n    } catch (error) {\n      eventDispatcher.dispatch('toast', {\n        message: _('TTS not supported for this document'),\n        type: 'error',\n      });\n      console.error(error);\n    }\n  };\n\n  const handleTTSStop = async (event: CustomEvent) => {\n    const { bookKey: ttsBookKey } = event.detail;\n    if (ttsControllerRef.current && bookKey === ttsBookKey) {\n      handleStop(bookKey);\n    }\n  };\n\n  const handleTogglePlay = useCallback(async () => {\n    const ttsController = ttsControllerRef.current;\n    if (!ttsController) return;\n\n    if (isPlaying) {\n      setIsPlaying(false);\n      setIsPaused(true);\n      await ttsController.pause();\n    } else if (isPaused) {\n      setIsPlaying(true);\n      setIsPaused(false);\n      // start for forward/backward/setvoice-paused\n      // set rate don't pause the tts\n      if (ttsController.state === 'paused') {\n        await ttsController.resume();\n      } else {\n        await ttsController.start();\n      }\n    }\n\n    if (mediaSessionRef.current) {\n      const mediaSession = mediaSessionRef.current;\n      if (mediaSession instanceof TauriMediaSession) {\n        await mediaSession.updatePlaybackState({ playing: !isPlaying });\n      } else {\n        mediaSession.playbackState = isPlaying ? 'paused' : 'playing';\n      }\n    }\n  }, [isPlaying, isPaused]);\n\n  const handleBackward = useCallback(async (byMark = false) => {\n    const ttsController = ttsControllerRef.current;\n    if (ttsController) {\n      await ttsController.backward(byMark);\n    }\n  }, []);\n\n  const handleForward = useCallback(async (byMark = false) => {\n    const ttsController = ttsControllerRef.current;\n    if (ttsController) {\n      await ttsController.forward(byMark);\n    }\n  }, []);\n\n  const handlePause = useCallback(async () => {\n    const ttsController = ttsControllerRef.current;\n    if (ttsController) {\n      setIsPlaying(false);\n      setIsPaused(true);\n      await ttsController.pause();\n    }\n  }, []);\n\n  const handleStop = useCallback(\n    async (bookKey: string) => {\n      const ttsController = ttsControllerRef.current;\n      if (ttsController) {\n        await ttsController.shutdown();\n        ttsControllerRef.current = null;\n        setTtsController(null);\n        getView(bookKey)?.deselect();\n        setIsPlaying(false);\n        setShowPanel(false);\n        setShowIndicator(false);\n      }\n      if (appService?.isIOSApp) {\n        await invokeUseBackgroundAudio({ enabled: false });\n      }\n      if (appService?.isMobile) {\n        releaseUnblockAudio();\n      }\n      await deinitMediaSession();\n      setTTSEnabled(bookKey, false);\n    },\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    [appService],\n  );\n\n  // rate range: 0.5 - 3, 1.0 is normal speed\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  const handleSetRate = useCallback(\n    throttle(async (rate: number) => {\n      const ttsController = ttsControllerRef.current;\n      if (ttsController) {\n        if (ttsController.state === 'playing') {\n          await ttsController.stop();\n          await ttsController.setRate(rate);\n          await ttsController.start();\n        } else {\n          await ttsController.setRate(rate);\n        }\n      }\n    }, 3000),\n    [],\n  );\n\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  const handleSetVoice = useCallback(\n    throttle(async (voice: string, lang: string) => {\n      const ttsController = ttsControllerRef.current;\n      if (ttsController) {\n        if (ttsController.state === 'playing') {\n          await ttsController.stop();\n          await ttsController.setVoice(voice, lang);\n          await ttsController.start();\n        } else {\n          await ttsController.setVoice(voice, lang);\n        }\n      }\n    }, 3000),\n    [],\n  );\n\n  const handleGetVoices = async (lang: string) => {\n    const ttsController = ttsControllerRef.current;\n    if (ttsController) {\n      return ttsController.getVoices(lang);\n    }\n    return [];\n  };\n\n  const handleGetVoiceId = () => {\n    const ttsController = ttsControllerRef.current;\n    if (ttsController) {\n      return ttsController.getVoiceId();\n    }\n    return '';\n  };\n\n  const handleSelectTimeout = (bookKey: string, value: number) => {\n    setTimeoutOption(value);\n    if (timeoutFunc) {\n      clearTimeout(timeoutFunc);\n    }\n    if (value > 0) {\n      setTimeoutFunc(\n        setTimeout(() => {\n          handleStop(bookKey);\n        }, value * 1000),\n      );\n      setTimeoutTimestamp(Date.now() + value * 1000);\n    } else {\n      setTimeoutTimestamp(0);\n    }\n  };\n\n  const handleToggleTTSBar = () => {\n    const viewSettings = getViewSettings(bookKey)!;\n    viewSettings.showTTSBar = !viewSettings.showTTSBar;\n    setShowTTSBar(viewSettings.showTTSBar);\n    if (viewSettings.showTTSBar) {\n      setShowPanel(false);\n    }\n    setViewSettings(bookKey, viewSettings);\n  };\n\n  const updatePanelPosition = () => {\n    if (iconRef.current) {\n      const rect = iconRef.current.getBoundingClientRect();\n      const parentRect =\n        iconRef.current.parentElement?.getBoundingClientRect() ||\n        document.documentElement.getBoundingClientRect();\n\n      const trianglePos = {\n        dir: 'up',\n        point: { x: rect.left + rect.width / 2 - parentRect.left, y: rect.top - 12 },\n      } as Position;\n\n      const popupPos = getPopupPosition(\n        trianglePos,\n        parentRect,\n        popupWidth,\n        popupHeight,\n        popupPadding,\n      );\n\n      setPanelPosition(popupPos);\n      setTrianglePosition(trianglePos);\n    }\n  };\n\n  const togglePopup = () => {\n    updatePanelPosition();\n    if (!showPanel && ttsControllerRef.current) {\n      const speakingLang = ttsControllerRef.current.getSpeakingLang() || ttsLang;\n      setTtsLang(speakingLang);\n    }\n    setShowPanel((prev) => !prev);\n  };\n\n  const handleDismissPopup = () => {\n    setShowPanel(false);\n  };\n\n  useEffect(() => {\n    const { current: mediaSession } = mediaSessionRef;\n    if (mediaSession) {\n      mediaSession.setActionHandler('play', () => {\n        handleTogglePlay();\n      });\n\n      mediaSession.setActionHandler('pause', () => {\n        handleTogglePlay();\n      });\n\n      mediaSession.setActionHandler('stop', () => {\n        handlePause();\n      });\n\n      mediaSession.setActionHandler('seekforward', () => {\n        handleForward(true);\n      });\n\n      mediaSession.setActionHandler('seekbackward', () => {\n        handleBackward(true);\n      });\n\n      mediaSession.setActionHandler('nexttrack', () => {\n        handleForward();\n      });\n\n      mediaSession.setActionHandler('previoustrack', () => {\n        handleBackward();\n      });\n    }\n  }, [handleTogglePlay, handlePause, handleForward, handleBackward]);\n\n  useEffect(() => {\n    if (!iconRef.current || !showPanel) return;\n    const parentElement = iconRef.current.parentElement;\n    if (!parentElement) return;\n\n    const resizeObserver = new ResizeObserver(() => {\n      updatePanelPosition();\n    });\n    resizeObserver.observe(parentElement);\n    return () => {\n      resizeObserver.disconnect();\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [showPanel]);\n\n  useEffect(() => {\n    if (hoveredBookKey) {\n      if (hoverTimeoutRef.current) {\n        clearTimeout(hoverTimeoutRef.current);\n        hoverTimeoutRef.current = null;\n      }\n      const showTimeout = setTimeout(() => {\n        setShowIndicatorWithinTimeout(true);\n      }, 100);\n      hoverTimeoutRef.current = showTimeout;\n    } else {\n      if (hoverTimeoutRef.current) {\n        clearTimeout(hoverTimeoutRef.current);\n        hoverTimeoutRef.current = null;\n      }\n      const hideTimeout = setTimeout(() => {\n        setShowIndicatorWithinTimeout(false);\n      }, 5000);\n      hoverTimeoutRef.current = hideTimeout;\n    }\n\n    return () => {\n      if (hoverTimeoutRef.current) {\n        clearTimeout(hoverTimeoutRef.current);\n      }\n    };\n  }, [hoveredBookKey]);\n\n  return (\n    <>\n      {showPanel && <Overlay onDismiss={handleDismissPopup} />}\n      {(showPanel || (showIndicator && showIndicatorWithinTimeout)) && (\n        <div\n          ref={iconRef}\n          className={clsx(\n            'absolute h-12 w-12',\n            'transition-transform duration-300',\n            viewSettings?.rtl ? 'left-8' : 'right-6',\n            !appService?.hasSafeAreaInset && 'bottom-[70px] sm:bottom-14',\n          )}\n          style={{\n            bottom: appService?.hasSafeAreaInset\n              ? `${(safeAreaInsets?.bottom || 0) * 0.33 + (hoveredBookKey ? 70 : 52)}px`\n              : undefined,\n          }}\n        >\n          <TTSIcon isPlaying={isPlaying} ttsInited={ttsClientsInited} onClick={togglePopup} />\n        </div>\n      )}\n      {showPanel && panelPosition && trianglePosition && ttsClientsInited && (\n        <Popup\n          width={popupWidth}\n          height={popupHeight}\n          position={panelPosition}\n          trianglePosition={trianglePosition}\n          className='bg-base-200 flex shadow-lg'\n          onDismiss={handleDismissPopup}\n        >\n          <TTSPanel\n            bookKey={bookKey}\n            ttsLang={ttsLang}\n            isPlaying={isPlaying}\n            timeoutOption={timeoutOption}\n            timeoutTimestamp={timeoutTimestamp}\n            onTogglePlay={handleTogglePlay}\n            onBackward={handleBackward}\n            onForward={handleForward}\n            onSetRate={handleSetRate}\n            onGetVoices={handleGetVoices}\n            onSetVoice={handleSetVoice}\n            onGetVoiceId={handleGetVoiceId}\n            onSelectTimeout={handleSelectTimeout}\n            onToogleTTSBar={handleToggleTTSBar}\n          />\n        </Popup>\n      )}\n      {showIndicator && showTTSBar && ttsClientsInited && (\n        <TTSBar\n          bookKey={bookKey}\n          isPlaying={isPlaying}\n          onBackward={handleBackward}\n          onTogglePlay={handleTogglePlay}\n          onForward={handleForward}\n          gridInsets={gridInsets}\n        />\n      )}\n    </>\n  );\n};\n\nexport default TTSControl;\n"],"names":[],"mappings":"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"}}]
}