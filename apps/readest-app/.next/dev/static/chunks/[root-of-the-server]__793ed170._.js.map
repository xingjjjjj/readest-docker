{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["turbopack:///[turbopack]/browser/dev/hmr-client/hmr-client.ts"],"sourcesContent":["/// <reference path=\"../../../shared/runtime-types.d.ts\" />\n/// <reference path=\"../../runtime/base/dev-globals.d.ts\" />\n/// <reference path=\"../../runtime/base/dev-protocol.d.ts\" />\n/// <reference path=\"../../runtime/base/dev-extensions.ts\" />\n\ntype SendMessage = (msg: any) => void\nexport type WebSocketMessage =\n  | {\n      type: 'turbopack-connected'\n    }\n  | {\n      type: 'turbopack-message'\n      data: Record<string, any>\n    }\n\nexport type ClientOptions = {\n  addMessageListener: (cb: (msg: WebSocketMessage) => void) => void\n  sendMessage: SendMessage\n  onUpdateError: (err: unknown) => void\n}\n\nexport function connect({\n  addMessageListener,\n  sendMessage,\n  onUpdateError = console.error,\n}: ClientOptions) {\n  addMessageListener((msg) => {\n    switch (msg.type) {\n      case 'turbopack-connected':\n        handleSocketConnected(sendMessage)\n        break\n      default:\n        try {\n          if (Array.isArray(msg.data)) {\n            for (let i = 0; i < msg.data.length; i++) {\n              handleSocketMessage(msg.data[i] as ServerMessage)\n            }\n          } else {\n            handleSocketMessage(msg.data as ServerMessage)\n          }\n          applyAggregatedUpdates()\n        } catch (e: unknown) {\n          console.warn(\n            '[Fast Refresh] performing full reload\\n\\n' +\n              \"Fast Refresh will perform a full reload when you edit a file that's imported by modules outside of the React rendering tree.\\n\" +\n              'You might have a file which exports a React component but also exports a value that is imported by a non-React component file.\\n' +\n              'Consider migrating the non-React component export to a separate file and importing it into both files.\\n\\n' +\n              'It is also possible the parent component of the component you edited is a class component, which disables Fast Refresh.\\n' +\n              'Fast Refresh requires at least one parent function component in your React tree.'\n          )\n          onUpdateError(e)\n          location.reload()\n        }\n        break\n    }\n  })\n\n  const queued = globalThis.TURBOPACK_CHUNK_UPDATE_LISTENERS\n  if (queued != null && !Array.isArray(queued)) {\n    throw new Error('A separate HMR handler was already registered')\n  }\n  globalThis.TURBOPACK_CHUNK_UPDATE_LISTENERS = {\n    push: ([chunkPath, callback]: [ChunkListPath, UpdateCallback]) => {\n      subscribeToChunkUpdate(chunkPath, sendMessage, callback)\n    },\n  }\n\n  if (Array.isArray(queued)) {\n    for (const [chunkPath, callback] of queued) {\n      subscribeToChunkUpdate(chunkPath, sendMessage, callback)\n    }\n  }\n}\n\ntype UpdateCallbackSet = {\n  callbacks: Set<UpdateCallback>\n  unsubscribe: () => void\n}\n\nconst updateCallbackSets: Map<ResourceKey, UpdateCallbackSet> = new Map()\n\nfunction sendJSON(sendMessage: SendMessage, message: ClientMessage) {\n  sendMessage(JSON.stringify(message))\n}\n\ntype ResourceKey = string\n\nfunction resourceKey(resource: ResourceIdentifier): ResourceKey {\n  return JSON.stringify({\n    path: resource.path,\n    headers: resource.headers || null,\n  })\n}\n\nfunction subscribeToUpdates(\n  sendMessage: SendMessage,\n  resource: ResourceIdentifier\n): () => void {\n  sendJSON(sendMessage, {\n    type: 'turbopack-subscribe',\n    ...resource,\n  })\n\n  return () => {\n    sendJSON(sendMessage, {\n      type: 'turbopack-unsubscribe',\n      ...resource,\n    })\n  }\n}\n\nfunction handleSocketConnected(sendMessage: SendMessage) {\n  for (const key of updateCallbackSets.keys()) {\n    subscribeToUpdates(sendMessage, JSON.parse(key))\n  }\n}\n\n// we aggregate all pending updates until the issues are resolved\nconst chunkListsWithPendingUpdates: Map<ResourceKey, PartialServerMessage> =\n  new Map()\n\nfunction aggregateUpdates(msg: PartialServerMessage) {\n  const key = resourceKey(msg.resource)\n  let aggregated = chunkListsWithPendingUpdates.get(key)\n\n  if (aggregated) {\n    aggregated.instruction = mergeChunkListUpdates(\n      aggregated.instruction,\n      msg.instruction\n    )\n  } else {\n    chunkListsWithPendingUpdates.set(key, msg)\n  }\n}\n\nfunction applyAggregatedUpdates() {\n  if (chunkListsWithPendingUpdates.size === 0) return\n  hooks.beforeRefresh()\n  for (const msg of chunkListsWithPendingUpdates.values()) {\n    triggerUpdate(msg)\n  }\n  chunkListsWithPendingUpdates.clear()\n  finalizeUpdate()\n}\n\nfunction mergeChunkListUpdates(\n  updateA: ChunkListUpdate,\n  updateB: ChunkListUpdate\n): ChunkListUpdate {\n  let chunks\n  if (updateA.chunks != null) {\n    if (updateB.chunks == null) {\n      chunks = updateA.chunks\n    } else {\n      chunks = mergeChunkListChunks(updateA.chunks, updateB.chunks)\n    }\n  } else if (updateB.chunks != null) {\n    chunks = updateB.chunks\n  }\n\n  let merged\n  if (updateA.merged != null) {\n    if (updateB.merged == null) {\n      merged = updateA.merged\n    } else {\n      // Since `merged` is an array of updates, we need to merge them all into\n      // one, consistent update.\n      // Since there can only be `EcmascriptMergeUpdates` in the array, there is\n      // no need to key on the `type` field.\n      let update = updateA.merged[0]\n      for (let i = 1; i < updateA.merged.length; i++) {\n        update = mergeChunkListEcmascriptMergedUpdates(\n          update,\n          updateA.merged[i]\n        )\n      }\n\n      for (let i = 0; i < updateB.merged.length; i++) {\n        update = mergeChunkListEcmascriptMergedUpdates(\n          update,\n          updateB.merged[i]\n        )\n      }\n\n      merged = [update]\n    }\n  } else if (updateB.merged != null) {\n    merged = updateB.merged\n  }\n\n  return {\n    type: 'ChunkListUpdate',\n    chunks,\n    merged,\n  }\n}\n\nfunction mergeChunkListChunks(\n  chunksA: Record<ChunkPath, ChunkUpdate>,\n  chunksB: Record<ChunkPath, ChunkUpdate>\n): Record<ChunkPath, ChunkUpdate> {\n  const chunks: Record<ChunkPath, ChunkUpdate> = {}\n\n  for (const [chunkPath, chunkUpdateA] of Object.entries(chunksA) as Array<\n    [ChunkPath, ChunkUpdate]\n  >) {\n    const chunkUpdateB = chunksB[chunkPath]\n    if (chunkUpdateB != null) {\n      const mergedUpdate = mergeChunkUpdates(chunkUpdateA, chunkUpdateB)\n      if (mergedUpdate != null) {\n        chunks[chunkPath] = mergedUpdate\n      }\n    } else {\n      chunks[chunkPath] = chunkUpdateA\n    }\n  }\n\n  for (const [chunkPath, chunkUpdateB] of Object.entries(chunksB) as Array<\n    [ChunkPath, ChunkUpdate]\n  >) {\n    if (chunks[chunkPath] == null) {\n      chunks[chunkPath] = chunkUpdateB\n    }\n  }\n\n  return chunks\n}\n\nfunction mergeChunkUpdates(\n  updateA: ChunkUpdate,\n  updateB: ChunkUpdate\n): ChunkUpdate | undefined {\n  if (\n    (updateA.type === 'added' && updateB.type === 'deleted') ||\n    (updateA.type === 'deleted' && updateB.type === 'added')\n  ) {\n    return undefined\n  }\n\n  if (updateA.type === 'partial') {\n    invariant(updateA.instruction, 'Partial updates are unsupported')\n  }\n\n  if (updateB.type === 'partial') {\n    invariant(updateB.instruction, 'Partial updates are unsupported')\n  }\n\n  return undefined\n}\n\nfunction mergeChunkListEcmascriptMergedUpdates(\n  mergedA: EcmascriptMergedUpdate,\n  mergedB: EcmascriptMergedUpdate\n): EcmascriptMergedUpdate {\n  const entries = mergeEcmascriptChunkEntries(mergedA.entries, mergedB.entries)\n  const chunks = mergeEcmascriptChunksUpdates(mergedA.chunks, mergedB.chunks)\n\n  return {\n    type: 'EcmascriptMergedUpdate',\n    entries,\n    chunks,\n  }\n}\n\nfunction mergeEcmascriptChunkEntries(\n  entriesA: Record<ModuleId, EcmascriptModuleEntry> | undefined,\n  entriesB: Record<ModuleId, EcmascriptModuleEntry> | undefined\n): Record<ModuleId, EcmascriptModuleEntry> {\n  return { ...entriesA, ...entriesB }\n}\n\nfunction mergeEcmascriptChunksUpdates(\n  chunksA: Record<ChunkPath, EcmascriptMergedChunkUpdate> | undefined,\n  chunksB: Record<ChunkPath, EcmascriptMergedChunkUpdate> | undefined\n): Record<ChunkPath, EcmascriptMergedChunkUpdate> | undefined {\n  if (chunksA == null) {\n    return chunksB\n  }\n\n  if (chunksB == null) {\n    return chunksA\n  }\n\n  const chunks: Record<ChunkPath, EcmascriptMergedChunkUpdate> = {}\n\n  for (const [chunkPath, chunkUpdateA] of Object.entries(chunksA) as Array<\n    [ChunkPath, EcmascriptMergedChunkUpdate]\n  >) {\n    const chunkUpdateB = chunksB[chunkPath]\n    if (chunkUpdateB != null) {\n      const mergedUpdate = mergeEcmascriptChunkUpdates(\n        chunkUpdateA,\n        chunkUpdateB\n      )\n      if (mergedUpdate != null) {\n        chunks[chunkPath] = mergedUpdate\n      }\n    } else {\n      chunks[chunkPath] = chunkUpdateA\n    }\n  }\n\n  for (const [chunkPath, chunkUpdateB] of Object.entries(chunksB) as Array<\n    [ChunkPath, EcmascriptMergedChunkUpdate]\n  >) {\n    if (chunks[chunkPath] == null) {\n      chunks[chunkPath] = chunkUpdateB\n    }\n  }\n\n  if (Object.keys(chunks).length === 0) {\n    return undefined\n  }\n\n  return chunks\n}\n\nfunction mergeEcmascriptChunkUpdates(\n  updateA: EcmascriptMergedChunkUpdate,\n  updateB: EcmascriptMergedChunkUpdate\n): EcmascriptMergedChunkUpdate | undefined {\n  if (updateA.type === 'added' && updateB.type === 'deleted') {\n    // These two completely cancel each other out.\n    return undefined\n  }\n\n  if (updateA.type === 'deleted' && updateB.type === 'added') {\n    const added = []\n    const deleted = []\n    const deletedModules = new Set(updateA.modules ?? [])\n    const addedModules = new Set(updateB.modules ?? [])\n\n    for (const moduleId of addedModules) {\n      if (!deletedModules.has(moduleId)) {\n        added.push(moduleId)\n      }\n    }\n\n    for (const moduleId of deletedModules) {\n      if (!addedModules.has(moduleId)) {\n        deleted.push(moduleId)\n      }\n    }\n\n    if (added.length === 0 && deleted.length === 0) {\n      return undefined\n    }\n\n    return {\n      type: 'partial',\n      added,\n      deleted,\n    }\n  }\n\n  if (updateA.type === 'partial' && updateB.type === 'partial') {\n    const added = new Set([...(updateA.added ?? []), ...(updateB.added ?? [])])\n    const deleted = new Set([\n      ...(updateA.deleted ?? []),\n      ...(updateB.deleted ?? []),\n    ])\n\n    if (updateB.added != null) {\n      for (const moduleId of updateB.added) {\n        deleted.delete(moduleId)\n      }\n    }\n\n    if (updateB.deleted != null) {\n      for (const moduleId of updateB.deleted) {\n        added.delete(moduleId)\n      }\n    }\n\n    return {\n      type: 'partial',\n      added: [...added],\n      deleted: [...deleted],\n    }\n  }\n\n  if (updateA.type === 'added' && updateB.type === 'partial') {\n    const modules = new Set([\n      ...(updateA.modules ?? []),\n      ...(updateB.added ?? []),\n    ])\n\n    for (const moduleId of updateB.deleted ?? []) {\n      modules.delete(moduleId)\n    }\n\n    return {\n      type: 'added',\n      modules: [...modules],\n    }\n  }\n\n  if (updateA.type === 'partial' && updateB.type === 'deleted') {\n    // We could eagerly return `updateB` here, but this would potentially be\n    // incorrect if `updateA` has added modules.\n\n    const modules = new Set(updateB.modules ?? [])\n\n    if (updateA.added != null) {\n      for (const moduleId of updateA.added) {\n        modules.delete(moduleId)\n      }\n    }\n\n    return {\n      type: 'deleted',\n      modules: [...modules],\n    }\n  }\n\n  // Any other update combination is invalid.\n\n  return undefined\n}\n\nfunction invariant(_: never, message: string): never {\n  throw new Error(`Invariant: ${message}`)\n}\n\nconst CRITICAL = ['bug', 'error', 'fatal']\n\nfunction compareByList(list: any[], a: any, b: any) {\n  const aI = list.indexOf(a) + 1 || list.length\n  const bI = list.indexOf(b) + 1 || list.length\n  return aI - bI\n}\n\nconst chunksWithIssues: Map<ResourceKey, Issue[]> = new Map()\n\nfunction emitIssues() {\n  const issues = []\n  const deduplicationSet = new Set()\n\n  for (const [_, chunkIssues] of chunksWithIssues) {\n    for (const chunkIssue of chunkIssues) {\n      if (deduplicationSet.has(chunkIssue.formatted)) continue\n\n      issues.push(chunkIssue)\n      deduplicationSet.add(chunkIssue.formatted)\n    }\n  }\n\n  sortIssues(issues)\n\n  hooks.issues(issues)\n}\n\nfunction handleIssues(msg: ServerMessage): boolean {\n  const key = resourceKey(msg.resource)\n  let hasCriticalIssues = false\n\n  for (const issue of msg.issues) {\n    if (CRITICAL.includes(issue.severity)) {\n      hasCriticalIssues = true\n    }\n  }\n\n  if (msg.issues.length > 0) {\n    chunksWithIssues.set(key, msg.issues)\n  } else if (chunksWithIssues.has(key)) {\n    chunksWithIssues.delete(key)\n  }\n\n  emitIssues()\n\n  return hasCriticalIssues\n}\n\nconst SEVERITY_ORDER = ['bug', 'fatal', 'error', 'warning', 'info', 'log']\nconst CATEGORY_ORDER = [\n  'parse',\n  'resolve',\n  'code generation',\n  'rendering',\n  'typescript',\n  'other',\n]\n\nfunction sortIssues(issues: Issue[]) {\n  issues.sort((a, b) => {\n    const first = compareByList(SEVERITY_ORDER, a.severity, b.severity)\n    if (first !== 0) return first\n    return compareByList(CATEGORY_ORDER, a.category, b.category)\n  })\n}\n\nconst hooks = {\n  beforeRefresh: () => {},\n  refresh: () => {},\n  buildOk: () => {},\n  issues: (_issues: Issue[]) => {},\n}\n\nexport function setHooks(newHooks: typeof hooks) {\n  Object.assign(hooks, newHooks)\n}\n\nfunction handleSocketMessage(msg: ServerMessage) {\n  sortIssues(msg.issues)\n\n  handleIssues(msg)\n\n  switch (msg.type) {\n    case 'issues':\n      // issues are already handled\n      break\n    case 'partial':\n      // aggregate updates\n      aggregateUpdates(msg)\n      break\n    default:\n      // run single update\n      const runHooks = chunkListsWithPendingUpdates.size === 0\n      if (runHooks) hooks.beforeRefresh()\n      triggerUpdate(msg)\n      if (runHooks) finalizeUpdate()\n      break\n  }\n}\n\nfunction finalizeUpdate() {\n  hooks.refresh()\n  hooks.buildOk()\n\n  // This is used by the Next.js integration test suite to notify it when HMR\n  // updates have been completed.\n  // TODO: Only run this in test environments (gate by `process.env.__NEXT_TEST_MODE`)\n  if (globalThis.__NEXT_HMR_CB) {\n    globalThis.__NEXT_HMR_CB()\n    globalThis.__NEXT_HMR_CB = null\n  }\n}\n\nfunction subscribeToChunkUpdate(\n  chunkListPath: ChunkListPath,\n  sendMessage: SendMessage,\n  callback: UpdateCallback\n): () => void {\n  return subscribeToUpdate(\n    {\n      path: chunkListPath,\n    },\n    sendMessage,\n    callback\n  )\n}\n\nexport function subscribeToUpdate(\n  resource: ResourceIdentifier,\n  sendMessage: SendMessage,\n  callback: UpdateCallback\n) {\n  const key = resourceKey(resource)\n  let callbackSet: UpdateCallbackSet\n  const existingCallbackSet = updateCallbackSets.get(key)\n  if (!existingCallbackSet) {\n    callbackSet = {\n      callbacks: new Set([callback]),\n      unsubscribe: subscribeToUpdates(sendMessage, resource),\n    }\n    updateCallbackSets.set(key, callbackSet)\n  } else {\n    existingCallbackSet.callbacks.add(callback)\n    callbackSet = existingCallbackSet\n  }\n\n  return () => {\n    callbackSet.callbacks.delete(callback)\n\n    if (callbackSet.callbacks.size === 0) {\n      callbackSet.unsubscribe()\n      updateCallbackSets.delete(key)\n    }\n  }\n}\n\nfunction triggerUpdate(msg: ServerMessage) {\n  const key = resourceKey(msg.resource)\n  const callbackSet = updateCallbackSets.get(key)\n  if (!callbackSet) {\n    return\n  }\n\n  for (const callback of callbackSet.callbacks) {\n    callback(msg)\n  }\n\n  if (msg.type === 'notFound') {\n    // This indicates that the resource which we subscribed to either does not exist or\n    // has been deleted. In either case, we should clear all update callbacks, so if a\n    // new subscription is created for the same resource, it will send a new \"subscribe\"\n    // message to the server.\n    // No need to send an \"unsubscribe\" message to the server, it will have already\n    // dropped the update stream before sending the \"notFound\" message.\n    updateCallbackSets.delete(key)\n  }\n}\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 467, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/utils/config.ts"],"sourcesContent":["import { ViewSettings } from '@/types/book';\n\nexport const getMaxInlineSize = (viewSettings: ViewSettings) => {\n  const isVertical = viewSettings.vertical;\n  const screenWidth = window.innerWidth;\n  const screenHeight = window.innerHeight;\n\n  const screenAspectRatio = isVertical ? screenHeight / screenWidth : screenWidth / screenHeight;\n  const isUnfoldedScreen = screenAspectRatio < 1.3 && screenAspectRatio > 0.77 && screenWidth > 600;\n\n  return isVertical\n    ? Math.max(screenWidth, screenHeight, 720, viewSettings.maxInlineSize)\n    : isUnfoldedScreen\n      ? viewSettings.maxInlineSize * 0.8\n      : viewSettings.maxInlineSize;\n};\n\nexport const getDefaultMaxInlineSize = () => {\n  if (typeof window === 'undefined') return 720;\n\n  const screenWidth = window.innerWidth;\n  const screenHeight = window.innerHeight;\n  return screenWidth < screenHeight ? Math.max(screenWidth, 720) : 720;\n};\n\nexport const getDefaultMaxBlockSize = () => {\n  if (typeof window === 'undefined') return 1440;\n\n  const screenWidth = window.innerWidth;\n  const screenHeight = window.innerHeight;\n  return Math.max(screenWidth, screenHeight, 1440);\n};\n"],"names":[],"mappings":";;;;;;;;AAEO,MAAM,mBAAmB,CAAC;IAC/B,MAAM,aAAa,aAAa,QAAQ;IACxC,MAAM,cAAc,OAAO,UAAU;IACrC,MAAM,eAAe,OAAO,WAAW;IAEvC,MAAM,oBAAoB,aAAa,eAAe,cAAc,cAAc;IAClF,MAAM,mBAAmB,oBAAoB,OAAO,oBAAoB,QAAQ,cAAc;IAE9F,OAAO,aACH,KAAK,GAAG,CAAC,aAAa,cAAc,KAAK,aAAa,aAAa,IACnE,mBACE,aAAa,aAAa,GAAG,MAC7B,aAAa,aAAa;AAClC;AAEO,MAAM,0BAA0B;IACrC;;IAEA,MAAM,cAAc,OAAO,UAAU;IACrC,MAAM,eAAe,OAAO,WAAW;IACvC,OAAO,cAAc,eAAe,KAAK,GAAG,CAAC,aAAa,OAAO;AACnE;AAEO,MAAM,yBAAyB;IACpC;;IAEA,MAAM,cAAc,OAAO,UAAU;IACrC,MAAM,eAAe,OAAO,WAAW;IACvC,OAAO,KAAK,GAAG,CAAC,aAAa,cAAc;AAC7C"}},
    {"offset": {"line": 504, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/utils/misc.ts"],"sourcesContent":["import { OsPlatform } from '@/types/system';\nimport { md5 } from 'js-md5';\n\nexport const uniqueId = () => Math.random().toString(36).substring(2, 9);\n\nexport const randomMd5 = () => md5(Math.random().toString());\n\nexport const getContentMd5 = (content: unknown) => md5(JSON.stringify(content));\n\nexport const makeSafeFilename = (filename: string, replacement = '_') => {\n  // Windows restricted characters + control characters and reserved names\n  const unsafeCharacters = /[<>:%\"\\/\\\\|?*\\x00-\\x1F]/g;\n  const reservedFilenames = /^(con|prn|aux|nul|com[1-9]|lpt[1-9])$/i;\n  // Unsafe to use filename including file extensions over 255 bytes on Android\n  const maxFilenameBytes = 250;\n\n  let safeName = filename.replace(unsafeCharacters, replacement);\n\n  if (reservedFilenames.test(safeName)) {\n    safeName = `${safeName}${replacement}`;\n  }\n\n  const encoder = new TextEncoder();\n  let utf8Bytes = encoder.encode(safeName);\n\n  while (utf8Bytes.length > maxFilenameBytes) {\n    safeName = safeName.slice(0, -1);\n    utf8Bytes = encoder.encode(safeName);\n  }\n\n  return safeName.trim();\n};\n\nexport const getLocale = () => {\n  return localStorage?.getItem('i18nextLng') || navigator?.language || '';\n};\n\nexport const getUserLang = () => {\n  const locale = getLocale();\n  return locale.split('-')[0] || 'en';\n};\n\nexport const getTargetLang = () => {\n  const locale = getLocale();\n  if (locale.startsWith('zh')) {\n    return locale === 'zh-Hant' || locale === 'zh-HK' || locale === 'zh-TW' ? 'zh-Hant' : 'zh-Hans';\n  }\n  return locale.split('-')[0] || 'en';\n};\n\nexport const isCJKEnv = () => {\n  const browserLanguage = navigator.language || '';\n  const uiLanguage = localStorage?.getItem('i18nextLng') || '';\n  const isCJKUI = ['zh', 'ja', 'ko'].some((lang) => uiLanguage.startsWith(lang));\n  const isCJKLocale = ['zh', 'ja', 'ko'].some((lang) => browserLanguage.startsWith(lang));\n  return isCJKLocale || isCJKUI;\n};\n\nexport const getUserLocale = (lang: string): string | undefined => {\n  const languages =\n    navigator.languages && navigator.languages.length > 0\n      ? navigator.languages\n      : [navigator.language];\n\n  const filteredLocales = languages.filter((locale) => locale.startsWith(lang));\n  return filteredLocales.length > 0 ? filteredLocales[0] : undefined;\n};\n\n// Note that iPad may have a user agent string like a desktop browser\n// when possible please use appService.isIOSApp || getOSPlatform() === 'ios'\n// to check if the app is running on iOS\nexport const getOSPlatform = (): OsPlatform => {\n  const userAgent = navigator.userAgent.toLowerCase();\n\n  if (/iphone|ipad|ipod/.test(userAgent)) return 'ios';\n  if (userAgent.includes('android')) return 'android';\n  if (userAgent.includes('macintosh') || userAgent.includes('mac os x')) return 'macos';\n  if (userAgent.includes('windows nt')) return 'windows';\n  if (userAgent.includes('linux')) return 'linux';\n\n  return 'unknown';\n};\n\nexport const isContentURI = (uri: string) => {\n  return uri.startsWith('content://');\n};\n\nexport const isFileURI = (uri: string) => {\n  return uri.startsWith('file://');\n};\n\nexport const isValidURL = (url: string, allowedSchemes: string[] = ['http', 'https']) => {\n  try {\n    const { protocol } = new URL(url);\n    return allowedSchemes.some((scheme) => `${scheme}:` === protocol);\n  } catch {\n    return false;\n  }\n};\n\nexport const stubTranslation = (stubKey: string) => {\n  return stubKey;\n};\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 629, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/services/constants.ts"],"sourcesContent":["import {\n  AnnotatorConfig,\n  BookFont,\n  BookLanguage,\n  BookLayout,\n  BookSearchConfig,\n  BookStyle,\n  HighlightColor,\n  NoteExportConfig,\n  ScreenConfig,\n  TranslatorConfig,\n  TTSConfig,\n  ViewConfig,\n  ViewSettings,\n} from '@/types/book';\nimport { KOSyncSettings, ReadSettings, SystemSettings } from '@/types/settings';\nimport { UserStorageQuota, UserDailyTranslationQuota } from '@/types/quota';\nimport { getDefaultMaxBlockSize, getDefaultMaxInlineSize } from '@/utils/config';\nimport { stubTranslation as _ } from '@/utils/misc';\n\nexport const DATA_SUBDIR = 'Readest';\nexport const LOCAL_BOOKS_SUBDIR = `${DATA_SUBDIR}/Books`;\nexport const LOCAL_FONTS_SUBDIR = `${DATA_SUBDIR}/Fonts`;\nexport const LOCAL_IMAGES_SUBDIR = `${DATA_SUBDIR}/Images`;\n\nexport const SETTINGS_FILENAME = 'settings.json';\n\nexport const SUPPORTED_BOOK_EXTS = [\n  'epub',\n  'mobi',\n  'azw',\n  'azw3',\n  'fb2',\n  'zip',\n  'cbz',\n  'pdf',\n  'txt',\n];\nexport const BOOK_ACCEPT_FORMATS = SUPPORTED_BOOK_EXTS.map((ext) => `.${ext}`).join(', ');\nexport const BOOK_UNGROUPED_NAME = '';\nexport const BOOK_UNGROUPED_ID = '';\n\nexport const SUPPORTED_IMAGE_EXTS = ['png', 'jpg', 'jpeg'];\nexport const IMAGE_ACCEPT_FORMATS = SUPPORTED_IMAGE_EXTS.map((ext) => `.${ext}`).join(', ');\n\nexport const DEFAULT_KOSYNC_SETTINGS = {\n  serverUrl: 'https://sync.koreader.rocks/', // https://kosync.ak-team.com:3042/\n  username: '',\n  userkey: '',\n  deviceId: '',\n  deviceName: '',\n  checksumMethod: 'binary',\n  strategy: 'prompt',\n  enabled: false,\n} as KOSyncSettings;\n\nexport const DEFAULT_SYSTEM_SETTINGS: Partial<SystemSettings> = {\n  keepLogin: false,\n  autoUpload: true,\n  alwaysOnTop: false,\n  openBookInNewWindow: true,\n  alwaysShowStatusBar: false,\n  alwaysInForeground: false,\n  autoCheckUpdates: true,\n  screenWakeLock: false,\n  screenBrightness: -1, // -1~100, -1 for system default\n  autoScreenBrightness: true,\n  openLastBooks: false,\n  lastOpenBooks: [],\n  autoImportBooksOnOpen: false,\n  telemetryEnabled: true,\n  discordRichPresenceEnabled: false,\n  libraryViewMode: 'grid',\n  librarySortBy: 'updated',\n  librarySortAscending: false,\n  libraryCoverFit: 'crop',\n  libraryAutoColumns: true,\n  libraryColumns: 6,\n\n  kosync: DEFAULT_KOSYNC_SETTINGS,\n\n  lastSyncedAtBooks: 0,\n  lastSyncedAtConfigs: 0,\n  lastSyncedAtNotes: 0,\n};\n\nexport const DEFAULT_MOBILE_SYSTEM_SETTINGS: Partial<SystemSettings> = {\n  libraryColumns: 3,\n};\n\nexport const HIGHLIGHT_COLOR_HEX: Record<HighlightColor, string> = {\n  red: '#f87171', // red-400\n  yellow: '#facc15', // yellow-400\n  green: '#4ade80', // green-400\n  blue: '#60a5fa', // blue-400\n  violet: '#a78bfa', // violet-400\n};\n\nexport const DEFAULT_READSETTINGS: ReadSettings = {\n  sideBarWidth: '15%',\n  isSideBarPinned: true,\n  notebookWidth: '25%',\n  isNotebookPinned: false,\n  autohideCursor: true,\n  translationProvider: 'deepl',\n  translateTargetLang: 'EN',\n\n  customThemes: [],\n  highlightStyle: 'highlight',\n  highlightStyles: {\n    highlight: 'yellow',\n    underline: 'green',\n    squiggly: 'blue',\n  },\n  customHighlightColors: HIGHLIGHT_COLOR_HEX,\n  customTtsHighlightColors: [],\n};\n\nexport const DEFAULT_MOBILE_READSETTINGS: Partial<ReadSettings> = {\n  sideBarWidth: '25%',\n  isSideBarPinned: false,\n};\n\nexport const DEFAULT_BOOK_FONT: BookFont = {\n  serifFont: 'Bitter',\n  sansSerifFont: 'Roboto',\n  monospaceFont: 'Consolas',\n  defaultFont: 'Serif',\n  defaultCJKFont: 'LXGW WenKai GB Screen',\n  defaultFontSize: 16,\n  minimumFontSize: 8,\n  fontWeight: 400,\n};\n\nexport const DEFAULT_BOOK_LAYOUT: BookLayout = {\n  marginTopPx: 44,\n  marginBottomPx: 44,\n  marginLeftPx: 16,\n  marginRightPx: 16,\n  compactMarginTopPx: 16,\n  compactMarginBottomPx: 16,\n  compactMarginLeftPx: 16,\n  compactMarginRightPx: 16,\n  gapPercent: 5,\n  scrolled: false,\n  disableClick: false,\n  fullscreenClickArea: false,\n  swapClickArea: false,\n  disableDoubleClick: false,\n  volumeKeysToFlip: false,\n  continuousScroll: false,\n  maxColumnCount: 2,\n  maxInlineSize: getDefaultMaxInlineSize(),\n  maxBlockSize: getDefaultMaxBlockSize(),\n  animated: false,\n  isEink: false,\n  writingMode: 'auto',\n  vertical: false,\n  rtl: false,\n  scrollingOverlap: 0,\n  allowScript: false,\n};\n\nexport const DEFAULT_BOOK_LANGUAGE: BookLanguage = {\n  replaceQuotationMarks: true,\n  convertChineseVariant: 'none',\n};\n\nexport const DEFAULT_BOOK_STYLE: BookStyle = {\n  zoomLevel: 100,\n  paragraphMargin: 0.6,\n  lineHeight: 1.4,\n  wordSpacing: 0,\n  letterSpacing: 0,\n  textIndent: 0,\n  fullJustification: true,\n  hyphenation: true,\n  invertImgColorInDark: false,\n  theme: 'light',\n  overrideFont: false,\n  overrideLayout: false,\n  overrideColor: false,\n  backgroundTextureId: 'none',\n  backgroundOpacity: 0.6,\n  backgroundSize: 'cover',\n  codeHighlighting: false,\n  codeLanguage: 'auto-detect',\n  userStylesheet: '',\n  userUIStylesheet: '',\n\n  zoomMode: 'fit-page',\n  spreadMode: 'auto',\n  keepCoverSpread: true,\n};\n\nexport const DEFAULT_MOBILE_VIEW_SETTINGS: Partial<ViewSettings> = {\n  fullJustification: false,\n  animated: true,\n  defaultFont: 'Sans-serif',\n  marginBottomPx: 16,\n  disableDoubleClick: true,\n  spreadMode: 'none',\n};\n\nexport const DEFAULT_CJK_VIEW_SETTINGS: Partial<ViewSettings> = {\n  fullJustification: true,\n  textIndent: 2,\n  paragraphMargin: 1,\n  lineHeight: 1.6,\n};\n\nexport const DEFAULT_FIXED_LAYOUT_VIEW_SETTINGS: Partial<ViewSettings> = {\n  overrideColor: false,\n};\n\nexport const DEFAULT_EINK_VIEW_SETTINGS: Partial<ViewSettings> = {\n  isEink: true,\n  animated: false,\n  volumeKeysToFlip: true,\n};\n\nexport const DEFAULT_VIEW_CONFIG: ViewConfig = {\n  sideBarTab: 'toc',\n  uiLanguage: '',\n  sortedTOC: false,\n\n  doubleBorder: false,\n  borderColor: 'red',\n\n  showHeader: true,\n  showFooter: true,\n  showBarsOnScroll: false,\n  showRemainingTime: false,\n  showRemainingPages: false,\n  showProgressInfo: true,\n  tapToToggleFooter: false,\n  showMarginsOnScroll: false,\n  progressStyle: 'fraction',\n  progressInfoMode: 'all',\n};\n\nexport const DEFAULT_TTS_CONFIG: TTSConfig = {\n  ttsRate: 1.3,\n  ttsVoice: '',\n  ttsLocation: '',\n  showTTSBar: false,\n  ttsHighlightOptions: { style: 'highlight', color: '#808080' },\n};\n\nexport const DEFAULT_TRANSLATOR_CONFIG: TranslatorConfig = {\n  translationEnabled: false,\n  translationProvider: 'deepl',\n  translateTargetLang: '',\n  showTranslateSource: true,\n  ttsReadAloudText: 'both',\n};\n\nexport const DEFAULT_NOTE_EXPORT_CONFIG: NoteExportConfig = {\n  includeTitle: true,\n  includeAuthor: true,\n  includeDate: true,\n  includeChapterTitles: true,\n  includeQuotes: true,\n  includeNotes: true,\n  includeTimestamp: false,\n  includeChapterSeparator: false,\n  noteSeparator: '\\n\\n',\n  useCustomTemplate: false,\n  customTemplate: '',\n};\n\nexport const DEFAULT_ANNOTATOR_CONFIG: AnnotatorConfig = {\n  enableAnnotationQuickActions: true,\n  annotationQuickAction: null,\n  copyToNotebook: false,\n  noteExportConfig: DEFAULT_NOTE_EXPORT_CONFIG,\n};\n\nexport const DEFAULT_SCREEN_CONFIG: ScreenConfig = {\n  screenOrientation: 'auto',\n};\n\nexport const DEFAULT_BOOK_SEARCH_CONFIG: BookSearchConfig = {\n  scope: 'book',\n  matchCase: false,\n  matchWholeWords: false,\n  matchDiacritics: false,\n};\n\nexport const SYSTEM_SETTINGS_VERSION = 1;\n\nexport const SERIF_FONTS = [\n  'Bitter',\n  'Literata',\n  'Merriweather',\n  'Roboto Slab',\n  'Vollkorn',\n  'PT Serif',\n  'Georgia',\n  'Times New Roman',\n];\n\nexport const NON_FREE_FONTS = ['Georgia', 'Times New Roman'];\n\nexport const CJK_SERIF_FONTS = [\n  _('LXGW WenKai GB Screen'),\n  _('LXGW WenKai TC'),\n  _('GuanKiapTsingKhai-T'),\n  _('Source Han Serif CN VF'),\n  _('Huiwen-mincho'),\n  _('KingHwa_OldSong'),\n];\n\nexport const CJK_SANS_SERIF_FONTS = ['Noto Sans SC', 'Noto Sans TC'];\n\nexport const SANS_SERIF_FONTS = ['Roboto', 'Noto Sans', 'Open Sans', 'PT Sans', 'Helvetica'];\n\nexport const MONOSPACE_FONTS = [\n  'Fira Code',\n  'Consolas',\n  'Courier New',\n  'Lucida Console',\n  'PT Mono',\n];\n\nexport const FALLBACK_FONTS = ['MiSans L3'];\n\nexport const WINDOWS_FONTS = [\n  'Arial',\n  'Arial Black',\n  'Bahnschrift',\n  'Calibri',\n  'Cambria',\n  'Cambria Math',\n  'Candara',\n  'Comic Sans MS',\n  'Consolas',\n  'Constantia',\n  'Corbel',\n  'Courier New',\n  'Ebrima',\n  'FangSong',\n  'Franklin Gothic Medium',\n  'Gabriola',\n  'Gadugi',\n  'Georgia',\n  'Heiti',\n  'HoloLens MDL2 Assets',\n  'Impact',\n  'Ink Free',\n  'Javanese Text',\n  'KaiTi',\n  'Leelawadee UI',\n  'Lucida Console',\n  'Lucida Sans Unicode',\n  'LXGW WenKai GB Screen',\n  'LXGW WenKai TC',\n  'Malgun Gothic',\n  'Marlett',\n  'Microsoft Himalaya',\n  'Microsoft JhengHei',\n  'Microsoft New Tai Lue',\n  'Microsoft PhagsPa',\n  'Microsoft Sans Serif',\n  'Microsoft Tai Le',\n  'Microsoft YaHei',\n  'Microsoft Yi Baiti',\n  'MingLiU',\n  'MingLiU-ExtB',\n  'Mongolian Baiti',\n  'MS Gothic',\n  'MS Mincho',\n  'MV Boli',\n  'Myanmar Text',\n  'Nirmala UI',\n  'Noto Serif JP',\n  'NSimSun',\n  'Palatino Linotype',\n  'PMingLiU',\n  'Segoe MDL2 Assets',\n  'Segoe Print',\n  'Segoe Script',\n  'Segoe UI',\n  'Segoe UI Historic',\n  'Segoe UI Emoji',\n  'Segoe UI Symbol',\n  'SimHei',\n  'SimSun',\n  'SimSun-ExtB',\n  'Sitka',\n  'Sylfaen',\n  'Tahoma',\n  'Times New Roman',\n  'Trebuchet MS',\n  'Verdana',\n  'XiHeiti',\n  'Yu Gothic',\n  'Yu Mincho',\n];\n\nexport const MACOS_FONTS = [\n  'American Typewriter',\n  'Andale Mono',\n  'Arial',\n  'Arial Black',\n  'Arial Narrow',\n  'Arial Rounded MT Bold',\n  'Arial Unicode MS',\n  'Avenir',\n  'Avenir Next',\n  'Avenir Next Condensed',\n  'Baskerville',\n  'BiauKai',\n  'Big Caslon',\n  'Bodoni 72',\n  'Bodoni 72 Oldstyle',\n  'Bodoni 72 Smallcaps',\n  'Bradley Hand',\n  'Brush Script MT',\n  'Chalkboard',\n  'Chalkboard SE',\n  'Chalkduster',\n  'Charter',\n  'Cochin',\n  'Comic Sans MS',\n  'Copperplate',\n  'Courier',\n  'Courier New',\n  'Didot',\n  'DIN Alternate',\n  'DIN Condensed',\n  'FangSong',\n  'Futura',\n  'Geneva',\n  'Georgia',\n  'Gill Sans',\n  'Heiti SC',\n  'Heiti TC',\n  'Helvetica',\n  'Helvetica Neue',\n  'Herculanum',\n  'Hiragino Sans',\n  'Hiragino Mincho',\n  'Hoefler Text',\n  'Impact',\n  'Kaiti SC',\n  'Kaiti TC',\n  'Kozuka Gothic Pro',\n  'Kozuka Mincho Pro',\n  'Lucida Grande',\n  'Luminari',\n  'LXGW WenKai GB Screen',\n  'LXGW WenKai TC',\n  'Marker Felt',\n  'Menlo',\n  'Microsoft Sans Serif',\n  'Monaco',\n  'Noteworthy',\n  'Noto Serif JP',\n  'Optima',\n  'Palatino',\n  'Papyrus',\n  'PingFang HK',\n  'PingFang SC',\n  'PingFang TC',\n  'Phosphate',\n  'Rockwell',\n  'Savoye LET',\n  'SignPainter',\n  'Skia',\n  'Snell Roundhand',\n  'Songti SC',\n  'Songti TC',\n  'STFangsong',\n  'STKaiti',\n  'STSong',\n  'STXihei',\n  'Tahoma',\n  'Times',\n  'Times New Roman',\n  'Trattatello',\n  'Trebuchet MS',\n  'Verdana',\n  'XiHeiti',\n  'Yu Mincho',\n  'Zapfino',\n];\n\nexport const LINUX_FONTS = [\n  'Arial',\n  'Cantarell',\n  'Comic Sans MS',\n  'Courier New',\n  'DejaVu Sans',\n  'DejaVu Sans Mono',\n  'DejaVu Serif',\n  'Droid Sans',\n  'Droid Sans Mono',\n  'FangSong',\n  'FreeMono',\n  'FreeSans',\n  'FreeSerif',\n  'Georgia',\n  'Heiti',\n  'Impact',\n  'Kaiti',\n  'Liberation Mono',\n  'Liberation Sans',\n  'Liberation Serif',\n  'LXGW WenKai GB Screen',\n  'LXGW WenKai TC',\n  'Noto Mono',\n  'Noto Sans',\n  'Noto Sans JP',\n  'Noto Sans CJK SC',\n  'Noto Sans CJK TC',\n  'Noto Serif',\n  'Noto Serif JP',\n  'Noto Serif CJK SC',\n  'Noto Serif CJK TC',\n  'Open Sans',\n  'Poppins',\n  'Sazanami Gothic',\n  'Sazanami Mincho',\n  'Source Han Sans',\n  'Source Han Serif',\n  'Times New Roman',\n  'Ubuntu',\n  'Ubuntu Mono',\n  'WenQuanYi Micro Hei',\n  'WenQuanYi Zen Hei',\n  'XiHeiti',\n];\n\nexport const IOS_FONTS = [\n  'Avenir',\n  'Avenir Next',\n  'Courier',\n  'Courier New',\n  'FangSong',\n  'Georgia',\n  'Heiti',\n  'Helvetica',\n  'Helvetica Neue',\n  'Hiragino Mincho',\n  'Hiragino Sans',\n  'Kaiti',\n  'LXGW WenKai GB Screen',\n  'LXGW WenKai TC',\n  'Palatino',\n  'PingFang SC',\n  'PingFang TC',\n  'San Francisco',\n  'SF Pro Display',\n  'SF Pro Rounded',\n  'SF Pro Text',\n  'Songti',\n  'Times New Roman',\n  'Verdana',\n  'XiHeiti',\n];\n\nexport const ANDROID_FONTS = [\n  'Arial',\n  'Droid Sans',\n  'Droid Serif',\n  'FangSong',\n  'FZLanTingHei',\n  'Georgia',\n  'Heiti',\n  'Kaiti',\n  'LXGW WenKai GB Screen',\n  'LXGW WenKai TC',\n  'Noto Sans',\n  'Noto Sans CJK',\n  'Noto Sans JP',\n  'Noto Serif',\n  'Noto Serif CJK',\n  'Noto Serif JP',\n  'PingFang SC',\n  'Roboto',\n  'Source Han Sans',\n  'Source Han Serif',\n  'STHeiti',\n  'STSong',\n  'Tahoma',\n  'Verdana',\n  'XiHeiti',\n];\n\nexport const CJK_EXCLUDE_PATTENS = new RegExp(\n  ['AlBayan', 'STIX', 'Kailasa', 'ITCTT', 'Luminari', 'Myanmar'].join('|'),\n  'i',\n);\nexport const CJK_FONTS_PATTENS = new RegExp(\n  [\n    'CJK',\n    'TC$',\n    'SC$',\n    'HK',\n    'JP',\n    'TW',\n    'Sim',\n    'Kai',\n    'Hei',\n    'Yan',\n    'Min',\n    'Khai',\n    'Yuan',\n    'Song',\n    'Ming',\n    'FZ',\n    'Huiwen',\n    'KingHwa',\n    'FangZheng',\n    'WenQuanYi',\n    'PingFang',\n    'Hiragino',\n    'Meiryo',\n    'Source\\\\s?Han',\n    'Yu\\\\s?Gothic',\n    'Yu\\\\s?Mincho',\n    'Mincho',\n    'Nanum',\n    'Malgun',\n    'Gulim',\n    'Dotum',\n    'Batang',\n    'Gungsuh',\n    'OPPO sans',\n    'MiSans',\n    'Fallback',\n  ].join('|'),\n  'i',\n);\n\nexport const BOOK_IDS_SEPARATOR = '+';\n\nexport const DOWNLOAD_READEST_URL = 'https://readest.com?utm_source=readest_web';\n\n// 支持通过环境变量自定义 API 地址（用于本地部署或自托管）\nexport const READEST_WEB_BASE_URL = process.env['NEXT_PUBLIC_WEB_BASE_URL'] || 'https://web.readest.com';\nexport const READEST_NODE_BASE_URL = process.env['NEXT_PUBLIC_NODE_BASE_URL'] || 'https://node.readest.com';\n\nconst LATEST_DOWNLOAD_BASE_URL = 'https://download.readest.com/releases';\n\nexport const READEST_UPDATER_FILE = `${LATEST_DOWNLOAD_BASE_URL}/latest.json`;\n\nexport const READEST_CHANGELOG_FILE = `${LATEST_DOWNLOAD_BASE_URL}/release-notes.json`;\n\n// 支持通过环境变量自定义存储 URL\nexport const READEST_PUBLIC_STORAGE_BASE_URL = process.env['NEXT_PUBLIC_STORAGE_BASE_URL'] || 'https://storage.readest.com';\n\nexport const READEST_OPDS_USER_AGENT = 'Readest/1.0 (OPDS Browser)';\n\nexport const SYNC_PROGRESS_INTERVAL_SEC = 3;\nexport const SYNC_NOTES_INTERVAL_SEC = 5;\nexport const SYNC_BOOKS_INTERVAL_SEC = 5;\nexport const CHECK_UPDATE_INTERVAL_SEC = 24 * 60 * 60;\n\nexport const MAX_ZOOM_LEVEL = 500;\nexport const MIN_ZOOM_LEVEL = 50;\nexport const ZOOM_STEP = 10;\n\nexport const DEFAULT_STORAGE_QUOTA: UserStorageQuota = {\n  free: 500 * 1024 * 1024,\n  plus: 5 * 1024 * 1024 * 1024,\n  pro: 20 * 1024 * 1024 * 1024,\n  purchase: 0,\n};\n\nexport const DEFAULT_DAILY_TRANSLATION_QUOTA: UserDailyTranslationQuota = {\n  free: 10 * 1024,\n  plus: 100 * 1024,\n  pro: 500 * 1024,\n  purchase: 0,\n};\n\nexport const DOUBLE_CLICK_INTERVAL_THRESHOLD_MS = 250;\nexport const DISABLE_DOUBLE_CLICK_ON_MOBILE = true;\nexport const LONG_HOLD_THRESHOLD = 500;\n\nexport const CUSTOM_THEME_TEMPLATES = [\n  {\n    light: {\n      fg: '#2b2b2b',\n      bg: '#f3f3f3',\n      primary: '#3c5a72',\n    },\n    dark: {\n      fg: '#d0d0d0',\n      bg: '#1a1c1f',\n      primary: '#486e8a',\n    },\n  },\n  {\n    light: {\n      fg: '#3f2f3c',\n      bg: '#f5ecf8',\n      primary: '#7b5291',\n    },\n    dark: {\n      fg: '#d6cadd',\n      bg: '#3a2c3d',\n      primary: '#bda0cc',\n    },\n  },\n  {\n    light: {\n      fg: '#2b2b2b',\n      bg: '#defcd9',\n      primary: '#00796b',\n    },\n    dark: {\n      fg: '#c8e6c9',\n      bg: '#273c33',\n      primary: '#26a69a',\n    },\n  },\n];\n\nexport const MIGHT_BE_RTL_LANGS = [\n  'zh',\n  'ja',\n  'ko',\n  'ar',\n  'he',\n  'fa',\n  'ur',\n  'dv',\n  'ps',\n  'sd',\n  'yi',\n  '',\n];\n\nexport const TRANSLATED_LANGS = {\n  en: 'English',\n  fr: 'Français',\n  de: 'Deutsch',\n  nl: 'Nederlands',\n  it: 'Italiano',\n  ja: '日本語',\n  ko: '한국어',\n  es: 'Español',\n  pt: 'Português',\n  ru: 'Русский',\n  ar: 'العربية',\n  fa: 'فارسی',\n  el: 'Ελληνικά',\n  uk: 'Українська',\n  pl: 'Polski',\n  tr: 'Türkçe',\n  hi: 'हिन्दी',\n  id: 'Indonesia',\n  vi: 'Tiếng Việt',\n  th: 'ภาษาไทย',\n  ms: 'Melayu',\n  bo: 'བོད་སྐད་',\n  bn: 'বাংলা',\n  ta: 'தமிழ்',\n  si: 'සිංහල',\n  'zh-CN': '简体中文',\n  'zh-TW': '正體中文',\n};\n\nexport const TRANSLATOR_LANGS: Record<string, string> = {\n  ...TRANSLATED_LANGS,\n  nb: 'Bokmål',\n  sv: 'Svenska',\n  fi: 'Suomi',\n  da: 'Dansk',\n  cs: 'Čeština',\n  hu: 'Magyar',\n  ro: 'Română',\n  bg: 'Български',\n  hr: 'Hrvatski',\n  lt: 'Lietuvių',\n  sl: 'Slovenščina',\n  sk: 'Slovenčina',\n  fa: 'فارسی',\n};\n\nexport const SUPPORTED_LANGS: Record<string, string> = { ...TRANSLATED_LANGS, zh: '中文' };\n\nexport const SUPPORTED_LANGNAMES: Record<string, string> = Object.fromEntries(\n  Object.entries(SUPPORTED_LANGS).map(([code, name]) => [name, code]),\n);\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAioBoC;AAhnBpC;AACA;;;AAEO,MAAM,cAAc;AACpB,MAAM,qBAAqB,GAAG,YAAY,MAAM,CAAC;AACjD,MAAM,qBAAqB,GAAG,YAAY,MAAM,CAAC;AACjD,MAAM,sBAAsB,GAAG,YAAY,OAAO,CAAC;AAEnD,MAAM,oBAAoB;AAE1B,MAAM,sBAAsB;IACjC;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;CACD;AACM,MAAM,sBAAsB,oBAAoB,GAAG,CAAC,CAAC,MAAQ,CAAC,CAAC,EAAE,KAAK,EAAE,IAAI,CAAC;AAC7E,MAAM,sBAAsB;AAC5B,MAAM,oBAAoB;AAE1B,MAAM,uBAAuB;IAAC;IAAO;IAAO;CAAO;AACnD,MAAM,uBAAuB,qBAAqB,GAAG,CAAC,CAAC,MAAQ,CAAC,CAAC,EAAE,KAAK,EAAE,IAAI,CAAC;AAE/E,MAAM,0BAA0B;IACrC,WAAW;IACX,UAAU;IACV,SAAS;IACT,UAAU;IACV,YAAY;IACZ,gBAAgB;IAChB,UAAU;IACV,SAAS;AACX;AAEO,MAAM,0BAAmD;IAC9D,WAAW;IACX,YAAY;IACZ,aAAa;IACb,qBAAqB;IACrB,qBAAqB;IACrB,oBAAoB;IACpB,kBAAkB;IAClB,gBAAgB;IAChB,kBAAkB,CAAC;IACnB,sBAAsB;IACtB,eAAe;IACf,eAAe,EAAE;IACjB,uBAAuB;IACvB,kBAAkB;IAClB,4BAA4B;IAC5B,iBAAiB;IACjB,eAAe;IACf,sBAAsB;IACtB,iBAAiB;IACjB,oBAAoB;IACpB,gBAAgB;IAEhB,QAAQ;IAER,mBAAmB;IACnB,qBAAqB;IACrB,mBAAmB;AACrB;AAEO,MAAM,iCAA0D;IACrE,gBAAgB;AAClB;AAEO,MAAM,sBAAsD;IACjE,KAAK;IACL,QAAQ;IACR,OAAO;IACP,MAAM;IACN,QAAQ;AACV;AAEO,MAAM,uBAAqC;IAChD,cAAc;IACd,iBAAiB;IACjB,eAAe;IACf,kBAAkB;IAClB,gBAAgB;IAChB,qBAAqB;IACrB,qBAAqB;IAErB,cAAc,EAAE;IAChB,gBAAgB;IAChB,iBAAiB;QACf,WAAW;QACX,WAAW;QACX,UAAU;IACZ;IACA,uBAAuB;IACvB,0BAA0B,EAAE;AAC9B;AAEO,MAAM,8BAAqD;IAChE,cAAc;IACd,iBAAiB;AACnB;AAEO,MAAM,oBAA8B;IACzC,WAAW;IACX,eAAe;IACf,eAAe;IACf,aAAa;IACb,gBAAgB;IAChB,iBAAiB;IACjB,iBAAiB;IACjB,YAAY;AACd;AAEO,MAAM,sBAAkC;IAC7C,aAAa;IACb,gBAAgB;IAChB,cAAc;IACd,eAAe;IACf,oBAAoB;IACpB,uBAAuB;IACvB,qBAAqB;IACrB,sBAAsB;IACtB,YAAY;IACZ,UAAU;IACV,cAAc;IACd,qBAAqB;IACrB,eAAe;IACf,oBAAoB;IACpB,kBAAkB;IAClB,kBAAkB;IAClB,gBAAgB;IAChB,eAAe,IAAA,uKAAuB;IACtC,cAAc,IAAA,sKAAsB;IACpC,UAAU;IACV,QAAQ;IACR,aAAa;IACb,UAAU;IACV,KAAK;IACL,kBAAkB;IAClB,aAAa;AACf;AAEO,MAAM,wBAAsC;IACjD,uBAAuB;IACvB,uBAAuB;AACzB;AAEO,MAAM,qBAAgC;IAC3C,WAAW;IACX,iBAAiB;IACjB,YAAY;IACZ,aAAa;IACb,eAAe;IACf,YAAY;IACZ,mBAAmB;IACnB,aAAa;IACb,sBAAsB;IACtB,OAAO;IACP,cAAc;IACd,gBAAgB;IAChB,eAAe;IACf,qBAAqB;IACrB,mBAAmB;IACnB,gBAAgB;IAChB,kBAAkB;IAClB,cAAc;IACd,gBAAgB;IAChB,kBAAkB;IAElB,UAAU;IACV,YAAY;IACZ,iBAAiB;AACnB;AAEO,MAAM,+BAAsD;IACjE,mBAAmB;IACnB,UAAU;IACV,aAAa;IACb,gBAAgB;IAChB,oBAAoB;IACpB,YAAY;AACd;AAEO,MAAM,4BAAmD;IAC9D,mBAAmB;IACnB,YAAY;IACZ,iBAAiB;IACjB,YAAY;AACd;AAEO,MAAM,qCAA4D;IACvE,eAAe;AACjB;AAEO,MAAM,6BAAoD;IAC/D,QAAQ;IACR,UAAU;IACV,kBAAkB;AACpB;AAEO,MAAM,sBAAkC;IAC7C,YAAY;IACZ,YAAY;IACZ,WAAW;IAEX,cAAc;IACd,aAAa;IAEb,YAAY;IACZ,YAAY;IACZ,kBAAkB;IAClB,mBAAmB;IACnB,oBAAoB;IACpB,kBAAkB;IAClB,mBAAmB;IACnB,qBAAqB;IACrB,eAAe;IACf,kBAAkB;AACpB;AAEO,MAAM,qBAAgC;IAC3C,SAAS;IACT,UAAU;IACV,aAAa;IACb,YAAY;IACZ,qBAAqB;QAAE,OAAO;QAAa,OAAO;IAAU;AAC9D;AAEO,MAAM,4BAA8C;IACzD,oBAAoB;IACpB,qBAAqB;IACrB,qBAAqB;IACrB,qBAAqB;IACrB,kBAAkB;AACpB;AAEO,MAAM,6BAA+C;IAC1D,cAAc;IACd,eAAe;IACf,aAAa;IACb,sBAAsB;IACtB,eAAe;IACf,cAAc;IACd,kBAAkB;IAClB,yBAAyB;IACzB,eAAe;IACf,mBAAmB;IACnB,gBAAgB;AAClB;AAEO,MAAM,2BAA4C;IACvD,8BAA8B;IAC9B,uBAAuB;IACvB,gBAAgB;IAChB,kBAAkB;AACpB;AAEO,MAAM,wBAAsC;IACjD,mBAAmB;AACrB;AAEO,MAAM,6BAA+C;IAC1D,OAAO;IACP,WAAW;IACX,iBAAiB;IACjB,iBAAiB;AACnB;AAEO,MAAM,0BAA0B;AAEhC,MAAM,cAAc;IACzB;IACA;IACA;IACA;IACA;IACA;IACA;IACA;CACD;AAEM,MAAM,iBAAiB;IAAC;IAAW;CAAkB;AAErD,MAAM,kBAAkB;IAC7B,IAAA,6JAAC,EAAC;IACF,IAAA,6JAAC,EAAC;IACF,IAAA,6JAAC,EAAC;IACF,IAAA,6JAAC,EAAC;IACF,IAAA,6JAAC,EAAC;IACF,IAAA,6JAAC,EAAC;CACH;AAEM,MAAM,uBAAuB;IAAC;IAAgB;CAAe;AAE7D,MAAM,mBAAmB;IAAC;IAAU;IAAa;IAAa;IAAW;CAAY;AAErF,MAAM,kBAAkB;IAC7B;IACA;IACA;IACA;IACA;CACD;AAEM,MAAM,iBAAiB;IAAC;CAAY;AAEpC,MAAM,gBAAgB;IAC3B;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;CACD;AAEM,MAAM,cAAc;IACzB;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;CACD;AAEM,MAAM,cAAc;IACzB;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;CACD;AAEM,MAAM,YAAY;IACvB;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IAC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"}},
    {"offset": {"line": 1523, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/services/environment.ts"],"sourcesContent":["import { AppService } from '@/types/system';\nimport { READEST_NODE_BASE_URL, READEST_WEB_BASE_URL } from './constants';\n\ndeclare global {\n  interface Window {\n    __READEST_CLI_ACCESS?: boolean;\n  }\n}\n\nconst appPlatform = process.env['NEXT_PUBLIC_APP_PLATFORM'] || 'web';\nexport const isTauriAppPlatform = () => appPlatform === 'tauri';\nexport const isWebAppPlatform = () => appPlatform === 'web';\nexport const hasCli = () => window.__READEST_CLI_ACCESS === true;\nexport const isPWA = () => window.matchMedia('(display-mode: standalone)').matches;\nexport const getBaseUrl = () => process.env['NEXT_PUBLIC_API_BASE_URL'] ?? READEST_WEB_BASE_URL;\nexport const getNodeBaseUrl = () =>\n  process.env['NEXT_PUBLIC_NODE_BASE_URL'] ?? READEST_NODE_BASE_URL;\n\nconst isWebDevMode = () => process.env['NODE_ENV'] === 'development' && isWebAppPlatform();\n\n// Dev API only in development mode and web platform\n// with command `pnpm dev-web`\n// for production build or tauri app use the production Web API\nexport const getAPIBaseUrl = () => (isWebDevMode() ? '/api' : `${getBaseUrl()}/api`);\n\n// For Node.js API that currently not supported in some edge runtimes\nexport const getNodeAPIBaseUrl = () => (isWebDevMode() ? '/api' : `${getNodeBaseUrl()}/api`);\n\nexport interface EnvConfigType {\n  getAppService: () => Promise<AppService>;\n}\n\nlet nativeAppService: AppService | null = null;\nconst getNativeAppService = async () => {\n  if (!nativeAppService) {\n    const { NativeAppService } = await import('@/services/nativeAppService');\n    nativeAppService = new NativeAppService();\n    await nativeAppService.init();\n  }\n  return nativeAppService;\n};\n\nlet webAppService: AppService | null = null;\nconst getWebAppService = async () => {\n  if (!webAppService) {\n    const { WebAppService } = await import('@/services/webAppService');\n    webAppService = new WebAppService();\n    await webAppService.init();\n  }\n  return webAppService;\n};\n\nconst environmentConfig: EnvConfigType = {\n  getAppService: async () => {\n    // Check if actually running in Tauri environment (runtime check)\n    const isTauriRuntime = typeof window !== 'undefined' && (window as any).__TAURI__;\n\n    if (isTauriAppPlatform() && isTauriRuntime) {\n      return getNativeAppService();\n    } else {\n      return getWebAppService();\n    }\n  },\n};\n\nexport default environmentConfig;\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;AASoB;AARpB;;AAQA,MAAM,cAAc,2CAA2C;AACxD,MAAM,qBAAqB,IAAM,gBAAgB;AACjD,MAAM,mBAAmB,IAAM,gBAAgB;AAC/C,MAAM,SAAS,IAAM,OAAO,oBAAoB,KAAK;AACrD,MAAM,QAAQ,IAAM,OAAO,UAAU,CAAC,8BAA8B,OAAO;AAC3E,MAAM,aAAa,IAAM,6DAA2C,0KAAoB;AACxF,MAAM,iBAAiB,IAC5B,6DAA4C,2KAAqB;AAEnE,MAAM,eAAe,IAAM,oDAA4B,iBAAiB;AAKjE,MAAM,gBAAgB,IAAO,iBAAiB,SAAS;AAGvD,MAAM,oBAAoB,IAAO,iBAAiB,SAAS;AAMlE,IAAI,mBAAsC;AAC1C,MAAM,sBAAsB;IAC1B,IAAI,CAAC,kBAAkB;QACrB,MAAM,EAAE,gBAAgB,EAAE,GAAG;QAC7B,mBAAmB,IAAI;QACvB,MAAM,iBAAiB,IAAI;IAC7B;IACA,OAAO;AACT;AAEA,IAAI,gBAAmC;AACvC,MAAM,mBAAmB;IACvB,IAAI,CAAC,eAAe;QAClB,MAAM,EAAE,aAAa,EAAE,GAAG;QAC1B,gBAAgB,IAAI;QACpB,MAAM,cAAc,IAAI;IAC1B;IACA,OAAO;AACT;AAEA,MAAM,oBAAmC;IACvC,eAAe;QACb,iEAAiE;QACjE,MAAM,iBAAiB,+CAAkB,eAAe,AAAC,OAAe,SAAS;QAEjF,IAAI,wBAAwB;;aAErB;YACL,OAAO;QACT;IACF;AACF;uCAEe"}},
    {"offset": {"line": 1593, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/context/EnvContext.tsx"],"sourcesContent":["'use client';\n\nimport React, { createContext, useContext, useState, ReactNode } from 'react';\nimport { EnvConfigType } from '../services/environment';\nimport { AppService } from '@/types/system';\nimport env from '../services/environment';\n\ninterface EnvContextType {\n  envConfig: EnvConfigType;\n  appService: AppService | null;\n}\n\nconst EnvContext = createContext<EnvContextType | undefined>(undefined);\n\nexport const EnvProvider = ({ children }: { children: ReactNode }) => {\n  const [envConfig] = useState<EnvConfigType>(env);\n  const [appService, setAppService] = useState<AppService | null>(null);\n\n  React.useEffect(() => {\n    envConfig.getAppService().then((service) => setAppService(service));\n    window.addEventListener('error', (e) => {\n      if (e.message === 'ResizeObserver loop limit exceeded') {\n        e.stopImmediatePropagation();\n        e.preventDefault();\n        return true;\n      }\n      return false;\n    });\n  }, [envConfig]);\n\n  return <EnvContext.Provider value={{ envConfig, appService }}>{children}</EnvContext.Provider>;\n};\n\nexport const useEnv = (): EnvContextType => {\n  const context = useContext(EnvContext);\n  if (!context) throw new Error('useEnv must be used within EnvProvider');\n  return context;\n};\n"],"names":[],"mappings":";;;;;;;AAEA;AAGA;;;AALA;;;AAYA,MAAM,2BAAa,IAAA,8LAAa,EAA6B;AAEtD,MAAM,cAAc,CAAC,EAAE,QAAQ,EAA2B;;IAC/D,MAAM,CAAC,UAAU,GAAG,IAAA,yLAAQ,EAAgB,+JAAG;IAC/C,MAAM,CAAC,YAAY,cAAc,GAAG,IAAA,yLAAQ,EAAoB;IAEhE,wLAAK,CAAC,SAAS;iCAAC;YACd,UAAU,aAAa,GAAG,IAAI;yCAAC,CAAC,UAAY,cAAc;;YAC1D,OAAO,gBAAgB,CAAC;yCAAS,CAAC;oBAChC,IAAI,EAAE,OAAO,KAAK,sCAAsC;wBACtD,EAAE,wBAAwB;wBAC1B,EAAE,cAAc;wBAChB,OAAO;oBACT;oBACA,OAAO;gBACT;;QACF;gCAAG;QAAC;KAAU;IAEd,qBAAO,6MAAC,WAAW,QAAQ;QAAC,OAAO;YAAE;YAAW;QAAW;kBAAI;;;;;;AACjE;GAjBa;KAAA;AAmBN,MAAM,SAAS;;IACpB,MAAM,UAAU,IAAA,2LAAU,EAAC;IAC3B,IAAI,CAAC,SAAS,MAAM,IAAI,MAAM;IAC9B,OAAO;AACT;IAJa"}},
    {"offset": {"line": 1660, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/utils/polyfill.ts"],"sourcesContent":["// A groupBy polyfill for foliate-js\nObject.groupBy ??= (iterable, callbackfn) => {\n  const obj = Object.create(null);\n  let i = 0;\n  for (const value of iterable) {\n    const key = callbackfn(value, i++);\n    if (key in obj) {\n      obj[key].push(value);\n    } else {\n      obj[key] = [value];\n    }\n  }\n  return obj;\n};\n\nMap.groupBy ??= (iterable, callbackfn) => {\n  const map = new Map();\n  let i = 0;\n  for (const value of iterable) {\n    const key = callbackfn(value, i++),\n      list = map.get(key);\n    if (list) {\n      list.push(value);\n    } else {\n      map.set(key, [value]);\n    }\n  }\n  return map;\n};\n"],"names":[],"mappings":"AAAA,oCAAoC;AACpC,OAAO,OAAO,KAAK,CAAC,UAAU;IAC5B,MAAM,MAAM,OAAO,MAAM,CAAC;IAC1B,IAAI,IAAI;IACR,KAAK,MAAM,SAAS,SAAU;QAC5B,MAAM,MAAM,WAAW,OAAO;QAC9B,IAAI,OAAO,KAAK;YACd,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC;QAChB,OAAO;YACL,GAAG,CAAC,IAAI,GAAG;gBAAC;aAAM;QACpB;IACF;IACA,OAAO;AACT;AAEA,IAAI,OAAO,KAAK,CAAC,UAAU;IACzB,MAAM,MAAM,IAAI;IAChB,IAAI,IAAI;IACR,KAAK,MAAM,SAAS,SAAU;QAC5B,MAAM,MAAM,WAAW,OAAO,MAC5B,OAAO,IAAI,GAAG,CAAC;QACjB,IAAI,MAAM;YACR,KAAK,IAAI,CAAC;QACZ,OAAO;YACL,IAAI,GAAG,CAAC,KAAK;gBAAC;aAAM;QACtB;IACF;IACA,OAAO;AACT"}},
    {"offset": {"line": 1697, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/i18next-scanner.config.js"],"sourcesContent":["module.exports = {\n  input: ['src/**/*.{js,jsx,ts,tsx}', '!src/**/*.test.{js,jsx,ts,tsx}'],\n  output: '.',\n  options: {\n    debug: false,\n    sort: false,\n    func: {\n      list: ['_'],\n      extensions: ['.js', '.jsx', '.ts', '.tsx'],\n    },\n    lngs: [\n      'de',\n      'ja',\n      'es',\n      'fa',\n      'fr',\n      'it',\n      'el',\n      'ko',\n      'uk',\n      'nl',\n      'sv',\n      'pl',\n      'pt',\n      'ru',\n      'tr',\n      'hi',\n      'id',\n      'vi',\n      'ms',\n      'ar',\n      'th',\n      'bo',\n      'bn',\n      'ta',\n      'si',\n      'zh-CN',\n      'zh-TW',\n    ],\n    ns: ['translation'],\n    defaultNs: 'translation',\n    defaultValue: '__STRING_NOT_TRANSLATED__',\n    resource: {\n      loadPath: './public/locales/{{lng}}/{{ns}}.json',\n      savePath: './public/locales/{{lng}}/{{ns}}.json',\n      jsonIndent: 2,\n      lineEnding: '\\n',\n    },\n    keySeparator: false,\n    nsSeparator: false,\n    interpolation: {\n      prefix: '{{',\n      suffix: '}}',\n    },\n    metadata: {},\n    allowDynamicKeys: true,\n    removeUnusedKeys: true,\n  },\n};\n"],"names":[],"mappings":"AAAA,OAAO,OAAO,GAAG;IACf,OAAO;QAAC;QAA4B;KAAiC;IACrE,QAAQ;IACR,SAAS;QACP,OAAO;QACP,MAAM;QACN,MAAM;YACJ,MAAM;gBAAC;aAAI;YACX,YAAY;gBAAC;gBAAO;gBAAQ;gBAAO;aAAO;QAC5C;QACA,MAAM;YACJ;YACA;YACA;YACA;YACA;YACA;YACA;YACA;YACA;YACA;YACA;YACA;YACA;YACA;YACA;YACA;YACA;YACA;YACA;YACA;YACA;YACA;YACA;YACA;YACA;YACA;YACA;SACD;QACD,IAAI;YAAC;SAAc;QACnB,WAAW;QACX,cAAc;QACd,UAAU;YACR,UAAU;YACV,UAAU;YACV,YAAY;YACZ,YAAY;QACd;QACA,cAAc;QACd,aAAa;QACb,eAAe;YACb,QAAQ;YACR,QAAQ;QACV;QACA,UAAU,CAAC;QACX,kBAAkB;QAClB,kBAAkB;IACpB;AACF"}},
    {"offset": {"line": 1775, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/i18n/i18n.ts"],"sourcesContent":["import i18n from 'i18next';\nimport LanguageDetector from 'i18next-browser-languagedetector';\nimport { initReactI18next } from 'react-i18next';\nimport { options } from '../../i18next-scanner.config';\n\nconst isBrowser = typeof window !== 'undefined';\n\nconst initI18n = async () => {\n  if (isBrowser) {\n    const HttpApi = (await import('i18next-http-backend')).default;\n    i18n.use(HttpApi);\n  }\n\n  i18n\n    .use(LanguageDetector)\n    .use(initReactI18next)\n    .init({\n      supportedLngs: ['en', ...options.lngs],\n      fallbackLng: {\n        'zh-HK': ['zh-TW', 'zh-CN', 'en'],\n        kk: ['ru', 'en'],\n        ky: ['ru', 'en'],\n        tk: ['ru', 'en'],\n        uz: ['ru', 'en'],\n        ug: ['ru', 'en'],\n        tt: ['ru', 'en'],\n        default: ['zh-CN', 'en'],\n      },\n      ns: options.ns,\n      defaultNS: options.defaultNs,\n      ...(isBrowser && {\n        backend: {\n          loadPath: '/locales/{{lng}}/{{ns}}.json',\n        },\n      }),\n      detection: {\n        order: ['querystring', 'localStorage', 'navigator'],\n        caches: ['localStorage'],\n      },\n      keySeparator: false,\n      nsSeparator: false,\n      interpolation: {\n        escapeValue: false,\n      },\n      react: {\n        useSuspense: false,\n      },\n    });\n\n  i18n.on('languageChanged', (lng) => {\n    console.log('Language changed to', lng);\n  });\n};\n\ninitI18n();\n\nexport default i18n;\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AAAA;AACA;;;;;AAEA,MAAM,YAAY,+CAAkB;AAEpC,MAAM,WAAW;IACf,wCAAe;QACb,MAAM,UAAU,CAAC,2KAAoC,EAAE,OAAO;QAC9D,uOAAI,CAAC,GAAG,CAAC;IACX;IAEA,uOAAI,CACD,GAAG,CAAC,iSAAgB,EACpB,GAAG,CAAC,mXAAgB,EACpB,IAAI,CAAC;QACJ,eAAe;YAAC;eAAS,6JAAO,CAAC,IAAI;SAAC;QACtC,aAAa;YACX,SAAS;gBAAC;gBAAS;gBAAS;aAAK;YACjC,IAAI;gBAAC;gBAAM;aAAK;YAChB,IAAI;gBAAC;gBAAM;aAAK;YAChB,IAAI;gBAAC;gBAAM;aAAK;YAChB,IAAI;gBAAC;gBAAM;aAAK;YAChB,IAAI;gBAAC;gBAAM;aAAK;YAChB,IAAI;gBAAC;gBAAM;aAAK;YAChB,SAAS;gBAAC;gBAAS;aAAK;QAC1B;QACA,IAAI,6JAAO,CAAC,EAAE;QACd,WAAW,6JAAO,CAAC,SAAS;QAC5B,GAAI,aAAa;YACf,SAAS;gBACP,UAAU;YACZ;QACF,CAAC;QACD,WAAW;YACT,OAAO;gBAAC;gBAAe;gBAAgB;aAAY;YACnD,QAAQ;gBAAC;aAAe;QAC1B;QACA,cAAc;QACd,aAAa;QACb,eAAe;YACb,aAAa;QACf;QACA,OAAO;YACL,aAAa;QACf;IACF;IAEF,uOAAI,CAAC,EAAE,CAAC,mBAAmB,CAAC;QAC1B,QAAQ,GAAG,CAAC,uBAAuB;IACrC;AACF;AAEA;uCAEe,uOAAI"}},
    {"offset": {"line": 1873, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/context/AuthContext.tsx"],"sourcesContent":["'use client';\n\nimport React, { createContext, useState, useContext, ReactNode, useEffect } from 'react';\n\ninterface AuthUser {\n  id?: string;\n  username: string;\n  name: string;\n  user_metadata?: {\n    picture?: string;\n    avatar_url?: string;\n    full_name?: string;\n    [key: string]: unknown;\n  };\n}\n\ninterface AuthContextType {\n  token: string | null;\n  user: AuthUser | null;\n  login: (token: string, user: AuthUser) => void;\n  logout: () => void;\n  isLoggedIn: boolean;\n}\n\nconst AuthContext = createContext<AuthContextType | undefined>(undefined);\n\nexport const AuthProvider = ({ children }: { children: ReactNode }) => {\n  const [token, setToken] = useState<string | null>(() => {\n    if (typeof window !== 'undefined') {\n      return localStorage.getItem('token');\n    }\n    return null;\n  });\n  const [user, setUser] = useState<AuthUser | null>(() => {\n    if (typeof window !== 'undefined') {\n      const userJson = localStorage.getItem('user');\n      return userJson ? JSON.parse(userJson) : null;\n    }\n    return null;\n  });\n\n  // 验证已存储的令牌\n  useEffect(() => {\n    const verifyToken = async () => {\n      if (token && !user) {\n        try {\n          const response = await fetch('/api/auth/verify', {\n            headers: {\n              Authorization: `Bearer ${token}`,\n            },\n          });\n\n          if (response.ok) {\n            const data = await response.json();\n            setUser(data.user);\n            localStorage.setItem('user', JSON.stringify(data.user));\n          } else {\n            // Token 无效，清除\n            localStorage.removeItem('token');\n            localStorage.removeItem('user');\n            setToken(null);\n            setUser(null);\n          }\n        } catch (error) {\n          console.error('Token verification failed:', error);\n          localStorage.removeItem('token');\n          localStorage.removeItem('user');\n          setToken(null);\n          setUser(null);\n        }\n      }\n    };\n\n    verifyToken();\n  }, [token, user]);\n\n  const login = (newToken: string, newUser: AuthUser) => {\n    console.log('Logging in as', newUser.username);\n    setToken(newToken);\n    setUser(newUser);\n    localStorage.setItem('token', newToken);\n    localStorage.setItem('user', JSON.stringify(newUser));\n  };\n\n  const logout = async () => {\n    console.log('Logging out');\n    try {\n      await fetch('/api/auth/logout', {\n        method: 'POST',\n        headers: {\n          Authorization: `Bearer ${token}`,\n        },\n      });\n    } catch (error) {\n      console.error('Logout request failed:', error);\n    } finally {\n      localStorage.removeItem('token');\n      localStorage.removeItem('user');\n      setToken(null);\n      setUser(null);\n    }\n  };\n\n  const value: AuthContextType = {\n    token,\n    user,\n    login,\n    logout,\n    isLoggedIn: !!token && !!user,\n  };\n\n  return <AuthContext.Provider value={value}>{children}</AuthContext.Provider>;\n};\n\nexport const useAuth = (): AuthContextType => {\n  const context = useContext(AuthContext);\n  if (!context) {\n    throw new Error('useAuth must be used within an AuthProvider');\n  }\n  return context;\n};\n"],"names":[],"mappings":";;;;;;;AAEA;;;AAFA;;AAwBA,MAAM,4BAAc,IAAA,8LAAa,EAA8B;AAExD,MAAM,eAAe,CAAC,EAAE,QAAQ,EAA2B;;IAChE,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,yLAAQ;iCAAgB;YAChD,wCAAmC;gBACjC,OAAO,aAAa,OAAO,CAAC;YAC9B;;;QAEF;;IACA,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,yLAAQ;iCAAkB;YAChD,wCAAmC;gBACjC,MAAM,WAAW,aAAa,OAAO,CAAC;gBACtC,OAAO,WAAW,KAAK,KAAK,CAAC,YAAY;YAC3C;;;QAEF;;IAEA,WAAW;IACX,IAAA,0LAAS;kCAAC;YACR,MAAM;sDAAc;oBAClB,IAAI,SAAS,CAAC,MAAM;wBAClB,IAAI;4BACF,MAAM,WAAW,MAAM,MAAM,oBAAoB;gCAC/C,SAAS;oCACP,eAAe,CAAC,OAAO,EAAE,OAAO;gCAClC;4BACF;4BAEA,IAAI,SAAS,EAAE,EAAE;gCACf,MAAM,OAAO,MAAM,SAAS,IAAI;gCAChC,QAAQ,KAAK,IAAI;gCACjB,aAAa,OAAO,CAAC,QAAQ,KAAK,SAAS,CAAC,KAAK,IAAI;4BACvD,OAAO;gCACL,cAAc;gCACd,aAAa,UAAU,CAAC;gCACxB,aAAa,UAAU,CAAC;gCACxB,SAAS;gCACT,QAAQ;4BACV;wBACF,EAAE,OAAO,OAAO;4BACd,QAAQ,KAAK,CAAC,8BAA8B;4BAC5C,aAAa,UAAU,CAAC;4BACxB,aAAa,UAAU,CAAC;4BACxB,SAAS;4BACT,QAAQ;wBACV;oBACF;gBACF;;YAEA;QACF;iCAAG;QAAC;QAAO;KAAK;IAEhB,MAAM,QAAQ,CAAC,UAAkB;QAC/B,QAAQ,GAAG,CAAC,iBAAiB,QAAQ,QAAQ;QAC7C,SAAS;QACT,QAAQ;QACR,aAAa,OAAO,CAAC,SAAS;QAC9B,aAAa,OAAO,CAAC,QAAQ,KAAK,SAAS,CAAC;IAC9C;IAEA,MAAM,SAAS;QACb,QAAQ,GAAG,CAAC;QACZ,IAAI;YACF,MAAM,MAAM,oBAAoB;gBAC9B,QAAQ;gBACR,SAAS;oBACP,eAAe,CAAC,OAAO,EAAE,OAAO;gBAClC;YACF;QACF,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,0BAA0B;QAC1C,SAAU;YACR,aAAa,UAAU,CAAC;YACxB,aAAa,UAAU,CAAC;YACxB,SAAS;YACT,QAAQ;QACV;IACF;IAEA,MAAM,QAAyB;QAC7B;QACA;QACA;QACA;QACA,YAAY,CAAC,CAAC,SAAS,CAAC,CAAC;IAC3B;IAEA,qBAAO,6MAAC,YAAY,QAAQ;QAAC,OAAO;kBAAQ;;;;;;AAC9C;GAtFa;KAAA;AAwFN,MAAM,UAAU;;IACrB,MAAM,UAAU,IAAA,2LAAU,EAAC;IAC3B,IAAI,CAAC,SAAS;QACZ,MAAM,IAAI,MAAM;IAClB;IACA,OAAO;AACT;IANa"}},
    {"offset": {"line": 2007, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/utils/telemetry.ts"],"sourcesContent":["import posthog from 'posthog-js';\n\nexport const TELEMETRY_OPT_OUT_KEY = 'readest-telemetry-opt-out';\n\nexport const hasOptedOutTelemetry = () => {\n  return localStorage.getItem(TELEMETRY_OPT_OUT_KEY) === 'true';\n};\n\nexport const captureEvent = (event: string, properties?: Record<string, unknown>) => {\n  if (!hasOptedOutTelemetry()) {\n    posthog.capture(event, properties);\n  }\n};\n\nexport const optInTelemetry = () => {\n  localStorage.setItem(TELEMETRY_OPT_OUT_KEY, 'false');\n  posthog.opt_in_capturing();\n};\nexport const optOutTelemetry = () => {\n  localStorage.setItem(TELEMETRY_OPT_OUT_KEY, 'true');\n  posthog.opt_out_capturing();\n};\n"],"names":[],"mappings":";;;;;;;;;;;;AAAA;;AAEO,MAAM,wBAAwB;AAE9B,MAAM,uBAAuB;IAClC,OAAO,aAAa,OAAO,CAAC,2BAA2B;AACzD;AAEO,MAAM,eAAe,CAAC,OAAe;IAC1C,IAAI,CAAC,wBAAwB;QAC3B,kNAAO,CAAC,OAAO,CAAC,OAAO;IACzB;AACF;AAEO,MAAM,iBAAiB;IAC5B,aAAa,OAAO,CAAC,uBAAuB;IAC5C,kNAAO,CAAC,gBAAgB;AAC1B;AACO,MAAM,kBAAkB;IAC7B,aAAa,OAAO,CAAC,uBAAuB;IAC5C,kNAAO,CAAC,iBAAiB;AAC3B"}},
    {"offset": {"line": 2044, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/apps/readest-app/package.json"],"sourcesContent":["{\"name\":\"@readest/readest-app\",\"version\":\"0.9.97\",\"private\":true,\"scripts\":{\"dev\":\"dotenv -e .env.tauri -- next dev\",\"build\":\"dotenv -e .env.tauri -- next build\",\"start\":\"dotenv -e .env.tauri -- next start\",\"dev-web\":\"dotenv -e .env.web -- next dev\",\"build-web\":\"dotenv -e .env.web -- next build\",\"start-web\":\"dotenv -e .env.web -- next start\",\"build-tauri\":\"dotenv -e .env.tauri -- next build\",\"i18n:extract\":\"i18next-scanner\",\"lint\":\"eslint .\",\"test\":\"dotenv -e .env -e .env.test.local vitest\",\"tauri\":\"tauri\",\"clippy\":\"cargo clippy -p Readest --no-deps -- -D warnings\",\"prepare-public-vendor\":\"mkdirp ./public/vendor/pdfjs ./public/vendor/simplecc\",\"copy-pdfjs-js\":\"cpx \\\"../../packages/foliate-js/node_modules/pdfjs-dist/legacy/build/{pdf.worker.min.mjs,pdf.min.mjs,pdf.d.mts}\\\" ./public/vendor/pdfjs\",\"copy-pdfjs-wasm\":\"cpx \\\"../../packages/foliate-js/node_modules/pdfjs-dist/wasm/{openjpeg.wasm,qcms_bg.wasm}\\\" ./public/vendor/pdfjs\",\"copy-pdfjs-fonts\":\"cpx \\\"../../packages/foliate-js/node_modules/pdfjs-dist/{cmaps,standard_fonts}/*\\\" ./public/vendor/pdfjs\",\"copy-flatten-pdfjs-annotation-layer-css\":\"npx postcss \\\"../../packages/foliate-js/vendor/pdfjs/annotation_layer_builder.css\\\" --no-map -u postcss-nested > ./public/vendor/pdfjs/annotation_layer_builder.css\",\"copy-flatten-pdfjs-text-layer-css\":\"npx postcss \\\"../../packages/foliate-js/vendor/pdfjs/text_layer_builder.css\\\" --no-map -u postcss-nested > ./public/vendor/pdfjs/text_layer_builder.css\",\"copy-flatten-pdfjs-css\":\"pnpm copy-flatten-pdfjs-annotation-layer-css && pnpm copy-flatten-pdfjs-text-layer-css\",\"copy-pdfjs\":\"pnpm copy-pdfjs-js && pnpm copy-pdfjs-wasm && pnpm copy-pdfjs-fonts && pnpm copy-flatten-pdfjs-css\",\"copy-simplecc\":\"cpx \\\"../../packages/simplecc-wasm/dist/web/*\\\" ./public/vendor/simplecc\",\"setup-pdfjs\":\"pnpm prepare-public-vendor && pnpm copy-pdfjs\",\"setup-simplecc\":\"pnpm prepare-public-vendor && pnpm copy-simplecc\",\"setup-vendors\":\"pnpm setup-pdfjs && pnpm setup-simplecc\",\"build-win-x64\":\"dotenv -e .env.tauri.local -- tauri build --target i686-pc-windows-msvc --bundles nsis\",\"build-win-arm64\":\"dotenv -e .env.tauri.local -- tauri build --target aarch64-pc-windows-msvc --bundles nsis\",\"build-linux-x64\":\"dotenv -e .env.tauri.local -- tauri build --target x86_64-unknown-linux-gnu --bundles appimage\",\"build-macos-universial\":\"dotenv -e .env.tauri.local -e .env.apple-nonstore.local -- tauri build -t universal-apple-darwin --bundles dmg\",\"build-macos-universial-appstore\":\"dotenv -e .env.tauri.local -e .env.apple-appstore.local -- tauri build -t universal-apple-darwin --bundles app --config src-tauri/tauri.appstore.conf.json\",\"build-macos-universial-appstore-dev\":\"dotenv -e .env.tauri.local -e .env.apple-appstore-dev.local -- tauri build -t universal-apple-darwin --bundles app --config src-tauri/tauri.appstore-dev.conf.json\",\"build-ios\":\"dotenv -e .env.ios-appstore-dev.local -- tauri ios build\",\"build-ios-appstore\":\"dotenv -e .env.ios-appstore.local -- tauri ios build --export-method app-store-connect\",\"release-macos-universial-appstore\":\"dotenv -e .env.tauri.local -e .env.apple-appstore.local -- bash scripts/release-mac-appstore.sh\",\"release-ios-appstore\":\"dotenv -e .env.ios-appstore.local -- bash scripts/release-ios-appstore.sh\",\"release-google-play\":\"dotenv -e .env.google-play.local -- bash scripts/release-google-play.sh\",\"config-wrangler\":\"sed -i \\\"s/\\\\${TRANSLATIONS_KV_ID}/$TRANSLATIONS_KV_ID/g\\\" wrangler.toml\",\"preview\":\"pnpm patch-build-webpack && NEXT_PUBLIC_APP_PLATFORM=web opennextjs-cloudflare build && pnpm restore-build-original && opennextjs-cloudflare preview --ip 0.0.0.0 --port 3001\",\"deploy\":\"pnpm patch-build-webpack && NEXT_PUBLIC_APP_PLATFORM=web opennextjs-cloudflare build && pnpm restore-build-original && opennextjs-cloudflare deploy\",\"upload\":\"pnpm patch-build-webpack && NEXT_PUBLIC_APP_PLATFORM=web opennextjs-cloudflare build && pnpm restore-build-original && opennextjs-cloudflare upload\",\"cf-typegen\":\"wrangler types --env-interface CloudflareEnv cloudflare-env.d.ts\",\"patch-build-webpack\":\"if [ \\\"$(uname)\\\" = \\\"Darwin\\\" ]; then sed -i '' 's/next build\\\"/next build --webpack\\\"/' package.json; else sed -i 's/next build\\\"/next build --webpack\\\"/' package.json; fi\",\"restore-build-original\":\"if [ \\\"$(uname)\\\" = \\\"Darwin\\\" ]; then sed -i '' 's/next build --webpack\\\"/next build\\\"/' package.json; else sed -i 's/next build --webpack\\\"/next build\\\"/' package.json; fi\",\"update-metadata\":\"bash ./scripts/sync-release-notes.sh release-notes.json ../../data/metainfo/appdata.xml\",\"check:optional-chaining\":\"count=$(grep -rno '\\\\?\\\\.[a-zA-Z_$]' .next/static/chunks/* out/_next/static/chunks/* | wc -l); if [ \\\"$count\\\" -gt 0 ]; then echo '❌ Optional chaining found in output!'; exit 1; else echo '✅ No optional chaining found.'; fi\",\"check:translations\":\"count=$(grep -rno '__STRING_NOT_TRANSLATED__' public/locales/* | wc -l); if [ \\\"$count\\\" -gt 0 ]; then echo '❌ Untranslated strings found!'; exit 1; else echo '✅ All strings translated.'; fi\",\"check:lookbehind-regex\":\"count=$(grep -rnoE '\\\\(\\\\?<[!=]' .next/static/chunks/* out/_next/static/chunks/* | wc -l); if [ \\\"$count\\\" -gt 0 ]; then echo '❌ Lookbehind regex found in output!'; exit 1; else echo '✅ No lookbehind regex found.'; fi\",\"check:all\":\"pnpm check:translations && pnpm check:lookbehind-regex\",\"build-check\":\"pnpm build && pnpm build-web && pnpm check:all\"},\"dependencies\":{\"@choochmeque/tauri-plugin-sharekit-api\":\"^0.3.0\",\"@fabianlars/tauri-plugin-oauth\":\"2\",\"@opennextjs/cloudflare\":\"^1.14.7\",\"@serwist/next\":\"^9.4.2\",\"jose\":\"^5.9.6\",\"@tauri-apps/api\":\"2.9.1\",\"@tauri-apps/plugin-cli\":\"^2.4.1\",\"@tauri-apps/plugin-deep-link\":\"^2.4.6\",\"@tauri-apps/plugin-dialog\":\"^2.6.0\",\"@tauri-apps/plugin-fs\":\"^2.4.5\",\"@tauri-apps/plugin-haptics\":\"^2.3.2\",\"@tauri-apps/plugin-http\":\"^2.5.6\",\"@tauri-apps/plugin-log\":\"^2.8.0\",\"@tauri-apps/plugin-opener\":\"^2.5.3\",\"@tauri-apps/plugin-os\":\"^2.3.2\",\"@tauri-apps/plugin-process\":\"^2.3.1\",\"@tauri-apps/plugin-shell\":\"~2.3.4\",\"@tauri-apps/plugin-updater\":\"^2.9.0\",\"@tauri-apps/plugin-websocket\":\"~2.4.2\",\"@zip.js/zip.js\":\"^2.7.53\",\"abortcontroller-polyfill\":\"^1.7.8\",\"clsx\":\"^2.1.1\",\"cors\":\"^2.8.5\",\"dayjs\":\"^1.11.13\",\"dompurify\":\"^3.3.0\",\"foliate-js\":\"workspace:*\",\"franc-min\":\"^6.2.0\",\"highlight.js\":\"^11.11.1\",\"i18next\":\"^24.2.0\",\"i18next-browser-languagedetector\":\"^8.0.2\",\"i18next-http-backend\":\"^3.0.1\",\"iso-639-2\":\"^3.0.2\",\"iso-639-3\":\"^3.0.1\",\"isomorphic-ws\":\"^5.0.0\",\"js-md5\":\"^0.8.3\",\"jwt-decode\":\"^4.0.0\",\"marked\":\"^15.0.12\",\"next\":\"16.0.10\",\"overlayscrollbars\":\"^2.11.4\",\"overlayscrollbars-react\":\"^0.5.6\",\"posthog-js\":\"^1.246.0\",\"react\":\"19.2.0\",\"react-color\":\"^2.19.3\",\"react-dom\":\"19.2.0\",\"react-i18next\":\"^15.2.0\",\"react-icons\":\"^5.4.0\",\"react-responsive\":\"^10.0.0\",\"react-virtuoso\":\"^4.17.0\",\"react-window\":\"^1.8.11\",\"semver\":\"^7.7.1\",\"styled-jsx\":\"^5.1.7\",\"tinycolor2\":\"^1.6.0\",\"uuid\":\"^11.1.0\",\"ws\":\"^8.18.3\",\"zod\":\"^4.0.8\",\"zustand\":\"5.0.6\"},\"devDependencies\":{\"@next/bundle-analyzer\":\"^15.4.2\",\"@tailwindcss/typography\":\"^0.5.16\",\"@tauri-apps/cli\":\"2.9.6\",\"@testing-library/dom\":\"^10.4.0\",\"@testing-library/react\":\"^16.3.0\",\"@types/cors\":\"^2.8.17\",\"@types/cssbeautify\":\"^0.3.5\",\"@types/node\":\"^22.15.31\",\"@types/react\":\"18.3.12\",\"@types/react-color\":\"^3.0.13\",\"@types/react-dom\":\"18.3.1\",\"@types/react-window\":\"^1.8.8\",\"@types/semver\":\"^7.7.0\",\"@types/tinycolor2\":\"^1.4.6\",\"@types/uuid\":\"^10.0.0\",\"@types/ws\":\"^8.18.1\",\"@typescript-eslint/eslint-plugin\":\"^8.48.0\",\"@typescript-eslint/parser\":\"^8.48.0\",\"@vitejs/plugin-react\":\"^5.1.1\",\"autoprefixer\":\"^10.4.20\",\"caniuse-lite\":\"^1.0.30001746\",\"cpx2\":\"^8.0.0\",\"daisyui\":\"^4.12.24\",\"dotenv-cli\":\"^7.4.4\",\"eslint\":\"^9.16.0\",\"eslint-config-next\":\"16.0.0\",\"eslint-plugin-jsx-a11y\":\"^6.10.2\",\"i18next-scanner\":\"^4.6.0\",\"jsdom\":\"^26.1.0\",\"mkdirp\":\"^3.0.1\",\"node-env-run\":\"^4.0.2\",\"postcss\":\"^8.4.49\",\"postcss-cli\":\"^11.0.0\",\"postcss-nested\":\"^7.0.2\",\"raw-loader\":\"^4.0.2\",\"serwist\":\"^9.3.0\",\"tailwindcss\":\"^3.4.18\",\"typescript\":\"^5.7.2\",\"vite-tsconfig-paths\":\"^5.1.4\",\"vitest\":\"^4.0.15\",\"wrangler\":\"^4.56.0\"}}"],"names":[],"mappings":"AAAA"}},
    {"offset": {"line": 2044, "column": 8042}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 2048, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/utils/version.ts"],"sourcesContent":["import packageJson from '../../package.json';\n\nexport const getAppVersion = () => {\n  return packageJson.version;\n};\n"],"names":[],"mappings":";;;;AAAA;;AAEO,MAAM,gBAAgB;IAC3B,OAAO,oHAAW,CAAC,OAAO;AAC5B"}},
    {"offset": {"line": 2064, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/context/PHContext.tsx"],"sourcesContent":["'use client';\n\nimport posthog from 'posthog-js';\nimport { ReactNode, useEffect } from 'react';\nimport { PostHogProvider } from 'posthog-js/react';\nimport { TELEMETRY_OPT_OUT_KEY } from '@/utils/telemetry';\nimport { getAppVersion } from '@/utils/version';\n\nconst shouldDisablePostHog = () => {\n  if (typeof window === 'undefined') return false;\n  return localStorage.getItem(TELEMETRY_OPT_OUT_KEY) === 'true';\n};\n\nconst posthogUrl =\n  process.env['NEXT_PUBLIC_POSTHOG_HOST'] ||\n  atob(process.env['NEXT_PUBLIC_DEFAULT_POSTHOG_URL_BASE64']!);\nconst posthogKey =\n  process.env['NEXT_PUBLIC_POSTHOG_KEY'] ||\n  atob(process.env['NEXT_PUBLIC_DEFAULT_POSTHOG_KEY_BASE64']!);\n\nif (typeof window !== 'undefined' && process.env['NODE_ENV'] === 'production' && posthogKey) {\n  if (!shouldDisablePostHog()) {\n    posthog.init(posthogKey, {\n      api_host: posthogUrl,\n      person_profiles: 'always',\n    });\n  }\n}\nexport const CSPostHogProvider = ({ children }: { children: ReactNode }) => {\n  useEffect(() => {\n    posthog.register_for_session({\n      $app_version: getAppVersion(),\n    });\n  }, []);\n  return <PostHogProvider client={posthog}>{children}</PostHogProvider>;\n};\n"],"names":[],"mappings":";;;;AAcE;;AAZF;AACA;AACA;AACA;AACA;;;AANA;;;;;;AAQA,MAAM,uBAAuB;IAC3B;;IACA,OAAO,aAAa,OAAO,CAAC,wKAAqB,MAAM;AACzD;AAEA,MAAM,aACJ,sUAAO,CAAC,GAAG,CAAC,2BAA2B,IACvC;AACF,MAAM,aACJ,sUAAO,CAAC,GAAG,CAAC,0BAA0B,IACtC;AAEF;;AAQO,MAAM,oBAAoB,CAAC,EAAE,QAAQ,EAA2B;;IACrE,IAAA,0LAAS;uCAAC;YACR,kNAAO,CAAC,oBAAoB,CAAC;gBAC3B,cAAc,IAAA,8JAAa;YAC7B;QACF;sCAAG,EAAE;IACL,qBAAO,6MAAC,yOAAe;QAAC,QAAQ,kNAAO;kBAAG;;;;;;AAC5C;GAPa;KAAA"}},
    {"offset": {"line": 2121, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/libs/sync.ts"],"sourcesContent":["import { Book, BookConfig, BookNote, BookDataRecord } from '@/types/book';\nimport { getAPIBaseUrl } from '@/services/environment';\nimport { getAccessToken } from '@/utils/access';\nimport { fetchWithTimeout } from '@/utils/fetch';\n\n// Cloud sync API 已移除 - 仅使用本地存储\n// const SYNC_API_ENDPOINT = getAPIBaseUrl() + '/sync';\n\nexport type SyncType = 'books' | 'configs' | 'notes';\nexport type SyncOp = 'push' | 'pull' | 'both';\n\ninterface BookRecord extends BookDataRecord, Book { }\ninterface BookConfigRecord extends BookDataRecord, BookConfig { }\ninterface BookNoteRecord extends BookDataRecord, BookNote { }\n\nexport interface SyncResult {\n  books: BookRecord[] | null;\n  notes: BookNoteRecord[] | null;\n  configs: BookConfigRecord[] | null;\n}\n\nexport type SyncRecord = BookRecord & BookConfigRecord & BookNoteRecord;\n\nexport interface SyncData {\n  books?: Partial<BookRecord>[];\n  notes?: Partial<BookNoteRecord>[];\n  configs?: Partial<BookConfigRecord>[];\n}\n\nexport class SyncClient {\n  /**\n   * 禁用云同步 - 仅使用本地存储\n   * 返回空同步结果\n   */\n  async pullChanges(\n    since: number,\n    type?: SyncType,\n    book?: string,\n    metaHash?: string,\n  ): Promise<SyncResult> {\n    // 本地存储模式 - 不调用云 API，直接返回空结果\n    console.log('[SyncClient] Cloud sync disabled (local storage mode)');\n    return {\n      books: null,\n      configs: null,\n      notes: null,\n    };\n  }\n\n  /**\n   * 禁用云同步 - 仅使用本地存储\n   * 返回空同步结果\n   */\n  async pushChanges(payload: SyncData): Promise<SyncResult> {\n    // 本地存储模式 - 不调用云 API，直接返回空结果\n    console.log('[SyncClient] Cloud sync disabled (local storage mode)');\n    return {\n      books: null,\n      configs: null,\n      notes: null,\n    };\n  }\n}\n"],"names":[],"mappings":";;;;AA6BO,MAAM;IACX;;;GAGC,GACD,MAAM,YACJ,KAAa,EACb,IAAe,EACf,IAAa,EACb,QAAiB,EACI;QACrB,4BAA4B;QAC5B,QAAQ,GAAG,CAAC;QACZ,OAAO;YACL,OAAO;YACP,SAAS;YACT,OAAO;QACT;IACF;IAEA;;;GAGC,GACD,MAAM,YAAY,OAAiB,EAAuB;QACxD,4BAA4B;QAC5B,QAAQ,GAAG,CAAC;QACZ,OAAO;YACL,OAAO;YACP,SAAS;YACT,OAAO;QACT;IACF;AACF"}},
    {"offset": {"line": 2158, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/context/SyncContext.tsx"],"sourcesContent":["'use client';\n\nimport React, { createContext, useContext } from 'react';\nimport { SyncClient } from '@/libs/sync';\n\nconst syncClient = new SyncClient();\n\ninterface SyncContextType {\n  syncClient: SyncClient;\n}\n\nconst SyncContext = createContext<SyncContextType>({ syncClient });\n\nexport const SyncProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {\n  return <SyncContext.Provider value={{ syncClient }}>{children}</SyncContext.Provider>;\n};\n\nexport const useSyncContext = () => useContext(SyncContext);\n"],"names":[],"mappings":";;;;;;;AAEA;AACA;;;AAHA;;;AAKA,MAAM,aAAa,IAAI,uJAAU;AAMjC,MAAM,4BAAc,IAAA,8LAAa,EAAkB;IAAE;AAAW;AAEzD,MAAM,eAAwD,CAAC,EAAE,QAAQ,EAAE;IAChF,qBAAO,6MAAC,YAAY,QAAQ;QAAC,OAAO;YAAE;QAAW;kBAAI;;;;;;AACvD;KAFa;AAIN,MAAM,iBAAiB;;IAAM,OAAA,IAAA,2LAAU,EAAC;AAAW;GAA7C"}},
    {"offset": {"line": 2203, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/utils/color.ts"],"sourcesContent":["import tinycolor from 'tinycolor2';\n\nfunction srgbToLinear(v: number): number {\n  // Standard formula for gamma decoding of sRGB\n  return v <= 0.04045 ? v / 12.92 : Math.pow((v + 0.055) / 1.055, 2.4);\n}\n\nexport function hexToOklch(hexColor: string): string {\n  // 1) Convert from hex → sRGB (0..255) → [0..1]\n  const { r, g, b } = tinycolor(hexColor).toRgb();\n  const R = srgbToLinear(r / 255);\n  const G = srgbToLinear(g / 255);\n  const B = srgbToLinear(b / 255);\n\n  // 2) Convert linear sRGB → L'M'S'  (the Oklab-specific \"LMS\" space)\n  const l_ = Math.cbrt(0.4122214708 * R + 0.5363325363 * G + 0.0514459929 * B);\n  const m_ = Math.cbrt(0.2119034982 * R + 0.6806995451 * G + 0.1073969566 * B);\n  const s_ = Math.cbrt(0.0883024619 * R + 0.2817188376 * G + 0.6299787005 * B);\n\n  // 3) Convert L'M'S' → Oklab\n  const L = 0.2104542553 * l_ + 0.793617785 * m_ - 0.0040720468 * s_;\n  const a = 1.9779984951 * l_ - 2.428592205 * m_ + 0.4505937099 * s_;\n  const b_ = 0.0259040371 * l_ + 0.7827717662 * m_ - 0.808675766 * s_;\n\n  // 4) Convert Oklab → Oklch\n  const C = Math.sqrt(a * a + b_ * b_);\n  let h = Math.atan2(b_, a) * (180 / Math.PI);\n  if (h < 0) h += 360;\n\n  // 5) Format as l% c h, with a bit of rounding\n  const lPercent = (L * 100).toFixed(4);\n  const cValue = Number(C.toFixed(6));\n  const hValue = Number(h.toFixed(3));\n\n  if (cValue === 0) {\n    return `${lPercent}% 0 0deg`;\n  }\n\n  return `${lPercent}% ${cValue} ${hValue}deg`;\n}\n\nexport const getContrastOklch = (hexColor: string): string => {\n  return tinycolor(hexColor).isDark() ? '100% 0 0deg' : '0% 0 0deg';\n};\n\nexport const getContrastHex = (hexColor: string): string => {\n  return tinycolor(hexColor).isDark() ? '#FFFFFF' : '#000000';\n};\n"],"names":[],"mappings":";;;;;;;;AAAA;;AAEA,SAAS,aAAa,CAAS;IAC7B,8CAA8C;IAC9C,OAAO,KAAK,UAAU,IAAI,QAAQ,KAAK,GAAG,CAAC,CAAC,IAAI,KAAK,IAAI,OAAO;AAClE;AAEO,SAAS,WAAW,QAAgB;IACzC,+CAA+C;IAC/C,MAAM,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,GAAG,IAAA,4MAAS,EAAC,UAAU,KAAK;IAC7C,MAAM,IAAI,aAAa,IAAI;IAC3B,MAAM,IAAI,aAAa,IAAI;IAC3B,MAAM,IAAI,aAAa,IAAI;IAE3B,oEAAoE;IACpE,MAAM,KAAK,KAAK,IAAI,CAAC,eAAe,IAAI,eAAe,IAAI,eAAe;IAC1E,MAAM,KAAK,KAAK,IAAI,CAAC,eAAe,IAAI,eAAe,IAAI,eAAe;IAC1E,MAAM,KAAK,KAAK,IAAI,CAAC,eAAe,IAAI,eAAe,IAAI,eAAe;IAE1E,4BAA4B;IAC5B,MAAM,IAAI,eAAe,KAAK,cAAc,KAAK,eAAe;IAChE,MAAM,IAAI,eAAe,KAAK,cAAc,KAAK,eAAe;IAChE,MAAM,KAAK,eAAe,KAAK,eAAe,KAAK,cAAc;IAEjE,2BAA2B;IAC3B,MAAM,IAAI,KAAK,IAAI,CAAC,IAAI,IAAI,KAAK;IACjC,IAAI,IAAI,KAAK,KAAK,CAAC,IAAI,KAAK,CAAC,MAAM,KAAK,EAAE;IAC1C,IAAI,IAAI,GAAG,KAAK;IAEhB,8CAA8C;IAC9C,MAAM,WAAW,CAAC,IAAI,GAAG,EAAE,OAAO,CAAC;IACnC,MAAM,SAAS,OAAO,EAAE,OAAO,CAAC;IAChC,MAAM,SAAS,OAAO,EAAE,OAAO,CAAC;IAEhC,IAAI,WAAW,GAAG;QAChB,OAAO,GAAG,SAAS,QAAQ,CAAC;IAC9B;IAEA,OAAO,GAAG,SAAS,EAAE,EAAE,OAAO,CAAC,EAAE,OAAO,GAAG,CAAC;AAC9C;AAEO,MAAM,mBAAmB,CAAC;IAC/B,OAAO,IAAA,4MAAS,EAAC,UAAU,MAAM,KAAK,gBAAgB;AACxD;AAEO,MAAM,iBAAiB,CAAC;IAC7B,OAAO,IAAA,4MAAS,EAAC,UAAU,MAAM,KAAK,YAAY;AACpD"}},
    {"offset": {"line": 2257, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/styles/themes.ts"],"sourcesContent":["import tinycolor from 'tinycolor2';\nimport { stubTranslation as _ } from '../utils/misc';\nimport { getContrastHex, getContrastOklch, hexToOklch } from '../utils/color';\n\nexport type BaseColor = {\n  bg: string;\n  fg: string;\n  primary: string;\n};\n\nexport type ThemeMode = 'auto' | 'light' | 'dark';\n\nexport type Palette = {\n  'base-100': string;\n  'base-200': string;\n  'base-300': string;\n  'base-content': string;\n  neutral: string;\n  'neutral-content': string;\n  primary: string;\n  secondary: string;\n  accent: string;\n};\n\nexport type Theme = {\n  name: string;\n  label: string;\n  colors: {\n    light: Palette;\n    dark: Palette;\n  };\n  isCustomizale?: boolean;\n};\n\nexport type CustomTheme = {\n  name: string;\n  label: string;\n  colors: {\n    light: BaseColor;\n    dark: BaseColor;\n  };\n};\n\nexport const generateLightPalette = ({ bg, fg, primary }: BaseColor) => {\n  return {\n    'base-100': bg, // Main background\n    'base-200': tinycolor(bg).darken(5).toHexString(), // Slightly darker\n    'base-300': tinycolor(bg).darken(12).toHexString(), // More darker\n    'base-content': fg, // Main text color\n    neutral: tinycolor(bg).darken(15).desaturate(20).toHexString(), // Muted neutral\n    'neutral-content': tinycolor(fg).lighten(20).desaturate(20).toHexString(), // Slightly lighter text\n    primary: primary,\n    secondary: tinycolor(primary).lighten(20).toHexString(), // Lighter secondary\n    accent: tinycolor(primary).analogous()[1]!.toHexString(), // Analogous accent\n  } as Palette;\n};\n\nexport const generateDarkPalette = ({ bg, fg, primary }: BaseColor) => {\n  return {\n    'base-100': bg, // Main background\n    'base-200': tinycolor(bg).lighten(5).toHexString(), // Slightly lighter\n    'base-300': tinycolor(bg).lighten(12).toHexString(), // More lighter\n    'base-content': fg, // Main text color\n    neutral: tinycolor(bg).lighten(15).desaturate(20).toHexString(), // Muted neutral\n    'neutral-content': tinycolor(fg).darken(20).desaturate(20).toHexString(), // Darkened text\n    primary: primary,\n    secondary: tinycolor(primary).darken(20).toHexString(), // Darker secondary\n    accent: tinycolor(primary).triad()[1]!.toHexString(), // Triad accent\n  } as Palette;\n};\n\nexport const themes = [\n  {\n    name: 'default',\n    label: _('Default'),\n    colors: {\n      light: generateLightPalette({ fg: '#171717', bg: '#ffffff', primary: '#0066cc' }),\n      dark: generateDarkPalette({ fg: '#e0e0e0', bg: '#222222', primary: '#77bbee' }),\n    },\n  },\n  {\n    name: 'gray',\n    label: _('Gray'),\n    colors: {\n      light: generateLightPalette({ fg: '#222222', bg: '#e0e0e0', primary: '#4488cc' }),\n      dark: generateDarkPalette({ fg: '#c6c6c6', bg: '#444444', primary: '#88ccee' }),\n    },\n  },\n  {\n    name: 'sepia',\n    label: _('Sepia'),\n    colors: {\n      light: generateLightPalette({ fg: '#5b4636', bg: '#f1e8d0', primary: '#008b8b' }),\n      dark: generateDarkPalette({ fg: '#ffd595', bg: '#342e25', primary: '#48d1cc' }),\n    },\n  },\n  {\n    name: 'grass',\n    label: _('Grass'),\n    colors: {\n      light: generateLightPalette({ fg: '#232c16', bg: '#d7dbbd', primary: '#177b4d' }),\n      dark: generateDarkPalette({ fg: '#d8deba', bg: '#333627', primary: '#a6d608' }),\n    },\n  },\n  {\n    name: 'cherry',\n    label: _('Cherry'),\n    colors: {\n      light: generateLightPalette({ fg: '#4e1609', bg: '#f0d1d5', primary: '#de3838' }),\n      dark: generateDarkPalette({ fg: '#e5c4c8', bg: '#462f32', primary: '#ff646e' }),\n    },\n  },\n  {\n    name: 'sky',\n    label: _('Sky'),\n    colors: {\n      light: generateLightPalette({ fg: '#262d48', bg: '#cedef5', primary: '#2d53e5' }),\n      dark: generateDarkPalette({ fg: '#babee1', bg: '#282e47', primary: '#ff646e' }),\n    },\n  },\n  {\n    name: 'solarized',\n    label: _('Solarized'),\n    colors: {\n      light: generateLightPalette({ fg: '#586e75', bg: '#fdf6e3', primary: '#268bd2' }),\n      dark: generateDarkPalette({ fg: '#93a1a1', bg: '#002b36', primary: '#268bd2' }),\n    },\n  },\n  {\n    name: 'gruvbox',\n    label: _('Gruvbox'),\n    colors: {\n      light: generateLightPalette({ fg: '#3c3836', bg: '#fbf1c7', primary: '#076678' }),\n      dark: generateDarkPalette({ fg: '#ebdbb2', bg: '#282828', primary: '#83a598' }),\n    },\n  },\n  {\n    name: 'nord',\n    label: _('Nord'),\n    colors: {\n      light: generateLightPalette({ fg: '#2e3440', bg: '#eceff4', primary: '#5e81ac' }),\n      dark: generateDarkPalette({ fg: '#d8dee9', bg: '#2e3440', primary: '#88c0d0' }),\n    },\n  },\n  {\n    name: 'contrast',\n    label: _('Contrast'),\n    colors: {\n      light: generateLightPalette({ fg: '#000000', bg: '#ffffff', primary: '#4488cc' }),\n      dark: generateDarkPalette({ fg: '#ffffff', bg: '#000000', primary: '#88ccee' }),\n    },\n  },\n  {\n    name: 'sunset',\n    label: _('Sunset'),\n    colors: {\n      light: generateLightPalette({ fg: '#423126', bg: '#fff7f0', primary: '#fe6b64' }),\n      dark: generateDarkPalette({ fg: '#f6e1d7', bg: '#3c2b25', primary: '#ff9c94' }),\n    },\n  },\n] as Theme[];\n\nconst generateCustomThemeVariables = (palette: Palette, fallbackIncluded = false): string => {\n  const colors = `\n    --b1: ${hexToOklch(palette['base-100'])};\n    --b2: ${hexToOklch(palette['base-200'])};\n    --b3: ${hexToOklch(palette['base-300'])};\n    --bc: ${hexToOklch(palette['base-content'])};\n    \n    --p: ${hexToOklch(palette.primary)};\n    --pc: ${getContrastOklch(palette.primary)};\n    \n    --s: ${hexToOklch(palette.secondary)};\n    --sc: ${getContrastOklch(palette.secondary)};\n    \n    --a: ${hexToOklch(palette.accent)};\n    --ac: ${getContrastOklch(palette.accent)};\n    \n    --n: ${hexToOklch(palette.neutral)};\n    --nc: ${hexToOklch(palette['neutral-content'])};\n    \n    --in: 69.37% 0.047 231deg;\n    --inc: 100% 0 0deg;\n    --su: 78.15% 0.12 160deg;\n    --suc: 100% 0 0deg;\n    --wa: 90.69% 0.123 84deg;\n    --wac: 0% 0 0deg;\n    --er: 70.9% 0.184 22deg;\n    --erc: 100% 0 0deg;\n  `;\n\n  const fallbackColors = `\n    --fallback-b1: ${palette['base-100']};\n    --fallback-b2: ${palette['base-200']};\n    --fallback-b3: ${palette['base-300']};\n    --fallback-bc: ${palette['base-content']};\n\n    --fallback-p: ${palette.primary};\n    --fallback-pc: ${getContrastHex(palette.primary)};\n\n    --fallback-s: ${palette.secondary};\n    --fallback-sc: ${getContrastHex(palette.secondary)};\n\n    --fallback-a: ${palette.accent};\n    --fallback-ac: ${getContrastHex(palette.accent)};\n\n    --fallback-n: ${palette.neutral};\n    --fallback-nc: ${palette['neutral-content']};\n\n    --fallback-in: #ff0000;\n    --fallback-inc: #ffffff;\n    --fallback-su: #00ff00;\n    --fallback-suc: #000000;\n    --fallback-wa: #ffff00;\n    --fallback-wac: #000000;\n    --fallback-er: #ff8000;\n    --fallback-erc: #000000;\n  `;\n\n  return colors + (fallbackIncluded ? fallbackColors : '');\n};\n\nexport const applyCustomTheme = (\n  customTheme?: CustomTheme,\n  themeName?: string,\n  fallbackIncluded = false,\n) => {\n  if (!customTheme && !themeName) return;\n\n  const lightThemeName = customTheme ? `${customTheme.name}-light` : `${themeName}-light`;\n  const darkThemeName = customTheme ? `${customTheme.name}-dark` : `${themeName}-dark`;\n\n  const lightPalette = customTheme\n    ? generateLightPalette(customTheme.colors.light)\n    : (themes.find((t) => t.name === themeName) || themes[0]!).colors.light;\n\n  const darkPalette = customTheme\n    ? generateDarkPalette(customTheme.colors.dark)\n    : (themes.find((t) => t.name === themeName) || themes[0]!).colors.dark;\n\n  const css = `\n    [data-theme=\"${lightThemeName}\"] {\n      ${generateCustomThemeVariables(lightPalette, fallbackIncluded)}\n    }\n    \n    [data-theme=\"${darkThemeName}\"] {\n      ${generateCustomThemeVariables(darkPalette, fallbackIncluded)}\n    }\n    \n    :root {\n      --${lightThemeName}: 1;\n      --${darkThemeName}: 1;\n    }\n  `;\n\n  const styleElement = document.createElement('style');\n  styleElement.id = `theme-${customTheme ? customTheme.name : themeName}-styles`;\n  styleElement.textContent = css;\n\n  const existingStyle = document.getElementById(styleElement.id);\n  if (existingStyle) {\n    existingStyle.remove();\n  }\n\n  document.head.appendChild(styleElement);\n\n  return {\n    light: lightThemeName,\n    dark: darkThemeName,\n  };\n};\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2574, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/utils/style.ts"],"sourcesContent":["import {\n  MONOSPACE_FONTS,\n  SANS_SERIF_FONTS,\n  SERIF_FONTS,\n  FALLBACK_FONTS,\n  CJK_SANS_SERIF_FONTS,\n  CJK_SERIF_FONTS,\n} from '@/services/constants';\nimport { ViewSettings } from '@/types/book';\nimport {\n  themes,\n  Palette,\n  CustomTheme,\n  generateLightPalette,\n  generateDarkPalette,\n} from '@/styles/themes';\nimport { getOSPlatform } from './misc';\n\nconst getFontStyles = (\n  serif: string,\n  sansSerif: string,\n  monospace: string,\n  defaultFont: string,\n  defaultCJKFont: string,\n  fontSize: number,\n  minFontSize: number,\n  fontWeight: number,\n  overrideFont: boolean,\n) => {\n  const lastSerifFonts = ['Georgia', 'Times New Roman'];\n  const serifFonts = [\n    serif,\n    ...(defaultCJKFont !== serif ? [defaultCJKFont] : []),\n    ...SERIF_FONTS.filter(\n      (font) => font !== serif && font !== defaultCJKFont && !lastSerifFonts.includes(font),\n    ),\n    ...CJK_SERIF_FONTS.filter((font) => font !== serif && font !== defaultCJKFont),\n    ...lastSerifFonts.filter(\n      (font) => SERIF_FONTS.includes(font) && !lastSerifFonts.includes(defaultCJKFont),\n    ),\n    ...FALLBACK_FONTS,\n  ];\n  const sansSerifFonts = [\n    sansSerif,\n    ...(defaultCJKFont !== sansSerif ? [defaultCJKFont] : []),\n    ...SANS_SERIF_FONTS.filter((font) => font !== sansSerif && font !== defaultCJKFont),\n    ...CJK_SANS_SERIF_FONTS.filter((font) => font !== sansSerif && font !== defaultCJKFont),\n    ...FALLBACK_FONTS,\n  ];\n  const monospaceFonts = [monospace, ...MONOSPACE_FONTS.filter((font) => font !== monospace)];\n  const defaultFontFamily = defaultFont.toLowerCase() === 'serif' ? '--serif' : '--sans-serif';\n  const fontStyles = `\n    html {\n      --serif: ${serifFonts.map((font) => `\"${font}\"`).join(', ')}, serif;\n      --sans-serif: ${sansSerifFonts.map((font) => `\"${font}\"`).join(', ')}, sans-serif;\n      --monospace: ${monospaceFonts.map((font) => `\"${font}\"`).join(', ')}, monospace;\n      --font-size: ${fontSize}px;\n      --min-font-size: ${minFontSize}px;\n      --font-weight: ${fontWeight};\n    }\n    html, body {\n      font-size: ${fontSize}px !important;\n      font-weight: ${fontWeight};\n      -webkit-text-size-adjust: none;\n      text-size-adjust: none;\n    }\n    /* lower specificity than ebook built-in font styles */\n    html {\n      font-family: var(${defaultFontFamily}) ${overrideFont ? '!important' : ''};\n    }\n    /* higher specificity than ebook built-in font styles */\n    html body {\n      ${overrideFont ? `font-family: var(${defaultFontFamily}) !important;` : ''}\n    }\n    font[size=\"1\"] {\n      font-size: ${minFontSize}px;\n    }\n    font[size=\"2\"] {\n      font-size: ${minFontSize * 1.5}px;\n    }\n    font[size=\"3\"] {\n      font-size: ${fontSize}px;\n    }\n    font[size=\"4\"] {\n      font-size: ${fontSize * 1.2}px;\n    }\n    font[size=\"5\"] {\n      font-size: ${fontSize * 1.5}px;\n    }\n    font[size=\"6\"] {\n      font-size: ${fontSize * 2}px;\n    }\n    font[size=\"7\"] {\n      font-size: ${fontSize * 3}px;\n    }\n    /* hardcoded inline font size */\n    [style*=\"font-size: 16px\"], [style*=\"font-size:16px\"] {\n      font-size: 1rem !important;\n    }\n    pre, code, kbd {\n      font-family: var(--monospace);\n    }\n    body *:not(pre, code, kbd, .code):not(pre *, code *, kbd *, .code *) {\n      ${overrideFont ? 'font-family: revert !important;' : ''}\n    }\n  `;\n  return fontStyles;\n};\n\nconst getColorStyles = (\n  overrideColor: boolean,\n  invertImgColorInDark: boolean,\n  themeCode: ThemeCode,\n  backgroundTextureId: string,\n  isEink: boolean,\n) => {\n  const { bg, fg, primary, isDarkMode } = themeCode;\n  const colorStyles = `\n    html {\n      --bg-texture-id: ${backgroundTextureId};\n      --theme-bg-color: ${bg};\n      --theme-fg-color: ${fg};\n      --theme-primary-color: ${primary};\n      --override-color: ${overrideColor};\n      color-scheme: ${isDarkMode ? 'dark' : 'light'};\n    }\n    html, body {\n      color: ${fg};\n    }\n    html[has-background], body[has-background] {\n      --background-set: var(--theme-bg-color);\n    }\n    html {\n      background-color: var(--theme-bg-color, transparent);\n      background: var(--background-set, none);\n    }\n    section, aside, blockquote, article, nav, header, footer, main, figure,\n    div, p, font, h1, h2, h3, h4, h5, h6, li, span {\n      ${overrideColor ? `background-color: ${bg} !important;` : ''}\n      ${overrideColor ? `color: ${fg} !important;` : ''}\n      ${overrideColor ? `border-color: ${fg} !important;` : ''}\n    }\n    pre, span { /* inline code blocks */\n      ${overrideColor ? `background-color: ${bg} !important;` : ''}\n    }\n    a:any-link {\n      ${overrideColor ? `color: ${primary} !important;` : isDarkMode ? `color: lightblue;` : ''}\n      text-decoration: ${isEink ? 'underline' : 'none'};\n    }\n    body.pbg {\n      ${isDarkMode ? `background-color: ${bg} !important;` : ''}\n    }\n    img {\n      ${isDarkMode && invertImgColorInDark ? 'filter: invert(100%);' : ''}\n      ${!isDarkMode && overrideColor ? 'mix-blend-mode: multiply;' : ''}\n    }\n    /* horizontal rule #1649 */\n    *:has(> hr.background-img):not(body) {\n      background-color: ${bg};\n    }\n    hr {\n      mix-blend-mode: multiply;\n    }\n    /* inline images */\n    p img, span img, sup img {\n      mix-blend-mode: ${isDarkMode ? 'screen' : 'multiply'};\n    }\n    table {\n      max-width: calc(var(--available-width));\n      overflow: auto;\n      table-layout: fixed;\n    }\n    /* code */\n    body.theme-dark code {\n      ${isDarkMode ? `color: ${fg}cc;` : ''}\n      ${isDarkMode ? `background: color-mix(in srgb, ${bg} 90%, #000);` : ''}\n      ${isDarkMode ? `background-color: color-mix(in srgb, ${bg} 90%, #000);` : ''}\n    }\n    blockquote {\n      ${isDarkMode ? `background: color-mix(in srgb, ${bg} 80%, #000);` : ''}\n    }\n    blockquote, table * {\n      ${isDarkMode && overrideColor ? `background: color-mix(in srgb, ${bg} 80%, #000);` : ''}\n      ${isDarkMode && overrideColor ? `background-color: color-mix(in srgb, ${bg} 80%, #000);` : ''}\n    }\n    /* override inline hardcoded text color */\n    font[color=\"#000000\"], font[color=\"#000\"], font[color=\"black\"],\n    font[color=\"rgb(0,0,0)\"], font[color=\"rgb(0, 0, 0)\"],\n    *[style*=\"color: rgb(0,0,0)\"], *[style*=\"color: rgb(0, 0, 0)\"],\n    *[style*=\"color: #000\"], *[style*=\"color: #000000\"], *[style*=\"color: black\"],\n    *[style*=\"color:rgb(0,0,0)\"], *[style*=\"color:rgb(0, 0, 0)\"],\n    *[style*=\"color:#000\"], *[style*=\"color:#000000\"], *[style*=\"color:black\"] {\n      color: ${fg} !important;\n    }\n    /* for the Gutenberg eBooks */\n    #pg-header * {\n      color: inherit !important;\n    }\n    .x-ebookmaker, .x-ebookmaker-cover, .x-ebookmaker-coverpage {\n      background-color: unset !important;\n    }\n    /* for the Feedbooks eBooks */\n    .chapterHeader, .chapterHeader * {\n      border-color: unset;\n      background-color: ${bg} !important;\n    }\n  `;\n  return colorStyles;\n};\n\nconst getLayoutStyles = (\n  overrideLayout: boolean,\n  marginTop: number,\n  marginRight: number,\n  marginBottom: number,\n  marginLeft: number,\n  paragraphMargin: number,\n  lineSpacing: number,\n  wordSpacing: number,\n  letterSpacing: number,\n  textIndent: number,\n  justify: boolean,\n  hyphenate: boolean,\n  zoomLevel: number,\n  writingMode: string,\n  vertical: boolean,\n) => {\n  const layoutStyle = `\n  @namespace epub \"http://www.idpf.org/2007/ops\";\n  html {\n    --default-text-align: ${justify ? 'justify' : 'start'};\n    --margin-top: ${marginTop}px;\n    --margin-right: ${marginRight}px;\n    --margin-bottom: ${marginBottom}px;\n    --margin-left: ${marginLeft}px;\n    hanging-punctuation: allow-end last;\n    orphans: 2;\n    widows: 2;\n  }\n  [align=\"left\"] { text-align: left; }\n  [align=\"right\"] { text-align: right; }\n  [align=\"center\"] { text-align: center; }\n  [align=\"justify\"] { text-align: justify; }\n  :is(hgroup, header) p {\n      text-align: unset;\n      hyphens: unset;\n  }\n  html, body {\n    ${writingMode === 'auto' ? '' : `writing-mode: ${writingMode} !important;`}\n    text-align: var(--default-text-align);\n    max-height: unset;\n    -webkit-touch-callout: none;\n    -webkit-user-select: text;\n  }\n  body {\n    overflow: unset;\n    zoom: ${zoomLevel};\n  }\n  svg, img {\n    height: auto;\n    width: auto;\n    background-color: transparent !important;\n  }\n  figure > div:has(img) {\n    height: auto !important;\n  }\n  /* enlarge the clickable area of links */\n  a {\n    position: relative !important;\n  }\n  a::before {\n    content: '';\n    position: absolute;\n    inset: -10px;\n  }\n  p, blockquote, dd, div:not(:has(*:not(b, a, em, i, strong, u, span))) {\n    line-height: ${lineSpacing} ${overrideLayout ? '!important' : ''};\n    word-spacing: ${wordSpacing}px ${overrideLayout ? '!important' : ''};\n    letter-spacing: ${letterSpacing}px ${overrideLayout ? '!important' : ''};\n    text-indent: ${textIndent}em ${overrideLayout ? '!important' : ''};\n    -webkit-hyphens: ${hyphenate ? 'auto' : 'manual'};\n    hyphens: ${hyphenate ? 'auto' : 'manual'};\n    -webkit-hyphenate-limit-before: 3;\n    -webkit-hyphenate-limit-after: 2;\n    -webkit-hyphenate-limit-lines: 2;\n    hanging-punctuation: allow-end last;\n    widows: 2;\n  }\n  p.aligned-center, blockquote.aligned-center,\n  dd.aligned-center, div.aligned-center {\n    text-align: center ${overrideLayout ? '!important' : ''};\n  }\n  p.aligned-left, blockquote.aligned-left,\n  dd.aligned-left, div.aligned-left {\n    ${justify && overrideLayout ? 'text-align: justify !important;' : ''}\n  }\n  p.aligned-right, blockquote.aligned-right,\n  dd.aligned-right, div.aligned-right {\n    text-align: right ${overrideLayout ? '!important' : ''};\n  }\n  p.aligned-justify, blockquote.aligned-justify,\n  dd.aligned-justify, div.aligned-justify {\n    ${!justify && overrideLayout ? 'text-align: initial !important;' : ''};\n  }\n  p:has(> img:only-child), p:has(> span:only-child > img:only-child),\n  p:has(> img:not(.has-text-siblings)),\n  p:has(> a:first-child + img:last-child) {\n    text-indent: initial !important;\n  }\n  blockquote[align=\"center\"], div[align=\"center\"],\n  p[align=\"center\"], dd[align=\"center\"],\n  p.aligned-center, blockquote.aligned-center,\n  dd.aligned-center, div.aligned-center,\n  li p, ol p, ul p, td p {\n    text-indent: initial !important;\n  }\n  p {\n    ${vertical ? `margin-left: ${paragraphMargin}em ${overrideLayout ? '!important' : ''};` : ''}\n    ${vertical ? `margin-right: ${paragraphMargin}em ${overrideLayout ? '!important' : ''};` : ''}\n    ${vertical ? `margin-top: unset ${overrideLayout ? '!important' : ''};` : ''}\n    ${vertical ? `margin-bottom: unset ${overrideLayout ? '!important' : ''};` : ''}\n    ${!vertical ? `margin-top: ${paragraphMargin}em ${overrideLayout ? '!important' : ''};` : ''}\n    ${!vertical ? `margin-bottom: ${paragraphMargin}em ${overrideLayout ? '!important' : ''};` : ''}\n    ${!vertical ? `margin-left: unset ${overrideLayout ? '!important' : ''};` : ''}\n    ${!vertical ? `margin-right: unset ${overrideLayout ? '!important' : ''};` : ''}\n  }\n  div {\n    ${vertical && overrideLayout ? `margin-left: ${paragraphMargin}em !important;` : ''}\n    ${vertical && overrideLayout ? `margin-right: ${paragraphMargin}em !important;` : ''}\n    ${!vertical && overrideLayout ? `margin-top: ${paragraphMargin}em !important;` : ''}\n    ${!vertical && overrideLayout ? `margin-bottom: ${paragraphMargin}em !important;` : ''}\n  }\n\n  :lang(zh), :lang(ja), :lang(ko) {\n    widows: 1;\n    orphans: 1;\n  }\n\n  pre {\n    white-space: pre-wrap !important;\n  }\n\n  .epubtype-footnote,\n  aside[epub|type~=\"endnote\"],\n  aside[epub|type~=\"footnote\"],\n  aside[epub|type~=\"note\"],\n  aside[epub|type~=\"rearnote\"] {\n    display: none;\n  }\n\n  /* Now begins really dirty hacks to fix some badly designed epubs */\n  body {\n    line-height: unset;\n  }\n\n  img.pi {\n    ${vertical ? 'transform: rotate(90deg);' : ''}\n    ${vertical ? 'transform-origin: center;' : ''}\n    ${vertical ? 'height: 2em;' : ''}\n    ${vertical ? `width: ${lineSpacing}em;` : ''}\n    ${vertical ? `vertical-align: unset;` : ''}\n  }\n\n  .duokan-footnote-content,\n  .duokan-footnote-item {\n    display: none;\n  }\n\n  .calibre {\n    color: unset;\n  }\n\n  div:has(> img, > svg) {\n    max-width: 100% !important;\n  }\n\n  body.paginated-mode td:has(img), body.paginated-mode td :has(img) {\n    max-height: calc(var(--available-height) * 0.8 * 1px);\n  }\n\n  /* some epubs set insane inline-block for p */\n  p {\n    display: block;\n  }\n\n  /* inline images without dimension */\n  .ie6 img {\n    width: unset;\n    height: unset;\n  }\n  sup img {\n    height: 1em;\n  }\n  img.has-text-siblings {\n    ${vertical ? 'width: 1em;' : 'height: 1em;'}\n    vertical-align: baseline;\n  }\n  :is(div) > img.has-text-siblings[style*=\"object-fit\"] {\n    display: block;\n    height: auto;\n    vertical-align: unset;\n  }\n  .duokan-footnote img:not([class]) {\n    width: 0.8em;\n    height: 0.8em;\n  }\n  div:has(img.singlepage) {\n    position: relative;\n    width: auto;\n    height: auto;\n  }\n\n  /* page break */\n  body.paginated-mode div[style*=\"page-break-after: always\"],\n  body.paginated-mode div[style*=\"page-break-after:always\"],\n  body.paginated-mode p[style*=\"page-break-after: always\"],\n  body.paginated-mode p[style*=\"page-break-after:always\"] {\n    margin-bottom: calc(var(--available-height) * 1px);\n  }\n\n  /* workaround for some badly designed epubs */\n  div.left *, p.left * { text-align: left; }\n  div.right *, p.right * { text-align: right; }\n  div.center *, p.center * { text-align: center; }\n  div.justify *, p.justify * { text-align: justify; }\n\n  .br {\n    display: flow-root;\n  }\n\n  .h5_mainbody {\n    overflow: unset !important;\n  }\n\n  .nonindent, .noindent {\n    text-indent: unset !important;\n  }\n`;\n  return layoutStyle;\n};\n\nexport const getFootnoteStyles = () => `\n  .duokan-footnote-content,\n  .duokan-footnote-item {\n    display: block !important;\n  }\n\n  body {\n    padding: 1em !important;\n  }\n\n  a:any-link {\n    cursor: default;\n    pointer-events: none;\n    text-decoration: none;\n    padding: unset;\n    margin: unset;\n  }\n\n  ol {\n    margin: 0;\n    padding: 0;\n  }\n\n  p, li, blockquote, dd {\n    margin: unset !important;\n    text-indent: unset !important;\n  }\n\n  div {\n    margin: unset !important;\n    padding: unset !important;\n  }\n\n  dt {\n    font-weight: bold;\n    line-height: 1.6;\n  }\n\n  .epubtype-footnote,\n  aside[epub|type~=\"endnote\"],\n  aside[epub|type~=\"footnote\"],\n  aside[epub|type~=\"note\"],\n  aside[epub|type~=\"rearnote\"] {\n    display: block;\n  }\n`;\n\nconst getTranslationStyles = (showSource: boolean) => `\n  .translation-source {\n  }\n  .translation-target {\n  }\n  .translation-target.hidden {\n    display: none !important;\n  }\n  .translation-target-block {\n    display: block !important;\n    ${showSource ? 'margin: 0.5em 0 !important;' : ''}\n  }\n  .translation-target-toc {\n    display: block !important;\n    overflow: hidden;\n    text-overflow: ellipsis;\n  }\n`;\n\nexport interface ThemeCode {\n  bg: string;\n  fg: string;\n  primary: string;\n  palette: Palette;\n  isDarkMode: boolean;\n}\n\nexport const getThemeCode = () => {\n  let themeMode = 'auto';\n  let themeColor = 'default';\n  let systemIsDarkMode = false;\n  let customThemes: CustomTheme[] = [];\n  if (typeof window !== 'undefined') {\n    themeColor = localStorage.getItem('themeColor') || 'default';\n    themeMode = localStorage.getItem('themeMode') || 'auto';\n    customThemes = JSON.parse(localStorage.getItem('customThemes') || '[]');\n    systemIsDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches;\n  }\n  const isDarkMode = themeMode === 'dark' || (themeMode === 'auto' && systemIsDarkMode);\n  let currentTheme = themes.find((theme) => theme.name === themeColor);\n  if (!currentTheme) {\n    const customTheme = customThemes.find((theme) => theme.name === themeColor);\n    if (customTheme) {\n      currentTheme = {\n        name: customTheme.name,\n        label: customTheme.label,\n        colors: {\n          light: generateLightPalette(customTheme.colors.light),\n          dark: generateDarkPalette(customTheme.colors.dark),\n        },\n      };\n    }\n  }\n  if (!currentTheme) currentTheme = themes[0];\n  const defaultPalette = isDarkMode ? currentTheme!.colors.dark : currentTheme!.colors.light;\n  return {\n    bg: defaultPalette['base-100'],\n    fg: defaultPalette['base-content'],\n    primary: defaultPalette.primary,\n    palette: defaultPalette,\n    isDarkMode,\n  } as ThemeCode;\n};\n\nexport const getStyles = (viewSettings: ViewSettings, themeCode?: ThemeCode) => {\n  if (!themeCode) {\n    themeCode = getThemeCode();\n  }\n  const layoutStyles = getLayoutStyles(\n    viewSettings.overrideLayout!,\n    viewSettings.marginTopPx,\n    viewSettings.marginRightPx,\n    viewSettings.marginBottomPx,\n    viewSettings.marginLeftPx,\n    viewSettings.paragraphMargin!,\n    viewSettings.lineHeight!,\n    viewSettings.wordSpacing!,\n    viewSettings.letterSpacing!,\n    viewSettings.textIndent!,\n    viewSettings.fullJustification!,\n    viewSettings.hyphenation!,\n    1.0,\n    viewSettings.writingMode!,\n    viewSettings.vertical!,\n  );\n  // scale the font size on-the-fly so that we can sync the same font size on different devices\n  const isMobile = ['ios', 'android'].includes(getOSPlatform());\n  const fontScale = isMobile ? 1.25 : 1;\n  // Only for backward compatibility, new viewSettings.zoomLevel will always be 100 for EPUBs\n  const zoomScale = (viewSettings.zoomLevel || 100) / 100.0;\n  const fontStyles = getFontStyles(\n    viewSettings.serifFont!,\n    viewSettings.sansSerifFont!,\n    viewSettings.monospaceFont!,\n    viewSettings.defaultFont!,\n    viewSettings.defaultCJKFont!,\n    viewSettings.defaultFontSize! * fontScale * zoomScale,\n    viewSettings.minimumFontSize!,\n    viewSettings.fontWeight!,\n    viewSettings.overrideFont!,\n  );\n  const colorStyles = getColorStyles(\n    viewSettings.overrideColor!,\n    viewSettings.invertImgColorInDark!,\n    themeCode,\n    viewSettings.backgroundTextureId,\n    viewSettings.isEink,\n  );\n  const translationStyles = getTranslationStyles(viewSettings.showTranslateSource!);\n  const userStylesheet = viewSettings.userStylesheet!;\n  return `${layoutStyles}\\n${fontStyles}\\n${colorStyles}\\n${translationStyles}\\n${userStylesheet}`;\n};\n\nexport const applyTranslationStyle = (viewSettings: ViewSettings) => {\n  const styleId = 'translation-style';\n\n  const existingStyle = document.getElementById(styleId);\n  if (existingStyle) {\n    existingStyle.remove();\n  }\n\n  const styleElement = document.createElement('style');\n  styleElement.id = styleId;\n  styleElement.textContent = getTranslationStyles(viewSettings.showTranslateSource);\n\n  document.head.appendChild(styleElement);\n};\n\nexport const transformStylesheet = (css: string, vw: number, vh: number, vertical: boolean) => {\n  const isMobile = ['ios', 'android'].includes(getOSPlatform());\n  const fontScale = isMobile ? 1.25 : 1;\n  const isInlineStyle = !css.includes('{');\n  const ruleRegex = /([^{]+)({[^}]+})/g;\n  css = css.replace(ruleRegex, (match, selector, block) => {\n    const hasTextAlignCenter = /text-align\\s*:\\s*center\\s*[;$]/.test(block);\n    const hasTextIndentZero = /text-indent\\s*:\\s*0(?:\\.0+)?(?:px|em|rem|%)?\\s*[;$]/.test(block);\n\n    if (hasTextAlignCenter && hasTextIndentZero) {\n      block = block.replace(/(text-align\\s*:\\s*center)(\\s*;|\\s*$)/g, '$1 !important$2');\n      block = block.replace(\n        /(text-indent\\s*:\\s*0(?:\\.0+)?(?:px|em|rem|%)?)(\\s*;|\\s*$)/g,\n        '$1 !important$2',\n      );\n      return selector + block;\n    }\n    return match;\n  });\n\n  // clip nowrapped elements\n  css = css.replace(ruleRegex, (match, selector, block) => {\n    const hasWhiteSpaceNowrap = /white-space\\s*:\\s*nowrap\\s*[;$]/.test(block);\n    if (hasWhiteSpaceNowrap) {\n      if (!/overflow\\s*:/.test(block)) {\n        block = block.replace(/}$/, ' overflow: clip !important; }');\n      }\n      return selector + block;\n    }\n    return match;\n  });\n\n  if (isInlineStyle) {\n    const hasPageBreakAfterAlways = /page-break-after\\s*:\\s*always\\s*[;]?/.test(css);\n    if (hasPageBreakAfterAlways && !/margin-bottom\\s*:/.test(css)) {\n      css = css.replace(/;?\\s*$/, '') + '; margin-bottom: calc(var(--available-height) * 1px)';\n    }\n  } else {\n    css = css.replace(ruleRegex, (match, selector, block) => {\n      const hasPageBreakAfterAlways = /page-break-after\\s*:\\s*always\\s*[;$]/.test(block);\n      if (hasPageBreakAfterAlways) {\n        if (!/margin-bottom\\s*:/.test(block)) {\n          block = block.replace(/}$/, ' margin-bottom: calc(var(--available-height) * 1px); }');\n        }\n        return selector + block;\n      }\n      return match;\n    });\n  }\n\n  // Process duokan-bleed\n  css = css.replace(ruleRegex, (_, selector, block) => {\n    if (vertical) return selector + block;\n\n    const directions: string[] = [];\n    let hasBleed = false;\n    for (const dir of ['top', 'bottom', 'left', 'right']) {\n      const bleedRegex = new RegExp(`duokan-bleed\\\\s*:\\\\s*[^;]*${dir}[^;]*;`);\n      const marginRegex = new RegExp(`margin-${dir}\\\\s*:`);\n      if (bleedRegex.test(block) && !marginRegex.test(block)) {\n        hasBleed = true;\n        directions.push(dir);\n        block = block.replace(\n          /}$/,\n          ` margin-${dir}: calc(-1 * var(--page-margin-${dir})) !important; }`,\n        );\n      }\n    }\n    if (hasBleed) {\n      if (!/position\\s*:/.test(block)) {\n        block = block.replace(/}$/, ' position: relative !important; }');\n      }\n      if (!/overflow\\s*:/.test(block)) {\n        block = block.replace(/}$/, ' overflow: hidden !important; }');\n      }\n      if (!/display\\s*:/.test(block)) {\n        block = block.replace(/}$/, ' display: flow-root !important; }');\n      }\n      if (!/width\\s*:/.test(block) && directions.includes('left') && directions.includes('right')) {\n        block = block\n          .replace(\n            /}$/,\n            ' width: calc(var(--_max-width) + var(--page-margin-left) + var(--page-margin-right)) !important; }',\n          )\n          .replace(/}$/, ' max-width: 100vw !important; }');\n      }\n      if (\n        !/height\\s*:/.test(block) &&\n        directions.includes('top') &&\n        directions.includes('bottom')\n      ) {\n        block = block\n          .replace(\n            /}$/,\n            ' height: calc(100% + var(--page-margin-top) + var(--page-margin-bottom)) !important; }',\n          )\n          .replace(/}$/, ' max-height: 100vh !important; }');\n      }\n    }\n    return selector + block;\n  });\n\n  // replace absolute font sizes with rem units\n  // replace vw and vh as they cause problems with layout\n  // replace hardcoded colors\n  css = css\n    .replace(/font-size\\s*:\\s*xx-small/gi, 'font-size: 0.6rem')\n    .replace(/font-size\\s*:\\s*x-small/gi, 'font-size: 0.75rem')\n    .replace(/font-size\\s*:\\s*small/gi, 'font-size: 0.875rem')\n    .replace(/font-size\\s*:\\s*medium/gi, 'font-size: 1rem')\n    .replace(/font-size\\s*:\\s*large/gi, 'font-size: 1.2rem')\n    .replace(/font-size\\s*:\\s*x-large/gi, 'font-size: 1.5rem')\n    .replace(/font-size\\s*:\\s*xx-large/gi, 'font-size: 2rem')\n    .replace(/font-size\\s*:\\s*xxx-large/gi, 'font-size: 3rem')\n    .replace(/font-size\\s*:\\s*(\\d+(?:\\.\\d+)?)px/gi, (_, px) => {\n      const rem = parseFloat(px) / fontScale / 16;\n      return `font-size: ${rem}rem`;\n    })\n    .replace(/font-size\\s*:\\s*(\\d+(?:\\.\\d+)?)pt/gi, (_, pt) => {\n      const rem = parseFloat(pt) / fontScale / 12;\n      return `font-size: ${rem}rem`;\n    })\n    .replace(/font-size\\s*:\\s*(\\d*\\.?\\d+)(px|rem|em|%)?/gi, (_, size, unit = 'px') => {\n      return `font-size: max(${size}${unit}, var(--min-font-size, 8px))`;\n    })\n    .replace(/(\\d*\\.?\\d+)vw/gi, (_, d) => (parseFloat(d) * vw) / 100 + 'px')\n    .replace(/(\\d*\\.?\\d+)vh/gi, (_, d) => (parseFloat(d) * vh) / 100 + 'px')\n    .replace(/([\\s;])font-family\\s*:\\s*monospace/gi, '$1font-family: var(--monospace)')\n    .replace(/([\\s;])font-weight\\s*:\\s*normal/gi, '$1font-weight: var(--font-weight)')\n    .replace(/([\\s;])color\\s*:\\s*black/gi, '$1color: var(--theme-fg-color)')\n    .replace(/([\\s;])color\\s*:\\s*#000000/gi, '$1color: var(--theme-fg-color)')\n    .replace(/([\\s;])color\\s*:\\s*#000/gi, '$1color: var(--theme-fg-color)')\n    .replace(/([\\s;])color\\s*:\\s*rgb\\(0,\\s*0,\\s*0\\)/gi, '$1color: var(--theme-fg-color)');\n  return css;\n};\n\nexport const applyThemeModeClass = (document: Document, isDarkMode: boolean) => {\n  document.body.classList.remove('theme-light', 'theme-dark');\n  document.body.classList.add(isDarkMode ? 'theme-dark' : 'theme-light');\n};\n\nexport const applyScrollModeClass = (document: Document, isScrollMode: boolean) => {\n  document.body.classList.remove('scroll-mode', 'paginated-mode');\n  document.body.classList.add(isScrollMode ? 'scroll-mode' : 'paginated-mode');\n};\n\nexport const applyImageStyle = (document: Document) => {\n  document.querySelectorAll('img').forEach((img) => {\n    const widthAttr = img.getAttribute('width');\n    if (widthAttr && (widthAttr.endsWith('%') || widthAttr.endsWith('vw'))) {\n      const percentage = parseFloat(widthAttr);\n      if (!isNaN(percentage)) {\n        img.style.width = `${(percentage / 100) * window.innerWidth}px`;\n        img.removeAttribute('width');\n      }\n    }\n\n    const heightAttr = img.getAttribute('height');\n    if (heightAttr && (heightAttr.endsWith('%') || heightAttr.endsWith('vh'))) {\n      const percentage = parseFloat(heightAttr);\n      if (!isNaN(percentage)) {\n        img.style.height = `${(percentage / 100) * window.innerHeight}px`;\n        img.removeAttribute('height');\n      }\n    }\n\n    const parent = img.parentNode;\n    if (!parent || parent.nodeType !== Node.ELEMENT_NODE) return;\n    const hasTextSiblings = Array.from(parent.childNodes).some(\n      (node) => node.nodeType === Node.TEXT_NODE && node.textContent?.trim(),\n    );\n    const isInline = Array.from(parent.childNodes).every(\n      (node) => node.nodeType !== Node.ELEMENT_NODE || (node as Element).tagName !== 'BR',\n    );\n    if (hasTextSiblings && isInline) {\n      img.classList.add('has-text-siblings');\n    }\n  });\n  document.querySelectorAll('hr').forEach((hr) => {\n    const computedStyle = window.getComputedStyle(hr);\n    if (computedStyle.backgroundImage && computedStyle.backgroundImage !== 'none') {\n      hr.classList.add('background-img');\n    }\n  });\n};\n\nexport const applyTableStyle = (document: Document) => {\n  document.querySelectorAll('table').forEach((table) => {\n    const parent = table.parentNode;\n    if (!parent || parent.nodeType !== Node.ELEMENT_NODE) return;\n\n    // Calculate total width from td elements with width attribute or inline style\n    let totalTableWidth = 0;\n    const rows = table.querySelectorAll('tr');\n\n    // Check all rows and use the widest one\n    for (const row of rows) {\n      const cells = row.querySelectorAll('td, th');\n      let rowWidth = 0;\n\n      cells.forEach((cell) => {\n        const cellElement = cell as HTMLElement;\n\n        const widthAttr = cellElement.getAttribute('width');\n        const styleWidth = cellElement.style.width;\n        const widthStr = widthAttr || styleWidth;\n\n        if (widthStr) {\n          const widthValue = parseFloat(widthStr);\n          const widthUnit = widthStr.replace(widthValue.toString(), '').trim();\n\n          if (widthUnit === 'px' || !widthUnit) {\n            rowWidth += widthValue;\n          } else if (widthUnit === '%') {\n            rowWidth += (window.innerWidth * widthValue) / 100;\n          }\n        }\n      });\n\n      if (rowWidth > totalTableWidth) {\n        totalTableWidth = rowWidth;\n      }\n    }\n\n    if (totalTableWidth > 0) {\n      const scale = `calc(min(1, var(--available-width) / ${totalTableWidth}))`;\n      table.style.transformOrigin = 'left top';\n      table.style.transform = `scale(${scale})`;\n    }\n  });\n};\n\nexport const keepTextAlignment = (document: Document) => {\n  document.querySelectorAll('div, p, blockquote, dd').forEach((el) => {\n    const computedStyle = window.getComputedStyle(el);\n    if (computedStyle.textAlign === 'center') {\n      el.classList.add('aligned-center');\n    } else if (computedStyle.textAlign === 'left') {\n      el.classList.add('aligned-left');\n    } else if (computedStyle.textAlign === 'right') {\n      el.classList.add('aligned-right');\n    } else if (computedStyle.textAlign === 'justify') {\n      el.classList.add('aligned-justify');\n    }\n  });\n};\n\nexport const applyFixedlayoutStyles = (\n  document: Document,\n  viewSettings: ViewSettings,\n  themeCode?: ThemeCode,\n) => {\n  if (!themeCode) {\n    themeCode = getThemeCode();\n  }\n  const { bg, fg, primary, isDarkMode } = themeCode;\n  const overrideColor = viewSettings.overrideColor!;\n  const invertImgColorInDark = viewSettings.invertImgColorInDark!;\n  const darkMixBlendMode = bg === '#000000' ? 'luminosity' : 'overlay';\n  const existingStyleId = 'fixed-layout-styles';\n  let style = document.getElementById(existingStyleId) as HTMLStyleElement;\n  if (style) {\n    style.remove();\n  }\n  style = document.createElement('style');\n  style.id = existingStyleId;\n  style.textContent = `\n    html {\n      --theme-bg-color: ${bg};\n      --theme-fg-color: ${fg};\n      --theme-primary-color: ${primary};\n      color-scheme: ${isDarkMode ? 'dark' : 'light'};\n    }\n    body {\n      position: relative;\n      background-color: var(--theme-bg-color);\n    }\n    #canvas {\n      display: inline-block;\n      width: fit-content;\n      height: fit-content;\n      background-color: var(--theme-bg-color);\n    }\n    img, canvas {\n      ${isDarkMode && invertImgColorInDark ? 'filter: invert(100%);' : ''}\n      ${overrideColor ? `mix-blend-mode: ${isDarkMode ? darkMixBlendMode : 'multiply'};` : ''}\n    }\n    img.singlePage {\n      position: relative;\n    }\n  `;\n  document.head.appendChild(style);\n};\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 3367, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/utils/bridge.ts"],"sourcesContent":["import { invoke } from '@tauri-apps/api/core';\n\nexport interface CopyURIRequest {\n  uri: string;\n  dst: string;\n}\n\nexport interface CopyURIResponse {\n  success: boolean;\n  error?: string;\n}\n\nexport interface UseBackgroundAudioRequest {\n  enabled: boolean;\n}\n\nexport interface InstallPackageRequest {\n  path: string;\n}\n\nexport interface InstallPackageResponse {\n  success: boolean;\n  error?: string;\n}\n\nexport interface SetSystemUIVisibilityRequest {\n  visible: boolean;\n  darkMode: boolean;\n}\n\nexport interface SetSystemUIVisibilityResponse {\n  success: boolean;\n  error?: string;\n}\n\nexport interface GetStatusBarHeightResponse {\n  height: number;\n  error?: string;\n}\n\nexport interface GetSystemFontsListResponse {\n  fonts: Record<string, string>; // { fontName: fontFamily }\n  error?: string;\n}\n\nexport interface InterceptKeysRequest {\n  volumeKeys?: boolean;\n  backKey?: boolean;\n}\n\nexport interface LockScreenRequest {\n  orientation: 'portrait' | 'landscape' | 'auto';\n}\n\nexport interface GetSystemColorSchemeResponse {\n  colorScheme: 'light' | 'dark';\n  error?: string;\n}\n\nexport interface GetSafeAreaInsetsResponse {\n  top: number;\n  right: number;\n  bottom: number;\n  left: number;\n  error?: string;\n}\n\ninterface GetScreenBrightnessResponse {\n  brightness: number; // 0.0 to 1.0\n  error?: string;\n}\n\ninterface SetScreenBrightnessRequest {\n  brightness: number; // 0.0 to 1.0\n}\n\ninterface SetScreenBrightnessResponse {\n  success: boolean;\n  error?: string;\n}\n\ninterface GetExternalSDCardPathResponse {\n  path: string | null;\n  error?: string;\n}\n\ninterface SelectDirectoryResponse {\n  cancelled?: boolean;\n  uri?: string;\n  path?: string;\n  error?: string;\n}\n\nexport async function copyURIToPath(request: CopyURIRequest): Promise<CopyURIResponse> {\n  const result = await invoke<CopyURIResponse>('plugin:native-bridge|copy_uri_to_path', {\n    payload: request,\n  });\n\n  return result;\n}\n\nexport async function invokeUseBackgroundAudio(request: UseBackgroundAudioRequest): Promise<void> {\n  await invoke('plugin:native-bridge|use_background_audio', {\n    payload: request,\n  });\n}\n\nexport async function installPackage(\n  request: InstallPackageRequest,\n): Promise<InstallPackageResponse> {\n  const result = await invoke<InstallPackageResponse>('plugin:native-bridge|install_package', {\n    payload: request,\n  });\n  return result;\n}\n\nexport async function setSystemUIVisibility(\n  request: SetSystemUIVisibilityRequest,\n): Promise<SetSystemUIVisibilityResponse> {\n  const result = await invoke<SetSystemUIVisibilityResponse>(\n    'plugin:native-bridge|set_system_ui_visibility',\n    {\n      payload: request,\n    },\n  );\n  return result;\n}\n\nexport async function getStatusBarHeight(): Promise<GetStatusBarHeightResponse> {\n  const result = await invoke<GetStatusBarHeightResponse>(\n    'plugin:native-bridge|get_status_bar_height',\n  );\n  return result;\n}\n\nlet cachedSysFontsResult: GetSystemFontsListResponse | null = null;\n\nexport async function getSysFontsList(): Promise<GetSystemFontsListResponse> {\n  if (cachedSysFontsResult) {\n    return cachedSysFontsResult;\n  }\n  const result = await invoke<GetSystemFontsListResponse>(\n    'plugin:native-bridge|get_sys_fonts_list',\n  );\n  cachedSysFontsResult = result;\n  return result;\n}\n\nexport async function interceptKeys(request: InterceptKeysRequest): Promise<void> {\n  await invoke('plugin:native-bridge|intercept_keys', {\n    payload: request,\n  });\n}\n\nexport async function lockScreenOrientation(request: LockScreenRequest): Promise<void> {\n  await invoke('plugin:native-bridge|lock_screen_orientation', {\n    payload: request,\n  });\n}\n\nexport async function getSystemColorScheme(): Promise<GetSystemColorSchemeResponse> {\n  const result = await invoke<GetSystemColorSchemeResponse>(\n    'plugin:native-bridge|get_system_color_scheme',\n  );\n  return result;\n}\n\nexport async function getSafeAreaInsets(): Promise<GetSafeAreaInsetsResponse> {\n  const result = await invoke<GetSafeAreaInsetsResponse>(\n    'plugin:native-bridge|get_safe_area_insets',\n  );\n  return result;\n}\n\nexport async function getScreenBrightness(): Promise<GetScreenBrightnessResponse> {\n  const result = await invoke<GetScreenBrightnessResponse>(\n    'plugin:native-bridge|get_screen_brightness',\n  );\n  return result;\n}\n\nexport async function setScreenBrightness(\n  request: SetScreenBrightnessRequest,\n): Promise<SetScreenBrightnessResponse> {\n  const result = await invoke<SetScreenBrightnessResponse>(\n    'plugin:native-bridge|set_screen_brightness',\n    {\n      payload: request,\n    },\n  );\n  return result;\n}\n\nexport async function getExternalSDCardPath(): Promise<GetExternalSDCardPathResponse> {\n  const result = await invoke<GetExternalSDCardPathResponse>(\n    'plugin:native-bridge|get_external_sdcard_path',\n  );\n  return result;\n}\n\nexport async function selectDirectory(): Promise<SelectDirectoryResponse> {\n  const result = await invoke<SelectDirectoryResponse>('plugin:native-bridge|select_directory');\n  return result;\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;AA6FO,eAAe,cAAc,OAAuB;IACzD,MAAM,SAAS,MAAM,IAAA,uNAAM,EAAkB,yCAAyC;QACpF,SAAS;IACX;IAEA,OAAO;AACT;AAEO,eAAe,yBAAyB,OAAkC;IAC/E,MAAM,IAAA,uNAAM,EAAC,6CAA6C;QACxD,SAAS;IACX;AACF;AAEO,eAAe,eACpB,OAA8B;IAE9B,MAAM,SAAS,MAAM,IAAA,uNAAM,EAAyB,wCAAwC;QAC1F,SAAS;IACX;IACA,OAAO;AACT;AAEO,eAAe,sBACpB,OAAqC;IAErC,MAAM,SAAS,MAAM,IAAA,uNAAM,EACzB,iDACA;QACE,SAAS;IACX;IAEF,OAAO;AACT;AAEO,eAAe;IACpB,MAAM,SAAS,MAAM,IAAA,uNAAM,EACzB;IAEF,OAAO;AACT;AAEA,IAAI,uBAA0D;AAEvD,eAAe;IACpB,IAAI,sBAAsB;QACxB,OAAO;IACT;IACA,MAAM,SAAS,MAAM,IAAA,uNAAM,EACzB;IAEF,uBAAuB;IACvB,OAAO;AACT;AAEO,eAAe,cAAc,OAA6B;IAC/D,MAAM,IAAA,uNAAM,EAAC,uCAAuC;QAClD,SAAS;IACX;AACF;AAEO,eAAe,sBAAsB,OAA0B;IACpE,MAAM,IAAA,uNAAM,EAAC,gDAAgD;QAC3D,SAAS;IACX;AACF;AAEO,eAAe;IACpB,MAAM,SAAS,MAAM,IAAA,uNAAM,EACzB;IAEF,OAAO;AACT;AAEO,eAAe;IACpB,MAAM,SAAS,MAAM,IAAA,uNAAM,EACzB;IAEF,OAAO;AACT;AAEO,eAAe;IACpB,MAAM,SAAS,MAAM,IAAA,uNAAM,EACzB;IAEF,OAAO;AACT;AAEO,eAAe,oBACpB,OAAmC;IAEnC,MAAM,SAAS,MAAM,IAAA,uNAAM,EACzB,8CACA;QACE,SAAS;IACX;IAEF,OAAO;AACT;AAEO,eAAe;IACpB,MAAM,SAAS,MAAM,IAAA,uNAAM,EACzB;IAEF,OAAO;AACT;AAEO,eAAe;IACpB,MAAM,SAAS,MAAM,IAAA,uNAAM,EAA0B;IACrD,OAAO;AACT"}},
    {"offset": {"line": 3478, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/store/themeStore.ts"],"sourcesContent":["import { create } from 'zustand';\nimport { AppService } from '@/types/system';\nimport { getThemeCode, ThemeCode } from '@/utils/style';\nimport { getSystemColorScheme } from '@/utils/bridge';\nimport { getCurrentWindow } from '@tauri-apps/api/window';\nimport { CustomTheme, Palette, ThemeMode } from '@/styles/themes';\nimport { EnvConfigType, isWebAppPlatform } from '@/services/environment';\nimport { SystemSettings } from '@/types/settings';\nimport { Insets } from '@/types/misc';\n\ndeclare global {\n  interface Window {\n    __READEST_IS_EINK?: boolean;\n  }\n}\n\ninterface ThemeState {\n  themeMode: ThemeMode;\n  themeColor: string;\n  systemIsDarkMode: boolean;\n  themeCode: ThemeCode;\n  isDarkMode: boolean;\n  isEinkMode: boolean;\n  systemUIVisible: boolean;\n  statusBarHeight: number;\n  systemUIAlwaysHidden: boolean;\n  safeAreaInsets: Insets | null;\n  isRoundedWindow: boolean;\n  setSystemUIAlwaysHidden: (hidden: boolean) => void;\n  setStatusBarHeight: (height: number) => void;\n  showSystemUI: () => void;\n  dismissSystemUI: () => void;\n  getIsDarkMode: () => boolean;\n  setThemeMode: (mode: ThemeMode) => void;\n  setThemeColor: (color: string) => void;\n  setIsEinkMode: (isEink: boolean) => void;\n  updateAppTheme: (color: keyof Palette) => void;\n  saveCustomTheme: (\n    envConfig: EnvConfigType,\n    settings: SystemSettings,\n    theme: CustomTheme,\n    isDelete?: boolean,\n  ) => void;\n  handleSystemThemeChange: (isDark: boolean) => void;\n  updateSafeAreaInsets: (insets: Insets) => void;\n}\n\nconst getInitialThemeMode = (): ThemeMode => {\n  if (typeof window !== 'undefined' && localStorage) {\n    return (localStorage.getItem('themeMode') as ThemeMode) || 'auto';\n  }\n  return 'auto';\n};\n\nconst getInitialThemeColor = (): string => {\n  if (typeof window !== 'undefined' && localStorage) {\n    const defaultColor = window.__READEST_IS_EINK ? 'contrast' : 'default';\n    return localStorage.getItem('themeColor') || defaultColor;\n  }\n  return 'default';\n};\n\nexport const useThemeStore = create<ThemeState>((set, get) => {\n  const initialThemeMode = getInitialThemeMode();\n  const initialThemeColor = getInitialThemeColor();\n  const systemIsDarkMode =\n    typeof window !== 'undefined' && window.matchMedia('(prefers-color-scheme: dark)').matches;\n  const isDarkMode =\n    initialThemeMode === 'dark' || (initialThemeMode === 'auto' && systemIsDarkMode);\n  const themeCode = getThemeCode();\n\n  return {\n    themeMode: initialThemeMode,\n    themeColor: initialThemeColor,\n    systemIsDarkMode,\n    isDarkMode,\n    isEinkMode: false,\n    themeCode,\n    systemUIVisible: false,\n    statusBarHeight: 24,\n    systemUIAlwaysHidden: false,\n    safeAreaInsets: { top: 0, right: 0, bottom: 0, left: 0 },\n    isRoundedWindow: true,\n    showSystemUI: () => set({ systemUIVisible: true }),\n    dismissSystemUI: () => set({ systemUIVisible: false }),\n    setStatusBarHeight: (height: number) => set({ statusBarHeight: height }),\n    setSystemUIAlwaysHidden: (hidden: boolean) => set({ systemUIAlwaysHidden: hidden }),\n    getIsDarkMode: () => get().isDarkMode,\n    setIsEinkMode: (isEink: boolean) => {\n      set({ isEinkMode: isEink });\n    },\n    setThemeMode: (mode) => {\n      if (typeof window !== 'undefined' && localStorage) {\n        localStorage.setItem('themeMode', mode);\n      }\n      const isDarkMode = mode === 'dark' || (mode === 'auto' && get().systemIsDarkMode);\n      document.documentElement.setAttribute(\n        'data-theme',\n        `${get().themeColor}-${isDarkMode ? 'dark' : 'light'}`,\n      );\n      set({ themeMode: mode, isDarkMode });\n      set({ themeCode: getThemeCode() });\n    },\n    setThemeColor: (color) => {\n      if (typeof window !== 'undefined' && localStorage) {\n        localStorage.setItem('themeColor', color);\n      }\n      document.documentElement.setAttribute(\n        'data-theme',\n        `${color}-${get().isDarkMode ? 'dark' : 'light'}`,\n      );\n      set({ themeColor: color });\n      set({ themeCode: getThemeCode() });\n    },\n    updateAppTheme: (color) => {\n      if (isWebAppPlatform()) {\n        const { palette } = get().themeCode;\n        document.querySelector('meta[name=\"theme-color\"]')?.setAttribute('content', palette[color]);\n      }\n    },\n    saveCustomTheme: async (envConfig, settings, theme, isDelete) => {\n      const customThemes = settings.globalReadSettings.customThemes || [];\n      const index = customThemes.findIndex((t) => t.name === theme.name);\n      if (isDelete) {\n        if (index > -1) {\n          customThemes.splice(index, 1);\n        }\n      } else {\n        if (index > -1) {\n          customThemes[index] = theme;\n        } else {\n          customThemes.push(theme);\n        }\n      }\n      settings.globalReadSettings.customThemes = customThemes;\n      localStorage.setItem('customThemes', JSON.stringify(customThemes));\n      const appService = await envConfig.getAppService();\n      await appService.saveSettings(settings);\n    },\n    handleSystemThemeChange: (systemIsDarkMode) => {\n      const mode = get().themeMode;\n      const isDarkMode = mode === 'dark' || (mode === 'auto' && systemIsDarkMode);\n      set({ systemIsDarkMode, isDarkMode });\n    },\n    updateSafeAreaInsets: (insets) => {\n      set({ safeAreaInsets: insets });\n    },\n  };\n});\n\nexport const loadDataTheme = () => {\n  if (typeof localStorage === 'undefined' || typeof document === 'undefined') return;\n\n  const themeMode = localStorage.getItem('themeMode');\n  const themeColor = localStorage.getItem('themeColor');\n  if (themeMode && themeColor) {\n    const systemIsDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches;\n    const isDarkMode = themeMode === 'dark' || (themeMode === 'auto' && systemIsDarkMode);\n    document.documentElement.setAttribute(\n      'data-theme',\n      `${themeColor}-${isDarkMode ? 'dark' : 'light'}`,\n    );\n  }\n};\n\nexport const initSystemThemeListener = (appService: AppService) => {\n  if (typeof window === 'undefined' || !appService) return;\n\n  const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');\n  const updateColorTheme = async () => {\n    let systemIsDarkMode;\n    if (appService.isIOSApp) {\n      const res = await getSystemColorScheme();\n      systemIsDarkMode = res.colorScheme === 'dark';\n    } else {\n      systemIsDarkMode = mediaQuery.matches;\n    }\n    useThemeStore.getState().handleSystemThemeChange(systemIsDarkMode);\n  };\n\n  const updateWindowTheme = async () => {\n    if (!appService.hasWindow || !appService.isLinuxApp) return;\n    const currentWindow = getCurrentWindow();\n    const isFullscreen = await currentWindow.isFullscreen();\n    const isMaximized = await currentWindow.isMaximized();\n    useThemeStore.setState({ isRoundedWindow: !isMaximized && !isFullscreen });\n  };\n\n  mediaQuery?.addEventListener('change', updateColorTheme);\n  document.addEventListener('visibilitychange', updateColorTheme);\n  window.addEventListener('resize', updateWindowTheme);\n  updateColorTheme();\n};\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 3660, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/utils/time.ts"],"sourcesContent":["import dayjs from 'dayjs';\nimport relativeTime from 'dayjs/plugin/relativeTime';\n\nimport 'dayjs/locale/en';\nimport 'dayjs/locale/zh';\nimport 'dayjs/locale/de';\nimport 'dayjs/locale/ja';\nimport 'dayjs/locale/ko';\nimport 'dayjs/locale/ru';\nimport 'dayjs/locale/fr';\nimport 'dayjs/locale/el';\nimport 'dayjs/locale/es';\nimport 'dayjs/locale/it';\nimport 'dayjs/locale/pt';\nimport 'dayjs/locale/pt-br';\nimport 'dayjs/locale/ar';\nimport 'dayjs/locale/id';\nimport 'dayjs/locale/hi';\nimport 'dayjs/locale/th';\nimport 'dayjs/locale/tr';\nimport 'dayjs/locale/vi';\nimport 'dayjs/locale/uk';\nimport 'dayjs/locale/pl';\nimport 'dayjs/locale/fi';\nimport 'dayjs/locale/nl';\nimport 'dayjs/locale/ro';\nimport 'dayjs/locale/zh-tw';\nimport 'dayjs/locale/zh-cn';\n\nexport const initDayjs = (locale: string) => {\n  dayjs.locale(locale);\n  dayjs.extend(relativeTime);\n};\n"],"names":[],"mappings":";;;;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAEO,MAAM,YAAY,CAAC;IACxB,gMAAK,CAAC,MAAM,CAAC;IACb,gMAAK,CAAC,MAAM,CAAC,0MAAY;AAC3B"}},
    {"offset": {"line": 3729, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/store/settingsStore.ts"],"sourcesContent":["import i18n from '@/i18n/i18n';\nimport { create } from 'zustand';\nimport { SystemSettings } from '@/types/settings';\nimport { EnvConfigType } from '@/services/environment';\nimport { initDayjs } from '@/utils/time';\n\nexport type FontPanelView = 'main-fonts' | 'custom-fonts';\n\ninterface SettingsState {\n  settings: SystemSettings;\n  settingsDialogBookKey: string;\n  isSettingsDialogOpen: boolean;\n  isSettingsGlobal: boolean;\n  fontPanelView: FontPanelView;\n  setSettings: (settings: SystemSettings) => void;\n  saveSettings: (envConfig: EnvConfigType, settings: SystemSettings) => void;\n  setSettingsDialogBookKey: (bookKey: string) => void;\n  setSettingsDialogOpen: (open: boolean) => void;\n  setSettingsGlobal: (global: boolean) => void;\n  setFontPanelView: (view: FontPanelView) => void;\n\n  applyUILanguage: (uiLanguage?: string) => void;\n}\n\nexport const useSettingsStore = create<SettingsState>((set) => ({\n  settings: {} as SystemSettings,\n  settingsDialogBookKey: '',\n  isSettingsDialogOpen: false,\n  isSettingsGlobal: true,\n  fontPanelView: 'main-fonts',\n  setSettings: (settings) => set({ settings }),\n  saveSettings: async (envConfig: EnvConfigType, settings: SystemSettings) => {\n    const appService = await envConfig.getAppService();\n    await appService.saveSettings(settings);\n  },\n  setSettingsDialogBookKey: (bookKey) => set({ settingsDialogBookKey: bookKey }),\n  setSettingsDialogOpen: (open) => set({ isSettingsDialogOpen: open }),\n  setSettingsGlobal: (global) => set({ isSettingsGlobal: global }),\n  setFontPanelView: (view) => set({ fontPanelView: view }),\n\n  applyUILanguage: (uiLanguage?: string) => {\n    const locale = uiLanguage ? uiLanguage : navigator.language;\n    i18n.changeLanguage(locale);\n    initDayjs(locale);\n  },\n}));\n"],"names":[],"mappings":";;;;AAAA;AACA;AAGA;;;;AAoBO,MAAM,mBAAmB,IAAA,4PAAM,EAAgB,CAAC,MAAQ,CAAC;QAC9D,UAAU,CAAC;QACX,uBAAuB;QACvB,sBAAsB;QACtB,kBAAkB;QAClB,eAAe;QACf,aAAa,CAAC,WAAa,IAAI;gBAAE;YAAS;QAC1C,cAAc,OAAO,WAA0B;YAC7C,MAAM,aAAa,MAAM,UAAU,aAAa;YAChD,MAAM,WAAW,YAAY,CAAC;QAChC;QACA,0BAA0B,CAAC,UAAY,IAAI;gBAAE,uBAAuB;YAAQ;QAC5E,uBAAuB,CAAC,OAAS,IAAI;gBAAE,sBAAsB;YAAK;QAClE,mBAAmB,CAAC,SAAW,IAAI;gBAAE,kBAAkB;YAAO;QAC9D,kBAAkB,CAAC,OAAS,IAAI;gBAAE,eAAe;YAAK;QAEtD,iBAAiB,CAAC;YAChB,MAAM,SAAS,aAAa,aAAa,UAAU,QAAQ;YAC3D,oJAAI,CAAC,cAAc,CAAC;YACpB,IAAA,uJAAS,EAAC;QACZ;IACF,CAAC"}},
    {"offset": {"line": 3777, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/hooks/useSafeAreaInsets.ts"],"sourcesContent":["'use client';\n\nimport { useCallback, useRef, useEffect } from 'react';\nimport { useEnv } from '@/context/EnvContext';\nimport { useThemeStore } from '@/store/themeStore';\nimport { Insets } from '@/types/misc';\nimport { getSafeAreaInsets } from '@/utils/bridge';\n\nexport const useSafeAreaInsets = () => {\n  const { appService } = useEnv();\n  const currentInsets = useRef({ top: 0, right: 0, bottom: 0, left: 0 });\n\n  const { updateSafeAreaInsets } = useThemeStore();\n\n  const updateInsets = (insets: Insets) => {\n    const { top, right, bottom, left } = currentInsets.current;\n    if (\n      insets.top !== top ||\n      insets.right !== right ||\n      insets.bottom !== bottom ||\n      insets.left !== left\n    ) {\n      currentInsets.current = insets;\n      updateSafeAreaInsets(insets);\n    }\n  };\n\n  const onUpdateInsets = useCallback(() => {\n    if (!appService) return;\n\n    if (!appService.hasSafeAreaInset) {\n      updateInsets(currentInsets.current);\n      return;\n    }\n\n    const rootStyles = getComputedStyle(document.documentElement);\n    const hasCustomProperties = rootStyles.getPropertyValue('--safe-area-inset-top');\n    const isWebView139 = /Chrome\\/139/.test(navigator.userAgent);\n    // safe-area-inset-* values in css are always 0px in some versions of webview 139\n    // due to https://issues.chromium.org/issues/40699457\n    if (appService.isAndroidApp && isWebView139) {\n      getSafeAreaInsets().then((response) => {\n        if (response.error) {\n          console.error('Error getting safe area insets from native bridge:', response.error);\n        } else {\n          const insets = {\n            top: Math.round(response.top),\n            right: Math.round(response.right),\n            bottom: Math.round(response.bottom),\n            left: Math.round(response.left),\n          };\n          updateInsets(insets);\n        }\n      });\n    } else if (hasCustomProperties) {\n      const top = parseFloat(rootStyles.getPropertyValue('--safe-area-inset-top')) || 0;\n      const right = parseFloat(rootStyles.getPropertyValue('--safe-area-inset-right')) || 0;\n      const bottom = parseFloat(rootStyles.getPropertyValue('--safe-area-inset-bottom')) || 0;\n      const left = parseFloat(rootStyles.getPropertyValue('--safe-area-inset-left')) || 0;\n      const insets = {\n        top: Math.round(top),\n        right: Math.round(right),\n        bottom: Math.round(bottom),\n        left: Math.round(left),\n      };\n      updateInsets(insets);\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [appService]);\n\n  useEffect(() => {\n    onUpdateInsets();\n    if (window.screen?.orientation) {\n      window.screen.orientation.addEventListener('change', onUpdateInsets);\n    } else {\n      window.addEventListener('orientationchange', onUpdateInsets);\n    }\n    return () => {\n      if (window.screen?.orientation) {\n        window.screen.orientation.removeEventListener('change', onUpdateInsets);\n      } else {\n        window.removeEventListener('orientationchange', onUpdateInsets);\n      }\n    };\n  }, [onUpdateInsets]);\n};\n"],"names":[],"mappings":";;;;AAEA;AACA;AACA;AAEA;;AANA;;;;;AAQO,MAAM,oBAAoB;;IAC/B,MAAM,EAAE,UAAU,EAAE,GAAG,IAAA,6JAAM;IAC7B,MAAM,gBAAgB,IAAA,uLAAM,EAAC;QAAE,KAAK;QAAG,OAAO;QAAG,QAAQ;QAAG,MAAM;IAAE;IAEpE,MAAM,EAAE,oBAAoB,EAAE,GAAG,IAAA,iKAAa;IAE9C,MAAM,eAAe,CAAC;QACpB,MAAM,EAAE,GAAG,EAAE,KAAK,EAAE,MAAM,EAAE,IAAI,EAAE,GAAG,cAAc,OAAO;QAC1D,IACE,OAAO,GAAG,KAAK,OACf,OAAO,KAAK,KAAK,SACjB,OAAO,MAAM,KAAK,UAClB,OAAO,IAAI,KAAK,MAChB;YACA,cAAc,OAAO,GAAG;YACxB,qBAAqB;QACvB;IACF;IAEA,MAAM,iBAAiB,IAAA,4LAAW;yDAAC;YACjC,IAAI,CAAC,YAAY;YAEjB,IAAI,CAAC,WAAW,gBAAgB,EAAE;gBAChC,aAAa,cAAc,OAAO;gBAClC;YACF;YAEA,MAAM,aAAa,iBAAiB,SAAS,eAAe;YAC5D,MAAM,sBAAsB,WAAW,gBAAgB,CAAC;YACxD,MAAM,eAAe,cAAc,IAAI,CAAC,UAAU,SAAS;YAC3D,iFAAiF;YACjF,qDAAqD;YACrD,IAAI,WAAW,YAAY,IAAI,cAAc;gBAC3C,IAAA,iKAAiB,IAAG,IAAI;qEAAC,CAAC;wBACxB,IAAI,SAAS,KAAK,EAAE;4BAClB,QAAQ,KAAK,CAAC,sDAAsD,SAAS,KAAK;wBACpF,OAAO;4BACL,MAAM,SAAS;gCACb,KAAK,KAAK,KAAK,CAAC,SAAS,GAAG;gCAC5B,OAAO,KAAK,KAAK,CAAC,SAAS,KAAK;gCAChC,QAAQ,KAAK,KAAK,CAAC,SAAS,MAAM;gCAClC,MAAM,KAAK,KAAK,CAAC,SAAS,IAAI;4BAChC;4BACA,aAAa;wBACf;oBACF;;YACF,OAAO,IAAI,qBAAqB;gBAC9B,MAAM,MAAM,WAAW,WAAW,gBAAgB,CAAC,6BAA6B;gBAChF,MAAM,QAAQ,WAAW,WAAW,gBAAgB,CAAC,+BAA+B;gBACpF,MAAM,SAAS,WAAW,WAAW,gBAAgB,CAAC,gCAAgC;gBACtF,MAAM,OAAO,WAAW,WAAW,gBAAgB,CAAC,8BAA8B;gBAClF,MAAM,SAAS;oBACb,KAAK,KAAK,KAAK,CAAC;oBAChB,OAAO,KAAK,KAAK,CAAC;oBAClB,QAAQ,KAAK,KAAK,CAAC;oBACnB,MAAM,KAAK,KAAK,CAAC;gBACnB;gBACA,aAAa;YACf;QACA,uDAAuD;QACzD;wDAAG;QAAC;KAAW;IAEf,IAAA,0LAAS;uCAAC;YACR;YACA,IAAI,OAAO,MAAM,EAAE,aAAa;gBAC9B,OAAO,MAAM,CAAC,WAAW,CAAC,gBAAgB,CAAC,UAAU;YACvD,OAAO;gBACL,OAAO,gBAAgB,CAAC,qBAAqB;YAC/C;YACA;+CAAO;oBACL,IAAI,OAAO,MAAM,EAAE,aAAa;wBAC9B,OAAO,MAAM,CAAC,WAAW,CAAC,mBAAmB,CAAC,UAAU;oBAC1D,OAAO;wBACL,OAAO,mBAAmB,CAAC,qBAAqB;oBAClD;gBACF;;QACF;sCAAG;QAAC;KAAe;AACrB;GA7Ea;;QACY,6JAAM;QAGI,iKAAa"}},
    {"offset": {"line": 3889, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/hooks/useResponsiveSize.ts"],"sourcesContent":["import { useMediaQuery } from 'react-responsive';\n\n// use desktop size as base size\nexport const useResponsiveSize = (baseSize: number) => {\n  const isPhone = useMediaQuery({ maxWidth: 480 });\n  const isTablet = useMediaQuery({ minWidth: 481, maxWidth: 1024 });\n  if (isPhone) return baseSize * 1.25;\n  if (isTablet) return baseSize * 1.25;\n  return baseSize;\n};\n\nexport const useDefaultIconSize = () => {\n  return useResponsiveSize(20);\n};\n"],"names":[],"mappings":";;;;;;AAAA;;;AAGO,MAAM,oBAAoB,CAAC;;IAChC,MAAM,UAAU,IAAA,+PAAa,EAAC;QAAE,UAAU;IAAI;IAC9C,MAAM,WAAW,IAAA,+PAAa,EAAC;QAAE,UAAU;QAAK,UAAU;IAAK;IAC/D,IAAI,SAAS,OAAO,WAAW;IAC/B,IAAI,UAAU,OAAO,WAAW;IAChC,OAAO;AACT;GANa;;QACK,+PAAa;QACZ,+PAAa;;;AAMzB,MAAM,qBAAqB;;IAChC,OAAO,kBAAkB;AAC3B;IAFa;;QACJ"}},
    {"offset": {"line": 3933, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/utils/path.ts"],"sourcesContent":["import { join } from '@tauri-apps/api/path';\nimport { isContentURI, isFileURI, isValidURL } from './misc';\n\nexport const getFilename = (fileOrUri: string) => {\n  if (isValidURL(fileOrUri) || isContentURI(fileOrUri) || isFileURI(fileOrUri)) {\n    fileOrUri = decodeURI(fileOrUri);\n  }\n  const normalizedPath = fileOrUri.replace(/\\\\/g, '/');\n  const parts = normalizedPath.split('/');\n  const lastPart = parts.pop()!;\n  return lastPart.split('?')[0]!;\n};\n\nexport const getBaseFilename = (filename: string) => {\n  const normalizedPath = filename.replace(/\\\\/g, '/');\n  const name = normalizedPath.split('/').pop() || '';\n\n  const parts = name.split('.');\n  if (parts.length <= 1) {\n    return name;\n  }\n\n  return parts.slice(0, -1).join('.');\n};\n\nexport const getDirPath = (filePath: string) => {\n  const normalizedPath = filePath.replace(/\\\\/g, '/');\n  const parts = normalizedPath.split('/');\n  parts.pop();\n  return parts.join('/');\n};\n\nexport const joinPaths = async (...paths: string[]) => {\n  return await join(...paths);\n};\n"],"names":[],"mappings":";;;;;;;;;;AAAA;AACA;;;AAEO,MAAM,cAAc,CAAC;IAC1B,IAAI,IAAA,wJAAU,EAAC,cAAc,IAAA,0JAAY,EAAC,cAAc,IAAA,uJAAS,EAAC,YAAY;QAC5E,YAAY,UAAU;IACxB;IACA,MAAM,iBAAiB,UAAU,OAAO,CAAC,OAAO;IAChD,MAAM,QAAQ,eAAe,KAAK,CAAC;IACnC,MAAM,WAAW,MAAM,GAAG;IAC1B,OAAO,SAAS,KAAK,CAAC,IAAI,CAAC,EAAE;AAC/B;AAEO,MAAM,kBAAkB,CAAC;IAC9B,MAAM,iBAAiB,SAAS,OAAO,CAAC,OAAO;IAC/C,MAAM,OAAO,eAAe,KAAK,CAAC,KAAK,GAAG,MAAM;IAEhD,MAAM,QAAQ,KAAK,KAAK,CAAC;IACzB,IAAI,MAAM,MAAM,IAAI,GAAG;QACrB,OAAO;IACT;IAEA,OAAO,MAAM,KAAK,CAAC,GAAG,CAAC,GAAG,IAAI,CAAC;AACjC;AAEO,MAAM,aAAa,CAAC;IACzB,MAAM,iBAAiB,SAAS,OAAO,CAAC,OAAO;IAC/C,MAAM,QAAQ,eAAe,KAAK,CAAC;IACnC,MAAM,GAAG;IACT,OAAO,MAAM,IAAI,CAAC;AACpB;AAEO,MAAM,YAAY,OAAO,GAAG;IACjC,OAAO,MAAM,IAAA,qNAAI,KAAI;AACvB"}},
    {"offset": {"line": 3981, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/utils/md5.ts"],"sourcesContent":["import { md5 } from 'js-md5';\n\nexport function isMd5(value: string): boolean {\n  return /^[0-9a-f]{32}$/.test(value);\n}\n\nexport function md5Fingerprint(value: string): string {\n  return md5(value).slice(0, 7);\n}\n\nexport async function partialMD5(file: File): Promise<string> {\n  const step = 1024;\n  const size = 1024;\n  const hasher = md5.create();\n\n  for (let i = -1; i <= 10; i++) {\n    const start = Math.min(file.size, step << (2 * i));\n    const end = Math.min(start + size, file.size);\n\n    if (start >= file.size) break;\n\n    const blobSlice = file.slice(start, end);\n    const arrayBuffer = await blobSlice.arrayBuffer();\n    const uint8Array = new Uint8Array(arrayBuffer);\n\n    hasher.update(uint8Array);\n  }\n\n  return hasher.hex();\n}\n\nexport { md5 };\n"],"names":[],"mappings":";;;;;;;;AAAA;;AAEO,SAAS,MAAM,KAAa;IACjC,OAAO,iBAAiB,IAAI,CAAC;AAC/B;AAEO,SAAS,eAAe,KAAa;IAC1C,OAAO,IAAA,gMAAG,EAAC,OAAO,KAAK,CAAC,GAAG;AAC7B;AAEO,eAAe,WAAW,IAAU;IACzC,MAAM,OAAO;IACb,MAAM,OAAO;IACb,MAAM,SAAS,gMAAG,CAAC,MAAM;IAEzB,IAAK,IAAI,IAAI,CAAC,GAAG,KAAK,IAAI,IAAK;QAC7B,MAAM,QAAQ,KAAK,GAAG,CAAC,KAAK,IAAI,EAAE,QAAS,IAAI;QAC/C,MAAM,MAAM,KAAK,GAAG,CAAC,QAAQ,MAAM,KAAK,IAAI;QAE5C,IAAI,SAAS,KAAK,IAAI,EAAE;QAExB,MAAM,YAAY,KAAK,KAAK,CAAC,OAAO;QACpC,MAAM,cAAc,MAAM,UAAU,WAAW;QAC/C,MAAM,aAAa,IAAI,WAAW;QAElC,OAAO,MAAM,CAAC;IAChB;IAEA,OAAO,OAAO,GAAG;AACnB"}},
    {"offset": {"line": 4020, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/styles/textures.ts"],"sourcesContent":["import { getFilename } from '@/utils/path';\nimport { md5Fingerprint } from '@/utils/md5';\n\nexport interface BackgroundTexture {\n  id: string;\n  name: string;\n  path?: string;\n  url?: string;\n\n  downloadedAt?: number;\n  deletedAt?: number;\n\n  blobUrl?: string;\n  loaded?: boolean;\n  error?: string;\n}\n\nexport type CustomTexture = BackgroundTexture & { path: string };\n\nexport type CustomTextureInfo = Partial<BackgroundTexture> &\n  Required<Pick<BackgroundTexture, 'path' | 'name'>>;\n\nexport const PREDEFINED_TEXTURES: BackgroundTexture[] = [\n  { id: 'none', name: 'None', url: '', loaded: true },\n  { id: 'concrete', name: 'Concrete', url: '/images/concrete-texture.png', loaded: true },\n  { id: 'paper', name: 'Paper', url: '/images/paper-texture.png', loaded: true },\n  { id: 'sand', name: 'Sand', url: '/images/sand-texture.jpg', loaded: true },\n  { id: 'parchment', name: 'Parchment', url: '/images/parchment-paper.jpg', loaded: true },\n  { id: 'scrapbook', name: 'Scrapbook', url: '/images/scrapbook-texture.jpg', loaded: true },\n  { id: 'leaves', name: 'Leaves', url: '/images/leaves-pattern.jpg', loaded: true },\n  { id: 'moon', name: 'Moon Sky', url: '/images/moon-sky.jpg', loaded: true },\n  { id: 'night-sky', name: 'Night Sky', url: '/images/night-sky.jpg', loaded: true },\n];\n\nexport function getTextureName(path: string): string {\n  const fileName = getFilename(path);\n  return fileName.replace(/\\.(jpg|jpeg|png|gif|bmp|webp)$/i, '');\n}\n\nexport function getTextureId(name: string): string {\n  return md5Fingerprint(name);\n}\n\nexport function createCustomTexture(path: string): CustomTexture {\n  const name = getTextureName(path);\n  return {\n    id: getTextureId(name),\n    name,\n    path,\n  };\n}\n\nconst createTextureCSS = (texture: BackgroundTexture) => {\n  const css = `\n    .sidebar-container, .notebook-container, .foliate-viewer {\n      position: relative;\n    }\n\n    body::before, .sidebar-container::before, .notebook-container::before,\n    .foliate-viewer::before {\n      content: \"\";\n      position: absolute;\n      top: 0;\n      left: 0;\n      right: 0;\n      bottom: 0;\n      pointer-events: none;\n      z-index: 0;\n      background-image: url(\"${texture.blobUrl || texture.url}\");\n      background-repeat: repeat;\n      background-size: var(--bg-texture-size, cover);\n      mix-blend-mode: var(--bg-texture-blend-mode, multiply);\n      opacity: var(--bg-texture-opacity, 0.6);\n    }\n    body::before {\n      height: 100vh;\n    }\n    `;\n\n  return css;\n};\n\nconst textureStyleId = 'background-texture';\nexport const mountBackgroundTexture = (document: Document, texture: BackgroundTexture) => {\n  const styleElement = document.getElementById(textureStyleId) || document.createElement('style');\n  styleElement.id = textureStyleId;\n  styleElement.textContent = createTextureCSS(texture);\n\n  if (!styleElement.parentNode) {\n    document.head.appendChild(styleElement);\n  }\n};\n\nexport const unmountBackgroundTexture = (document: Document) => {\n  const styleElement = document.getElementById(textureStyleId);\n  if (styleElement && styleElement.parentNode) {\n    styleElement.parentNode.removeChild(styleElement);\n  }\n};\n"],"names":[],"mappings":";;;;;;;;;;;;;;AAAA;AACA;;;AAqBO,MAAM,sBAA2C;IACtD;QAAE,IAAI;QAAQ,MAAM;QAAQ,KAAK;QAAI,QAAQ;IAAK;IAClD;QAAE,IAAI;QAAY,MAAM;QAAY,KAAK;QAAgC,QAAQ;IAAK;IACtF;QAAE,IAAI;QAAS,MAAM;QAAS,KAAK;QAA6B,QAAQ;IAAK;IAC7E;QAAE,IAAI;QAAQ,MAAM;QAAQ,KAAK;QAA4B,QAAQ;IAAK;IAC1E;QAAE,IAAI;QAAa,MAAM;QAAa,KAAK;QAA+B,QAAQ;IAAK;IACvF;QAAE,IAAI;QAAa,MAAM;QAAa,KAAK;QAAiC,QAAQ;IAAK;IACzF;QAAE,IAAI;QAAU,MAAM;QAAU,KAAK;QAA8B,QAAQ;IAAK;IAChF;QAAE,IAAI;QAAQ,MAAM;QAAY,KAAK;QAAwB,QAAQ;IAAK;IAC1E;QAAE,IAAI;QAAa,MAAM;QAAa,KAAK;QAAyB,QAAQ;IAAK;CAClF;AAEM,SAAS,eAAe,IAAY;IACzC,MAAM,WAAW,IAAA,yJAAW,EAAC;IAC7B,OAAO,SAAS,OAAO,CAAC,mCAAmC;AAC7D;AAEO,SAAS,aAAa,IAAY;IACvC,OAAO,IAAA,2KAAc,EAAC;AACxB;AAEO,SAAS,oBAAoB,IAAY;IAC9C,MAAM,OAAO,eAAe;IAC5B,OAAO;QACL,IAAI,aAAa;QACjB;QACA;IACF;AACF;AAEA,MAAM,mBAAmB,CAAC;IACxB,MAAM,MAAM,CAAC;;;;;;;;;;;;;;;6BAec,EAAE,QAAQ,OAAO,IAAI,QAAQ,GAAG,CAAC;;;;;;;;;IAS1D,CAAC;IAEH,OAAO;AACT;AAEA,MAAM,iBAAiB;AAChB,MAAM,yBAAyB,CAAC,UAAoB;IACzD,MAAM,eAAe,SAAS,cAAc,CAAC,mBAAmB,SAAS,aAAa,CAAC;IACvF,aAAa,EAAE,GAAG;IAClB,aAAa,WAAW,GAAG,iBAAiB;IAE5C,IAAI,CAAC,aAAa,UAAU,EAAE;QAC5B,SAAS,IAAI,CAAC,WAAW,CAAC;IAC5B;AACF;AAEO,MAAM,2BAA2B,CAAC;IACvC,MAAM,eAAe,SAAS,cAAc,CAAC;IAC7C,IAAI,gBAAgB,aAAa,UAAU,EAAE;QAC3C,aAAa,UAAU,CAAC,WAAW,CAAC;IACtC;AACF"}},
    {"offset": {"line": 4159, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/store/customTextureStore.ts"],"sourcesContent":["import { create } from 'zustand';\nimport { EnvConfigType } from '@/services/environment';\nimport {\n  CustomTexture,\n  PREDEFINED_TEXTURES,\n  createCustomTexture,\n  mountBackgroundTexture,\n  unmountBackgroundTexture,\n} from '@/styles/textures';\nimport { useSettingsStore } from './settingsStore';\n\ninterface TextureStoreState {\n  textures: CustomTexture[];\n  loading: boolean;\n\n  setTextures: (textures: CustomTexture[]) => void;\n  addTexture: (path: string) => CustomTexture;\n  removeTexture: (id: string) => boolean;\n  updateTexture: (id: string, updates: Partial<CustomTexture>) => boolean;\n  getTexture: (id: string) => CustomTexture | undefined;\n  getAllTextures: () => CustomTexture[];\n  getAvailableTextures: () => CustomTexture[];\n  clearAllTextures: () => void;\n\n  applyTexture: (envConfig: EnvConfigType, textureId: string) => Promise<void>;\n  loadTexture: (envConfig: EnvConfigType, textureId: string) => Promise<CustomTexture>;\n  loadTextures: (envConfig: EnvConfigType, textureIds: string[]) => Promise<CustomTexture[]>;\n  loadAllTextures: (envConfig: EnvConfigType) => Promise<CustomTexture[]>;\n  unloadTexture: (textureId: string) => boolean;\n  unloadAllTextures: () => void;\n\n  getLoadedTextures: () => CustomTexture[];\n  isTextureLoaded: (textureId: string) => boolean;\n\n  loadCustomTextures: (envConfig: EnvConfigType) => Promise<void>;\n  saveCustomTextures: (envConfig: EnvConfigType) => Promise<void>;\n}\n\nfunction toSettingsTexture(texture: CustomTexture): CustomTexture {\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  const { blobUrl, loaded, error, ...settingsTexture } = texture;\n  return settingsTexture;\n}\n\nexport const useCustomTextureStore = create<TextureStoreState>((set, get) => ({\n  textures: [],\n  loading: false,\n\n  setTextures: (textures) => set({ textures }),\n\n  addTexture: (path) => {\n    const texture = createCustomTexture(path);\n    const existingTexture = get().textures.find((t) => t.id === texture.id);\n\n    if (existingTexture) {\n      get().updateTexture(texture.id, {\n        ...texture,\n        path: texture.path,\n        downloadedAt: Date.now(),\n        deletedAt: undefined,\n        loaded: false,\n        blobUrl: undefined,\n        error: undefined,\n      });\n      set((state) => ({\n        textures: [...state.textures],\n      }));\n      return existingTexture;\n    }\n\n    const newTexture = {\n      ...texture,\n      downloadedAt: Date.now(),\n    };\n\n    set((state) => ({\n      textures: [...state.textures, newTexture],\n    }));\n\n    return newTexture;\n  },\n\n  removeTexture: (id) => {\n    const texture = get().getTexture(id);\n    if (!texture) return false;\n\n    if (texture.blobUrl) {\n      URL.revokeObjectURL(texture.blobUrl);\n    }\n\n    const result = get().updateTexture(id, {\n      deletedAt: Date.now(),\n      blobUrl: undefined,\n      loaded: false,\n      error: undefined,\n    });\n    set((state) => ({\n      textures: [...state.textures],\n    }));\n    return result;\n  },\n\n  updateTexture: (id, updates) => {\n    const state = get();\n    const textureIndex = state.textures.findIndex((texture) => texture.id === id);\n\n    if (textureIndex === -1) return false;\n\n    set((state) => ({\n      textures: state.textures.map((texture, index) =>\n        index === textureIndex ? { ...texture, ...updates } : texture,\n      ),\n    }));\n\n    return true;\n  },\n\n  getTexture: (id) => {\n    return get().textures.find((texture) => texture.id === id);\n  },\n\n  getAllTextures: () => {\n    return get().textures;\n  },\n\n  getAvailableTextures: () => {\n    return get().textures.filter((texture) => !texture.deletedAt);\n  },\n\n  clearAllTextures: () => {\n    const { textures } = get();\n    textures.forEach((texture) => {\n      if (texture.blobUrl) {\n        URL.revokeObjectURL(texture.blobUrl);\n      }\n    });\n\n    set({ textures: [] });\n  },\n\n  loadTexture: async (envConfig, textureId) => {\n    const texture = get().getTexture(textureId);\n\n    if (!texture) {\n      throw new Error(`Texture with id \"${textureId}\" not found`);\n    }\n\n    if (texture.deletedAt) {\n      throw new Error(`Texture \"${texture.name}\" has been deleted`);\n    }\n\n    if (texture.loaded && texture.blobUrl && !texture.error) {\n      return texture;\n    }\n\n    try {\n      get().updateTexture(textureId, {\n        loaded: false,\n        error: undefined,\n      });\n\n      const appService = await envConfig.getAppService();\n      const textureFile = await appService.openFile(texture.path, 'Images');\n\n      const ext = texture.path.split('.').pop()?.toLowerCase();\n      const mimeTypes: { [key: string]: string } = {\n        jpg: 'image/jpeg',\n        jpeg: 'image/jpeg',\n        png: 'image/png',\n        gif: 'image/gif',\n        webp: 'image/webp',\n        bmp: 'image/bmp',\n      };\n      const mimeType = mimeTypes[ext || ''] || 'image/jpeg';\n\n      const blob = new Blob([await textureFile.arrayBuffer()], { type: mimeType });\n      const blobUrl = URL.createObjectURL(blob);\n\n      get().updateTexture(textureId, {\n        blobUrl,\n        loaded: true,\n        error: undefined,\n      });\n\n      const updatedTexture = get().getTexture(textureId)!;\n      return updatedTexture;\n    } catch (error) {\n      const errorMessage = error instanceof Error ? error.message : 'Unknown error';\n      get().updateTexture(textureId, {\n        loaded: false,\n        error: errorMessage,\n        blobUrl: undefined,\n      });\n\n      throw error;\n    }\n  },\n\n  loadTextures: async (envConfig, textureIds) => {\n    set({ loading: true });\n    try {\n      const results = await Promise.allSettled(\n        textureIds.map((id) => get().loadTexture(envConfig, id)),\n      );\n\n      return results\n        .filter(\n          (result): result is PromiseFulfilledResult<CustomTexture> =>\n            result.status === 'fulfilled',\n        )\n        .map((result) => result.value);\n    } finally {\n      set({ loading: false });\n    }\n  },\n\n  loadAllTextures: async (envConfig) => {\n    const textureIds = get()\n      .getAvailableTextures()\n      .map((texture) => texture.id);\n    return await get().loadTextures(envConfig, textureIds);\n  },\n\n  unloadTexture: (textureId) => {\n    const texture = get().getTexture(textureId);\n\n    if (texture?.blobUrl) {\n      URL.revokeObjectURL(texture.blobUrl);\n    }\n\n    return get().updateTexture(textureId, {\n      blobUrl: undefined,\n      loaded: false,\n      error: undefined,\n    });\n  },\n\n  unloadAllTextures: () => {\n    const textures = get().getAllTextures();\n\n    textures.forEach((texture) => {\n      if (texture.blobUrl) {\n        URL.revokeObjectURL(texture.blobUrl);\n      }\n    });\n\n    textures.forEach((texture) => {\n      get().updateTexture(texture.id, {\n        blobUrl: undefined,\n        loaded: false,\n        error: undefined,\n      });\n    });\n  },\n\n  getLoadedTextures: () => {\n    return get()\n      .getAvailableTextures()\n      .filter((texture) => texture.loaded && !texture.error);\n  },\n\n  isTextureLoaded: (textureId) => {\n    const texture = get().getTexture(textureId);\n    return texture?.loaded === true && !texture.error && !texture.deletedAt;\n  },\n\n  applyTexture: async (envConfig, textureId) => {\n    const customTextures = get().getAvailableTextures();\n    const allTextures = [...PREDEFINED_TEXTURES, ...customTextures];\n    let selectedTexture = allTextures.find((t) => t.id === textureId);\n\n    if (!selectedTexture || selectedTexture.id === 'none') {\n      unmountBackgroundTexture(document);\n      return;\n    }\n\n    if (customTextures.find((t) => t.id === textureId) && !get().isTextureLoaded(textureId)) {\n      selectedTexture = await get().loadTexture(envConfig, textureId);\n    }\n\n    mountBackgroundTexture(document, selectedTexture);\n  },\n\n  loadCustomTextures: async (envConfig) => {\n    try {\n      const { settings } = useSettingsStore.getState();\n      const currentTextures = get().textures;\n\n      if (settings?.customTextures) {\n        const textures = settings.customTextures.map((texture) => {\n          const existingTexture = currentTextures.find((t) => t.id === texture.id);\n          return {\n            ...texture,\n            loaded: existingTexture?.loaded || false,\n            error: existingTexture?.error,\n            blobUrl: existingTexture?.blobUrl,\n          };\n        });\n        set({ textures });\n        await get().loadAllTextures(envConfig);\n      }\n    } catch (error) {\n      console.error('Failed to load custom textures settings:', error);\n    }\n  },\n\n  saveCustomTextures: async (envConfig) => {\n    try {\n      const { settings, setSettings, saveSettings } = useSettingsStore.getState();\n      const { textures } = get();\n\n      settings.customTextures = textures.map(toSettingsTexture);\n\n      setSettings(settings);\n      saveSettings(envConfig, settings);\n    } catch (error) {\n      console.error('Failed to save custom textures settings:', error);\n      throw error;\n    }\n  },\n}));\n\n// Cleanup blob URLs before page unload\nif (typeof window !== 'undefined') {\n  window.addEventListener('beforeunload', () => {\n    const store = useCustomTextureStore.getState();\n    const textures = store.getAllTextures();\n    textures.forEach((texture) => {\n      if (texture.blobUrl) {\n        URL.revokeObjectURL(texture.blobUrl);\n      }\n    });\n  });\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 4435, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/hooks/useBackgroundTexture.ts"],"sourcesContent":["'use client';\n\nimport { useCallback } from 'react';\nimport { useCustomTextureStore } from '@/store/customTextureStore';\nimport { useSettingsStore } from '@/store/settingsStore';\nimport { EnvConfigType } from '@/services/environment';\nimport { ViewSettings } from '@/types/book';\n\nexport const useBackgroundTexture = () => {\n  const applyBackgroundTexture = useCallback(\n    (envConfig: EnvConfigType, viewSettings: ViewSettings) => {\n      const textureId = viewSettings.backgroundTextureId;\n      const textureOpacity = viewSettings.backgroundOpacity;\n      const textureSize = viewSettings.backgroundSize;\n      if (!textureId || textureId === 'none') return;\n\n      document.documentElement.style.setProperty('--bg-texture-opacity', `${textureOpacity}`);\n      document.documentElement.style.setProperty('--bg-texture-size', textureSize);\n\n      const settings = useSettingsStore.getState().settings;\n      const customTexture = settings.customTextures?.find((t) => t.id === textureId);\n\n      if (customTexture) {\n        useCustomTextureStore.getState().addTexture(customTexture.path);\n      }\n\n      useCustomTextureStore.getState().applyTexture(envConfig, textureId);\n    },\n    [],\n  );\n\n  return { applyBackgroundTexture };\n};\n"],"names":[],"mappings":";;;;AAEA;AACA;AACA;;AAJA;;;;AAQO,MAAM,uBAAuB;;IAClC,MAAM,yBAAyB,IAAA,4LAAW;oEACxC,CAAC,WAA0B;YACzB,MAAM,YAAY,aAAa,mBAAmB;YAClD,MAAM,iBAAiB,aAAa,iBAAiB;YACrD,MAAM,cAAc,aAAa,cAAc;YAC/C,IAAI,CAAC,aAAa,cAAc,QAAQ;YAExC,SAAS,eAAe,CAAC,KAAK,CAAC,WAAW,CAAC,wBAAwB,GAAG,gBAAgB;YACtF,SAAS,eAAe,CAAC,KAAK,CAAC,WAAW,CAAC,qBAAqB;YAEhE,MAAM,WAAW,uKAAgB,CAAC,QAAQ,GAAG,QAAQ;YACrD,MAAM,gBAAgB,SAAS,cAAc,EAAE;4EAAK,CAAC,IAAM,EAAE,EAAE,KAAK;;YAEpE,IAAI,eAAe;gBACjB,iLAAqB,CAAC,QAAQ,GAAG,UAAU,CAAC,cAAc,IAAI;YAChE;YAEA,iLAAqB,CAAC,QAAQ,GAAG,YAAY,CAAC,WAAW;QAC3D;mEACA,EAAE;IAGJ,OAAO;QAAE;IAAuB;AAClC;GAxBa"}},
    {"offset": {"line": 4479, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/hooks/useEinkMode.ts"],"sourcesContent":["'use client';\n\nimport { useThemeStore } from '@/store/themeStore';\nimport { useCallback } from 'react';\n\nexport const useEinkMode = () => {\n  const { setIsEinkMode } = useThemeStore();\n  const applyEinkMode = useCallback(\n    (isEink: boolean) => {\n      setIsEinkMode(isEink);\n      if (isEink) {\n        document.body.classList.add('no-transitions');\n      } else {\n        document.body.classList.remove('no-transitions');\n      }\n      document.documentElement.setAttribute('data-eink', isEink.toString());\n    },\n    [setIsEinkMode],\n  );\n\n  return { applyEinkMode };\n};\n"],"names":[],"mappings":";;;;AAEA;AACA;;AAHA;;;AAKO,MAAM,cAAc;;IACzB,MAAM,EAAE,aAAa,EAAE,GAAG,IAAA,iKAAa;IACvC,MAAM,gBAAgB,IAAA,4LAAW;kDAC/B,CAAC;YACC,cAAc;YACd,IAAI,QAAQ;gBACV,SAAS,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC;YAC9B,OAAO;gBACL,SAAS,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC;YACjC;YACA,SAAS,eAAe,CAAC,YAAY,CAAC,aAAa,OAAO,QAAQ;QACpE;iDACA;QAAC;KAAc;IAGjB,OAAO;QAAE;IAAc;AACzB;GAhBa;;QACe,iKAAa"}},
    {"offset": {"line": 4521, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/utils/rtl.ts"],"sourcesContent":["import { getUserLang } from './misc';\n\nexport const getDirFromLanguage = (lang: string) => {\n  if (!lang) return 'auto';\n  const rtlLanguages = new Set(['ar', 'he', 'fa', 'ur', 'dv', 'ps', 'sd', 'yi']);\n  const primaryLang = lang.split('-')[0]!.toLowerCase();\n  return rtlLanguages.has(primaryLang) ? 'rtl' : 'auto';\n};\n\nexport const getDirFromUILanguage = () => {\n  const lang = getUserLang();\n  return getDirFromLanguage(lang);\n};\n"],"names":[],"mappings":";;;;;;AAAA;;AAEO,MAAM,qBAAqB,CAAC;IACjC,IAAI,CAAC,MAAM,OAAO;IAClB,MAAM,eAAe,IAAI,IAAI;QAAC;QAAM;QAAM;QAAM;QAAM;QAAM;QAAM;QAAM;KAAK;IAC7E,MAAM,cAAc,KAAK,KAAK,CAAC,IAAI,CAAC,EAAE,CAAE,WAAW;IACnD,OAAO,aAAa,GAAG,CAAC,eAAe,QAAQ;AACjD;AAEO,MAAM,uBAAuB;IAClC,MAAM,OAAO,IAAA,yJAAW;IACxB,OAAO,mBAAmB;AAC5B"}},
    {"offset": {"line": 4555, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/components/Providers.tsx"],"sourcesContent":["'use client';\n\nimport '@/utils/polyfill';\nimport i18n from '@/i18n/i18n';\nimport { useEffect } from 'react';\nimport { IconContext } from 'react-icons';\nimport { AuthProvider } from '@/context/AuthContext';\nimport { useEnv } from '@/context/EnvContext';\nimport { CSPostHogProvider } from '@/context/PHContext';\nimport { SyncProvider } from '@/context/SyncContext';\nimport { initSystemThemeListener, loadDataTheme } from '@/store/themeStore';\nimport { useSettingsStore } from '@/store/settingsStore';\nimport { useSafeAreaInsets } from '@/hooks/useSafeAreaInsets';\nimport { useDefaultIconSize } from '@/hooks/useResponsiveSize';\nimport { useBackgroundTexture } from '@/hooks/useBackgroundTexture';\nimport { useEinkMode } from '@/hooks/useEinkMode';\nimport { getLocale } from '@/utils/misc';\nimport { getDirFromUILanguage } from '@/utils/rtl';\n\n// Set storage mode globally before any other code runs\nif (typeof window !== 'undefined' && !((window as any).__STORAGE_MODE_SET__)) {\n  const storageMode = process.env['NEXT_PUBLIC_STORAGE_MODE'] || 'remote';\n  (window as any).__STORAGE_MODE__ = storageMode;\n  (window as any).__STORAGE_MODE_SET__ = true;\n  console.log('[Providers] Global: Set window.__STORAGE_MODE__ to:', storageMode);\n}\n\nconst Providers = ({ children }: { children: React.ReactNode }) => {\n  const { envConfig, appService } = useEnv();\n  const { applyUILanguage } = useSettingsStore();\n  const { applyBackgroundTexture } = useBackgroundTexture();\n  const { applyEinkMode } = useEinkMode();\n  const iconSize = useDefaultIconSize();\n  useSafeAreaInsets(); // Initialize safe area insets\n\n  useEffect(() => {\n    // Verify storage mode is set (redundant safety check)\n    const storageMode = process.env['NEXT_PUBLIC_STORAGE_MODE'] || 'local';\n    if (!((window as any).__STORAGE_MODE__)) {\n      (window as any).__STORAGE_MODE__ = storageMode;\n    }\n    console.log('[Providers] useEffect: window.__STORAGE_MODE__ =', (window as any).__STORAGE_MODE__);\n\n    const handlerLanguageChanged = (lng: string) => {\n      document.documentElement.lang = lng;\n      // Set RTL class on document for targeted styling without affecting layout\n      const dir = getDirFromUILanguage();\n      if (dir === 'rtl') {\n        document.documentElement.classList.add('ui-rtl');\n      } else {\n        document.documentElement.classList.remove('ui-rtl');\n      }\n    };\n\n    const locale = getLocale();\n    handlerLanguageChanged(locale);\n    i18n.on('languageChanged', handlerLanguageChanged);\n    return () => {\n      i18n.off('languageChanged', handlerLanguageChanged);\n    };\n  }, []);\n\n  useEffect(() => {\n    loadDataTheme();\n    if (appService) {\n      initSystemThemeListener(appService);\n      appService.loadSettings().then((settings) => {\n        const globalViewSettings = settings.globalViewSettings;\n        applyUILanguage(globalViewSettings.uiLanguage);\n        applyBackgroundTexture(envConfig, globalViewSettings);\n        if (globalViewSettings.isEink) {\n          applyEinkMode(true);\n        }\n      });\n    }\n  }, [envConfig, appService, applyUILanguage, applyBackgroundTexture, applyEinkMode]);\n\n  // Make sure appService is available in all children components\n  if (!appService) return;\n\n  return (\n    <CSPostHogProvider>\n      <AuthProvider>\n        <IconContext.Provider value={{ size: `${iconSize}px` }}>\n          <SyncProvider>{children}</SyncProvider>\n        </IconContext.Provider>\n      </AuthProvider>\n    </CSPostHogProvider>\n  );\n};\n\nexport default Providers;\n"],"names":[],"mappings":";;;;AAqBsB;;AAnBtB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAjBA;;;;;;;;;;;;;;;;;AAmBA,uDAAuD;AACvD,IAAI,+CAAkB,eAAe,CAAE,AAAC,OAAe,oBAAoB,EAAG;IAC5E,MAAM,cAAc,6CAA2C;IAC9D,OAAe,gBAAgB,GAAG;IAClC,OAAe,oBAAoB,GAAG;IACvC,QAAQ,GAAG,CAAC,uDAAuD;AACrE;AAEA,MAAM,YAAY,CAAC,EAAE,QAAQ,EAAiC;;IAC5D,MAAM,EAAE,SAAS,EAAE,UAAU,EAAE,GAAG,IAAA,6JAAM;IACxC,MAAM,EAAE,eAAe,EAAE,GAAG,IAAA,uKAAgB;IAC5C,MAAM,EAAE,sBAAsB,EAAE,GAAG,IAAA,kLAAoB;IACvD,MAAM,EAAE,aAAa,EAAE,GAAG,IAAA,gKAAW;IACrC,MAAM,WAAW,IAAA,6KAAkB;IACnC,IAAA,4KAAiB,KAAI,8BAA8B;IAEnD,IAAA,0LAAS;+BAAC;YACR,sDAAsD;YACtD,MAAM,cAAc,6CAA2C;YAC/D,IAAI,CAAE,AAAC,OAAe,gBAAgB,EAAG;gBACtC,OAAe,gBAAgB,GAAG;YACrC;YACA,QAAQ,GAAG,CAAC,oDAAoD,AAAC,OAAe,gBAAgB;YAEhG,MAAM;8DAAyB,CAAC;oBAC9B,SAAS,eAAe,CAAC,IAAI,GAAG;oBAChC,0EAA0E;oBAC1E,MAAM,MAAM,IAAA,iKAAoB;oBAChC,IAAI,QAAQ,OAAO;wBACjB,SAAS,eAAe,CAAC,SAAS,CAAC,GAAG,CAAC;oBACzC,OAAO;wBACL,SAAS,eAAe,CAAC,SAAS,CAAC,MAAM,CAAC;oBAC5C;gBACF;;YAEA,MAAM,SAAS,IAAA,uJAAS;YACxB,uBAAuB;YACvB,oJAAI,CAAC,EAAE,CAAC,mBAAmB;YAC3B;uCAAO;oBACL,oJAAI,CAAC,GAAG,CAAC,mBAAmB;gBAC9B;;QACF;8BAAG,EAAE;IAEL,IAAA,0LAAS;+BAAC;YACR,IAAA,iKAAa;YACb,IAAI,YAAY;gBACd,IAAA,2KAAuB,EAAC;gBACxB,WAAW,YAAY,GAAG,IAAI;2CAAC,CAAC;wBAC9B,MAAM,qBAAqB,SAAS,kBAAkB;wBACtD,gBAAgB,mBAAmB,UAAU;wBAC7C,uBAAuB,WAAW;wBAClC,IAAI,mBAAmB,MAAM,EAAE;4BAC7B,cAAc;wBAChB;oBACF;;YACF;QACF;8BAAG;QAAC;QAAW;QAAY;QAAiB;QAAwB;KAAc;IAElF,+DAA+D;IAC/D,IAAI,CAAC,YAAY;IAEjB,qBACE,6MAAC,uKAAiB;kBAChB,cAAA,6MAAC,oKAAY;sBACX,cAAA,6MAAC,iPAAW,CAAC,QAAQ;gBAAC,OAAO;oBAAE,MAAM,GAAG,SAAS,EAAE,CAAC;gBAAC;0BACnD,cAAA,6MAAC,oKAAY;8BAAE;;;;;;;;;;;;;;;;;;;;;AAKzB;GA9DM;;QAC8B,6JAAM;QACZ,uKAAgB;QACT,kLAAoB;QAC7B,gKAAW;QACpB,6KAAkB;QACnC,4KAAiB;;;KANb;uCAgES"}},
    {"offset": {"line": 4717, "column": 0}, "map": {"version":3,"sources":["file:///app/readest/apps/readest-app/src/pages/_app.tsx"],"sourcesContent":["import Head from 'next/head';\nimport { AppProps } from 'next/app';\nimport { EnvProvider } from '@/context/EnvContext';\nimport Providers from '@/components/Providers';\n\nimport '../styles/globals.css';\n\nfunction MyApp({ Component, pageProps }: AppProps) {\n  return (\n    <>\n      <Head>\n        <meta\n          name='viewport'\n          content='minimum-scale=1, initial-scale=1, width=device-width, shrink-to-fit=no, user-scalable=no, viewport-fit=cover'\n        />\n        <meta name='application-name' content='Readest' />\n        <meta name='apple-mobile-web-app-capable' content='yes' />\n        <meta name='apple-mobile-web-app-status-bar-style' content='default' />\n        <meta name='apple-mobile-web-app-title' content='Readest' />\n        <meta\n          name='description'\n          content='Readest is an open-source eBook reader supporting EPUB, PDF, and sync across devices.'\n        />\n        <meta name='format-detection' content='telephone=no' />\n        <meta name='mobile-web-app-capable' content='yes' />\n        <meta name='theme-color' content='white' />\n        <link rel='manifest' href='/manifest.json' />\n      </Head>\n      <EnvProvider>\n        <Providers>\n          <Component {...pageProps} />\n        </Providers>\n      </EnvProvider>\n    </>\n  );\n}\n\nexport default MyApp;\n"],"names":[],"mappings":";;;;;AAAA;AAEA;AACA;;;;;;AAIA,SAAS,MAAM,EAAE,SAAS,EAAE,SAAS,EAAY;IAC/C,qBACE;;0BACE,6MAAC,qSAAI;;kCACH,6MAAC;wBACC,MAAK;wBACL,SAAQ;;;;;;kCAEV,6MAAC;wBAAK,MAAK;wBAAmB,SAAQ;;;;;;kCACtC,6MAAC;wBAAK,MAAK;wBAA+B,SAAQ;;;;;;kCAClD,6MAAC;wBAAK,MAAK;wBAAwC,SAAQ;;;;;;kCAC3D,6MAAC;wBAAK,MAAK;wBAA6B,SAAQ;;;;;;kCAChD,6MAAC;wBACC,MAAK;wBACL,SAAQ;;;;;;kCAEV,6MAAC;wBAAK,MAAK;wBAAmB,SAAQ;;;;;;kCACtC,6MAAC;wBAAK,MAAK;wBAAyB,SAAQ;;;;;;kCAC5C,6MAAC;wBAAK,MAAK;wBAAc,SAAQ;;;;;;kCACjC,6MAAC;wBAAK,KAAI;wBAAW,MAAK;;;;;;;;;;;;0BAE5B,6MAAC,kKAAW;0BACV,cAAA,6MAAC,gKAAS;8BACR,cAAA,6MAAC;wBAAW,GAAG,SAAS;;;;;;;;;;;;;;;;;;AAKlC;KA5BS;uCA8BM"}},
    {"offset": {"line": 4853, "column": 0}, "map": {"version":3,"sources":["turbopack:///[next]/entry/page-loader.ts"],"sourcesContent":["const PAGE_PATH = \"/_app\";\n\n/// <reference types=\"next/client\" />\n\n// inserted by rust code\ndeclare const PAGE_PATH: string\n\n  // Adapted from https://github.com/vercel/next.js/blob/b7f9f1f98fc8ab602e84825105b5727272b72e7d/packages/next/src/build/webpack/loaders/next-client-pages-loader.ts\n;(window.__NEXT_P = window.__NEXT_P || []).push([\n  PAGE_PATH,\n  () => {\n    return require('PAGE')\n  },\n])\n// @ts-expect-error module.hot exists\nif (module.hot) {\n  // @ts-expect-error module.hot exists\n  module.hot.dispose(function () {\n    window.__NEXT_P.push([PAGE_PATH])\n  })\n}\n"],"names":[],"mappings":"AAAA,MAAM,YAAY;AAQjB,CAAC,OAAO,QAAQ,GAAG,OAAO,QAAQ,IAAI,EAAE,EAAE,IAAI,CAAC;IAC9C;IACA;QACE;IACF;CACD;AACD,qCAAqC;AACrC,IAAI,OAAO,GAAG,EAAE;IACd,qCAAqC;IACrC,OAAO,GAAG,CAAC,OAAO,CAAC;QACjB,OAAO,QAAQ,CAAC,IAAI,CAAC;YAAC;SAAU;IAClC;AACF","ignoreList":[0]}}]
}