version: '3.8'

services:
  readest:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: readest-app
    restart: unless-stopped
    ports:
      - "3000:3000"
    environment:
      # 认证配置 - 可选，不配置会自动生成
      # AUTH_SECRET: ${AUTH_SECRET}
      # AUTH_PASSWORD: ${AUTH_PASSWORD}
      
      # 存储配置 - 可选，默认为 local 和 /data/books
      # STORAGE_MODE: ${STORAGE_MODE:-local}
      # NEXT_PUBLIC_STORAGE_MODE: ${NEXT_PUBLIC_STORAGE_MODE:-local}
      # LOCAL_STORAGE_ROOT: ${LOCAL_STORAGE_ROOT:-/data/books}
      
      # 应用配置 - 可选，默认为 web 和 production
      # NEXT_PUBLIC_APP_PLATFORM: ${NEXT_PUBLIC_APP_PLATFORM:-web}
      # NODE_ENV: ${NODE_ENV:-production}
    volumes:
      # 书籍存储
      - ./books:/data/books
    healthcheck:
      test: ["CMD", "wget", "--quiet", "--tries=1", "--spider", "http://localhost:3000/"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

# volumes:
#   books:
